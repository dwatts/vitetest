(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function u(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function Hxt(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(h){try{c(i.next(h))}catch(d){o(d)}}function l(h){try{c(i.throw(h))}catch(d){o(d)}}function c(h){h.done?n(h.value):s(h.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}const LOe="modulepreload",DOe=function(t){return"/vitetest/"+t},IJ={},ae=function(e,r,i){if(!r||r.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=DOe(n),n in IJ)return;IJ[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const d=s[h];if(d.href===n&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":LOe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((h,d)=>{c.addEventListener("load",h),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function NOe(t){return t&&t.release&&typeof t.release=="function"}function FOe(t){return t&&t.acquire&&typeof t.acquire=="function"}let Uo=class vV{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(vV.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):FOe(r)&&r.acquire(...e),r}release(e){e&&!vV.test.disabled&&(this._releaseFunction?this._releaseFunction(e):NOe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};Uo.test={disabled:!1};function UOe(t){t.length=0}let sc=class{constructor(e=50,r=50){this._pool=new Uo(Array,void 0,UOe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return E6.acquire()}static release(e){return E6.release(e)}static prune(){E6.prune()}};const E6=new sc(100);function Wxt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function VOe(t,e){for(const r of t)if(r!=null&&e(r))return r}function bV(t){return t!=null&&typeof t[Symbol.iterator]=="function"}function lc(t,e){return t!=null?e(t):null}function ec(t,e){return B4(t,e),t}function B4(t,e){if(t==null)throw new Error(e??"value is None")}function Pe(t){return t==null||t.destroy(),null}function Fe(t){return t==null||t.dispose(),null}function Di(t){return t==null||t.remove(),null}function lu(t){return t==null||t.abort(),null}function Bi(t){return t==null||t.release(),null}function zOe(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function DS(t){return null}function Zxt(t,e){const r=new Array;for(const i of t)r.push(i!=null?e(i):null);return r}function Xxt(t,e){for(const r of t)lc(r,e)}function Yxt(t){return t}let Mi=class wV{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(bV(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&bV(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof wV)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof wV?r.removeAll():r.remove()}};const ihe=Symbol("Accessor-beforeDestroy");function V2(t){return ja(()=>t.forEach(e=>e!=null&&e.remove()))}function ja(t){return{remove:()=>{t&&(t(),t=void 0)}}}function Jxt(t){return ja(t!=null?()=>t.destroy():void 0)}let oA=class Uv{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Uv._m}getInt(){return this._seed=(Uv._a*this._seed+Uv._c)%Uv._m,this._seed}getFloat(){return this.getInt()/(Uv._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/Uv._m*i}};oA._m=2147483647,oA._a=48271,oA._c=0;const G4=1.5,kOe=1/G4,BOe=.5;function j4(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):t.filter((r,i,s)=>s.indexOf(r)===i)}function Og(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function DH(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function GOe(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function jOe(t){return t&&typeof t.length=="number"}function HOe(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const qOe=!!Array.prototype.fill;function Qxt(t,e){if(qOe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function WOe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function she(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let nhe=class{constructor(){this.last=0}};const ohe=new nhe;function xV(t,e,r,i){i=i||ohe;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function iO(t,e,r,i){const s=r??t.length,n=xV(t,e,s,i);if(n!==-1)return t[n]=t[s-1],r==null&&t.pop(),e}const Uh=new Set;function ZOe(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;Uh.clear();for(let a=0;a<i;++a)Uh.add(e[a]);s=s||ohe;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(Uh.has(t[a])&&(n&&n.push(t[a]),Uh.delete(t[a]),t[a]=t[r-1],--r,--a,Uh.size===0||r===0))return Uh.clear(),r;for(let a=0;a<o;++a)if(Uh.has(t[a])&&(n&&n.push(t[a]),Uh.delete(t[a]),t[a]=t[r-1],--r,--a,Uh.size===0||r===0))return Uh.clear(),r;return Uh.clear(),r}function XOe(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function YOe(t){return t?($J.seed=t,()=>$J.getFloat()):Math.random}function eTt(t,e){const r=YOe(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const $J=new oA;function NH(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function tTt(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function fw(t,e){return t!=null}const JOe=[];let B0;function oe(t){return typeof B0[t]=="function"?B0[t]=B0[t](globalThis):B0[t]}var Xue,Yue,Jue,Que;B0=(Xue=globalThis.dojoConfig)!=null&&Xue.has||(Yue=globalThis.esriConfig)!=null&&Yue.has?{...(Jue=globalThis.dojoConfig)==null?void 0:Jue.has,...(Que=globalThis.esriConfig)==null?void 0:Que.has}:{},oe.add=(t,e,r,i)=>((i||B0[t]===void 0)&&(B0[t]=e),r&&oe(t)),oe.cache=B0,oe.add("esri-deprecation-warnings",!0),oe.add("esri-force-fullscreen-debug",!1),(()=>{var e;oe.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(oe.add("host-browser",t),oe.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),oe.add("dom",t),oe("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(oe.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),oe.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),oe.add("khtml",s.includes("Konqueror")?n:void 0),oe.add("edge",parseFloat(i.split("Edge/")[1])||void 0),oe.add("opr",parseFloat(i.split("OPR/")[1])||void 0),oe.add("webkit",!oe("wp")&&!oe("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),oe.add("chrome",!oe("edge")&&!oe("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),oe.add("android",!oe("wp")&&parseFloat(i.split("Android ")[1])||void 0),oe.add("safari",!s.includes("Safari")||oe("wp")||oe("chrome")||oe("android")||oe("edge")||oe("opr")?void 0:parseFloat(s.split("Version/")[1])),oe.add("mac",s.includes("Macintosh")),!oe("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));oe.add(o,l),oe.add("ios",l)}oe("webkit")||(!i.includes("Gecko")||oe("wp")||oe("khtml")||oe("edge")||oe.add("mozilla",n),oe("mozilla")&&oe.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&oe.add("esri-mobile",e),r&&oe.add("esri-iPhone",r),oe.add("esri-geolocation",!!navigator.geolocation)}oe.add("esri-wasm","WebAssembly"in globalThis),oe.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),oe.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),oe.add("esri-atomics","Atomics"in globalThis),oe.add("esri-workers","Worker"in globalThis),oe.add("web-feat:cache","caches"in globalThis),oe.add("esri-workers-arraybuffer-transfer",!oe("safari")||Number(oe("safari"))>=12),oe.add("workers-pool-size",8),oe.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),oe.add("featurelayer-simplify-payload-size-factors",[1,1,4]),oe.add("featurelayer-animation-enabled",!0),oe.add("featurelayer-snapshot-enabled",!0),oe.add("featurelayer-snapshot-point-min-threshold",8e4),oe.add("featurelayer-snapshot-point-max-threshold",4e5),oe.add("featurelayer-snapshot-point-coverage",.1),oe.add("featurelayer-advanced-symbols",!1),oe.add("featurelayer-pbf",!0),oe.add("featurelayer-pbf-statistics",!1),oe.add("feature-layers-workers",!0),oe.add("feature-polyline-generalization-factor",1),oe.add("mapview-transitions-duration",200),oe.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),oe.add("mapserver-pbf-version-support",10.81),oe.add("mapservice-popup-identify-max-tolerance",20),oe.add("heatmap-allow-raster-fallback",!1),oe.add("heatmap-force-raster",!1),oe("host-webworker")||oe("host-browser")&&(oe.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),oe.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{oe.add("esri-image-decode",!0,!0,!0)}).catch(()=>{oe.add("esri-image-decode",!1,!0,!0)})}return!1}),oe.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function CC(t){return t instanceof ArrayBuffer}function FH(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function G0(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function ahe(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function H4(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function q4(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function W4(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function Z4(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function NS(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function FS(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function ep(t){return!("buffer"in t)}function j0(t){return t!=null?ep(t)?8*t.length+12:t.byteLength+lhe:0}const lhe=145,cu=1024;function QOe(t){return FS(t)||NS(t)||W4(t)||H4(t)||FH(t)}function KOe(t){return FS(t)||NS(t)}function eRe(t){return FS(t)?179769e303:NS(t)?3402823e32:Z4(t)?4294967295:q4(t)?65535:G0(t)||ahe(t)?255:W4(t)?2147483647:H4(t)?32767:FH(t)?127:256}function che(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&che(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function K(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=dhe(t);if(e!=null)return e;if(pD(t))return t.clone();if(uhe(t))return t.map(K);if(hhe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=K(t[i]);return r}function TV(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=dhe(t);if(e!=null)return e;if(uhe(t)){let r=!0;const i=t.map(s=>{const n=TV(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(pD(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!hhe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=TV(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function pD(t){return typeof t.clone=="function"}function uhe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function hhe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function LJ(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function dhe(t){if(FH(t)||G0(t)||ahe(t)||H4(t)||q4(t)||W4(t)||Z4(t)||NS(t)||FS(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,K(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(K(r));return e}return null}function UH(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function phe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Og(t,e):t instanceof Set?e instanceof Set&&rRe(t,e):t instanceof Map?e instanceof Map&&iRe(t,e):!!LJ(t)&&LJ(e)&&tRe(t,e))}function tRe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function rRe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function iRe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function la(t){return t.__accessor__??null}function sRe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function y$(t,e,r){return r?fD(t,e,{policy:r,path:""}):fD(t,e,null)}function fD(t,e,r){return e?Object.keys(e).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=K(e[n]),i;let l=i[n],c=e[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(r){const h=r.path;r.path=o,i[n]=fD(l,c,r),r.path=h}else i[n]=fD(l,c,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[n]=c);return i},t||{}):t}function fhe(t){return Array.isArray(t)?t:t.split(".")}function DJ(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function nRe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...DJ(r));return e}return DJ(t)}function mhe(t,e,r,i){const s=nRe(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return V2(n)}return i(t,s[0],r)}function VH(t){let e=!1;return()=>{e||(e=!0,t())}}function ghe(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const i=la(e);return sRe(i,r)?i.get(r):e[r]}function yhe(t,e,r){if(t==null)return t;const i=ghe(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:yhe(i,e,r+1)}function lR(t,e,r=0){return typeof e!="string"||e.includes(".")?yhe(t,fhe(e),r):ghe(e,t)}function mD(t,e){return lR(t,e)}function NJ(t,e){return lR(e,t)!==void 0}function cR(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=K(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function uR(t,e){const r=cR(t);let i=r[e];return i||(i=r[e]={}),i}function oRe(t,e){return y$(t,e,lRe)}const aRe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function lRe(t){return aRe.test(t)?"replace":"merge"}function _he(t,e,r=!1){return bhe(t,e,r)}function hR(t,e){if(e!=null)return e[t]||vhe(t.split("."),!1,e)}function Ha(t,e,r){const i=t.split("."),s=i.pop(),n=vhe(i,!0,r);n&&s&&(n[s]=e)}function vhe(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function bhe(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=K(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=bhe(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}var Kue;const Yr={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:(Kue=globalThis.location)==null?void 0:Kue.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(_he(Yr,globalThis.esriConfig,!0),delete Yr.has),!Yr.assetsPath){{const t="4.27";Yr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Yr.defaultAssetsPath=Yr.assetsPath}const cRe=/\{([^\}]+)\}/g;function FJ(t){return t??""}function X4(t,e){return t.replaceAll(cRe,typeof e=="object"?(r,i)=>FJ(hR(i,e)):(r,i)=>FJ(e(i)))}function rTt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function zH(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function iTt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function sTt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const UJ={info:0,warn:1,error:2,none:3};let Q=class xa{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,xa._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=xa.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=xa._loggers;return xa._loggers=e,r},set throttlingDisabled(e){xa._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,xa._loggers.get(e)||new xa({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!xa._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=xa._tickCounter)return;this._loggedMessages[e].set(s,xa._tickCounter),xa._scheduleTickCounterIncrement()}for(const s of Yr.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const s=i[e];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=Yr.log.level||"warn";return UJ[this._parentWithMember("level",r)]<=UJ[e]}_argsToKey(...e){return zH(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){xa._tickCounterScheduled||(xa._tickCounterScheduled=!0,Promise.resolve().then(()=>{xa._tickCounter++,xa._tickCounterScheduled=!1}))}};Q._loggers=new Map,Q._tickCounter=0,Q._tickCounterScheduled=!1,Q._throttlingDisabled=!1;var ng;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(ng||(ng={}));let uRe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){NH(this._observers,this._observer)}},whe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return hRe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new uRe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const hRe=ja();var hr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(hr||(hr={}));const SV=hr.USER+1;function lg(t){switch(t){case"defaults":return hr.DEFAULTS;case"service":return hr.SERVICE;case"portal-item":return hr.PORTAL_ITEM;case"web-scene":return hr.WEB_SCENE;case"web-map":return hr.WEB_MAP;case"link-chart":return hr.LINK_CHART;case"user":return hr.USER;default:return null}}function gD(t){switch(t){case hr.DEFAULTS:return"defaults";case hr.SERVICE:return"service";case hr.PORTAL_ITEM:return"portal-item";case hr.WEB_SCENE:return"web-scene";case hr.WEB_MAP:return"web-map";case hr.LINK_CHART:return"link-chart";case hr.USER:return"user"}return void 0}function dRe(t){return gD(t)}var Ri;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Ri||(Ri={}));const yD={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},AC=[];let aA=yD;function Xt(t){aA.onObservableAccessed(t)}let _$=!1,v$=!1;function Rg(t,e,r){if(_$)return kH(t,e,r);xhe(t);const i=e.call(r);return The(),i}function pRe(t,e){return Rg(yD,t,e)}function kH(t,e,r){const i=_$;_$=!0,xhe(t);let s=null;try{s=e.call(r)}catch(n){v$&&Q.getLogger("esri.core.accessorSupport.tracking").error(n)}return The(),_$=i,s}function xhe(t){aA=t,AC.push(t)}function The(){const t=AC.length;if(t>1){const e=AC.pop();aA=AC[t-2],e.onTrackingEnd()}else if(t===1){const e=AC.pop();aA=yD,e.onTrackingEnd()}else aA=yD}function She(t,e){const r=e.observerObject;if(r.flags&Ri.DepTrackingInitialized)return;const i=v$;v$=!1,r.flags&Ri.AutoTracked?kH(e,e.metadata.get,t):Ehe(t,e),v$=i}const fRe=[];function Ehe(t,e){const r=e.observerObject;r.flags&Ri.ExplicitlyTracking||(r.flags|=Ri.ExplicitlyTracking,kH(e,()=>{const i=e.metadata.dependsOn||fRe;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=fhe(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=VJ(a,n[o],o!==n.length-1)}else VJ(t,s,!1)}),r.flags&=~Ri.ExplicitlyTracking)}function VJ(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=la(t);if(s){const n=s.propertiesByName.get(i);n&&(Xt(n.observerObject),She(t,n))}return r?t[i]:void 0}let zJ=class{constructor(e,r){this.propertyName=e,this.metadata=r,this.observerObject=new mRe,this._accessed=null,this._handles=null,this.observerObject.flags=Ri.Dirty|(r.nonNullable?Ri.NonNullable:0)|(r.hasOwnProperty("value")?Ri.HasDefaultValue:0)|(r.get===void 0?Ri.DepTrackingInitialized:0)|(r.dependsOn===void 0?Ri.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const r=this.observerObject;Xt(r);const i=e.store,s=this.propertyName,n=r.flags,o=i.get(s);if(n&Ri.Computing||~n&Ri.Dirty&&i.has(s))return o;r.flags|=Ri.Computing;const a=e.host;let l;n&Ri.AutoTracked?l=Rg(this,this.metadata.get,a):(Ehe(a,this),l=this.metadata.get.call(a)),i.set(s,l,hr.COMPUTED);const c=i.get(s);return c===o?r.flags&=~Ri.Dirty:pRe(this.commit,this),r.flags&=~Ri.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Ri.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let s=0;s<r.length;++s)i.push(r[s].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Ri.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},mRe=class extends whe{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Ri.Overriden&&(this.flags|=Ri.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&Ri.Dirty&&this.onCommitted(),super.destroy()}},gRe=class Che{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new Che;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,K(i))}),r}get(e){return this._values.get(e)}originOf(){return hr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function hP(t,e,r){return t!==void 0}function kJ(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&Ri.NonNullable)||(i.lifecycle,ng.INITIALIZING,!1))}function yRe(t){return t&&typeof t.destroy=="function"}Q.getLogger("esri.core.accessorSupport.Properties");let _Re=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=ng.INITIALIZING,this.store=new gRe,this._origin=hr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new zJ(i,r[i]);this.propertiesByName.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=ng.CONSTRUCTING}constructed(){this.lifecycle=ng.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&yRe(i)&&(i.destroy(),~r.observerObject.flags&Ri.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==ng.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Xt(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.observerObject.flags&Ri.HasDefaultValue)return"defaults"}return gD(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(hP(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);hP(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.propertiesByName.get(r);if(!hP(s))return"";const n=new Set,o=Rg({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof zJ&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const s=this.propertiesByName.get(e);if(hP(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.observerObject.flags&Ri.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e),i=r==null?void 0:r.observerObject;i&&i.flags&Ri.Overriden&&(i.flags&=~Ri.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!kJ(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(C6.release(n),!o)return;r=a}i.observerObject.flags|=Ri.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!kJ(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(C6.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=lg(e)}getDefaultOrigin(){return gD(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==ng.INITIALIZING?this._origin:hr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&UH(r,s.get(n))&&~e.observerObject.flags&Ri.Overriden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),She(this.host,e))}_cast(e,r){const i=C6.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},vRe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const C6=new Uo(vRe);function bRe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(hR(i,e)??"").toString())}let Ahe=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&bRe(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},U=class Ohe extends Ahe{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return K(r)}catch{return"[object]"}}))}}catch(e){throw Q.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Ohe(e.name,e.message,e.details)}};U.prototype.type="error";function _D(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))_D(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void _D(mD(t,s),n,r)}const i=t.__accessor__;i!=null&&wRe(e,i),t[e]=r}}function wRe(t,e){if(oe("esri-unknown-property-errors")&&!xRe(t,e))throw new U("set:unknown-property",TRe(t,e))}function xRe(t,e){return e.metadatas[t]!=null}function TRe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let SRe;function ERe(){return SRe}let Rhe=class extends Uo{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=DS(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const dP=[];function z2(t){dP.push(t),dP.length===1&&queueMicrotask(()=>{const e=dP.slice();dP.length=0;for(const r of e)r()})}let cg=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var EV;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const d=a>>>1,f=n[c-1];for(;h<=d;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const d=n[o];n[o]=n[h],n[h]=d,e(n,c,h,l),yield}}t.sort=i,t.iterableSort=s})(EV||(EV={}));const BJ=EV,CRe=1.5,ARe=1.1;let Gt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new nhe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>GJ(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,GJ(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=xV(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(xV(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=ZOe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){BJ.sort(this.data,0,this.length,e)}iterableSort(e){return BJ.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)e.call(r,s[n],n,s)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}};function GJ(t){t.data.length>CRe*t.length&&(t.data.length=Math.floor(t.length*ARe))}function ORe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const dR=ORe(globalThis);function Y4(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function pR(t,e,r){if(!Y4(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const s of i)t.addEventListener(s,r);return{remove(){for(const s of i)t.removeEventListener(s,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function Phe(t,e,r){if(!Y4(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=pR(t,e,s=>{i.remove(),r.call(t,s)});return{remove(){i.remove()}}}const RRe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function PRe({key:t}){return RRe[t]||t}function Dr(t="Aborted"){return new U("AbortError",t)}function Qt(t,e="Aborted"){if(vn(t))throw Dr(e)}function J4(t){return t!=null?"aborted"in t?t:t.signal:t}function vn(t){const e=J4(t);return e!=null&&e.aborted}function Io(t){if(ys(t))throw t}function jJ(t){if(!ys(t))throw t}function oa(t,e){const r=J4(t);if(r!=null){if(!r.aborted)return Phe(r,"abort",()=>e());e()}}function BH(t,e){const r=J4(t);if(r!=null)return Qt(r),Phe(r,"abort",()=>e(Dr()))}function Mhe(t,e){return J4(e)==null?t:new Promise((r,i)=>{let s=oa(e,()=>i(Dr()));const n=()=>s=Di(s);t.then(n,n),t.then(r,i)})}function ys(t){return(t==null?void 0:t.name)==="AbortError"}async function CV(t){try{return await t}catch(e){if(!ys(e))throw e;return}}async function mTt(t,e=Q.getLogger("esri")){try{return await t}catch(r){ys(r)||e.error(r)}}async function Zf(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await Zf(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function AV(t){return(await Zf(t)).filter(e=>!!e.value).map(e=>e.value)}function sO(t,e=void 0,r){const i=new AbortController;return oa(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);oa(i,()=>{o&&(clearTimeout(o),n(Dr()))})})}function gu(t){return t&&typeof t.then=="function"}function OV(t){return gu(t)?t:Promise.resolve(t)}function GH(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(Dr()),n=yo();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||yo(),n=null,e>0){const f=new AbortController;r=OV(t(...l,f.signal));const m=r;sO(e).then(()=>{r===m&&(n?f.abort():o=f)})}else r=1,r=OV(t(...l));const c=()=>{const f=i;i=s=r=o=null,f!=null&&a(...f)},h=r,d=s;return h.then(c,c),h.then(d.resolve,d.reject),d.promise};return a}function yo(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>dR.setTimeout(()=>i.reject(n),s),i.promise=r,i}function gTt(t,e){return t.then(e,e)}async function HJ(t){await Promise.resolve(),Qt(t)}function yTt(t){return t}function Ihe(t){return 1e3*t}function jH(t){return .001*t}function MRe(){return performance.now()}let IRe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},$Re=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},RV=0,PV=0;const vE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},MV=["prepare","preRender","render","postRender","update","finish"],IV=[],Ib=new Gt;let LRe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const vD={frameTasks:Ib,willDispatch:!1,clearFrameTasks:DRe,dispatch:Dhe,executeFrameTasks:FRe};function US(t){const e=new $Re(t);return IV.push(e),vD.willDispatch||(vD.willDispatch=!0,z2(Dhe)),e}function k2(t){const e=new IRe(t);return Ib.push(e),bD==null&&(RV=performance.now(),bD=requestAnimationFrame($he)),new LRe(e)}let bD=null;function DRe(t=!1){Ib.forAll(e=>{e.removed=!0}),t&&Lhe()}function NRe(t){PV=Math.max(0,t)}function $he(){const t=performance.now();bD=null,bD=Ib.length>0?requestAnimationFrame($he):null,vD.executeFrameTasks(t)}function FRe(t){const e=t-RV;RV=t;const r=PV>0?PV:1e3/60,i=Math.max(0,e-r);vE.time=t,vE.frameDuration=r-i;for(let s=0;s<MV.length;s++){const n=performance.now(),o=MV[s];Ib.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(vE.elapsedFrameTime=performance.now()-t,vE.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,vE)))}),URe[s].record(performance.now()-n)}Lhe(),VRe.record(performance.now()-t)}const pP=new Gt;function Lhe(){Ib.forAll(t=>{t.removed&&pP.push(t)}),Ib.removeUnorderedMany(pP.data,pP.length),pP.clear()}function Dhe(){for(;IV.length;){const t=IV.shift();t.isActive&&t.callback()}vD.willDispatch=!1}function wTt(t=1,e){const r=yo(),i=()=>{vn(e)?r.reject(Dr()):t===0?r():(--t,z2(()=>i()))};return i(),r.promise}const URe=MV.map(t=>new cg(t)),VRe=new cg("total");function b$(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let zRe=0;const kRe=0;function pc(){return++zRe}let Q4=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new BRe(e),qJ.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;qJ.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},BRe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=GRe}};const qJ=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function GRe(){}let l2=!1;const wD=[];function Nhe(t,e){let r=new Q4(n),i=null,s=!1;function n(){if(!r||s)return;if(l2)return void Vhe(n);const a=i;r.clear(),l2=!0,s=!0,i=Rg(r,t),s=!1,l2=!1,e(i,a),zhe()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=Rg(r,t),s=!1,{remove:o}}function Fhe(t,e){let r=new Q4(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=Rg(r,t),i):null}return o(),{remove:n}}function Uhe(t){let e=new Q4(i),r=!1;function i(){e&&!r&&(l2?Vhe(i):(e.clear(),l2=!0,r=!0,Rg(e,t),r=!1,l2=!1,zhe()))}function s(){e&&(e.destroy(),e=null)}return r=!0,Rg(e,t),r=!1,{remove:s}}function Vhe(t){wD.includes(t)||wD.unshift(t)}function zhe(){for(;wD.length;)wD.pop()()}var lA;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(lA||(lA={}));let nO=class{constructor(){this.uid=pc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(lA.Untracked,e,r,i,s,n,UH)}static acquireTracked(e,r,i,s){return this.pool.acquire(lA.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===lA.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,s,n,o,a){this.uid=pc(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=pc(),this.removed=!0}};nO.pool=new Rhe(nO);const w$=new sc,fg=new Set;let xD;function TD(t){fg.delete(t),fg.add(t),xD||(xD=US(qRe))}function jRe(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function HRe(t){for(const e of fg.values())e.target===t&&(e.removed=!0)}function qRe(){let t=10;for(;xD&&t--;){xD=null;const e=WRe(),r=w$.acquire();for(const i of e){const s=i.uid;jRe(i),s===i.uid&&i.removed&&r.push(i)}for(const i of fg)i.removed&&(r.push(i),fg.delete(i));for(const i of r)nO.pool.release(i);w$.release(r),w$.release(e),$V.forEach(i=>i())}}function WRe(){const t=w$.acquire();t.length=fg.size;let e=0;for(const r of fg)t[e]=r,++e;return fg.clear(),t}const $V=new Set;function khe(t){return $V.add(t),{remove(){$V.delete(t)}}}function ZRe(t,e,r){let i=mhe(t,e,r,(s,n,o)=>{let a,l,c=Fhe(()=>lR(s,n),(h,d)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=nO.acquireUntracked(h,o,d,s,n),l=a.uid),TD(a))});return{remove:VH(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,TD(a)),a=null),i=c=null})}});return i}function XRe(t,e,r){const i=mhe(t,e,r,(s,n,o)=>{let a=!1;return Nhe(()=>lR(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,UH(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function YRe(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?XRe(t,e,r):ZRe(t,e,r)}function JRe(t,e,r){let i,s,n=Fhe(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=nO.acquireTracked(o,e,a,r),s=i.uid),TD(i))});return{remove:VH(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,TD(i)),i=null),n=null})}}function QRe(t,e,r){let i=!1;return Nhe(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function KRe(t,e,r=!1,i=phe){return r?QRe(t,e,i):JRe(t,e,i)}function WJ(t){return b$(fg,e=>e.oldValue===t)}function Lo(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function ETt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function Bhe(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}const c2=Q.getLogger("esri.core.accessorSupport.ensureTypes");function ePe(t){return t==null?t:new Date(t)}function tPe(t){return t==null?t:!!t}function fR(t){return t==null?t:t.toString()}function Qu(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function HH(t){return t==null?t:Math.round(parseFloat(t))}function Ghe(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function SD(t,e){return e!=null&&t&&!(e instanceof t)}function jhe(t){return t&&"isCollection"in t}function ZJ(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function rPe(t,e){if(!e||!e.constructor||!jhe(e.constructor))return LV(t,e)?e:new t(e);const r=ZJ(t.prototype.itemType),i=ZJ(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(LV(t,e),e):new t(e):e}function LV(t,e){return!!Ghe(e)&&(c2.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+K4(t)+"'"),!0)}function $b(t,e){return e==null?e:jhe(t)?rPe(t,e):SD(t,e)?LV(t,e)?e:new t(e):e}function K4(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const iPe=new WeakMap;function sPe(t){switch(t){case Number:return Qu;case Ji:return HH;case Boolean:return tPe;case String:return fR;case Date:return ePe;default:return Bhe(iPe,t,()=>$b.bind(null,t))}}function qs(t,e){const r=sPe(t);return arguments.length===1?r:r(e)}function oO(t,e,r){return arguments.length===1?oO.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function nPe(t,e){return arguments.length===1?oO(r=>qs(t,r)):oO(r=>qs(t,r),e)}function Hhe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>Hhe(t,e-1,i)):t(r)}function ED(t,e,r){if(arguments.length===2)return n=>ED(t,e,n);if(!r)return r;r=Hhe(t,e,r);let i=e,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function oPe(t,e,r){return arguments.length===2?ED(i=>qs(t,i),e):ED(i=>qs(t,i),e,r)}function qhe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function DV(t,e){if(arguments.length===2)return DV(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!SD(a,d))?a:(h&&i.length?(n||(n=i.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),c2.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>K4(d)).join(", ")),c2.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):c2.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function tp(t,e){if(arguments.length===2)return tp(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=qs(c),i.push(K4(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!SD(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=r[c];if(!h)return c2.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!SD(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Ghe(l)){const d={};for(const f in l)f!==t.key&&(d[f]=l[f]);return h(d)}return h(l)}}let Ji=class{};const ATt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function aPe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function Whe(t){switch(t.type){case"native":return qs(t.value);case"array":return oO(Whe(t.value));case"one-of":return lPe(t);default:return null}}function lPe(t){let e=null;return(r,i)=>FV(r,t)?r:(e==null&&(e=NV(t)),c2.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function NV(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ji:return"integer";case Date:return"date";default:return K4(t.value)}case"array":return`array of ${NV(t.value)}`;case"one-of":{const e=t.values.map(r=>NV(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function FV(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Ji:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!FV(r,e.value));case"one-of":return e.values.some(r=>FV(t,r))}}function p(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=uR(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&Q.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let d=mD(this,l);if(typeof d=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=mD(this,h);f&&(d=d.bind(f))}return d},s.readOnly||(s.set=c?function(d){this._override(r,d)}:function(d){_D(this,l,d)})}const o=t.type,a=t.types;s.cast||(o?s.cast=cPe(o):a&&(Array.isArray(a)?s.cast=oO(tp(a[0])):s.cast=tp(a))),oRe(s,t),t.range&&(s.cast=uPe(s.cast,t.range))}}function qH(t,e,r){const i=uR(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function cPe(t){let e=0,r=t;if(aPe(t))return Whe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(qhe(i))return e===0?DV(i):ED(DV(i),e);if(e===1)return nPe(i);if(e>1)return oPe(i,e);const s=t;return s.from?s.from:qs(s)}function uPe(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function hPe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let yh=class extends Ahe{constructor(e,r,i){super(e,r,i)}};yh.prototype.type="warning";function Zhe(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const UV=Q.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function XJ(t,e,r){var i,s;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((s=e.read)==null?void 0:s.enabled)===!1||fPe(t)&&Ha("read.reader",VS(t),e))}function VS(t){var r,i;const e=t.ndimArray??0;if(e>1)return pPe(t);if(e===1)return YJ(t);if("type"in t&&Yhe(t.type)){const s=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,n=YJ(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return WH(t)}function WH(t){return"type"in t?dPe(t.type):mPe(t.types)}function dPe(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void UV.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function Xhe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>Xhe(t,s,r,i-1)):t(e,void 0,r)}function pPe(t){const e=WH(t),r=Xhe.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function YJ(t){const e=WH(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function Yhe(t){if(!Zhe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?ZH(e.Type):Jhe(e.Type))}function fPe(t){return"types"in t?Jhe(t.types):ZH(t.type)}function ZH(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Yhe(t))}function Jhe(t){for(const e in t.typeMap)if(!ZH(t.typeMap[e]))return!1;return!0}function mPe(t){let e=null;const r=t.errorContext??"type";return(i,s,n)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void UV.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=gPe(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const d=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&i&&n.messages.push(new yh(`${r}:unsupported`,d,{definition:i,context:n})),void UV.error(d)}const h=new c;return h.read(i,n),h}}function gPe(t){var r,i;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=cR(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){e[s]=n;continue}const c=l.target,h=typeof c=="string"?c:t.key,d={};l.writer(s,d,h),d[h]&&(e[d[h]]=n)}return e}function yPe(t){if(t.json||(t.json={}),QJ(t.json),KJ(t.json),JJ(t.json),t.json.origins)for(const e in t.json.origins)QJ(t.json.origins[e]),KJ(t.json.origins[e]),JJ(t.json.origins[e]);return!0}function JJ(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function QJ(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function KJ(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function eQ(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&Zhe(t.type))?e.write.writer=bPe:r>1?e.write.writer=wPe(r):e.types?Array.isArray(e.types)?e.write.writer=vPe(e.types[0]):e.write.writer=_Pe(e.types):e.write.writer=aO}function _Pe(t){return(e,r,i,s)=>e?Qhe(e,t,s)?aO(e,r,i,s):void 0:aO(e,r,i,s)}function Qhe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new U(`${i}:unsupported`,s,{definition:t,context:r})),Q.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function vPe(t){return(e,r,i,s)=>!e||!Array.isArray(e)?aO(e,r,i,s):aO(e.filter(n=>Qhe(n,t,s)),r,i,s)}function aO(t,e,r,i){Ha(r,CD(t,i),e)}function CD(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?AD(t):t}function AD(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function bPe(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>CD(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[CD(t,i)],Ha(r,s,e)}function Khe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>Khe(i,e,r-1)):CD(t,e)}function wPe(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=Khe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Ha(i,n,r)}}function xPe(t,e){return XH(t,"any",e==null?void 0:e.origin)}function VV(t,e){return XH(t,"read",e==null?void 0:e.origin)}function ede(t,e){return XH(t,"write",e==null?void 0:e.origin)}function XH(t,e,r){let i=t==null?void 0:t.json;if(i!=null&&i.origins&&r){let s;s=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],s&&(e==="any"||e in s)&&(i=s)}return i}function TPe(t){const e=SPe(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?EPe(i):e;XJ(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),eQ(s,i)}XJ(e,t.json,!0),eQ(e,t.json)}function SPe(t){return t.json.types?zV(t.json):t.type?tde(t):zV(t)}function EPe(t){return t.type?tde(t):zV(t)}function tde(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!qhe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function zV(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function CPe(t){yPe(t)&&(hPe(t),TPe(t))}const A6=new Set,O6=new Set;function R(t){return e=>{e.prototype.declaredClass=t,OPe(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!A6.has(s.initialize)&&(A6.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!O6.has(s.destroy)&&(O6.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);A6.clear(),O6.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[ihe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<i.length;h++)i[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=cR(e.prototype),n.prototype.declaredClass=t,n}}function APe(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Xt(i.observerObject);const s=r.store;return s.has(t)?s.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function OPe(t){const e=t.prototype,r=cR(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];CPe(n),i[s]={enumerable:!0,configurable:!0,get:APe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===ng.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var rde,ide;function RPe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Hy=Symbol("Accessor-Handles"),kV=Symbol("Accessor-Initialized");let xe=class sde{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}cR(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let d;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{d=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,d}:e[a]}for(const a in r){const l=RPe(r[a]);p(l)(o.prototype,a)}return R(i)(o)}constructor(...e){if(this[rde]=null,this[ide]=!1,this.constructor===sde)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new _Re(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e)),tQ.register(this,r.propertiesByName,this)}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[kV]=!0}initialize(){}[ihe](){this[Hy]=Pe(this[Hy])}destroy(){var e;this.destroyed||(tQ.unregister(this),HRe(this),this.__accessor__.destroy(),(e=ERe())==null||e.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[kV]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return mD(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return _D(this,e,r),this}watch(e,r,i){return YRe(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){if(this.destroyed){const s=Array.isArray(e)?e:[e];for(const n of s)n.remove();return}let i=this[Hy];i==null&&(i=this[Hy]=new Mi),i.add(e,r)}removeHandles(e){const r=this[Hy];r!=null&&r.remove(e)}removeAllHandles(){const e=this[Hy];e!=null&&e.removeAll()}hasHandles(e){const r=this[Hy];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};rde=Hy,ide=kV;const tQ=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()});let x$=class nde{constructor(){this._emitter=new nde.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return V2(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([R("esri.core.Evented")],s),s};let r=class extends xe{constructor(){super(...arguments),this._emitter=new x$.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([R("esri.core.Evented")],r),t.EventedAccessor=r})(x$||(x$={}));const Ls=x$;var ii;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(ii||(ii={}));function YH(t){return(e,r)=>{e[r]=t}}let e5=class extends whe{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var rg;let PPe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const yu=new Uo(PPe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),MPe=()=>{};function R6(t){return t?t instanceof U1?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function P6(t){if(t&&t.length)return t[0]}function IPe(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function ode(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),ode(t,r.call(i,s,n,o),r,i)})}const cy=new Set,uy=new Set,hy=new Set,M6=new Map;let $Pe=0,U1=rg=class extends Ls.EventedAccessor{static isCollection(t){return t!=null&&t instanceof rg}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new e5,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:$Pe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof rg?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Xt(this._observable),this._items}set items(t){this._emitBeforeChanges(ii.ADD)||(this._splice(0,this.length,R6(t)),this._emitAfterChanges(ii.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=MPe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(Xt(this._observable),this._emitBeforeChanges(ii.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(ii.ADD),this}addMany(t,e=this._items.length){if(Xt(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(ii.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,R6(t)),this._emitAfterChanges(ii.ADD),this}at(t){if(Xt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ii.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(ii.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Xt(this._observable),this._createNewInstance({items:this._items.map(K)})}concat(...t){Xt(this._observable);const e=t.map(R6);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ii.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(ii.REMOVE)}every(t,e){return Xt(this._observable),this._items.every(t,e)}filter(t,e){let r;return Xt(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Xt(this._observable),this._items.find(t,e)}findIndex(t,e){return Xt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Xt(this._observable);const r=[];return ode(r,this,t,e),new rg(r)}forEach(t,e){return Xt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Xt(this._observable),this._items[t]}getNextIndex(t){Xt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Xt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Xt(this._observable),this._items.indexOf(t,e)}join(t=","){return Xt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Xt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Xt(this._observable);const r=this._items.map(t,e);return new rg({items:r})}reorder(t,e=this.length-1){Xt(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(ii.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(ii.MOVE)}return t}}pop(){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ii.REMOVE))return;const t=P6(this._splice(this.length-1,1));return this._emitAfterChanges(ii.REMOVE),t}push(...t){return Xt(this._observable),this._emitBeforeChanges(ii.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(ii.ADD)),this.length}reduce(t,e){Xt(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Xt(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Xt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Xt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(ii.REMOVE))return;const e=P6(this._splice(t,1));return this._emitAfterChanges(ii.REMOVE),e}removeMany(t){if(Xt(this._observable),!t||!t.length||this._emitBeforeChanges(ii.REMOVE))return[];const e=t instanceof rg?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+IPe(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(ii.REMOVE),i}reverse(){if(Xt(this._observable),this._emitBeforeChanges(ii.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(ii.MOVE),this}shift(){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ii.REMOVE))return;const t=P6(this._splice(0,1));return this._emitAfterChanges(ii.REMOVE),t}slice(t=0,e=this.length){return Xt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Xt(this._observable),this._items.some(t,e)}sort(t){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ii.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(ii.MOVE),this}splice(t,e,...r){Xt(this._observable);const i=(e?ii.REMOVE:0)|(r.length?ii.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return Xt(this._observable),this._items.slice()}toJSON(){return Xt(this._observable),this.toArray()}toLocaleString(){return Xt(this._observable),this._items.toLocaleString()}toString(){return Xt(this._observable),this._items.toString()}unshift(...t){return Xt(this._observable),!t.length||this._emitBeforeChanges(ii.ADD)||(this._splice(0,0,t),this._emitAfterChanges(ii.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=US(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=yu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);yu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=yu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);yu.release(a)}}if(r&&r.length){if(s){const h=[];for(const d of r){const f=s.ensureType(d);f==null&&d!=null||h.push(f)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=yu.acquire();h.target=this,h.cancellable=!0;const d=yu.acquire();d.target=this,d.cancellable=!1;for(const f of r)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),l&&(d.reset(f),this.emit("after-add",d)))):(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),d.reset(f),this.emit("after-add",d));yu.release(d),yu.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=yu.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,yu.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=yu.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),yu.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;cy.clear(),uy.clear(),hy.clear();for(const{added:l,removed:c}of r){if(l)if(hy.size===0&&uy.size===0)for(const h of l)cy.add(h);else for(const h of l)uy.has(h)?(hy.add(h),uy.delete(h)):hy.has(h)||cy.add(h);if(c)if(hy.size===0&&cy.size===0)for(const h of c)uy.add(h);else for(const h of c)cy.has(h)?cy.delete(h):(hy.delete(h),uy.add(h))}const i=sc.acquire();cy.forEach(l=>{i.push(l)});const s=sc.acquire();uy.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=sc.acquire();if(hy.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const d=e.listeners[h];d.removed||d.callback.call(this,l)}}sc.release(i),sc.release(s),sc.release(a)}cy.clear(),uy.clear(),hy.clear()}};U1.ofType=t=>{if(!t)return rg;if(M6.has(t))return M6.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends rg{};return u([YH({Type:t,ensureType:typeof t=="function"?qs(t):tp(t)})],r.prototype,"itemType",void 0),r=u([R(`esri.core.Collection<${e}>`)],r),M6.set(t,r),r},u([p()],U1.prototype,"length",void 0),u([p()],U1.prototype,"items",null),U1=rg=u([R("esri.core.Collection")],U1);const Mt=U1;function Lb(t,e,r=Mt){return e||(e=new r),e===t||(e.removeAll(),LPe(t)?e.addMany(t):t&&e.add(t)),e}function ade(t){return t}function LPe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const rQ=new Set;function DPe(t,e,r=!1){r&&rQ.has(e)||(r&&rQ.add(e),t.warn(`🛑 DEPRECATED - ${e}`))}function Nd(t,e,r={}){if(oe("esri-deprecation-warnings")){const{moduleName:i}=r;OD(t,`Property: ${(i?i+"::":"")+e}`,r)}}function OD(t,e,r={}){if(oe("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	🛠️ Replacement: ${i}`),s&&(a+=`
	⚙️ Version: ${s}`),n&&(a+=`
	🔗 See ${n} for more details.`),DPe(t,a,o)}}let NPe=class lde{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new lde;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,K(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??hr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===hr.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(e,new FPe(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===hr.DEFAULTS?e:hr.USER}},FPe=class{constructor(e,r){this.value=e,this.origin=r}};function cde(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),hr.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),hr.DEFAULTS)})}function UPe(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&NJ(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&NJ(s,r))return!0;return!1}function VPe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function zPe(t,e,r,i,s){let n=VV(e[r],s);VPe(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=VV(e[o],s),UPe(n,r,i)&&(t[o]=!0)}function kPe(t,e,r,i){const s=r.metadatas,n=xPe(s[e],i),o=n==null?void 0:n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const ude={origin:"service"};function hde(t,e,r=ude){if(!e||typeof e!="object")return;const i=la(t),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))zPe(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=VV(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?lR(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||kPe(t,o,i,r)}i.setDefaultOrigin("user")}function BPe(t,e,r,i=ude){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function GPe(t,e,r,i,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,n,r,s),n}function dde(t,e,r,i,s,n){if(!i||!i.write)return!1;const o=t.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new U("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&Q.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===hr.DEFAULTS)&&jPe(t,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<lg(n.origin))}function jPe(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r??void 0);return Og(o,s)}return!1}return n===s}function HPe(t,e,r,i){const s=la(t),n=s.metadatas,o=ede(n[e],i);return!!o&&dde(t,s,e,o,r,i)}function pde(t,e,r){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return y$(e,t.toJSON(r));const i=la(t),s=i.metadatas;for(const a in s){const l=ede(s[a],r);if(!dde(t,i,a,l,void 0,r))continue;const c=t.get(a),h=GPe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(h).length>0&&(e=y$(e,h),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>y$(e,h,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:dRe(i.store.originOf(a)),newOrigin:r.origin}))}return e}const zS=t=>{let e=class extends t{constructor(...r){super(...r);const i=la(this),s=i.store,n=new NPe;i.store=n,cde(i,s,n)}read(r,i){hde(this,r,i)}write(r,i){return pde(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return qPe.call(this,r,i)}};return e=u([R("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function qPe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let de=class extends zS(xe){};de=u([R("esri.core.JSONSupport")],de);var T0;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(T0||(T0={}));let WPe=class{constructor(){this._resolver=yo(),this._status=T0.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=T0.RESOLVED,this._cleanUp()},()=>{this._status=T0.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===T0.RESOLVED}isRejected(){return this._status===T0.REJECTED}isFulfilled(){return this._status!==T0.PENDING}abort(){this._resolver.reject(Dr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=yo(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||ys(s)||this._resolver.reject(s)}),e.resolve()}};const t5=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new WPe,this.addResolvingPromise(Promise.resolve())}destroy(){var r;(r=this._promiseProps)==null||r.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=u([R("esri.core.Promise")],e),e};let RD=class extends t5(xe){};RD=u([R("esri.core.Promise")],RD);const ZPe="not-loaded",XPe="loading",YPe="failed",iQ="loaded",fde=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=BH(n,l);this.destroyed&&l(new U("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===ZPe){this._set("loadStatus",XPe);const a=this._loadController=new AbortController;s({signal:a.signal}),oa(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",iQ),this._loadController=null},i=>{this._set("loadStatus",YPe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=lu(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===iQ}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new U("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return u([p({readOnly:!0})],e.prototype,"loaded",null),u([p({readOnly:!0})],e.prototype,"loadError",void 0),u([p({clonable:!1})],e.prototype,"loadStatus",void 0),u([p({type:[yh],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([R("esri.core.Loadable")],e),e};let OC=class extends fde(RD){};OC=u([R("esri.core.Loadable")],OC),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=fde,t.isLoadable=e}(OC||(OC={}));const Pg=OC;function r5(t,e,r){return Zf(t.map((i,s)=>e.apply(r,[i,s])))}async function JPe(t,e,r){return(await Zf(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function JH(t){return{ok:!0,value:t}}function QH(t){return{ok:!1,error:t}}function QPe(t){return t!=null&&t.ok===!0?t.value:null}function KPe(t){return t!=null&&t.ok===!1?t.error:null}async function uu(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return JH(await t)}catch(e){return QH(e)}}async function NTt(t){try{return JH(await t)}catch(e){return Io(e),QH(e)}}function FTt(t){if(t.ok===!0)return t.value;throw t.error}function kS(t,e){return new qy(t,e)}let qy=class extends xe{get value(){return QPe(this._result)}get error(){return KPe(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=lu(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=JH(s),this._cleanup()},s=>{this._result=QH(s),this._cleanup()}),this._abortHandle=oa(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Di(this._abortHandle),this._abortController=null}};u([p()],qy.prototype,"value",null),u([p()],qy.prototype,"error",null),u([p()],qy.prototype,"finished",null),u([p()],qy.prototype,"promise",void 0),u([p()],qy.prototype,"_result",void 0),qy=u([R("esri.core.asyncUtils.ReactiveTask")],qy);async function mde(t,e){return await t.load(),eMe(t,e)}async function eMe(t,e){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):Mt.isCollection(o)?o.forEach(a=>i(a)):Pg.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await JPe(r,async n=>{const o=await uu(tMe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function tMe(t){return"loadAll"in t&&typeof t.loadAll=="function"}const rMe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,iMe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function sQ(t){const e=t==null?void 0:t.match(rMe);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=iMe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function sMe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function nMe(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}const oMe=Q.getLogger("esri.core.urlUtils"),BS=Yr.request,nQ="esri/config: esriConfig.request.proxyUrl is not set.",gde=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,yde=/^\s*http:/i,aMe=/^\s*https:/i,lMe=/^\s*file:/i,cMe=/:\d+$/,uMe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,hMe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),dMe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let u2=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(hMe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(dMe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const fP={},pMe=new u2(Yr.applicationUrl);let Fa=pMe;const fMe=mMe();let KH=fMe;const eq=()=>Fa,zTt=()=>KH;function mMe(){const t=Fa.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Fa.scheme}://${Fa.host}${Fa.port!=null?`:${Fa.port}`:""}`}${e}`}function _o(t){if(!t)return null;const e={path:null,query:null},r=new u2(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=tq(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function tq(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function oQ(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function lO(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e&&e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>oQ(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):oQ(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function gMe(t=!1){let e,r=BS.proxyUrl;if(typeof t=="string"){e=xMe(t);const i=i5(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw oMe.warn(nQ),new U("urlutils:proxy-not-set",nQ);return e&&BV()&&(r=aq(r)),_o(r)}function kTt(t){const e=i5(t);let r,i;if(e){const s=rq(e.proxyUrl);r=s.path,i=s.query?tq(s.query):null}if(r){const s=_o(t);t=r+"?"+s.path;const n=lO({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const bE={path:"",query:""};function rq(t){const e=t.indexOf("?");return e!==-1?(bE.path=t.slice(0,e),bE.query=t.slice(e+1)):(bE.path=t,bE.query=null),bE}function _de(t){return t=(t=MD(t=AMe(t=rq(t).path),!0)).toLowerCase()}function yMe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:_de(t.urlPrefix)},r=BS.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function i5(t){const e=BS.proxyRules,r=_de(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function _Me(t,e){if(!t||!e)return!1;t=PD(t),e=PD(e);const r=sQ(t),i=sQ(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&B2(t,e,!0)}function vde(t,e){return t=PD(t),e=PD(e),MD(t)===MD(e)}function PD(t){const e=(t=Hd(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function bde(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=BS.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function B2(t,e,r=!1){if(!t||!e)return!1;const i=jV(t),s=jV(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function iq(t){if(typeof t=="string"){if(!fc(t))return!0;t=jV(t)}if(B2(t,Fa))return!0;const e=BS.trustedServers||[];for(let r=0;r<e.length;r++){const i=vMe(e[r]);for(let s=0;s<i.length;s++)if(B2(t,i[s]))return!0}return!1}function vMe(t){return fP[t]||(oq(t)||Df(t)?fP[t]=[new u2(Jc(t))]:fP[t]=[new u2(`http://${t}`),new u2(`https://${t}`)]),fP[t]}function Jc(t,e=KH,r){return Df(t)?r&&r.preserveProtocolRelative?t:Fa.scheme==="http"&&Fa.authority===qd(t).slice(2)?`http:${t}`:`https:${t}`:oq(t)?t:_c(t[0]==="/"?CMe(e):e,t)}function sq(t,e=KH,r){if(t==null||!fc(t))return t;const i=Hd(t),s=i.toLowerCase(),n=Hd(e).toLowerCase().replace(/\/+$/,""),o=r?Hd(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,f,m)=>(m=d.indexOf(f,m))===-1?d.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const h=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let d=0;d<h;d++)t=`../${t}`;else t=`./${t}`;return t}function Hd(t){return t=PMe(t=RMe(t=OMe(t=Jc(t=t.trim()))))}function _c(...t){const e=t.filter(fw);if(!e||!e.length)return;const r=[];if(fc(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),SMe(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function qd(t,e=!1){if(t==null||f_(t)||Xf(t))return null;let r=t.indexOf("://");if(r===-1&&Df(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=MD(t,!0)),t}function fc(t){return Df(t)||oq(t)}function f_(t){return t!=null&&t.slice(0,5)==="blob:"}function Xf(t){return t!=null&&t.slice(0,5)==="data:"}function nq(t){const e=Db(t);return e&&e.isBase64?nMe(e.data):null}function BTt(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const bMe=/^data:(.*?)(;base64)?,(.*)$/;function Db(t){const e=t.match(bMe);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function wde(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function GTt(t){const e=nq(t);if(!e)return null;const r=Db(t);return new Blob([e],{type:r.mediaType})}function jTt(t,e){wMe(t,e)}function wMe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function Df(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function oq(t){return t!=null&&gde.test(t)}function xMe(t){return t!=null&&aMe.test(t)||Fa.scheme==="https"&&Df(t)}function TMe(t){return t!=null&&yde.test(t)||Fa.scheme==="http"&&Df(t)}function SMe(t){return t!=null&&lMe.test(t)}function aq(t){return Df(t)?`https:${t}`:t.replace(yde,"https:")}function EMe(){return Fa.scheme==="http"}function BV(){return Fa.scheme==="https"}function MD(t,e=!1){return Df(t)?t.slice(2):(t=t.replace(gde,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function CMe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function lq(t){let e=0;if(fc(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function HTt(t,e){if(!t)return"";const r=_o(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function AMe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function xde(t){return t.replace(/\/+$/,"")}function OMe(t){if(/^https?:\/\//i.test(t)){const e=rq(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function RMe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function PMe(t){const e=BS.httpsDomains;if(!TMe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),cMe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return EMe()&&i===Fa.authority&&!uMe.test(t)||(BV()&&i===Fa.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||BV()&&!i5(t))&&(t=aq(t)),t}function GV(t,e,r){if(!(e&&r&&t&&fc(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function jV(t){return typeof t=="string"?new u2(Jc(t)):(t.scheme||(t.scheme=Fa.scheme),t)}function Tde(t){return MMe.test(t)}function Sde(t,e){const r=_o(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function Ede(t,e,r){const i=_o(t),s=i.query||{};return s[e]=String(r),`${i.path}?${lO(s)}`}function I6(t,e){const r=_o(t),i=r.query||{};for(const n in e)i[n]=e[n];const s=lO(i);return s?`${r.path}?${s}`:r.path}function cq(t){if(t==null)return null;const e=t.match(Cde);return e?e[2]:null}function aQ(t){if(t==null)return null;const e=t.match(Cde);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function qTt(t){return typeof t=="string"?Db(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(Db(i.result)),i.onerror=s=>r(s)})}const Cde=/([^.]*)\.([^\/]*)$/,MMe=/(^data:image\/svg|\.svg$)/i;function De(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=qH(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let Rr=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&Ha(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function Wa(){return function(t,e){return new Rr(t,{ignoreUnknown:!0,...e})}}let uq=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const sr=new uq(6378137,1/298.257223563,3e5,.006694379990137799),Tf=new uq(3396190,1/169.8944472236118,23e4),Mg=new uq(1737400,0,0);var oh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(oh||(oh={}));let g;const I={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)I[g]=0;for(g=2056;g<=2065;g++)I[g]=0;for(g=2067;g<=2135;g++)I[g]=0;for(g=2137;g<=2154;g++)I[g]=0;for(g=2161;g<=2170;g++)I[g]=0;for(g=2172;g<=2193;g++)I[g]=0;for(g=2195;g<=2198;g++)I[g]=0;for(g=2200;g<=2203;g++)I[g]=0;for(g=2205;g<=2217;g++)I[g]=0;for(g=2222;g<=2224;g++)I[g]=1;for(g=2225;g<=2250;g++)I[g]=2;for(g=2251;g<=2253;g++)I[g]=1;for(g=2257;g<=2264;g++)I[g]=2;for(g=2274;g<=2279;g++)I[g]=2;for(g=2280;g<=2282;g++)I[g]=1;for(g=2283;g<=2289;g++)I[g]=2;for(g=2290;g<=2292;g++)I[g]=0;for(g=2308;g<=2313;g++)I[g]=0;for(g=2315;g<=2491;g++)I[g]=0;for(g=2494;g<=2866;g++)I[g]=0;for(g=2867;g<=2869;g++)I[g]=1;for(g=2870;g<=2888;g++)I[g]=2;for(g=2891;g<=2895;g++)I[g]=2;for(g=2896;g<=2898;g++)I[g]=1;for(g=2902;g<=2908;g++)I[g]=2;for(g=2915;g<=2920;g++)I[g]=2;for(g=2921;g<=2923;g++)I[g]=1;for(g=2924;g<=2930;g++)I[g]=2;for(g=2931;g<=2962;g++)I[g]=0;for(g=2964;g<=2968;g++)I[g]=2;for(g=2969;g<=2973;g++)I[g]=0;for(g=2975;g<=2991;g++)I[g]=0;for(g=2995;g<=3051;g++)I[g]=0;for(g=3054;g<=3079;g++)I[g]=0;for(g=3081;g<=3088;g++)I[g]=0;for(g=3092;g<=3101;g++)I[g]=0;for(g=3106;g<=3138;g++)I[g]=0;for(g=3146;g<=3151;g++)I[g]=0;for(g=3153;g<=3166;g++)I[g]=0;for(g=3168;g<=3172;g++)I[g]=0;for(g=3174;g<=3203;g++)I[g]=0;for(g=3294;g<=3358;g++)I[g]=0;for(g=3367;g<=3403;g++)I[g]=0;for(g=3408;g<=3416;g++)I[g]=0;for(g=3417;g<=3438;g++)I[g]=2;for(g=3441;g<=3446;g++)I[g]=2;for(g=3447;g<=3450;g++)I[g]=0;for(g=3451;g<=3459;g++)I[g]=2;for(g=3460;g<=3478;g++)I[g]=0;for(g=3554;g<=3559;g++)I[g]=0;for(g=3560;g<=3570;g++)I[g]=2;for(g=3571;g<=3581;g++)I[g]=0;for(g=3594;g<=3597;g++)I[g]=0;for(g=3601;g<=3604;g++)I[g]=0;for(g=3637;g<=3639;g++)I[g]=0;for(g=3665;g<=3667;g++)I[g]=0;for(g=3693;g<=3695;g++)I[g]=0;for(g=3701;g<=3727;g++)I[g]=0;for(g=3728;g<=3739;g++)I[g]=2;for(g=3740;g<=3751;g++)I[g]=0;for(g=3753;g<=3760;g++)I[g]=2;for(g=3761;g<=3773;g++)I[g]=0;for(g=3775;g<=3777;g++)I[g]=0;for(g=3779;g<=3781;g++)I[g]=0;for(g=3783;g<=3785;g++)I[g]=0;for(g=3788;g<=3791;g++)I[g]=0;for(g=3797;g<=3802;g++)I[g]=0;for(g=3814;g<=3816;g++)I[g]=0;for(g=3825;g<=3829;g++)I[g]=0;for(g=3832;g<=3841;g++)I[g]=0;for(g=3844;g<=3852;g++)I[g]=0;for(g=3873;g<=3885;g++)I[g]=0;for(g=3890;g<=3893;g++)I[g]=0;for(g=3907;g<=3912;g++)I[g]=0;for(g=3942;g<=3950;g++)I[g]=0;for(g=3968;g<=3970;g++)I[g]=0;for(g=3973;g<=3976;g++)I[g]=0;for(g=3986;g<=3989;g++)I[g]=0;for(g=3994;g<=3997;g++)I[g]=0;for(g=4048;g<=4051;g++)I[g]=0;for(g=4056;g<=4063;g++)I[g]=0;for(g=4093;g<=4096;g++)I[g]=0;for(g=4390;g<=4398;g++)I[g]=0;for(g=4399;g<=4413;g++)I[g]=2;for(g=4418;g<=4433;g++)I[g]=2;for(g=4455;g<=4457;g++)I[g]=2;for(g=4484;g<=4489;g++)I[g]=0;for(g=4491;g<=4554;g++)I[g]=0;for(g=4568;g<=4589;g++)I[g]=0;for(g=4652;g<=4656;g++)I[g]=0;for(g=4766;g<=4800;g++)I[g]=0;for(g=5014;g<=5016;g++)I[g]=0;for(g=5069;g<=5072;g++)I[g]=0;for(g=5105;g<=5130;g++)I[g]=0;for(g=5173;g<=5188;g++)I[g]=0;for(g=5253;g<=5259;g++)I[g]=0;for(g=5269;g<=5275;g++)I[g]=0;for(g=5292;g<=5311;g++)I[g]=0;for(g=5329;g<=5331;g++)I[g]=0;for(g=5343;g<=5349;g++)I[g]=0;for(g=5355;g<=5357;g++)I[g]=0;for(g=5387;g<=5389;g++)I[g]=0;for(g=5459;g<=5463;g++)I[g]=0;for(g=5479;g<=5482;g++)I[g]=0;for(g=5518;g<=5520;g++)I[g]=0;for(g=5530;g<=5539;g++)I[g]=0;for(g=5550;g<=5552;g++)I[g]=0;for(g=5562;g<=5583;g++)I[g]=0;for(g=5623;g<=5625;g++)I[g]=2;for(g=5631;g<=5639;g++)I[g]=0;for(g=5649;g<=5653;g++)I[g]=0;for(g=5663;g<=5680;g++)I[g]=0;for(g=5682;g<=5685;g++)I[g]=0;for(g=5875;g<=5877;g++)I[g]=0;for(g=5896;g<=5899;g++)I[g]=0;for(g=5921;g<=5940;g++)I[g]=0;for(g=6050;g<=6125;g++)I[g]=0;for(g=6244;g<=6275;g++)I[g]=0;for(g=6328;g<=6348;g++)I[g]=0;for(g=6350;g<=6356;g++)I[g]=0;for(g=6366;g<=6372;g++)I[g]=0;for(g=6381;g<=6387;g++)I[g]=0;for(g=6393;g<=6404;g++)I[g]=0;for(g=6480;g<=6483;g++)I[g]=0;for(g=6511;g<=6514;g++)I[g]=0;for(g=6579;g<=6581;g++)I[g]=0;for(g=6619;g<=6624;g++)I[g]=0;for(g=6625;g<=6627;g++)I[g]=2;for(g=6628;g<=6632;g++)I[g]=0;for(g=6634;g<=6637;g++)I[g]=0;for(g=6669;g<=6692;g++)I[g]=0;for(g=6707;g<=6709;g++)I[g]=0;for(g=6720;g<=6723;g++)I[g]=0;for(g=6732;g<=6738;g++)I[g]=0;for(g=6931;g<=6933;g++)I[g]=0;for(g=6956;g<=6959;g++)I[g]=0;for(g=7005;g<=7007;g++)I[g]=0;for(g=7057;g<=7070;g++)I[g]=2;for(g=7074;g<=7082;g++)I[g]=0;for(g=7109;g<=7118;g++)I[g]=0;for(g=7119;g<=7127;g++)I[g]=1;for(g=7374;g<=7376;g++)I[g]=0;for(g=7528;g<=7586;g++)I[g]=0;for(g=7587;g<=7645;g++)I[g]=2;for(g=7692;g<=7696;g++)I[g]=0;for(g=7755;g<=7787;g++)I[g]=0;for(g=7791;g<=7795;g++)I[g]=0;for(g=7799;g<=7801;g++)I[g]=0;for(g=7803;g<=7805;g++)I[g]=0;for(g=7825;g<=7831;g++)I[g]=0;for(g=7845;g<=7859;g++)I[g]=0;for(g=8013;g<=8032;g++)I[g]=0;for(g=8065;g<=8068;g++)I[g]=1;for(g=8518;g<=8529;g++)I[g]=2;for(g=8533;g<=8536;g++)I[g]=2;for(g=8538;g<=8540;g++)I[g]=2;for(g=8677;g<=8679;g++)I[g]=0;for(g=8836;g<=8840;g++)I[g]=0;for(g=8857;g<=8859;g++)I[g]=0;for(g=8908;g<=8910;g++)I[g]=0;for(g=9154;g<=9159;g++)I[g]=0;for(g=9205;g<=9218;g++)I[g]=0;for(g=9271;g<=9273;g++)I[g]=0;for(g=9295;g<=9297;g++)I[g]=0;for(g=9356;g<=9360;g++)I[g]=0;for(g=9404;g<=9407;g++)I[g]=0;for(g=9476;g<=9482;g++)I[g]=0;for(g=9487;g<=9494;g++)I[g]=0;for(g=9697;g<=9699;g++)I[g]=0;for(g=9821;g<=9865;g++)I[g]=0;for(g=20002;g<=20032;g++)I[g]=0;for(g=20047;g<=20049;g++)I[g]=0;for(g=20062;g<=20092;g++)I[g]=0;for(g=20135;g<=20138;g++)I[g]=0;for(g=20248;g<=20258;g++)I[g]=0;for(g=20348;g<=20358;g++)I[g]=0;for(g=20436;g<=20440;g++)I[g]=0;for(g=20822;g<=20824;g++)I[g]=0;for(g=20904;g<=20932;g++)I[g]=0;for(g=20934;g<=20936;g++)I[g]=0;for(g=21004;g<=21032;g++)I[g]=0;for(g=21035;g<=21037;g++)I[g]=0;for(g=21095;g<=21097;g++)I[g]=0;for(g=21148;g<=21150;g++)I[g]=0;for(g=21207;g<=21264;g++)I[g]=0;for(g=21307;g<=21364;g++)I[g]=0;for(g=21413;g<=21423;g++)I[g]=0;for(g=21453;g<=21463;g++)I[g]=0;for(g=21473;g<=21483;g++)I[g]=0;for(g=21780;g<=21782;g++)I[g]=0;for(g=21891;g<=21894;g++)I[g]=0;for(g=21896;g<=21899;g++)I[g]=0;for(g=22171;g<=22177;g++)I[g]=0;for(g=22181;g<=22187;g++)I[g]=0;for(g=22191;g<=22197;g++)I[g]=0;for(g=22207;g<=22222;g++)I[g]=0;for(g=22234;g<=22236;g++)I[g]=0;for(g=22243;g<=22250;g++)I[g]=0;for(g=22262;g<=22265;g++)I[g]=0;for(g=22307;g<=22322;g++)I[g]=0;for(g=22348;g<=22357;g++)I[g]=0;for(g=22407;g<=22422;g++)I[g]=0;for(g=22462;g<=22465;g++)I[g]=0;for(g=22521;g<=22525;g++)I[g]=0;for(g=22607;g<=22622;g++)I[g]=0;for(g=22641;g<=22646;g++)I[g]=0;for(g=22648;g<=22657;g++)I[g]=0;for(g=22707;g<=22722;g++)I[g]=0;for(g=22762;g<=22765;g++)I[g]=0;for(g=22991;g<=22994;g++)I[g]=0;for(g=23028;g<=23038;g++)I[g]=0;for(g=23830;g<=23853;g++)I[g]=0;for(g=23866;g<=23872;g++)I[g]=0;for(g=23877;g<=23884;g++)I[g]=0;for(g=23886;g<=23894;g++)I[g]=0;for(g=23946;g<=23948;g++)I[g]=0;for(g=24311;g<=24313;g++)I[g]=0;for(g=24342;g<=24347;g++)I[g]=0;for(g=24370;g<=24374;g++)I[g]=10;for(g=24375;g<=24381;g++)I[g]=0;for(g=24718;g<=24721;g++)I[g]=0;for(g=24817;g<=24821;g++)I[g]=0;for(g=24877;g<=24882;g++)I[g]=0;for(g=24891;g<=24893;g++)I[g]=0;for(g=25391;g<=25395;g++)I[g]=0;for(g=25828;g<=25838;g++)I[g]=0;for(g=26191;g<=26195;g++)I[g]=0;for(g=26391;g<=26393;g++)I[g]=0;for(g=26701;g<=26722;g++)I[g]=0;for(g=26729;g<=26799;g++)I[g]=2;for(g=26801;g<=26803;g++)I[g]=2;for(g=26811;g<=26813;g++)I[g]=2;for(g=26847;g<=26870;g++)I[g]=2;for(g=26891;g<=26899;g++)I[g]=0;for(g=26901;g<=26923;g++)I[g]=0;for(g=26929;g<=26946;g++)I[g]=0;for(g=26948;g<=26998;g++)I[g]=0;for(g=27037;g<=27040;g++)I[g]=0;for(g=27205;g<=27232;g++)I[g]=0;for(g=27258;g<=27260;g++)I[g]=0;for(g=27391;g<=27398;g++)I[g]=0;for(g=27561;g<=27564;g++)I[g]=0;for(g=27571;g<=27574;g++)I[g]=0;for(g=27581;g<=27584;g++)I[g]=0;for(g=27591;g<=27594;g++)I[g]=0;for(g=28191;g<=28193;g++)I[g]=0;for(g=28348;g<=28358;g++)I[g]=0;for(g=28402;g<=28432;g++)I[g]=0;for(g=28462;g<=28492;g++)I[g]=0;for(g=29118;g<=29122;g++)I[g]=0;for(g=29168;g<=29172;g++)I[g]=0;for(g=29177;g<=29185;g++)I[g]=0;for(g=29187;g<=29195;g++)I[g]=0;for(g=29900;g<=29903;g++)I[g]=0;for(g=30161;g<=30179;g++)I[g]=0;for(g=30491;g<=30494;g++)I[g]=0;for(g=30729;g<=30732;g++)I[g]=0;for(g=31251;g<=31259;g++)I[g]=0;for(g=31265;g<=31268;g++)I[g]=0;for(g=31275;g<=31279;g++)I[g]=0;for(g=31281;g<=31297;g++)I[g]=0;for(g=31461;g<=31469;g++)I[g]=0;for(g=31491;g<=31495;g++)I[g]=0;for(g=31917;g<=31922;g++)I[g]=0;for(g=31965;g<=32e3;g++)I[g]=0;for(g=32001;g<=32003;g++)I[g]=2;for(g=32005;g<=32031;g++)I[g]=2;for(g=32033;g<=32060;g++)I[g]=2;for(g=32064;g<=32067;g++)I[g]=2;for(g=32074;g<=32077;g++)I[g]=2;for(g=32081;g<=32086;g++)I[g]=0;for(g=32107;g<=32130;g++)I[g]=0;for(g=32133;g<=32159;g++)I[g]=0;for(g=32164;g<=32167;g++)I[g]=2;for(g=32180;g<=32199;g++)I[g]=0;for(g=32201;g<=32260;g++)I[g]=0;for(g=32301;g<=32360;g++)I[g]=0;for(g=32601;g<=32662;g++)I[g]=0;for(g=32664;g<=32667;g++)I[g]=2;for(g=32701;g<=32761;g++)I[g]=0;for(g=53001;g<=53004;g++)I[g]=0;for(g=53008;g<=53019;g++)I[g]=0;for(g=53021;g<=53032;g++)I[g]=0;for(g=53034;g<=53037;g++)I[g]=0;for(g=53042;g<=53046;g++)I[g]=0;for(g=53074;g<=53080;g++)I[g]=0;for(g=54001;g<=54004;g++)I[g]=0;for(g=54008;g<=54019;g++)I[g]=0;for(g=54021;g<=54032;g++)I[g]=0;for(g=54034;g<=54037;g++)I[g]=0;for(g=54042;g<=54046;g++)I[g]=0;for(g=54048;g<=54053;g++)I[g]=0;for(g=54074;g<=54080;g++)I[g]=0;for(g=54098;g<=54101;g++)I[g]=0;for(g=102001;g<=102040;g++)I[g]=0;for(g=102042;g<=102063;g++)I[g]=0;for(g=102065;g<=102067;g++)I[g]=0;for(g=102070;g<=102117;g++)I[g]=0;for(g=102122;g<=102216;g++)I[g]=0;for(g=102221;g<=102377;g++)I[g]=0;for(g=102382;g<=102388;g++)I[g]=0;for(g=102389;g<=102398;g++)I[g]=2;for(g=102399;g<=102444;g++)I[g]=0;for(g=102445;g<=102447;g++)I[g]=2;for(g=102448;g<=102458;g++)I[g]=0;for(g=102459;g<=102468;g++)I[g]=2;for(g=102469;g<=102499;g++)I[g]=0;for(g=102500;g<=102519;g++)I[g]=1;for(g=102520;g<=102524;g++)I[g]=0;for(g=102525;g<=102529;g++)I[g]=2;for(g=102530;g<=102588;g++)I[g]=0;for(g=102590;g<=102598;g++)I[g]=0;for(g=102601;g<=102603;g++)I[g]=0;for(g=102605;g<=102628;g++)I[g]=0;for(g=102629;g<=102646;g++)I[g]=2;for(g=102648;g<=102700;g++)I[g]=2;for(g=102701;g<=102703;g++)I[g]=0;for(g=102707;g<=102730;g++)I[g]=2;for(g=102733;g<=102758;g++)I[g]=2;for(g=102767;g<=102900;g++)I[g]=0;for(g=102901;g<=102933;g++)I[g]=2;for(g=102934;g<=102950;g++)I[g]=13;for(g=102951;g<=102955;g++)I[g]=0;for(g=102961;g<=102963;g++)I[g]=0;for(g=102965;g<=102969;g++)I[g]=0;for(g=102971;g<=102973;g++)I[g]=0;for(g=102975;g<=102989;g++)I[g]=0;for(g=102990;g<=102992;g++)I[g]=1;for(g=102997;g<=103002;g++)I[g]=0;for(g=103003;g<=103008;g++)I[g]=2;for(g=103009;g<=103011;g++)I[g]=0;for(g=103012;g<=103014;g++)I[g]=2;for(g=103019;g<=103021;g++)I[g]=0;for(g=103022;g<=103024;g++)I[g]=2;for(g=103029;g<=103031;g++)I[g]=0;for(g=103032;g<=103034;g++)I[g]=2;for(g=103065;g<=103068;g++)I[g]=0;for(g=103074;g<=103076;g++)I[g]=0;for(g=103077;g<=103079;g++)I[g]=1;for(g=103080;g<=103082;g++)I[g]=0;for(g=103083;g<=103085;g++)I[g]=2;for(g=103090;g<=103093;g++)I[g]=0;for(g=103097;g<=103099;g++)I[g]=0;for(g=103100;g<=103102;g++)I[g]=2;for(g=103107;g<=103109;g++)I[g]=0;for(g=103110;g<=103112;g++)I[g]=2;for(g=103113;g<=103116;g++)I[g]=0;for(g=103117;g<=103120;g++)I[g]=2;for(g=103153;g<=103157;g++)I[g]=0;for(g=103158;g<=103162;g++)I[g]=2;for(g=103163;g<=103165;g++)I[g]=0;for(g=103166;g<=103168;g++)I[g]=1;for(g=103169;g<=103171;g++)I[g]=2;for(g=103186;g<=103188;g++)I[g]=0;for(g=103189;g<=103191;g++)I[g]=2;for(g=103192;g<=103195;g++)I[g]=0;for(g=103196;g<=103199;g++)I[g]=2;for(g=103200;g<=103224;g++)I[g]=0;for(g=103225;g<=103227;g++)I[g]=1;for(g=103232;g<=103237;g++)I[g]=0;for(g=103238;g<=103243;g++)I[g]=2;for(g=103244;g<=103246;g++)I[g]=0;for(g=103247;g<=103249;g++)I[g]=2;for(g=103254;g<=103256;g++)I[g]=0;for(g=103257;g<=103259;g++)I[g]=2;for(g=103264;g<=103266;g++)I[g]=0;for(g=103267;g<=103269;g++)I[g]=2;for(g=103300;g<=103375;g++)I[g]=0;for(g=103381;g<=103383;g++)I[g]=0;for(g=103384;g<=103386;g++)I[g]=1;for(g=103387;g<=103389;g++)I[g]=0;for(g=103390;g<=103392;g++)I[g]=2;for(g=103397;g<=103399;g++)I[g]=0;for(g=103400;g<=103471;g++)I[g]=2;for(g=103476;g<=103478;g++)I[g]=0;for(g=103479;g<=103481;g++)I[g]=2;for(g=103486;g<=103488;g++)I[g]=0;for(g=103489;g<=103491;g++)I[g]=2;for(g=103492;g<=103495;g++)I[g]=0;for(g=103496;g<=103499;g++)I[g]=2;for(g=103528;g<=103543;g++)I[g]=0;for(g=103544;g<=103548;g++)I[g]=2;for(g=103549;g<=103551;g++)I[g]=0;for(g=103552;g<=103554;g++)I[g]=1;for(g=103555;g<=103557;g++)I[g]=2;for(g=103558;g<=103560;g++)I[g]=0;for(g=103571;g<=103573;g++)I[g]=0;for(g=103574;g<=103576;g++)I[g]=2;for(g=103577;g<=103580;g++)I[g]=0;for(g=103581;g<=103583;g++)I[g]=2;for(g=103595;g<=103694;g++)I[g]=0;for(g=103696;g<=103699;g++)I[g]=0;for(g=103700;g<=103793;g++)I[g]=2;for(g=103794;g<=103890;g++)I[g]=0;for(g=103891;g<=103896;g++)I[g]=2;for(g=103900;g<=103971;g++)I[g]=2;for(g=103972;g<=103977;g++)I[g]=0;for(g=112e3;g<=112101;g++)I[g]=0;const IMe={102113:!0,102100:!0,3857:!0,3785:!0},$Me={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},lQ='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',mP=[-20037508342788905e-9,20037508342788905e-9],gP=[-20037508342787e-6,20037508342787e-6],Ade={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:mP,origin:gP,dx:1e-5},102100:{wkTemplate:lQ,valid:mP,origin:gP,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:mP,origin:gP,dx:1e-5},3857:{wkTemplate:lQ,valid:mP,origin:gP,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Tn(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||Nb(t)&&Nb(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function db(t){return sa(t)&&t.wkid&&Ade[t.wkid]||null}function Ode(t){return!!sa(t)&&(t.wkid?I[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function cO(t){return!(Yf(t)||Jf(t))}function uO(t){return sa(t)&&t.wkid===4326}function Rde(t){return sa(t)&&t.wkid===oh.CGCS2000}function Nb(t){return sa(t)&&t.wkid!=null&&IMe[t.wkid]===!0}function hO(t){return sa(t)&&t.wkid===32662}function hq(t){return t===oh.GCSMARS2000||t===oh.GCSMARS2000_SPHERE}function Yf(t){return sa(t)&&t.wkid!=null&&hq(t.wkid)}function dq(t){return t===oh.GCSMOON2000}function Jf(t){return sa(t)&&t.wkid!=null&&dq(t.wkid)}function LMe(t){return sa(t)&&t.wkid!=null&&$Me[t.wkid]===!0}function sa(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const DMe={wkid:4326,wkt:X4(Ade[4326].wkTemplate,{Central_Meridian:"0.0"})},NMe={wkid:102100,latestWkid:3857},FMe={wkid:32662};function pq(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Pde=pq(sr),fq=pq(Tf),mq=pq(Mg),Mde={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${sr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Nr(t){return t!=null&&(Yf(t)||Tn(t,fq))?Tf:t!=null&&(Jf(t)||Tn(t,mq))?Mg:sr}function XTt(t){return hq(t)?Tf:dq(t)?Mg:sr}const gq=39.37,UMe=sr.radius*Math.PI/200,Ide=/UNIT\[([^\]]+)\]\]$/i,pb=I,$de=/UNIT\[([^\]]+)\]/i,VMe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),zMe=Wa()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),mp=t=>t*t,dy=t=>t*t*t,dO={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:mp(.001)},"square-centimeters":{inBaseUnits:mp(.01)},"square-decimeters":{inBaseUnits:mp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:mp(1e3)},"square-inches":{inBaseUnits:mp(.0254)},"square-feet":{inBaseUnits:mp(.3048)},"square-yards":{inBaseUnits:mp(.9144)},"square-miles":{inBaseUnits:mp(1609.344)},"square-us-feet":{inBaseUnits:mp(1200/3937)},acres:{inBaseUnits:.0015625*mp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*dy(.001)},"cubic-centimeters":{inBaseUnits:1e3*dy(.01)},"cubic-decimeters":{inBaseUnits:1e3*dy(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*dy(1e3)},"cubic-inches":{inBaseUnits:1e3*dy(.0254)},"cubic-feet":{inBaseUnits:1e3*dy(.3048)},"cubic-yards":{inBaseUnits:1e3*dy(.9144)},"cubic-miles":{inBaseUnits:1e3*dy(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},kMe=(()=>{const t={};for(const e in dO)for(const r in dO[e].units)t[r]=e;return t})();function BMe(t,e,r){return t*dO[r].units[e].inBaseUnits}function GMe(t,e,r){return t/dO[r].units[e].inBaseUnits}const jMe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function HV(t){const e=kMe[t];if(!e)throw new Error("unknown type");return e}function cQ(t,e=null){return e=e||HV(t),dO[e].baseUnit===t}function Po(t,e,r){if(e===r)return t;const i=HV(e);if(i!==HV(r))throw new Error("incompatible units");const s=cQ(e,i)?t:BMe(t,e,i);return cQ(r,i)?s:GMe(s,r,i)}function YTt(t,e,r){switch(r){case"metric":return HMe(t,e);case"imperial":return WMe(t,e);default:return r}}function JTt(t,e,r){switch(r){case"metric":return qMe(t,e);case"imperial":return ZMe(t,e);default:return r}}function HMe(t,e){const r=Po(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function qMe(t,e){const r=Po(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function WMe(t,e){const r=Po(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function ZMe(t,e){const r=Po(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function QTt(t,e){const r=Po(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function KTt(t,e){const r=Po(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function XMe(t,e,r){return Po(t,e,"meters")/(r*Math.PI/180)}function Lde(t){return zMe.fromJSON(t.toLowerCase())||null}function pO(t){if(t!=null&&!cO(t))return 1;const e=Za(t);return e>1e5?1:e}function YMe(t){return Za(t)>=Nr(t).metersPerDegree?"meters":s5(t)}function Za(t,e=sr.metersPerDegree){return JMe(t,!0)??e}function JMe(t,e=!1){const r=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let s=null;if(r){if(hq(r))return Tf.metersPerDegree;if(dq(r))return Mg.metersPerDegree;s=pb.values[pb[r]],!s&&e&&VMe.has(r)&&(s=UMe)}else i&&(Fde(i)?s=hQ(Ide.exec(i),s):Nde(i)&&(s=hQ($de.exec(i),s)));return s}function uQ(t){return t.isGeographic?1:Za(t)}function hQ(t,e){return t&&t[1]?Dde(t[1]):e}function Dde(t){return parseFloat(t.split(",")[1])}function s5(t){const e=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let i=null;if(e)i=pb.units[pb[e]];else if(r){const s=Fde(r)?Ide:Nde(r)?$de:null;if(s){const n=s.exec(r);n&&n[1]&&(i=KMe(n[1]))}}return i!=null?Lde(i):null}function e2t(t){const e=s5(t);return e!=null&&jMe.includes(e)?e:null}function Nde(t){return/^GEOCCS/i.test(t)}function Fde(t){return/^PROJCS/i.test(t)}const QMe=1e-7;function KMe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!pb.units.includes(r)){const i=Dde(t);r=null;const s=pb.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<QMe){r=pb.units[n];break}}return r}function t2t(t){const e=s5(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const eIe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},tIe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},rIe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},iIe=Wa()(eIe),sIe=Wa()(tIe),r2t=Wa()(rIe);var Dp;let vi=Dp=class extends de{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Dp.WebMercator;if(t.wkid===4326)return Dp.WGS84}const e=new Dp;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return uO(this)}get isWebMercator(){return Nb(this)}get isGeographic(){return Ode(this)}get isWrappable(){return LMe(this)}get metersPerUnit(){return Za(this)}get unit(){return s5(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Dp.WGS84)return Dp.WGS84;if(this===Dp.WebMercator)return Dp.WebMercator;const t=new Dp;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=K(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return Tn(this,t)}toJSON(t){return this.write(void 0,t)}};vi.GCS_NAD_1927=null,vi.WGS84=null,vi.WebMercator=null,vi.PlateCarree=null,u([p({readOnly:!0})],vi.prototype,"isWGS84",null),u([p({readOnly:!0})],vi.prototype,"isWebMercator",null),u([p({readOnly:!0})],vi.prototype,"isGeographic",null),u([p({readOnly:!0})],vi.prototype,"isWrappable",null),u([p({type:Ji,json:{write:!0}})],vi.prototype,"latestWkid",void 0),u([p({readOnly:!0})],vi.prototype,"metersPerUnit",null),u([p({readOnly:!0})],vi.prototype,"unit",null),u([p({type:Ji,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],vi.prototype,"wkid",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],vi.prototype,"wkt",void 0),u([De("wkt"),De("web-scene","wkt")],vi.prototype,"writeWkt",null),u([p({type:Ji,json:{write:!0}})],vi.prototype,"vcsWkid",void 0),u([p({type:Ji,json:{write:!0}})],vi.prototype,"latestVcsWkid",void 0),u([p()],vi.prototype,"imageCoordinateSystem",void 0),vi=Dp=u([R("esri.geometry.SpatialReference")],vi),vi.prototype.toJSON.isDefaultToJSON=!0,vi.GCS_NAD_1927=new vi({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),vi.WGS84=new vi(DMe),vi.WebMercator=new vi(NMe),vi.PlateCarree=new vi(FMe),Object.freeze&&(Object.freeze(vi.GCS_NAD_1927),Object.freeze(vi.WGS84),Object.freeze(vi.WebMercator));const Ge=vi,Ude="20230626",Vde="b81703b48e0b92e492f4cc6b739af02a9af50038",nIe="4.27";let yq=nIe;yq="4.27.6";const oIe={async request(t,e){var a,l;const{default:r}=await ae(()=>Promise.resolve().then(()=>Hde),void 0),i=t.options,s=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=bde(t.url))!=null&&a.after)?s:"array-buffer";const n=await r(t.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let xr;function i2t(t){xr=t}function s2t(t){const e=xr==null?void 0:xr.findCredential(t);return e!=null&&e.token?Ede(t,"token",e.token):t}oe("host-webworker");const aIe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function zde(t){const e=qd(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!aIe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function kde(t,e,r=!1,i){return new Promise((s,n)=>{if(vn(i))return void n(dQ());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(dQ())};const c=()=>{oe("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),oe("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function dQ(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Bde="Timeout exceeded";function lIe(){return new Error(Bde)}function n2t(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Bde}function cIe(t){Yr.request.crossOriginNoCorsDomains||(Yr.request.crossOriginNoCorsDomains={});const e=Yr.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[qd(r)??""]=0:(e[qd("http://"+r)??""]=0,e[qd("https://"+r)??""]=0)}function uIe(t){const e=Yr.request.crossOriginNoCorsDomains;if(e){let r=qd(t);if(r)return r=r.toLowerCase(),!B2(r,eq())&&e[r]<Date.now()-36e5}return!1}async function hIe(t){var s;const e=Yr.request.crossOriginNoCorsDomains,r=qd(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=_o(t);t=i.path,((s=i.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Fr(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=tq(e.query.toString().replaceAll("+"," ")));const r=Xf(t),i=f_(t);i||r||(t=Hd(t));const s={url:t,requestOptions:{...e}};let n=bde(t);if(n){const h=await vIe(n,s);if(h!=null)return{data:h,getHeader:_q,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(oe("host-webworker")||oe("host-node")))throw Sf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw Sf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw Sf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await gIe(),ID)return ID.execute(t,e);const o=new AbortController;oa(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Ed.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await wIe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let ID;const Ed=Yr.request,Gde="FormData"in globalThis,dIe=[499,498,403,401],pIe=["COM_0056","COM_0057","SB_0008"],fIe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],_q=()=>null,$D=Symbol();function mIe(t){const e=qd(t);e&&!Fr._corsServers.includes(e)&&Fr._corsServers.push(e)}function pQ(t){const e=qd(t);return!e||e.endsWith(".arcgis.com")||Fr._corsServers.includes(e)||iq(e)}function Sf(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:_q,ssl:!1};if(e instanceof U)return e.details?(e.details=K(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i==null?void 0:i.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=$D in e?e[$D]:e}return ys(e)?Dr():new U(t,s,n)}async function gIe(){oe("host-webworker")?ID||(ID=await ae(()=>import("./request-ccbcac6f.js"),[])):Fr._abortableFetch||(Fr._abortableFetch=globalThis.fetch.bind(globalThis))}async function qV(){xr||await ae(()=>import("./IdentityManager-a97b1d99.js"),["assets/IdentityManager-a97b1d99.js","assets/widget-1b23769a.js"])}async function yIe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(Gde&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in Fr._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Ed.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&Yr.apiKey&&zde(e)&&(r.query||(r.query={}),r.query.token=Yr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!jde(e)&&!vn(i)){let l;r.authMode==="immediate"?(await qV(),l=await xr.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await qV(),l=await xr.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):xr&&(l=xr.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function jde(t){return fIe.some(e=>e.test(t))}async function _Ie(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=f_(e)||Xf(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Ed.timeout;let a=!1;if(!s){t.useSSL&&(e=aq(e)),r.cacheBust&&i.cache==="default"&&(e=Ede(e,"request.preventCache",Date.now()));let f={...r.query};t.credentialToken&&(f.token=t.credentialToken);let m=lO(f);oe("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const y=e.length+1+m.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||y>Ed.maxUrlLength;const v=r.useProxy||!!i5(e);if(v){const w=gMe(e);_=w.path,!a&&_.length+1+y>Ed.maxUrlLength&&(a=!0),w.query&&(f={...w.query,...f})}if(i.method==="HEAD"&&(a||v)){if(a)throw y>Ed.maxUrlLength?Sf("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Sf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw Sf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=I6(e,f):(i.body=lO(f),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=I6(e,f),v&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&Gde&&i.body instanceof FormData&&!sMe(e)&&i.body.set("token",f.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!B2(e,eq())){if(iq(e))t.withCredentials=!0;else if(xr){const w=xr.findServerInfo(e);w!=null&&w.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",uIe(e)&&await hIe(a?I6(e,f):e))}let l,c,h=0,d=!1;o>0&&(h=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||bIe(r.headers)||!s&&!t.useProxy&&Ed.proxyUrl&&!pQ(e)){if(l=await Fr._abortableFetch(e,i),t.useProxy||mIe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=fQ(c,"application/xml");break;case"document":c=fQ(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await mQ(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await mQ(e,t)}catch(f){if(f.name==="AbortError")throw d?lIe():Dr("Request canceled");if(!(!l&&f instanceof TypeError&&Ed.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||pQ(e))throw f;t.redoRequest=!0,yMe({proxyUrl:Ed.proxyUrl,urlPrefix:qd(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function vIe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=Sf("request:interceptor",s,e)}if((i instanceof Error||i instanceof U)&&(r=Sf("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function bIe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function fQ(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function wIe(t){var n,o;let e,r;await yIe(t);try{do[e,r]=await _Ie(t);while(!await xIe(t,e,r))}catch(a){const l=Sf("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!iq(i)){const a=qd(i,!0);a&&Ed.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&cIe(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&xr){const a=xr.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=xr.findCredential(l,s.userId);c&&xr._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getHeader:e?a=>e==null?void 0:e.headers.get(a):_q,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function xIe(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[$D]=r,s.details=r.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[$D]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&dIe.includes(n)&&!jde(t.params.url)&&(n!==403||o&&!pIe.includes(o)&&(a==null||a===2&&t.credentialToken))){await qV();try{const h=await xr.getCredential(t.params.url,{error:Sf("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=h,t.credentialToken=h.token,t.useSSL=t.useSSL||h.ssl,!1}catch(h){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=h}}if(s)throw s;return!0}function mQ(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Ed.priority,s.src=t,kde(s,t,r,i)}Fr._abortableFetch=null,Fr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const Hde=Object.freeze(Object.defineProperty({__proto__:null,default:Fr},Symbol.toStringTag,{value:"Module"}));function Se(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=qH(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Np=class extends de{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ge.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof Ge)return e;if(e!=null){const i=new Ge;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};u([p()],Np.prototype,"type",void 0),u([p({readOnly:!0})],Np.prototype,"cache",null),u([p({readOnly:!0})],Np.prototype,"extent",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Np.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Np.prototype,"hasZ",void 0),u([p({type:Ge,json:{write:!0},value:Ge.WGS84})],Np.prototype,"spatialReference",void 0),u([Se("spatialReference")],Np.prototype,"readSpatialReference",null),Np=u([R("esri.geometry.Geometry")],Np);const U_=Np,TIe=Object.prototype.toString;function SIe(t){const e="__accessorMetadata__"in t?qs(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return EIe.apply(this,r)}}function EIe(t,e,r,i){uR(t,e).cast=i}function CIe(t){return(e,r)=>{uR(e,t).cast=e[r]}}function yr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&TIe.call(t[0])==="[object Function]"?SIe(t[0]):t.length===1&&typeof t[0]=="string"?CIe(t[0]):void 0}function AIe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const OIe=57.29577951308232,RIe=.017453292519943;function gQ(t){return t*OIe}function yQ(t){return t*RIe}function _Q(t){return t/sr.radius}function LD(t){return Math.PI/2-2*Math.atan(Math.exp(-t/sr.radius))}function WV(t){return t.wkid!=null||t.wkt!=null}const $6=[0,0];function DD(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,$6,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,$6,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,$6,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const d=a[h];c=[],l.push(c);for(let f=0;f<d.length;f++)c.push(e(d[f][0],d[f][1],[0,0],i)),d[f].length>2&&c[f].push(d[f][2]),d[f].length>3&&c[f].push(d[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function a_(t,e){const r=t&&(WV(t)?t:t.spatialReference),i=e&&(WV(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!Tn(i,r)||Nb(i)&&uO(r)||Nb(r)&&uO(i))}function mw(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(WV(e)?e:e.spatialReference);return a_(r,i)?Tn(r,i)?K(t):Nb(i)?DD(t,jT,Ge.WebMercator,!1,K(t)):uO(i)?DD(t,cA,Ge.WGS84,!1,K(t)):null:null}function jT(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=yQ(e);return r[0]=yQ(t)*sr.radius,r[1]=sr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function cA(t,e,r=[0,0],i=!1){const s=gQ(t/sr.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=gQ(Math.PI/2-2*Math.atan(Math.exp(-e/sr.radius))),r}function uA(t,e=!1,r=K(t)){return DD(t,jT,Ge.WebMercator,e,r)}function RC(t,e=!1,r=K(t)){return DD(t,cA,Ge.WGS84,e,r)}var T$;const wE=[0,0];function vQ(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let ol=T$=class extends U_{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ge(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)Q.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)Q.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=jT(n.longitude,n.latitude,wE);t=a[0],e=a[1]}}}else vQ(r)?(s=r,r=null):vQ(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?Q.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&Q.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return cA(e,r,wE)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",jT(r,t,wE)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return cA(t,e,wE)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",jT(t,e,wE)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new T$;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return T$.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=jT(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=cA(l,c),h=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===h.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=db(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return AIe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],ol.prototype,"cache",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ol.prototype,"hasM",null),u([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ol.prototype,"hasZ",null),u([p({type:Number})],ol.prototype,"latitude",null),u([p({type:Number})],ol.prototype,"longitude",null),u([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),yr(t=>isNaN(t)?t:Qu(t))],ol.prototype,"x",void 0),u([De("x")],ol.prototype,"writeX",null),u([Se("x")],ol.prototype,"readX",null),u([p({type:Number,json:{write:!0}})],ol.prototype,"y",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ol.prototype,"z",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],ol.prototype,"m",void 0),ol=T$=u([R("esri.geometry.Point")],ol),ol.prototype.toJSON.isDefaultToJSON=!0;const ct=ol,L6=[0,0];function vq(t,e){return e!=null&&Ma(t,e.x,e.y,e.z)}function a2t(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!G2(t,r))return!1;return!0}function PIe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Ma(t,r,i,s)&&Ma(t,r,o,s)&&Ma(t,n,o,s)&&Ma(t,n,i,s)&&Ma(t,r,i,a)&&Ma(t,r,o,a)&&Ma(t,n,o,a)&&Ma(t,n,i,a):Ma(t,r,i)&&Ma(t,r,o)&&Ma(t,n,o)&&Ma(t,n,i)}function G2(t,e){return Ma(t,e[0],e[1])}function MIe(t,e){return Ma(t,e[0],e[1],e[2])}function Ma(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function IIe(t,e){return L6[1]=e.y,L6[0]=e.x,$Ie(t,L6)}function $Ie(t,e){return qde(t.rings,e)}function qde(t,e){if(!t)return!1;if(LIe(t))return bQ(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=bQ(r,t[i],e);return r}function LIe(t){return!Array.isArray(t[0][0])}function bQ(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[d,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(d-c)<i&&(n=!n)}return n}function DIe(t,e){return vq(t,e)}function NIe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function FIe(t,e){const{points:r,hasZ:i}=e,s=i?MIe:G2;for(const n of r)if(s(t,n))return!0;return!1}const Fb=[0,0],Ub=[0,0],Vb=[0,0],zb=[0,0],UIe=[Fb,Ub,Vb,zb],Wde=[[Vb,Fb],[Fb,Ub],[Ub,zb],[zb,Vb]];function VIe(t,e){return zIe(t,e.rings)}function zIe(t,e){Fb[0]=t.xmin,Fb[1]=t.ymax,Ub[0]=t.xmax,Ub[1]=t.ymax,Vb[0]=t.xmin,Vb[1]=t.ymin,zb[0]=t.xmax,zb[1]=t.ymin;for(const r of UIe)if(qde(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(G2(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(G2(t,n)||Zde(i,n,Wde))return!0;i=n}}return!1}function kIe(t,e){Fb[0]=t.xmin,Fb[1]=t.ymax,Ub[0]=t.xmax,Ub[1]=t.ymax,Vb[0]=t.xmin,Vb[1]=t.ymin,zb[0]=t.xmax,zb[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(G2(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(G2(t,o)||Zde(s,o,Wde))return!0;s=o}}return!1}const To=[0,0];function BIe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if(ZV(n,o,c,h,To)&&!(To[0]===n[0]&&To[1]===n[1]||To[0]===c[0]&&To[1]===c[1]||To[0]===o[0]&&To[1]===o[1]||To[0]===h[0]&&To[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],h=r[l+1];if(ZV(o,a,c,h,To)&&!(To[0]===o[0]&&To[1]===o[1]||To[0]===c[0]&&To[1]===c[1]||To[0]===a[0]&&To[1]===a[1]||To[0]===h[0]&&To[1]===h[1]))return!0}}}return!1}function Zde(t,e,r){for(let i=0;i<r.length;i++)if(ZV(t,e,r[i][0],r[i][1]))return!0;return!1}function ZV(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,h]=r,[d,f]=i,m=d-c,y=n-c,_=a-n,v=f-h,w=o-h,T=l-o,x=v*_-m*T;if(x===0)return!1;const S=(m*w-v*y)/x,O=(_*w-T*y)/x;return S>=0&&S<=1&&O>=0&&O<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function GIe(t){switch(t){case"esriGeometryEnvelope":case"extent":return NIe;case"esriGeometryMultipoint":case"multipoint":return FIe;case"esriGeometryPoint":case"point":return DIe;case"esriGeometryPolygon":case"polygon":return VIe;case"esriGeometryPolyline":case"polyline":return kIe}}var Ru;function jIe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function py(t,e,r){return e==null?r:r==null?e:t(e,r)}let eo=Ru=class extends U_{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return jIe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Ge.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??Ge.WGS84}}static fromBounds(t,e){return new Ru({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Ru({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new ct({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Ru;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&a_(e,r)&&(t=e.isWebMercator?uA(t):RC(t,!0)),t.type==="point"?vq(this,t):t.type==="extent"&&PIe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&a_(e,r)&&(t=e.isWebMercator?uA(t):RC(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!Tn(e,r)&&a_(e,r)&&(t=e.isWebMercator?uA(t):RC(t,!0)),GIe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=py(Math.min,this.zmin,t.zmin),this.zmax=py(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=py(Math.min,this.mmin,t.mmin),this.mmax=py(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=py(Math.max,this.zmin,t.zmin),this.zmax=py(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=py(Math.max,this.mmin,t.mmin),this.mmax=py(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=db(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?RC(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new Ge(X4((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??db(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(h)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||db(o);const[d,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,v=h.frameId,w=m===_&&a>0;if(a>2*f){const T=new Ru(l<c?m:_,s,f,n,o),x=new Ru(d,s,l<c?_:m,n,o),S=new Ru(0,s,f,n,o),O=new Ru(d,s,0,n,o),C=[],P=[];T.contains(S)&&C.push(y),T.contains(O)&&P.push(y),x.contains(S)&&C.push(v),x.contains(O)&&P.push(v);for(let $=y+1;$<v;$++)C.push($),P.push($);e.push({extent:T,frameIds:[y]},{extent:x,frameIds:[v]},{extent:S,frameIds:C},{extent:O,frameIds:P})}else m>_||w?e.push({extent:new Ru(m,s,f,n,o),frameIds:[y]},{extent:new Ru(d,s,_,n,o),frameIds:[v]}):e.push({extent:new Ru(m,s,_,n,o),frameIds:[y]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};u([p({readOnly:!0})],eo.prototype,"cache",null),u([p({readOnly:!0})],eo.prototype,"center",null),u([p({readOnly:!0})],eo.prototype,"extent",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],eo.prototype,"hasM",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],eo.prototype,"hasZ",null),u([p({readOnly:!0})],eo.prototype,"height",null),u([p({readOnly:!0})],eo.prototype,"width",null),u([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],eo.prototype,"xmin",void 0),u([p({type:Number,json:{write:!0}})],eo.prototype,"ymin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],eo.prototype,"mmin",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],eo.prototype,"zmin",void 0),u([p({type:Number,json:{write:!0}})],eo.prototype,"xmax",void 0),u([p({type:Number,json:{write:!0}})],eo.prototype,"ymax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],eo.prototype,"mmax",void 0),u([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],eo.prototype,"zmax",void 0),eo=Ru=u([R("esri.geometry.Extent")],eo),eo.prototype.toJSON.isDefaultToJSON=!0;const _r=eo;let hA;var ehe,the;const HIe=((ehe=globalThis.esriConfig)==null?void 0:ehe.locale)??((the=globalThis.dojoConfig)==null?void 0:the.locale);function Xde(){var t;return HIe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function Wd(){return hA===void 0&&(hA=Xde()),hA}const dA=[];function Yde(t){return dA.push(t),{remove(){dA.splice(dA.indexOf(t),1)}}}const XV=[];function bq(t){return XV.push(t),{remove(){dA.splice(XV.indexOf(t),1)}}}function qIe(){const t=Xde();hA!==t&&(hA=t,[...XV].forEach(e=>{e.call(null,t)}),[...dA].forEach(e=>{e.call(null,t)}))}var rhe;(rhe=globalThis.addEventListener)==null||rhe.call(globalThis,"languagechange",qIe);let yP;function WIe(t){return yP&&!yP.destroyed||(yP=t()),yP}var YV;const ZIe=new Rr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Pu=YV=class extends xe{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new YV({categories:this.categories?K(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=mw(this.extent,Ge.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>ZIe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([p()],Pu.prototype,"categories",void 0),u([p()],Pu.prototype,"disableExtraQuery",void 0),u([p({type:_r})],Pu.prototype,"extent",void 0),u([p()],Pu.prototype,"filter",void 0),u([p()],Pu.prototype,"num",void 0),u([p()],Pu.prototype,"query",void 0),u([p()],Pu.prototype,"sortField",void 0),u([p()],Pu.prototype,"sortOrder",null),u([p()],Pu.prototype,"start",void 0),Pu=YV=u([R("esri.portal.PortalQueryParams")],Pu);const uf=Pu;let Vv=class extends xe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([p()],Vv.prototype,"nextQueryParams",void 0),u([p()],Vv.prototype,"queryParams",void 0),u([p()],Vv.prototype,"results",void 0),u([p()],Vv.prototype,"total",void 0),Vv=u([R("esri.portal.PortalQueryResult")],Vv);const XIe=Vv;let Em=class extends de{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new U("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([p({type:Date})],Em.prototype,"created",void 0),u([p()],Em.prototype,"id",void 0),u([p()],Em.prototype,"portal",void 0),u([p()],Em.prototype,"title",void 0),u([p({readOnly:!0})],Em.prototype,"url",null),u([p()],Em.prototype,"username",void 0),Em=u([R("esri.portal.PortalFolder")],Em);const YIe=Em;let to=class extends de{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,r=this.thumbnail;return e&&r&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return ec(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return ec(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new U("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=qs(uf,e);const s=ec(this.portal);return parseFloat(s.currentVersion)>5?(i=i||new uf,s.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new uf,i.query="group:"+this.id+(i.query?" "+i.query:""),s.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=ec(this.portal);return i.fetchSelf(i.authMode,!0,r).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new uf;return o.disableExtraQuery=!0,o.num=1,o.query=n,i.queryGroups(o,r)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new uf;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,r)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",r).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};u([p()],to.prototype,"access",void 0),u([p({type:Date})],to.prototype,"created",void 0),u([p()],to.prototype,"description",void 0),u([p()],to.prototype,"id",void 0),u([p()],to.prototype,"isInvitationOnly",void 0),u([p({type:Date})],to.prototype,"modified",void 0),u([p()],to.prototype,"owner",void 0),u([p()],to.prototype,"portal",void 0),u([p()],to.prototype,"snippet",void 0),u([p()],to.prototype,"sortField",void 0),u([p()],to.prototype,"sortOrder",void 0),u([p()],to.prototype,"tags",void 0),u([p()],to.prototype,"thumbnail",void 0),u([p({readOnly:!0})],to.prototype,"thumbnailUrl",null),u([p()],to.prototype,"title",void 0),u([p({readOnly:!0})],to.prototype,"url",null),to=u([R("esri.portal.PortalGroup")],to);const JV=to,JIe=Object.freeze(Object.defineProperty({__proto__:null,default:JV},Symbol.toStringTag,{value:"Module"}));var QV;let us=QV=class extends de{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=YIe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=JV.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),ae(()=>Promise.resolve().then(()=>Jde),void 0).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new JV({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new U("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new U("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new QV;return e.sourceJSON=t,e.read(t),e}};u([p()],us.prototype,"access",void 0),u([p({type:Date})],us.prototype,"created",void 0),u([p()],us.prototype,"culture",void 0),u([p()],us.prototype,"description",void 0),u([p()],us.prototype,"email",void 0),u([p()],us.prototype,"favGroupId",void 0),u([p()],us.prototype,"fullName",void 0),u([p({type:Date})],us.prototype,"modified",void 0),u([p()],us.prototype,"orgId",void 0),u([p()],us.prototype,"portal",void 0),u([p()],us.prototype,"preferredView",void 0),u([p()],us.prototype,"privileges",void 0),u([p()],us.prototype,"region",void 0),u([p()],us.prototype,"role",void 0),u([p()],us.prototype,"roleId",void 0),u([p()],us.prototype,"sourceJSON",void 0),u([p()],us.prototype,"thumbnail",void 0),u([p({readOnly:!0})],us.prototype,"thumbnailUrl",null),u([p()],us.prototype,"units",void 0),u([p({readOnly:!0})],us.prototype,"userContentUrl",null),u([p({readOnly:!0})],us.prototype,"url",null),u([p()],us.prototype,"username",void 0),u([p()],us.prototype,"userType",void 0),us=QV=u([R("esri.portal.PortalUser")],us);const wq=us,QIe=Object.freeze(Object.defineProperty({__proto__:null,default:wq},Symbol.toStringTag,{value:"Module"}));var Cm;let _P;const wQ={PortalGroup:()=>ae(()=>Promise.resolve().then(()=>JIe),void 0),PortalItem:()=>ae(()=>Promise.resolve().then(()=>Jde),void 0),PortalUser:()=>ae(()=>Promise.resolve().then(()=>QIe),void 0)};let Ie=Cm=class extends zS(Pg){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Yr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){xQ.unregister(this),this.defaultBasemap=Pe(this.defaultBasemap),this.defaultDevBasemap=Pe(this.defaultDevBasemap),this.defaultVectorBasemap=Pe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Di(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Yr.request.trustedServers.includes(e)||Yr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=wq.fromJSON(t),e.portal=this),e}load(t){const e=ae(()=>Promise.resolve().then(()=>E$e),void 0).then(({default:r})=>{Qt(t),_P=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(xr){const s=xr;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==Cm.AUTH_MODE_AUTO||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",KIe(new WeakRef(this))),xQ.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ae(()=>import("./ElevationLayer-705afd95.js"),["assets/ElevationLayer-705afd95.js","assets/ArcGISCachedService-f2f7ac5c.js","assets/TileInfoTilemapCache-0fa9c5f8.js","assets/TilemapCache-b178cbc7.js"])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):vn(t)?Promise.reject(Dr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new uf;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return vn(t)?Promise.reject(Dr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Wd();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Wd();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return WIe(()=>new Cm)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:Wd().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=qs(uf,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new XIe({nextQueryParams:l,queryParams:s,total:a.total,results:Cm._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Io(l),a)));return r&&wQ[r]?wQ[r]().then(({default:o})=>(Qt(i),n(o))):n()}signIn(){if(this.authMode===Cm.AUTH_MODE_ANONYMOUS)return Promise.reject(new U("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return xr?xr.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=Cm._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===Cm.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return Fr(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new U("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Cm({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new U("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new uf;r.query=t||(Yr.apiKey&&zde(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(r,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new _P({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new uf({query:r,disableExtraQuery:!0}),s=await this.queryGroups(i,e);if(!s.total)return[];const n=s.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new _P({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=_P.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Ie.AUTH_MODE_ANONYMOUS="anonymous",Ie.AUTH_MODE_AUTO="auto",Ie.AUTH_MODE_IMMEDIATE="immediate",u([p()],Ie.prototype,"access",void 0),u([p()],Ie.prototype,"allSSL",void 0),u([p()],Ie.prototype,"authMode",void 0),u([p()],Ie.prototype,"authorizedCrossOriginDomains",void 0),u([Se("authorizedCrossOriginDomains")],Ie.prototype,"readAuthorizedCrossOriginDomains",null),u([p()],Ie.prototype,"basemapGalleryGroupQuery",void 0),u([p({json:{name:"3DBasemapGalleryGroupQuery"}})],Ie.prototype,"basemapGalleryGroupQuery3D",void 0),u([p()],Ie.prototype,"bingKey",void 0),u([p()],Ie.prototype,"canListApps",void 0),u([p()],Ie.prototype,"canListData",void 0),u([p()],Ie.prototype,"canListPreProvisionedItems",void 0),u([p()],Ie.prototype,"canProvisionDirectPurchase",void 0),u([p()],Ie.prototype,"canSearchPublic",void 0),u([p()],Ie.prototype,"canShareBingPublic",void 0),u([p()],Ie.prototype,"canSharePublic",void 0),u([p()],Ie.prototype,"canSignInArcGIS",void 0),u([p()],Ie.prototype,"canSignInIDP",void 0),u([p()],Ie.prototype,"colorSetsGroupQuery",void 0),u([p()],Ie.prototype,"commentsEnabled",void 0),u([p({type:Date})],Ie.prototype,"created",void 0),u([p()],Ie.prototype,"credential",void 0),u([p()],Ie.prototype,"culture",void 0),u([p()],Ie.prototype,"currentVersion",void 0),u([p()],Ie.prototype,"customBaseUrl",void 0),u([p()],Ie.prototype,"defaultBasemap",void 0),u([Se("defaultBasemap")],Ie.prototype,"readDefaultBasemap",null),u([p()],Ie.prototype,"defaultDevBasemap",void 0),u([Se("defaultDevBasemap")],Ie.prototype,"readDefaultDevBasemap",null),u([p({type:_r})],Ie.prototype,"defaultExtent",void 0),u([p()],Ie.prototype,"defaultVectorBasemap",void 0),u([Se("defaultVectorBasemap")],Ie.prototype,"readDefaultVectorBasemap",null),u([p()],Ie.prototype,"description",void 0),u([p()],Ie.prototype,"devBasemapGalleryGroupQuery",void 0),u([p()],Ie.prototype,"eueiEnabled",void 0),u([p({readOnly:!0})],Ie.prototype,"extraQuery",null),u([p()],Ie.prototype,"featuredGroups",void 0),u([p()],Ie.prototype,"featuredItemsGroupQuery",void 0),u([p()],Ie.prototype,"galleryTemplatesGroupQuery",void 0),u([p()],Ie.prototype,"livingAtlasGroupQuery",void 0),u([p()],Ie.prototype,"hasCategorySchema",void 0),u([p()],Ie.prototype,"helpBase",void 0),u([p()],Ie.prototype,"helperServices",void 0),u([p()],Ie.prototype,"helpMap",void 0),u([p()],Ie.prototype,"homePageFeaturedContent",void 0),u([p()],Ie.prototype,"homePageFeaturedContentCount",void 0),u([p()],Ie.prototype,"httpPort",void 0),u([p()],Ie.prototype,"httpsPort",void 0),u([p()],Ie.prototype,"id",void 0),u([p()],Ie.prototype,"ipCntryCode",void 0),u([p({readOnly:!0})],Ie.prototype,"isOrganization",null),u([p()],Ie.prototype,"isPortal",void 0),u([p()],Ie.prototype,"isReadOnly",void 0),u([p({readOnly:!0})],Ie.prototype,"itemPageUrl",null),u([p()],Ie.prototype,"layerTemplatesGroupQuery",void 0),u([p()],Ie.prototype,"maxTokenExpirationMinutes",void 0),u([p({type:Date})],Ie.prototype,"modified",void 0),u([p()],Ie.prototype,"name",void 0),u([p()],Ie.prototype,"portalHostname",void 0),u([p()],Ie.prototype,"portalMode",void 0),u([p()],Ie.prototype,"portalProperties",void 0),u([p()],Ie.prototype,"region",void 0),u([p({readOnly:!0})],Ie.prototype,"restUrl",null),u([p()],Ie.prototype,"rotatorPanels",void 0),u([p()],Ie.prototype,"showHomePageDescription",void 0),u([p()],Ie.prototype,"sourceJSON",void 0),u([p()],Ie.prototype,"staticImagesUrl",void 0),u([p({json:{name:"2DStylesGroupQuery"}})],Ie.prototype,"stylesGroupQuery2d",void 0),u([p({json:{name:"stylesGroupQuery"}})],Ie.prototype,"stylesGroupQuery3d",void 0),u([p()],Ie.prototype,"supportsHostedServices",void 0),u([p()],Ie.prototype,"symbolSetsGroupQuery",void 0),u([p()],Ie.prototype,"templatesGroupQuery",void 0),u([p()],Ie.prototype,"thumbnail",void 0),u([p({readOnly:!0})],Ie.prototype,"thumbnailUrl",null),u([p()],Ie.prototype,"units",void 0),u([p()],Ie.prototype,"url",void 0),u([p()],Ie.prototype,"urlKey",void 0),u([Se("urlKey")],Ie.prototype,"readUrlKey",null),u([p()],Ie.prototype,"user",void 0),u([Se("user")],Ie.prototype,"readUser",null),u([p()],Ie.prototype,"use3dBasemaps",void 0),u([p()],Ie.prototype,"useStandardizedQuery",void 0),u([p()],Ie.prototype,"useVectorBasemaps",void 0),u([p()],Ie.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ie=Cm=u([R("esri.portal.Portal")],Ie);const qn=Ie,xQ=new FinalizationRegistry(t=>{t.remove()});function KIe(t){const e=xr;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}const e$e=Q.getLogger("esri.assets");function t$e(t,e){return Fr(Br(t),e)}function Br(t){if(!Yr.assetsPath)throw e$e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new U("assets:path-not-set","config.assetsPath is not set");return _c(Yr.assetsPath,t)}let Am=class extends xe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&fc(e)?Q.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new U("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResource:i}=await ae(()=>Promise.resolve().then(()=>J3),void 0);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&fc(e)&&(e=sq(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([p()],Am.prototype,"portalItem",void 0),u([p({type:String,value:null})],Am.prototype,"path",null),u([yr("path")],Am.prototype,"_castPath",null),u([p({type:String,readOnly:!0})],Am.prototype,"url",null),u([p({type:String,readOnly:!0})],Am.prototype,"cdnUrl",null),u([p({type:String,readOnly:!0})],Am.prototype,"itemRelativeUrl",null),Am=u([R("esri.portal.PortalItemResource")],Am);const r$e=Am;let PC=class extends xe{constructor(e){super(e),this.created=null,this.rating=null}};u([p()],PC.prototype,"created",void 0),u([p()],PC.prototype,"rating",void 0),PC=u([R("esri.portal.PortalRating")],PC);const D6=PC;var zv;const i$e=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),s$e=new Set(["KML","GeoJson","CSV"]);let or=zv=class extends zS(Pg){static from(t){return $b(zv,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(t){return t&&t.length?new _r(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="360 vr experience"?"360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",s?Br(r+s+i+".png"):null}get isLayer(){return this.type!=null&&i$e.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&xr&&!xr.findCredential(t)&&(t=xr._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=qn.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof D6&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new D6({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:K(this.applicationProxies),avgRating:this.avgRating,categories:K(this.categories),created:K(this.created),culture:this.culture,description:this.description,extent:K(this.extent),groupCategories:K(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:K(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:K(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:K(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:K(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new zv({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await ec(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return ec(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await ec(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new D6(e)):null}fetchRelatedItems(t,e){return ec(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},zv)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return ec(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>ec(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new U("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await ec(e).signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!i,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new zv({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")Xf(e)?i.query={data:e}:i.query={url:Jc(e)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await ae(()=>Promise.resolve().then(()=>J3),void 0);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await ae(()=>Promise.resolve().then(()=>J3),void 0);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await ae(()=>Promise.resolve().then(()=>J3),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new U("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ae(()=>Promise.resolve().then(()=>J3),void 0);return e(this,t)}resourceFromPath(t){return new r$e({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:K(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:K(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:K(this.typeKeywords),url:this.url};return che(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new zv({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([p({type:["private","shared","org","public"]})],or.prototype,"access",void 0),u([p()],or.prototype,"accessInformation",void 0),u([p({type:String})],or.prototype,"apiKey",void 0),u([p({json:{read:{source:"appProxies"}}})],or.prototype,"applicationProxies",void 0),u([p()],or.prototype,"avgRating",void 0),u([p()],or.prototype,"categories",void 0),u([p({type:Date})],or.prototype,"created",void 0),u([p()],or.prototype,"culture",void 0),u([p()],or.prototype,"description",void 0),u([p({readOnly:!0})],or.prototype,"displayName",null),u([p({type:_r})],or.prototype,"extent",void 0),u([Se("extent")],or.prototype,"readExtent",null),u([p()],or.prototype,"groupCategories",void 0),u([p({readOnly:!0})],or.prototype,"iconUrl",null),u([p()],or.prototype,"id",void 0),u([p({readOnly:!0})],or.prototype,"isLayer",null),u([p({type:Boolean,readOnly:!0})],or.prototype,"isOrgItem",void 0),u([p()],or.prototype,"itemControl",void 0),u([p({readOnly:!0})],or.prototype,"itemPageUrl",null),u([p({readOnly:!0})],or.prototype,"itemUrl",null),u([p()],or.prototype,"licenseInfo",void 0),u([p({type:Date})],or.prototype,"modified",void 0),u([p()],or.prototype,"name",void 0),u([p()],or.prototype,"numComments",void 0),u([p()],or.prototype,"numRatings",void 0),u([p()],or.prototype,"numViews",void 0),u([p()],or.prototype,"owner",void 0),u([p()],or.prototype,"ownerFolder",void 0),u([p({type:qn})],or.prototype,"portal",void 0),u([p()],or.prototype,"screenshots",void 0),u([p()],or.prototype,"size",void 0),u([p()],or.prototype,"snippet",void 0),u([p()],or.prototype,"sourceJSON",void 0),u([p({type:String})],or.prototype,"sourceUrl",void 0),u([p({type:String})],or.prototype,"spatialReference",void 0),u([p()],or.prototype,"tags",void 0),u([p()],or.prototype,"thumbnail",void 0),u([p({readOnly:!0})],or.prototype,"thumbnailUrl",null),u([p()],or.prototype,"title",void 0),u([p()],or.prototype,"type",void 0),u([p()],or.prototype,"typeKeywords",void 0),u([p({type:String,json:{read(t,e){var r;if(s$e.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],or.prototype,"url",void 0),u([p({readOnly:!0})],or.prototype,"userItemUrl",null),or=zv=u([R("esri.portal.PortalItem")],or);const fb=or,Jde=Object.freeze(Object.defineProperty({__proto__:null,default:fb},Symbol.toStringTag,{value:"Module"})),TQ=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,n$e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function SQ(t){return t in n$e}const MC=[],h2=new Map;function EQ(t){for(const e of h2.keys())Kde(t.pattern,e)&&h2.delete(e)}function o$e(t){return MC.includes(t)||(EQ(t),MC.unshift(t)),{remove(){const e=MC.indexOf(t);e>-1&&(MC.splice(e,1),EQ(t))}}}async function Qde(t){const e=Wd();h2.has(t)||h2.set(t,l$e(t,e));const r=h2.get(t);return r&&await c$e.add(r),r}function a$e(t){if(!TQ.test(t))return null;const e=TQ.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return SQ(s)?s:SQ(r)?r:null}async function l$e(t,e){const r=[];for(const i of MC)if(Kde(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new U("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new U("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Kde(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}bq(()=>{h2.clear()});const c$e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=yo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function u$e(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await Qde("esri/t9n/basemaps");return r[t]||r[e]}const KV={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Br("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Br("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Br("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Br("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Br("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Br("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Br("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Br("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Br("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Br("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Br("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Br("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Br("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Br("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Br("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Br("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function p2t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function pA(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function j2(t){return t!=null&&"type"in t&&t.type==="group"}const f2t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function epe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function CQ(t){return(t==null?void 0:t.type)==="voxel"}function AQ(t){return(t==null?void 0:t.type)==="imagery-tile"}function tpe(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function xq(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function m2t(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function h$e(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function rpe(t,e){const r=xr==null?void 0:xr.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Fr(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function d$e(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function p$e(t){return d$e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function f$e(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function m$e(t){return!!f$e(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const g$e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),y$e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function _$e(t){return t.layerContainerType==="basemap"?g$e:t.layerContainerType==="operational-layers"?y$e:null}function v$e(t,e){if(e.restrictedWebMapWriting){const r=_$e(e);return r==null||r.has(t.type)&&!xq(t)}return!0}function b$e(t,e){if(e)if(xq(t)){const r=hR("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&OQ(t,i)}else t.type!=="group"&&OQ(t,e)}function OQ(t,e){"maxScale"in t&&(e.maxScale=AD(t.maxScale)??void 0),"minScale"in t&&(e.minScale=AD(t.minScale)??void 0)}function w$e(t,e){if(b$e(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=AD(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(xq(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function RQ(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new U("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(v$e(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&w$e(t,e=K(e)),e}var S$;let x$e=0;const ipe="esri.Basemap";let Mu=S$=class extends zS(Pg){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+x$e++,this.baseLayers=new Mt,this.referenceLayers=new Mt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&Q.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{Q.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const e=this.referenceLayers.removeAll();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Lb(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=RQ(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=RQ(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",Lb(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return mde(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>pD(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>pD(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new S$({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=K(r);return i.url&&Df(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&Df(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;Qt(t);const i=[];if(e){const s=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;i.push(u$e(n).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=S$e[(i==null?void 0:i.origin)||""]??"web-map",{populateOperationalLayers:o}=await ae(()=>import("./layersCreator-b8f3fd32.js"),["assets/layersCreator-b8f3fd32.js","assets/lazyLayerLoader-0453090c.js","assets/portalLayers-bf62775d.js","assets/layersLoader-50532ff0.js","assets/fetchService-cf0ed1b3.js","assets/jsonContext-cef0facd.js"]),a=[];if(Qt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await Zf(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=_o(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:T$e[t.type||""]??"web-map",portal:t.portal||qn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||qn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=KV[t];if(!e)return null;if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),OD(Q.getLogger(ipe),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return S$.fromJSON(e)}};u([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Mt}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Mu.prototype,"baseLayers",null),u([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],Mu.prototype,"id",void 0),u([p({type:fb})],Mu.prototype,"portalItem",void 0),u([p()],Mu.prototype,"referenceLayers",null),u([p({readOnly:!0})],Mu.prototype,"resourceInfo",void 0),u([p({type:Ge})],Mu.prototype,"spatialReference",void 0),u([p()],Mu.prototype,"thumbnailUrl",void 0),u([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Mu.prototype,"title",void 0),u([De("title")],Mu.prototype,"writeTitle",null),Mu=S$=u([R(ipe)],Mu);const T$e={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},S$e={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},ND=Mu,E$e=Object.freeze(Object.defineProperty({__proto__:null,default:ND},Symbol.toStringTag,{value:"Module"})),FD={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function spe(t){return!!FD[t]||!!FD[t.toLowerCase()]}function Tq(t){return FD[t]??FD[t.toLowerCase()]}function C$e(t){return[...Tq(t)]}function N6(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function npe(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*N6(o,n,s+1/3)),Math.round(255*N6(o,n,s)),Math.round(255*N6(o,n,s-1/3)),i]}function A$e(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function A(){return[0,0,0]}function Is(t){return[t[0],t[1],t[2]]}function Ae(t,e,r){return[t,e,r]}function Da(t){const e=A(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Sq(t,e){return new Float64Array(t,e,3)}function ope(){return A()}function ape(){return Ae(1,1,1)}function lpe(){return Ae(1,0,0)}function cpe(){return Ae(0,1,0)}function Eq(){return Ae(0,0,1)}const Ba=ope(),ug=ape(),upe=lpe(),hpe=cpe(),Cq=Eq();Object.freeze(Object.defineProperty({__proto__:null,ONES:ug,UNIT_X:upe,UNIT_Y:hpe,UNIT_Z:Cq,ZEROS:Ba,clone:Is,create:A,createView:Sq,fromArray:Da,fromValues:Ae,ones:ape,unitX:lpe,unitY:cpe,unitZ:Eq,zeros:ope},Symbol.toStringTag,{value:"Module"}));let Aq=1e-6;function Xa(){return Aq}function O$e(t){Aq=t}const mR=Math.random,R$e=Math.PI/180,P$e=180/Math.PI;function n5(t){return t*R$e}function M$e(t){return t*P$e}function I$e(t,e){return Math.abs(t-e)<=Aq*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:mR,equals:I$e,getEpsilon:Xa,setEpsilon:O$e,toDegree:M$e,toRadian:n5},Symbol.toStringTag,{value:"Module"}));function Ee(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function re(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function le(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function he(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function o5(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function UD(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function $$e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function dpe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function VD(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function ppe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function Oq(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function L$e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function D$e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ie(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function tb(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function mi(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function fo(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function ra(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function aa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function N$e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ge(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function me(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ot(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function Gr(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function F$e(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*h,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*h,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*h,t}function U$e(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,d=3*l*o,f=l*n;return t[0]=e[0]*c+r[0]*h+i[0]*d+s[0]*f,t[1]=e[1]*c+r[1]*h+i[1]*d+s[1]*f,t[2]=e[2]*c+r[2]*h+i[2]*d+s[2]*f,t}function V$e(t,e){e=e||1;const r=mR,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function $e(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function cc(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function mc(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let h=s*c-n*l,d=n*a-i*c,f=i*l-s*a,m=s*f-n*d,y=n*h-i*f,_=i*d-s*h;const v=2*o;return h*=v,d*=v,f*=v,m*=2,y*=2,_*=2,t[0]=a+h+m,t[1]=l+d+y,t[2]=c+f+_,t}function z$e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function k$e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function B$e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function fpe(t,e){re(vP,t),re(bP,e),ge(vP,vP),ge(bP,bP);const r=me(vP,bP);return r>1?0:r<-1?Math.PI:Math.acos(r)}const vP=A(),bP=A();function G$e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function na(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function m_(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=Xa();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Gg(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const bn=he,j$e=o5,H$e=UD,gR=mi,a5=fo,Jl=Ee,ez=ra,PQ=Object.freeze(Object.defineProperty({__proto__:null,abs:VD,add:le,angle:fpe,bezier:U$e,ceil:$$e,copy:re,cross:ot,direction:Gg,dist:gR,distance:mi,div:H$e,divide:UD,dot:me,equals:m_,exactEquals:na,floor:dpe,hermite:F$e,inverse:N$e,len:Jl,length:Ee,lerp:Gr,max:L$e,min:Oq,mul:j$e,multiply:o5,negate:aa,normalize:ge,random:V$e,rotateX:z$e,rotateY:k$e,rotateZ:B$e,round:D$e,scale:ie,scaleAndAdd:tb,set:se,sign:ppe,sqrDist:a5,sqrLen:ez,squaredDistance:fo,squaredLength:ra,str:G$e,sub:bn,subtract:he,transformMat3:cc,transformMat4:$e,transformQuat:mc},Symbol.toStringTag,{value:"Module"}));function ch(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function wi(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function Rq(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function mpe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function gpe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function ype(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function q$e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function W$e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Z$e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function X$e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Y$e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function kb(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function J$e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function _pe(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function zD(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function Pq(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function Mq(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function Q$e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function K$e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function vpe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function bpe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function l5(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function eLe(t,e){const r=mR;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function eu(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function tLe(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*n-l*s,d=c*s+l*i-o*n,f=c*n+o*s-a*i,m=-o*i-a*s-l*n;return t[0]=h*c+m*-o+d*-l-f*-a,t[1]=d*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-d*-o,t[3]=e[3],t}function rLe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function d2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function kD(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Xa();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const iLe=mpe,sLe=gpe,nLe=ype,oLe=_pe,aLe=zD,lLe=Pq,cLe=Mq,wpe=Object.freeze(Object.defineProperty({__proto__:null,add:Rq,ceil:q$e,copy:ch,dist:oLe,distance:_pe,div:nLe,divide:ype,dot:bpe,equals:kD,exactEquals:d2,floor:W$e,inverse:K$e,len:lLe,length:Pq,lerp:l5,max:X$e,min:Z$e,mul:sLe,multiply:gpe,negate:Q$e,normalize:vpe,random:eLe,round:Y$e,scale:kb,scaleAndAdd:J$e,set:wi,sqrDist:aLe,sqrLen:cLe,squaredDistance:zD,squaredLength:Mq,str:rLe,sub:iLe,subtract:mpe,transformMat4:eu,transformQuat:tLe},Symbol.toStringTag,{value:"Module"})),MQ=new Float32Array(1);function uLe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function _e(t,e,r){return Math.min(Math.max(t,e),r)}function Bb(t){return(t&t-1)==0}function g2t(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function y2t(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function xt(t,e,r){return t+(e-t)*r}function Ut(t){return t*Math.PI/180}function qa(t){return 180*t/Math.PI}function tz(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Sn(t){return Math.acos(_e(t,-1,1))}function _h(t){return Math.asin(_e(t,-1,1))}function p2(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const BD=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function rz(t){return BD.setFloat64(0,t),BD.getBigInt64(0)}function hLe(t){return BD.setBigInt64(0,t),BD.getFloat64(0)}const E$=BigInt("1000000"),dLe=xpe(1);function xpe(t){const e=rz(t=Math.abs(t)),r=hLe(e<=E$?E$:e-E$);return Math.abs(t-r)}function _2t(t,e,r=dLe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&xpe(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=rz(t),s=rz(e);return i<0!=s<0?!1:!((i<s?s-i:i-s)>E$)}function pLe(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function fLe(t){return Tpe(Math.max(-iz,Math.min(t,iz)))}function Tpe(t){return MQ[0]=t,MQ[0]}function fO(t,e,r){const i=_e((r-t)/(e-t),0,1);return i*i*(3-2*i)}function IQ(t,e){const r=Ee(t),i=_h(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return se(e,r,i,s),e}function v2t(t,e,r){return wi(t,e[0],e[1],e[2],e[3]*r)}function b2t(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(p2(e,1)&&p2(r,1)&&p2(i,1))}const iz=Tpe(34028234663852886e22);function wP(t){return _e(HH(t),0,255)}function xP(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let C$=class Zo{static blendColors(e,r,i,s=new Zo){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Zo.fromArray(a,r)}return Zo.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Zo.fromArray(npe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new Zo){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,s=(1<<i)-1;let n=+("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new Zo){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=spe(e)?Tq(e):null;return i&&Zo.fromArray(i,r)||Zo.fromRgb(e,r)||Zo.fromHex(e,r)}static fromJSON(e){return e&&new Zo([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Zo.fromString(e,this):Array.isArray(e)?Zo.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Zo||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Zo.AlphaMode.ALWAYS){const r=wP(this.r),i=wP(this.g),s=wP(this.b);return e===Zo.AlphaMode.ALWAYS||this.a!==1?[r,i,s,wP(255*this.a)]:[r,i,s]}clone(){return new Zo(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(xP(this.r,0,255)),this.g=Math.round(xP(this.g,0,255)),this.b=Math.round(xP(this.b,0,255)),this.a=xP(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};C$.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(C$||(C$={}));const ke=C$;function w2t(t){}function mLe(t){return()=>t}function et(t,e={}){const r=t instanceof Rr?t:new Rr(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),p(i)}var sz;let A$=sz=class extends de{constructor(t){super(t),this.type="none"}clone(){return new sz({type:this.type})}};u([et({none:"none",stayAbove:"stay-above"})],A$.prototype,"type",void 0),A$=sz=u([R("esri.ground.NavigationConstraint")],A$);function c5(t){const e=HH(100*(1-t));return Math.max(0,Math.min(e,100))}function H2(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var nz;let Om=nz=class extends zS(Pg){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Mt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&Q.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{ys(t)||Q.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Lb(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};mLe(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new U("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return mde(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await ae(()=>import("./ElevationQuery-ab0e3c67.js"),[]);Qt(e);const i=new r,s=this.layers.filter($Q).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await ae(()=>import("./ElevationQuery-ab0e3c67.js"),[]);Qt(e);const i=new r,s=this.layers.filter($Q).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:K(this.surfaceColor),navigationConstraint:K(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new nz({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return ae(()=>import("./layersCreator-b8f3fd32.js"),["assets/layersCreator-b8f3fd32.js","assets/lazyLayerLoader-0453090c.js","assets/portalLayers-bf62775d.js","assets/layersLoader-50532ff0.js","assets/fetchService-cf0ed1b3.js","assets/jsonContext-cef0facd.js"]).then(({populateOperationalLayers:o})=>{Qt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return Zf(a)}).then(()=>{})}};function gLe(t){return t&&"createElevationSampler"in t}function $Q(t){return t.type==="elevation"||gLe(t)}u([p({json:{read:!1}})],Om.prototype,"layers",null),u([De("layers")],Om.prototype,"writeLayers",null),u([p({readOnly:!0})],Om.prototype,"resourceInfo",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ji,read:{reader:H2,source:"transparency"},write:{writer:(t,e)=>{e.transparency=c5(t)},target:"transparency"}}})],Om.prototype,"opacity",void 0),u([p({type:ke,json:{type:[Ji],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Om.prototype,"surfaceColor",void 0),u([p({type:A$,json:{write:!0}})],Om.prototype,"navigationConstraint",void 0),Om=nz=u([R("esri.Ground")],Om);const GD=Om;let qx=class extends Mt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Uhe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new Mt(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(s=>!!s);for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([p()],qx.prototype,"getCollections",void 0),u([p()],qx.prototype,"getChildrenFunction",void 0),u([p()],qx.prototype,"itemFilterFunction",void 0),qx=u([R("esri.core.CollectionFlattener")],qx);const mO=qx,yLe=[["binary","application/octet-stream","bin",""]];function _Le(t,e){return $q(wLe(t,e))}function vLe(t,e){return $q(xLe(t,e))}function T2t(t,e){return Spe(bLe(t,e))}function Iq(t){return[...yLe,...t]}function bLe(t,e){return Iq(e).find(r=>$q(r)===t)}function wLe(t,e){return Iq(e).find(r=>Spe(r)===t)}function xLe(t,e){const r=t.toLowerCase();return Iq(e).find(i=>TLe(i).some(s=>r.endsWith(s)))}function $q(t){return t==null?void 0:t[0]}function Spe(t){return t==null?void 0:t[1]}function TLe(t){return(t==null?void 0:t[2].split(","))??[]}function S2t(t){var e;return(e=t.tables)==null?void 0:e.find(r=>r.role==="assetMaps")}function SLe(t){var e,r;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((r=(e=p$e(t))==null?void 0:e.operations)!=null&&r.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!m$e(t)||t.type==="scene"&&!ELe(t))}function ELe(t){const e=t.infoFor3D;if(!e)return!0;const{supportedFormats:r,queryFormats:i}=e,s=_Le("model/gltf-binary",r)??vLe("glb",r);return s!=null&&i.includes(s)}const LQ=Q.getLogger("esri.support.basemapUtils");function CLe(){return{}}function ALe(t){for(const e in t){const r=t[e];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete t[e]}}function OLe(t,e){let r;if(typeof t=="string"){if(!(t in KV)){const i=Object.entries(KV).filter(([s,n])=>Yr.apiKey&&!n.classic||!Yr.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return LQ.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=ND.fromId(t),e&&(e[t]=r))}else r=qs(ND,t);return r!=null&&r.destroyed&&(LQ.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function E2t(t,e){var r,i,s,n;return((i=(r=t.basemap)==null?void 0:r.referenceLayers)==null?void 0:i.some(o=>o.uid===e))||((n=(s=t.basemap)==null?void 0:s.baseLayers)==null?void 0:n.some(o=>o.uid===e))}function RLe(t){return new mO({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function F6(t){for(const e of t.values())e==null||e.destroy();t.clear()}const DQ={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function PLe(t){let e=null;if(typeof t=="string")if(t in DQ){const r=DQ[t];e=new GD({resourceInfo:{data:{layers:[r]}}})}else Q.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=qs(GD,t);return e}function q2(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var oz;function NQ(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function MLe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Wy=oz=class extends U_{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):MLe(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new _r,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=NQ(Math.min),a=NQ(Math.max);let l,c,h,d,[f,m]=n,[y,_]=n;for(let v=0,w=t.length;v<w;v++){const T=t[v],[x,S]=T;if(f=o(f,x),m=o(m,S),y=a(y,x),_=a(_,S),r&&T.length>2){const O=T[2];l=o(l,O),h=a(h,O)}if(i&&T.length>s){const O=T[s];c=o(c,O),d=a(d,O)}}return e.xmin=f,e.ymin=m,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=K(this.points)}addPoint(t){return q2(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:K(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new oz(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new ct(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new ct(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(q2(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([p({readOnly:!0})],Wy.prototype,"cache",null),u([p()],Wy.prototype,"extent",null),u([p({type:[[Number]],json:{write:{isRequired:!0}}})],Wy.prototype,"points",void 0),u([De("points")],Wy.prototype,"writePoints",null),Wy=oz=u([R("esri.geometry.Multipoint")],Wy),Wy.prototype.toJSON.isDefaultToJSON=!0;const yR=Wy;function C2t(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function ILe(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function u5(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function Epe(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function A2t(t,e,r,i){const[s,n]=e,[o,a]=r[i],[l,c]=r[i+1],h=l-o,d=c-a,f=h*h+d*d,m=(s-o)*h+(n-a)*d,y=Math.min(1,Math.max(0,m/f));return t[0]=o+h*y,t[1]=a+d*y,t}function O2t(t,e,r){let i,s,n,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,s=r.y;r.nextPoint();)n=r.x,o=r.y,s>e!=o>e&&t<(n-i)*(e-s)/(o-s)+i&&(a=!a),l=Math.min(l,$Le(t,e,i,s,n,o)),i=n,s=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function $Le(t,e,r,i,s,n){let o=r,a=i,l=s-o,c=n-a;if(l!==0||c!==0){const h=((t-o)*l+(e-a)*c)/(l*l+c*c);h>1?(o=s,a=n):h>0&&(o+=l*h,a+=c*h)}return l=t-o,c=e-a,l*l+c*c}function Cpe(t,e){return Epe(t,e,.5)}function Ape(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=u5(t[i],t[i+1]);return r}function Ope(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=u5(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return Epe(t[s],t[s+1],o)}i+=n}return t[r-1]}function Rpe(t,e,r){const i=t.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function LLe(t){const e=t.length;return e>2&&Og(t[0],t[e-1])}function R2t(t){if("rings"in t)for(const e of t.rings)LLe(e)||e.push(e[0].slice())}function P2t(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function Ppe(t){if(!t||t.numPoints<3)return 0;let e,r,i=0;if(t.seekPathStart(),!t.nextPoint())return 0;e=t.x,r=t.y;const s=e,n=r;for(;t.nextPoint();)i+=(e-t.x)*(r+t.y),e=t.x,r=t.y;return i+=(e-s)*(r+n),-.5*i}function M2t(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function DLe(t){return t?Mpe(t.rings,t.hasZ??!1):null}function Mpe(t,e){if(!t||!t.length)return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=Ipe(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?NLe(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function Ipe(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],y=t[(f+1)%t.length],[_,v,w]=m,T=_-l,x=v-c,[S,O,C]=y,P=S-l,$=O-c,V=T*$-P*x;if(o+=V,i+=(T+P)*V,s+=(x+$)*V,e&&m.length>2&&y.length>2){const z=w-h,B=C-h,k=T*B-P*z;n+=(z+B)*k,a+=k}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(w<r[4]&&(r[4]=w),w>r[5]&&(r[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(d[3]=(r[4]+r[5])/2,d[4]=0):(d[3]=n/(6*a)+h,d[4]=a)),d}function NLe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],d=t[l+1];if(h&&d){r[0]=h[0],r[1]=h[1],i[0]=d[0],i[1]=d[1],e&&h.length>2&&d.length>2&&(r[2]=h[2],i[2]=d[2]);const f=u5(r,i);if(f){s+=f;const m=Cpe(h,d);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function FLe(t){const{hasZ:e,numPaths:r}=t;if(r===0)return null;const i=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Ipe(ILe(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],e&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.numPoints?ULe(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function ULe(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const d=t.x,f=t.y,m=t.z;r[0]=l,r[1]=c,i[0]=d,i[1]=f,e&&(r[2]=h,i[2]=m);const y=u5(r,i);if(y){s+=y;const _=Cpe(r,i);n+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=d,c=f,h=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.numPoints?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const VLe=1e-6;function I2t(t){let e=0;for(t.reset();t.nextPath();)e+=Ppe(t);if(e<VLe){const s=FLe(t);return s?[s[0],s[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)kLe(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const zLe=1/3;function kLe(t,e,r){if(!t||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*zLe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const h=Ppe(r),d=[i,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=h,d[1]*=h,t[0]+=d[0],t[1]+=d[1],t}function kt(t=HLe){return[t[0],t[1],t[2],t[3]]}function $2t(t){return[t[0],t[1],t[2],t[3]]}function Ig(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function Lq(t,e,r,i,s=kt()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function $pe(t,e=kt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function h5(t,e){return new _r({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function f2(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function l_(t,e,r){if(e!=null)if("length"in e)cz(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else Ig(r,t)}function U6(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function az(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Qc(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function rp(t){return t[1]>=t[3]?0:t[3]-t[1]}function Lpe(t){return Qc(t)*rp(t)}function Dq(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Dpe(t,e){return d5(t,e[0],e[1])}function FQ(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=r*r}function L2t(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=r,d=(v,w)=>(h-l)*v+(a-c)*w+(c*l-a*h)<0,f=d(i,o),m=d(n,o),y=d(n,s),_=d(i,s);return!(f===m&&m===y&&y===_&&_===f||a<i&&c<i||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function D2t(t,e){return d5(t,e.x,e.y)}function d5(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function BLe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function _R(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function UQ(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function lz(t,e,r){if(e==null)return Ig(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=_e(t[0],i,n),r[1]=_e(t[1],s,o),r[2]=_e(t[2],i,n),r[3]=_e(t[3],s,o),r}function GLe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-Qc(t)/2,0),n=Math.max(Math.abs(e[1]-i)-rp(t)/2,0);return Math.sqrt(s*s+n*n)}function jD(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function vc(t){return t?Ig(t,uz):kt(uz)}function cz(t){return t!=null&&t.length===4}function jLe(t){return!(Qc(t)!==0&&isFinite(t[0])||rp(t)!==0&&isFinite(t[1]))}function mb(t,e){return cz(t)&&cz(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const N2t=[-1/0,-1/0,1/0,1/0],uz=[1/0,1/0,-1/0,-1/0],HLe=[0,0,0,0];function Npe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Fpe(t){return t.points!==void 0}function Upe(t){return t.x!==void 0&&t.y!==void 0}function Vpe(t){return t.paths!==void 0}function zpe(t){return t.rings!==void 0}function kpe(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const H0=kpe(Math.min),q0=kpe(Math.max);function F2t(t,e){return Vpe(e)?W2(t,e.paths,!1,!1):zpe(e)?W2(t,e.rings,!1,!1):Fpe(e)?Nq(t,e.points,!1,!1,!1,!1):Npe(e)?Bpe(t,e):(Upe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function U2t(t){let e,r,i,s;for(t.reset(),e=i=1/0,r=s=-1/0;t.nextPath();){const n=qLe(t);e=Math.min(n[0],e),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return kt([e,i,r,s])}function qLe(t){let e,r,i,s;for(e=i=1/0,r=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),s=Math.max(t.y,s);return kt([e,i,r,s])}function V2t(t,e){return Vpe(e)?W2(t,e.paths,!0,!1):zpe(e)?W2(t,e.rings,!0,!1):Fpe(e)?Nq(t,e.points,!0,!1,!0,!1):Npe(e)?Bpe(t,e,!0,!1,!0,!1):(Upe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function W2(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[d,f]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let _=0;_<y.length;_++){const v=y[_],[w,T]=v;if(c=H0(c,w),h=H0(h,T),d=q0(d,w),f=q0(f,T),r&&v.length>2){const x=v[2];n=H0(n,x),o=q0(o,x)}if(i&&v.length>s){const x=v[s];a=H0(n,x),l=q0(o,x)}}}return r?i?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=d,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=d,t[4]=f,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=h,t[2]=a,t[3]=d,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=d,t[3]=f,t.length=4,t)}function Bpe(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,d=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,d=d||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=d,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function Nq(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,h,d,f,[m,y]=e[0],[_,v]=e[0];for(let w=0;w<e.length;w++){const T=e[w],[x,S]=T;if(m=H0(m,x),y=H0(y,S),_=q0(_,x),v=q0(v,S),l&&T.length>2){const O=T[2];c=H0(c,O),h=q0(h,O)}if(a&&T.length>o){const O=T[o];d=H0(c,O),f=q0(h,O)}}return s?(c=c||0,h=h||0,n?(d=d||0,f=f||0,t[0]=m,t[1]=y,t[2]=c,t[3]=d,t[4]=_,t[5]=v,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=h,t)):n?(d=d||0,f=f||0,t[0]=m,t[1]=y,t[2]=d,t[3]=_,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=y,t[2]=_,t[3]=v,t)}function WLe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function ZLe(t){return t.points!==void 0}function XLe(t){return t.x!==void 0&&t.y!==void 0}function YLe(t){return t.paths!==void 0}function JLe(t){return t.rings!==void 0}const Fq=[];function Gpe(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function jpe(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function Hpe(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function qpe(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function Uq(t,e=!1,r=!1){return e?r?qpe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):jpe(t[0],t[1],t[2],t[3],t[4],t[5]):r?Hpe(t[0],t[1],t[2],t[3],t[4],t[5]):Gpe(t[0],t[1],t[2],t[3])}function z2t(t){return t?WLe(t)?t:XLe(t)?KLe(t):JLe(t)?Wpe(t):YLe(t)?Zpe(t):ZLe(t)?QLe(t):null:null}function QLe(t){const{hasZ:e,hasM:r,points:i}=t;return Uq(Nq(Fq,i,e??!1,r??!1),e,r)}function KLe(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?qpe(e,r,i,s,e,r,i,s):jpe(e,r,i,e,r,i):n?Hpe(e,r,s,e,r,s):Gpe(e,r,e,r)}function Wpe(t){const{hasZ:e,hasM:r,rings:i}=t,s=W2(Fq,i,e??!1,r??!1);return s?Uq(s,e,r):null}function Zpe(t){const{hasZ:e,hasM:r,paths:i}=t,s=W2(Fq,i,e??!1,r??!1);return s?Uq(s,e,r):null}var O$;function VQ(t){return!Array.isArray(t[0])}let Fp=O$=class extends U_{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new O$(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||Ge.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=DLe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new ct;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=Wpe(this);if(!e)return null;const r=new _r(e);return r.spatialReference=t,r}get isSelfIntersecting(){return BIe(this.rings)}writeRings(t,e){e.rings=K(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(VQ(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new O$;return t.spatialReference=this.spatialReference,t.rings=K(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,h,d])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!Og(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=mw(t,this.spatialReference);return IIe(this,e??t)}isClockwise(t){let e;return e=VQ(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,Rpe(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new ct(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new ct(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new ct(r[0],r[1],r[2],r[3],this.spatialReference):new ct(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(q2(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new ct(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new ct(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(q2(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Fp.prototype,"cache",null),u([p({readOnly:!0})],Fp.prototype,"centroid",null),u([p({readOnly:!0})],Fp.prototype,"extent",null),u([p({readOnly:!0})],Fp.prototype,"isSelfIntersecting",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Fp.prototype,"rings",void 0),u([De("rings")],Fp.prototype,"writeRings",null),Fp=O$=u([R("esri.geometry.Polygon")],Fp),Fp.prototype.toJSON.isDefaultToJSON=!0;const Zd=Fp;var hz;function eDe(t){return!Array.isArray(t[0])}let Zy=hz=class extends U_{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||Ge.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=Zpe(this);if(!e)return null;const r=new _r(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=K(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(eDe(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new hz;return t.spatialReference=this.spatialReference,t.paths=K(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new ct(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new ct(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new ct(r[0],r[1],r[2],r[3],this.spatialReference):new ct(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(q2(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new ct(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new ct(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(q2(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([p({readOnly:!0})],Zy.prototype,"cache",null),u([p({readOnly:!0})],Zy.prototype,"extent",null),u([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Zy.prototype,"paths",void 0),u([De("paths")],Zy.prototype,"writePaths",null),Zy=hz=u([R("esri.geometry.Polyline")],Zy),Zy.prototype.toJSON.isDefaultToJSON=!0;const p5=Zy,Xpe=Wa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),zQ=Wa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Ype(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Vq(t){return t.points!==void 0}function zq(t){return t.x!==void 0&&t.y!==void 0}function kq(t){return t.paths!==void 0}function m2(t){return t.rings!==void 0}function g_(t){return t==null?null:t instanceof U_?t:zq(t)?ct.fromJSON(t):kq(t)?p5.fromJSON(t):m2(t)?Zd.fromJSON(t):Vq(t)?yR.fromJSON(t):Ype(t)?_r.fromJSON(t):null}function Bq(t){return t?zq(t)?"esriGeometryPoint":kq(t)?"esriGeometryPolyline":m2(t)?"esriGeometryPolygon":Ype(t)?"esriGeometryEnvelope":Vq(t)?"esriGeometryMultipoint":null:null}const tDe={esriGeometryPoint:ct,esriGeometryPolyline:p5,esriGeometryPolygon:Zd,esriGeometryEnvelope:_r,esriGeometryMultipoint:yR};function rDe(t){return t&&tDe[t]||null}const gw={base:U_,key:"type",typeMap:{extent:_r,multipoint:yR,point:ct,polyline:p5,polygon:Zd}};tp(gw);let Jpe=0;const Gq=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Jpe++})}};return e=u([R("esri.core.Identifiable")],e),e},k2t=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Jpe++})}};return e=u([R("esri.core.NumericIdentifiable")],e),e};let kQ=class extends Gq(class{}){};kQ=u([R("esri.core.Identifiable")],kQ);async function iDe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await ae(()=>import("./portalLayers-bf62775d.js"),["assets/portalLayers-bf62775d.js","assets/lazyLayerLoader-0453090c.js","assets/layersLoader-50532ff0.js","assets/fetchService-cf0ed1b3.js","assets/jsonContext-cef0facd.js"]);try{return await r(e)}catch(i){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Yr.portalUrl;throw Q.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let sDe=0,ro=class extends Ls.EventedMixin(Gq(Pg)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new _r(-180,-90,180,90,Ge.WGS84),this.id=Date.now().toString(16)+"-layer-"+sDe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ge.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await ae(()=>import("./arcgisLayers-7b03856d.js"),["assets/arcgisLayers-7b03856d.js","assets/fetchService-cf0ed1b3.js","assets/lazyLayerLoader-0453090c.js"])).fromUrl(r)}static fromPortalItem(e){return iDe(e)}initialize(){this.when().catch(e=>{ys(e)||Q.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return _o(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Fr(e,{query:{f:"json"},responseType:"json"})).data;throw new U("layer:no-attribution-data","Layer does not have attribution data")}};u([p({type:String})],ro.prototype,"attributionDataUrl",void 0),u([p({type:_r})],ro.prototype,"fullExtent",void 0),u([p({readOnly:!0})],ro.prototype,"hasAttributionData",null),u([p({type:String,clonable:!1})],ro.prototype,"id",void 0),u([p({type:Boolean,nonNullable:!0})],ro.prototype,"legendEnabled",void 0),u([p({type:["show","hide","hide-children"]})],ro.prototype,"listMode",void 0),u([p({type:Number,range:{min:0,max:1},nonNullable:!0})],ro.prototype,"opacity",void 0),u([p({clonable:!1})],ro.prototype,"parent",void 0),u([p({readOnly:!0})],ro.prototype,"parsedUrl",null),u([p({type:Boolean})],ro.prototype,"popupEnabled",void 0),u([p({type:Boolean})],ro.prototype,"attributionVisible",void 0),u([p({type:Ge})],ro.prototype,"spatialReference",void 0),u([p({type:String})],ro.prototype,"title",void 0),u([p({readOnly:!0,json:{read:!1}})],ro.prototype,"type",void 0),u([p()],ro.prototype,"url",void 0),u([p({type:Boolean,nonNullable:!0})],ro.prototype,"visible",void 0),ro=u([R("esri.layers.Layer")],ro);const f5=ro;function dz(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.at(n),(i==null?void 0:i[e])===r)return i;if((i==null?void 0:i.type)==="group"&&(s=dz(i.layers,e,r),s))return s}}const nDe=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new Mt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||Q.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",Lb(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof f5){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else gu(r)?r.then(n=>{this.destroyed||this.add(n,i)}):Q.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return dz(this.layers,"id",r)}findLayerByUid(r){return dz(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([p()],e.prototype,"layers",null),e=u([R("esri.support.LayersMixin")],e),e};function pz(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.at(i);if(n[e]===r)return n;if((n==null?void 0:n.type)==="group"){const o=pz(n.tables,e,r);if(o)return o}}}const oDe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new Mt,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&Q.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",Lb(r,this._get("tables")))}findTableById(r){return pz(this.tables,"id",r)}findTableByUid(r){return pz(this.tables,"uid",r)}};return u([p()],e.prototype,"tables",null),e=u([R("esri.support.TablesMixin")],e),e};let Up=class extends oDe(nDe(Ls.EventedMixin(xe))){constructor(e){super(e),this.allLayers=new mO({getCollections:()=>{var r,i,s;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=RLe(this),this.basemap=null,this.editableLayers=new mO({getCollections:()=>[this.allLayers],itemFilterFunction:SLe}),this.ground=new GD,this._basemapCache=CLe()}destroy(){var e,r;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(r=this.basemap)==null||r.destroy(),ALe(this._basemapCache),this._basemapCache=null}castBasemap(e){return OLe(e,this._basemapCache)}castGround(e){return PLe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};u([p({readOnly:!0,dependsOn:[]})],Up.prototype,"allLayers",void 0),u([p({readOnly:!0})],Up.prototype,"allTables",void 0),u([p({type:ND})],Up.prototype,"basemap",void 0),u([yr("basemap")],Up.prototype,"castBasemap",null),u([p({readOnly:!0})],Up.prototype,"editableLayers",void 0),u([p({type:GD,nonNullable:!0})],Up.prototype,"ground",void 0),u([yr("ground")],Up.prototype,"castGround",null),Up=u([R("esri.Map")],Up);const Qpe=Up,ji=t=>{let e=class extends t{clone(){var l;const r=ec(la(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const c in i){const h=i[c],d=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||d!==hr.USER&&d!==hr.DEFAULTS&&d!==hr.WEB_MAP&&d!==hr.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:TV(m),m!=null&&y==null||(d===hr.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=la(a))==null?void 0:l.store;if(c)for(const[h,d]of o)c.set(h,d,hr.DEFAULTS)}return a}};return e=u([R("esri.core.Clonable")],e),e};let BQ=class extends ji(xe){};BQ=u([R("esri.core.Clonable")],BQ);let y_=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return _e(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function jq(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const aDe=jq(new y_(0,2*Math.PI)),__=jq(new y_(-Math.PI,Math.PI)),Hq=jq(new y_(0,360));let Rm=class extends ji(de){constructor(...e){super(...e),this.position=new ct([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=Qu(e.x||0),n.y=Qu(e.y||0),n.z=e.hasZ?Qu(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new ct;return i.read(e,r),i.x=Qu(i.x||0),i.y=Qu(i.y||0),i.z=i.hasZ?Qu(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([p({type:ct,json:{write:{isRequired:!0}}})],Rm.prototype,"position",void 0),u([De("position")],Rm.prototype,"writePosition",null),u([Se("position")],Rm.prototype,"readPosition",null),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),yr(t=>Hq.normalize(Qu(t)))],Rm.prototype,"heading",void 0),u([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),yr(t=>_e(Qu(t),-180,180))],Rm.prototype,"tilt",void 0),u([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Rm.prototype,"fov",void 0),Rm=u([R("esri.Camera")],Rm);const vh=Rm;var Z2;function lDe(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return Z2.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return Z2.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(Z2||(Z2={}));const cDe=Q.getLogger("esri.support.arcadeOnDemand");let V6;function v_(){return V6||(V6=(async()=>{const t=await ae(()=>import("./arcadeUtils-1f6e32c5.js").then(e=>e.az),["assets/arcadeUtils-1f6e32c5.js","assets/arcadeTimeUtils-e7b7fe91.js","assets/executionError-c92d3b85.js","assets/number-bccc9b73.js","assets/hash-6f442295.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),V6}const uDe=(t,e,r)=>qq.create(t,e,r,null,["$feature"],[]),hDe=(t,e,r)=>qq.create(t,e,r,null,["$feature","$view"],[]),dDe=(t,e,r,i)=>qq.create(t,e,r,i,["$feature","$view"],[]);let qq=class Kpe{constructor(e,r,i,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await v_(),h=Ge.fromJSON(r);let d;try{d=a.parseScript(e,o)}catch($){return cDe.error(new U("arcade-bad-expression","Failed to parse arcade script",{script:e,error:$})),null}const f=n.reduce(($,V)=>({...$,[V]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(d),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(d),T=w&&a.enableAsyncSupport(),x={vars:f,spatialReference:h,useAsync:!!T};await Promise.all([_,v,T]);const S=new Set;await a.loadDependentModules(S,d,null,w,y);const O=new c;O.immutable=!1,O.setField("scale",0);const C=a.compileScript(d,x),P=($,V)=>("$view"in $&&$.$view&&(O.setField("scale",typeof $.$view=="object"&&"scale"in $.$view?$.$view.scale:void 0),$.$view=O),m&&($.$config=m),C({vars:$,spatialReference:h,services:V}));return new Kpe(e,a,d,P,new l,i,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const pDe=/^([0-9_])/,fDe=/[^a-z0-9_\u0080-\uffff]+/gi;function mDe(t){return t==null?null:t.trim().replaceAll(fDe,"_").replace(pDe,"F$1")||null}const gDe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],yDe=["field","normalizationField"];function HD(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(GQ(gDe,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)GQ(yDe,i,e)}}function GQ(t,e,r){if(t)for(const i of t){const s=hR(i,e),n=s&&typeof s!="function"&&r.get(s);n&&Ha(i,n.name,e)}}function efe(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),s=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const i=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const z6=new Set;function m5(t,e){return t&&e?(z6.clear(),gO(z6,t,e),Array.from(z6).sort()):[]}function gO(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of r)ru(t,e,s);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const s of r)s!=null&&t.add(s)}}function ru(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function _De(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function El(t,e,r){var n;if(!r)return;const{arcadeUtils:i}=await v_(),s=i.extractFieldNames(r,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)ru(t,e,o)}async function tfe(t,e,r){if(r&&r!=="1=1"){const{WhereClause:i}=await ae(()=>import("./WhereClause-47630fa1.js").then(n=>n.W),["assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js"]),s=i.create(r,e);if(!s.isStandardized)throw new U("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});gO(t,e,s.fieldNames)}}function vDe({displayField:t,fields:e}){return t||(e&&e.length?k6(e,"name-or-title")||k6(e,"unique-identifier")||k6(e,"type-or-category")||bDe(e):null)}function bDe(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function k6(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function Z2t(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function wDe(t,e,r){r.onStatisticExpression?El(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function X2t(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(xDe(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>wDe(t,e.fieldsIndex,n))),await Promise.all(i)}async function xDe(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(n=>El(t,e.fieldsIndex,n.expression)));const s=r==null?void 0:r.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(El(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function Y2t(t,e,r){e&&(e.timeInfo&&r!=null&&r.timeExtent&&gO(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&gO(t,e.fieldsIndex,[e.floorInfo.floorField]),r!=null&&r.where!=null&&await tfe(t,e.fieldsIndex,r.where))}async function J2t(t,e,r){e&&r&&await Promise.all(r.map(i=>TDe(t,e,i)))}async function TDe(t,e,r){e&&r&&(r.valueExpression?await El(t,e.fieldsIndex,r.valueExpression):r.field&&ru(t,e.fieldsIndex,r.field))}function SDe(t){return t?m5(t.fieldsIndex,rfe(t)):[]}function EDe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?m5(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const CDe=["oid","global-id","guid"],ADe=["oid","global-id"],ODe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function RDe(t){const e=new Set;ife(t).forEach(i=>e.add(i)),EDe(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function rfe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=e;return[r,i,s,n].filter(Boolean)}function ife(t){return rfe(t).map(e=>e.toLowerCase())}function PDe(t,e){var r;return t.editable&&!CDe.includes(t.type)&&!ife(e).includes(((r=t.name)==null?void 0:r.toLowerCase())??"")}function MDe(t,e){var i;const r=((i=t.name)==null?void 0:i.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&r===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&r===e.globalIdField.toLowerCase()||RDe(e).includes(r)||ADe.includes(t.type)||ODe.some(s=>s.test(r)))}async function Q2t(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(s=>IDe(t,i,s)))}async function IDe(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await El(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{ru(t,e,o.slice(1,-1))})}await tfe(t,e,s)}function $De(t){const e=t.defaultValue;return e!==void 0&&ofe(t,e)?e:t.nullable?null:void 0}function sfe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function LDe(t){return t===null||sfe(t)}const Wq="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function DDe(t){return t===null||Wq(t)}function nfe(t){return t!=null&&typeof t=="string"}function NDe(t){return t===null||nfe(t)}function FDe(){return!0}function ofe(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?DDe:Wq;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?LDe:sfe;break;case"string":case"esriFieldTypeString":r=t.nullable?NDe:nfe;break;default:r=FDe}return arguments.length===1?r:r(e)}const UDe=["integer","small-integer","single","double"],VDe=new Set([...UDe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),zDe=["date","date-only","time-only","timestamp-offset"],kDe=new Set([...zDe,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function Zq(t){return t!=null&&VDe.has(t.type)}function K2t(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function eSt(t){return t!=null&&kDe.has(t.type)}var qD,WD;function tSt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function rSt(t,e){return t==null||t.nullable&&e===null?null:Zq(t)&&!BDe(t.type,Number(e))?qD.OUT_OF_RANGE:ofe(t,e)?t.domain?lDe(t.domain,e):null:WD.INVALID_TYPE}function BDe(t,e){const r=typeof t=="string"?afe(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?Wq(e)&&e>=i&&e<=s:e>=i&&e<=s}function afe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return GDe;case"esriFieldTypeInteger":case"integer":return jDe;case"esriFieldTypeBigInteger":case"big-integer":return HDe;case"esriFieldTypeSingle":case"single":return qDe;case"esriFieldTypeDouble":case"double":return WDe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(qD||(qD={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(WD||(WD={}));const GDe={min:-32768,max:32767,isInteger:!0},jDe={min:-2147483648,max:2147483647,isInteger:!0},HDe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},qDe={min:-34e37,max:12e37,isInteger:!1},WDe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function iSt(t,e,r){switch(t){case Z2.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case Z2.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case WD.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case qD.OUT_OF_RANGE:{const{min:i,max:s}=afe(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function sSt(t,e){return!ZDe(t,e,null)}function ZDe(t,e,r){if(!e||!e.attributes||!t){if(r!=null)for(const n of t??[])r.add(n);return!0}const i=e.attributes;let s=!1;for(const n of t)if(!(n in i)){if(s=!0,r==null)break;r.add(n)}return s}function XDe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let R$=class extends de{constructor(e){super(e),this.type=null}};u([p({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],R$.prototype,"type",void 0),R$=u([R("esri.popup.content.Content")],R$);const V_=R$;var fz;let kv=fz=class extends V_{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new fz({description:this.description,displayType:this.displayType,title:this.title})}};u([p({type:String,json:{write:!0}})],kv.prototype,"description",void 0),u([p({type:["auto","preview","list"],json:{write:!0}})],kv.prototype,"displayType",void 0),u([p({type:String,json:{write:!0}})],kv.prototype,"title",void 0),u([p({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],kv.prototype,"type",void 0),kv=fz=u([R("esri.popup.content.AttachmentsContent")],kv);const yO=kv;var mz;let Bv=mz=class extends V_{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new mz({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?K(this.outFields):null})}};u([p()],Bv.prototype,"creator",void 0),u([p()],Bv.prototype,"destroyer",void 0),u([p()],Bv.prototype,"outFields",void 0),u([p({type:["custom"],readOnly:!0})],Bv.prototype,"type",void 0),Bv=mz=u([R("esri.popup.content.CustomContent")],Bv);const YDe=Bv;var gz;let Wx=gz=class extends de{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new gz({title:this.title,expression:this.expression})}};u([p({type:String,json:{write:!0}})],Wx.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],Wx.prototype,"expression",void 0),u([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Wx.prototype,"returnType",void 0),Wx=gz=u([R("esri.popup.ElementExpressionInfo")],Wx);const JDe=Wx;var yz;let IC=yz=class extends V_{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new yz({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([p({type:JDe,json:{write:!0}})],IC.prototype,"expressionInfo",void 0),u([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],IC.prototype,"type",void 0),IC=yz=u([R("esri.popup.content.ExpressionContent")],IC);const Xq=IC;class yw extends Error{}class QDe extends yw{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class KDe extends yw{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class eNe extends yw{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class $C extends yw{}class lfe extends yw{constructor(e){super(`Invalid unit ${e}`)}}class Ku extends yw{}class fy extends yw{constructor(){super("Zone is an abstract class")}}const qe="numeric",ip="short",iu="long",ZD={year:qe,month:qe,day:qe},cfe={year:qe,month:ip,day:qe},tNe={year:qe,month:ip,day:qe,weekday:ip},ufe={year:qe,month:iu,day:qe},hfe={year:qe,month:iu,day:qe,weekday:iu},dfe={hour:qe,minute:qe},pfe={hour:qe,minute:qe,second:qe},ffe={hour:qe,minute:qe,second:qe,timeZoneName:ip},mfe={hour:qe,minute:qe,second:qe,timeZoneName:iu},gfe={hour:qe,minute:qe,hourCycle:"h23"},yfe={hour:qe,minute:qe,second:qe,hourCycle:"h23"},_fe={hour:qe,minute:qe,second:qe,hourCycle:"h23",timeZoneName:ip},vfe={hour:qe,minute:qe,second:qe,hourCycle:"h23",timeZoneName:iu},bfe={year:qe,month:qe,day:qe,hour:qe,minute:qe},wfe={year:qe,month:qe,day:qe,hour:qe,minute:qe,second:qe},xfe={year:qe,month:ip,day:qe,hour:qe,minute:qe},Tfe={year:qe,month:ip,day:qe,hour:qe,minute:qe,second:qe},rNe={year:qe,month:ip,day:qe,weekday:ip,hour:qe,minute:qe},Sfe={year:qe,month:iu,day:qe,hour:qe,minute:qe,timeZoneName:ip},Efe={year:qe,month:iu,day:qe,hour:qe,minute:qe,second:qe,timeZoneName:ip},Cfe={year:qe,month:iu,day:qe,weekday:iu,hour:qe,minute:qe,timeZoneName:iu},Afe={year:qe,month:iu,day:qe,weekday:iu,hour:qe,minute:qe,second:qe,timeZoneName:iu};class vR{get type(){throw new fy}get name(){throw new fy}get ianaName(){return this.name}get isUniversal(){throw new fy}offsetName(e,r){throw new fy}formatOffset(e,r){throw new fy}offset(e){throw new fy}equals(e){throw new fy}get isValid(){throw new fy}}let B6=null;class g5 extends vR{static get instance(){return B6===null&&(B6=new g5),B6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return Rfe(e,r,i)}formatOffset(e,r){return mA(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let P$={};function iNe(t){return P$[t]||(P$[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),P$[t]}const sNe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function nNe(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,h]=i;return[o,s,n,a,l,c,h]}function oNe(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=sNe[n];n==="era"?i[a]=o:si(a)||(i[a]=parseInt(o,10))}return i}let TP={};class $g extends vR{static create(e){return TP[e]||(TP[e]=new $g(e)),TP[e]}static resetCache(){TP={},P$={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=$g.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return Rfe(e,r,i,this.name)}formatOffset(e,r){return mA(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=iNe(this.name);let[s,n,o,a,l,c,h]=i.formatToParts?oNe(i,r):nNe(i,r);a==="BC"&&(s=-Math.abs(s)+1);const f=Qq({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+r;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let jQ={};function aNe(t,e={}){const r=JSON.stringify([t,e]);let i=jQ[r];return i||(i=new Intl.ListFormat(t,e),jQ[r]=i),i}let _z={};function vz(t,e={}){const r=JSON.stringify([t,e]);let i=_z[r];return i||(i=new Intl.DateTimeFormat(t,e),_z[r]=i),i}let bz={};function lNe(t,e={}){const r=JSON.stringify([t,e]);let i=bz[r];return i||(i=new Intl.NumberFormat(t,e),bz[r]=i),i}let wz={};function cNe(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=wz[s];return n||(n=new Intl.RelativeTimeFormat(t,e),wz[s]=n),n}let LC=null;function uNe(){return LC||(LC=new Intl.DateTimeFormat().resolvedOptions().locale,LC)}function hNe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=vz(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=vz(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function dNe(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function pNe(t){const e=[];for(let r=1;r<=12;r++){const i=gr.utc(2016,r,1);e.push(t(i))}return e}function fNe(t){const e=[];for(let r=1;r<=7;r++){const i=gr.utc(2016,11,13+r);e.push(t(i))}return e}function SP(t,e,r,i,s){const n=t.listingMode(r);return n==="error"?null:n==="en"?i(e):s(e)}function mNe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class gNe{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=lNe(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):Jq(e,3);return kn(r,this.padTo)}}}class yNe{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&$g.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=vz(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class _Ne{constructor(e,r,i){this.opts={style:"long",...i},!r&&Ofe()&&(this.rtf=cNe(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):DNe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class Es{static fromOpts(e){return Es.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const n=e||Vn.defaultLocale,o=n||(s?"en-US":uNe()),a=r||Vn.defaultNumberingSystem,l=i||Vn.defaultOutputCalendar;return new Es(o,a,l,n)}static resetCache(){LC=null,_z={},bz={},wz={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return Es.create(e,r,i)}constructor(e,r,i,s){const[n,o,a]=hNe(e);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=dNe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=mNe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Es.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return SP(this,e,i,Ife,()=>{const s=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=pNe(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1,i=!0){return SP(this,e,i,Dfe,()=>{const s=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=fNe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return SP(this,void 0,e,()=>Nfe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[gr.utc(2016,11,13,9),gr.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return SP(this,e,r,Ffe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[gr.utc(-40,1,1),gr.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new gNe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new yNe(e,this.intl,r)}relFormatter(e={}){return new _Ne(this.intl,this.isEnglish(),e)}listFormatter(e={}){return aNe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let G6=null;class ka extends vR{static get utcInstance(){return G6===null&&(G6=new ka(0)),G6}static instance(e){return e===0?ka.utcInstance:new ka(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new ka(_5(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${mA(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${mA(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return mA(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class vNe extends vR{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function $0(t,e){if(si(t)||t===null)return e;if(t instanceof vR)return t;if(bNe(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?g5.instance:r==="utc"||r==="gmt"?ka.utcInstance:ka.parseSpecifier(r)||$g.create(t)}else return gb(t)?ka.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new vNe(t)}let HQ=()=>Date.now(),qQ="system",WQ=null,ZQ=null,XQ=null,YQ=60,JQ;class Vn{static get now(){return HQ}static set now(e){HQ=e}static set defaultZone(e){qQ=e}static get defaultZone(){return $0(qQ,g5.instance)}static get defaultLocale(){return WQ}static set defaultLocale(e){WQ=e}static get defaultNumberingSystem(){return ZQ}static set defaultNumberingSystem(e){ZQ=e}static get defaultOutputCalendar(){return XQ}static set defaultOutputCalendar(e){XQ=e}static get twoDigitCutoffYear(){return YQ}static set twoDigitCutoffYear(e){YQ=e%100}static get throwOnInvalid(){return JQ}static set throwOnInvalid(e){JQ=e}static resetCaches(){Es.resetCache(),$g.resetCache()}}function si(t){return typeof t>"u"}function gb(t){return typeof t=="number"}function y5(t){return typeof t=="number"&&t%1===0}function bNe(t){return typeof t=="string"}function wNe(t){return Object.prototype.toString.call(t)==="[object Date]"}function Ofe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function xNe(t){return Array.isArray(t)?t:[t]}function QQ(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function TNe(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function X2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function hg(t,e,r){return y5(t)&&t>=e&&t<=r}function SNe(t,e){return t-e*Math.floor(t/e)}function kn(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function S0(t){if(!(si(t)||t===null||t===""))return parseInt(t,10)}function iv(t){if(!(si(t)||t===null||t===""))return parseFloat(t)}function Yq(t){if(!(si(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Jq(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function bR(t){return t%4===0&&(t%100!==0||t%400===0)}function fA(t){return bR(t)?366:365}function XD(t,e){const r=SNe(e-1,12)+1,i=t+(e-r)/12;return r===2?bR(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function Qq(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function YD(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function xz(t){return t>99?t:t>Vn.twoDigitCutoffYear?1900+t:2e3+t}function Rfe(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function _5(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function Pfe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Ku(`Invalid unit value ${t}`);return e}function JD(t,e){const r={};for(const i in t)if(X2(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=Pfe(s)}return r}function mA(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${kn(r,2)}:${kn(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${kn(r,2)}${kn(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function v5(t){return TNe(t,["hour","minute","second","millisecond"])}const ENe=["January","February","March","April","May","June","July","August","September","October","November","December"],Mfe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],CNe=["J","F","M","A","M","J","J","A","S","O","N","D"];function Ife(t){switch(t){case"narrow":return[...CNe];case"short":return[...Mfe];case"long":return[...ENe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const $fe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Lfe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ANe=["M","T","W","T","F","S","S"];function Dfe(t){switch(t){case"narrow":return[...ANe];case"short":return[...Lfe];case"long":return[...$fe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Nfe=["AM","PM"],ONe=["Before Christ","Anno Domini"],RNe=["BC","AD"],PNe=["B","A"];function Ffe(t){switch(t){case"narrow":return[...PNe];case"short":return[...RNe];case"long":return[...ONe];default:return null}}function MNe(t){return Nfe[t.hour<12?0:1]}function INe(t,e){return Dfe(e)[t.weekday-1]}function $Ne(t,e){return Ife(e)[t.month-1]}function LNe(t,e){return Ffe(e)[t.year<0?0:1]}function DNe(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function KQ(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const NNe={D:ZD,DD:cfe,DDD:ufe,DDDD:hfe,t:dfe,tt:pfe,ttt:ffe,tttt:mfe,T:gfe,TT:yfe,TTT:_fe,TTTT:vfe,f:bfe,ff:xfe,fff:Sfe,ffff:Cfe,F:wfe,FF:Tfe,FFF:Efe,FFFF:Afe};class Ua{static create(e,r={}){return new Ua(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return NNe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return kn(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>i?MNe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>i?$Ne(e,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>i?INe(e,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=Ua.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},d=m=>i?LNe(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return KQ(Ua.parseFormat(r),f)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},n=Ua.parseFormat(r),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return KQ(n,s(a))}}class Fd{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Ufe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function GS(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function jS(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function HS(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function Vfe(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=S0(e[r+s]);return[i,null,r+s]}}const zfe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,FNe=`(?:${zfe.source}?(?:\\[(${Ufe.source})\\])?)?`,Kq=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,kfe=RegExp(`${Kq.source}${FNe}`),eW=RegExp(`(?:T${kfe.source})?`),UNe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,VNe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,zNe=/(\d{4})-?(\d{3})/,kNe=Vfe("weekYear","weekNumber","weekDay"),BNe=Vfe("year","ordinal"),GNe=/(\d{4})-(\d\d)-(\d\d)/,Bfe=RegExp(`${Kq.source} ?(?:${zfe.source}|(${Ufe.source}))?`),jNe=RegExp(`(?: ${Bfe.source})?`);function g2(t,e,r){const i=t[e];return si(i)?r:S0(i)}function HNe(t,e){return[{year:g2(t,e),month:g2(t,e+1,1),day:g2(t,e+2,1)},null,e+3]}function qS(t,e){return[{hours:g2(t,e,0),minutes:g2(t,e+1,0),seconds:g2(t,e+2,0),milliseconds:Yq(t[e+3])},null,e+4]}function wR(t,e){const r=!t[e]&&!t[e+1],i=_5(t[e+1],t[e+2]),s=r?null:ka.instance(i);return[{},s,e+3]}function xR(t,e){const r=t[e]?$g.create(t[e]):null;return[{},r,e+1]}const qNe=RegExp(`^T?${Kq.source}$`),WNe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function ZNe(t){const[e,r,i,s,n,o,a,l,c]=t,h=e[0]==="-",d=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(iv(r)),months:f(iv(i)),weeks:f(iv(s)),days:f(iv(n)),hours:f(iv(o)),minutes:f(iv(a)),seconds:f(iv(l),l==="-0"),milliseconds:f(Yq(c),d)}]}const XNe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function tW(t,e,r,i,s,n,o){const a={year:e.length===2?xz(S0(e)):S0(e),month:Mfe.indexOf(r)+1,day:S0(i),hour:S0(s),minute:S0(n)};return o&&(a.second=S0(o)),t&&(a.weekday=t.length>3?$fe.indexOf(t)+1:Lfe.indexOf(t)+1),a}const YNe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function JNe(t){const[,e,r,i,s,n,o,a,l,c,h,d]=t,f=tW(e,s,i,r,n,o,a);let m;return l?m=XNe[l]:c?m=0:m=_5(h,d),[f,new ka(m)]}function QNe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const KNe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,e4e=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,t4e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function eK(t){const[,e,r,i,s,n,o,a]=t;return[tW(e,s,i,r,n,o,a),ka.utcInstance]}function r4e(t){const[,e,r,i,s,n,o,a]=t;return[tW(e,a,r,i,s,n,o),ka.utcInstance]}const i4e=GS(UNe,eW),s4e=GS(VNe,eW),n4e=GS(zNe,eW),o4e=GS(kfe),Gfe=jS(HNe,qS,wR,xR),a4e=jS(kNe,qS,wR,xR),l4e=jS(BNe,qS,wR,xR),c4e=jS(qS,wR,xR);function u4e(t){return HS(t,[i4e,Gfe],[s4e,a4e],[n4e,l4e],[o4e,c4e])}function h4e(t){return HS(QNe(t),[YNe,JNe])}function d4e(t){return HS(t,[KNe,eK],[e4e,eK],[t4e,r4e])}function p4e(t){return HS(t,[WNe,ZNe])}const f4e=jS(qS);function m4e(t){return HS(t,[qNe,f4e])}const g4e=GS(GNe,jNe),y4e=GS(Bfe),_4e=jS(qS,wR,xR);function v4e(t){return HS(t,[g4e,Gfe],[y4e,_4e])}const b4e="Invalid Duration",jfe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},w4e={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...jfe},_u=146097/400,Nw=146097/4800,x4e={years:{quarters:4,months:12,weeks:_u/7,days:_u,hours:_u*24,minutes:_u*24*60,seconds:_u*24*60*60,milliseconds:_u*24*60*60*1e3},quarters:{months:3,weeks:_u/28,days:_u/4,hours:_u*24/4,minutes:_u*24*60/4,seconds:_u*24*60*60/4,milliseconds:_u*24*60*60*1e3/4},months:{weeks:Nw/7,days:Nw,hours:Nw*24,minutes:Nw*24*60,seconds:Nw*24*60*60,milliseconds:Nw*24*60*60*1e3},...jfe},Gv=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],T4e=Gv.slice(0).reverse();function my(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new di(i)}function S4e(t){return t<0?Math.floor(t):Math.ceil(t)}function Hfe(t,e,r,i,s){const n=t[s][r],o=e[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?S4e(o):Math.trunc(o);i[s]+=l,e[r]-=l*n}function E4e(t,e){T4e.reduce((r,i)=>si(e[i])?r:(r&&Hfe(t,e,r,e,i),i),null)}function C4e(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class di{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?x4e:w4e;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||Es.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return di.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new Ku(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new di({values:JD(e,di.normalizeUnit),loc:Es.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(gb(e))return di.fromMillis(e);if(di.isDuration(e))return e;if(typeof e=="object")return di.fromObject(e);throw new Ku(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=p4e(e);return i?di.fromObject(i,r):di.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=m4e(e);return i?di.fromObject(i,r):di.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new Ku("need to specify a reason the Duration is invalid");const i=e instanceof Fd?e:new Fd(e,r);if(Vn.throwOnInvalid)throw new eNe(i);return new di({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new lfe(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Ua.create(this.loc,i).formatDurationFromString(this,e):b4e}toHuman(e={}){const r=Gv.map(i=>{const s=this.values[i];return si(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Jq(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=di.fromDurationLike(e),i={};for(const s of Gv)(X2(r.values,s)||X2(this.values,s))&&(i[s]=r.get(s)+this.get(s));return my(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=di.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=Pfe(e(this.values[i],i));return my(this,{values:r},!0)}get(e){return this[di.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...JD(e,di.normalizeUnit)};return my(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return my(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return E4e(this.matrix,e),my(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=C4e(this.normalize().shiftToAll().toObject());return my(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>di.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of Gv)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;gb(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)Gv.indexOf(c)>Gv.indexOf(o)&&Hfe(this.matrix,s,c,r,o)}else gb(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return my(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return my(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of Gv)if(!r(this.values[i],e.values[i]))return!1;return!0}}const Fw="Invalid Interval";function A4e(t,e){return!t||!t.isValid?Ys.invalid("missing or invalid start"):!e||!e.isValid?Ys.invalid("missing or invalid end"):e<t?Ys.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Ys{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new Ku("need to specify a reason the Interval is invalid");const i=e instanceof Fd?e:new Fd(e,r);if(Vn.throwOnInvalid)throw new KDe(i);return new Ys({invalid:i})}static fromDateTimes(e,r){const i=SE(e),s=SE(r),n=A4e(i,s);return n??new Ys({start:i,end:s})}static after(e,r){const i=di.fromDurationLike(r),s=SE(e);return Ys.fromDateTimes(s,s.plus(i))}static before(e,r){const i=di.fromDurationLike(r),s=SE(e);return Ys.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=gr.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=gr.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return Ys.fromDateTimes(n,a);if(o){const c=di.fromISO(s,r);if(c.isValid)return Ys.after(n,c)}else if(l){const c=di.fromISO(i,r);if(c.isValid)return Ys.before(a,c)}}return Ys.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Ys.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(SE).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(Ys.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=di.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Ys.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Ys.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Ys.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(Ys.fromDateTimes(r,l.time)),r=null);return Ys.merge(s)}difference(...e){return Ys.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Fw}toLocaleString(e=ZD,r={}){return this.isValid?Ua.create(this.s.loc.clone(r),e).formatInterval(this):Fw}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Fw}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Fw}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Fw}toFormat(e,{separator:r=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:Fw}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):di.invalid(this.invalidReason)}mapEndpoints(e){return Ys.fromDateTimes(e(this.s),e(this.e))}}class EP{static hasDST(e=Vn.defaultZone){const r=gr.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return $g.isValidZone(e)}static normalizeZone(e){return $0(e,Vn.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Es.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Es.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Es.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Es.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Es.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return Es.create(r,null,"gregory").eras(e)}static features(){return{relative:Ofe()}}}function tK(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(di.fromMillis(i).as("days"))}function O4e(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=tK(l,c);return(h-h%7)/7}],["days",tK]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function R4e(t,e,r,i){let[s,n,o,a]=O4e(t,e,r);const l=e-s,c=r.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=di.fromObject(n,i);return c.length>0?di.fromMillis(l,i).shiftTo(...c).plus(h):h}const rW={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},rK={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},P4e=rW.hanidec.replace(/[\[|\]]/g,"").split("");function M4e(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(rW.hanidec)!==-1)e+=P4e.indexOf(t[r]);else for(const s in rK){const[n,o]=rK[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function Vh({numberingSystem:t},e=""){return new RegExp(`${rW[t||"latn"]}${e}`)}const I4e="missing Intl.DateTimeFormat.formatToParts support";function Ai(t,e=r=>r){return{regex:t,deser:([r])=>e(M4e(r))}}const $4e=String.fromCharCode(160),qfe=`[ ${$4e}]`,Wfe=new RegExp(qfe,"g");function L4e(t){return t.replace(/\./g,"\\.?").replace(Wfe,qfe)}function iK(t){return t.replace(/\./g,"").replace(Wfe," ").toLowerCase()}function zh(t,e){return t===null?null:{regex:RegExp(t.map(L4e).join("|")),deser:([r])=>t.findIndex(i=>iK(r)===iK(i))+e}}function sK(t,e){return{regex:t,deser:([,r,i])=>_5(r,i),groups:e}}function CP(t){return{regex:t,deser:([e])=>e}}function D4e(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function N4e(t,e){const r=Vh(e),i=Vh(e,"{2}"),s=Vh(e,"{3}"),n=Vh(e,"{4}"),o=Vh(e,"{6}"),a=Vh(e,"{1,2}"),l=Vh(e,"{1,3}"),c=Vh(e,"{1,6}"),h=Vh(e,"{1,9}"),d=Vh(e,"{2,4}"),f=Vh(e,"{4,6}"),m=v=>({regex:RegExp(D4e(v.val)),deser:([w])=>w,literal:!0}),_=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return zh(e.eras("short",!1),0);case"GG":return zh(e.eras("long",!1),0);case"y":return Ai(c);case"yy":return Ai(d,xz);case"yyyy":return Ai(n);case"yyyyy":return Ai(f);case"yyyyyy":return Ai(o);case"M":return Ai(a);case"MM":return Ai(i);case"MMM":return zh(e.months("short",!0,!1),1);case"MMMM":return zh(e.months("long",!0,!1),1);case"L":return Ai(a);case"LL":return Ai(i);case"LLL":return zh(e.months("short",!1,!1),1);case"LLLL":return zh(e.months("long",!1,!1),1);case"d":return Ai(a);case"dd":return Ai(i);case"o":return Ai(l);case"ooo":return Ai(s);case"HH":return Ai(i);case"H":return Ai(a);case"hh":return Ai(i);case"h":return Ai(a);case"mm":return Ai(i);case"m":return Ai(a);case"q":return Ai(a);case"qq":return Ai(i);case"s":return Ai(a);case"ss":return Ai(i);case"S":return Ai(l);case"SSS":return Ai(s);case"u":return CP(h);case"uu":return CP(a);case"uuu":return Ai(r);case"a":return zh(e.meridiems(),0);case"kkkk":return Ai(n);case"kk":return Ai(d,xz);case"W":return Ai(a);case"WW":return Ai(i);case"E":case"c":return Ai(r);case"EEE":return zh(e.weekdays("short",!1,!1),1);case"EEEE":return zh(e.weekdays("long",!1,!1),1);case"ccc":return zh(e.weekdays("short",!0,!1),1);case"cccc":return zh(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return sK(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return sK(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return CP(/[a-z_+-/]{1,256}?/i);case" ":return CP(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:I4e};return _.token=t,_}const F4e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function U4e(t,e){const{type:r,value:i}=t;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const s=e[r];let n=F4e[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function V4e(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function z4e(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(X2(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function k4e(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return si(t.z)||(r=$g.create(t.z)),si(t.Z)||(r||(r=new ka(t.Z)),i=t.Z),si(t.q)||(t.M=(t.q-1)*3+1),si(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),si(t.u)||(t.S=Yq(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let j6=null;function B4e(){return j6||(j6=gr.fromMillis(1555555555555)),j6}function G4e(t,e){if(t.literal)return t;const r=Ua.macroTokenToFormatOpts(t.val),i=Yfe(r,e);return i==null||i.includes(void 0)?t:i}function Zfe(t,e){return Array.prototype.concat(...t.map(r=>G4e(r,e)))}function Xfe(t,e,r){const i=Zfe(Ua.parseFormat(r),t),s=i.map(o=>N4e(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=V4e(s),l=RegExp(o,"i"),[c,h]=z4e(e,l,a),[d,f,m]=h?k4e(h):[null,null,void 0];if(X2(h,"a")&&X2(h,"H"))throw new $C("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:h,result:d,zone:f,specificOffset:m}}}function j4e(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=Xfe(t,e,r);return[i,s,n,o]}function Yfe(t,e){return t?Ua.create(e,t).formatDateTimeParts(B4e()).map(s=>U4e(s,t)):null}const Jfe=[0,31,59,90,120,151,181,212,243,273,304,334],Qfe=[0,31,60,91,121,152,182,213,244,274,305,335];function uh(t,e){return new Fd("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Kfe(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function eme(t,e,r){return r+(bR(t)?Qfe:Jfe)[e-1]}function tme(t,e){const r=bR(t)?Qfe:Jfe,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function Tz(t){const{year:e,month:r,day:i}=t,s=eme(e,r,i),n=Kfe(e,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=YD(a)):o>YD(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...v5(t)}}function nK(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=Kfe(e,1,4),n=fA(e);let o=r*7+i-s-3,a;o<1?(a=e-1,o+=fA(a)):o>n?(a=e+1,o-=fA(e)):a=e;const{month:l,day:c}=tme(a,o);return{year:a,month:l,day:c,...v5(t)}}function H6(t){const{year:e,month:r,day:i}=t,s=eme(e,r,i);return{year:e,ordinal:s,...v5(t)}}function oK(t){const{year:e,ordinal:r}=t,{month:i,day:s}=tme(e,r);return{year:e,month:i,day:s,...v5(t)}}function H4e(t){const e=y5(t.weekYear),r=hg(t.weekNumber,1,YD(t.weekYear)),i=hg(t.weekday,1,7);return e?r?i?!1:uh("weekday",t.weekday):uh("week",t.week):uh("weekYear",t.weekYear)}function q4e(t){const e=y5(t.year),r=hg(t.ordinal,1,fA(t.year));return e?r?!1:uh("ordinal",t.ordinal):uh("year",t.year)}function rme(t){const e=y5(t.year),r=hg(t.month,1,12),i=hg(t.day,1,XD(t.year,t.month));return e?r?i?!1:uh("day",t.day):uh("month",t.month):uh("year",t.year)}function ime(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=hg(e,0,23)||e===24&&r===0&&i===0&&s===0,o=hg(r,0,59),a=hg(i,0,59),l=hg(s,0,999);return n?o?a?l?!1:uh("millisecond",s):uh("second",i):uh("minute",r):uh("hour",e)}const q6="Invalid DateTime",aK=864e13;function AP(t){return new Fd("unsupported zone",`the zone "${t.name}" is not supported`)}function W6(t){return t.weekData===null&&(t.weekData=Tz(t.c)),t.weekData}function xE(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new gr({...r,...e,old:r})}function sme(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function lK(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function M$(t,e,r){return sme(Qq(t),e,r)}function cK(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,XD(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=di.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Qq(n);let[l,c]=sme(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function TE(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=gr.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return gr.invalid(new Fd("unparsable",`the input "${s}" can't be parsed as ${i}`))}function OP(t,e,r=!0){return t.isValid?Ua.create(Es.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function Z6(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=kn(t.c.year,r?6:4),e?(i+="-",i+=kn(t.c.month),i+="-",i+=kn(t.c.day)):(i+=kn(t.c.month),i+=kn(t.c.day)),i}function uK(t,e,r,i,s,n){let o=kn(t.c.hour);return e?(o+=":",o+=kn(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=kn(t.c.minute),(t.c.second!==0||!r)&&(o+=kn(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=kn(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=kn(Math.trunc(-t.o/60)),o+=":",o+=kn(Math.trunc(-t.o%60))):(o+="+",o+=kn(Math.trunc(t.o/60)),o+=":",o+=kn(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const nme={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},W4e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Z4e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},ome=["year","month","day","hour","minute","second","millisecond"],X4e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Y4e=["year","ordinal","hour","minute","second","millisecond"];function hK(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new lfe(t);return e}function dK(t,e){const r=$0(e.zone,Vn.defaultZone),i=Es.fromObject(e),s=Vn.now();let n,o;if(si(t.year))n=s;else{for(const c of ome)si(t[c])&&(t[c]=nme[c]);const a=rme(t)||ime(t);if(a)return gr.invalid(a);const l=r.offset(s);[n,o]=M$(t,l,r)}return new gr({ts:n,zone:r,loc:i,o})}function pK(t,e,r){const i=si(r.round)?!0:r.round,s=(o,a)=>(o=Jq(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function fK(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class gr{constructor(e){const r=e.zone||Vn.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Fd("invalid input"):null)||(r.isValid?null:AP(r));this.ts=si(e.ts)?Vn.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=lK(this.ts,a),i=Number.isNaN(s.year)?new Fd("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||Es.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new gr({})}static local(){const[e,r]=fK(arguments),[i,s,n,o,a,l,c]=r;return dK({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=fK(arguments),[i,s,n,o,a,l,c]=r;return e.zone=ka.utcInstance,dK({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=wNe(e)?e.valueOf():NaN;if(Number.isNaN(i))return gr.invalid("invalid input");const s=$0(r.zone,Vn.defaultZone);return s.isValid?new gr({ts:i,zone:s,loc:Es.fromObject(r)}):gr.invalid(AP(s))}static fromMillis(e,r={}){if(gb(e))return e<-aK||e>aK?gr.invalid("Timestamp out of range"):new gr({ts:e,zone:$0(r.zone,Vn.defaultZone),loc:Es.fromObject(r)});throw new Ku(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(gb(e))return new gr({ts:e*1e3,zone:$0(r.zone,Vn.defaultZone),loc:Es.fromObject(r)});throw new Ku("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=$0(r.zone,Vn.defaultZone);if(!i.isValid)return gr.invalid(AP(i));const s=Vn.now(),n=si(r.specificOffset)?i.offset(s):r.specificOffset,o=JD(e,hK),a=!si(o.ordinal),l=!si(o.year),c=!si(o.month)||!si(o.day),h=l||c,d=o.weekYear||o.weekNumber,f=Es.fromObject(r);if((h||a)&&d)throw new $C("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new $C("Can't mix ordinal dates with month/day");const m=d||o.weekday&&!h;let y,_,v=lK(s,n);m?(y=X4e,_=W4e,v=Tz(v)):a?(y=Y4e,_=Z4e,v=H6(v)):(y=ome,_=nme);let w=!1;for(const $ of y){const V=o[$];si(V)?w?o[$]=_[$]:o[$]=v[$]:w=!0}const T=m?H4e(o):a?q4e(o):rme(o),x=T||ime(o);if(x)return gr.invalid(x);const S=m?nK(o):a?oK(o):o,[O,C]=M$(S,n,i),P=new gr({ts:O,zone:i,o:C,loc:f});return o.weekday&&h&&e.weekday!==P.weekday?gr.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${P.toISO()}`):P}static fromISO(e,r={}){const[i,s]=u4e(e);return TE(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=h4e(e);return TE(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=d4e(e);return TE(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(si(e)||si(r))throw new Ku("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=Es.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=j4e(o,e,r);return h?gr.invalid(h):TE(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return gr.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=v4e(e);return TE(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new Ku("need to specify a reason the DateTime is invalid");const i=e instanceof Fd?e:new Fd(e,r);if(Vn.throwOnInvalid)throw new QDe(i);return new gr({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=Yfe(e,Es.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return Zfe(Ua.parseFormat(e),Es.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?W6(this).weekYear:NaN}get weekNumber(){return this.isValid?W6(this).weekNumber:NaN}get weekday(){return this.isValid?W6(this).weekday:NaN}get ordinal(){return this.isValid?H6(this.c).ordinal:NaN}get monthShort(){return this.isValid?EP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?EP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?EP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?EP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return bR(this.year)}get daysInMonth(){return XD(this.year,this.month)}get daysInYear(){return this.isValid?fA(this.year):NaN}get weeksInWeekYear(){return this.isValid?YD(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=Ua.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(ka.instance(e),r)}toLocal(){return this.setZone(Vn.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=$0(e,Vn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=M$(o,n,e)}return xE(this,{ts:s,zone:e})}else return gr.invalid(AP(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return xE(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=JD(e,hK),i=!si(r.weekYear)||!si(r.weekNumber)||!si(r.weekday),s=!si(r.ordinal),n=!si(r.year),o=!si(r.month)||!si(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new $C("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new $C("Can't mix ordinal dates with month/day");let c;i?c=nK({...Tz(this.c),...r}):si(r.ordinal)?(c={...this.toObject(),...r},si(r.day)&&(c.day=Math.min(XD(c.year,c.month),c.day))):c=oK({...H6(this.c),...r});const[h,d]=M$(c,this.o,this.zone);return xE(this,{ts:h,o:d})}plus(e){if(!this.isValid)return this;const r=di.fromDurationLike(e);return xE(this,cK(this,r))}minus(e){if(!this.isValid)return this;const r=di.fromDurationLike(e).negate();return xE(this,cK(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=di.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?Ua.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):q6}toLocaleString(e=ZD,r={}){return this.isValid?Ua.create(this.loc.clone(r),e).formatDateTime(this):q6}toLocaleParts(e={}){return this.isValid?Ua.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=Z6(this,o);return a+="T",a+=uK(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?Z6(this,e==="extended"):null}toISOWeekDate(){return OP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+uK(this,o==="extended",r,e,i,n):null}toRFC2822(){return OP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return OP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Z6(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),OP(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():q6}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return di.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=xNe(r).map(di.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=R4e(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(gr.now(),e,r)}until(e){return this.isValid?Ys.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||gr.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),pK(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?pK(e.base||gr.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(gr.isDateTime))throw new Ku("min requires all arguments be DateTimes");return QQ(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(gr.isDateTime))throw new Ku("max requires all arguments be DateTimes");return QQ(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=Es.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return Xfe(o,e,r)}static fromStringExplain(e,r,i={}){return gr.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return ZD}static get DATE_MED(){return cfe}static get DATE_MED_WITH_WEEKDAY(){return tNe}static get DATE_FULL(){return ufe}static get DATE_HUGE(){return hfe}static get TIME_SIMPLE(){return dfe}static get TIME_WITH_SECONDS(){return pfe}static get TIME_WITH_SHORT_OFFSET(){return ffe}static get TIME_WITH_LONG_OFFSET(){return mfe}static get TIME_24_SIMPLE(){return gfe}static get TIME_24_WITH_SECONDS(){return yfe}static get TIME_24_WITH_SHORT_OFFSET(){return _fe}static get TIME_24_WITH_LONG_OFFSET(){return vfe}static get DATETIME_SHORT(){return bfe}static get DATETIME_SHORT_WITH_SECONDS(){return wfe}static get DATETIME_MED(){return xfe}static get DATETIME_MED_WITH_SECONDS(){return Tfe}static get DATETIME_MED_WITH_WEEKDAY(){return rNe}static get DATETIME_FULL(){return Sfe}static get DATETIME_FULL_WITH_SECONDS(){return Efe}static get DATETIME_HUGE(){return Cfe}static get DATETIME_HUGE_WITH_SECONDS(){return Afe}}function SE(t){if(gr.isDateTime(t))return t;if(t&&t.valueOf&&gb(t.valueOf()))return gr.fromJSDate(t);if(t&&typeof t=="object")return gr.fromObject(t);throw new Ku(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const J4e={year:void 0,month:void 0,day:void 0,weekday:void 0},Q4e={hour:void 0,minute:void 0,second:void 0},K4e={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},iW={timeZone:"Etc/UTC"},gp={year:"numeric",month:"numeric",day:"numeric"},EE={year:"numeric",month:"long",day:"numeric"},CE={year:"numeric",month:"short",day:"numeric"},AE={year:"numeric",month:"long",weekday:"long",day:"numeric"},Iu={hour:"numeric",minute:"numeric"},kh={...Iu,second:"numeric"},WS={"short-date":gp,"short-date-short-time":{...gp,...Iu},"short-date-short-time-24":{...gp,...Iu,hour12:!1},"short-date-long-time":{...gp,...kh},"short-date-long-time-24":{...gp,...kh,hour12:!1},"short-date-le":gp,"short-date-le-short-time":{...gp,...Iu},"short-date-le-short-time-24":{...gp,...Iu,hour12:!1},"short-date-le-long-time":{...gp,...kh},"short-date-le-long-time-24":{...gp,...kh,hour12:!1},"long-month-day-year":EE,"long-month-day-year-short-time":{...EE,...Iu},"long-month-day-year-short-time-24":{...EE,...Iu,hour12:!1},"long-month-day-year-long-time":{...EE,...kh},"long-month-day-year-long-time-24":{...EE,...kh,hour12:!1},"day-short-month-year":CE,"day-short-month-year-short-time":{...CE,...Iu},"day-short-month-year-short-time-24":{...CE,...Iu,hour12:!1},"day-short-month-year-long-time":{...CE,...kh},"day-short-month-year-long-time-24":{...CE,...kh,hour12:!1},"long-date":AE,"long-date-short-time":{...AE,...Iu},"long-date-short-time-24":{...AE,...Iu,hour12:!1},"long-date-long-time":{...AE,...kh},"long-date-long-time-24":{...AE,...kh,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Iu,"long-time":kh},e5e=Wa()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),ame={ar:"ar-u-nu-latn-ca-gregory"};let Sz=new WeakMap,lme=WS["short-date-short-time"];function t5e(t){const e=t||lme;let r=Sz.get(e);if(!r){const i=Wd(),s=ame[i]||i;r=new Intl.DateTimeFormat(s,e),Sz.set(e,r)}return r}function DC(t){return WS[t]}function b_(t,e){return t5e(e).format(t)}function r5e(t,e=WS["short-date"]){return b_(new Date(t),{...e,...iW,...Q4e})}function i5e(t,e=WS["short-time"]){return b_(new Date(`1970-01-01T${t}Z`),{...e,...iW,...J4e})}function s5e(t,e=WS["short-date-short-time"]){const r=gr.fromISO(t,{setZone:!0}),i=Wd(),s=ame[i]??i;return r.toLocaleString({...K4e,...e},{locale:s})}bq(()=>{Sz=new WeakMap,lme=WS["short-date-short-time"]});const n5e={ar:"ar-u-nu-latn"};let I$=new WeakMap,cme={};function o5e(t){const e=t||cme;if(!I$.has(e)){const r=Wd(),i=n5e[Wd()]||r;I$.set(e,new Intl.NumberFormat(i,t))}return I$.get(e)}function a5e(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function Y2(t,e){return Object.is(t,-0)&&(t=0),o5e(e).format(t)}bq(()=>{I$=new WeakMap,cme={}});let Zx=class extends ji(de){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return Y2(e,a5e(this))}formatDate(e,r=!1){return this.dateFormat?b_(e,{...DC(this.dateFormat),...r&&iW}):this.formatNumber(e)}formatDateOnly(e){const r=(this.dateFormat&&DC(this.dateFormat))??void 0;return r5e(e,r)}formatTimeOnly(e){const r=(this.dateFormat&&DC(this.dateFormat))??void 0;return i5e(e,r)}formatTimestamp(e){const r=(this.dateFormat&&DC(this.dateFormat))??void 0;return s5e(e,r)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,r,i){return e&&r&&i?e.trim().split(r).map(s=>this.formatNumber(Number(s))).join(i):e}};u([et(e5e)],Zx.prototype,"dateFormat",void 0),u([p({type:Boolean,json:{write:!0}})],Zx.prototype,"digitSeparator",void 0),u([p({type:Ji,json:{write:!0}})],Zx.prototype,"places",void 0),Zx=u([R("esri.popup.support.FieldInfoFormat")],Zx);const NC=Zx;var Ez;let Kh=Ez=class extends de{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new Ez({fieldName:this.fieldName,format:this.format?K(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([p({type:String,json:{write:!0}})],Kh.prototype,"fieldName",void 0),u([p({type:NC,json:{write:!0}})],Kh.prototype,"format",void 0),u([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Kh.prototype,"isEditable",void 0),u([p({type:String,json:{write:!0}})],Kh.prototype,"label",void 0),u([et(new Rr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Kh.prototype,"stringFieldOption",void 0),u([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Kh.prototype,"statisticType",void 0),u([p({type:String,json:{write:!0}})],Kh.prototype,"tooltip",void 0),u([p({type:Boolean,json:{write:!0}})],Kh.prototype,"visible",void 0),Kh=Ez=u([R("esri.popup.FieldInfo")],Kh);const sW=Kh;var Cz;let Pm=Cz=class extends V_{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new Cz(K({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([p({type:Object,json:{write:!0}})],Pm.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],Pm.prototype,"description",void 0),u([p({type:[sW]})],Pm.prototype,"fieldInfos",void 0),u([De("fieldInfos")],Pm.prototype,"writeFieldInfos",null),u([p({type:String,json:{write:!0}})],Pm.prototype,"title",void 0),u([p({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Pm.prototype,"type",void 0),Pm=Cz=u([R("esri.popup.content.FieldsContent")],Pm);const _O=Pm;let jv=class extends de{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([p({type:String,json:{write:!0}})],jv.prototype,"altText",void 0),u([p({type:String,json:{write:!0}})],jv.prototype,"caption",void 0),u([p({type:String,json:{write:!0}})],jv.prototype,"title",void 0),u([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],jv.prototype,"type",void 0),jv=u([R("esri.popup.content.mixins.MediaInfo")],jv);const nW=jv;var Az;let Xx=Az=class extends xe{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Az({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([p()],Xx.prototype,"fieldName",void 0),u([p()],Xx.prototype,"tooltip",void 0),u([p()],Xx.prototype,"value",void 0),Xx=Az=u([R("esri.popup.content.support.ChartMediaInfoValueSeries")],Xx);const l5e=Xx;var Oz;let Hv=Oz=class extends de{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Oz({fields:K(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([p({type:[String],json:{write:!0}})],Hv.prototype,"fields",void 0),u([p({type:String,json:{write:!0}})],Hv.prototype,"normalizeField",void 0),u([p({type:[l5e],json:{read:!1}})],Hv.prototype,"series",void 0),u([p({type:String,json:{write:!0}})],Hv.prototype,"tooltipField",void 0),Hv=Oz=u([R("esri.popup.content.support.ChartMediaInfoValue")],Hv);const c5e=Hv;let FC=class extends nW{constructor(e){super(e),this.type=null,this.value=null}};u([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],FC.prototype,"type",void 0),u([p({type:c5e,json:{write:!0}})],FC.prototype,"value",void 0),FC=u([R("esri.popup.content.mixins.ChartMediaInfo")],FC);const b5=FC,w5=Wa()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Rz;let $$=Rz=class extends b5{constructor(t){super(t),this.type="bar-chart"}clone(){return new Rz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:w5.write}})],$$.prototype,"type",void 0),$$=Rz=u([R("esri.popup.content.BarChartMediaInfo")],$$);const ume=$$;var Pz;let L$=Pz=class extends b5{constructor(t){super(t),this.type="column-chart"}clone(){return new Pz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:w5.write}})],L$.prototype,"type",void 0),L$=Pz=u([R("esri.popup.content.ColumnChartMediaInfo")],L$);const hme=L$;var Mz;let UC=Mz=class extends de{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new Mz({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([p({type:String,json:{write:!0}})],UC.prototype,"linkURL",void 0),u([p({type:String,json:{write:!0}})],UC.prototype,"sourceURL",void 0),UC=Mz=u([R("esri.popup.content.support.ImageMediaInfoValue")],UC);const u5e=UC;var Iz;let Yx=Iz=class extends nW{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new Iz({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([p({type:Number,json:{write:!0}})],Yx.prototype,"refreshInterval",void 0),u([p({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Yx.prototype,"type",void 0),u([p({type:u5e,json:{write:!0}})],Yx.prototype,"value",void 0),Yx=Iz=u([R("esri.popup.content.ImageMediaInfo")],Yx);const dme=Yx;var $z;let D$=$z=class extends b5{constructor(t){super(t),this.type="line-chart"}clone(){return new $z({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:w5.write}})],D$.prototype,"type",void 0),D$=$z=u([R("esri.popup.content.LineChartMediaInfo")],D$);const pme=D$;var Lz;let N$=Lz=class extends b5{constructor(t){super(t),this.type="pie-chart"}clone(){return new Lz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:w5.write}})],N$.prototype,"type",void 0),N$=Lz=u([R("esri.popup.content.PieChartMediaInfo")],N$);const fme=N$,mme={base:nW,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":ume,"column-chart":hme,"line-chart":pme,"pie-chart":fme,image:dme}};var Dz;let ed=Dz=class extends V_{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?dme.fromJSON(e):e.type==="barchart"?ume.fromJSON(e):e.type==="columnchart"?hme.fromJSON(e):e.type==="linechart"?pme.fromJSON(e):e.type==="piechart"?fme.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new Dz(K({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([p()],ed.prototype,"activeMediaInfoIndex",void 0),u([p({type:Object,json:{write:!0}})],ed.prototype,"attributes",void 0),u([p({type:String,json:{write:!0}})],ed.prototype,"description",void 0),u([p({types:[mme]})],ed.prototype,"mediaInfos",void 0),u([Se("mediaInfos")],ed.prototype,"readMediaInfos",null),u([De("mediaInfos")],ed.prototype,"writeMediaInfos",null),u([p({type:String,json:{write:!0}})],ed.prototype,"title",void 0),u([p({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],ed.prototype,"type",void 0),ed=Dz=u([R("esri.popup.content.MediaContent")],ed);const QD=ed;var Nz;let VC=Nz=class extends de{constructor(t){super(t),this.field=null,this.order=null}clone(){return new Nz({field:this.field,order:this.order})}};u([p({type:String,json:{write:!0}})],VC.prototype,"field",void 0),u([p({type:["asc","desc"],json:{write:!0}})],VC.prototype,"order",void 0),VC=Nz=u([R("esri.popup.support.RelatedRecordsInfoFieldOrder")],VC);const oW=VC;let Vp=class extends ji(V_){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([p({type:String,json:{write:!0}})],Vp.prototype,"description",void 0),u([p({type:Number,json:{type:Ji,write:!0}})],Vp.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],Vp.prototype,"displayType",void 0),u([p({type:[oW],json:{write:!0}})],Vp.prototype,"orderByFields",void 0),u([p({type:Number,json:{type:Ji,write:!0}})],Vp.prototype,"relationshipId",void 0),u([p({type:String,json:{write:!0}})],Vp.prototype,"title",void 0),u([p({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Vp.prototype,"type",void 0),Vp=u([R("esri.popup.content.RelationshipContent")],Vp);const KD=Vp;var Fz;let zC=Fz=class extends V_{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new Fz({text:this.text})}};u([p({type:String,json:{write:!0}})],zC.prototype,"text",void 0),u([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],zC.prototype,"type",void 0),zC=Fz=u([R("esri.popup.content.TextContent")],zC);const eN=zC,h5e={base:null,key:"type",typeMap:{attachment:yO,media:QD,text:eN,expression:Xq,field:_O,relationship:KD}};var Uz;let qv=Uz=class extends de{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Uz({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],qv.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],qv.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],qv.prototype,"expression",void 0),u([p({type:["string","number"],json:{write:!0}})],qv.prototype,"returnType",void 0),qv=Uz=u([R("esri.popup.ExpressionInfo")],qv);const d5e=qv;var Vz;let kC=Vz=class extends de{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Vz({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([p({type:Boolean,json:{write:!0}})],kC.prototype,"returnTopmostRaster",void 0),u([p({type:Boolean,json:{write:!0}})],kC.prototype,"showNoDataRecords",void 0),kC=Vz=u([R("esri.popup.LayerOptions")],kC);const p5e=kC;var zz;let BC=zz=class extends de{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new zz({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?K(this.orderByFields):null})}};u([p({type:Boolean,json:{write:!0}})],BC.prototype,"showRelatedRecords",void 0),u([p({type:[oW],json:{write:!0}})],BC.prototype,"orderByFields",void 0),BC=zz=u([R("esri.popup.RelatedRecordsInfo")],BC);const f5e=BC;var kz;let $u=kz=class extends Gq(xe){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new kz({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([p()],$u.prototype,"active",void 0),u([p()],$u.prototype,"className",void 0),u([p()],$u.prototype,"disabled",void 0),u([p()],$u.prototype,"icon",void 0),u([p()],$u.prototype,"id",void 0),u([p()],$u.prototype,"indicator",void 0),u([p()],$u.prototype,"title",void 0),u([p()],$u.prototype,"type",void 0),u([p()],$u.prototype,"visible",void 0),$u=kz=u([R("esri.support.actions.ActionBase")],$u);const aW=$u;var Bz;let F$=Bz=class extends aW{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new Bz({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([p()],F$.prototype,"image",void 0),F$=Bz=u([R("esri.support.Action.ActionButton")],F$);const m5e=F$;var Gz;let GC=Gz=class extends aW{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new Gz({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([p()],GC.prototype,"image",void 0),u([p()],GC.prototype,"value",void 0),GC=Gz=u([R("esri.support.Action.ActionToggle")],GC);const g5e=GC,y5e="esri.PopupTemplate",_5e=Q.getLogger(y5e),OE="relationships/",mK="expression/",v5e=Mt.ofType({key:"type",defaultKeyValue:"button",base:aW,typeMap:{button:m5e,toggle:g5e}}),b5e={base:V_,key:"type",typeMap:{media:QD,custom:YDe,text:eN,attachments:yO,fields:_O,expression:Xq,relationship:KD}},w5e=["attachments","fields","media","text","expression","relationship"];let io=class extends ji(de){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>tp(b5e,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||gu(e)?e:(_5e.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>w5e.includes(n.type)).map(n=>n&&n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});r.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),gO(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=K(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var n,o;const i=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=K(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),QD.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),eN.fromJSON(n)):n.type==="attachments"?yO.fromJSON(n):n.type==="fields"?_O.fromJSON(n):n.type==="expression"?Xq.fromJSON(n):n.type==="relationship"?KD.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(OE)))return null;const s=r.replace(OE,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?KD.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${OE}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new eN({text:e})):n.push(new _O),Array.isArray(r)&&r.length&&n.push(QD.fromJSON({mediaInfos:r})),i&&n.push(yO.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,d=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>El(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(OE)&&!r.startsWith(mK)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${OE}`)===0||o.indexOf(`{${mK}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};u([p({type:v5e})],io.prototype,"actions",void 0),u([p()],io.prototype,"content",void 0),u([yr("content")],io.prototype,"castContent",null),u([Se("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],io.prototype,"readContent",null),u([De("content",{popupElements:{type:Mt.ofType(h5e)},showAttachments:{type:Boolean},mediaInfos:{type:Mt.ofType(mme)},description:{type:String},relatedRecordsInfo:{type:f5e}})],io.prototype,"writeContent",null),u([p({type:[d5e],json:{write:!0}})],io.prototype,"expressionInfos",void 0),u([p({type:[sW]})],io.prototype,"fieldInfos",void 0),u([De("fieldInfos")],io.prototype,"writeFieldInfos",null),u([p({type:p5e})],io.prototype,"layerOptions",void 0),u([De("layerOptions")],io.prototype,"writeLayerOptions",null),u([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],io.prototype,"lastEditInfoEnabled",void 0),u([p()],io.prototype,"outFields",void 0),u([p()],io.prototype,"overwriteActions",void 0),u([p()],io.prototype,"returnGeometry",void 0),u([p({json:{type:String}})],io.prototype,"title",void 0),u([De("title")],io.prototype,"writeTitle",null),io=u([R("esri.PopupTemplate")],io);const ZS=io,gK=new Rr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let x5e=0,Jx=class extends de{constructor(e){super(e),this.id="sym"+x5e++,this.type=null,this.color=new ke([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([p({type:gK.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:gK.write}}})],Jx.prototype,"type",void 0),u([p({type:ke,json:{write:{allowNull:!0}}})],Jx.prototype,"color",void 0),u([Se("color")],Jx.prototype,"readColor",null),Jx=u([R("esri.symbols.Symbol")],Jx);const xc=Jx;var jz;let Xy=jz=class extends xc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const s=i.map(n=>{const o=n.valueExpressionInfo;return El(t,e,o.expression)});await Promise.all(s)}}}clone(){return new jz({data:K(this.data)})}hash(){return zH(JSON.stringify(this.data)).toString()}};u([p({json:{write:!1}})],Xy.prototype,"color",void 0),u([p({json:{write:!0}})],Xy.prototype,"data",void 0),u([Se("data",["symbol"])],Xy.prototype,"readData",null),u([De("data",{})],Xy.prototype,"writeData",null),u([et({CIMSymbolReference:"cim"},{readOnly:!0})],Xy.prototype,"type",void 0),Xy=jz=u([R("esri.symbols.CIMSymbol")],Xy);const XS=Xy;let Qx=class extends de{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};u([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],Qx.prototype,"enabled",void 0),u([De("enabled")],Qx.prototype,"writeEnabled",null),u([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],Qx.prototype,"type",void 0),Qx=u([R("esri.symbols.Symbol3DLayer")],Qx);const Qf=Qx,T5e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,S5e="screenUtils.toPt: input not recognized!",gme=96;function po(t){return t?t/72*gme:0}function bh(t){return t?72*t/gme:0}function Jr(t){if(typeof t=="string"){const e=t.match(T5e);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?bh(r):r;return s?-n:n}return console.warn(S5e),null}return t}function wh(t=0,e=0){return{x:t,y:e}}function Yi(t=0,e=0){return[t,e]}function yme(t=0,e=0){return[t,e]}function Vo(t=0,e=0,r=0){return[t,e,r]}function pSt(t){return t}function fSt(t){return t}function mSt(t){return t}function hf(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function E5e(t,e){const r=e.transparency!=null?H2(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new ke([i[0]||0,i[1]||0,i[2]||0,r]):null}function C5e(t,e){e.color=t.toJSON().slice(0,3);const r=c5(t.a);r!==0&&(e.transparency=r)}const jg={type:ke,json:{type:[Ji],default:null,read:{source:["color","transparency"],reader:E5e},write:{target:{color:{type:[Ji]},transparency:{type:Ji}},writer:C5e}}},Nf={type:Number,cast:Jr,json:{write:!0}};let Wv=class extends de{constructor(e){super(e),this.color=new ke([0,0,0,1]),this.extensionLength=0,this.size=bh(1)}clone(){}cloneProperties(){return{color:K(this.color),size:this.size,extensionLength:this.extensionLength}}};u([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Wv.prototype,"type",void 0),u([p(jg)],Wv.prototype,"color",void 0),u([p({...Nf,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Wv.prototype,"extensionLength",void 0),u([p(Nf)],Wv.prototype,"size",void 0),Wv=u([R("esri.symbols.edges.Edges3D")],Wv);const lW=Wv;var Hz;let U$=Hz=class extends lW{constructor(t){super(t),this.type="sketch"}clone(){return new Hz(this.cloneProperties())}};u([et({sketch:"sketch"},{readOnly:!0})],U$.prototype,"type",void 0),U$=Hz=u([R("esri.symbols.edges.SketchEdges3D")],U$);const A5e=U$;var qz;let V$=qz=class extends lW{constructor(t){super(t),this.type="solid"}clone(){return new qz(this.cloneProperties())}};u([et({solid:"solid"},{readOnly:!0})],V$.prototype,"type",void 0),V$=qz=u([R("esri.symbols.support.SolidEdges3D")],V$);const O5e=V$,_me={types:{key:"type",base:lW,typeMap:{solid:O5e,sketch:A5e}},json:{write:!0}};var Wz;let su=Wz=class extends de{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new Wz(t)}};u([p(jg)],su.prototype,"color",void 0),su=Wz=u([R("esri.symbols.support.Symbol3DMaterial")],su);var Zz;let Yy=Zz=class extends Qf{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new Zz({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([et({Extrude:"extrude"},{readOnly:!0})],Yy.prototype,"type",void 0),u([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Yy.prototype,"size",void 0),u([p({type:su,json:{write:!0}})],Yy.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Yy.prototype,"castShadows",void 0),u([p(_me)],Yy.prototype,"edges",void 0),Yy=Zz=u([R("esri.symbols.ExtrudeSymbol3DLayer")],Yy);const vme=Yy;let jC=class extends xc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([et({esriSLS:"simple-line"},{readOnly:!0})],jC.prototype,"type",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],jC.prototype,"width",void 0),jC=u([R("esri.symbols.LineSymbol")],jC);const R5e=jC,P5e=["begin","end","begin-end"],bme=["arrow","circle","square","diamond","cross","x"];var Xz;let zp=Xz=class extends de{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new Xz({color:K(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([p({type:["begin","end","begin-end"],json:{write:!0}})],zp.prototype,"placement",void 0),u([et({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],zp.prototype,"type",void 0),u([p({type:bme})],zp.prototype,"style",void 0),u([De("style")],zp.prototype,"writeStyle",null),u([p({type:ke,value:null,json:{write:{allowNull:!0}}})],zp.prototype,"color",null),u([Se("color")],zp.prototype,"readColor",null),u([De("color")],zp.prototype,"writeColor",null),zp=Xz=u([R("esri.symbols.LineSymbolMarker")],zp);const M5e=zp;var Yz;const X6=new Rr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Mm=Yz=class extends R5e{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=Jr(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Jr(n)),o}clone(){var t;return new Yz({color:K(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([et({esriSLS:"simple-line"},{readOnly:!0})],Mm.prototype,"type",void 0),u([p({type:X6.apiValues,json:{read:X6.read,write:X6.write}})],Mm.prototype,"style",void 0),u([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Mm.prototype,"cap",void 0),u([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Mm.prototype,"join",void 0),u([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":M5e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Mm.prototype,"marker",void 0),u([p({type:Number,json:{read:!1,write:!1}})],Mm.prototype,"miterLimit",void 0),Mm=Yz=u([R("esri.symbols.SimpleLineSymbol")],Mm);const Ph=Mm;let HC=class extends xc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Ph}},json:{default:null,write:!0}})],HC.prototype,"outline",void 0),u([p({type:["simple-fill","picture-fill"],readOnly:!0})],HC.prototype,"type",void 0),HC=u([R("esri.symbols.FillSymbol")],HC);const wme=HC;let z$=class extends de{constructor(e){super(e)}clone(){}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],z$.prototype,"type",void 0),z$=u([R("esri.symbols.patterns.LinePattern3D")],z$);const xme=z$,I5e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var Jz;const $5e=Wa()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let qC=Jz=class extends xme{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new Jz(t)}};u([p({type:["style"]})],qC.prototype,"type",void 0),u([et($5e),p({type:I5e})],qC.prototype,"style",void 0),qC=Jz=u([R("esri.symbols.patterns.LineStylePattern3D")],qC);const cW=qC;let k$=class extends de{constructor(e){super(e)}clone(){}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],k$.prototype,"type",void 0),k$=u([R("esri.symbols.patterns.Pattern3D")],k$);const Tme=k$,L5e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var Qz;let WC=Qz=class extends Tme{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new Qz(t)}};u([p({type:["style"]})],WC.prototype,"type",void 0),u([p({type:L5e,json:{read:!0,write:!0}})],WC.prototype,"style",void 0),WC=Qz=u([R("esri.symbols.patterns.StylePattern3D")],WC);const Sme=WC,D5e={types:{key:"type",base:Tme,typeMap:{style:Sme}},json:{write:!0}},Eme={types:{key:"type",base:xme,typeMap:{style:cW}},json:{write:!0}},gA=new ke("white");new ke("black");const N5e=new ke([255,255,255,0]);function F5e(t){return t.r===0&&t.g===0&&t.b===0}var Kz;let yA=Kz=class extends su{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new Kz(t)}};u([et({multiply:"multiply",replace:"replace",tint:"tint"})],yA.prototype,"colorMixMode",void 0),yA=Kz=u([R("esri.symbols.support.Symbol3DFillMaterial")],yA);function ln(t=Pme){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Gb(t,e,r,i,s,n,o=ln()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function wSt(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new _r(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function J2(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function U5e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Ff(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function tu(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<i;h++)s=Math.min(s,e[r+3*h]),n=Math.min(n,e[r+3*h+1]),o=Math.min(o,e[r+3*h+2]),a=Math.max(a,e[r+3*h]),l=Math.max(l,e[r+3*h+1]),c=Math.max(c,e[r+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function Y6(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let h=0;h<i;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let h=0;h<i;h++){const d=e[h];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function V5e(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function _w(t){return t[0]>=t[3]?0:t[3]-t[0]}function vw(t){return t[1]>=t[4]?0:t[4]-t[1]}function z_(t){return t[2]>=t[5]?0:t[5]-t[2]}function Cme(t){const e=_w(t),r=z_(t),i=vw(t);return Math.sqrt(e*e+r*r+i*i)}function Ud(t,e=[0,0,0]){return e[0]=t[0]+_w(t)/2,e[1]=t[1]+vw(t)/2,e[2]=t[2]+z_(t)/2,e}function RP(t,e=[0,0,0]){return e[0]=_w(t),e[1]=vw(t),e[2]=z_(t),e}function uW(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function xSt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function z5e(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Vd(t,e){return e==null||z5e(t,e)}function Ame(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function TSt(t,e,r=t){const i=t[0]+_w(t)/2,s=t[1]+vw(t)/2,n=t[2]+z_(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function Ome(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function Rme(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function x5(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Ti(t){return t?x5(t,yK):ln(yK)}function hW(t,e){return e||(e=kt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function SSt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function k5e(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function ek(t){return t.length===6}function dW(t){return _w(t)===0&&vw(t)===0&&z_(t)===0}function ESt(t,e,r){if(t==null||e==null)return t===e;if(!ek(t)||!ek(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function B5e(t,e,r,i,s,n){return Gb(t,e,r,i,s,n,G5e)}const CSt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],yK=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Pme=[0,0,0,0,0,0],G5e=ln();function J6(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=Ae(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const j5e=Gb(-.5,-.5,-.5,.5,.5,.5),H5e=Gb(-.5,-.5,0,.5,.5,1),q5e=Gb(-.5,-.5,0,.5,.5,.5);function W5e(t){switch(t){case"sphere":case"cube":case"diamond":return j5e;case"cylinder":case"cone":case"inverted-cone":return H5e;case"tetrahedron":return q5e;default:return}}const pW=["butt","square","round"],Z5e=[...pW,"none"],Mme=["miter","bevel","round"];var tk;let Zv=tk=class extends de{constructor(t){super(t),this.color=new ke([0,0,0,1]),this.size=bh(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new tk(t)}};u([p(jg)],Zv.prototype,"color",void 0),u([p(Nf)],Zv.prototype,"size",void 0),u([p(Eme)],Zv.prototype,"pattern",void 0),u([p({type:pW,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],Zv.prototype,"patternCap",void 0),Zv=tk=u([R("esri.symbols.support.Symbol3DOutline")],Zv);var B$;let Im=B$=class extends Qf{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new B$(t)}static fromSimpleFillSymbol(t){var i,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new cW({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((s=t.outline)==null?void 0:s.color)??gA).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(r.patternCap=t.outline.cap),new B$({material:new yA({color:(t.color??N5e).clone()}),pattern:t.style&&t.style!=="solid"?new Sme({style:t.style}):null,outline:r})}};u([et({Fill:"fill"},{readOnly:!0})],Im.prototype,"type",void 0),u([p({type:yA,json:{write:!0}})],Im.prototype,"material",void 0),u([p(D5e)],Im.prototype,"pattern",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Im.prototype,"castShadows",void 0),u([p({type:Zv,json:{write:!0}})],Im.prototype,"outline",void 0),u([p(_me)],Im.prototype,"edges",void 0),Im=B$=u([R("esri.symbols.FillSymbol3DLayer")],Im);const TR=Im,X5e=["none","underline","line-through"],Y5e=["normal","italic","oblique"],J5e=["normal","lighter","bold","bolder"],Ime={type:Number,cast:t=>{const e=Qu(t);return e===0?1:_e(e,.1,4)},nonNullable:!0},Q5e=["left","right","center"],K5e=["baseline","top","middle","bottom"],$me={type:Q5e,nonNullable:!0},Lme={type:K5e,nonNullable:!0},ASt=8;var rk;let $m=rk=class extends de{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Jr(t)}clone(){return new rk({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([p({type:X5e,json:{default:"none",write:!0}})],$m.prototype,"decoration",void 0),u([p({type:String,json:{write:!0}})],$m.prototype,"family",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],$m.prototype,"size",void 0),u([yr("size")],$m.prototype,"castSize",null),u([p({type:Y5e,json:{default:"normal",write:!0}})],$m.prototype,"style",void 0),u([p({type:J5e,json:{default:"normal",write:!0}})],$m.prototype,"weight",void 0),$m=rk=u([R("esri.symbols.Font")],$m);const T5=$m;function Lg(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=Jc(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=sq(t,e.portalItem.itemUrl);i!=null&&eFe.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return ik(t,e&&e.portal)}function Dg(t,e,r=Q2.YES){if(t==null)return t;!fc(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=Jc(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=ik(s,e.portal),o=ik(i,e.portal);i=sq(o,n,n),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=Ume(i,e==null?void 0:e.portal),fc(i)&&(i=Hd(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!fc(i)&&!Xf(i)&&r===Q2.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function S5(t,e,r){return Lg(t,r)}function w_(t,e,r,i){const s=Dg(t,i);s!==void 0&&(e[r]=s)}const Dme=/\/items\/([^\/]+)\/resources\/(.*)/,eFe=/^\.\/resources\//;function Nme(t){const e=(t==null?void 0:t.match(Dme))??null;return(e==null?void 0:e[1])??null}function Fme(t){const e=(t==null?void 0:t.match(Dme))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=aQ(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=aQ(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function Ume(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?GV(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function ik(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=eq();return B2(i,`${i.scheme}://${r}`)?GV(t,e.portalHostname,r):GV(t,r,e.portalHostname)}var Q2;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(Q2||(Q2={}));const tFe=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return Q2},ensureMainOnlineDomain:Ume,fromJSON:Lg,itemIdFromResourceUrl:Nme,prefixAndFilenameFromResourceUrl:Fme,read:S5,toJSON:Dg,write:w_},Symbol.toStringTag,{value:"Module"}));var sk;const rFe=Wa()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Xv=sk=class extends de{constructor(t){super(t)}readHref(t,e,r){return t?Lg(t,r):e.dataURI}writeHref(t,e,r,i){t&&(Xf(t)?e.dataURI=t:(e.href=Dg(t,i),fc(e.href)&&(e.href=Hd(e.href))))}clone(){return new sk({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Xv.prototype,"href",void 0),u([Se("href")],Xv.prototype,"readHref",null),u([De("href",{href:{type:String},dataURI:{type:String}})],Xv.prototype,"writeHref",null),u([et(rFe)],Xv.prototype,"primitive",void 0),Xv=sk=u([R("esri.symbols.support.IconSymbol3DLayerResource")],Xv);const iFe="circle";var nk;let HT=nk=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new nk({x:this.x,y:this.y})}};u([p({type:Number})],HT.prototype,"x",void 0),u([p({type:Number})],HT.prototype,"y",void 0),HT=nk=u([R("esri.symbols.support.Symbol3DAnchorPosition2D")],HT);var ok;let ZC=ok=class extends de{constructor(t){super(t),this.color=new ke([0,0,0,1]),this.size=bh(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new ok(t)}};u([p(jg)],ZC.prototype,"color",void 0),u([p(Nf)],ZC.prototype,"size",void 0),ZC=ok=u([R("esri.symbols.support.Symbol3DIconOutline")],ZC);var Kx;const Vme="esri.symbols.IconSymbol3DLayer";let kp=Kx=class extends Qf{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new Kx({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||gA,r=_K(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||gA).clone()}:null;return new Kx({size:t.size,resource:{primitive:nFe(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||F5e(t.color)?gA:t.color,r=_K(t);return new Kx({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new Kx({resource:{href:wde({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function _K(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=vK(t.xoffset),s=vK(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function vK(t){return isFinite(t)?t:0}u([p({type:su,json:{write:!0}})],kp.prototype,"material",void 0),u([p({type:Xv,json:{write:!0}})],kp.prototype,"resource",void 0),u([et({Icon:"icon"},{readOnly:!0})],kp.prototype,"type",void 0),u([p(Nf)],kp.prototype,"size",void 0),u([et({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),p({json:{default:"center"}})],kp.prototype,"anchor",void 0),u([p({type:HT,json:{type:[Number],read:{reader:t=>new HT({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],kp.prototype,"anchorPosition",void 0),u([p({type:ZC,json:{write:!0}})],kp.prototype,"outline",void 0),kp=Kx=u([R(Vme)],kp);const sFe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function nFe(t){return sFe[t]||(Q.getLogger(Vme).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const W0=kp;let Yv=class extends ji(de){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Yv.prototype,"type",void 0),u([p({type:P5e,json:{default:"begin-end",write:!0}})],Yv.prototype,"placement",void 0),u([p({type:bme,json:{default:"arrow",write:!0}})],Yv.prototype,"style",void 0),u([p({type:ke,json:{type:[Ji],default:null,write:!0}})],Yv.prototype,"color",void 0),Yv=u([R("esri.symbols.LineStyleMarker3D")],Yv);const ak=Yv;var G$;let Bp=G$=class extends Qf{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=bh(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new G$(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??bh(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new cW({style:t.style}):null,material:new su({color:(t.color||gA).clone()}),marker:t.marker?new ak({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new G$(e)}};u([p({type:su,json:{write:!0}})],Bp.prototype,"material",void 0),u([et({Line:"line"},{readOnly:!0})],Bp.prototype,"type",void 0),u([p({type:Mme,json:{write:!0,default:"miter"}})],Bp.prototype,"join",void 0),u([p({type:pW,json:{write:!0,default:"butt"}})],Bp.prototype,"cap",void 0),u([p(Nf)],Bp.prototype,"size",void 0),u([p(Eme)],Bp.prototype,"pattern",void 0),u([p({types:{key:"type",base:ak,typeMap:{style:ak}},json:{write:!0}})],Bp.prototype,"marker",void 0),Bp=G$=u([R("esri.symbols.LineSymbol3DLayer")],Bp);const SR=Bp;var lk;const oFe=Wa()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let XC=lk=class extends de{clone(){return new lk({href:this.href,primitive:this.primitive})}};u([p({type:String,json:{read:S5,write:w_}})],XC.prototype,"href",void 0),u([et(oFe)],XC.prototype,"primitive",void 0),XC=lk=u([R("esri.symbols.support.ObjectSymbol3DLayerResource")],XC);const zme="sphere";var ck;let V1=ck=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new ck({x:this.x,y:this.y,z:this.z})}};u([p({type:Number})],V1.prototype,"x",void 0),u([p({type:Number})],V1.prototype,"y",void 0),u([p({type:Number})],V1.prototype,"z",void 0),V1=ck=u([R("esri.symbols.support.Symbol3DAnchorPosition3D")],V1);var uk;let Ta=uk=class extends Qf{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new uk({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([p({type:su,json:{write:!0}})],Ta.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ta.prototype,"castShadows",void 0),u([p({type:XC,json:{write:!0}})],Ta.prototype,"resource",void 0),u([et({Object:"object"},{readOnly:!0})],Ta.prototype,"type",void 0),u([p({type:Number,json:{write:!0}})],Ta.prototype,"width",void 0),u([p({type:Number,json:{write:!0}})],Ta.prototype,"height",void 0),u([p({type:Number,json:{write:!0}})],Ta.prototype,"depth",void 0),u([et({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),p({json:{default:"origin"}})],Ta.prototype,"anchor",void 0),u([p({type:V1,json:{type:[Number],read:{reader:t=>new V1({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ta.prototype,"anchorPosition",void 0),u([p({type:Number,json:{write:!0}})],Ta.prototype,"heading",void 0),u([p({type:Number,json:{write:!0}})],Ta.prototype,"tilt",void 0),u([p({type:Number,json:{write:!0}})],Ta.prototype,"roll",void 0),u([p({readOnly:!0})],Ta.prototype,"isPrimitive",null),Ta=uk=u([R("esri.symbols.ObjectSymbol3DLayer")],Ta);const fW=Ta;var hk;let al=hk=class extends Qf{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new hk({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([p({type:su,json:{write:!0}})],al.prototype,"material",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],al.prototype,"castShadows",void 0),u([et({Path:"path"},{readOnly:!0})],al.prototype,"type",void 0),u([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],al.prototype,"profile",void 0),u([p({type:Mme,json:{write:!0,default:"miter"}})],al.prototype,"join",void 0),u([p({type:Z5e,json:{write:!0,default:"butt"}})],al.prototype,"cap",void 0),u([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],al.prototype,"width",void 0),u([Se("width",["width","size","height"])],al.prototype,"readWidth",null),u([p({type:Number,json:{write:!0}})],al.prototype,"height",void 0),u([Se("height",["height","size","width"])],al.prototype,"readHeight",null),u([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],al.prototype,"anchor",void 0),u([p({type:["heading","all"],json:{write:!0,default:"all"}})],al.prototype,"profileRotation",void 0),al=hk=u([R("esri.symbols.PathSymbol3DLayer")],al);const mW=al;var dk;let qT=dk=class extends de{constructor(){super(...arguments),this.color=new ke([0,0,0,1]),this.size=0}clone(){const t={color:K(this.color),size:this.size};return new dk(t)}};u([p(jg)],qT.prototype,"color",void 0),u([p(Nf)],qT.prototype,"size",void 0),qT=dk=u([R("esri.symbols.support.Symbol3DHalo")],qT);let _A=class extends ji(de){constructor(e){super(e),this.color=null}};u([p(jg)],_A.prototype,"color",void 0),_A=u([R("esri.symbols.support.Symbol3DTextBackground")],_A);var j$;let Vl=j$=class extends Qf{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new j$({enabled:this.enabled,font:this.font&&K(this.font),halo:this.halo&&K(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:K(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new j$({font:t.font!=null?t.font.clone():new T5,halo:aFe(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new su({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new _A({color:t.backgroundColor.clone()}):null})}};function aFe(t,e){return t&&e!=null&&e>0?new qT({color:K(t),size:e}):null}u([p({type:T5,json:{write:!0}})],Vl.prototype,"font",null),u([De("font")],Vl.prototype,"writeFont",null),u([p({type:qT,json:{write:!0}})],Vl.prototype,"halo",void 0),u([p({...$me,json:{default:"center",write:!0}})],Vl.prototype,"horizontalAlignment",void 0),u([p({...Ime,json:{default:1,write:!0}})],Vl.prototype,"lineHeight",void 0),u([p({type:su,json:{write:!0}})],Vl.prototype,"material",void 0),u([p({type:_A,json:{write:!0}})],Vl.prototype,"background",void 0),u([p(Nf)],Vl.prototype,"size",null),u([p({type:String,json:{write:!0}})],Vl.prototype,"text",void 0),u([et({Text:"text"},{readOnly:!0})],Vl.prototype,"type",void 0),u([p({...Lme,json:{default:"baseline",write:!0}})],Vl.prototype,"verticalAlignment",void 0),Vl=j$=u([R("esri.symbols.TextSymbol3DLayer")],Vl);const bw=Vl;var pk;let Jy=pk=class extends Qf{constructor(t){super(t),this.color=fk.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new pk({color:K(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([p({type:ke,nonNullable:!0,json:{type:[Ji],write:(t,e,r)=>e[r]=t.toArray(ke.AlphaMode.UNLESS_OPAQUE),default:()=>fk.clone(),defaultEquals:t=>t.toCss(!0)===fk.toCss(!0)}})],Jy.prototype,"color",void 0),u([et({Water:"water"},{readOnly:!0})],Jy.prototype,"type",void 0),u([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Jy.prototype,"waterbodySize",void 0),u([p({type:Number,json:{write:!0,default:null}})],Jy.prototype,"waveDirection",void 0),u([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Jy.prototype,"waveStrength",void 0),Jy=pk=u([R("esri.symbols.WaterSymbol3DLayer")],Jy);const fk=new ke([0,119,190]),kme=Jy;var mk;let Jv=mk=class extends xe{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new mk({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([p({type:String})],Jv.prototype,"name",void 0),u([p({type:String})],Jv.prototype,"styleUrl",void 0),u([p({type:String})],Jv.prototype,"styleName",void 0),u([p({type:qn})],Jv.prototype,"portal",void 0),Jv=mk=u([R("esri.symbols.support.StyleOrigin")],Jv);const vO=Jv;var gk;let yb=gk=class extends xe{constructor(){super(...arguments),this.url=""}clone(){return new gk({url:this.url})}};u([p({type:String})],yb.prototype,"url",void 0),yb=gk=u([R("esri.symbols.support.Thumbnail")],yb);const Bme={icon:W0,object:fW,line:SR,path:mW,fill:TR,extrude:vme,text:bw,water:kme},lFe=Mt.ofType({base:Qf,key:"type",typeMap:Bme,errorContext:"symbol-layer"});let Gp=class extends xc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||Mt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&Q.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Lb(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=Lg(e.styleUrl,i);return new vO({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new vO({portal:i&&i.portal||qn.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new yh("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=Dg(e.styleUrl,s);fc(n)&&(n=Hd(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!vde(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new yh("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Qf||e&&Bme[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([p({json:{read:!1,write:!1}})],Gp.prototype,"color",null),u([p({type:lFe,nonNullable:!0,json:{write:!0}}),yr(ade)],Gp.prototype,"symbolLayers",null),u([p({type:vO})],Gp.prototype,"styleOrigin",void 0),u([Se("styleOrigin")],Gp.prototype,"readStyleOrigin",null),u([De("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Gp.prototype,"writeStyleOrigin",null),u([p({type:yb,json:{read:!1}})],Gp.prototype,"thumbnail",void 0),u([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Gp.prototype,"type",void 0),Gp=u([R("esri.symbols.Symbol3D")],Gp);const YS=Gp;let YC=class extends de{constructor(e){super(e),this.visible=!0}clone(){}};u([p({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],YC.prototype,"type",void 0),u([p({readOnly:!0})],YC.prototype,"visible",void 0),YC=u([R("esri.symbols.callouts.Callout3D")],YC);const Gme=YC;var yk;let H$=yk=class extends de{constructor(){super(...arguments),this.color=new ke("white")}clone(){return new yk({color:K(this.color)})}};u([p(jg)],H$.prototype,"color",void 0),H$=yk=u([R("esri.symbols.callouts.LineCallout3DBorder")],H$);const jme=H$;Object.freeze(Object.defineProperty({__proto__:null,default:jme},Symbol.toStringTag,{value:"Module"}));var _k;let Qy=_k=class extends Gme{constructor(t){super(t),this.type="line",this.color=new ke([0,0,0,1]),this.size=bh(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new _k({color:K(this.color),size:this.size,border:K(this.border)})}};u([et({line:"line"},{readOnly:!0})],Qy.prototype,"type",void 0),u([p(jg)],Qy.prototype,"color",void 0),u([p(Nf)],Qy.prototype,"size",void 0),u([p({type:jme,json:{write:!0}})],Qy.prototype,"border",void 0),u([p({readOnly:!0})],Qy.prototype,"visible",null),Qy=_k=u([R("esri.symbols.callouts.LineCallout3D")],Qy);const cFe=Qy;function gW(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function Hme(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!gW(t)}function yW(t){return t.type==="point-3d"||t.type==="label-3d"}function qme(t){return t.horizontalAlignment==="center"}const Wme={types:{key:"type",base:Gme,typeMap:{line:cFe}},json:{write:!0}};var vk;let eT=vk=class extends de{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new vk({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([p(Nf)],eT.prototype,"screenLength",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],eT.prototype,"minWorldLength",void 0),u([p({type:Number,json:{write:!0}})],eT.prototype,"maxWorldLength",void 0),eT=vk=u([R("esri.symbols.support.Symbol3DVerticalOffset")],eT);const Zme=eT;var q$;const Xme=Mt.ofType({base:null,key:"type",typeMap:{text:bw}});let Ky=q$=class extends YS{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Xme,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Hme(this)}hasVisibleVerticalOffset(){return gW(this)}clone(){return new q$({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail),callout:K(this.callout),verticalOffset:K(this.verticalOffset)})}static fromTextSymbol(t){return new q$({symbolLayers:[bw.fromTextSymbol(t)]})}};u([p({type:Zme,json:{write:!0}})],Ky.prototype,"verticalOffset",void 0),u([p(Wme)],Ky.prototype,"callout",void 0),u([p({json:{read:!1,write:!1}})],Ky.prototype,"styleOrigin",void 0),u([p({type:Xme})],Ky.prototype,"symbolLayers",void 0),u([et({LabelSymbol3D:"label-3d"},{readOnly:!0})],Ky.prototype,"type",void 0),Ky=q$=u([R("esri.symbols.LabelSymbol3D")],Ky);const E5=Ky;var W$;const Yme=Mt.ofType({base:null,key:"type",typeMap:{line:SR,path:mW}}),uFe=Mt.ofType({base:null,key:"type",typeMap:{line:SR,path:mW}});let JC=W$=class extends YS{constructor(t){super(t),this.symbolLayers=new Yme,this.type="line-3d"}clone(){return new W$({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleLineSymbol(t){return new W$({symbolLayers:[SR.fromSimpleLineSymbol(t)]})}};u([p({type:Yme,json:{type:uFe}})],JC.prototype,"symbolLayers",void 0),u([et({LineSymbol3D:"line-3d"},{readOnly:!0})],JC.prototype,"type",void 0),JC=W$=u([R("esri.symbols.LineSymbol3D")],JC);const C5=JC;let e0=class extends xc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],e0.prototype,"angle",void 0),u([p({type:["simple-marker","picture-marker"],readOnly:!0})],e0.prototype,"type",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],e0.prototype,"xoffset",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],e0.prototype,"yoffset",void 0),u([p({type:Number,cast:t=>t==="auto"?t:Jr(t),json:{write:!0}})],e0.prototype,"size",void 0),e0=u([R("esri.symbols.MarkerSymbol")],e0);const Jme=e0;var Z$;const Qme=Mt.ofType({base:null,key:"type",typeMap:{fill:TR}});let QC=Z$=class extends YS{constructor(t){super(t),this.symbolLayers=new Qme,this.type="mesh-3d"}clone(){return new Z$({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleFillSymbol(t){return new Z$({symbolLayers:[TR.fromSimpleFillSymbol(t)]})}};u([p({type:Qme})],QC.prototype,"symbolLayers",void 0),u([et({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],QC.prototype,"type",void 0),QC=Z$=u([R("esri.symbols.MeshSymbol3D")],QC);const A5=QC;function hFe(t,e,r){return e.imageData?wde({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):Kme(e.url,r)}function Kme(t,e){var r;return pFe(e)&&!fc(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?_c(e.layer.parsedUrl.path,"images",t):Lg(t,e)}function dFe(t,e,r,i){if(Xf(t)){const s=Db(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&w_(r.url,e,"url",i)}else w_(t,e,"url",i)}const ege={json:{read:{source:["imageData","url"],reader:hFe},write:{writer(t,e,r,i){dFe(t,e,this.source,i)}}}},tge={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=Kme(e.url,r)),i}}}};function pFe(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var bk;let Lu=bk=class extends wme{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=Jr(r)),i!=null&&(s.height=Jr(i)),s}clone(){const t=new bk({color:K(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",K(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([et({esriPFS:"picture-fill"},{readOnly:!0})],Lu.prototype,"type",void 0),u([p(ege)],Lu.prototype,"url",void 0),u([p({type:Number,json:{write:!0}})],Lu.prototype,"xscale",void 0),u([p({type:Number,json:{write:!0}})],Lu.prototype,"yscale",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],Lu.prototype,"width",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],Lu.prototype,"height",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],Lu.prototype,"xoffset",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],Lu.prototype,"yoffset",void 0),u([p(tge)],Lu.prototype,"source",void 0),Lu=bk=u([R("esri.symbols.PictureFillSymbol")],Lu);const rge=Lu;var wk;let td=wk=class extends Jme{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=Jr(e)),r!=null&&(i.height=Jr(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new wk({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",K(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([p({json:{write:!1}})],td.prototype,"color",void 0),u([et({esriPMS:"picture-marker"},{readOnly:!0})],td.prototype,"type",void 0),u([p(ege)],td.prototype,"url",void 0),u([p(tge)],td.prototype,"source",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],td.prototype,"height",void 0),u([Se("height",["height","size"])],td.prototype,"readHeight",null),u([p({type:Number,cast:Jr,json:{write:!0}})],td.prototype,"width",void 0),u([p({json:{write:!1}})],td.prototype,"size",void 0),td=wk=u([R("esri.symbols.PictureMarkerSymbol")],td);const O5=td;var Qv;const ige=Mt.ofType({base:null,key:"type",typeMap:{icon:W0,object:fW,text:bw}});let Kv=Qv=class extends YS{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new ige,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Hme(this)}hasVisibleVerticalOffset(){return gW(this)}clone(){return new Qv({verticalOffset:K(this.verticalOffset),callout:K(this.callout),styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Qv({symbolLayers:[W0.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new Qv({symbolLayers:[W0.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var i,s;if(((s=(i=t.data)==null?void 0:i.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new Qv(r!=null&&r.callout?{symbolLayers:[W0.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[W0.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new Qv({symbolLayers:[bw.fromTextSymbol(t)]})}};u([p({type:Zme,json:{write:!0}})],Kv.prototype,"verticalOffset",void 0),u([p(Wme)],Kv.prototype,"callout",void 0),u([p({type:ige,json:{origins:{"web-scene":{write:!0}}}})],Kv.prototype,"symbolLayers",void 0),u([et({PointSymbol3D:"point-3d"},{readOnly:!0})],Kv.prototype,"type",void 0),Kv=Qv=u([R("esri.symbols.PointSymbol3D")],Kv);const Z0=Kv;var KC;const sge=Mt.ofType({base:null,key:"type",typeMap:{extrude:vme,fill:TR,icon:W0,line:SR,object:fW,text:bw,water:kme}});let e3=KC=class extends YS{constructor(t){super(t),this.symbolLayers=new sge,this.type="polygon-3d"}clone(){return new KC({styleOrigin:K(this.styleOrigin),symbolLayers:K(this.symbolLayers),thumbnail:K(this.thumbnail)})}static fromJSON(t){const e=new KC;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),i=e.symbolLayers.at(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new KC({symbolLayers:[TR.fromSimpleFillSymbol(t)]})}};u([p({type:sge,json:{write:!0}})],e3.prototype,"symbolLayers",void 0),u([et({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],e3.prototype,"type",void 0),e3=KC=u([R("esri.symbols.PolygonSymbol3D")],e3);const ER=e3;var xk;const Q6=new Rr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let e1=xk=class extends wme{constructor(...t){super(...t),this.color=new ke([0,0,0,.25]),this.outline=new Ph,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new xk({color:K(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([p()],e1.prototype,"color",void 0),u([p()],e1.prototype,"outline",void 0),u([et({esriSFS:"simple-fill"},{readOnly:!0})],e1.prototype,"type",void 0),u([p({type:Q6.apiValues,json:{read:Q6.read,write:Q6.write}})],e1.prototype,"style",void 0),e1=xk=u([R("esri.symbols.SimpleFillSymbol")],e1);const ww=e1;var Tk;const K6=new Rr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let jp=Tk=class extends Jme{constructor(...t){super(...t),this.color=new ke([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Ph}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=Jr(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new Tk({angle:this.angle,color:K(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([p()],jp.prototype,"color",void 0),u([De("color")],jp.prototype,"writeColor",null),u([et({esriSMS:"simple-marker"},{readOnly:!0})],jp.prototype,"type",void 0),u([p()],jp.prototype,"size",void 0),u([p({type:K6.apiValues,json:{read:K6.read,write:K6.write}})],jp.prototype,"style",void 0),u([p({type:String,json:{write:!0}})],jp.prototype,"path",null),u([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Ph}},json:{default:null,write:!0}})],jp.prototype,"outline",void 0),jp=Tk=u([R("esri.symbols.SimpleMarkerSymbol")],jp);const k_=jp;var Sk;let vs=Sk=class extends xc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new T5,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return Jr(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new Sk({angle:this.angle,backgroundColor:K(this.backgroundColor),borderLineColor:K(this.borderLineColor),borderLineSize:this.borderLineSize,color:K(this.color),font:this.font&&this.font.clone(),haloColor:K(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([p({type:ke,json:{write:!0}})],vs.prototype,"backgroundColor",void 0),u([p({type:ke,json:{write:!0}})],vs.prototype,"borderLineColor",void 0),u([p({type:Number,json:{write:!0},cast:Jr})],vs.prototype,"borderLineSize",void 0),u([p({type:T5,json:{write:!0}})],vs.prototype,"font",void 0),u([p({...$me,json:{write:!0}})],vs.prototype,"horizontalAlignment",void 0),u([p({type:Boolean,json:{write:!0}})],vs.prototype,"kerning",void 0),u([p({type:ke,json:{write:!0}})],vs.prototype,"haloColor",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],vs.prototype,"haloSize",void 0),u([p({type:Boolean,json:{write:!0}})],vs.prototype,"rightToLeft",void 0),u([p({type:Boolean,json:{write:!0}})],vs.prototype,"rotated",void 0),u([p({type:String,json:{write:!0}})],vs.prototype,"text",void 0),u([et({esriTS:"text"},{readOnly:!0})],vs.prototype,"type",void 0),u([p({...Lme,json:{write:!0}})],vs.prototype,"verticalAlignment",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],vs.prototype,"xoffset",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],vs.prototype,"yoffset",void 0),u([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],vs.prototype,"angle",void 0),u([p({type:Number,json:{write:!0}})],vs.prototype,"width",void 0),u([p({type:Number})],vs.prototype,"lineWidth",void 0),u([De("lineWidth")],vs.prototype,"writeLineWidth",null),u([yr("lineWidth")],vs.prototype,"castLineWidth",null),u([p(Ime)],vs.prototype,"lineHeight",void 0),u([De("lineHeight")],vs.prototype,"writeLineHeight",null),vs=Sk=u([R("esri.symbols.TextSymbol")],vs);const JS=vs;var Ek;let rd=Ek=class extends xc{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:qn.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new Ek({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await ae(()=>Promise.resolve().then(()=>Jst),void 0);Qt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{Q.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};u([p({json:{write:!1}})],rd.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],rd.prototype,"styleName",void 0),u([p({type:qn,json:{write:!1}})],rd.prototype,"portal",void 0),u([p({type:String,json:{read:S5,write:w_}})],rd.prototype,"styleUrl",void 0),u([p({type:yb,json:{read:!1}})],rd.prototype,"thumbnail",void 0),u([p({type:String,json:{write:!0}})],rd.prototype,"name",void 0),u([et({styleSymbolReference:"web-style"},{readOnly:!0})],rd.prototype,"type",void 0),u([p()],rd.prototype,"_fetchCacheKey",null),rd=Ek=u([R("esri.symbols.WebStyleSymbol")],rd);const xw=rd;function R5(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function jb(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const _b={base:xc,key:"type",typeMap:{"simple-fill":ww,"picture-fill":rge,"picture-marker":O5,"simple-line":Ph,"simple-marker":k_,text:JS,"label-3d":E5,"line-3d":C5,"mesh-3d":A5,"point-3d":Z0,"polygon-3d":ER,"web-style":xw,cim:XS},errorContext:"symbol"},fFe={base:xc,key:"type",typeMap:{"picture-marker":O5,"simple-marker":k_,text:JS,"web-style":xw,cim:XS},errorContext:"symbol"},mFe=VS({types:_b}),nge={base:xc,key:"type",typeMap:{"simple-fill":ww,"picture-fill":rge,"picture-marker":O5,"simple-line":Ph,"simple-marker":k_,text:JS,"line-3d":C5,"mesh-3d":A5,"point-3d":Z0,"polygon-3d":ER,"web-style":xw,cim:XS},errorContext:"symbol"},gFe={base:xc,key:"type",typeMap:{text:JS,"label-3d":E5},errorContext:"symbol"},bK={base:xc,key:"type",typeMap:{"line-3d":C5,"mesh-3d":A5,"point-3d":Z0,"polygon-3d":ER,"web-style":xw,cim:XS},errorContext:"symbol"},yFe={base:xc,key:"type",typeMap:{"label-3d":E5},errorContext:"symbol"},oge=tp(_b);var Ck;function _Fe(t){if(!t)return null;const e={};for(const r in t){const i=g_(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function vFe(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let zl=Ck=class extends ji(de){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:pc(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new Ck({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:vFe(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(s.action=i),t==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};u([p({value:null,json:{read:_Fe}})],zl.prototype,"aggregateGeometries",null),u([p({value:null})],zl.prototype,"attributes",null),u([p({value:null,types:gw,json:{read:g_}})],zl.prototype,"geometry",null),u([p({type:Boolean})],zl.prototype,"isAggregate",void 0),u([p({clonable:"reference"})],zl.prototype,"layer",void 0),u([p({type:ZS})],zl.prototype,"popupTemplate",void 0),u([p({clonable:"reference"})],zl.prototype,"sourceLayer",void 0),u([p({value:null,types:_b})],zl.prototype,"symbol",null),u([p({type:Boolean,value:!0})],zl.prototype,"visible",null),zl=Ck=u([R("esri.Graphic")],zl),function(t){t.generateUID=pc}(zl||(zl={}));const hu=zl;var Ak;let t0=Ak=class extends de{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new Ak({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function eU(){return{enabled:!this.camera}}u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:eU}}}}})],t0.prototype,"rotation",void 0),u([yr("rotation")],t0.prototype,"castRotation",null),u([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:eU}}}}})],t0.prototype,"scale",void 0),u([p({types:gw,json:{read:g_,write:!0,origins:{"web-scene":{read:g_,write:{overridePolicy:eU}}}}})],t0.prototype,"targetGeometry",void 0),u([p({type:vh,json:{write:!0}})],t0.prototype,"camera",void 0),t0=Ak=u([R("esri.Viewpoint")],t0);const sp=t0;function P5(t){return typeof t=="string"?document.getElementById(t):t??null}function age(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function wK(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function xK(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function ue(t,e,r={}){return _W(t,e,r,lge)}function xh(t,e,r={}){return _W(t,e,r,cge)}function _W(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(Di(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=KRe(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function Ga(t,e,r,i={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=i.onListenerRemove)==null||h.call(i,s),s=null,n=null)}function l(h){i.once&&i.once&&Di(o),r(h)}const c=ue(t,(h,d)=>{var f;a(),Y4(h)&&(s=h,n=pR(h,e,l),(f=i.onListenerAdd)==null||f.call(i,h))},{sync:i.sync,initial:!0});return o=ja(()=>{c.remove(),a()}),o}function K2(t,e){return bFe(t,cge,e)}function bFe(t,e,r){if(vn(r))return Promise.reject(Dr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let s=null;function n(){s=Di(s)}return new Promise((o,a)=>{s=V2([oa(r,()=>{n(),a(Dr())}),_W(t,l=>{n(),o(l)},{sync:!1,once:!0},e??lge)])})}function lge(t){return!0}function cge(t){return!!t}const jr={sync:!0},zr={initial:!0},As={sync:!0,initial:!0};let Ok=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new e5,this._items=new Set}get length(){return Xt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Xt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Xt(this._observable),yield*this._items}};const wFe={statsWorker:()=>ae(()=>import("./statsWorker-b60585aa.js"),["assets/statsWorker-b60585aa.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js"]),geometryEngineWorker:()=>ae(()=>import("./geometryEngineWorker-afa7f6ea.js"),["assets/geometryEngineWorker-afa7f6ea.js","assets/geometryEngineJSON-f5db546b.js","assets/geometryEngineBase-df7c28c6.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>ae(()=>import("./CSVSourceWorker-eb368df3.js"),["assets/CSVSourceWorker-eb368df3.js","assets/json-48e3ea08.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/number-bccc9b73.js","assets/clientSideDefaults-68e78bf2.js"]),EdgeProcessingWorker:()=>ae(()=>import("./EdgeProcessingWorker-cbd75729.js"),[]),ElevationSamplerWorker:()=>ae(()=>import("./ElevationSamplerWorker-1828ca5f.js"),["assets/ElevationSamplerWorker-1828ca5f.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/georeference-e124cffe.js","assets/MeshGeoreferencedRelativeVertexSpace-13b8f062.js","assets/MeshLocalVertexSpace-25f04cf2.js"]),FeatureServiceSnappingSourceWorker:()=>ae(()=>import("./FeatureServiceSnappingSourceWorker-448c39af.js"),["assets/FeatureServiceSnappingSourceWorker-448c39af.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/symbologySnappingCandidates-0cb5be49.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/query-dae0ecc4.js"]),GeoJSONSourceWorker:()=>ae(()=>import("./GeoJSONSourceWorker-0c7f3914.js"),["assets/GeoJSONSourceWorker-0c7f3914.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/geojson-311fa6ac.js","assets/clientSideDefaults-68e78bf2.js","assets/sourceUtils-81270172.js"]),LercWorker:()=>ae(()=>import("./LercWorker-54f940e3.js"),[]),MemorySourceWorker:()=>ae(()=>import("./MemorySourceWorker-2517c40b.js"),["assets/MemorySourceWorker-2517c40b.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/clientSideDefaults-68e78bf2.js","assets/sourceUtils-81270172.js"]),PBFDecoderWorker:()=>ae(()=>import("./PBFDecoderWorker-b7c04255.js"),["assets/PBFDecoderWorker-b7c04255.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js"]),Pipeline:()=>ae(()=>import("./Pipeline-153804f1.js").then(t=>t.P),["assets/Pipeline-153804f1.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/StreamFeatureManager-b356a5cc.js","assets/quickselect-d68fa842.js","assets/arcadeTimeUtils-e7b7fe91.js","assets/centroid-8e8cfa47.js","assets/ogcFeatureUtils-1d99ad58.js","assets/geojson-311fa6ac.js","assets/clientSideDefaults-68e78bf2.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/createConnection-bf269f20.js","assets/definitions-411d1582.js","assets/TileInfoView-d1d8c36f.js","assets/number-e491b09e.js","assets/geohashUtils-77d8429b.js"]),PointCloudWorker:()=>ae(()=>import("./PointCloudWorker-46d4ffa7.js"),["assets/PointCloudWorker-46d4ffa7.js","assets/PointCloudWorkerUtil-e8894da1.js","assets/PointCloudUniqueValueRenderer-3cdf7e92.js"]),RasterWorker:()=>ae(()=>import("./RasterWorker-026c8f99.js"),["assets/RasterWorker-026c8f99.js","assets/dataUtils-b5ae5508.js","assets/colorUtils-c0f43caf.js","assets/utils-f65b39df.js","assets/rasterProjectionHelper-00227a09.js"]),SceneLayerSnappingSourceWorker:()=>ae(()=>import("./SceneLayerSnappingSourceWorker-f9420714.js"),[]),SceneLayerWorker:()=>ae(()=>import("./SceneLayerWorker-b2e5cad6.js").then(t=>t.a),["assets/SceneLayerWorker-b2e5cad6.js","assets/MeshGeoreferencedRelativeVertexSpace-13b8f062.js","assets/MeshLocalVertexSpace-25f04cf2.js","assets/I3SNode-4e1dfdcf.js"]),WFSSourceWorker:()=>ae(()=>import("./WFSSourceWorker-e18bc1f7.js"),["assets/WFSSourceWorker-e18bc1f7.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/geojson-311fa6ac.js","assets/sourceUtils-81270172.js","assets/wfsUtils-ee6cfe5c.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>ae(()=>import("./WorkerTileHandler-c61e7385.js"),["assets/WorkerTileHandler-c61e7385.js","assets/TileClipper-ae6eca9e.js","assets/StyleRepository-5f1070d6.js","assets/colorUtils-c0f43caf.js","assets/definitions-411d1582.js","assets/Rect-98da58d6.js","assets/pbf-261a804a.js","assets/TurboLine-9003872c.js","assets/BidiEngine-9a40f2f4.js"])};var $o;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})($o||($o={}));let xFe=0;function uge(){return xFe++}function TFe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function bO(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function vW(t,e,r,i){if(e.type===$o.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==$o.INVOKE&&e.type!==$o.RESPONSE)return void t.postMessage(e);let s;if(TFe(r)?(s=TK(r.transferList),e.data=r.result):(s=TK(i),e.data=r),s){if(oe("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case $o.INVOKE:throw o;case $o.RESPONSE:return void vW(t,{type:$o.RESPONSE,jobId:e.jobId,error:bO(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function wO(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function TK(t){if(!t||!t.length)return null;if(oe("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!SFe(r));return e.length?e:null}function SFe(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}const{CLOSE:SK,ABORT:EK,INVOKE:CK,RESPONSE:RE,OPEN_PORT:AK,ON:EFe}=$o,CFe=2;let AFe=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===$o.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},x_=class tT{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new tT(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),tT.clients.set(s,i),r.port2}static loadWorker(e){const r=wFe[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new AFe(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:SK}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const s=i==null?void 0:i.signal,n=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new U("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=uge();return new Promise((a,l)=>{if(vn(s))return this._processWork(),void l(Dr());const c=oa(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),Di(d.abortHandle),this._post({type:EK,jobId:o}),l(Dr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:CK,jobId:o,methodName:e,abortable:s!=null},r,n)})}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:$o.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:$o.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:AK,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=CFe)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=e;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Di(e.abortHandle),e.reject(Dr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=wO(e);if(r)switch(r.type){case RE:this._onResponseMessage(r);break;case CK:this._invokeQueue.push(r);break;case EK:this._onAbortMessage(r);break;case SK:this._onCloseMessage();break;case AK:this._onOpenPortMessage(r);break;case EFe:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&tT.clients.get(this)===e&&e.destroy(),tT.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const d=r.split(".");for(let f=0;f<d.length-1;f++)c=c[d[f]],h=c[d[f+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:RE,jobId:i,error:bO(d)})}gu(l)?(a.set(i,{controller:o,promise:l}),l.then(d=>{a.has(i)&&(a.delete(i),this._post({type:RE,jobId:i},d))},d=>{a.has(i)&&(a.delete(i),ys(d)||this._post({type:RE,jobId:i,error:bO(d||{message:`Error encountered at method ${r}`})}))})):this._post({type:RE,jobId:i},l)}_onOpenPortMessage(e){new tT(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=pR(e.port,"message",n=>{const o=wO(n);(o==null?void 0:o.type)===$o.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),Di(o.abortHandle),i?o.reject(U.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return vW(this._port,e,r,i)}};x_.kernelInfo={buildDate:Ude,fullVersion:yq,revision:Vde},x_.clients=new Map;let OFe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Ok}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{Qt(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];gu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new x_(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new x_(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Dr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,r,i){let s;Array.isArray(i)?(Q.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=yo();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:s,resolver:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>V2(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const hge=Q.getLogger("esri.intl.substitute");function NSt(t,e,r={}){const{format:i={}}=r;return X4(t,s=>RFe(s,e,i))}function RFe(t,e,r){let i,s;const n=t.indexOf(":");if(n===-1?i=t.trim():(i=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!i)return"";const o=hR(i,e);if(o==null)return"";const a=(s?r==null?void 0:r[s]:null)??(r==null?void 0:r[i]);return a?PFe(o,a):s?MFe(o,s):bW(o)}function PFe(t,e){switch(e.type){case"date":return b_(t,e.intlOptions);case"number":return Y2(t,e.intlOptions);default:return hge.warn("missing format descriptor for key {key}"),bW(t)}}function MFe(t,e){switch(e.toLowerCase()){case"dateformat":return b_(t);case"numberformat":return Y2(t);default:return hge.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?b_(t):/^numberformat/i.test(e)?Y2(t):bW(t)}}function bW(t){switch(typeof t){case"string":return t;case"number":return Y2(t);case"boolean":return""+t;default:return t instanceof Date?b_(t):""}}async function IFe(t,e,r,i){const s=e.exec(r);if(!s)throw new U("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=a$e(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await OK(t(c))}catch(d){if(c===l)throw new U("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:d});try{h=await OK(t(l))}catch(f){throw new U("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return h}async function OK(t){if(RK.fetchBundleAsset!=null)return RK.fetchBundleAsset(t);const e=await Fr(t,{responseType:"text"});return JSON.parse(e.data)}let $Fe=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return IFe(this.getAssetUrl,this.matcher,e,r)}};function LFe(t){return new $Fe(t)}const RK={};o$e(LFe({pattern:"esri/",location:Br}));const DFe={};function NFe(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=DFe.baseUrl),e}let FFe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},X$=class{constructor(){this._dispatcher=new FFe,this._workerPostMessage({type:$o.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){z2(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){z2(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=wO(e);if(r&&r.type===$o.OPEN){const{modulePath:i,jobId:s}=r;let n=await x_.loadWorker(i);n||(n=await ae(()=>import(i),[]));const o=x_.connect(n);this._workerPostMessage({type:$o.OPENED,jobId:s,data:o})}}};const Rk=Q.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:UFe}=$o,VFe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let PP,MP;const PK="Failed to create Worker. Fallback to execute module in main thread";async function zFe(){if(!oe("esri-workers")||(oe("mozilla"),0))return MK(new X$);if(!PP&&!MP)try{const e=VFe.split('"{CONFIGURATION}"').join(`'${kFe()}'`);PP=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){MP=e||{}}let t;if(PP)try{t=new Worker(PP,{name:"esri-worker-"+BFe++})}catch{Rk.warn(PK,MP),t=new X$}else Rk.warn(PK,MP),t=new X$;return MK(t)}async function MK(t){return new Promise(e=>{function r(s){const n=wO(s);n&&n.type===UFe&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),Rk.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new X$).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function kFe(){let t;if(Yr.default!=null){const s={...Yr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Yr));t.assetsPath=Jc(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Jc(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Wd(),t.has={"esri-csp-restrictions":oe("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":oe("esri-2d-update-debug"),"esri-2d-log-updating":oe("esri-2d-log-updating"),"featurelayer-pbf":oe("featurelayer-pbf"),"featurelayer-simplify-thresholds":oe("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":oe("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":oe("featurelayer-simplify-mobile-factor"),"esri-atomics":oe("esri-atomics"),"esri-shared-array-buffer":oe("esri-shared-array-buffer"),"esri-tiles-debug":oe("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":oe("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":oe("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":oe("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=Jc(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Jc(t.workers.workerPath):t.workers.workerPath=Jc(Br("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Yr.workers.loaderConfig,r=NFe({baseUrl:e==null?void 0:e.baseUrl,locale:Wd(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:Ude,fullVersion:yq,revision:Vde}})}let BFe=0;const{ABORT:IK,INVOKE:GFe,OPEN:jFe,OPENED:HFe,RESPONSE:PE}=$o;let qFe=class dge{static async create(e){const r=await zFe();return new dge(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),Q.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=uge();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:BH(i,()=>{this._outJobs.delete(s),this._post({type:IK,jobId:s})})};this._outJobs.set(s,a),this._post({type:jFe,jobId:s,modulePath:e})})}_onMessage(e){const r=wO(e);if(r)switch(r.type){case HFe:this._onOpenedMessage(r);break;case PE:this._onResponseMessage(r);break;case IK:this._onAbortMessage(r);break;case GFe:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=oIe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:PE,jobId:i,error:bO(h)})}gu(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:PE,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),ys(h)||this._post({type:PE,jobId:i,error:bO(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:PE,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Di(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Di(n.abortHandle),i?n.reject(U.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return vW(this.worker,e,r,i)}};const $K=oe("host-browser")?Math.min(navigator.hardwareConcurrency-1,oe("workers-pool-size")):0;let rb=oe("esri-mobile")?Math.min($K,3):$K;rb||(rb=oe("safari")&&oe("mac")?7:2);let LK=0;const Y$=[];function WFe(){fge()}async function IP(t,e){const r=new OFe;return await r.open(t,e),r}async function pge(t,e={}){if(typeof t!="string")throw new U("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(oe("host-webworker")&&!oe("esri-workers")&&(r="local"),r==="local"){let i=await x_.loadWorker(t);i||(i=await ae(()=>import(t),[])),Qt(e.signal);const s=e.client||i;return IP([x_.connect(i)],{...e,client:s})}if(await fge(),Qt(e.signal),r==="dedicated"){const i=LK++%rb;return IP([await Y$[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,rb);if(i<rb){const s=new Array(i);for(let n=0;n<i;++n){const o=LK++%rb;s[n]=Y$[o].open(t,e)}return IP(s,e)}}return IP(Y$.map(i=>i.open(t,e)),e)}let $P=null;async function fge(){if($P)return $P;new AbortController;const t=[];for(let e=0;e<rb;e++){const r=qFe.create(e).then(i=>(Y$[e]=i,i));t.push(r)}return $P=Promise.all(t),$P}let Ef=class extends xe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Mi,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,ue)}addWhen(e,r,i={}){return this._installWatch(e,r,i,xh)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([Ga(e,"after-changes",this._createSyncUpdatingCallback(),jr),Ga(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),ja(()=>this._handles.remove(n))}addPromise(e){if(e==null)return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(LP)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this._handles.add(o,n),ja(()=>this._handles.remove(n))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=ue(e,i,{sync:!0,equals:()=>!1});return this._handles.add(s,r),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(LP),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(US(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(LP))}),LP)}}};u([p({readOnly:!0})],Ef.prototype,"updating",void 0),Ef=u([R("esri.core.support.WatchUpdatingTracking")],Ef);const LP=-42,M5=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new Mi,this._updatingHandles=new Ef}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return u([p({readOnly:!0})],e.prototype,"handles",null),u([p({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([R("esri.core.HandleOwner")],e),e};let xO=class extends M5(xe){};xO=u([R("esri.core.HandleOwner")],xO);let vA=class extends M5(Mt){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Mt.ofType(this.itemType.Type))(e):new Mt(e)}};function tN(t,e){return{type:t,cast:ade,set(r){const i=Lb(r,this._get(e),t);i.owner=this,this._set(e,i)}}}u([p()],vA.prototype,"owner",null),vA=u([R("esri.core.support.OwningCollection")],vA);var t3;const rN=Wa()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),mge=rN.jsonValues.slice();iO(mge,"orthometric");const bA=Wa()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let id=t3=class extends de{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return rN.write(t,e,r)}readHeightModel(t,e,r){return rN.read(t)||(r&&r.messages&&r.messages.push(ZFe(t,{context:r})),null)}readHeightUnit(t,e,r){return bA.read(t)||(r&&r.messages&&r.messages.push(DK(t,{context:r})),null)}readHeightUnitService(t,e,r){return Lde(t)||bA.read(t)||(r&&r.messages&&r.messages.push(DK(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new t3({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=YMe(e);return new t3({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new t3;return e.read(t,{origin:"web-scene"}),e}};function DK(t,e){return new yh("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function ZFe(t,e){return new yh("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([p({type:rN.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:mge,default:"ellipsoidal"}}}})],id.prototype,"heightModel",void 0),u([De("web-scene","heightModel")],id.prototype,"writeHeightModel",null),u([Se(["web-scene","service"],"heightModel")],id.prototype,"readHeightModel",null),u([p({type:bA.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:bA.jsonValues,write:bA.write}}}})],id.prototype,"heightUnit",void 0),u([Se("web-scene","heightUnit")],id.prototype,"readHeightUnit",null),u([Se("service","heightUnit")],id.prototype,"readHeightUnitService",null),u([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],id.prototype,"vertCRS",void 0),u([Se("service","vertCRS",["vertCRS","ellipsoid","geoid"])],id.prototype,"readVertCRS",null),id=t3=u([R("esri.geometry.HeightModelInfo")],id);const Tw=id;function $s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Kf(t,e,r,i,s,n,o,a,l,c,h,d,f,m,y,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=d,t[11]=f,t[12]=m,t[13]=y,t[14]=_,t[15]=v,t}function Th(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bc(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function QS(t,e){return xn(t,e)||Th(t),t}function xn(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,O=i*l-s*a,C=i*c-n*a,P=s*c-n*l,$=h*_-d*y,V=h*v-f*y,z=h*w-m*y,B=d*v-f*_,k=d*w-m*_,Z=f*w-m*v;let W=T*Z-x*k+S*B+O*z-C*V+P*$;return W?(W=1/W,t[0]=(a*Z-l*k+c*B)*W,t[1]=(s*k-i*Z-n*B)*W,t[2]=(_*P-v*C+w*O)*W,t[3]=(f*C-d*P-m*O)*W,t[4]=(l*z-o*Z-c*V)*W,t[5]=(r*Z-s*z+n*V)*W,t[6]=(v*S-y*P-w*x)*W,t[7]=(h*P-f*S+m*x)*W,t[8]=(o*k-a*z+c*$)*W,t[9]=(i*z-r*k-n*$)*W,t[10]=(y*C-_*S+w*T)*W,t[11]=(d*S-h*C-m*T)*W,t[12]=(a*V-o*B-l*$)*W,t[13]=(r*B-i*V+s*$)*W,t[14]=(_*x-y*O-v*T)*W,t[15]=(h*O-d*x+f*T)*W,t):null}function XFe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15];return t[0]=a*(f*w-m*v)-d*(l*w-c*v)+_*(l*m-c*f),t[1]=-(i*(f*w-m*v)-d*(s*w-n*v)+_*(s*m-n*f)),t[2]=i*(l*w-c*v)-a*(s*w-n*v)+_*(s*c-n*l),t[3]=-(i*(l*m-c*f)-a*(s*m-n*f)+d*(s*c-n*l)),t[4]=-(o*(f*w-m*v)-h*(l*w-c*v)+y*(l*m-c*f)),t[5]=r*(f*w-m*v)-h*(s*w-n*v)+y*(s*m-n*f),t[6]=-(r*(l*w-c*v)-o*(s*w-n*v)+y*(s*c-n*l)),t[7]=r*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(d*w-m*_)-h*(a*w-c*_)+y*(a*m-c*d),t[9]=-(r*(d*w-m*_)-h*(i*w-n*_)+y*(i*m-n*d)),t[10]=r*(a*w-c*_)-o*(i*w-n*_)+y*(i*c-n*a),t[11]=-(r*(a*m-c*d)-o*(i*m-n*d)+h*(i*c-n*a)),t[12]=-(o*(d*v-f*_)-h*(a*v-l*_)+y*(a*f-l*d)),t[13]=r*(d*v-f*_)-h*(i*v-s*_)+y*(i*f-s*d),t[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+y*(i*l-s*a)),t[15]=r*(a*f-l*d)-o*(i*f-s*d)+h*(i*l-s*a),t}function YFe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],d=t[10],f=t[11],m=t[12],y=t[13],_=t[14],v=t[15];return(e*o-r*n)*(d*v-f*_)-(e*a-i*n)*(h*v-f*y)+(e*l-s*n)*(h*_-d*y)+(r*a-i*o)*(c*v-f*m)-(r*l-s*o)*(c*_-d*m)+(i*l-s*a)*(c*y-h*m)}function ni(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=e[9],m=e[10],y=e[11],_=e[12],v=e[13],w=e[14],T=e[15];let x=r[0],S=r[1],O=r[2],C=r[3];return t[0]=x*i+S*a+O*d+C*_,t[1]=x*s+S*l+O*f+C*v,t[2]=x*n+S*c+O*m+C*w,t[3]=x*o+S*h+O*y+C*T,x=r[4],S=r[5],O=r[6],C=r[7],t[4]=x*i+S*a+O*d+C*_,t[5]=x*s+S*l+O*f+C*v,t[6]=x*n+S*c+O*m+C*w,t[7]=x*o+S*h+O*y+C*T,x=r[8],S=r[9],O=r[10],C=r[11],t[8]=x*i+S*a+O*d+C*_,t[9]=x*s+S*l+O*f+C*v,t[10]=x*n+S*c+O*m+C*w,t[11]=x*o+S*h+O*y+C*T,x=r[12],S=r[13],O=r[14],C=r[15],t[12]=x*i+S*a+O*d+C*_,t[13]=x*s+S*l+O*f+C*v,t[14]=x*n+S*c+O*m+C*w,t[15]=x*o+S*h+O*y+C*T,t}function Cl(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],m=e[7],y=e[8],_=e[9],v=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=d,t[6]=f,t[7]=m,t[8]=y,t[9]=_,t[10]=v,t[11]=w,t[12]=o*i+h*s+y*n+e[12],t[13]=a*i+d*s+_*n+e[13],t[14]=l*i+f*s+v*n+e[14],t[15]=c*i+m*s+w*n+e[15]}return t}function I5(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function uc(t,e,r,i){let s,n,o,a,l,c,h,d,f,m,y,_,v,w,T,x,S,O,C,P,$,V,z,B,k=i[0],Z=i[1],W=i[2],j=Math.sqrt(k*k+Z*Z+W*W);return j<Xa()?null:(j=1/j,k*=j,Z*=j,W*=j,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],h=e[3],d=e[4],f=e[5],m=e[6],y=e[7],_=e[8],v=e[9],w=e[10],T=e[11],x=k*k*o+n,S=Z*k*o+W*s,O=W*k*o-Z*s,C=k*Z*o-W*s,P=Z*Z*o+n,$=W*Z*o+k*s,V=k*W*o+Z*s,z=Z*W*o-k*s,B=W*W*o+n,t[0]=a*x+d*S+_*O,t[1]=l*x+f*S+v*O,t[2]=c*x+m*S+w*O,t[3]=h*x+y*S+T*O,t[4]=a*C+d*P+_*$,t[5]=l*C+f*P+v*$,t[6]=c*C+m*P+w*$,t[7]=h*C+y*P+T*$,t[8]=a*V+d*z+_*B,t[9]=l*V+f*z+v*B,t[10]=c*V+m*z+w*B,t[11]=h*V+y*z+T*B,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function eS(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+h*i,t[6]=a*s+d*i,t[7]=l*s+f*i,t[8]=c*s-n*i,t[9]=h*s-o*i,t[10]=d*s-a*i,t[11]=f*s-l*i,t}function $5(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-h*i,t[2]=a*s-d*i,t[3]=l*s-f*i,t[8]=n*i+c*s,t[9]=o*i+h*s,t[10]=a*i+d*s,t[11]=l*i+f*s,t}function tS(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+h*i,t[2]=a*s+d*i,t[3]=l*s+f*i,t[4]=c*s-n*i,t[5]=h*s-o*i,t[6]=d*s-a*i,t[7]=f*s-l*i,t}function CR(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function JFe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function du(t,e,r){if(e===0)return Th(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Xa()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function gge(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function QFe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yge(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _ge(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,h=i*a,d=i*l,f=i*c,m=s*l,y=s*c,_=n*c,v=o*a,w=o*l,T=o*c;return t[0]=1-(m+_),t[1]=d+T,t[2]=f-w,t[3]=0,t[4]=d-T,t[5]=1-(h+_),t[6]=y+v,t[7]=0,t[8]=f+w,t[9]=y-v,t[10]=1-(h+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function KFe(t,e){const r=e6e,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=i*i+s*s+n*n+o*o;return d>0?(r[0]=2*(a*o+h*i+l*n-c*s)/d,r[1]=2*(l*o+h*s+c*i-a*n)/d,r[2]=2*(c*o+h*n+a*s-l*i)/d):(r[0]=2*(a*o+h*i+l*n-c*s),r[1]=2*(l*o+h*s+c*i-a*n),r[2]=2*(c*o+h*n+a*s-l*i)),_ge(t,e,r),t}const e6e=A();function Pk(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function vge(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function t6e(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function r6e(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,d=s*l,f=s*c,m=s*h,y=n*c,_=n*h,v=o*h,w=a*l,T=a*c,x=a*h,S=i[0],O=i[1],C=i[2];return t[0]=(1-(y+v))*S,t[1]=(f+x)*S,t[2]=(m-T)*S,t[3]=0,t[4]=(f-x)*O,t[5]=(1-(d+v))*O,t[6]=(_+w)*O,t[7]=0,t[8]=(m+T)*C,t[9]=(_-w)*C,t[10]=(1-(d+y))*C,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function i6e(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,d=a+a,f=n*c,m=n*h,y=n*d,_=o*h,v=o*d,w=a*d,T=l*c,x=l*h,S=l*d,O=i[0],C=i[1],P=i[2],$=s[0],V=s[1],z=s[2],B=(1-(_+w))*O,k=(m+S)*O,Z=(y-x)*O,W=(m-S)*C,j=(1-(f+w))*C,Y=(v+T)*C,M=(y+x)*P,D=(v-T)*P,N=(1-(f+_))*P;return t[0]=B,t[1]=k,t[2]=Z,t[3]=0,t[4]=W,t[5]=j,t[6]=Y,t[7]=0,t[8]=M,t[9]=D,t[10]=N,t[11]=0,t[12]=r[0]+$-(B*$+W*V+M*z),t[13]=r[1]+V-(k*$+j*V+D*z),t[14]=r[2]+z-(Z*$+Y*V+N*z),t[15]=1,t}function s6e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,d=i*a,f=s*o,m=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-d-y,t[1]=h+w,t[2]=f-v,t[3]=0,t[4]=h-w,t[5]=1-c-y,t[6]=m+_,t[7]=0,t[8]=f+v,t[9]=m-_,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function bge(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function n6e(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function o6e(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function wge(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function L5(t,e,r,i){const s=e[0],n=e[1],o=e[2];let a=s-r[0],l=n-r[1],c=o-r[2];const h=Xa();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void Th(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const f=i[0],m=i[1],y=i[2];let _=m*c-y*l,v=y*a-f*c,w=f*l-m*a;d=Math.sqrt(_*_+v*v+w*w),d?(d=1/d,_*=d,v*=d,w*=d):(_=0,v=0,w=0);let T=l*w-c*v,x=c*_-a*w,S=a*v-l*_;d=Math.sqrt(T*T+x*x+S*S),d?(d=1/d,T*=d,x*=d,S*=d):(T=0,x=0,S=0),t[0]=_,t[1]=T,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=w,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+w*o),t[13]=-(T*s+x*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function xge(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let h=s-r[0],d=n-r[1],f=o-r[2],m=h*h+d*d+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,d*=m,f*=m);let y=l*f-c*d,_=c*h-a*f,v=a*d-l*h;return m=y*y+_*_+v*v,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,v*=m),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=d*v-f*_,t[5]=f*y-h*v,t[6]=h*_-d*y,t[7]=0,t[8]=h,t[9]=d,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function a6e(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function l6e(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function c6e(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Tge(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function u6e(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function h6e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function Sge(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function wW(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=t[9],f=t[10],m=t[11],y=t[12],_=t[13],v=t[14],w=t[15],T=e[0],x=e[1],S=e[2],O=e[3],C=e[4],P=e[5],$=e[6],V=e[7],z=e[8],B=e[9],k=e[10],Z=e[11],W=e[12],j=e[13],Y=e[14],M=e[15],D=Xa();return Math.abs(r-T)<=D*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-x)<=D*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-S)<=D*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-O)<=D*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(o-C)<=D*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(a-P)<=D*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(l-$)<=D*Math.max(1,Math.abs(l),Math.abs($))&&Math.abs(c-V)<=D*Math.max(1,Math.abs(c),Math.abs(V))&&Math.abs(h-z)<=D*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(d-B)<=D*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(f-k)<=D*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(m-Z)<=D*Math.max(1,Math.abs(m),Math.abs(Z))&&Math.abs(y-W)<=D*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(_-j)<=D*Math.max(1,Math.abs(_),Math.abs(j))&&Math.abs(v-Y)<=D*Math.max(1,Math.abs(v),Math.abs(Y))&&Math.abs(w-M)<=D*Math.max(1,Math.abs(w),Math.abs(M))}function xW(t){const e=Xa(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function D5(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const d6e=ni,p6e=Tge;Object.freeze(Object.defineProperty({__proto__:null,add:c6e,adjoint:XFe,copy:$s,determinant:YFe,equals:wW,exactEquals:Sge,frob:l6e,fromQuat:s6e,fromQuat2:KFe,fromRotation:du,fromRotationTranslation:_ge,fromRotationTranslationScale:r6e,fromRotationTranslationScaleOrigin:i6e,fromScaling:JFe,fromTranslation:CR,fromXRotation:gge,fromYRotation:QFe,fromZRotation:yge,frustum:bge,getRotation:t6e,getScaling:vge,getTranslation:Pk,hasIdentityRotation:D5,identity:Th,invert:xn,invertOrIdentity:QS,isOrthoNormal:xW,lookAt:L5,mul:d6e,multiply:ni,multiplyScalar:u6e,multiplyScalarAndAdd:h6e,ortho:wge,perspective:n6e,perspectiveFromFieldOfView:o6e,rotate:uc,rotateX:eS,rotateY:$5,rotateZ:tS,scale:I5,set:Kf,str:a6e,sub:p6e,subtract:Tge,targetTo:xge,translate:Cl,transpose:bc},Symbol.toStringTag,{value:"Module"}));let tU,te=null;function Ege(){return!!te}function f6e(){return!!oe("esri-wasm")}function Cge(){return tU||(tU=ae(()=>import("./pe-wasm-5521fd23.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>Br(`esri/geometry/support/${e}`)})).then(t=>{Oge(t)}),tU)}var Mk,Ts,Ik;(function(t){function e(n,o,a){te.ensureCache.prepare();const l=z1(a),c=a===l,h=te.ensureFloat64(l),d=te._pe_geog_to_proj(te.getPointer(n),o,h);return d&&L0(a,o,h,c),d}function r(n,o,a,l){switch(l){case Ts.PE_TRANSFORM_P_TO_G:return i(n,o,a);case Ts.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){te.ensureCache.prepare();const c=z1(a),h=a===c,d=te.ensureFloat64(c),f=te._pe_proj_to_geog_center(te.getPointer(n),o,d,l);return f&&L0(a,o,d,h),f}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})(Mk||(Mk={})),function(t){function e(){t.PE_BUFFER_MAX=te.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=te.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=te.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=te.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=te.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=te.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=te.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=te.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=te.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=te.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=te.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=te.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=te.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=te.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=te.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=te.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=te.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=te.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=te.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=te.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=te.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=te.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=te.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=te.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=te.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=te.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=te.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=te.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=te.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=te.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Ts||(Ts={})),function(t){const e={},r={},i=m=>{if(m){const y=m.getType();switch(y){case Ts.PE_TYPE_GEOGCS:m=te.castObject(m,te.PeGeogcs);break;case Ts.PE_TYPE_PROJCS:m=te.castObject(m,te.PeProjcs);break;case Ts.PE_TYPE_GEOGTRAN:m=te.castObject(m,te.PeGeogtran);break;default:y&Ts.PE_TYPE_UNIT&&(m=te.castObject(m,te.PeUnit))}}return m};function s(){te.PeFactory.prototype.initialize(null)}function n(m){return o(Ts.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(y)))_=v[y];else{const w=te.PeFactory.prototype.factoryByType(m,y);te.compare(w,te.NULL)||(_=w,v[y]=_)}return _=i(_),_}function a(m,y){let _=null,v=r[m];if(v||(v={},r[m]=v),v.hasOwnProperty(y))_=v[y];else{const w=te.PeFactory.prototype.fromString(m,y);te.compare(w,te.NULL)||(_=w,v[y]=_)}return _=i(_),_}function l(m){return o(Ts.PE_TYPE_GEOGCS,m)}function c(m){return o(Ts.PE_TYPE_GEOGTRAN,m)}function h(m){return te.PeFactory.prototype.getCode(m)}function d(m){return o(Ts.PE_TYPE_PROJCS,m)}function f(m){return o(Ts.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=d,t.unit=f}(Ik||(Ik={}));let Age=null;var iN,$k,Lk,Dk,sN,Nk,nN,oN,Fk;function Oge(t){function e(n,o,a){n[o]=a(n[o])}te=t,Ts.init(),iN.init(),sN.init(),nN.init(),oN.init(),Age=class extends te.PeGCSExtent{destroy(){te.destroy(this)}};const r=[te.PeDatum,te.PeGeogcs,te.PeGeogtran,te.PeObject,te.PeParameter,te.PePrimem,te.PeProjcs,te.PeSpheroid,te.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(Ts.PE_NAME_MAX))});for(const n of[te.PeGeogtran,te.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(Ts.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=te.getValue(l,"*");a[c]=h?te.wrapPointer(h,te.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(te.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return L0(a,o,n.call(this)),a}),e(te.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=te._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!te.compare(l,te.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=te.getPointer(l);for(let d=1;d<c;d++)a.push(te.wrapPointer(h+o*d,te.PeGTlistExtendedGTs))}}return a}});const i=te._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!te.compare(l,te.NULL)){a=[l];const c=l.getNump();if(c>1){const h=te.getPointer(l);for(let d=1;d<c;d++)a.push(te.wrapPointer(h+i*d,te.PeHorizon))}}return o.set(n,a),a};e(te.PeProjcs.prototype,"horizonGcsGenerate",s),e(te.PeProjcs.prototype,"horizonPcsGenerate",s),te.PeObject.prototype.toString=function(n=Ts.PE_STR_OPTS_NONE){te.ensureCache.prepare();const o=te.getPointer(this),a=te.ensureInt8(new Array(Ts.PE_BUFFER_MAX));return te.UTF8ToString(te._pe_object_to_string_ext(o,n,a))}}function am(t){if(!t)return;const e=te.getClass(t);if(!e)return;const r=te.getCache(e);if(!r)return;const i=te.getPointer(t);i&&delete r[i]}function DP(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(te.ensureInt8(i));return r}function z1(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function L0(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=te.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=te.getValue(r,"double"),t[n][1]=te.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=te.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=te._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let h=null;const d=new te.PeInteger(c);try{const f=te.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(h=[f],c>1)){const m=te.getPointer(f);for(let y=1;y<c;y++)h.push(te.wrapPointer(m+e*y,te.PeGTlistExtendedEntry))}}finally{te.destroy(d)}return h}t.init=r,t.getGTlist=i})(iN||(iN={})),function(t){function e(r){if(r&&r.length){for(const i of r)am(i),i.getEntries().forEach(s=>{am(s);const n=s.getGeogtran();am(n),n.getParameters().forEach(am),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{am(o);const a=o.getDatum();am(a),am(a.getSpheroid()),am(o.getPrimem()),am(o.getUnit())})});te.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}($k||($k={})),function(t){function e(r,i,s,n,o){te.ensureCache.prepare();const a=z1(s),l=s===a,c=te.ensureFloat64(a);let h=0;n&&(h=te.ensureFloat64(n));const d=te._pe_geog_to_geog(te.getPointer(r),i,c,h,o);return d&&L0(s,i,c,l),d}t.geogToGeog=e}(Lk||(Lk={})),function(t){const e=(c,h,d,f,m,y)=>{let _,v;switch(te.ensureCache.prepare(),c){case"dd":_=te._pe_geog_to_dd,v=Ts.PE_DD_MAX;break;case"ddm":_=te._pe_geog_to_ddm,v=Ts.PE_DDM_MAX;break;case"dms":_=te._pe_geog_to_dms,v=Ts.PE_DMS_MAX}let w=0;h&&(w=te.getPointer(h));const T=z1(f),x=te.ensureFloat64(T),S=DP(d,v),O=_(w,d,x,m,te.ensureInt32(S));if(O)for(let C=0;C<d;C++)y[C]=te.UTF8ToString(S[C]);return O},r=(c,h,d,f,m)=>{let y;switch(te.ensureCache.prepare(),c){case"dd":y=te._pe_dd_to_geog;break;case"ddm":y=te._pe_ddm_to_geog;break;case"dms":y=te._pe_dms_to_geog}let _=0;h&&(_=te.getPointer(h));const v=f.map(S=>te.ensureString(S)),w=te.ensureInt32(v),T=te.ensureFloat64(new Array(2*d)),x=y(_,d,w,T);return x&&L0(m,d,T),x};function i(c,h,d,f,m){return e("dms",c,h,d,f,m)}function s(c,h,d,f){return r("dms",c,h,d,f)}function n(c,h,d,f,m){return e("ddm",c,h,d,f,m)}function o(c,h,d,f){return r("ddm",c,h,d,f)}function a(c,h,d,f,m){return e("dd",c,h,d,f,m)}function l(c,h,d,f){return r("dd",c,h,d,f)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(Dk||(Dk={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=te.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=te.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,h){te.ensureCache.prepare();let d=0;s&&(d=te.getPointer(s));const f=z1(o),m=te.ensureFloat64(f),y=DP(n,Ts.PE_MGRS_MAX),_=te.ensureInt32(y),v=te._pe_geog_to_mgrs_extended(d,n,m,a,l,c,_);if(v)for(let w=0;w<n;w++)h[w]=te.UTF8ToString(y[w]);return v}function i(s,n,o,a,l){te.ensureCache.prepare();let c=0;s&&(c=te.getPointer(s));const h=o.map(y=>te.ensureString(y)),d=te.ensureInt32(h),f=te.ensureFloat64(new Array(2*n)),m=te._pe_mgrs_to_geog_extended(c,n,d,a,f);return m&&L0(l,n,f),m}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(sN||(sN={})),function(t){function e(i,s,n,o,a,l,c){te.ensureCache.prepare();let h=0;i&&(h=te.getPointer(i));const d=z1(n),f=te.ensureFloat64(d),m=DP(s,Ts.PE_MGRS_MAX),y=te.ensureInt32(m),_=te._pe_geog_to_usng(h,s,f,o,a,l,y);if(_)for(let v=0;v<s;v++)c[v]=te.UTF8ToString(m[v]);return _}function r(i,s,n,o){te.ensureCache.prepare();let a=0;i&&(a=te.getPointer(i));const l=n.map(f=>te.ensureString(f)),c=te.ensureInt32(l),h=te.ensureFloat64(new Array(2*s)),d=te._pe_usng_to_geog(a,s,c,h);return d&&L0(o,s,h),d}t.geogToUsng=e,t.usngToGeog=r}(Nk||(Nk={})),function(t){function e(){t.PE_UTM_OPTS_NONE=te.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=te.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=te.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){te.ensureCache.prepare();let c=0;s&&(c=te.getPointer(s));const h=z1(o),d=te.ensureFloat64(h),f=DP(n,Ts.PE_UTM_MAX),m=te.ensureInt32(f),y=te._pe_geog_to_utm(c,n,d,a,m);if(y)for(let _=0;_<n;_++)l[_]=te.UTF8ToString(f[_]);return y}function i(s,n,o,a,l){te.ensureCache.prepare();let c=0;s&&(c=te.getPointer(s));const h=o.map(y=>te.ensureString(y)),d=te.ensureInt32(h),f=te.ensureFloat64(new Array(2*n)),m=te._pe_utm_to_geog(c,n,d,a,f);return m&&L0(l,n,f),m}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(nN||(nN={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=te.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=te.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=te.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=te.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=te.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}(oN||(oN={})),function(t){function e(){return te.PeVersion.prototype.version_string()}t.versionString=e}(Fk||(Fk={}));const m6e=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return Mk},get PeDefs(){return Ts},get PeFactory(){return Ik},get PeGCSExtent(){return Age},get PeGTTransformations(){return Lk},get PeGTlistExtended(){return iN},get PeGTlistExtendedEntry(){return $k},get PeNotationDms(){return Dk},get PeNotationMgrs(){return sN},get PeNotationUsng(){return Nk},get PeNotationUtm(){return nN},get PePCSInfo(){return oN},get PeVersion(){return Fk},_init:Oge,get _pe(){return te},isLoaded:Ege,isSupported:f6e,load:Cge},Symbol.toStringTag,{value:"Module"})),GSt=Math.PI/180,jSt=/SPHEROID\[([^\]]+)]/i,gy=sr.radius,Bh=sr.eccentricitySquared,g6e={a1:gy*Bh,a2:gy*Bh*gy*Bh,a3:gy*Bh*Bh/2,a4:gy*Bh*gy*Bh*2.5,a5:gy*Bh+gy*Bh*Bh/2,a6:1-Bh},HSt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:sr.radius,f:sr.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Mg.radius,f:Mg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Tf.radius,f:Tf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Tf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let NP=0,rU=class Uk{static fromGE(e){const r=new Uk;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=NP++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=NP++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=NP++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=NP++}getInverse(){const e=new Uk;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},aN=class r3{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new r3;let i="";for(const s of e.steps){const n=rU.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof rU?this.steps.push(r):this.steps.push(new rU({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new r3;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[r3.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[r3.cacheKey(e,r)];return s===void 0?null:s}};function Rge(t,e,r){if(e==null||r==null||r.vcsWkid||Tn(e,r))return null;const i=pO(e)/pO(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>y6e(s,i);case"polyline":case"esriGeometryPolyline":return s=>v6e(s,i);case"polygon":case"esriGeometryPolygon":return s=>_6e(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>b6e(s,i);case"extent":case"esriGeometryEnvelope":return s=>w6e(s,i);default:return null}}function y6e(t,e){t&&t.z!=null&&(t.z*=e)}function _6e(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function v6e(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function b6e(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function w6e(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Xd=null,T_=null,wA=null,J$={};const Pge=new e5;function N5(){return!!Xd&&Ege()}function TO(t){return wA==null&&(wA=Promise.all([Cge(),ae(()=>import("./geometryEngineBase-df7c28c6.js"),[]).then(e=>e.g),ae(()=>import("./hydrated-795c5e0d.js"),[])])),wA.then(([,e,{hydratedAdapter:r}])=>{Qt(t),T_=r,Xd=e.default,Xd._enableProjection(m6e),Pge.notify()})}function Sw(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:Vk(T_,t,t[0].spatialReference,e,r,i):Vk(T_,[t],t.spatialReference,e,r,i)[0]}function Vk(t,e,r,i,s=null,n=null){if(r==null||i==null)return e;if(Uf(r,i,s))return e.map(o=>TW(o,r,i));if(s==null){const o=aN.cacheKey(r,i);J$[o]!==void 0?s=J$[o]:((s=Ige(r,i,void 0))==null&&(s=new aN),J$[o]=s)}if(Xd==null||t==null)throw new F5;return n!=null?Xd._project(t,e,r,i,s,n):Xd._project(t,e,r,i,s)}function x6e(t,e){const r=Mge([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function Mge(t,e){if(!N5()){for(const r of t)if(r!=null&&!Tn(r.spatialReference,e)&&sa(r.spatialReference)&&sa(e)&&!Uf(r.spatialReference,e))return Xt(Pge),{pending:TO(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:Tn(r.spatialReference,e)?r:sa(r.spatialReference)&&sa(e)?$ge(r,e):null)}}function Ige(t,e,r=null){if(t==null||e==null)return null;if(Xd==null||T_==null)throw new F5;const i=Xd._getTransformation(T_,t,e,r,r==null?void 0:r.spatialReference);return i!==null?aN.fromGE(i):null}function T6e(t,e,r=null){if(Xd==null||T_==null)throw new F5;const i=Xd._getTransformationBySuitability(T_,t,e,r,r==null?void 0:r.spatialReference);if(i!==null){const s=[];for(const n of i)s.push(aN.fromGE(n));return s}return[]}class F5 extends U{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var q;function S6e(){Xd=null,T_=null,wA=null,J$={}}(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(q||(q={}));const E6e={get loadPromise(){return wA}};function $ge(t,e){try{const r=Sw(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=Rge(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof F5))throw r;return null}}function Uf(t,e,r){return!r&&(!!Tn(t,e)||sa(t)&&sa(e)&&!!AW(t,e,RW))}async function Lge(t,e,r,i){if(N5())return HJ(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!Uf(s,n,o))return TO(i)}else if(!Uf(t,e,r))return TO(i);return HJ(i)}function C6e(t,e){switch(AW(t,e,RW)){case Oi:return"copy3";case Y0:return"wgs84ToSphericalECEF";case Hb:return"wgs84ToWebMercator";case X0:return"wgs84ToPlateCarree";case Q0:return"wgs84ToWGS84ECEF";case vb:return"webMercatorToWGS84";case qge:return"webMercatorToSphericalECEF";case Wge:return"webMercatorToWGS84ECEF";case Zge:return"webMercatorToPlateCarree";case K0:return"wgs84ECEFToWGS84";case Qge:return"wgs84ECEFToSphericalECEF";case Kge:return"wgs84ECEFToWebMercator";case J0:return"sphericalECEFToWGS84";case Yge:return"sphericalECEFToWebMercator";case jk:return"sphericalMarsPCPFToMars2000";case Gk:return"sphericalMoonPCPFToMoon2000";case Jge:return"sphericalECEFToWGS84ECEF";case Bk:return"mars2000ToSphericalPCPF";case kk:return"moon2000ToSphericalPCPF";default:return null}}function TW(t,e,r){return t?"x"in t?Nge(t,e,new ct,r,0):"xmin"in t?kge(t,e,new _r,r,0):"rings"in t?zge(t,e,new Zd,r,0):"paths"in t?Uge(t,e,new p5,r,0):"points"in t?Fge(t,e,new yR,r,0):null:null}function Dge(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&Nge(t,t.spatialReference,e,r,i)!=null}function Nge(t,e,r,i,s){Ur[0]=t.x,Ur[1]=t.y;const n=t.z;return Ur[2]=n!==void 0?n:s,ai(Ur,e,0,Ur,i,0,1)?(r.x=Ur[0],r.y=Ur[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=Ur[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function A6e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Fge(t,t.spatialReference,e,r,i)!=null}function Fge(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const d of n)h.push(d[0],d[1],o?d[2]:s);if(!ai(h,e,0,h,i,0,c))return null;for(let d=0;d<c;++d){const f=3*d,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[d][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[d][2]]):l.push([m,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function O6e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Uge(t,t.spatialReference,e,r,i)!=null}function Uge(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return jge(n,o??!1,a??!1,e,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function R6e({hasZ:t,spatialReference:e,paths:r},i,s=0){const n=Vf(e,KS),o=hh[n][q.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(Ur,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const d=[0,0,s];o(a(h),0,d,0),c.push(d)}i.push(c)}return!0}function P6e({hasZ:t,spatialReference:e,rings:r},i,s=0){const n=Vf(e,KS),o=hh[n][q.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(Ur,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const d=[0,0,s];o(a(h),0,d,0),c.push(d)}i.push(c)}return!0}function Vge(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&zge(t,t.spatialReference,e,r,i)!=null}function zge(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return jge(n,o??!1,a??!1,e,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function M6e(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&kge(t,t.spatialReference,e,r,i)!=null}function kge(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return zk(n,o,c?t.zmin:s,e,Ur,i)?(r.xmin=Ur[0],r.ymin=Ur[1],c&&(r.zmin=Ur[2]),zk(a,l,c?t.zmax:s,e,Ur,i)?(r.xmax=Ur[0],r.ymax=Ur[1],c&&(r.zmax=Ur[2]),h&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function Ng(t,e,r){if(e==null||r==null)return null;const i=new ct({spatialReference:r});return ai(t,e,0,Ur,r,0,1)?(i.x=Ur[0],i.y=Ur[1],i.z=Ur[2],i):null}function SW(t,e,r){return ai(t,e,0,Ur,r.spatialReference,0,1)?(r.x=Ur[0],r.y=Ur[1],r.z=Ur[2],r):null}function vo(t,e,r,i=0){Ur[0]=t.x,Ur[1]=t.y;const s=t.z;return Ur[2]=s!==void 0?s:i,ai(Ur,t.spatialReference,0,e,r,0,1)}function zk(t,e,r,i,s,n){return is[0]=t,is[1]=e,is[2]=r,ai(is,i,0,s,n,0,1)}function js(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(is[0]=t[0],is[1]=t[1],is[2]=0,t=is),ai(t,e,0,r,i,0,1))}function Bge(t,e){Ur[0]=t.x,Ur[1]=t.y;const r=t.z;return Ur[2]=r!==void 0?r:0,Gge(Ur,t.spatialReference,e)}function Gge(t,e,r){return I6e(t,e,r)}function I6e(t,e,r){if(e==null)return!1;const i=Vf(e,KS),s=hh[i][q.WGS84_COMPARABLE_LON_LAT];return s!=null&&(s(t,0,is,0),r!==is&&(r[0]=is[0],r[1]=is[1],r.length>2&&(r[2]=is[2])),!0)}function ai(t,e,r,i,s,n,o=1){const a=AW(e,s,RW);if(a==null)return!1;if(a===Oi){if(t===i&&r===n)return!0;const c=r+3*o;for(let h=r,d=n;h<c;h++,d++)i[d]=t[h];return!0}const l=r+3*o;for(let c=r,h=n;c<l;c+=3,h+=3)a(t,c,i,h);return!0}function $6e(t,e,r,i,s){re(Ur,t),le(FP,t,e),js(Ur,r,Ur,s),js(FP,r,FP,s),he(i,FP,Ur),ge(i,i)}function jge(t,e,r,i,s,n,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!ai(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const h=new Array;for(const d of c)e&&r?h.push([a[l++],a[l++],a[l++],d[3]]):e?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],d[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function L6e(t,e,r,i){if(e==null||i==null)return!1;const s=eye(e,i,B6e);if(s.projector===Oi)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(s.projector==null)return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===q.WEB_MERCATOR){const a=hh[n.spatialReferenceId][q.WGS84];return a!=null&&(a(t,0,Td,0),Hb(Td,0,r,0),r[3]=NK(Td[1],t[2],t[3],sr.radius),!0)}if(n.spatialReferenceId!==q.WGS84&&n.spatialReferenceId!==q.CGCS2000||o.spatialReferenceId!==q.PLATE_CARREE){s.projector(t,0,r,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=hh[n.spatialReferenceId][q.SPHERICAL_ECEF],l=hh[q.SPHERICAL_ECEF][q.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=NK(t[1],t[2],t[3],sr.radius)),s.projector(t,0,r,0),r[3]=c}return!0}function NK(t,e,r,i){const s=i+e;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(zd*t)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function AR(t,e,r,i){return t!=null&&(Tn(e,i)?(Ig(r,t),!0):(is[0]=t[0],is[1]=t[1],is[2]=0,!!ai(is,e,0,is,i,0,1)&&(r[0]=is[0],r[1]=is[1],is[0]=t[2],is[1]=t[3],is[2]=0,!!ai(is,e,0,is,i,0,1)&&(r[2]=is[0],r[3]=is[1],!0))))}function D6e(t,e,r,i){if(e==null||i==null)return!1;const s=Vf(e,KS),n=Vf(i,tye);if(s===n&&s!==q.UNKNOWN||Tn(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===q.SPHERICAL_ECEF){const o=Ee(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/sr.radius;if(n===q.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===q.WGS84||n===q.CGCS2000){const c=xA;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===q.PLATE_CARREE){if(n===q.WGS84||n===q.CGCS2000)return r[0]=xA,r[1]=xA,r[2]=1,!0;if(n===q.WEB_MERCATOR){const o=t[1]/sr.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function xl(t,e,r,i){if(t==null||i==null)return!1;const s=Vf(t,KS),n=Vf(i,tye);if(s===n&&!FK(n)&&(s!==q.UNKNOWN||Tn(t,i)))return CR(r,e),!0;if(FK(n)){const o=hh[s][q.LON_LAT],a=hh[q.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Td,0),a(Td,0,yy,0),EW(zd*Td[0],zd*Td[1],r),r[12]=yy[0],r[13]=yy[1],r[14]=yy[2],!0)}if((n===q.WEB_MERCATOR||n===q.PLATE_CARREE)&&(s===q.WGS84||s===q.CGCS2000&&n===q.PLATE_CARREE||s===q.SPHERICAL_ECEF||s===q.WEB_MERCATOR)){const o=hh[s][q.LON_LAT],a=hh[q.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,Td,0),a(Td,0,yy,0),s===q.SPHERICAL_ECEF?Hge(zd*Td[0],zd*Td[1],r):Th(r),r[12]=yy[0],r[13]=yy[1],r[14]=yy[2],!0)}return!1}function FK(t){return t===q.SPHERICAL_ECEF||t===q.SPHERICAL_MARS_PCPF||t===q.SPHERICAL_MOON_PCPF}function EW(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Hge(t,e,r){return EW(t,e,r),bc(r,r),r}function Vf(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Za(t,1)),t.wkt===Pde.wkt?e.spatialReferenceId=q.SPHERICAL_ECEF:uO(t)?e.spatialReferenceId=q.WGS84:Nb(t)?e.spatialReferenceId=q.WEB_MERCATOR:hO(t)?e.spatialReferenceId=q.PLATE_CARREE:t.wkt===Mde.wkt?e.spatialReferenceId=q.WGS84_ECEF:t.wkid===oh.CGCS2000?e.spatialReferenceId=q.CGCS2000:t.wkt===fq.wkt?e.spatialReferenceId=q.SPHERICAL_MARS_PCPF:t.wkt===mq.wkt?e.spatialReferenceId=q.SPHERICAL_MOON_PCPF:Yf(t)?e.spatialReferenceId=q.GCSMARS2000:Jf(t)?e.spatialReferenceId=q.GCSMOON2000:e.spatialReferenceId=q.UNKNOWN):q.UNKNOWN}function Oi(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function vb(t,e,r,i){r[i++]=rS*(t[e++]/sr.radius),r[i++]=rS*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/sr.radius))),r[i]=t[e]}function qge(t,e,r,i){vb(t,e,r,i),Y0(r,i,r,i)}function Wge(t,e,r,i){vb(t,e,r,i),Q0(r,i,r,i)}function U5(t,e,r,i,s){const n=.4999999*Math.PI,o=_e(zd*t[e+1],-n,n),a=Math.sin(o);r[i++]=zd*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function Hb(t,e,r,i){U5(t,e,r,i,sr)}const UK=sr.radius*Math.PI/180,xA=180/(sr.radius*Math.PI);function X0(t,e,r,i){r[i]=t[e]*UK,r[i+1]=t[e+1]*UK,r[i+2]=t[e+2]}function ib(t,e,r,i){r[i]=t[e]*xA,r[i+1]=t[e+1]*xA,r[i+2]=t[e+2]}function Zge(t,e,r,i){vb(t,e,r,i),X0(r,i,r,i)}function N6e(t,e,r,i){K0(t,e,r,i),X0(r,i,r,i)}function F6e(t,e,r,i){J0(t,e,r,i),X0(r,i,r,i)}function U6e(t,e,r,i){ib(t,e,r,i),Y0(r,i,r,i)}function V6e(t,e,r,i){ib(t,e,r,i),Hb(r,i,r,i)}function z6e(t,e,r,i){ib(t,e,r,i),Q0(r,i,r,i)}function S_(t){if(t==null)return!1;const e=Vf(t,KS);return!!hh[e][q.WGS84_COMPARABLE_LON_LAT]}function Xge(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}function CW(t,e,r,i,s){const n=s+t[e+2],o=zd*t[e+1],a=zd*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function kk(t,e,r,i){CW(t,e,r,i,Mg.radius)}function Bk(t,e,r,i){CW(t,e,r,i,Tf.radius)}function Y0(t,e,r,i){CW(t,e,r,i,sr.radius)}function V5(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=_h(a/(l===0?1:l)),h=Math.atan2(o,n);r[i++]=rS*h,r[i++]=rS*c,r[i]=l-s}function Gk(t,e,r,i){V5(t,e,r,i,Mg.radius)}function jk(t,e,r,i){V5(t,e,r,i,Tf.radius)}function J0(t,e,r,i){V5(t,e,r,i,sr.radius)}function Yge(t,e,r,i){J0(t,e,r,i),Hb(r,i,r,i)}function Jge(t,e,r,i){J0(t,e,r,i),Q0(r,i,r,i)}function k6e(t,e,r,i,s){const n=zd*t[e],o=zd*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(n),r[i++]=(h+a)*c*Math.sin(n),r[i++]=(h*(1-s.eccentricitySquared)+a)*l}function Q0(t,e,r,i){k6e(t,e,r,i,sr)}function K0(t,e,r,i){const s=g6e,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,d,f,m,y,_,v,w,T,x,S,O,C,P,$,V,z,B,k;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),d=c+a*a,f=Math.sqrt(d),B=Math.atan2(o,n),m=a*a/d,y=c/d,O=s.a2/f,C=s.a3-s.a4/f,y>.3?(_=l/f*(1+y*(s.a1+O+m*C)/f),z=Math.asin(_),w=_*_,v=Math.sqrt(1-w)):(v=h/f*(1-m*(s.a5-O-y*C)/f),z=Math.acos(v),w=1-v*v,_=Math.sqrt(w)),T=1-sr.eccentricitySquared*w,x=sr.radius/Math.sqrt(T),S=s.a6*x,O=h-x*v,C=l-S*_,$=v*O+_*C,P=v*C-_*O,V=P/(S/T+$),z+=V,k=$+P*V/2,a<0&&(z=-z),r[i++]=rS*B,r[i++]=rS*z,r[i]=k}function Qge(t,e,r,i){K0(t,e,r,i),Y0(r,i,r,i)}function Kge(t,e,r,i){K0(t,e,r,i),Hb(r,i,r,i)}const hh={[q.WGS84]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Oi,[q.WGS84_COMPARABLE_LON_LAT]:Oi,[q.SPHERICAL_ECEF]:Y0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Hb,[q.PLATE_CARREE]:X0,[q.WGS84]:Oi,[q.WGS84_ECEF]:Q0},[q.CGCS2000]:{[q.CGCS2000]:Oi,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Oi,[q.WGS84_COMPARABLE_LON_LAT]:Oi,[q.SPHERICAL_ECEF]:Y0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:X0,[q.WGS84]:null,[q.WGS84_ECEF]:Q0},[q.GCSMARS2000]:{[q.CGCS2000]:null,[q.GCSMARS2000]:Oi,[q.GCSMOON2000]:null,[q.LON_LAT]:Oi,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:Bk,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.GCSMOON2000]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:Oi,[q.LON_LAT]:Oi,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:kk,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.WEB_MERCATOR]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:vb,[q.WGS84_COMPARABLE_LON_LAT]:vb,[q.SPHERICAL_ECEF]:qge,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Oi,[q.PLATE_CARREE]:Zge,[q.WGS84]:vb,[q.WGS84_ECEF]:Wge},[q.WGS84_ECEF]:{[q.CGCS2000]:K0,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:K0,[q.WGS84_COMPARABLE_LON_LAT]:K0,[q.SPHERICAL_ECEF]:Qge,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Kge,[q.PLATE_CARREE]:N6e,[q.WGS84]:K0,[q.WGS84_ECEF]:Oi},[q.SPHERICAL_ECEF]:{[q.CGCS2000]:J0,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:J0,[q.WGS84_COMPARABLE_LON_LAT]:J0,[q.SPHERICAL_ECEF]:Oi,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Yge,[q.PLATE_CARREE]:F6e,[q.WGS84]:J0,[q.WGS84_ECEF]:Jge},[q.SPHERICAL_MARS_PCPF]:{[q.CGCS2000]:null,[q.GCSMARS2000]:jk,[q.GCSMOON2000]:null,[q.LON_LAT]:jk,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:Oi,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.SPHERICAL_MOON_PCPF]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:Gk,[q.LON_LAT]:Gk,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:Oi,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.UNKNOWN]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:null,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:Oi,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.LON_LAT]:{[q.CGCS2000]:Oi,[q.GCSMARS2000]:Oi,[q.GCSMOON2000]:Oi,[q.LON_LAT]:Oi,[q.WGS84_COMPARABLE_LON_LAT]:Oi,[q.SPHERICAL_ECEF]:Y0,[q.SPHERICAL_MARS_PCPF]:Bk,[q.SPHERICAL_MOON_PCPF]:kk,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Hb,[q.PLATE_CARREE]:X0,[q.WGS84]:Oi,[q.WGS84_ECEF]:Q0},[q.WGS84_COMPARABLE_LON_LAT]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Oi,[q.WGS84_COMPARABLE_LON_LAT]:Oi,[q.SPHERICAL_ECEF]:Y0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:X0,[q.WGS84]:Oi,[q.WGS84_ECEF]:Q0},[q.PLATE_CARREE]:{[q.CGCS2000]:ib,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:ib,[q.WGS84_COMPARABLE_LON_LAT]:ib,[q.SPHERICAL_ECEF]:U6e,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:V6e,[q.PLATE_CARREE]:Oi,[q.WGS84]:ib,[q.WGS84_ECEF]:z6e}};function AW(t,e,r=OW()){return t==null||e==null?null:eye(t,e,r).projector}function eye(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=Vf(t,r.source),s=Vf(e,r.dest);return i===q.UNKNOWN&&s===q.UNKNOWN?Tn(t,e)?r.projector=Oi:r.projector=null:r.projector=hh[i][s],r}function OW(){return{source:{spatialReference:null,spatialReferenceId:q.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:q.UNKNOWN,metersPerUnit:1},projector:Oi}}const KS={spatialReference:null,spatialReferenceId:q.UNKNOWN},tye={spatialReference:null,spatialReferenceId:q.UNKNOWN},RW=OW(),B6e=OW(),zd=Ut(1),rS=qa(1),is=A(),Td=A(),yy=A(),Ur=A(),FP=A(),qSt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:S_,canProjectWithoutEngine:Uf,computeENUToSphericalPCPFLocalRotation:EW,computeSphericalPCPFToENULocalRotation:Hge,computeTranslationToOriginAndRotation:xl,getProjectorName:C6e,getTransformation:Ige,getTransformations:T6e,initializeProjection:Lge,isLoaded:N5,load:TO,localLinearScaleFactors:D6e,lonLatToSphericalPCPF:Xge,lonLatToWebMercatorComparable:U5,project:Sw,projectBoundingRect:AR,projectBoundingSphere:L6e,projectBuffer:ai,projectDirection:$6e,projectExtent:M6e,projectMany:Vk,projectMultipoint:A6e,projectOrLoad:x6e,projectOrLoadMany:Mge,projectPoint:Dge,projectPointToVector:vo,projectPointToWGS84ComparableLonLat:Bge,projectPolygon:Vge,projectPolygonToWGS84ComparableLonLat:P6e,projectPolyline:O6e,projectPolylineToWGS84ComparableLonLat:R6e,projectVectorToDehydratedPoint:SW,projectVectorToPoint:Ng,projectVectorToVector:js,projectVectorToWGS84ComparableLonLat:Gge,projectWithoutEngine:TW,projectXYZToVector:zk,sphericalPCPFtoLonLatElevation:V5,test:E6e,tryProjectWithZConversion:$ge,unload:S6e},Symbol.toStringTag,{value:"Module"}));let Hg=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&z2(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*VK);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,VK));e++)this._items.push(this._allocator())}};const VK=1024;function ve(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function iS(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function PW(t,e,r,i,s,n,o,a,l,c,h,d,f,m,y,_){return[t,e,r,i,s,n,o,a,l,c,h,d,f,m,y,_]}function rye(t,e){return new Float64Array(t,e,16)}const nn=ve();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:nn,clone:iS,create:ve,createView:rye,fromValues:PW},Symbol.toStringTag,{value:"Module"}));var hc;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(hc||(hc={}));var lN;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(lN||(lN={}));function Fi(){return[1,0,0,0,1,0,0,0,1]}function iye(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function G6e(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function sye(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:iye,create:Fi,createView:sye,fromValues:G6e},Symbol.toStringTag,{value:"Module"}));function Mh(){return[0,0,0,1]}function j6e(t){return[t[0],t[1],t[2],t[3]]}function H6e(t,e,r,i){return[t,e,r,i]}function nye(t,e){return new Float64Array(t,e,4)}const q6e=Mh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:q6e,clone:j6e,create:Mh,createView:nye,fromValues:H6e},Symbol.toStringTag,{value:"Module"}));function Ue(){return[0,0]}function i3(t){return[t[0],t[1]]}function ur(t,e){return[t,e]}function oye(t){const e=Ue(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function aye(t,e){return new Float64Array(t,e,2)}function lye(){return Ue()}function cye(){return ur(1,1)}function uye(){return ur(1,0)}function hye(){return ur(0,1)}const np=lye(),W6e=cye(),dye=uye(),Z6e=hye();Object.freeze(Object.defineProperty({__proto__:null,ONES:W6e,UNIT_X:dye,UNIT_Y:Z6e,ZEROS:np,clone:i3,create:Ue,createView:aye,fromArray:oye,fromValues:ur,ones:cye,unitX:uye,unitY:hye,zeros:lye},Symbol.toStringTag,{value:"Module"}));function Yt(){return[0,0,0,0]}function OR(t){return[t[0],t[1],t[2],t[3]]}function Ft(t,e,r,i){return[t,e,r,i]}function MW(t){const e=Yt(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function pye(t,e){return new Float64Array(t,e,4)}function fye(){return Yt()}function mye(){return Ft(1,1,1,1)}function gye(){return Ft(1,0,0,0)}function yye(){return Ft(0,1,0,0)}function _ye(){return Ft(0,0,1,0)}function vye(){return Ft(0,0,0,1)}const Cf=fye(),ah=mye(),X6e=gye(),Y6e=yye(),J6e=_ye(),Q6e=vye();Object.freeze(Object.defineProperty({__proto__:null,ONES:ah,UNIT_W:Q6e,UNIT_X:X6e,UNIT_Y:Y6e,UNIT_Z:J6e,ZEROS:Cf,clone:OR,create:Yt,createView:pye,fromArray:MW,fromValues:Ft,ones:mye,unitW:vye,unitX:gye,unitY:yye,unitZ:_ye,zeros:fye},Symbol.toStringTag,{value:"Module"}));let eE=class t1{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&z2(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Uw){return new t1(16,aye,e)}static createVec3f64(e=Uw){return new t1(24,Sq,e)}static createVec4f64(e=Uw){return new t1(32,pye,e)}static createMat3f64(e=Uw){return new t1(72,sye,e)}static createMat4f64(e=Uw){return new t1(128,rye,e)}static createQuatf64(e=Uw){return new t1(32,nye,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Uw=4*lN.KILOBYTES,ZSt=eE.createVec2f64(),Ne=eE.createVec3f64(),IW=eE.createVec4f64();eE.createMat3f64();const $W=eE.createMat4f64(),XSt=eE.createQuatf64();function cp(t){return t?{origin:Is(t.origin),vector:Is(t.vector)}:{origin:A(),vector:A()}}function K6e(t,e){const r=tUe.get();return r.origin=t,r.vector=e,r}function YSt(t,e=cp()){return eUe(t.origin,t.vector,e)}function eUe(t,e,r=cp()){return re(r.origin,t),re(r.vector,e),r}function bb(t,e,r=cp()){return re(r.origin,t),he(r.vector,e,t),r}function LW(t,e){const r=he(Ne.get(),e,t.origin),i=me(t.vector,r),s=me(t.vector,t.vector),n=_e(i/s,0,1),o=he(Ne.get(),ie(Ne.get(),t.vector,n),r);return me(o,o)}function JSt(t,e,r){return Hk(t,e,0,1,r)}function QSt(t,e,r){return le(r,t.origin,ie(r,t.vector,e))}function Hk(t,e,r,i,s){const{vector:n,origin:o}=t,a=he(Ne.get(),e,o),l=me(n,a)/ra(n);return ie(s,n,_e(l,r,i)),le(s,s,t.origin)}function KSt(t,e){if(wye(t,K6e(e.origin,e.direction),!1,cN)){const{tA:r,pB:i,distance2:s}=cN;if(r>=0&&r<=1)return s;if(r<0)return fo(t.origin,i);if(r>1)return fo(le(Ne.get(),t.origin,t.vector),i)}return null}function bye(t,e,r){return!!wye(t,e,!0,cN)&&(re(r,cN.pA),!0)}function wye(t,e,r,i){const n=t.origin,o=le(Ne.get(),n,t.vector),a=e.origin,l=le(Ne.get(),a,e.vector),c=Ne.get(),h=Ne.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const d=Ne.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*d[0]+h[1]*d[1]+h[2]*d[2],y=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*_-m*m;if(Math.abs(v)<1e-6)return!1;let w=(f*m-y*_)/v,T=(f+m*w)/_;r&&(w=_e(w,0,1),T=_e(T,0,1));const x=Ne.get(),S=Ne.get();return x[0]=n[0]+w*d[0],x[1]=n[1]+w*d[1],x[2]=n[2]+w*d[2],S[0]=a[0]+T*h[0],S[1]=a[1]+T*h[1],S[2]=a[2]+T*h[2],i.tA=w,i.tB=T,i.pA=x,i.pB=S,i.distance2=fo(x,S),!0}const cN={tA:0,tB:0,pA:A(),pB:A(),distance2:0},tUe=new Hg(()=>cp());function Gn(t){return t?zK(Is(t.origin),Is(t.direction)):zK(A(),A())}function zK(t,e){return{origin:t,direction:e}}function eEt(t,e){return Og(t.origin,e.origin)&&Og(t.direction,e.direction)}function pu(t,e){const r=nUe.get();return r.origin=t,r.direction=e,r}function uN(t,e=Gn()){return xye(t.origin,t.direction,e)}function rUe(t,e,r=Gn()){return re(r.origin,t),he(r.direction,e,t),r}function xye(t,e,r=Gn()){return re(r.origin,t),re(r.direction,e),r}function iUe(t,e){const r=ot(Ne.get(),ge(Ne.get(),t.direction),he(Ne.get(),e,t.origin));return me(r,r)}function sUe(t,e,r){const i=me(t.direction,he(r,e,t.origin));return le(r,t.origin,ie(r,t.direction,i)),r}const nUe=new Hg(()=>Gn());function TA(t,e){return me(t,e)/Ee(t)}function z5(t,e){const r=me(t,e)/(Ee(t)*Ee(e));return-Sn(r)}function Tye(t,e,r){ge(UP,t),ge(iU,e);const i=me(UP,iU),s=Sn(i),n=ot(UP,UP,iU);return me(n,r)<0?2*Math.PI-s:s}const UP=A(),iU=A(),Sye=_s();function _s(){return Yt()}function sS(t,e=_s()){return ch(e,t)}function Eye(t,e){return Ft(t[0],t[1],t[2],e)}function oUe(t){return t}function aUe(t){t[0]=t[1]=t[2]=t[3]=0}function k5(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function mg(t){return t[3]}function lUe(t){return t}function Cye(t,e,r,i){return Ft(t,e,r,i)}function cUe(t,e,r){return t!==r&&re(r,t),r[3]=t[3]+e,r}function uUe(t,e,r){return Q.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:sS(t,r)}function B_(t,e,r){if(e==null)return!1;const{origin:i,direction:s}=e,n=hUe;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const d=(-a+c)/(2*o);return(h<0||d<h&&d>0)&&(h=d),!(h<0)&&(r&&(r[0]=i[0]+s[0]*h,r[1]=i[1]+s[1]*h,r[2]=i[2]+s[2]*h),!0)}const hUe=A();function qk(t,e){return B_(t,e,null)}function dUe(t,e,r){if(B_(t,e,r))return r;const i=tE(t,e,Ne.get());return le(r,e.origin,ie(Ne.get(),e.direction,mi(e.origin,i)/Ee(e.direction))),r}function tE(t,e,r){const i=Ne.get(),s=$W.get();ot(i,e.origin,e.direction);const n=mg(t);ot(r,i,e.origin),ie(r,r,1/Ee(r)*n);const o=Rye(t,e.origin),a=z5(e.origin,r);return du(s,a+o,i),$e(r,r,s),r}function pUe(t,e,r){return B_(t,e,r)?r:(sUe(e,t,r),Aye(t,r,r))}function Aye(t,e,r){const i=he(Ne.get(),e,t),s=ie(Ne.get(),i,t[3]/Ee(i));return le(r,s,t)}function Oye(t,e){const r=he(Ne.get(),e,t),i=ra(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function Rye(t,e){const r=he(Ne.get(),e,t),i=Ee(r),s=mg(t),n=s+Math.abs(s-i);return Sn(s/n)}const sU=A();function Pye(t,e,r,i){const s=he(sU,e,t);switch(r){case hc.X:{const n=IQ(s,sU)[2];return se(i,-Math.sin(n),Math.cos(n),0)}case hc.Y:{const n=IQ(s,sU),o=n[1],a=n[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case hc.Z:return ge(i,s);default:return}}function Mye(t,e){const r=he(Wk,e,t);return Ee(r)-t[3]}function fUe(t,e,r,i){const s=Mye(t,e),n=Pye(t,e,hc.Z,Wk),o=ie(Wk,n,r-s);return le(i,e,o)}function mUe(t,e){const r=fo(t,e),i=mg(t);return r<=i*i}function gUe(t,e,r=_s()){const i=mi(t,e),s=t[3],n=e[3];return i+n<s?(ch(r,t),r):i+s<n?(ch(r,e),r):(Gr(r,t,e,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const Wk=A(),B5=_s(),yUe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Sye,altitudeAt:Mye,angleToSilhouette:Rye,axisAt:Pye,clear:aUe,closestPoint:pUe,closestPointOnSilhouette:tE,containsPoint:mUe,copy:sS,create:_s,distanceToSilhouette:Oye,elevate:cUe,fromCenterAndRadius:Eye,fromRadius:k5,fromValues:Cye,getCenter:lUe,getRadius:mg,intersectRay:B_,intersectRayClosestSilhouette:dUe,intersectsRay:qk,projectPoint:Aye,setAltitudeAt:fUe,setExtent:uUe,tmpSphere:B5,union:gUe,wrap:oUe},Symbol.toStringTag,{value:"Module"}));function nS(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function _Ue(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,r,i,s),t}function tEt(t,e,r){r=r||t;const i=me(t,e);se(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),ge(r,r)}function rEt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),ot(r,t,e),ge(e,e),ot(e,r,t),ge(r,r)}function VP(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function vUe(t,e,r,i=A()){const s=Ee(t),n=Ee(e),o=me(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),h=l/n*Math.sin(r*a);return ie(sb,t,c),ie(nb,e,h),le(i,sb,nb)}return Gr(i,t,e,r)}function iEt(t,e,r,i=A(),s=A()){const n=Ee(t),o=Ee(e),a=me(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),d=Math.sin((1-r)*l),f=(1-r)*n+r*o;{const m=f/c,y=m/o*h;ie(sb,t,m/n*d),ie(nb,e,y),le(i,sb,nb)}{const m=1/n*(-Math.cos((1-r)*l)*l*f+d*(-n+o));ie(sb,t,m);const y=1/o*(Math.cos(r*l)*l*f+h*(-n+o));ie(nb,e,y),le(s,sb,nb),ie(s,s,1/c)}return s}return Gr(i,t,e,r),he(s,e,t),ge(s,s),s}function Q$(t,e,r){t=ge(sb,t),e=ge(nb,e);const i=Sn(me(t,e));if(r){const s=ot(bUe,t,e);if(me(s,r)<0)return-i}return i}function K$(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function sEt(t,e,r,i){he(kK,e,t),he(BK,r,t),ot(i,kK,BK),ge(i,i),i[3]=-me(t,i)}const kK=A(),BK=A(),bUe=A(),sb=A(),nb=A();function Ir(t=s3){return[t[0],t[1],t[2],t[3]]}function wUe(t=s3[0],e=s3[1],r=s3[2],i=s3[3]){return DW(t,e,r,i,IW.get())}function G5(t,e){return DW(e[0],e[1],e[2],e[3],t)}function DW(t,e,r,i,s=Ir()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Iye(t,e,r){return re(r,t),r[3]=e,r}function RR(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function ea(t,e,r,i=Ir()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,d=o*a-s*c,f=s*l-n*a,m=h*h+d*d+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=h*y,i[1]=d*y,i[2]=f*y,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function $ye(t,e,r,i,s){const n=t.length/3;if(n<3)return!1;se(ME,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;se(Vw,t[l],t[l+1],t[l+2]),o++,a=!na(ME,Vw)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;se(k1,t[l],t[l+1],t[l+2]),o++,he(zP,ME,Vw),ge(zP,zP),he(kP,Vw,k1),ge(kP,kP),a=!na(ME,k1)&&!na(Vw,k1)&&Math.abs(me(zP,kP))<xUe}return a?(ea(ME,Vw,k1,e),!0):(r!==0||i!==1||s!==2)&&$ye(t,e,0,1,2)}const xUe=.99619469809,ME=A(),Vw=A(),k1=A(),zP=A(),kP=A();function Zk(t,e,r){return e!==t&&G5(t,e),t[3]=-me(t,r),t}function Xk(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function SO(t,e,r,i){return ot(k1,e,t),RR(r,k1,i)}function nEt(t,e,r,i){return j5(t,e,he(Ne.get(),r,e),OUe,i)}function Ew(t,e,r){return e!=null&&j5(t,e.origin,e.direction,RUe,r)}function TUe(t,e,r){return j5(t,e.origin,e.vector,Af.NONE,r)}function SUe(t,e,r){return j5(t,e.origin,e.vector,Af.CLAMP,r)}function Lye(t,e){return fi(t,e)>=0}function EUe(t,e){const r=me(t,e.ray.direction),i=-fi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function CUe(t,e){const r=me(t,e.ray.direction),i=-fi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function AUe(t,e,r){const i=ie(Ne.get(),t,-t[3]),s=Yk(t,he(Ne.get(),e,i),Ne.get());return le(r,s,i),r}function Yk(t,e,r){const i=ie(Ne.get(),t,me(t,e));return he(r,e,i),r}function fi(t,e){return me(t,e)+t[3]}function j5(t,e,r,i,s){const n=me(t,r);if(n===0)return!1;let o=-(me(t,e)+t[3])/n;return i&Af.CLAMP&&(o=_e(o,0,1)),!(!(i&Af.INFINITE_MIN)&&o<0||!(i&Af.INFINITE_MAX)&&o>1)&&(le(s,e,ie(s,r,o)),!0)}function oEt(t){return t}const s3=[0,0,1,0];var Af;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Af||(Af={}));const OUe=Af.INFINITE_MIN|Af.INFINITE_MAX,RUe=Af.INFINITE_MAX,nU=Q.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let PUe=class{constructor(){this.plane=Ir(),this.origin=A(),this.basis1=A(),this.basis2=A()}};const Dye=PUe;function qg(t=qye){return{plane:Ir(t.plane),origin:Is(t.origin),basis1:Is(t.basis1),basis2:Is(t.basis2)}}function MUe(t,e,r){const i=GUe.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=wUe(0,0,0,0),H5(i),i}function Cw(t,e=qg()){return NW(t.origin,t.basis1,t.basis2,e)}function IUe(t,e){re(e.origin,t.origin),re(e.basis1,t.basis1),re(e.basis2,t.basis2),G5(e.plane,t.plane)}function NW(t,e,r,i=qg()){return re(i.origin,t),re(i.basis1,e),re(i.basis2,r),H5(i),kUe(i,"fromValues()"),i}function H5(t){SO(t.basis2,t.basis1,t.origin,t.plane)}function Nye(t,e,r){t!==r&&Cw(t,r);const i=ie(Ne.get(),Fg(t),e);return le(r.origin,r.origin,i),r.plane[3]-=e,r}function $Ue(t,e,r){return Fye(e,r),Nye(r,zW(t,t.origin),r),r}function Fye(t,e=qg()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return se(e.origin,t[0]+r,t[1]+i,0),se(e.basis1,r,0,0),se(e.basis2,0,i,0),DW(0,0,1,0,e.plane),e}function FW(t,e,r){return!!Ew(t.plane,e,r)&&jye(t,r)}function LUe(t,e,r){if(FW(t,e,r))return r;const i=Uye(t,e,Ne.get());return le(r,e.origin,ie(Ne.get(),e.direction,mi(e.origin,i)/Ee(e.direction))),r}function Uye(t,e,r){const i=hN.get();Hye(t,e,i,hN.get());let s=Number.POSITIVE_INFINITY;for(const n of BW){const o=kW(t,n,q5.get()),a=Ne.get();if(TUe(i,o,a)){const l=Gg(Ne.get(),e.origin,a),c=Math.abs(Sn(me(e.direction,l)));c<s&&(s=c,re(r,a))}}return s===Number.POSITIVE_INFINITY?Vye(t,e,r):r}function Vye(t,e,r){if(FW(t,e,r))return r;const i=hN.get(),s=hN.get();Hye(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of BW){const a=kW(t,o,q5.get()),l=Ne.get();if(SUe(i,a,l)){const c=iUe(e,l);if(!Lye(s,l))continue;c<n&&(n=c,re(r,l))}}return UW(t,e.origin)<n&&zye(t,e.origin,r),r}function zye(t,e,r){const i=AUe(t.plane,e,Ne.get()),s=Hk(GK(t,t.basis1),i,-1,1,Ne.get()),n=Hk(GK(t,t.basis2),i,-1,1,Ne.get());return he(r,le(Ne.get(),s,n),t.origin),r}function kye(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=he(Ne.get(),e,i),a=TA(s,o),l=TA(n,o),c=TA(Fg(t),o);return se(r,a,l,c)}function UW(t,e){const r=kye(t,e,Ne.get()),{basis1:i,basis2:s}=t,n=Ee(i),o=Ee(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function DUe(t,e){return Math.sqrt(UW(t,e))}function NUe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of BW){const s=kW(t,i,q5.get()),n=LW(s,e);n>r&&(r=n)}return Math.sqrt(r)}function VW(t,e){return Lye(t.plane,e)&&jye(t,e)}function FUe(t,e,r,i){return zUe(t,r,i)}function zW(t,e){const r=-t.plane[3];return TA(Fg(t),e)-r}function UUe(t,e,r,i){const s=zW(t,e),n=ie(BUe,Fg(t),r-s);return le(i,e,n),i}function Bye(t,e){return na(t.basis1,e.basis1)&&na(t.basis2,e.basis2)&&na(t.origin,e.origin)}function Gye(t,e,r){return t!==r&&Cw(t,r),xn(zw,e),bc(zw,zw),$e(r.basis1,t.basis1,zw),$e(r.basis2,t.basis2,zw),$e(r.plane,t.plane,zw),$e(r.origin,t.origin,e),Zk(r.plane,r.plane,r.origin),r}function VUe(t,e,r,i){return t!==i&&Cw(t,i),du(oU,e,r),$e(i.basis1,t.basis1,oU),$e(i.basis2,t.basis2,oU),H5(i),i}function Fg(t){return t.plane}function zUe(t,e,r){switch(e){case hc.X:re(r,t.basis1),ge(r,r);break;case hc.Y:re(r,t.basis2),ge(r,r);break;case hc.Z:re(r,Fg(t))}return r}function jye(t,e){const r=he(Ne.get(),e,t.origin),i=ra(t.basis1),s=ra(t.basis2),n=me(t.basis1,r),o=me(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function GK(t,e){const r=q5.get();return re(r.origin,t.origin),re(r.vector,e),r}function kW(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=ie(Ne.get(),i,e.origin[0]),a=ie(Ne.get(),s,e.origin[1]);le(r.origin,o,a),le(r.origin,r.origin,n);const l=ie(Ne.get(),i,e.direction[0]),c=ie(Ne.get(),s,e.direction[1]);return ie(r.vector,le(l,l,c),2),r}function kUe(t,e){Math.abs(me(t.basis1,t.basis2)/(Ee(t.basis1)*Ee(t.basis2)))>1e-6&&nU.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(me(t.basis1,Fg(t)))>1e-6&&nU.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-me(Fg(t),t.origin)-t.plane[3])>1e-6&&nU.warn(e,"Plane offset is not consistent with plane origin")}function Hye(t,e,r,i){const s=Fg(t);SO(s,e.direction,e.origin,r),SO(r,s,e.origin,i)}const qye={plane:Ir(),origin:Ae(0,0,0),basis1:Ae(1,0,0),basis2:Ae(0,1,0)},hN=new Hg(Ir),q5=new Hg(cp),BUe=A(),GUe=new Hg(()=>qg()),BW=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],zw=ve(),oU=ve(),jUe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Dye,UP:qye,altitudeAt:zW,axisAt:FUe,closestPoint:Vye,closestPointOnSilhouette:Uye,copy:Cw,copyWithoutVerify:IUe,create:qg,distance:DUe,distance2:UW,distanceToSilhouette:NUe,elevate:Nye,equals:Bye,extrusionContainsPoint:VW,fromAABoundingRect:Fye,fromValues:NW,intersectRay:FW,intersectRayClosestSilhouette:LUe,normal:Fg,projectPoint:zye,projectPointLocal:kye,rotate:VUe,setAltitudeAt:UUe,setExtent:$Ue,transform:Gye,updateUnboundedPlane:H5,wrap:MUe},Symbol.toStringTag,{value:"Module"})),HUe=new Ge(Pde),jK=new Ge(fq),HK=new Ge(mq),lEt=new Ge(Mde);function zf(t){return t&&(Yf(t)||Tn(t,jK))?jK:t&&(Jf(t)||Tn(t,HK))?HK:HUe}function qUe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function WUe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function ZUe(t){return{operations:t,value:t.create()}}function Wye(t,e,r=ZUe(t)){return r.operations=t,t.copy(e,r.value),r}function XUe(t){return Wye(yUe,Cye(0,0,0,Nr(t).radius))}const qK=2**50;function YUe(){return Wye(jUe,NW([0,0,0],[qK,0,0],[0,qK,0]))}function JUe(t,e,r){return t.operations.axisAt(t.value,e,hc.Z,r)}function QUe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function KUe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function e8e(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function t8e(t,e){return t.operations.altitudeAt(t.value,e)}function Zye(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function r8e(t,e,r,i){return e!==i&&$s(i,e),se(kw,i[12],i[13],i[14]),Zye(t,kw,r,kw),i[12]=kw[0],i[13]=kw[1],i[14]=kw[2],i}function aU(t,e,r){return t.operations.elevate(t.value,e,r.value)}const kw=A();function WK(t,e,r,i,s){return s[0]=me(t,e),s[1]=me(t,r),s[2]=me(t,i),s}function Jk(t,e,r,i,s){re(r,t),re(BP,e),ge(BP,BP),ot(i,BP,r),ot(s,i,r)}function i8e(t,e){return t?zf(e):e.isGeographic?Ge.PlateCarree:e}const BP=A(),GW=96;function cEt(t,e){const r=e||t.extent,i=t.width,s=Za(r&&r.spatialReference);return r&&i?r.width/i*s*gq*GW:0}function s8e(t,e){return t/(Za(e)*gq*GW)}function n8e(t){return t/(gq*GW)}const o8e="OBJECTID";let oS=class extends vA{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(Q.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};oS=u([R("esri.support.AnalysesCollection")],oS);const eL={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},lU={xsmall:544,small:768,medium:992,large:1200};function a8e(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function cU(t,e){return e?eL[t].valueToClassName[e].split(" "):[]}const l8e=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new Mi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=lU}initialize(){this._breakpointsHandles.add(ue(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),zr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Pe(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=a8e(r);if(!i){const s=JSON.stringify(lU,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:lU,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=sc.acquire(),i=sc.acquire();let s,n=!1;for(s in eL){const o=this[s],a=eL[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,cU(s,o).forEach(l=>i.push(l)),cU(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),sc.release(r),sc.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in eL)cU(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([p()],e.prototype,"breakpoints",null),u([p()],e.prototype,"orientation",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),u([p()],e.prototype,"heightBreakpoint",void 0),e=u([R("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var c8e=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},B1={exports:{}},Ws={},EO={exports:{}},Aw={};function Xye(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function u8e(t,e,r){}function h8e(t,e,r){}var d8e=/javascript\s*\:/img;function p8e(t,e){return d8e.test(e)?"":e}Aw.whiteList=Xye();Aw.getDefaultWhiteList=Xye;Aw.onAttr=u8e;Aw.onIgnoreAttr=h8e;Aw.safeAttrValue=p8e;var f8e={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},IE=f8e;function m8e(t,e){t=IE.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var h=IE.trim(t.slice(s,n)),d=h.indexOf(":");if(d!==-1){var f=IE.trim(h.slice(0,d)),m=IE.trim(h.slice(d+1));if(f){var y=e(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return IE.trim(o)}var g8e=m8e,GP=Aw,y8e=g8e;function ZK(t){return t==null}function _8e(t){var e={};for(var r in t)e[r]=t[r];return e}function Yye(t){t=_8e(t||{}),t.whiteList=t.whiteList||GP.whiteList,t.onAttr=t.onAttr||GP.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||GP.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||GP.safeAttrValue,this.options=t}Yye.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=y8e(t,function(l,c,h,d,f){var m=i[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(d):m instanceof RegExp&&(y=m.test(d)),y!==!0&&(y=!1),d=o(h,d),!!d){var _={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var v=s(h,d,_);return ZK(v)?h+":"+d:v}else{var v=n(h,d,_);if(!ZK(v))return v}}});return a};var v8e=Yye;(function(t,e){var r=Aw,i=v8e;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(EO,EO.exports);var jW={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},b8e=EO.exports.FilterCSS,w8e=EO.exports.getDefaultWhiteList,dN=jW;function Jye(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Qye=new b8e;function x8e(t,e,r){}function T8e(t,e,r){}function S8e(t,e,r){}function E8e(t,e,r){}function Kye(t){return t.replace(A8e,"&lt;").replace(O8e,"&gt;")}function C8e(t,e,r,i){if(r=n0e(r),e==="href"||e==="src"){if(r=dN.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(jP.lastIndex=0,jP.test(r))return""}else if(e==="style"){if(XK.lastIndex=0,XK.test(r)||(YK.lastIndex=0,YK.test(r)&&(jP.lastIndex=0,jP.test(r))))return"";i!==!1&&(i=i||Qye,r=i.process(r))}return r=o0e(r),r}var A8e=/</g,O8e=/>/g,R8e=/"/g,P8e=/&quot;/g,M8e=/&#([a-zA-Z0-9]*);?/gim,I8e=/&colon;?/gim,$8e=/&newline;?/gim,jP=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,XK=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,YK=/u\s*r\s*l\s*\(.*/gi;function e0e(t){return t.replace(R8e,"&quot;")}function t0e(t){return t.replace(P8e,'"')}function r0e(t){return t.replace(M8e,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function i0e(t){return t.replace(I8e,":").replace($8e," ")}function s0e(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return dN.trim(e)}function n0e(t){return t=t0e(t),t=r0e(t),t=i0e(t),t=s0e(t),t}function o0e(t){return t=e0e(t),t=Kye(t),t}function L8e(){return""}function D8e(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:dN.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return dN.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function N8e(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function F8e(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Ws.whiteList=Jye();Ws.getDefaultWhiteList=Jye;Ws.onTag=x8e;Ws.onIgnoreTag=T8e;Ws.onTagAttr=S8e;Ws.onIgnoreTagAttr=E8e;Ws.safeAttrValue=C8e;Ws.escapeHtml=Kye;Ws.escapeQuote=e0e;Ws.unescapeQuote=t0e;Ws.escapeHtmlEntities=r0e;Ws.escapeDangerHtml5Entities=i0e;Ws.clearNonPrintableCharacter=s0e;Ws.friendlyAttrValue=n0e;Ws.escapeAttrValue=o0e;Ws.onIgnoreTagStripAll=L8e;Ws.StripTagBody=D8e;Ws.stripCommentTag=N8e;Ws.stripBlankChar=F8e;Ws.cssFilter=Qye;Ws.getDefaultCSSWhiteList=w8e;var W5={},E0=jW;function U8e(t){var e=E0.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=E0.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function V8e(t){return t.slice(0,2)==="</"}function z8e(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(d===">"){i+=r(t.slice(s,n)),h=t.slice(n,a+1),c=U8e(h),i+=e(n,i.length,c,h,V8e(h)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++f)}}else if(d===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var k8e=/[^a-zA-Z0-9\\_:.-]/gim;function B8e(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(f,m){if(f=E0.trim(f),f=f.replace(k8e,"").toLowerCase(),!(f.length<1)){var y=e(f,m||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,d;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:j8e(t,l+1);continue}if(n!==!1&&l===i){if(d=t.indexOf(c,l+1),d===-1)break;h=E0.trim(t.slice(i+1,d)),a(n,h),n=!1,l=d,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=G8e(t,l),d===-1){h=E0.trim(t.slice(r,l)),a(h),n=!1,r=l+1;continue}else{l=d-1;continue}else if(d=H8e(t,l-1),d===-1){h=E0.trim(t.slice(r,l)),h=JK(h),a(n,h),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,JK(E0.trim(t.slice(r))))),E0.trim(s.join(" "))}function G8e(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function j8e(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function H8e(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function q8e(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function JK(t){return q8e(t)?t.substr(1,t.length-2):t}W5.parseTag=z8e;W5.parseAttr=B8e;var W8e=EO.exports.FilterCSS,Sd=Ws,a0e=W5,Z8e=a0e.parseTag,X8e=a0e.parseAttr,tL=jW;function HP(t){return t==null}function Y8e(t){var e=tL.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=tL.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=tL.trim(t.slice(0,-1))),{html:t,closing:r}}function J8e(t){var e={};for(var r in t)e[r]=t[r];return e}function Q8e(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function l0e(t){t=J8e(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Sd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=Q8e(t.whiteList||t.allowList):t.whiteList=Sd.whiteList,t.onTag=t.onTag||Sd.onTag,t.onTagAttr=t.onTagAttr||Sd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Sd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Sd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Sd.safeAttrValue,t.escapeHtml=t.escapeHtml||Sd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new W8e(t.css))}l0e.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=e.cssFilter;r.stripBlankChar&&(t=Sd.stripBlankChar(t)),r.allowCommentTag||(t=Sd.stripCommentTag(t));var d=!1;r.stripIgnoreTagBody&&(d=Sd.StripTagBody(r.stripIgnoreTagBody,n),n=d.onIgnoreTag);var f=Z8e(t,function(m,y,_,v,w){var T={sourcePosition:m,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(i,_)},x=s(_,v,T);if(!HP(x))return x;if(T.isWhite){if(T.isClosing)return"</"+_+">";var S=Y8e(v),O=i[_],C=X8e(S.html,function(P,$){var V=tL.indexOf(O,P)!==-1,z=o(_,P,$,V);return HP(z)?V?($=l(_,P,$,h),$?P+'="'+$+'"':P):(z=a(_,P,$,V),HP(z)?void 0:z):z});return v="<"+_,C&&(v+=" "+C),S.closing&&(v+=" /"),v+=">",v}else return x=n(_,v,T),HP(x)?c(v):x},c);return d&&(f=d.remove(f)),f};var K8e=l0e;(function(t,e){var r=Ws,i=W5,s=K8e;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(B1,B1.exports);var e9e=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):B1.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new B1.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?B1.exports.escapeAttrValue(e):!n&&!s?B1.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):B1.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(c8e(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=i.validate(c,r);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const Z5=new Map;function c0e(){Z5.clear()}function t9e(t){return Z5.get(t)}function r9e(t,e){Z5.set(t,e)}function uU(t){Z5.delete(t)}var qb,aS,i9e=function(t){if("WebkitTransition"in t.style)qb="webkitTransitionEnd",aS="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");qb="transitionend",aS="animationend"}},u0e=function(t){qb||i9e(t)},s9e=function(t,e){return e===void 0&&(e=t+"-active"),function(r){u0e(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(qb,s),r.removeEventListener(aS,s),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(qb,s),r.addEventListener(aS,s),requestAnimationFrame(function(){r.classList.add(e)})}},n9e=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){u0e(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(qb,n),r.removeEventListener(aS,n),i())};r.classList.add(t),r.addEventListener(qb,n),r.addEventListener(aS,n),requestAnimationFrame(function(){r.classList.add(e)})}};const o9e=Q.getLogger("esri.widgets.support.widgetUtils");function a9e(t){const e=sc.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return sc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{var s;c0e();for(const n of i)(s=t.get(n.target))==null||s(n)}),r=(i,s,n)=>(t.has(i)&&o9e.error("Already observing element",i),t.set(i,s),e.observe(i,n),ja(()=>{e.unobserve(i),t.delete(i)}));return(i,s,n)=>{let o=null;return ue(()=>typeof i=="function"?i():i,a=>{o==null||o.remove(),a&&(o=r(a,s,n))},As)}})();function l9e(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function hEt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function dEt(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function pEt(t,e){return(t==="enter"?s9e:n9e)(e)}const c9e=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],u9e=c9e.reduce((t,e)=>(t[e]=[],t),{}),h9e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],h0e=new e9e({whiteList:u9e,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(h9e.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function d9e(t){return t==="Enter"||t===" "}const d0e="http://www.w3.org/",X5=`${d0e}2000/svg`,p0e=`${d0e}1999/xlink`;let QK=[],HW=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},qW=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),f0e=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},p9e=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(qW(t[i],e))return i}return-1},hU=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(qW(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},f9e=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},Qk=[],Kk=!1,m0e=t=>{(t.children||[]).forEach(m0e),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},KK=()=>{Kk=!1,Qk.forEach(m0e),Qk.length=0},eee=t=>{Qk.push(t),Kk||(Kk=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(KK,{timeout:16}):setTimeout(KK,16))},tee=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),eee(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),eee(t))},m9e=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")eB(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let d=0;d<h;d++){let f=c[d],m=l[f];m&&(f0e(m),r.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(d){h.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):r.namespace===X5?a==="href"?t.setAttributeNS(p0e,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=h0e.sanitize(l):g0e(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function g0e(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let pN,g9e=(t,e,r)=>{if(e)for(let i of e)WT(i,t,void 0,r)},y0e=(t,e,r)=>{g9e(t,e.children,r),e.text&&(t.textContent=e.text),m9e(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},WT=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),d=o.slice(n,l);h==="."?s.classList.add(d):h==="#"?s.id=d:(d==="svg"&&(i=HW(i,{namespace:X5})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}y0e(s,t,i)}},eB=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},y9e=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],h=e[l];if(l==="class")h!==c&&(eB(t,h,!1),eB(t,c,!0));else if(l==="classes"){let d=t.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let _=f[y],v=!!c[_];v!==!!h[_]&&(s=!0,v?d.add(_):d.remove(_))}}else if(l==="styles"){let d=Object.keys(c),f=d.length;for(let m=0;m<f;m++){let y=d[m],_=c[y];_!==h[y]&&(s=!0,_?(f0e(_),i.styleApplyer(t,y,_)):i.styleApplyer(t,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let d=typeof c;d==="function"&&i.eventHandlerInterceptor||(i.namespace===X5?l==="href"?t.setAttributeNS(p0e,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=h0e.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):g0e(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},_9e=(t,e,r,i,s)=>{if(r===i)return!1;i=i||QK;let n,o=(r=r||QK).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let d=l<o?r[l]:void 0,f=i[c];if(d!==void 0&&qW(d,f))h=pN(d,f,s)||h,l++;else{let m=p9e(r,f,l+1);if(m>=0){for(n=l;n<m;n++)tee(r[n]),hU(r,n,t,"removed");h=pN(r[m],f,s)||h,l=m+1}else WT(f,e,l<o?r[l].domNode:void 0,s),f9e(f),hU(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)tee(r[n]),hU(r,n,t,"removed");return h};pN=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=HW(r,{namespace:X5})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=_9e(e,i,t.children,e.children,r)||n,n=y9e(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let $E=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,pN(i,r,e)},domNode:t.domNode});const v9e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let rT=t=>HW(v9e,t),e_={create:(t,e)=>(e=rT(e),WT(t,document.createElement("div"),void 0,e),$E(t,e)),append:(t,e,r)=>(r=rT(r),WT(e,t,void 0,r),$E(e,r)),insertBefore:(t,e,r)=>(r=rT(r),WT(e,t.parentNode,t,r),$E(e,r)),merge:(t,e,r)=>(r=rT(r),e.domNode=t,y0e(t,e,r),$E(e,r)),replace:(t,e,r)=>(r=rT(r),WT(e,t.parentNode,t,r),t.parentNode.removeChild(t),$E(e,r))},_0e,b9e=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};_0e=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let w9e=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?_0e(r.children,s=>s.domNode===i):void 0}),r},x9e=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=b9e(s.currentTarget,n.domNode);o.reverse();let a,l=w9e(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},ree=t=>{let e,r,i=rT(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,f,m)=>{let y,_=()=>y;i.eventHandlerInterceptor=x9e(e,_,s),y=d(f,m(),i),a.push(y),l.push(m)},h=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let f=l[d]();s("rendered",void 0),a[d].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,f)=>{c(e_.append,d,f)},insertBefore:(d,f)=>{c(e_.insertBefore,d,f)},merge:(d,f)=>{c(e_.merge,d,f)},replace:(d,f)=>{c(e_.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},r0=class extends xe{constructor(){super(...arguments),this.items=new Mt,this._watchUpdatingTracking=new Ef,this._callbacks=new Map,this._projector=ree(),this._hiddenProjector=ree()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([p({readOnly:!0})],r0.prototype,"surface",void 0),u([p({readOnly:!0})],r0.prototype,"items",void 0),u([p({readOnly:!0})],r0.prototype,"needsRender",null),u([p({readOnly:!0})],r0.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],r0.prototype,"updating",null),r0=u([R("esri.views.overlay.ViewOverlay")],r0);const iee=r0,dU=[0,0];function T9e(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return dU[0]=r.left+((e==null?void 0:e.pageXOffset)??0),dU[1]=r.top+((e==null?void 0:e.pageYOffset)??0),dU}function see(t){t&&(age(t),t.parentNode&&t.parentNode.removeChild(t))}function S9e(t){const e=document.createElement("div");return t.appendChild(e),e}const LE=16,qP=750,E9e=512,C9e=2,A9e=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:LE,time:qP},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([ue(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),ue(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([ue(()=>this.ui,(r,i)=>this._handleUIChange(r,i),zr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Pe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=P5(r);if(s||typeof r!="string"||Q.getLogger(this).error("#container",`element with id '${r}' not found`),i===s)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(see(this.root),this._set("root",null)),this.userContent&&(xK(this.userContent,i),see(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",xK(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new iee;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(ue(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=k2({render:()=>{var h;return(h=this.overlay)==null?void 0:h.render()}}):this._overlayRenderTaskHandle=Di(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){var r;(r=this.surface)==null||r.blur()}focus(){var r;(r=this.surface)==null||r.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(ue(()=>this.root,s=>{r.container=s?S9e(s):null},zr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=LE,r.time=qP,this.addHandles([(()=>{const i=()=>{r.freq=LE,r.time=qP};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),k2({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=LE,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?LE:Math.min(qP,n.freq*C9e),!s&&n.freq>=E9e&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&T9e(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([p()],e.prototype,"container",null),u([p({readOnly:!0})],e.prototype,"focused",null),u([p({readOnly:!0})],e.prototype,"height",void 0),u([p({type:iee})],e.prototype,"overlay",void 0),u([p({readOnly:!0})],e.prototype,"position",void 0),u([p({readOnly:!0})],e.prototype,"resizing",void 0),u([p({readOnly:!0})],e.prototype,"root",void 0),u([p({value:null,readOnly:!0})],e.prototype,"size",null),u([p({readOnly:!0})],e.prototype,"surface",void 0),u([p({readOnly:!0})],e.prototype,"suspended",void 0),u([p()],e.prototype,"ui",void 0),u([p({readOnly:!0})],e.prototype,"userContent",void 0),u([p({readOnly:!0})],e.prototype,"width",void 0),u([p()],e.prototype,"widthBreakpoint",void 0),e=u([R("esri.views.DOMContainer")],e),e},WW=Q.getLogger("esri.layers.support.ElevationSampler");let v0e=class{queryElevation(e){return b0e(e.clone(),this)}on(){return I9e}projectIfRequired(e,r){return w0e(e,r)}},O9e=class extends v0e{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=h5(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=Za(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return d5(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return WW.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},yEt=class extends v0e{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new O9e(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=h5(kt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return WW.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function b0e(t,e){const r=w0e(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":R9e(t,r,e);break;case"polyline":P9e(t,r,e);break;case"multipoint":M9e(t,r,e)}return t}function w0e(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=mw(t,e);return i||WW.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function R9e(t,e,r){t.z=r.elevationAt(e.x,e.y)}function P9e(t,e,r){df.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];df.x=c[0],df.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(df.x,df.y)}}t.hasZ=!0}function M9e(t,e,r){df.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];df.x=o[0],df.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(df.x,df.y)}t.hasZ=!0}const df=new ct,I9e={remove(){}};var tB;let Hp=tB=class extends de{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new tB({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Hp.prototype,"cols",void 0),u([p({type:Ji,json:{write:!0}})],Hp.prototype,"level",void 0),u([p({type:String,json:{write:!0}})],Hp.prototype,"levelValue",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Hp.prototype,"origin",void 0),u([p({type:Number,json:{write:!0}})],Hp.prototype,"resolution",void 0),u([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Hp.prototype,"rows",void 0),u([p({type:Number,json:{write:!0}})],Hp.prototype,"scale",void 0),Hp=tB=u([R("esri.layers.support.LOD")],Hp);const Md=Hp;let $9e=class{constructor(e,r,i,s,n=void 0){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var i0;const nee=new Rr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Xo=i0=class extends de{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=Ge.WebMercator,numLODs:n=24}=t;if(!sa(s)){const d=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];d.push(new Md({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)d.unshift(new Md({level:m,scale:f,resolution:f})),f*=2}return new i0({dpi:96,lods:d,origin:new ct(0,0,s),size:[i,i],spatialReference:s})}const o=db(s),a=t.origin?new ct({x:t.origin.x,y:t.origin.y,spatialReference:s}):new ct(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Za(s)*39.37*l),h=[];if(r)for(let d=0;d<r.length;d++){const f=r[d],m=f*c;h.push(new Md({level:d,scale:f,resolution:m}))}else{let d=Ode(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(n/e);h.push(new Md({level:0,scale:d,resolution:d*c}));for(let m=1;m<f;m++){const y=d/2**e,_=y*c;h.push(new Md({level:m,scale:y,resolution:_})),d=y}}return new i0({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=db(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return ct.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(Tn(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=mw(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new $9e(null,0,0,0,kt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=i0.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===i0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=kt()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return i0.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new Md({level:n.level,scale:n.scale,resolution:o}))}return new i0({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};u([p({type:Number,json:{write:!0}})],Xo.prototype,"compressionQuality",void 0),u([p({type:Number,json:{write:!0}})],Xo.prototype,"dpi",void 0),u([p({type:String,json:{read:nee.read,write:nee.write,origins:{"web-scene":{read:!1,write:!1}}}})],Xo.prototype,"format",void 0),u([p({readOnly:!0})],Xo.prototype,"isWrappable",null),u([p({type:ct,json:{write:!0}})],Xo.prototype,"origin",void 0),u([Se("origin")],Xo.prototype,"readOrigin",null),u([p({type:[Md],value:null,json:{write:!0}})],Xo.prototype,"lods",null),u([p({readOnly:!0})],Xo.prototype,"scales",void 0),u([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Xo.prototype,"size",void 0),u([Se("size",["rows","cols"])],Xo.prototype,"readSize",null),u([De("size",{cols:{type:Ji},rows:{type:Ji}})],Xo.prototype,"writeSize",null),u([p({type:Ge,json:{write:!0}})],Xo.prototype,"spatialReference",void 0),Xo=i0=u([R("esri.layers.support.TileInfo")],Xo),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Xo||(Xo={}));const rL=Xo,L9e=12;let nc=class ll{constructor(e){const r=ll.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=S_(this.spatialReference)||Yf(this.spatialReference)||Jf(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,h,d)=>(h.level<c.min&&(c.min=h.level,c.minIndex=d),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new ll(this.toTileInfo())}toTileInfo(){return new rL({dpi:this.dpi,origin:new ct({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Md({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=_Q(e[0]),r[1]=LD(e[1]),r[2]=_Q(e[2]),r[3]=LD(e[3])):this._isGCS&&(r[0]=Ut(e[0]),r[1]=Ut(e[1]),r[2]=Ut(e[2]),r[3]=Ut(e[3]))}getExtentGeometry(e,r,i,s=new _r){return this.getExtent(e,r,i,yp),s.spatialReference=this.spatialReference,s.xmin=yp[0],s.ymin=yp[1],s.xmax=yp[2],s.ymax=yp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof ll)){if(ll.checkUnsupported(e))return!1;e=new ll(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!p2(e.origin[0],this.origin[0],s)||!p2(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*L9e,p2(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;ll.computeRowColExtent(e,n,this.origin,yp);let o=yp[1],a=yp[3],l=yp[0],c=yp[2];const h=c-l,d=a-o;if(h*d>i){const f=Math.floor(Math.sqrt(i));d>f&&(o=o+Math.floor(.5*d)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!pLe(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?ZW():e.lods.length<1?new U("tilingscheme:generic","Tiling scheme must have at least one level"):ll.isPowerOfTwo(e)?ll.hasGapInLevels(e)?new U("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):ll.tileSizeSupported(e)?ll.hasOriginPerLODs(e)?new U("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new U("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new U("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=Za(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,h=new ll(new rL({size:[a,a],origin:new ct({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new Md({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const r=new ll(ll.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new ll(new rL({size:[r,r],origin:new ct({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Md({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function ZW(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}nc.WebMercatorAuxiliarySphereTileInfo=new rL({size:[256,256],origin:new ct({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ge.WebMercator}),spatialReference:Ge.WebMercator,lods:[new Md({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),nc.WebMercatorAuxiliarySphere=nc.makeWebMercatorAuxiliarySphere(19);const yp=kt(),ZT=64,n3=512,D9e=2.5,CO=fLe(iz/10),x0e=2,T0e=kt();nc.WebMercatorAuxiliarySphere.getExtent(0,0,0,T0e);const N9e=kt([-180,-90,180,90]),F9e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",U9e="Surface extent is too large for tile resolution at level 0.",V9e=3;let z9e=V9e;function rB(t){return t<4?3:z9e}let s0=class extends Ls.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=CO}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const r=h5(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??Ge.WGS84}elevationAt(e,r){var i;if(this.extent==null||!Ma(this.extent,e,r)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Q.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return b0e(e.clone(),this)}};u([p({readOnly:!0})],s0.prototype,"demResolution",void 0),u([p({readOnly:!0})],s0.prototype,"extent",null),u([p({readOnly:!0})],s0.prototype,"noDataValue",void 0),u([p()],s0.prototype,"spatialReference",null),u([p({constructOnly:!0})],s0.prototype,"view",void 0),s0=u([R("esri.views.support.GroundViewElevationSampler")],s0);const k9e=s0;let n0=class extends xe{constructor(e){super(e),this.view=null,this.layerViews=new Mt}initialize(){this.addHandles(xh(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new k9e({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>ue(()=>e.updating,()=>this._updateUpdating(),jr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([p({readOnly:!0})],n0.prototype,"elevationSampler",null),u([p({type:Boolean,readOnly:!0})],n0.prototype,"updating",null),u([p({constructOnly:!0})],n0.prototype,"view",void 0),u([p({type:Mt,readOnly:!0})],n0.prototype,"layerViews",void 0),u([p({readOnly:!0})],n0.prototype,"suspended",null),n0=u([R("esri.views.GroundView")],n0);const B9e=n0;let Ug=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new Rhe(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=khe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)WJ(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)WJ(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const G9e=oe("mac")?"Meta":"Ctrl",Y5={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)Y5[t]=String.fromCharCode(t);for(let t=1;t<25;t++)Y5[111+t]=`F${t}`;for(let t=65;t<91;t++)Y5[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function j9e(t){if(t.key!==void 0)return PRe(t);const e=Y5[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function H9e(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let q9e=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const oee=Q.getLogger("esri.views.input.InputHandler");let wo=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?oee.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new q9e(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const d=this._incoming[h.match.eventType];if(d){const f=d.indexOf(h);d.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new W9e(n,i,{onPause:a,onRemove:a,onResume:h=>{const d=this._incoming[h.match.eventType];d&&!d.includes(h)&&(d.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new Z9e(e,{onEmit:(i,s,n,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,s,n,o)},onRemove:i=>{var s;delete this._outgoing[i.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):oee.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const s of r)if(s.match.matches(e)&&((i=s.callback)==null||i.call(s,e),e.shouldStopPropagation()))break}}},W9e=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},Z9e=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},X9e=class extends wo{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},Y9e=class{constructor(e,r){this._observable=new e5,this._value=e,this._equalityFunction=r}get value(){return Xt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function AO(t,e=phe){return new Y9e(t,e)}let J9e=class extends wo{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=AO(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Du=class extends xe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=G9e,this._latestPointerType="mouse",this._propertiesPool=new Ug({latestPointerLocation:eVe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=c_.INTERNAL){if(this._nameToGroup[e])return void Q.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void Q.getLogger(this).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var s;i.removed=!0,(s=i.uninstallCallback)==null||s.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Q.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)H9e(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new X9e((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new J9e,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],c_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,c_.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new Q9e(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new Ok,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:s,priorityIndex:n}=e.events.pop(),o=s.data&&s.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[n];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((i=(r=e.currentHandler).eventCallback)==null||i.call(r,s)),s.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new Ok;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};u([p({readOnly:!0})],Du.prototype,"hasPendingInputs",null),u([p({constructOnly:!0})],Du.prototype,"eventSource",void 0),u([p({constructOnly:!0})],Du.prototype,"recognizers",void 0),u([p()],Du.prototype,"_latestPointerType",void 0),u([p()],Du.prototype,"latestPointerType",null),u([p()],Du.prototype,"multiTouchActive",null),u([p({readOnly:!0})],Du.prototype,"latestPointerLocation",void 0),u([p()],Du.prototype,"_paused",void 0),u([p({readOnly:!0})],Du.prototype,"updating",null),Du=u([R("esri.views.input.InputManager")],Du);let Q9e=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=C0.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=C0.STOPPED}shouldStopPropagation(){return(this._propagationState&C0.STOPPED)!=0}async(e){this._propagationState|=C0.PAUSED;const r=(i,s)=>{this._propagationState&=~C0.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&C0.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var C0;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(C0||(C0={}));const c_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let K9e=class{};const eVe=K9e;function _p(t){return t!=null&&"open"in t&&"declaredClass"in t}function aee(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const tVe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([ue(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&_p(l)&&(l.view=null,aee(l)&&a.remove(l,n))}r&&_p(i)&&(i.view=this,aee(i)&&r.add(i,{key:n,position:o,internal:!0}))},zr),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!_p(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(_p(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),_p(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},c_.WIDGET)]),K2(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ae(()=>import("./Popup-fbcba676.js").then(r=>r.a0),["assets/Popup-fbcba676.js","assets/unitFormatUtils-5d385ad6.js","assets/AttachmentInfo-43763fe6.js","assets/widget-1b23769a.js","assets/executeQueryJSON-97b27b27.js","assets/query-dae0ecc4.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js"])})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){_p(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void Q.getLogger(this).error(new U("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),_p(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),h=c.map(d=>d.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:AV([l,...h]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!_p(this.popup))return this._popupSetupTask=kS(async i=>{const{default:s}=await ae(()=>import("./Popup-fbcba676.js").then(o=>o.a0),["assets/Popup-fbcba676.js","assets/unitFormatUtils-5d385ad6.js","assets/AttachmentInfo-43763fe6.js","assets/widget-1b23769a.js","assets/executeQueryJSON-97b27b27.js","assets/query-dae0ecc4.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js"]);if(Qt(i),!this.popup||_p(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:s!=null?s.event:void 0,signal:s!=null?s.signal:void 0,defaultPopupTemplateEnabled:s!=null&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return u([p({cast(r){return!r||_p(r)||typeof r=="object"&&(r.open=i=>(OD(Q.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(OD(Q.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),u([p()],e.prototype,"popupEnabled",void 0),e=u([R("esri.views.PopupView")],e),e},lee={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},rVe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function iVe(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function wb(t,e,r){const i=new Date(t.getTime());if(e&&r){const s=rVe[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=iVe(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+e*a)}return i}function cee(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function sVe(t,e,r){return t===0?0:t*lee[e]/lee[r]}var sd;let kc=sd=class extends de{static get allTime(){return uee}static get empty(){return nVe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(sd.allTime)}get isEmpty(){return this.equals(sd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new sd({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=t.start!=null?t.start.getTime():t.start,s=t.end!=null?t.end.getTime():t.end;return e===i&&r===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=lc(this.start,i=>cee(i,t)),r=lc(this.end,i=>{const s=cee(i,t);return i.getTime()===s.getTime()?s:wb(s,1,t)});return new sd({start:e,end:r})}intersection(t){var a,l,c,h;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return sd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((h=t.end)==null?void 0:h.getTime())??1/0;let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const d=new sd;return d.start=n===-1/0?null:new Date(n),d.end=o===1/0?null:new Date(o),d}return sd.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new sd,{start:i,end:s}=this;return i!=null&&(r.start=wb(i,t,e)),s!=null&&(r.end=wb(s,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return uee.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new sd({start:e,end:r})}};u([p({type:Date,json:{write:{allowNull:!0}}})],kc.prototype,"end",void 0),u([Se("end")],kc.prototype,"readEnd",null),u([De("end")],kc.prototype,"writeEnd",null),u([p({readOnly:!0,json:{read:!1}})],kc.prototype,"isAllTime",null),u([p({readOnly:!0,json:{read:!1}})],kc.prototype,"isEmpty",null),u([p({type:Date,json:{write:{allowNull:!0}}})],kc.prototype,"start",void 0),u([Se("start")],kc.prototype,"readStart",null),u([De("start")],kc.prototype,"writeStart",null),kc=sd=u([R("esri.TimeExtent")],kc);const uee=new kc,nVe=new kc({start:void 0,end:void 0}),em=kc;let xb=class extends vA{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([YH({Type:hu,ensureType:qs(hu)})],xb.prototype,"itemType",void 0),xb=u([R("esri.support.GraphicsCollection")],xb);const hee=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function oVe(t,e="system"){if(!t||!hee.has(t.timeZone))return e;const r=hee.get(t.timeZone);return lVe(t.timeZone)||t.respectsDaylightSaving?r:aVe(r)}function aVe(t){const e=gr.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${ka.instance(-r).formatOffset(0,"narrow")}`}function lVe(t){return t.startsWith("UTC")}let o0=class extends ji(de){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:s}=r;return{timeZone:i,respectsDaylightSaving:s}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:oVe(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};u([p()],o0.prototype,"legacy",void 0),u([Se("legacy",["timeZone"])],o0.prototype,"readLegacy",null),u([p({type:String,nonNullable:!0})],o0.prototype,"timeZone",void 0),u([Se("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],o0.prototype,"readTimeZone",null),u([De("timeZone")],o0.prototype,"writeTimeZone",null),o0=u([R("esri.time.TimeReference")],o0);const lS=o0;let a0=class extends xe{constructor(e){super(e),this.view=null,this.baseLayerViews=new Mt,this.referenceLayerViews=new Mt,this._loadingHandle=ue(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},zr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};u([p({constructOnly:!0})],a0.prototype,"view",void 0),u([p({readOnly:!0})],a0.prototype,"baseLayerViews",void 0),u([p({readOnly:!0})],a0.prototype,"referenceLayerViews",void 0),u([p({readOnly:!0})],a0.prototype,"suspended",null),u([p({type:Boolean,readOnly:!0})],a0.prototype,"updating",null),a0=u([R("esri.views.BasemapView")],a0);function cVe(t){return"tryRecycleWith"in t}let uVe=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=yo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,oa(this._controller.signal,()=>{const s=new U("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!cVe(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Qt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>oa(this._controller.signal,()=>h(Dr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:e}),"prefetchResources"in r&&await((s=r.prefetchResources)==null?void 0:s.call(r,{signal:e})),dVe(r))a=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new U("layer:view-not-supported","No layerview implementation was found");const d=await this.layerViewImporter.importLayerView(r);Qt(e),a="default"in d?new d.default({layer:r,view:i}):new d({layer:r,view:i})}const c=()=>{l=Di(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=oa(e,c),Qt(e);try{await a.when()}catch(d){throw c(),d}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new U("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new U("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}},Nu=class extends xe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Ef,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const s of r)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=yo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(US(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=d=>{if(d!=null){for(const f of d)if(f){i.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&n?m.start():m||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const d of this._rootCollectionNames)o(this.get(d));for(const[d,f]of this._layerLayerViewInfoMap)if(!i.has(d)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(s);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[d,f]of this._recyclingInfoMap)i.has(d)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy());for(const d of s)this._createLayerView(d);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(h=r==null?void 0:r.basemap)==null?void 0:h.referenceLayers,r==null?void 0:r.layers].filter(d=>!!d);i.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Ga(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ue(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),As)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),F6(this._recyclingInfoMap),F6(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Dr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Lo(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(F6(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new U("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=i,r.at(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new uVe(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(ys(i)||i.name==="cancelled:layerview-create")||Q.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([p()],Nu.prototype,"_workPromise",void 0),u([p({readOnly:!0})],Nu.prototype,"_watchUpdatingTracking",void 0),u([p({readOnly:!0})],Nu.prototype,"_layersToLayerViews",null),u([p({readOnly:!0})],Nu.prototype,"_rootCollectionNames",null),u([p()],Nu.prototype,"layerViewImporter",void 0),u([p()],Nu.prototype,"supportsGround",void 0),u([p({readOnly:!0})],Nu.prototype,"updating",null),u([p({readOnly:!0})],Nu.prototype,"updatingRemaining",null),u([p({constructOnly:!0})],Nu.prototype,"view",void 0),Nu=u([R("esri.views.LayerViewManager")],Nu);const hVe=Nu;function dVe(t){return"createLayerView"in t&&t.createLayerView!=null}let Lc=class extends xe{constructor(e){super(e),this.factor=1.5,this.offset=wh(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([p({type:Number})],Lc.prototype,"factor",void 0),u([p({nonNullable:!0})],Lc.prototype,"offset",void 0),u([p()],Lc.prototype,"position",void 0),u([p({type:Number,range:{min:0}})],Lc.prototype,"size",void 0),u([p()],Lc.prototype,"maskUrl",void 0),u([p()],Lc.prototype,"maskEnabled",void 0),u([p()],Lc.prototype,"overlayUrl",void 0),u([p()],Lc.prototype,"overlayEnabled",void 0),u([p({readOnly:!0})],Lc.prototype,"version",null),u([p({type:Boolean})],Lc.prototype,"visible",void 0),Lc=u([R("esri.views.Magnifier")],Lc);const S0e=Lc;let pVe=class{constructor(){this._tasks=new Array,this._running=AO(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.push(new dee(s,n,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.unshift(new dee(s,n,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const s=vn(r.signal);if(s&&!r.abortCallback)r.reject(Dr());else{const n=s?(i=r.abortCallback)==null?void 0:i.call(r,Dr()):r.callback(e);gu(n)?n.then(r.resolve,r.reject):r.resolve(n)}}catch(s){r.reject(s)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=Dr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},dee=class{constructor(e,r,i,s=void 0,n=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},o3=class extends xe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([p()],o3.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([p()],o3.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o3=u([R("esri.views.support.DebugFlags")],o3);const fVe=new o3;var $r;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})($r||($r={}));function mVe(){return new fN.Scheduler}var Bo,pt;(function(t){t[t.YIELD=1]="YIELD"})(Bo||(Bo={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(pt||(pt={}));const af=0,pee=new Map([[pt.RESOURCE_CONTROLLER_IMMEDIATE,af],[pt.RESOURCE_CONTROLLER,4],[pt.SLIDE,af],[pt.STREAM_DATA_LOADER,af],[pt.ELEVATION_QUERY,af],[pt.TERRAIN_SURFACE,1],[pt.SURFACE_GEOMETRY_UPDATES,1],[pt.LOD_RENDERER,2],[pt.GRAPHICS_CORE,2],[pt.I3S_CONTROLLER,2],[pt.POINT_CLOUD_LAYER,2],[pt.FEATURE_TILE_FETCHER,2],[pt.OVERLAY,4],[pt.STAGE,4],[pt.GRAPHICS_DECONFLICTOR,4],[pt.FILTER_VISIBILITY,4],[pt.SCALE_VISIBILITY,4],[pt.FRUSTUM_VISIBILITY,4],[pt.CLOUDS_GENERATOR,4],[pt.POINT_OF_INTEREST_FREQUENT,6],[pt.POINT_OF_INTEREST_INFREQUENT,30],[pt.LABELER,8],[pt.FEATURE_QUERY_ENGINE,8],[pt.FEATURE_TILE_TREE,16],[pt.FEATURE_TILE_TREE_ACTIVE,af],[pt.ELEVATION_ALIGNMENT,12],[pt.TEXT_TEXTURE_ATLAS,12],[pt.TEXTURE_UNLOAD,12],[pt.LINE_OF_SIGHT_TOOL,16],[pt.LINE_OF_SIGHT_TOOL_INTERACTIVE,af],[pt.SNAPPING,af],[pt.SHADOW_ACCUMULATOR,30]]);function fee(t){return pee.has(t)?pee.get(t):typeof t=="number"?t:1}const mee=6.5,gee=1,gVe=30,yee=1e3/30,_ee=100,vee=.9;var fN,sv;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=AO(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new cg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=$r.INTERACTING,this._tasks=new Gt,this._runQueue=new Gt,this._load=0,this._idleStateCallbacks=new Gt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ue(()=>fVe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,zr);for(const o of Object.keys(pt))this.performanceInfo.tasks.set(pt[o],new cg(pt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:mee,INTERACTING_BUDGET:yee,IDLE_BUDGET:_ee,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Di(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=fee(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new cg(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===$r.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===$r.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==$r.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=mee,a=n.frameDuration,l=gee;switch(this.state){case $r.IDLE:o=0,a=Math.max(_ee,n.frameDuration),l=gVe;break;case $r.INTERACTING:a=Math.max(yee,n.frameDuration);case $r.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==$r.IDLE&&a<gee&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case $r.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case $r.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return sv.SCHEDULED;let o=sv.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=sv.READY:o!==sv.READY&&(o=sv.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*vee+n*(1-vee)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===af&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==af&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Bo.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){Q.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,pt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(pt))this._frameTaskTimes.set(pt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new pVe,this._handles=new Mi,this.schedulePriority=this._basePriority,this._task=AO(a??this._queue),this._handles.add(xh(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(Va),this._scheduler.removeTask(this),this.schedule=cS.schedule,this.reschedule=cS.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=fee(n);this._basePriority!==af&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=$r.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(fN||(fN={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(sv||(sv={}));const Va=(()=>{const t=new fN.Budget;return t.enabled=!1,t})();let yVe=class{remove(){}processQueue(){}schedule(e,r,i){try{if(vn(r)){const s=Dr();return i?Promise.resolve(i(s)):Promise.reject(s)}return OV(e(Va))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const cS=new yVe;let XT=class extends xe{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(pt.TEXTURE_UNLOAD))??cS}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(s=>this._releaseTextureRequest(s)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){var o,a;const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const l=new E0e(i);l.texture=r(),(o=this._stage)==null||o.add(l.texture),(a=this._stage)==null||a.loadImmediate(l.texture),this._textureRequests.set(s,l),n=l}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.onRemove&&e.onRemove(),e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};u([p()],XT.prototype,"_frameTask",void 0),u([p()],XT.prototype,"updating",null),XT=u([R("esri.views.3d.support.TextureCollection")],XT);let E0e=class{constructor(e){this.onRemove=e,this.referenceCount=0}};var bee;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(bee||(bee={}));const C0e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],A0e={};function O0e(t){return!!A0e[t]}function _Ve(t){for(const e of t)if(!O0e(e))return!1;return!0}C0e.forEach(t=>{A0e[t]=!0});let vVe=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!_Ve(n))return n.some(O0e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??c_.DEFAULT;const l=this._createUniqueGroupName(),c=new bVe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const d=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},bVe=class extends wo{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:wh(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(wh(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:d}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:qa(r.angle),native:l,timestamp:d,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:d,timestamp:f}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:d,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var OO,wee,xee;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(OO||(OO={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(wee||(wee={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(xee||(xee={}));function wVe(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return Q.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function iB(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(OO.USER)&&t.getEditableFlag(OO.MANAGER)}function qp(t){return wh(t.x,t.y)}function WEt(t){return Yi(t.x,t.y)}function R0e(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?wh(e.clientX-r.left,e.clientY-r.top):wh(0,0)}function Tee(t,e){return e instanceof Event?R0e(t,e):qp(e)}function See(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let xVe=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Eee(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Cee(e))break;const s=qp(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!Cee(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=lc(s,({manipulator:h})=>h),o=lc(s,({tool:h})=>h);if(n==null||o==null)break;const a=qp(e);a.x=_e(a.x,0,r.view.width),a.y=_e(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=qp(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(TVe(e)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=qp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=qp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=qp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:qp(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=lc(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:qp(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return Lo(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=VOe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!iB(n))return!1;const o=n.manipulators.intersect(e,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(wh(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Eee(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(qp(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){let n=this._intersect(e,i,s);const o=lc(this._hoveredManipulators.get(r),({manipulator:a})=>a);n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Eee(t){return t==="mouse"}function Cee(t){return t.pointerType!=="mouse"||t.button===0}function TVe(t){return!!t.native.shiftKey}const Aee="attached",pU="tools",SVe=1e3;let nd=class extends xO{constructor(e){super(e),this._clock=dR,this._manipulatorState=new xVe,this.tools=new Mt,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(C0e,e=>{this._handleInputEvent(e)},c_.TOOL),...wVe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void Q.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=iB(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=Di(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,SVe)}attach(){var e;this.view.type==="3d"?(this._set("textures",new XT(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ue(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r))),ja(()=>this._set("textures",Pe(this.textures)))],Aee)):this.handles.add(ue(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(Aee),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(pU),this._forEachTool(e=>{if(e instanceof xe){const r=ue(()=>[e.cursor,e.visible,e.editable],()=>{iB(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,pU)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],pU)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,OO.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){return{setClock:e=>this._clock=e}}};u([p({constructOnly:!0,nonNullable:!0})],nd.prototype,"view",void 0),u([p({readOnly:!0,nonNullable:!0})],nd.prototype,"textures",void 0),u([p({value:null})],nd.prototype,"activeTool",null),u([p({readOnly:!0,type:Mt})],nd.prototype,"tools",void 0),u([p({readOnly:!0})],nd.prototype,"cursor",void 0),u([p({readOnly:!0})],nd.prototype,"updating",null),u([p()],nd.prototype,"_interacting",void 0),u([p({readOnly:!0})],nd.prototype,"interacting",null),nd=u([R("esri.views.ToolViewManager")],nd);let iT=class extends xe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":EVe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return CVe[this.deviceType]}};u([p({nonNullable:!0,readOnly:!0})],iT.prototype,"nativeIndex",void 0),u([p({type:String,readOnly:!0})],iT.prototype,"deviceType",null),u([p({type:Number,readOnly:!0})],iT.prototype,"axisThreshold",null),iT=u([R("esri.views.input.gamepad.GamepadInputDevice")],iT);const EVe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),CVe={standard:.15,spacemouse:.025,unknown:0},XW=iT;let a3=class extends xe{constructor(...e){super(...e),this.devices=new Mt,this.enabledFocusMode="document"}};u([p({type:Mt.ofType(XW),readOnly:!0})],a3.prototype,"devices",void 0),u([p({type:["document","view","none"]})],a3.prototype,"enabledFocusMode",void 0),a3=u([R("esri.views.input.gamepad.GamepadSettings")],a3);const AVe=a3;let iL=class extends xe{constructor(){super(...arguments),this.gamepad=new AVe}};u([p({readOnly:!0})],iL.prototype,"gamepad",void 0),iL=u([R("esri.views.input.Input")],iL);const OVe=iL;let l0=class extends xe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([p({type:Boolean,nonNullable:!0})],l0.prototype,"enabled",void 0),u([p({type:XW})],l0.prototype,"device",void 0),u([p({type:["pan","zoom"],nonNullable:!0})],l0.prototype,"mode",void 0),u([p({type:["forward-down","forward-up"],nonNullable:!0})],l0.prototype,"tiltDirection",void 0),u([p({type:Number,nonNullable:!0})],l0.prototype,"velocityFactor",void 0),l0=u([R("esri.views.navigation.gamepad.GamepadSettings")],l0);const P0e=l0;let r1=class extends xe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new P0e,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([p({type:Boolean})],r1.prototype,"browserTouchPanEnabled",void 0),u([p({type:P0e,nonNullable:!0})],r1.prototype,"gamepad",void 0),u([p({type:Boolean})],r1.prototype,"momentumEnabled",void 0),u([p({type:Boolean})],r1.prototype,"mouseWheelZoomEnabled",void 0),r1=u([R("esri.views.navigation.Navigation")],r1);const M0e=r1,I0e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},$0e=Object.values(I0e),L0e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${$0e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),RVe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${$0e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),PVe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function tCt(t){return!!L0e.test(t)}function Ow(t){if(t==null)return null;const e=_o(t),r=e.path.match(L0e)||e.path.match(RVe);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:J5(a!==-1?s.slice(a+1):s),serverType:I0e[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function MVe(t){const e=_o(t).path.match(PVe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function J5(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function D0e(t,e){const r=[];if(t){const i=Ow(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=J5(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function YW(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function IVe(t,e){return t&&xde(Sde(t,e))}function N0e(t){let{url:e}=t;if(!e)return{url:e};e=Sde(e,t.logger);const r=_o(e),i=Ow(r.path);let s;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=MVe(r.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:xde(e),layerId:s}}function F0e(t,e,r,i,s){w_(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=_c(i.url,r,t.layerId.toString()))}function rCt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}function iCt(t,e,r){const i=U0e(t),s=e,n=$Ve(i,s,r);if(i){const o=Tw.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new U("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!LVe(t)||n===Ql.Unsupported)return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case Ql.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new U("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case Ql.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new U("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case Ql.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new U("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function $Ve(t,e,r){if(!Oee(t)||!Oee(e))return Ql.Unsupported;if(t==null||e==null)return Ql.Ok;if(!r&&t.heightUnit!==e.heightUnit)return Ql.Units;if(t.heightModel!==e.heightModel)return Ql.HeightModel;switch(t.heightModel){case"gravity-related-height":return Ql.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Ql.Ok:Ql.CRS;default:return Ql.Unsupported}}var Ql;function Oee(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function LVe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!k0e(t)}function U0e(t){var i;const e=t.url?Ow(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&V0e(t)&&t.heightModelInfo?t.heightModelInfo:k0e(t)?Tw.deriveUnitFromSR(NVe,t.spatialReference):null}function V0e(t){return"heightModelInfo"in t}function z0e(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function k0e(t){return z0e(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):B0e(t)}function DVe(t){return t.layers!=null||B0e(t)||z0e(t)||V0e(t)}function B0e(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Ql||(Ql={}));const NVe=new Tw({heightModel:"gravity-related-height"});var Le;function Ree(t){return t==="global"?Le.Global:Le.Local}function fU(t){return t===Le.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Le||(Le={}));let sB,mU=null;async function FVe(t){mU||(mU=ae(()=>Promise.resolve().then(()=>clt),void 0).then(e=>sB=e)),await mU,Qt(t)}async function G0e(t,e,r,i){if(!t)return null;const s=t.spatialReference;return N5()||Uf(s,e)?Sw(t,e):sB?sB.projectGeometry(t,e,r,i):(await Promise.race([FVe(i),TO(i)]),G0e(t,e,r,i))}let zi=class extends xe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=lu(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,s,n,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(DVe(o)){const a=U0e(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=lu(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:kS(async n=>{try{const o=await G0e(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(vn(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],s=(n,o)=>n!=null?o!=null?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==Le.Local)&&(e=e.filter(({viewingMode:i})=>i!==Le.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(n!=null){const o=n.constraints!=null?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new UVe;for(const s of e)if(this._collectCollection(s,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{ys(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};u([p()],zi.prototype,"required",void 0),u([p({constructOnly:!0})],zi.prototype,"map",void 0),u([p({constructOnly:!0})],zi.prototype,"getSpatialReferenceSupport",void 0),u([p()],zi.prototype,"defaultSpatialReference",void 0),u([p()],zi.prototype,"userSpatialReference",void 0),u([p()],zi.prototype,"sourcePreloadCount",void 0),u([p()],zi.prototype,"priorityCollection",void 0),u([p()],zi.prototype,"requiresExtentInSpatialReference",void 0),u([p()],zi.prototype,"suspended",void 0),u([p({readOnly:!0})],zi.prototype,"ready",null),u([p({readOnly:!0})],zi.prototype,"heightModelInfoReady",null),u([p({readOnly:!0})],zi.prototype,"spatialReference",null),u([p({readOnly:!0})],zi.prototype,"extent",null),u([p({readOnly:!0})],zi.prototype,"heightModelInfo",null),u([p({readOnly:!0})],zi.prototype,"vcsWkid",null),u([p({readOnly:!0})],zi.prototype,"latestVcsWkid",null),u([p({readOnly:!0})],zi.prototype,"viewingMode",null),u([p({readOnly:!0})],zi.prototype,"tileInfo",null),u([p({readOnly:!0})],zi.prototype,"mapCollections",null),u([p({readOnly:!0})],zi.prototype,"_allLayers",null),u([p({readOnly:!0})],zi.prototype,"_spatialReferenceTask",null),u([p({readOnly:!0})],zi.prototype,"_tileInfoTask",null),u([p({readOnly:!0})],zi.prototype,"_heightModelInfoTask",null),u([p({readOnly:!0})],zi.prototype,"_extentCandidatesTask",null),u([p()],zi.prototype,"_extentTask",null),u([p()],zi.prototype,"_projectExtentTask",void 0),zi=u([R("esri.views.support.DefaultsFromMap")],zi);let UVe=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var l3;let Pt=l3=class extends M5(Ls.EventedMixin(t5(xe))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new mO({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:zVe}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new xb,this.analyses=new oS,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Mt,this.magnifier=new S0e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new lS,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new OVe,this.navigation=new M0e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new vVe(this),this.persistableViewModels=new Mt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(ue(()=>this.preconditionsReady,e=>{var r,i;e?(this._currentSpatialReference=this.spatialReference,l3.views.add(this)):(this._currentSpatialReference=null,l3.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},jr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,K2(()=>this.ready)))),this.basemapView=new a0({view:this}),this.layerViewManager=new hVe({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new nd({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ue(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ue(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ue(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([ue(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const s=ja(()=>t=lu(t));t=kS(async n=>{try{await sO(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}Q.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(l3.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Pe(this.graphics),this.analyses=Pe(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Pe(this.analysisViewManager),this.toolViewManager=Pe(this.toolViewManager),this.layerViewManager=Pe(this.layerViewManager),this.basemapView=Pe(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=Pe(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Q.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new zi({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Pg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(Q.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Pg.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Tn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new U("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&Q.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(xh(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Pt.views=new Mt,u([p()],Pt.prototype,"_userSpatialReference",void 0),u([p()],Pt.prototype,"activeTool",null),u([p({readOnly:!0})],Pt.prototype,"allLayerViews",void 0),u([p()],Pt.prototype,"groundView",void 0),u([p()],Pt.prototype,"animation",null),u([p()],Pt.prototype,"basemapView",void 0),u([p()],Pt.prototype,"center",null),u([p({readOnly:!0})],Pt.prototype,"_defaultsFromMapSettings",null),u([p()],Pt.prototype,"defaultsFromMap",null),u([p()],Pt.prototype,"fatalError",void 0),u([p({type:_r})],Pt.prototype,"extent",null),u([p(tN(xb,"graphics"))],Pt.prototype,"graphics",void 0),u([p(tN(oS,"analyses"))],Pt.prototype,"analyses",void 0),u([p({readOnly:!0,type:Tw})],Pt.prototype,"heightModelInfo",null),u([p({readOnly:!0})],Pt.prototype,"interacting",null),u([p({readOnly:!0})],Pt.prototype,"navigating",null),u([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Pt.prototype,"preconditionsReady",null),u([p({readOnly:!0})],Pt.prototype,"typeSpecificPreconditionsReady",void 0),u([p({type:Mt,readOnly:!0})],Pt.prototype,"layerViews",void 0),u([p()],Pt.prototype,"resolution",null),u([p({type:S0e})],Pt.prototype,"magnifier",void 0),u([p({value:null,type:Qpe})],Pt.prototype,"map",null),u([p()],Pt.prototype,"padding",void 0),u([p({readOnly:!0})],Pt.prototype,"ready",void 0),u([p({type:Ge})],Pt.prototype,"spatialReference",null),u([p()],Pt.prototype,"spatialReferenceWarningDelay",void 0),u([p()],Pt.prototype,"stationary",null),u([p({readOnly:!0})],Pt.prototype,"supportsGround",void 0),u([p({type:em})],Pt.prototype,"timeExtent",void 0),u([p({type:lS,nonNullable:!0})],Pt.prototype,"timeReference",void 0),u([p()],Pt.prototype,"tools",null),u([p()],Pt.prototype,"toolViewManager",void 0),u([p({readOnly:!0})],Pt.prototype,"type",void 0),u([p({type:Number})],Pt.prototype,"scale",void 0),u([p({readOnly:!0})],Pt.prototype,"updating",void 0),u([p({readOnly:!0})],Pt.prototype,"initialExtentRequired",void 0),u([p({readOnly:!0})],Pt.prototype,"initialExtent",null),u([p()],Pt.prototype,"cursor",null),u([p({readOnly:!0})],Pt.prototype,"input",void 0),u([p({type:M0e,nonNullable:!0})],Pt.prototype,"navigation",void 0),u([p()],Pt.prototype,"layerViewManager",void 0),u([p()],Pt.prototype,"analysisViewManager",void 0),u([p()],Pt.prototype,"width",void 0),u([p()],Pt.prototype,"height",void 0),u([p({readOnly:!0})],Pt.prototype,"resizing",void 0),u([p({value:null,readOnly:!0})],Pt.prototype,"size",null),u([p({readOnly:!0})],Pt.prototype,"suspended",void 0),u([p({readOnly:!0})],Pt.prototype,"viewEvents",void 0),u([p({readOnly:!0})],Pt.prototype,"persistableViewModels",void 0),u([p()],Pt.prototype,"_isValid",void 0),u([p()],Pt.prototype,"_readyCycleForced",void 0),u([p()],Pt.prototype,"_currentSpatialReference",void 0),Pt=l3=u([R("esri.views.View")],Pt);const VVe=Pt;function zVe(t){return t.layerViews}let c0=class extends RD{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=yo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new U("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=gu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};u([p({readOnly:!0})],c0.prototype,"done",null),u([p({readOnly:!0,type:String})],c0.prototype,"state",void 0),u([p()],c0.prototype,"target",void 0),c0=u([R("esri.views.ViewAnimation")],c0),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(c0||(c0={}));const uS=c0,DE=()=>ae(()=>import("./TileLayerView3D-f258c8af.js"),["assets/TileLayerView3D-f258c8af.js","assets/LayerView3D-35b6a341.js","assets/TiledLayerView3D-912559d3.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/MapServiceLayerViewHelper-a99bca8e.js","assets/floorFilterUtils-080a7cd2.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/sublayerUtils-914a1241.js","assets/drapedUtils-c50b7dbc.js"]),Pee=()=>ae(()=>import("./ElevationLayerView3D-3da80217.js"),["assets/ElevationLayerView3D-3da80217.js","assets/LayerView3D-35b6a341.js","assets/TiledLayerView3D-912559d3.js","assets/LayerView-6a87ca6a.js"]),Mee={"base-dynamic":()=>ae(()=>import("./BaseDynamicLayerView3D-5d103c30.js"),["assets/BaseDynamicLayerView3D-5d103c30.js","assets/DynamicLayerView3D-ddd55a2a.js","assets/LayerView3D-35b6a341.js","assets/projectExtentUtils-738de624.js","assets/ImageMaterial-7ca5205d.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),"base-elevation":Pee,"base-tile":DE,"bing-maps":DE,"building-scene":()=>ae(()=>import("./BuildingSceneLayerView3D-a8be51f1.js"),["assets/BuildingSceneLayerView3D-a8be51f1.js","assets/BuildingGroupSublayer-f562be44.js","assets/BuildingComponentSublayer-44d31a17.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/I3SMeshView3D-30d3c0b5.js","assets/I3SOverrides-3ea0f945.js","assets/I3SNode-4e1dfdcf.js","assets/meshFeatureSet-f5696b71.js","assets/MeshGeoreferencedRelativeVertexSpace-13b8f062.js","assets/MeshLocalVertexSpace-25f04cf2.js","assets/georeference-e124cffe.js","assets/External-fd46e735.js","assets/FeatureLayerView3D-db75e83a.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/SceneModification-f4ed142b.js","assets/SceneLayerWorker-b2e5cad6.js","assets/I3SQueryFeatureStore-88fec069.js","assets/DefinitionExpressionSceneLayerView-253f074d.js"]),csv:()=>ae(()=>import("./CSVLayerView3D-fae9ae8e.js"),["assets/CSVLayerView3D-fae9ae8e.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),dimension:()=>ae(()=>import("./DimensionLayerView3D-a12cbfef.js"),["assets/DimensionLayerView3D-a12cbfef.js","assets/LayerView3D-35b6a341.js","assets/LayerView-6a87ca6a.js"]),elevation:Pee,feature:()=>ae(()=>import("./FeatureLayerView3D-db75e83a.js"),["assets/FeatureLayerView3D-db75e83a.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),geojson:()=>ae(()=>import("./GeoJSONLayerView3D-035a7bc0.js"),["assets/GeoJSONLayerView3D-035a7bc0.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),graphics:()=>ae(()=>import("./GraphicsLayerView3D-72730302.js"),["assets/GraphicsLayerView3D-72730302.js","assets/LayerView3D-35b6a341.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/GraphicsProcessor-9f742212.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/projectExtentUtils-738de624.js","assets/LayerView-6a87ca6a.js"]),group:()=>ae(()=>import("./GroupLayerView-e63fff2c.js"),["assets/GroupLayerView-e63fff2c.js","assets/LayerView-6a87ca6a.js"]),imagery:()=>ae(()=>import("./ImageryLayerView3D-f2d86bf8.js"),["assets/ImageryLayerView3D-f2d86bf8.js","assets/DynamicLayerView3D-ddd55a2a.js","assets/LayerView3D-35b6a341.js","assets/projectExtentUtils-738de624.js","assets/ImageMaterial-7ca5205d.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),"integrated-mesh":()=>ae(()=>import("./IntegratedMeshLayerView3D-4251e8fe.js"),["assets/IntegratedMeshLayerView3D-4251e8fe.js","assets/I3SMeshView3D-30d3c0b5.js","assets/I3SOverrides-3ea0f945.js","assets/I3SNode-4e1dfdcf.js","assets/meshFeatureSet-f5696b71.js","assets/MeshGeoreferencedRelativeVertexSpace-13b8f062.js","assets/MeshLocalVertexSpace-25f04cf2.js","assets/georeference-e124cffe.js","assets/External-fd46e735.js","assets/FeatureLayerView3D-db75e83a.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/SceneModification-f4ed142b.js","assets/SceneLayerWorker-b2e5cad6.js"]),"line-of-sight":()=>ae(()=>import("./LineOfSightLayerView3D-bc97676e.js"),["assets/LineOfSightLayerView3D-bc97676e.js","assets/LayerView3D-35b6a341.js","assets/LayerView-6a87ca6a.js"]),"map-image":()=>ae(()=>import("./MapImageLayerView3D-508aec1b.js"),["assets/MapImageLayerView3D-508aec1b.js","assets/DynamicLayerView3D-ddd55a2a.js","assets/LayerView3D-35b6a341.js","assets/projectExtentUtils-738de624.js","assets/ImageMaterial-7ca5205d.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/ExportImageParameters-138c3b6a.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-914a1241.js","assets/MapServiceLayerViewHelper-a99bca8e.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/drapedUtils-c50b7dbc.js"]),media:()=>ae(()=>import("./MediaLayerView3D-f91ee055.js"),["assets/MediaLayerView3D-f91ee055.js","assets/MediaElementView-9fa8277b.js","assets/normalizeUtilsSync-a95ff601.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/LayerView3D-35b6a341.js","assets/ImageMaterial-7ca5205d.js","assets/LayerView-6a87ca6a.js"]),"ogc-feature":()=>ae(()=>import("./OGCFeatureLayerView3D-d4ae6865.js"),["assets/OGCFeatureLayerView3D-d4ae6865.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),"open-street-map":DE,"oriented-imagery":()=>ae(()=>import("./FeatureLayerView3D-db75e83a.js"),["assets/FeatureLayerView3D-db75e83a.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),"point-cloud":()=>ae(()=>import("./PointCloudLayerView3D-09f22bbe.js").then(t=>t.P),["assets/PointCloudLayerView3D-09f22bbe.js","assets/LayerView3D-35b6a341.js","assets/PointCloudWorkerUtil-e8894da1.js","assets/PointCloudUniqueValueRenderer-3cdf7e92.js","assets/PopupSceneLayerView-59f7764a.js","assets/LayerView-6a87ca6a.js"]),voxel:()=>ae(()=>import("./VoxelLayerView3D-44d200d6.js"),["assets/VoxelLayerView3D-44d200d6.js","assets/LayerView3D-35b6a341.js","assets/PopupSceneLayerView-59f7764a.js","assets/LayerView-6a87ca6a.js"]),route:()=>ae(()=>import("./RouteLayerView3D-5a1e3f07.js"),["assets/RouteLayerView3D-5a1e3f07.js","assets/Stop-791a5252.js","assets/LayerView3D-35b6a341.js","assets/GraphicsProcessor-9f742212.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/projectExtentUtils-738de624.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ae(()=>import("./SceneLayerView3D-86fd0f68.js"),["assets/SceneLayerView3D-86fd0f68.js","assets/I3SOverrides-3ea0f945.js","assets/I3SNode-4e1dfdcf.js","assets/meshFeatureSet-f5696b71.js","assets/MeshGeoreferencedRelativeVertexSpace-13b8f062.js","assets/MeshLocalVertexSpace-25f04cf2.js","assets/georeference-e124cffe.js","assets/External-fd46e735.js","assets/FeatureLayerView3D-db75e83a.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/I3SMeshView3D-30d3c0b5.js","assets/SceneModification-f4ed142b.js","assets/SceneLayerWorker-b2e5cad6.js","assets/SceneLayerView-b83fd681.js","assets/DefinitionExpressionSceneLayerView-253f074d.js","assets/I3SQueryFeatureStore-88fec069.js","assets/PopupSceneLayerView-59f7764a.js"]):ae(()=>import("./SceneLayerGraphicsView3D-37681bd9.js"),["assets/SceneLayerGraphicsView3D-37681bd9.js","assets/I3SOverrides-3ea0f945.js","assets/I3SNode-4e1dfdcf.js","assets/meshFeatureSet-f5696b71.js","assets/MeshGeoreferencedRelativeVertexSpace-13b8f062.js","assets/MeshLocalVertexSpace-25f04cf2.js","assets/georeference-e124cffe.js","assets/External-fd46e735.js","assets/FeatureLayerView3D-db75e83a.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/SceneLayerView-b83fd681.js","assets/DefinitionExpressionSceneLayerView-253f074d.js","assets/PopupSceneLayerView-59f7764a.js"]),stream:()=>ae(()=>import("./StreamLayerView3D-eb878a89.js"),["assets/StreamLayerView3D-eb878a89.js","assets/StreamFeatureManager-b356a5cc.js","assets/createConnection-bf269f20.js","assets/query-dae0ecc4.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/LayerView-6a87ca6a.js"]),tile:DE,"imagery-tile":()=>ae(()=>import("./ImageryTileLayerView3D-7948c30e.js"),["assets/ImageryTileLayerView3D-7948c30e.js","assets/LayerView3D-35b6a341.js","assets/TiledLayerView3D-912559d3.js","assets/rasterProjectionHelper-00227a09.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/drapedUtils-c50b7dbc.js"]),"vector-tile":()=>ae(()=>import("./VectorTileLayerView3D-91a2e8f6.js"),["assets/VectorTileLayerView3D-91a2e8f6.js","assets/Rect-98da58d6.js","assets/pbf-261a804a.js","assets/rasterizingUtils-3cc107a1.js","assets/TileInfoView-d1d8c36f.js","assets/definitions-411d1582.js","assets/number-e491b09e.js","assets/GeometryUtils-0258f920.js","assets/StyleRepository-5f1070d6.js","assets/colorUtils-c0f43caf.js","assets/TileClipper-ae6eca9e.js","assets/LayerView3D-35b6a341.js","assets/TiledLayerView3D-912559d3.js","assets/LayerView-6a87ca6a.js"]),wcs:()=>ae(()=>import("./ImageryTileLayerView3D-7948c30e.js"),["assets/ImageryTileLayerView3D-7948c30e.js","assets/LayerView3D-35b6a341.js","assets/TiledLayerView3D-912559d3.js","assets/rasterProjectionHelper-00227a09.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/drapedUtils-c50b7dbc.js"]),"web-tile":DE,wfs:()=>ae(()=>import("./WFSLayerView3D-8e996d7a.js"),["assets/WFSLayerView3D-8e996d7a.js","assets/FeatureLayerViewBase3D-dfe91748.js","assets/FeatureLikeLayerView3D-acbe9118.js","assets/dehydratedFeatureComparison-dd199238.js","assets/queryForSymbologySnapping-a78fbc0c.js","assets/elevationInfoUtils-f78c6364.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-6e2ab665.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-320a5b92.js","assets/generateRendererUtils-1b6e1b3d.js","assets/FeatureStore-a4339c70.js","assets/BoundsStore-17c4899d.js","assets/projectExtentUtils-738de624.js","assets/LayerView3D-35b6a341.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/EventedSet-961faba7.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),wms:()=>ae(()=>import("./WMSLayerView3D-329dc273.js"),["assets/WMSLayerView3D-329dc273.js","assets/DynamicLayerView3D-ddd55a2a.js","assets/LayerView3D-35b6a341.js","assets/projectExtentUtils-738de624.js","assets/ImageMaterial-7ca5205d.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js","assets/ExportWMSImageParameters-565edc8b.js"]),wmts:()=>ae(()=>import("./WMTSLayerView3D-81f06070.js"),["assets/WMTSLayerView3D-81f06070.js","assets/LayerView3D-35b6a341.js","assets/TiledLayerView3D-912559d3.js","assets/LayerView-6a87ca6a.js","assets/RefreshableLayerView-b12aaf50.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function kVe(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new U(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const Iee={hasLayerViewModule:t=>Mee[t.type]!=null,importLayerView:t=>{const e=Mee[t.type];if(e==null)throw kVe(t);return e(t)}},$ee="analyses-owner-handles";var YT,G1;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(YT||(YT={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(G1||(G1={}));let i1=class extends xO{constructor(e){super(e),this._allAnalysisViews=new Mt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Lee(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Dr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Dr()),this._attachedToViewResolver=Lee()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===G1.REMOVED)throw new U("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),$ee)}_disconnectOwners(){this.handles.remove($ee),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:YT.PENDING,list:G1.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=kS(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=G1.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=G1.REMOVED,this._scheduleUpdate()):Q.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=US(()=>this._update()))}_update(){this._scheduledUpdateHandle=Di(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===G1.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case YT.PENDING:e.createAnalysisViewTask=lu(e.createAnalysisViewTask);break;case YT.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Pe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(vn(r))throw this._creatingViewCount-=1,Dr("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(vn(r))throw this._creatingViewCount-=1,o.destroy(),Dr("AnalysisView creation aborted");return e.view=o,e.state.view=YT.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ae(()=>import("./AreaMeasurementAnalysisView3D-02957fa6.js").then(r=>r.A),["assets/AreaMeasurementAnalysisView3D-02957fa6.js","assets/UnitNormalizer-a159bea1.js","assets/Segment-ed0cae20.js","assets/unitFormatUtils-5d385ad6.js","assets/LineVisualElement-3e6cbb28.js","assets/elevationInfoUtils-f78c6364.js","assets/geometryEngine-a544971c.js","assets/geometryEngineBase-df7c28c6.js","assets/hydrated-795c5e0d.js","assets/EditGeometryOperations-0de05d6f.js"]);case"dimension":return ae(()=>import("./DimensionAnalysisView3D-7ad33315.js").then(r=>r.D),["assets/DimensionAnalysisView3D-7ad33315.js","assets/LineVisualElement-3e6cbb28.js","assets/LengthDimension-90f987dc.js","assets/Segment-ed0cae20.js","assets/unitFormatUtils-5d385ad6.js","assets/elevationInfoUtils-f78c6364.js","assets/analysisViewUtils-c10353de.js","assets/ImageMaterial-7ca5205d.js","assets/Factory-aa309fcb.js","assets/RightAngleQuadVisualElement-7fc64cfe.js","assets/VisualElementResources-a37eddeb.js","assets/PointVisualElement-93436d4e.js","assets/EditGeometryOperations-0de05d6f.js","assets/dehydratedFeatureComparison-dd199238.js"]);case"direct-line-measurement":return ae(()=>import("./DirectLineMeasurementAnalysisView3D-ca5911d1.js").then(r=>r.D),["assets/DirectLineMeasurementAnalysisView3D-ca5911d1.js","assets/UnitNormalizer-a159bea1.js","assets/Segment-ed0cae20.js","assets/unitFormatUtils-5d385ad6.js","assets/LineVisualElement-3e6cbb28.js","assets/elevationInfoUtils-f78c6364.js","assets/geometryEngine-a544971c.js","assets/geometryEngineBase-df7c28c6.js","assets/hydrated-795c5e0d.js","assets/RightAngleQuadVisualElement-7fc64cfe.js","assets/VisualElementResources-a37eddeb.js"]);case"line-of-sight":return ae(()=>import("./LineOfSightAnalysisView3D-7ffe6904.js"),["assets/LineOfSightAnalysisView3D-7ffe6904.js","assets/LineVisualElement-3e6cbb28.js","assets/LineOfSightAnalysisTarget-6c2bfbf2.js","assets/elevationInfoUtils-f78c6364.js","assets/analysisViewUtils-c10353de.js","assets/ImageMaterial-7ca5205d.js","assets/PointVisualElement-93436d4e.js","assets/VisualElementResources-a37eddeb.js"]);case"slice":return ae(()=>import("./SliceAnalysisView3D-8d2f724f.js").then(r=>r.S),["assets/SliceAnalysisView3D-8d2f724f.js","assets/LineVisualElement-3e6cbb28.js","assets/BuildingComponentSublayer-44d31a17.js","assets/analysisViewUtils-c10353de.js","assets/ImageMaterial-7ca5205d.js","assets/Factory-aa309fcb.js"])}}};function Lee(){const t=yo();return t.promise.catch(()=>{}),t}u([p()],i1.prototype,"updating",null),u([p({constructOnly:!0})],i1.prototype,"view",void 0),u([p()],i1.prototype,"_allAnalysisViews",void 0),u([p()],i1.prototype,"_creatingViewCount",void 0),i1=u([R("esri.views.3d.analysis.AnalysisViewManager3D")],i1);const BVe=i1;let Lm=class extends xe{constructor(e){super(e),this.collision=new c3,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Le.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Le.Local?this._set("altitude",e):Q.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?_e(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return _e(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Le.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=gU)=>(i.min=Mo.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?K$([[4e3,Mo.max],[1e4,Ut(88)],[6e6,Ut(88)]]):()=>Mo.max;return(r,i=gU)=>(i.min=Mo.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?K$([[4e3,Mo.max],[5e4,Ut(88)],[6e6,Ut(88)],[2e7,Mo.min]]):K$([[3e5,Mo.max],[3e6,Ut(88)],[6e6,Ut(88)],[2e7,Mo.min]]);return(r,i=gU)=>(i.min=Mo.min,i.max=e(r),i)}};function GVe(t){return{min:-2e5,max:4*t.radius}}u([p()],Lm.prototype,"altitude",null),u([p({readOnly:!0})],Lm.prototype,"collision",void 0),u([p()],Lm.prototype,"distance",void 0),u([p({readOnly:!0})],Lm.prototype,"minimumPoiDistance",void 0),u([p()],Lm.prototype,"tilt",void 0),u([p({constructOnly:!0})],Lm.prototype,"mode",void 0),Lm=u([R("esri.views.3d.state.Constraints")],Lm);const Dee=GVe(sr),Mo={min:Ut(.5),max:Ut(179.5)},gU={min:0,max:0};let c3=class extends xe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([p({type:Boolean})],c3.prototype,"enabled",void 0),u([p({type:Number})],c3.prototype,"elevationMargin",void 0),c3=u([R("esri.views.3d.state.Constraints.CollisionConstraint")],c3);let JT=class extends xe{constructor(){super(...arguments),this.min=Dee.min,this.max=Dee.max}};u([p({type:Number})],JT.prototype,"min",void 0),u([p({type:Number})],JT.prototype,"max",void 0),JT=u([R("esri.views.3d.constraints.AltitudeConstraint")],JT);let Jm=class extends xe{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};u([p({type:Number,value:1e-8})],Jm.prototype,"near",null),u([yr("near")],Jm.prototype,"castNear",null),u([p({type:Number,value:1e-8})],Jm.prototype,"far",null),u([yr("far")],Jm.prototype,"castFar",null),u([p({type:["auto","manual"]})],Jm.prototype,"mode",void 0),Jm=u([R("esri.views.3d.constraints.ClipDistanceConstraint")],Jm);const nB={min:qa(Mo.min),max:qa(Mo.max)};let j1=class extends xe{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return _e(e,nB.min,nB.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([p({type:["auto","manual"]})],j1.prototype,"mode",void 0),u([p({type:Number,value:nB.max})],j1.prototype,"max",null),u([yr("max")],j1.prototype,"castMax",null),j1=u([R("esri.views.3d.constraints.TiltConstraint")],j1);let H1=class extends xe{constructor(){super(...arguments),this.tilt=new j1,this.altitude=new JT,this.clipDistance=new Jm}};u([p({type:j1})],H1.prototype,"tilt",void 0),u([p({type:JT})],H1.prototype,"altitude",void 0),u([p({type:Jm})],H1.prototype,"clipDistance",void 0),H1=u([R("esri.views.3d.constraints.Constraints")],H1);var oB;let Fu=oB=class extends de{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new oB(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([p({readOnly:!0,type:["sun"],json:{write:!0}})],Fu.prototype,"type",void 0),u([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],Fu.prototype,"date",void 0),u([Se("date",["datetime"])],Fu.prototype,"readDate",null),u([De("date")],Fu.prototype,"writeDate",null),u([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Fu.prototype,"directShadowsEnabled",void 0),u([Se("directShadowsEnabled",["directShadows"])],Fu.prototype,"readDirectShadowsEnabled",null),u([De("directShadowsEnabled")],Fu.prototype,"writedirectShadowsEnabled",null),u([p({type:Number,json:{write:!0}})],Fu.prototype,"displayUTCOffset",void 0),u([De("displayUTCOffset")],Fu.prototype,"writeDisplayUTCOffset",null),Fu=oB=u([R("esri.webscene.SunLighting")],Fu);const RO=Fu;var sT;const j0e="esri.views.3d.environment.SunLighting",WP=Q.getLogger(j0e);let Wp=sT=class extends Ls.EventedMixin(RO){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return Nd(WP,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Nd(WP,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Nd(WP,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Nd(WP,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new sT(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=sT.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=sT.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(ZP.target=this,ZP.timezoneOffset=s,this.emit("timezone-will-change",ZP),ZP.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new sT({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],Wp.prototype,"cameraTrackingEnabled",void 0),u([p({type:Boolean})],Wp.prototype,"ambientOcclusionEnabled",null),u([p({type:Boolean})],Wp.prototype,"waterReflectionEnabled",null),u([p({type:Date})],Wp.prototype,"defaultDate",null),u([p({type:Date})],Wp.prototype,"date",null),Wp=sT=u([R(j0e)],Wp),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(Wp||(Wp={}));const ZP={target:null,timezoneOffset:0},u0=Wp;var aB;let u3=aB=class extends de{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new aB(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([p({readOnly:!0,type:["virtual"],json:{write:!0}})],u3.prototype,"type",void 0),u([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],u3.prototype,"directShadowsEnabled",void 0),u3=aB=u([R("esri.webscene.VirtualLighting")],u3);const Q5=u3;var sL;const H0e="esri.views.3d.environment.VirtualLighting",XP=Q.getLogger(H0e);let nT=sL=class extends Ls.EventedMixin(Q5){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return Nd(XP,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Nd(XP,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Nd(XP,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Nd(XP,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new sL({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new sL(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([p({type:Boolean})],nT.prototype,"ambientOcclusionEnabled",null),u([p({type:Boolean})],nT.prototype,"waterReflectionEnabled",null),u([p({type:Boolean})],nT.prototype,"cameraTrackingEnabled",void 0),nT=sL=u([R(H0e)],nT);const h3=nT,jVe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:u0,virtual:h3}};var lB;let SA=lB=class extends xe{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new lB({quality:this.quality})}};u([p({type:["low","high"],value:"low"})],SA.prototype,"quality",null),SA=lB=u([R("esri.views.3d.environment.SceneViewAtmosphere")],SA);var cB;let d3=cB=class extends de{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new cB({cloudCover:this.cloudCover})}};u([et({sunny:"sunny"})],d3.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d3.prototype,"cloudCover",void 0),d3=cB=u([R("esri.views.3d.environment.SunnyWeather")],d3);const uB=d3;var hB;let p3=hB=class extends de{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new hB({cloudCover:this.cloudCover})}};u([et({cloudy:"cloudy"})],p3.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],p3.prototype,"cloudCover",void 0),p3=hB=u([R("esri.views.3d.environment.CloudyWeather")],p3);const HVe=p3;var dB;let f3=dB=class extends de{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new dB({fogStrength:this.fogStrength})}};u([et({foggy:"foggy"})],f3.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f3.prototype,"fogStrength",void 0),f3=dB=u([R("esri.views.3d.environment.FoggyWeather")],f3);const qVe=f3;var pB;let oT=pB=class extends de{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new pB({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([et({rainy:"rainy"})],oT.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],oT.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],oT.prototype,"precipitation",void 0),oT=pB=u([R("esri.views.3d.environment.RainyWeather")],oT);const WVe=oT;var fB;let s1=fB=class extends de{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new fB({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([et({snowy:"snowy"})],s1.prototype,"type",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],s1.prototype,"cloudCover",void 0),u([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],s1.prototype,"precipitation",void 0),u([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],s1.prototype,"snowCover",void 0),s1=fB=u([R("esri.views.3d.environment.SnowyWeather")],s1);const ZVe=s1,q0e={key:"type",base:uB,typeMap:{sunny:uB,cloudy:HVe,rainy:WVe,snowy:ZVe,foggy:qVe}},XVe=Object.keys(q0e.typeMap);function YVe(t,e){return!!XVe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const lf=1e4,JVe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:RO,virtual:Q5}};let nL=class extends de{constructor(e){super(e)}clone(){}};u([p({readOnly:!0,json:{read:!1}})],nL.prototype,"type",void 0),nL=u([R("esri.webscene.background.Background")],nL);const W0e=nL;var mB;const QVe={...jg,nonNullable:!0};let m3=mB=class extends W0e{constructor(t){super(t),this.type="color",this.color=new ke([0,0,0,1])}clone(){return new mB(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([et({color:"color"},{readOnly:!0})],m3.prototype,"type",void 0),u([p(QVe)],m3.prototype,"color",void 0),m3=mB=u([R("esri.webscene.background.ColorBackground")],m3);const Z0e=m3,Nee={base:W0e,key:"type",typeMap:{color:Z0e}};function KVe(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const eze={types:Nee,json:{read:KVe(Nee),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var gB;const X0e="esri.webscene.Environment",tze=Q.getLogger(X0e),Fee=(t,e,r)=>({enabled:!r||!r.isPresentation});let h0=gB=class extends de{constructor(t){super(t),this.lighting=new RO,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){YVe(t==null?void 0:t.type,tze)&&this._set("weather",t)}clone(){return new gB(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Q5.prototype.clone.call(this.lighting):RO.prototype.clone.call(this.lighting),background:K(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([p({types:JVe,nonNullable:!0,json:{write:!0}})],h0.prototype,"lighting",void 0),u([p(eze)],h0.prototype,"background",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Fee}}})],h0.prototype,"atmosphereEnabled",void 0),u([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Fee}}})],h0.prototype,"starsEnabled",void 0),u([p({types:q0e,nonNullable:!0,json:{write:!0},value:new uB})],h0.prototype,"weather",null),h0=gB=u([R(X0e)],h0);const Y0e=h0;var g3;let aT=g3=class extends Y0e{constructor(t){super(t),this.atmosphere=new SA,this.lighting=new u0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new g3({...e,lighting:e.lighting?e.lighting.type==="virtual"?h3.fromWebsceneLighting(e.lighting):u0.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,r;return t?t instanceof u0||t instanceof h3?t:t instanceof RO?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new u0({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof Q5?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new h3({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):tp(jVe,t):new u0}clone(){return new g3({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:K(this.background)})}cloneWithWebsceneEnvironment(t){return new g3({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:K(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):u0.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):h3.fromWebsceneLighting(t.lighting);default:return t.lighting,u0.fromWebsceneLighting(t.lighting)}}};u([p({type:SA,json:{read:!1},nonNullable:!0})],aT.prototype,"atmosphere",void 0),u([p({nonNullable:!0})],aT.prototype,"lighting",void 0),u([yr("lighting")],aT.prototype,"castLighting",null),aT=g3=u([R("esri.views.3d.environment.SceneViewEnvironment")],aT);const lT=aT;var Jo;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Jo||(Jo={}));function cn(t,e){return t[0]=e[0],t[1]=e[1],t}function nr(t,e,r){return t[0]=e,t[1]=r,t}function Cd(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function pf(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function JW(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function J0e(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function rze(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function ize(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function sze(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function nze(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function oze(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function oc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function aze(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function Wb(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function mN(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function QW(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Q0e(t){const e=t[0],r=t[1];return e*e+r*r}function KW(t,e){return t[0]=-e[0],t[1]=-e[1],t}function K0e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function PO(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Js(t,e){return t[0]*e[0]+t[1]*e[1]}function lze(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function eh(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function cze(t,e){e=e||1;const r=2*mR()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function e_e(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function n1(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function uze(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function hze(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function dze(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function pze(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function fze(t){return"vec2("+t[0]+", "+t[1]+")"}function t_e(t,e){return t[0]===e[0]&&t[1]===e[1]}function r_e(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=Xa();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function mze(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const gze=QW,i_e=pf,yze=JW,_ze=J0e,s_e=Wb,vze=mN,bze=Q0e;Object.freeze(Object.defineProperty({__proto__:null,add:Cd,angle:pze,ceil:rze,copy:cn,cross:lze,dist:s_e,distance:Wb,div:_ze,divide:J0e,dot:Js,equals:r_e,exactEquals:t_e,floor:ize,inverse:K0e,len:gze,length:QW,lerp:eh,max:nze,min:sze,mul:yze,multiply:JW,negate:KW,normalize:PO,projectAndScale:mze,random:cze,rotate:dze,round:oze,scale:oc,scaleAndAdd:aze,set:nr,sqrDist:vze,sqrLen:bze,squaredDistance:mN,squaredLength:Q0e,str:fze,sub:i_e,subtract:pf,transformMat2:e_e,transformMat2d:n1,transformMat3:uze,transformMat4:hze},Symbol.toStringTag,{value:"Module"}));function eZ(t){return _e((t-1e5)/(1e6-1e5),0,1)}const yB=1e4,wze=.085,A0=1e5;let xze=class{};const ei=xze;function b(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(b||(b={}));var E;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(E||(E={}));var Ps;function Of(t,e){switch(e.textureCoordinateType){case Ps.Default:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Ps.Compressed:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Ps.Atlas:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(E.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Ps.None:return void t.vertex.code.add(b`void forwardTextureCoordinates() {}`);case Ps.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Ps||(Ps={}));function Tc(t){t.code.add(b`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function fu(t){t.include(Tc),t.code.add(b`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function K5(t){t.fragment.code.add(b`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Qr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Qr||(Qr={}));let cs=class{constructor(e,r,i,s,n=null){this.name=e,this.type=r,this.arraySize=n,this.bind={[Qr.Pass]:null,[Qr.Draw]:null},i!=null&&s!=null&&(this.bind[i]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},zt=class extends cs{constructor(e,r){super(e,"vec3",Qr.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}};function Wg(t){t.uniforms.add(new zt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function tm(t){t.uniforms.add(new zt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function gN(t){Wg(t.fragment),tm(t.fragment),t.fragment.code.add(b`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Sr=class extends cs{constructor(e,r){super(e,"vec2",Qr.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},ir=class extends cs{constructor(e,r){super(e,"vec4",Qr.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},Oe=class extends cs{constructor(e,r){super(e,"float",Qr.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}},Ni=class extends cs{constructor(e,r){super(e,"mat4",Qr.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const ma=Yt();let Tze=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function tt(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new Tze(`${e} at ${r}`)}}function Bw(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function Uee(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],h=(i[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function YP(t,e,r,i,s,n=Ue()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function Vee(t,e,r,i,s){ma[0]=t[0],ma[1]=t[1],ma[2]=t[2],ma[3]=1,eu(ma,ma,e),s.length>2&&(s[2]=-ma[2]),eu(ma,ma,r),tt(ma[3]!==0),s[0]=ma[0]/ma[3],s[1]=ma[1]/ma[3],s[2]=ma[2]/ma[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function Sze(t,e){return Math.log(t)/Math.log(e)}function Eze(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function n_e(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const o_e=Q.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let a_e=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){o_e.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},wr=class extends a_e{constructor(){super(...arguments),this.vertex=new zee,this.fragment=new zee,this.attributes=new Oze,this.varyings=new Rze,this.extensions=new _B,this.constants=new l_e}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?Mze:Pze,c=this.constants.generateSource().concat(n.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}},Cze=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new U(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else o_e.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},Aze=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},zee=class extends a_e{constructor(){super(...arguments),this.uniforms=new Cze,this.code=new Aze,this.constants=new l_e}get builder(){return this}},Oze=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},Rze=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&tt(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,s)=>r.push(e==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}},_B=class vB{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?vB.ALLOWLIST_VERTEX:vB.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};_B.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],_B.ALLOWLIST_VERTEX=[];let l_e=class Zs{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=Zs._numberToFloatStr(i);break;case"int":s=Zs._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${Zs._numberToFloatStr(i[0])},                            ${Zs._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${Zs._numberToFloatStr(i[0])},                            ${Zs._numberToFloatStr(i[1])},                            ${Zs._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${Zs._numberToFloatStr(i[0])},                            ${Zs._numberToFloatStr(i[1])},                            ${Zs._numberToFloatStr(i[2])},                            ${Zs._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${Zs._numberToIntStr(i[0])},                             ${Zs._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${Zs._numberToIntStr(i[0])},                             ${Zs._numberToIntStr(i[1])},                             ${Zs._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${Zs._numberToIntStr(i[0])},                             ${Zs._numberToIntStr(i[1])},                             ${Zs._numberToIntStr(i[2])},                             ${Zs._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>Zs._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Pze=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,Mze=`precision highp float;
precision highp sampler2D;`;let Je=class extends cs{constructor(e,r){super(e,"sampler2D",Qr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};const EA=Ae(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),yU=3,_U=Ae(yU*parseFloat(65e-8.toFixed(6)),yU*parseFloat(1881e-9.toFixed(6)),yU*parseFloat(85e-9.toFixed(6))),Ize=3996e-9,$ze=Ae(parseFloat(Number(EA[0]+_U[0]).toFixed(6)),parseFloat(Number(EA[1]+_U[1]).toFixed(6)),parseFloat(Number(EA[2]+_U[2]).toFixed(6)));function Lze(t){const e=new wr;e.attributes.add(E.POSITION,"vec2"),e.include(Of,{textureCoordinateType:Ps.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new Ni("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Ni("inverseViewMatrix",(s,n)=>QS(Dze,n.camera.viewMatrix))),r.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new zt("backgroundColor",s=>s.backgroundColor),new Sr("radii",s=>s.radii),new zt("cameraPosition",(s,n)=>n.camera.eye),new ir("heightParameters",s=>s.heightParameters),new Oe("innerFadeDistance",s=>s.innerFadeDistance),new Oe("altitudeFade",s=>s.altitudeFade),new Je("depthTexture",s=>s.depthTexture),new Oe("hazeStrength",s=>s.hazeStrength)),i.constants.add("betaRayleigh","vec3",EA),i.constants.add("betaCombined","vec3",$ze),i.constants.add("betaMie","float",Ize),i.constants.add("scaleHeight","float",wze*A0),Wg(i),e.include(K5),t.haze&&(i.include(fu),i.uniforms.add(new Sr("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(b`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(b`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(b`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?b`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":b`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":b`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?b`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:b`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":b`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?b`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?b`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?b`cameraSpaceRay *= -textureBilinear(vuv0);`:b`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:b`${t.reduced?"":b`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?b`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:b`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":b`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const Dze=ve(),Nze=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:EA,build:Lze},Symbol.toStringTag,{value:"Module"}));let Er=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var xi,Et,be,kf,wt,kd,hS,Ke,Kr,gs,At,Dt,os,St,Xe,Vs,Bs,Tr,Xc,lo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(xi||(xi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Et||(Et={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(be||(be={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(kf||(kf={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(wt||(wt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(kd||(kd={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(hS||(hS={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Ke||(Ke={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Kr||(Kr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(gs||(gs={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(At||(At={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Dt||(Dt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(os||(os={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(St||(St={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Xe||(Xe={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Vs||(Vs={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Bs||(Bs={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Tr||(Tr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Xc||(Xc={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(lo||(lo={}));const vU=33984;var wn,Bc;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(wn||(wn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Bc||(Bc={}));const kee=33306;var ds,Bee,Gee,jee,yN,bB,Hee;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(ds||(ds={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Bee||(Bee={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Gee||(Gee={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(jee||(jee={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(yN||(yN={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(bB||(bB={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Hee||(Hee={}));let Pr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Fe(this._program),this._pipeline=this._configuration=null}reload(e){Fe(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Et.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const br=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.UV0,2],[E.COLOR,3],[E.COLORFEATUREATTRIBUTE,3],[E.SIZE,4],[E.TANGENT,4],[E.AUXPOS1,5],[E.SYMBOLCOLOR,5],[E.AUXPOS2,6],[E.FEATUREATTRIBUTE,6],[E.INSTANCEFEATUREATTRIBUTE,6],[E.INSTANCECOLOR,7],[E.OBJECTANDLAYERIDCOLOR,7],[E.INSTANCEOBJECTANDLAYERIDCOLOR,7],[E.MODEL,8],[E.MODELNORMAL,12],[E.MODELORIGINHI,11],[E.MODELORIGINLO,15]]),Fze=Q.getLogger("esri.views.webgl.checkWebGLError");function Uze(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const c_e=!!oe("enable-feature:webgl-debug");function Wu(){return c_e}function wB(){return c_e}function D0(t){if(Wu()){const e=t.getError();if(e){const r=Uze(t,e),i=new Error().stack;Fze.error(new U("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let Cr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Gt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(Qr.Pass,this),this.bindDraw=r.generateBind(Qr.Draw,this),this._fragmentUniforms=Wu()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(r==null||r.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var gi,Zb,fs,gg,Tl,Vg,dS,Xr,Xb,yg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(gi||(gi={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(Zb||(Zb={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(fs||(fs={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(gg||(gg={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Tl||(Tl={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(Vg||(Vg={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(dS||(dS={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Xr||(Xr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Xb||(Xb={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(yg||(yg={}));function wc(t,e,r=kf.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function bo(t,e,r,i,s=kf.ADD,n=kf.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const tZ={face:kd.BACK,mode:hS.CCW},u_e={face:kd.FRONT,mode:hS.CCW},eF=t=>t===gi.Back?tZ:t===gi.Front?u_e:null,Al={zNear:0,zFar:1},jt={r:!0,g:!0,b:!0,a:!0};function Vze(t){return Wze.intern(t)}function zze(t){return Zze.intern(t)}function kze(t){return Xze.intern(t)}function Bze(t){return Yze.intern(t)}function Gze(t){return Jze.intern(t)}function jze(t){return Qze.intern(t)}function Hze(t){return Kze.intern(t)}function qze(t){return eke.intern(t)}function Ot(t){return tke.intern(t)}let Zg=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function Xg(t){return"["+t.join(",")+"]"}const Wze=new Zg(h_e,t=>({__tag:"Blending",...t}));function h_e(t){return t?Xg([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const Zze=new Zg(d_e,t=>({__tag:"Culling",...t}));function d_e(t){return t?Xg([t.face,t.mode]):null}const Xze=new Zg(p_e,t=>({__tag:"PolygonOffset",...t}));function p_e(t){return t?Xg([t.factor,t.units]):null}const Yze=new Zg(f_e,t=>({__tag:"DepthTest",...t}));function f_e(t){return t?Xg([t.func]):null}const Jze=new Zg(m_e,t=>({__tag:"StencilTest",...t}));function m_e(t){return t?Xg([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const Qze=new Zg(g_e,t=>({__tag:"DepthWrite",...t}));function g_e(t){return t?Xg([t.zNear,t.zFar]):null}const Kze=new Zg(y_e,t=>({__tag:"ColorWrite",...t}));function y_e(t){return t?Xg([t.r,t.g,t.b,t.a]):null}const eke=new Zg(__e,t=>({__tag:"StencilWrite",...t}));function __e(t){return t?Xg([t.mask]):null}const tke=new Zg(rke,t=>({blending:Vze(t.blending),culling:zze(t.culling),polygonOffset:kze(t.polygonOffset),depthTest:Bze(t.depthTest),stencilTest:Gze(t.stencilTest),depthWrite:jze(t.depthWrite),colorWrite:Hze(t.colorWrite),stencilWrite:qze(t.stencilWrite)}));function rke(t){return t?Xg([h_e(t.blending),d_e(t.culling),p_e(t.polygonOffset),f_e(t.depthTest),m_e(t.stencilTest),g_e(t.depthWrite),y_e(t.colorWrite),__e(t.stencilWrite)]):null}let ike=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},ske=class extends ei{constructor(){super(...arguments),this.heightParameters=Yt(),this.radii=Ue(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ue(),this.backgroundColor=A()}},y3=class v_e extends Pr{initializeProgram(e){return new Cr(e.rctx,v_e.shader.get().build(this.configuration),br)}initializePipeline(){return this.configuration.reduced?Ot({blending:wc(be.ONE,be.ZERO),depthTest:{func:Kr.ALWAYS},colorWrite:jt}):this.configuration.haze?Ot({blending:bo(be.ONE,be.ZERO,be.ONE_MINUS_SRC_COLOR,be.ONE),colorWrite:jt}):Ot({blending:wc(be.SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.LEQUAL},colorWrite:jt})}};y3.shader=new Er(Nze,()=>ae(()=>import("./ChapmanAtmosphere.glsl-a70d5571.js"),[]));let ha=class extends ei{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function F(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(h){if(this[i]!==h&&(this[i]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof h)}})}}}let _N=class extends ha{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};u([F()],_N.prototype,"haze",void 0),u([F()],_N.prototype,"reduced",void 0);let mo=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new mo(E.POSITION,3,Ke.FLOAT,0,12);new mo(E.POSITION,3,Ke.FLOAT,0,20),new mo(E.UV0,2,Ke.FLOAT,12,20);new mo(E.POSITION,3,Ke.FLOAT,0,32),new mo(E.NORMAL,3,Ke.FLOAT,12,32),new mo(E.UV0,2,Ke.FLOAT,24,32);new mo(E.POSITION,3,Ke.FLOAT,0,16),new mo(E.COLOR,4,Ke.UNSIGNED_BYTE,12,16);const rZ=[new mo(E.POSITION,2,Ke.FLOAT,0,8)],PR=[new mo(E.POSITION,2,Ke.FLOAT,0,16),new mo(E.UV0,2,Ke.FLOAT,8,16)];function qee(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Do(t,e){return t.vertexBuffers[e].byteLength/nke(t.layout[e])}function nke(t){return t[0].stride}function iZ(t,e,r,i,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function sZ(t,e,r,i){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(wt.ARRAY_BUFFER)}function nZ(t){switch(t){case St.ALPHA:case St.LUMINANCE:case St.RED:case St.RED_INTEGER:case Xe.R8:case Xe.R8I:case Xe.R8UI:case Xe.R8_SNORM:case Bs.STENCIL_INDEX8:return 1;case St.LUMINANCE_ALPHA:case St.RG:case St.RG_INTEGER:case Xe.RGBA4:case Xe.R16F:case Xe.R16I:case Xe.R16UI:case Xe.RG8:case Xe.RG8I:case Xe.RG8UI:case Xe.RG8_SNORM:case Xe.RGB565:case Xe.RGB5_A1:case Bs.DEPTH_COMPONENT16:return 2;case St.DEPTH_COMPONENT:case St.RGB:case St.RGB_INTEGER:case Xe.RGB8:case Xe.RGB8I:case Xe.RGB8UI:case Xe.RGB8_SNORM:case Xe.SRGB8:case Bs.DEPTH_COMPONENT24:return 3;case St.DEPTH_STENCIL:case St.DEPTH24_STENCIL8:case St.RGBA:case St.RGBA_INTEGER:case Xe.RGBA8:case Xe.R32F:case Xe.R11F_G11F_B10F:case Xe.RG16F:case Xe.R32I:case Xe.R32UI:case Xe.RG16I:case Xe.RG16UI:case Xe.RGBA8I:case Xe.RGBA8UI:case Xe.RGBA8_SNORM:case Xe.SRGB8_ALPHA8:case Xe.RGB9_E5:case Xe.RGB10_A2UI:case Xe.RGB10_A2:case Bs.DEPTH_STENCIL:case Bs.DEPTH_COMPONENT32F:case Bs.DEPTH24_STENCIL8:return 4;case Bs.DEPTH32F_STENCIL8:return 5;case Xe.RGB16F:case Xe.RGB16I:case Xe.RGB16UI:return 6;case Xe.RG32F:case Xe.RG32I:case Xe.RG32UI:case Xe.RGBA16F:case Xe.RGBA16I:case Xe.RGBA16UI:return 8;case Xe.RGB32F:case Xe.RGB32I:case Xe.RGB32UI:return 12;case Xe.RGBA32F:case Xe.RGBA32I:case Xe.RGBA32UI:return 16;case ds.COMPRESSED_RGB_S3TC_DXT1_EXT:case ds.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case ds.COMPRESSED_RGBA_S3TC_DXT3_EXT:case ds.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case ds.COMPRESSED_R11_EAC:case ds.COMPRESSED_SIGNED_R11_EAC:case ds.COMPRESSED_RGB8_ETC2:case ds.COMPRESSED_SRGB8_ETC2:case ds.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case ds.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case ds.COMPRESSED_RG11_EAC:case ds.COMPRESSED_SIGNED_RG11_EAC:case ds.COMPRESSED_RGBA8_ETC2_EAC:case ds.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const Gw=Q.getLogger("esri.views.webgl.VertexArrayObject");let Sh=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(wn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*lhe}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const r in this._buffers)(e=this._buffers[r])==null||e.dispose(),delete this._buffers[r];this._indexBuffer=Fe(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&Gw.warn("Leaked WebGL VAO")}disposeVAOOnly(){var e,r;this._glName&&(((r=(e=this._context)==null?void 0:e.capabilities)==null?void 0:r.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(wn.VertexArrayObject,this),this._context=DS(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||Gw.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||Gw.error("Vertex buffer is uninitialized!");const a=r[n];a||Gw.error("Vertex element descriptor is empty!"),iZ(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||Gw.error("Vertex buffer dictionary is empty!");for(const i in e){const s=e[i];s||Gw.error("Vertex buffer is uninitialized!");const n=r[i];sZ(this._context,this._locations,s,n)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},up=class extends Sh{};var ar;function xB(t,e,r={}){const i=e===ar.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const s of i){const n=t.getContext(s,r);if(n)return n}return null}function oke(t,e,r={}){const i=b_e(t);for(const s of i){const n=xB(e,s,r);if(n)return n}return null}function b_e(t){if(t==="3d")return[ar.WEBGL2];const e=oe("esri-force-webgl");return e===ar.WEBGL1||e===ar.WEBGL2?[e]:oe("mac")&&oe("chrome")?[ar.WEBGL1,ar.WEBGL2]:[ar.WEBGL2,ar.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(ar||(ar={}));const vp=Q.getLogger("esri.views.webgl.BufferObject");let Lr=class cT{static createIndex(e,r,i){return new cT(e,wt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new cT(e,wt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==ar.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new cT(e,wt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=Tr.STREAM_READ,i){if(e.type!==ar.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new cT(e,wt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=Tr.STREAM_DRAW,i){if(e.type!==ar.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new cT(e,wt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(wn.BufferObject,this),this._glName=this._context.gl.createBuffer(),D0(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER?this._indexType===Ke.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER||this.bufferType===wt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(wn.BufferObject,this),this._context=DS(this._context)):this._glName&&vp.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&vp.error("Buffer size needs to be positive!"),this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case Ke.UNSIGNED_SHORT:e*=2;break;case Ke.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(q4(e)&&(r/=2,this._indexType=Ke.UNSIGNED_SHORT),Z4(e)&&(r/=4,this._indexType=Ke.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),D0(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteLength)&&vp.error("offset is out of range!"),i>=s&&vp.error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.byteLength&&vp.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===ar.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i);else{const a=i===0&&s===e.length?e:e.subarray(i,s);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}D0(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(this._context.type!==ar.WEBGL2)return void vp.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void vp.error("Problem getting subdata: offset and length were less than zero!");const n=ake(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void vp.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteLength&&vp.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,wt.COPY_READ_BUFFER),o.getBufferSubData(wt.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(wt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,s){this._context.type===ar.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)):vp.error("Get buffer subdata is supported in WebGL2 only!")}};function ake(t){return jOe(t)}var E_;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(E_||(E_={}));let vr=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=os.TEXTURE_2D,this.pixelFormat=St.RGBA,this.dataType=Vs.UNSIGNED_BYTE,this.samplingMode=At.LINEAR,this.wrapMode=Dt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function lke(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*(t.hasMipmap?4/3:1)*nZ(t.internalFormat)}let cke=class w_e extends vr{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case Xe.R16F:case Xe.R16I:case Xe.R16UI:case Xe.R32F:case Xe.R32I:case Xe.R32UI:case Xe.R8_SNORM:case Xe.R8:case Xe.R8I:case Xe.R8UI:this.pixelFormat=St.RED}}static validate(e,r){return new w_e(e,r)}};const Wee=4;let Ct=class{constructor(e,r=null,i=null){if(this.type=E_.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=cke.validate(e,r);if(!s)throw new U("Texture descriptor invalid");this._descriptor=s}if(this._descriptor.context.instanceCounter.increment(wn.Texture,this),this._descriptor.context.type!==ar.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),o1(this._descriptor.target)))throw new U("3D and array textures are not supported in WebGL1");this._descriptor.target===os.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return fke.delete(this),lke(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(wn.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new U("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===os.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=os.TEXTURE_CUBE_MAP_POSITIVE_X;r<=os.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._descriptor.context||!this._descriptor.context.gl)return;const i=this._descriptor.context.gl;D0(i),this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=o1(n);e===null&&(s.width=s.width||Wee,s.height=s.height||Wee,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),bU(this._descriptor.context,s),this._configurePixelStorage(),D0(i);const l=this._deriveInternalFormat();if(wU(e)){let c=e.width,h=e.height;const d=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,h=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,d),this._texImage(n,0,l,c,h,d,e),D0(i),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=c),s.height||(s.height=h),o&&!s.depth&&(s.depth=d)}else{const{width:c,height:h,depth:d}=s;if(c==null||h==null)throw new U("Width and height must be specified!");if(o&&d==null)throw new U("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,d),oL(e)){const f=e.levels,m=Yee(n,c,h,d),y=Math.min(m-1,f.length-1);this._descriptor.context.gl2!=null?i.texParameteri(s.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,y):s.hasMipmap=s.hasMipmap&&m===f.length;const _=l;if(!dke(_))throw new U("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,w,T,x)=>{const S=f[Math.min(v,f.length-1)];this._compressedTexImage(n,v,_,w,T,x,S)},y)}else this._texImage(n,0,l,c,h,d,e),D0(i),s.hasMipmap&&this.generateMipmap()}Zee(i,this._descriptor),Xee(i,this._descriptor),uke(this._descriptor.context,this._descriptor),D0(i),this._descriptor.context.bindTexture(a,Ct.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,h=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,target:y,isImmutable:_}=h;if(_&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>h.width||n>h.height||r+s>h.width||i+n>h.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(wU(o)?c?c.texSubImage2D(y,e,r,i,s,n,f,m,o):l.texSubImage2D(y,e,r,i,f,m,o):oL(o)?l.compressedTexSubImage2D(y,e,r,i,s,n,d,o.levels[e]):l.texSubImage2D(y,e,r,i,s,n,f,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Ct.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new U("3D textures are not supported in WebGL1");const h=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,isImmutable:y,target:_}=h;if(y&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");o1(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>h.width||o>h.height||a>h.depth||r+n>h.width||i+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),oL(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,r,i,s,n,o,a,d,l);else{const w=l;c.texSubImage3D(_,e,r,i,s,n,o,a,f,m,w)}this._descriptor.context.bindTexture(v,Ct.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new U("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,bU(this._descriptor.context,e)}e.samplingMode===At.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=At.LINEAR_MIPMAP_NEAREST):e.samplingMode===At.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=At.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Ct.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,bU(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(Zee(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(Xee(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===ar.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===St.DEPTH_STENCIL&&(this._descriptor.internalFormat=St.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Vs.FLOAT:switch(this._descriptor.pixelFormat){case St.RGBA:return this._descriptor.internalFormat=Xe.RGBA32F;case St.RGB:return this._descriptor.internalFormat=Xe.RGB32F;default:throw new U("Unable to derive format")}case Vs.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case St.RGBA:return this._descriptor.internalFormat=Xe.RGBA8;case St.RGB:return this._descriptor.internalFormat=Xe.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===St.DEPTH_STENCIL?St.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const a=this._descriptor.context.gl2;if(a==null)throw new U("Immutable textures are not supported in WebGL1");if(!hke(r))throw new U("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Yee(e,s,n,o):1;if(o1(e)){if(o==null)throw new U("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=o1(e),{isImmutable:h,pixelFormat:d,dataType:f}=this._descriptor,m=this._descriptor.context.type===ar.WEBGL2,y=m?l:null;if(m||!wU(a))if(h){if(a!=null){const _=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,r,0,0,0,s,n,o,d,f,_)}else l.texSubImage2D(e,r,0,0,s,n,d,f,_)}}else{const _=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");y.texImage3D(e,r,i,s,n,o,0,d,f,_)}else l.texImage2D(e,r,i,s,n,0,d,f,_)}else l.texImage2D(e,0,i,d,f,a)}_compressedTexImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl;let c=null;const h=o1(e),d=this._descriptor.isImmutable;if(h){if(this._descriptor.context.type!==ar.WEBGL2)throw new U("3D textures are not supported in WebGL1");c=l}if(d){if(a!=null)if(h){if(o==null)throw new U("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(h){if(o==null)throw new U("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===os.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new U("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function bU(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===ar.WEBGL2;r||!e.isImmutable&&!o1(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&Bb(e.width)&&e.height!=null&&Bb(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Dt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Dt.CLAMP_TO_EDGE&&e.wrapMode.t===Dt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function Zee(t,e){let r=e.samplingMode,i=e.samplingMode;r===At.LINEAR_MIPMAP_NEAREST||r===At.LINEAR_MIPMAP_LINEAR?(r=At.LINEAR,e.hasMipmap||(i=At.LINEAR)):r!==At.NEAREST_MIPMAP_NEAREST&&r!==At.NEAREST_MIPMAP_LINEAR||(r=At.NEAREST,e.hasMipmap||(i=At.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function Xee(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function uke(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function hke(t){return t in Xe}function dke(t){return t in ds}function oL(t){return t!=null&&"type"in t&&t.type==="compressed"}function pke(t){return t!=null&&"byteLength"in t}function wU(t){return t!=null&&!oL(t)&&!pke(t)}function o1(t){return t===os.TEXTURE_3D||t===os.TEXTURE_2D_ARRAY}function Yee(t,e,r,i=1){let s=Math.max(e,r);return t===os.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}Ct.TEXTURE_UNIT_FOR_UPDATES=0;const fke=new Map;function Ol(t,e=rZ,r=br,i=-1,s=1){let n=null;return e===PR?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new up(t,r,{geometry:e},{geometry:Lr.createVertex(t,Tr.STATIC_DRAW,n)})}function mke(t,e=rZ,r=br){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new up(t,r,{geometry:e},{geometry:Lr.createVertex(t,Tr.STATIC_DRAW,i)})}const x_e=4;function T_e(t,e=x_e){const r=new vr;return r.samplingMode=At.NEAREST,r.width=r.height=e,new Ct(t,r)}function gke(t,e,r=x_e){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n]=255*e[0],i[n+1]=255*e[1],i[n+2]=255*e[2],i[n+3]=255*e[3];const s=new vr;return s.samplingMode=At.NEAREST,s.width=s.height=r,new Ct(t,s,i)}function S_e(t){const e=new vr;return e.samplingMode=At.NEAREST,e.width=e.height=1,new Ct(t,e,new Uint8Array([255,255,255,255]))}let Jee=class{constructor(e,r){this._view=e,this.type=Jo.Realistic,this._handles=new Mi,this._passParameters=new ske,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=sr.radius,this._fadeHaze=0,this._tmpScale=Ue(),this._updateRadius(sr.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ue(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateRootTileElevationBounds():null}),ue(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateVisibleElevationBounds():null})]);const s=new _N;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(y3,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(y3,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(y3,s),s.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(y3,s),this._vao=Ol(i,PR)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(e,r,i,s,n){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=o.background.color;se(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(l,e));else{const c=e.rctx.getViewport(),h=Ee(e.bindParameters.camera.eye)-sr.radius;let d;if(h<A0){const y=Math.min(1,Math.max(0,h/A0));d=n?xt(.4,.5,y):xt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(h-A0)/(15*A0)));d=n?xt(.5,1,y):xt(.3,.6,y)}const f=Math.floor(d*e.bindParameters.camera.fullViewport[2]),m=Math.floor(d*e.bindParameters.camera.fullViewport[3]);e.rctx.setViewport(0,0,f,m),o.renderToTargets(()=>this._renderCommon(l,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(c.x,c.y,c.width,c.height),nr(this._tmpScale,f/e.bindParameters.camera.fullViewport[2],m/e.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(e.bindParameters,n,i,this._tmpScale)}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(Et.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=sr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(sr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,nr(this._passParameters.radii,e,e+A0),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-yB)*yB)}_update(e){if(!e)return;const r=ra(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=_e((i-this._passParameters.radii[0])/A0,0,1);wi(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=eZ(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=xt(xt(.6,1,fO(9500,10500,i-sr.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function E_e(t){t.fragment.code.add(b`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function oZ(t,e){switch(t.include(Of,e),e.textureCoordinateType){case Ps.Default:case Ps.Compressed:return void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Ps.Atlas:return t.include(E_e),void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Ps.None:case Ps.COUNT:return}}let nu=class extends cs{constructor(e,r){super(e,"vec3",Qr.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},ph=class extends cs{constructor(e,r){super(e,"sampler2D",Qr.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}},G_=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return gg.LOADED}},aZ=class extends G_{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Bi(this._texture),this._textureNormal=Bi(this._textureNormal),this._textureEmissive=Bi(this._textureEmissive),this._textureOcclusion=Bi(this._textureOcclusion),this._textureMetallicRoughness=Bi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?gg.LOADED:gg.LOADING}get textureBindParameters(){return new C_e(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Bi(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(gu(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return Bi(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},C_e=class extends ei{constructor(e=null,r=null,i=null,s=null,n=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}};var rt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(rt||(rt={}));function lZ(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===rt.Normal&&i&&t.include(oZ,e),e.pbrMode!==rt.Schematic)if(e.pbrMode!==rt.Disabled){if(e.pbrMode===rt.Normal){r.code.add(b`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===Qr.Pass?new Je("texMetallicRoughness",n=>n.textureMetallicRoughness):new ph("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(b`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===Qr.Pass?new Je("texEmission",n=>n.textureEmissive):new ph("texEmission",n=>n.textureEmissive)),r.code.add(b`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===Qr.Pass?new Je("texOcclusion",n=>n.textureOcclusion):new ph("texOcclusion",n=>n.textureOcclusion)),r.code.add(b`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(b`float getBakedOcclusion() { return 1.0; }`),s===Qr.Pass?r.uniforms.add(new zt("emissionFactor",n=>n.emissiveFactor),new zt("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new nu("emissionFactor",n=>n.emissiveFactor),new nu("mrrFactors",n=>n.mrrFactors)),r.code.add(b`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?b`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?b`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?b`applyEmission(${e.hasEmissiveTextureTransform?b`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?b`applyOcclusion(${e.hasOcclusionTextureTransform?b`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(b`float getBakedOcclusion() { return 1.0; }`);else r.code.add(b`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function cZ(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new zt("lightingAmbientSH0",(s,n)=>se(Qee,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new ir("lightingAmbientSH_R",(s,n)=>wi(lm,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new ir("lightingAmbientSH_G",(s,n)=>wi(lm,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new ir("lightingAmbientSH_B",(s,n)=>wi(lm,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new zt("lightingAmbientSH0",(s,n)=>se(Qee,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new ir("lightingAmbientSH_R1",(s,n)=>wi(lm,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new ir("lightingAmbientSH_G1",(s,n)=>wi(lm,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new ir("lightingAmbientSH_B1",(s,n)=>wi(lm,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new ir("lightingAmbientSH_R2",(s,n)=>wi(lm,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new ir("lightingAmbientSH_G2",(s,n)=>wi(lm,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new ir("lightingAmbientSH_B2",(s,n)=>wi(lm,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==rt.Normal&&e.pbrMode!==rt.Schematic||r.code.add(b`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Qee=A(),lm=Yt();function MR(t){t.vertex.code.add(b`const float PI = 3.141592653589793;`),t.fragment.code.add(b`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Os,Yb;function yke(t){return(t==null?void 0:t.cubeMap)!=null}function uZ(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(Os||(Os={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(Yb||(Yb={}));let _ke=class{constructor(){this.readChannels=Yb.RG,this.renderingStage=Os.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=A(),this.isCameraPositionFinal=!0,this.parallax=new Kee,this.parallaxNew=new Kee,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:pn.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:tc.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:C_.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===pn.FADE_OUT||this.fadeInOut.stage===pn.FADE_IN||this.fadeIn.stage===tc.FADE_IN||this.fadeInOutHeight.stage!==C_.FINISHED||this.renderingStage===Os.FADING_TEXTURE_CHANNELS}};var tc,pn,C_;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(tc||(tc={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(pn||(pn={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(C_||(C_={}));let Kee=class{constructor(){this.anchorPointClouds=A(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=ve()}},Rf=class extends cs{constructor(e,r){super(e,"bool",Qr.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},vke=class extends cs{constructor(e,r){super(e,"samplerCube",Qr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function A_e(t){const e=t.fragment;e.uniforms.add(new Ni("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new Ni("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new zt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new zt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Oe("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Oe("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Oe("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===pn.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Oe("crossFadeAnchorFactor",(r,i)=>_e(i.cloudsFade.crossFade.factor,0,1)),new vke("cubeMap",(r,i)=>{var s;return(s=i.cloudsFade.data)!=null&&s.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null}),new Rf("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new Rf("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===Yb.RG),new Rf("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Os.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",sr.radius),e.code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(b`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Wg(e),tm(e),e.code.add(b`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(b`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(b`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(b`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function rm(t){t.code.add(b`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function bke(){const t=new wr;t.attributes.add(E.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Ni("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Ni("inverseViewMatrix",(i,s)=>QS(wke,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(rm),r.include(Tc),t.include(cZ,{pbrMode:rt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(MR),t.include(K5),t.include(gN),t.include(A_e,{instancedDoublePrecision:!1}),r.uniforms.add(new zt("cameraPosition",(i,s)=>s.camera.eye)),r.code.add(b`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const wke=ve(),xke=Object.freeze(Object.defineProperty({__proto__:null,build:bke},Symbol.toStringTag,{value:"Module"}));let O_e=class R_e extends Pr{constructor(e){super(e,new ha,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,R_e.shader.get().build(),br)}initializePipeline(){return Ot({blending:bo(be.ONE,be.ZERO,be.SRC_ALPHA,be.ONE),depthTest:{func:Kr.LEQUAL},colorWrite:jt})}};O_e.shader=new Er(xke,()=>ae(()=>import("./CloudsComposition.glsl-b6474ed7.js"),[]));let a1=class extends xe{constructor(e){super(e),this._technique=new O_e(e),this._vao=Ol(e.rctx)}destroy(){this._technique=Bi(this._technique),this._vao=Fe(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,Tke,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Et.TRIANGLE_STRIP,0,4)}};u([p({constructOnly:!0})],a1.prototype,"rctx",void 0),u([p({constructOnly:!0})],a1.prototype,"viewingMode",void 0),u([p({constructOnly:!0})],a1.prototype,"planetRadius",void 0),u([p({constructOnly:!0})],a1.prototype,"requestRender",void 0),a1=u([R("esri.views.3d.environment.CloudsComposition")],a1);const Tke=new ei;function Eh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Ske(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function hZ(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function dZ(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ch(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Rw(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=r*d+i*f+s*m;return y?(y=1/y,t[0]=d*y,t[1]=(-h*i+s*c)*y,t[2]=(a*i-s*o)*y,t[3]=f*y,t[4]=(h*r-s*l)*y,t[5]=(-a*r+s*n)*y,t[6]=m*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*n)*y,t):null}function Eke(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-i*h,t[2]=i*a-s*o,t[3]=a*l-n*h,t[4]=r*h-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function Cke(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function pS(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=r[0],m=r[1],y=r[2],_=r[3],v=r[4],w=r[5],T=r[6],x=r[7],S=r[8];return t[0]=f*i+m*o+y*c,t[1]=f*s+m*a+y*h,t[2]=f*n+m*l+y*d,t[3]=_*i+v*o+w*c,t[4]=_*s+v*a+w*h,t[5]=_*n+v*l+w*d,t[6]=T*i+x*o+S*c,t[7]=T*s+x*a+S*h,t[8]=T*n+x*l+S*d,t}function vN(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=r[0],m=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*i+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+d,t}function pZ(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=Math.sin(r),m=Math.cos(r);return t[0]=m*i+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*i,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=d,t}function fZ(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function Ake(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function Oke(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Rke(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Pke(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Mke(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function tF(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,d=i*a,f=s*o,m=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-d-y,t[3]=h-w,t[6]=f+v,t[1]=h+w,t[4]=1-c-y,t[7]=m-_,t[2]=f-v,t[5]=m+_,t[8]=1-c-d,t}function P_e(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],d=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=r*d+i*f+s*m;if(!y)return null;const _=1/y;return t[0]=d*_,t[1]=(-h*i+s*c)*_,t[2]=(a*i-s*o)*_,t[3]=f*_,t[4]=(h*r-s*l)*_,t[5]=(-a*r+s*n)*_,t[6]=m*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*n)*_,t}function A_(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,O=i*l-s*a,C=i*c-n*a,P=s*c-n*l,$=h*_-d*y,V=h*v-f*y,z=h*w-m*y,B=d*v-f*_,k=d*w-m*_,Z=f*w-m*v;let W=T*Z-x*k+S*B+O*z-C*V+P*$;return W?(W=1/W,t[0]=(a*Z-l*k+c*B)*W,t[1]=(l*z-o*Z-c*V)*W,t[2]=(o*k-a*z+c*$)*W,t[3]=(s*k-i*Z-n*B)*W,t[4]=(r*Z-s*z+n*V)*W,t[5]=(i*z-r*k-n*$)*W,t[6]=(_*P-v*C+w*O)*W,t[7]=(v*S-y*P-w*x)*W,t[8]=(y*C-_*S+w*T)*W,t):null}function Ike(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function $ke(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Lke(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Dke(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function M_e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function Nke(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Fke(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function Uke(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Vke(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],d=e[0],f=e[1],m=e[2],y=e[3],_=e[4],v=e[5],w=e[6],T=e[7],x=e[8],S=Xa();return Math.abs(r-d)<=S*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-f)<=S*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-m)<=S*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=S*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=S*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-T)<=S*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-x)<=S*Math.max(1,Math.abs(h),Math.abs(x))}function mZ(t){const e=Xa(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const zke=pS,kke=M_e;Object.freeze(Object.defineProperty({__proto__:null,add:Dke,adjoint:Eke,copy:Ske,determinant:Cke,equals:Vke,exactEquals:Uke,frob:Lke,fromMat2d:Mke,fromMat4:Eh,fromQuat:tF,fromRotation:Rke,fromScaling:Pke,fromTranslation:Oke,identity:dZ,invert:Rw,isOrthoNormal:mZ,mul:zke,multiply:pS,multiplyScalar:Nke,multiplyScalarAndAdd:Fke,normalFromMat4:A_,normalFromMat4Legacy:P_e,projection:Ike,rotate:pZ,scale:fZ,scaleByVec2:Ake,set:hZ,str:$ke,sub:kke,subtract:M_e,translate:vN,transpose:Ch},Symbol.toStringTag,{value:"Module"}));function ns(){return new Float32Array(3)}function bN(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zr(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function I_e(t,e){return new Float32Array(t,e,3)}function gZ(){return ns()}function $_e(){return Zr(1,1,1)}function L_e(){return Zr(1,0,0)}function D_e(){return Zr(0,1,0)}function N_e(){return Zr(0,0,1)}const Bke=gZ(),Gke=$_e(),jke=L_e(),Hke=D_e(),qke=N_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Gke,UNIT_X:jke,UNIT_Y:Hke,UNIT_Z:qke,ZEROS:Bke,clone:bN,create:ns,createView:I_e,fromValues:Zr,ones:$_e,unitX:L_e,unitY:D_e,unitZ:N_e,zeros:gZ},Symbol.toStringTag,{value:"Module"}));var bl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(bl||(bl={}));let aL=class extends ha{constructor(){super(...arguments),this.steps=bl.SIXTEEN,this.writeTextureChannels=Yb.RG}};u([F({count:bl.COUNT})],aL.prototype,"steps",void 0),u([F({constValue:oe("esri-mobile")?1024:2048})],aL.prototype,"cubeMapSize",void 0),u([F()],aL.prototype,"writeTextureChannels",void 0);let _3=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const ete=new _3([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],bl.SIXTEEN),Yo={sunny:ete,cloudy:new _3([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],bl.TWOHUNDRED,.6),rainy:new _3([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],bl.TWOHUNDRED,.4),snowy:new _3([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],bl.HUNDRED,.65),foggy:new _3([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],bl.SIXTEEN),default:ete},Ju=oe("esri-mobile")?64:128,Wke=Ju/128,wd=Math.ceil(Math.sqrt(Ju)),u_=(Ju+2)*wd,Zke=1e5,xU=128,Xke=u_/1560;function Ih(t,e=!0){t.attributes.add(E.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(b`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?b`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let MO=class extends cs{constructor(e,r){super(e,"mat3",Qr.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},F_e=class extends ei{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Yo.default.raymarchingSteps,this.weatherTile=Ue()}},U_e=class extends ei{constructor(){super(...arguments),this.viewMatrix=Fi()}};function Yke(t){const e=new wr;e.include(Ih,!1);const r=e.fragment;return r.uniforms.add(new Oe("cloudRadius",i=>i.cloudRadius),new Oe("power",i=>xt(35,120,i.absorption)),new Oe("sigmaE",i=>1+i.absorption),new Oe("density",i=>xt(0,.3,i.density)),new Oe("cloudSize",i=>xt(0,.02,Math.max(.01,1-i.cloudSize))),new Oe("detailSize",i=>xt(0,.2,Math.max(.01,1-i.detailSize))),new Oe("smoothness",i=>xt(0,.5,1-i.smoothness)),new Oe("cloudHeight",i=>xt(0,1500,i.cloudHeight)),new Oe("coverage",i=>i.coverage),new MO("view",i=>i.viewMatrix),new Je("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new Sr("cloudVariables",i=>nr(Jke,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(b`
    const int STEPS = ${t.steps===bl.SIXTEEN?b`16`:t.steps===bl.HUNDRED?b`100`:b`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(b`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${b.float(u_)};
      const float dataWidth = ${b.float(u_)};
      const float tileRows = ${b.float(wd)};
      const vec3 atlasDimensions = vec3(${b.float(Ju)}, ${b.float(Ju)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${b.float(Wke)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${b.float(Xke)} * p) / ${b.float(u_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(b`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(b`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(b`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(b`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(b`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const Jke=Ue(),Qke=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:U_e,CloudsPassParameters:F_e,build:Yke},Symbol.toStringTag,{value:"Module"}));let V_e=class z_e extends Pr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,z_e.shader.get().build(this.configuration),br)}initializePipeline(){return Ot({blending:wc(be.CONSTANT_COLOR,be.ONE_MINUS_CONSTANT_COLOR,kf.ADD,this.configuration.writeTextureChannels===Yb.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Kr.LEQUAL},colorWrite:jt})}};V_e.shader=new Er(Qke,()=>ae(()=>import("./Clouds.glsl-0bc2b027.js"),[]));var Kc;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Kc||(Kc={}));let TB=class extends ha{constructor(){super(...arguments),this.mode=Kc.Full}};u([F({count:Kc.COUNT})],TB.prototype,"mode",void 0);let k_e=class extends ei{constructor(){super(...arguments),this.weatherTile=ur(0,0)}};function Kke(t){const e=new wr;return e.include(Ih,!1),e.fragment.code.add(b`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Kc.Full&&e.fragment.code.add(b`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${b.float(wd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${b.float(8)});

      float worley0 = worley(p, ${b.float(2)} * 2.0);
      float worley1 = worley(p, ${b.float(2)} * 8.0);
      float worley2 = worley(p, ${b.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${b.float(2)});
      float worley1 = worley(p, ${b.float(2)} * 2.0);
      float worley2 = worley(p, ${b.float(2)} * 4.0);
      float worley3 = worley(p, ${b.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Sr("weatherTile",r=>r.weatherTile)),e.fragment.code.add(b`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${b.float(xU)});

      // Get global coordinates of p
      p += weatherTile * ${b.float(xU)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${b.float(Zke)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(b`void main() {`),t.mode===Kc.Full&&e.fragment.code.add(b`
        float padWidth = 1.0;
        float paddedSize = ${b.float(Ju)} + 2.0 * padWidth;
        float tileCount = ${b.float(wd)} * ${b.float(wd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${b.float(Ju)};
          }

          if (startPadY) {
            pixel.y += ${b.float(Ju)};
          }

          if (endPadX) {
            pixel.x -= ${b.float(Ju)};
          }

          if (endPadY) {
            pixel.y -= ${b.float(Ju)};
          }

          uv = vec2(pixel.xy / ${b.float(Ju)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${b.float(Ju)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${b.float(wd)} * ${b.float(wd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${b.float(wd)} * ${b.float(wd)});
        p = p_;
        p.z /= (${b.float(wd)} * ${b.float(wd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(b`
      vec2 mapUV = ${b.float(xU)} * (gl_FragCoord.xy / ${b.float(u_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Kc.Full?b`fragColor.ba = vec2(0.0, map);`:b`fragColor = vec4(map);`};
    }
  `),e}const eBe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:k_e,build:Kke},Symbol.toStringTag,{value:"Module"}));let SB=class B_e extends Pr{initializeProgram(e){return new Cr(e.rctx,B_e.shader.get().build(this.configuration),br)}initializePipeline(){return Ot({blending:this.configuration.mode===Kc.Full?wc(be.ONE,be.ZERO):bo(be.ZERO,be.ONE,be.ONE,be.ZERO),depthTest:{func:Kr.ALWAYS},colorWrite:jt})}};SB.shader=new Er(eBe,()=>ae(()=>import("./NoiseTextureAtlas.glsl-3310f70d.js"),[]));let wN=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function tBe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*nZ(t.internalFormat)}let rBe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=E_.RenderBuffer,this._context.instanceCounter.increment(wn.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==ar.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get gpuMemoryUsage(){return tBe(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(wn.Renderbuffer,this),this._context=DS(this._context))}};const iBe=Q.getLogger("esri.views.webgl.FramebufferObject");let on=class uT{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(wn.FramebufferObject,this);const s=lL(r)?r:new Ct(this._context,r);if(this._colorAttachments.set(Bc.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(Bc.COLOR_ATTACHMENT0),i!=null)if(nBe(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=lL(i)?i:new Ct(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=sBe(i)?i:new rBe(this._context,i),o=n.descriptor;o.internalFormat===Bs.STENCIL_INDEX8?this._stencilBuffer=n:this._depthBuffer=n,this._validateRenderBufferDescriptor(o)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(wn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Bc.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(Bc.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(Bc.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get gpuMemoryUsage(){var e;return[...this._colorAttachments].reduce((r,[i,s])=>r+s.gpuMemoryUsage,((e=this.depthStencilAttachment)==null?void 0:e.gpuMemoryUsage)??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&lL(r)?r:null}attachColorTexture(e,r=Bc.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(s=this.detachColorTexture(r))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=Bc.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}setColorTextureTarget(e,r=Bc.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case E_.Texture:return this._attachDepthStencilTexture(e);case E_.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==St.DEPTH_STENCIL&&r.pixelFormat!==St.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Vs.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,kee)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,kee)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){var i;if(e==null)return;const r=e.descriptor;if(r.internalFormat!==Bs.DEPTH_STENCIL&&r.internalFormat!==Bs.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const s=this._context.gl,n=this._getGLAttachmentPoint(r);s.framebufferRenderbuffer(lo.FRAMEBUFFER,n,s.RENDERBUFFER,e.glName)}(i=this._depthBuffer)==null||i.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(lo.FRAMEBUFFER,i,r.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==os.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,Ct.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(os.TEXTURE_2D,0,n,o,e,r,i,s),c.bindTexture(h,Ct.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){if(this._context.type!==ar.WEBGL2)return Wu()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,s,n,o,a);const l=this._context.gl,c=Lr.createPixelPack(this._context,Tr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(wt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var s,n,o;if(this.width===e&&this.height===r)return;const i={width:e,height:r};ob(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(a=>a.resize(i.width,i.height)),(s=this._depthStencilTexture)==null||s.resize(i.width,i.height),this._initialized&&(ob(i,this._context.parameters.maxRenderbufferSize),(n=this._depthBuffer)==null||n.resize(i.width,i.height),(o=this._stencilBuffer)==null||o.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=lo.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(e,i),this._colorAttachments.forEach((n,o)=>this._framebufferTexture2D(n.glName,o,tte(n),e));const s=this._depthBuffer||this._stencilBuffer;if(s){const n=this._getGLAttachmentPoint(s.descriptor);r.framebufferRenderbuffer(e,n,r.RENDERBUFFER,s.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,tte(this._depthStencilTexture),e);Wu()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=Bc.COLOR_ATTACHMENT0,i=os.TEXTURE_2D,s=lo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(lo.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthBuffer=Fe(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(lo.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=Fe(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Fe(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==os.TEXTURE_2D&&e.target!==os.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),ob(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){ob(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Bs.DEPTH_COMPONENT16:case Bs.DEPTH_COMPONENT24:case Bs.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Bs.DEPTH24_STENCIL8:case Bs.DEPTH32F_STENCIL8:case Bs.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Bs.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(uT._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;uT._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else uT._MAX_COLOR_ATTACHMENTS=1}const r=e-Bc.COLOR_ATTACHMENT0;r+1>uT._MAX_COLOR_ATTACHMENTS&&Q.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${uT._MAX_COLOR_ATTACHMENTS} color attachments`)}};function lL(t){return t!=null&&"type"in t&&t.type===E_.Texture}function sBe(t){return t!=null&&"type"in t&&t.type===E_.RenderBuffer}function nBe(t){return lL(t)||t!=null&&"pixelFormat"in t}function ob(t,e){const r=Math.max(t.width,t.height);if(r>e){iBe.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function tte(t){return t.descriptor.target===os.TEXTURE_CUBE_MAP?os.TEXTURE_CUBE_MAP_POSITIVE_X:os.TEXTURE_2D}on._MAX_COLOR_ATTACHMENTS=-1;let v3=class extends xe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new k_e,this._frameBuffer=new on(e.context.renderContext.rctx,new vr(u_)),this._vao=Ol(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Kc.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(Kc.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(cn(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Bi(this._fullTechniqueCached),this._weatherMapTechniqueCached=Bi(this._weatherMapTechniqueCached),this._frameBuffer=Fe(this._frameBuffer),this._vao=Fe(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new TB;e.mode=Kc.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(SB,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new TB;e.mode=Kc.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(SB,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===Kc.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,u_,u_),i.bindFramebuffer(this._frameBuffer);const n=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([p({constructOnly:!0})],v3.prototype,"context",void 0),u([p({readOnly:!0})],v3.prototype,"_techniqueRepository",null),v3=u([R("esri.views.3d.environment.NoiseTextureAtlas")],v3);function G_e(t){t.include(fu),t.uniforms.add(new Je("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new Sr("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(b`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let oBe=class{constructor(){this.enabled=!1}};function mu(t,e){e.hasMultipassTerrain&&(t.fragment.include(fu),t.fragment.uniforms.add(new Je("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Sr("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new Sr("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(b`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let aBe=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function lBe(t,e){const r=t.fragment;r.include(fu),r.uniforms.add(new Sr("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new Je("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new Ni("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new Oe("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new Ni("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(b`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let cBe=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=ve()}};function rF(t){return t?{ray:Gn(t.ray),c0:t.c0,c1:t.c1}:{ray:Gn(),c0:0,c1:Number.MAX_VALUE}}function uBe(t,e=rF()){return uN(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function hBe(t,e,r=rF()){const i=Ee(t.vector);return xye(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function f3t(t,e){return j_e(t,t.c0,e)}function m3t(t,e){return j_e(t,t.c1,e)}function j_e(t,e,r){return le(r,t.ray.origin,ie(r,t.ray.direction,e))}new Hg(()=>rF());function IO(t){return t?[Ir(t[0]),Ir(t[1]),Ir(t[2]),Ir(t[3]),Ir(t[4]),Ir(t[5])]:[Ir(),Ir(),Ir(),Ir(),Ir(),Ir()]}function H_e(){return[A(),A(),A(),A(),A(),A(),A(),A()]}function xN(t,e){for(let r=0;r<rE;r++)G5(t[r],e[r])}function q_e(t,e,r,i=yBe){const s=ni($W.get(),e,t);xn(s,s);for(let n=0;n<mBe;++n){const o=eu(IW.get(),gBe[n],s);se(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}W_e(r,i)}function W_e(t,e){ea(e[Ye.FAR_BOTTOM_LEFT],e[Ye.NEAR_BOTTOM_LEFT],e[Ye.NEAR_TOP_LEFT],t[pi.LEFT]),ea(e[Ye.NEAR_BOTTOM_RIGHT],e[Ye.FAR_BOTTOM_RIGHT],e[Ye.FAR_TOP_RIGHT],t[pi.RIGHT]),ea(e[Ye.FAR_BOTTOM_LEFT],e[Ye.FAR_BOTTOM_RIGHT],e[Ye.NEAR_BOTTOM_RIGHT],t[pi.BOTTOM]),ea(e[Ye.NEAR_TOP_LEFT],e[Ye.NEAR_TOP_RIGHT],e[Ye.FAR_TOP_RIGHT],t[pi.TOP]),ea(e[Ye.NEAR_BOTTOM_LEFT],e[Ye.NEAR_BOTTOM_RIGHT],e[Ye.NEAR_TOP_RIGHT],t[pi.NEAR]),ea(e[Ye.FAR_BOTTOM_RIGHT],e[Ye.FAR_BOTTOM_LEFT],e[Ye.FAR_TOP_LEFT],t[pi.FAR])}function t_(t,e){for(let r=0;r<rE;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function dBe(t,e){return X_e(t,uBe(e,Y_e.get()))}function g3t(t,e){for(let r=0;r<rE;r++){const i=t[r];if(!CUe(i,e))return!1}return!0}function pBe(t,e,r){return X_e(t,hBe(e,r,Y_e.get()))}function Z_e(t,e){for(let r=0;r<rE;r++)if(fi(t[r],e)>0)return!1;return!0}function X_e(t,e){for(let r=0;r<rE;r++)if(!EUe(t[r],e))return!1;return!0}var pi,Ye;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(pi||(pi={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Ye||(Ye={}));const fBe={bottom:[Ye.FAR_BOTTOM_RIGHT,Ye.NEAR_BOTTOM_RIGHT,Ye.NEAR_BOTTOM_LEFT,Ye.FAR_BOTTOM_LEFT],near:[Ye.NEAR_BOTTOM_LEFT,Ye.NEAR_BOTTOM_RIGHT,Ye.NEAR_TOP_RIGHT,Ye.NEAR_TOP_LEFT],far:[Ye.FAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_LEFT,Ye.FAR_TOP_LEFT,Ye.FAR_TOP_RIGHT],right:[Ye.NEAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_RIGHT,Ye.FAR_TOP_RIGHT,Ye.NEAR_TOP_RIGHT],left:[Ye.FAR_BOTTOM_LEFT,Ye.NEAR_BOTTOM_LEFT,Ye.NEAR_TOP_LEFT,Ye.FAR_TOP_LEFT],top:[Ye.FAR_TOP_LEFT,Ye.NEAR_TOP_LEFT,Ye.NEAR_TOP_RIGHT,Ye.FAR_TOP_RIGHT]},rE=6,mBe=8,gBe=[Ft(-1,-1,-1,1),Ft(1,-1,-1,1),Ft(1,1,-1,1),Ft(-1,1,-1,1),Ft(-1,-1,1,1),Ft(1,-1,1,1),Ft(1,1,1,1),Ft(-1,1,1,1)],Y_e=new Hg(rF),yBe=H_e();function _Be(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function vBe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function bBe(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function wBe(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var EB;let lt=EB=class extends xe{constructor(t={}){super(t),this._center=A(),this._up=A(),this._viewUp=A(),this._viewForward=A(),this._viewRight=A(),this._ray=Gn(),this._viewport=Ft(0,0,1,1),this._padding=Ft(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ur(1,1e3),this._viewDirty=!0,this._viewMatrix=ve(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ve(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ve(),this._frustumDirty=!0,this._frustum=IO(),this._fullViewport=Yt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return he(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){$s(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=kb(Yt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&kD(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=kb(Yt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&kD(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[tr.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[tr.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[tr.RIGHT]+this._padding[tr.LEFT]}set fullWidth(t){this.width=t-(this._padding[tr.RIGHT]+this._padding[tr.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[tr.TOP]+this._padding[tr.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[tr.TOP]+this._padding[tr.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[tr.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[tr.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){d2(this._padding,t)||(this._viewport[0]+=t[tr.LEFT]-this._padding[tr.LEFT],this._viewport[1]+=t[tr.BOTTOM]-this._padding[tr.BOTTOM],this._viewport[2]-=t[tr.RIGHT]+t[tr.LEFT]-(this._padding[tr.RIGHT]+this._padding[tr.LEFT]),this._viewport[3]-=t[tr.TOP]+t[tr.BOTTOM]-(this._padding[tr.TOP]+this._padding[tr.BOTTOM]),ch(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(ni(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=bge(ve(),-i*(1+2*this._padding[tr.LEFT]/t),i*(1+2*this._padding[tr.RIGHT]/t),-r*(1+2*this._padding[tr.BOTTOM]/e),r*(1+2*this._padding[tr.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&wW(n,s)?n:s}get inverseProjectionMatrix(){return xn(ve(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ve()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return bBe(this._fov,this.width,this.height)}set fovX(t){this._fov=_Be(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return wBe(this._fov,this.width,this.height)}set fovY(t){this._fov=vBe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return mi(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(xn(this._viewInverseTransposeMatrix,this.viewMatrix),bc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){re(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,ch(this._viewport,t.viewport),this.notifyChange("_viewport"),ch(this._padding,t.padding),this.notifyChange("_padding"),cn(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||($s(this._viewMatrix,t.viewMatrix),re(this._viewRight,t.viewRight),re(this._viewUp,t.viewUp),re(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(xN(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:($s(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),ch(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new EB().copyFrom(this)}equals(t){return na(this.eye,t.eye)&&na(this.center,t.center)&&na(this.up,t.up)&&d2(this._viewport,t.viewport)&&d2(this._padding,t.padding)&&t_e(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||zD(t.screenPadding,this.screenPadding)>=1||zD(this.screenViewport,t.screenViewport)>=1)return!1;bn(jo,t.eye,t.center),bn(TU,this.eye,this.center);const e=me(jo,TU),r=ez(jo),i=ez(TU),s=5e-4;return e*e>=(1-1e-10)*r*i&&a5(t.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(TA(this.viewForward,he(jo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Yi()){return t[0]=(this.padding[tr.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[tr.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[tr.LEFT]+this.width*e,t[1]=this.padding[tr.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==er&&re(er,t),er[3]=1,eu(er,er,this.projectionMatrix);const r=Math.abs(er[3]);ie(er,er,1/r);const i=this.fullViewport;e[0]=xt(0,i[0]+i[2],.5+.5*er[0]),e[1]=xt(0,i[1]+i[3],.5+.5*er[1]),e[2]=.5*(er[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;er[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],er[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],er[2]=(2*t[2]-1)*t[3],er[3]=t[3],this.inverseProjectionMatrix!=null&&(eu(er,er,this.inverseProjectionMatrix),e[0]=er[0],e[1]=er[1],e[2]=er[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,SU),this.renderToScreen(SU,e),e}projectToRenderScreen(t,e){if(er[0]=t[0],er[1]=t[1],er[2]=t[2],er[3]=1,eu(er,er,this.viewProjectionMatrix),er[3]===0)return null;ie(er,er,1/Math.abs(er[3]));const r=this.fullViewport;return"x"in e?(e.x=xt(0,r[0]+r[2],.5+.5*er[0]),e.y=xt(0,r[1]+r[3],.5+.5*er[1])):(e[0]=xt(0,r[0]+r[2],.5+.5*er[0]),e[1]=xt(0,r[1]+r[3],.5+.5*er[1]),e.length>2&&(e[2]=.5*(er[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,SU),e)}unprojectFromRenderScreen(t,e){if(ni(JP,this.projectionMatrix,this.viewMatrix),!xn(JP,JP))return null;const r=this.fullViewport;return er[0]=2*(t[0]-r[0])/r[2]-1,er[1]=2*(t[1]-r[1])/r[3]-1,er[2]=2*t[2]-1,er[3]=1,eu(er,er,JP),er[3]===0?null:(e[0]=er[0]/er[3],e[1]=er[1]/er[3],e[2]=er[2]/er[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(t){t===Le.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){he(jo,this.center,this.eye);const t=Ee(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(me(jo,this.center))>.9999*Ee(jo)*t||(ot(this._up,jo,this.center),ot(this._up,this._up,jo),ge(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Gg(jo,this.eye,this.center),Math.abs(jo[2])<=.9999&&(ie(jo,jo,jo[2]),se(this._up,-jo[0],-jo[1],1-jo[2]),ge(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?na(t,e)||(re(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):Q.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(q_e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(L5(this._viewMatrix,this.eye,this.center,this.up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([p()],lt.prototype,"_center",void 0),u([p()],lt.prototype,"_up",void 0),u([p()],lt.prototype,"_viewport",void 0),u([p()],lt.prototype,"_padding",void 0),u([p()],lt.prototype,"_fov",void 0),u([p()],lt.prototype,"_nearFar",void 0),u([p()],lt.prototype,"_pixelRatio",void 0),u([p()],lt.prototype,"pixelRatio",null),u([p()],lt.prototype,"eye",null),u([p()],lt.prototype,"center",null),u([p()],lt.prototype,"up",null),u([p({readOnly:!0})],lt.prototype,"nearFar",null),u([p()],lt.prototype,"near",null),u([p()],lt.prototype,"far",null),u([p()],lt.prototype,"viewport",null),u([p({readOnly:!0})],lt.prototype,"screenViewport",null),u([p({readOnly:!0})],lt.prototype,"screenPadding",null),u([p()],lt.prototype,"x",null),u([p()],lt.prototype,"y",null),u([p()],lt.prototype,"width",null),u([p()],lt.prototype,"height",null),u([p()],lt.prototype,"fullWidth",null),u([p()],lt.prototype,"fullHeight",null),u([p({readOnly:!0})],lt.prototype,"_aspect",null),u([p()],lt.prototype,"padding",null),u([p({readOnly:!0})],lt.prototype,"projectionMatrix",null),u([p({readOnly:!0})],lt.prototype,"inverseProjectionMatrix",null),u([p()],lt.prototype,"fov",null),u([p()],lt.prototype,"fovX",null),u([p()],lt.prototype,"fovY",null),lt=EB=u([R("esri.views.3d.webgl-engine.lib.Camera")],lt);const er=Yt(),JP=ve(),jo=A(),TU=A(),SU=Vo();var tr;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(tr||(tr={}));var ce;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(ce||(ce={}));var st;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(st||(st={}));let yZ=class{constructor(e=A()){this.intensity=e}},J_e=class{constructor(e=A(),r=Ae(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},TN=class{constructor(e=A(),r=Ae(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},Q_e=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function xBe(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function EU(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function y2(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function K_e(t){return(t+1)*(t+1)}function TBe(t){return _e(Math.floor(Math.sqrt(t)-1),0,2)}function eve(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=K_e(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function SBe(t,e){const r=K_e(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function EBe(t,e){const r=TBe(e.r.length);for(const i of t)aa(CB,i.direction),eve(CB,r,og),xBe(og,cL),EU(og,i.intensity[0],jw),y2(e.r,jw),EU(og,i.intensity[1],jw),y2(e.g,jw),EU(og,i.intensity[2],jw),y2(e.b,jw);return e}function CBe(t,e){eve(CB,0,og);for(const r of t)e.r[0]+=og[0]*cL[0]*r.intensity[0]*4*Math.PI,e.g[0]+=og[0]*cL[0]*r.intensity[1]*4*Math.PI,e.b[0]+=og[0]*cL[0]*r.intensity[2]*4*Math.PI;return e}function ABe(t,e,r,i){SBe(e,i),se(r.intensity,0,0,0);let s=!1;const n=OBe,o=RBe,a=PBe;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof TN&&!s?(re(r.direction,l.direction),re(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof TN||l instanceof J_e?n.push(l):l instanceof yZ?o.push(l):l instanceof Q_e&&a.push(l);EBe(n,i),CBe(o,i);for(const l of a)y2(i.r,l.r),y2(i.g,l.g),y2(i.b,l.b)}const OBe=[],RBe=[],PBe=[],og=[0],jw=[0],CB=A(),cL=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let rte=class{constructor(){this.color=A(),this.intensity=1}},MBe=class{constructor(){this.direction=A(),this.ambient=new rte,this.diffuse=new rte}};const tve=.4;let CU=class{constructor(){this._shOrder=2,this._legacy=new MBe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Q_e,this._mainLight=new TN(A(),Ae(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){ABe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),re(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,ie(this._legacy.diffuse.color,this._mainLight.intensity,r),re(QP,this._legacy.diffuse.color),ie(QP,QP,tve*this.globalFactor),le(this._legacy.ambient.color,this._legacy.ambient.color,QP)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),re(this._mainLight.direction,e.mainLight.direction),re(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(Gr(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=xt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=xt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),re(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=xt(e.globalFactor,r.globalFactor,i),this.noonFactor=xt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=xt(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=xt(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=xt(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const QP=A();let iF=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=ce.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=st.NONE,this.alignPixelEnabled=!1,this._camera=new lt,this._inverseViewport=Ue(),this.oldLighting=new CU,this.newLighting=new CU,this._fadedLighting=new CU,this._lighting=this.newLighting,this.ssr=new cBe,this.multipassTerrain=new aBe,this.multipassGeometry=new oBe,this.overlays=[],this.cloudsFade=new _ke}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},cl=class extends xe{constructor(e){super(e),this._handles=new Mi,this._techniques=new Array,this._techniqueConfiguration=new aL,this._bindParameters=new iF(null,null,null),this._passParameters=new F_e,this._drawParameters=new U_e,this._weatherTile=Ue(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=xt(Yo.default.coverage[0],Yo.default.coverage[1],.5),this.density=xt(Yo.default.density[0],Yo.default.density[1],.5),this.absorption=xt(Yo.default.absorption[0],Yo.default.absorption[1],.5),this.cloudSize=xt(Yo.default.cloudSize[0],Yo.default.cloudSize[1],.5),this.detailSize=xt(Yo.default.detailSize[0],Yo.default.detailSize[1],.5),this.smoothness=xt(Yo.default.smoothness[0],Yo.default.smoothness[1],.5),this.cloudHeight=xt(Yo.default.cloudHeight[0],Yo.default.cloudHeight[1],.5),this.raymarchingSteps=Yo.default.raymarchingSteps,this._viewMatrix=ve(),this._dirty=!1,this.running=!1,this._vao=Ol(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===Yb.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new V_e({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;nr(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),r_e(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Nr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(pt.CLOUDS_GENERATOR,this),ue(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),zr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Bi(e)),this._frameBufferCube=Fe(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Pe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case bl.SIXTEEN:return 1;case bl.HUNDRED:return 4;case bl.COUNT:case bl.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new v3({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new vr(e);r.target=os.TEXTURE_CUBE_MAP,r.wrapMode=Dt.CLAMP_TO_EDGE,this._frameBufferCube=new on(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Fe(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=xt(n[0],n[1],i);return r<.5?xt(n[0],o,2*r):xt(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),cn(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Bo.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Os.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,s=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const h=IBe[this._faceIndex],d=$Be[this._faceIndex];xge(this._viewMatrix,LBe,h,d),Eh(this._drawParameters.viewMatrix,this._viewMatrix);const f=os.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Os.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Bo.YIELD}};u([p({constructOnly:!0})],cl.prototype,"context",void 0),u([p({constructOnly:!0})],cl.prototype,"view",void 0),u([p({constructOnly:!0})],cl.prototype,"requestRender",void 0),u([p()],cl.prototype,"coverage",void 0),u([p()],cl.prototype,"density",void 0),u([p()],cl.prototype,"absorption",void 0),u([p()],cl.prototype,"cloudSize",void 0),u([p()],cl.prototype,"detailSize",void 0),u([p()],cl.prototype,"smoothness",void 0),u([p()],cl.prototype,"cloudHeight",void 0),u([p()],cl.prototype,"raymarchingSteps",void 0),u([p()],cl.prototype,"running",void 0),cl=u([R("esri.views.3d.environment.CloudsGenerator")],cl);const IBe=[Zr(1,0,0),Zr(-1,0,0),Zr(0,1,0),Zr(0,-1,0),Zr(0,0,1)],$Be=[Zr(0,1,0),Zr(0,1,0),Zr(0,0,-1),Zr(0,0,1),Zr(0,1,0)],LBe=gZ();let rve=class extends ei{constructor(){super(...arguments),this.fogColor=A(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function DBe(){const t=new wr;t.attributes.add(E.POSITION,"vec2"),t.include(Of,{textureCoordinateType:Ps.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Ni("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Ni("inverseViewMatrix",(i,s)=>QS(NBe,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Oe("atmosphereC",i=>i.atmosphereC),new zt("cameraPosition",(i,s)=>s.camera.eye),new Sr("nearFar",(i,s)=>s.camera.nearFar),new Je("depthTexture",i=>i.depthTexture),new Oe("fogStrength",i=>i.fogStrength),new Oe("fogAmount",i=>i.fogAmount),new zt("fogColor",i=>i.fogColor)),t.include(K5),r.include(fu),r.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(b`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(b`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const NBe=ve(),FBe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:rve,build:DBe},Symbol.toStringTag,{value:"Module"}));let ive=class sve extends Pr{constructor(e){super(e,new ha,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,sve.shader.get().build(),br)}initializePipeline(){return Ot({blending:bo(be.SRC_ALPHA,be.ZERO,be.ONE_MINUS_SRC_ALPHA,be.ONE),colorWrite:jt})}};ive.shader=new Er(FBe,()=>ae(()=>import("./Fog.glsl-ac350511.js"),[]));const UBe=.95,VBe=1;let l1=class extends xe{constructor(e){super(e),this._passParameters=new rve;const r=e.context.renderContext.rctx;this._vao=Ol(r,PR),this._technique=new ive(e);const i=Nr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+A0}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Et.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;ge(ite,i.eye);const s=Math.max(0,me(ite,e.bindParameters.lighting.mainLight.direction)),n=r.color;ie(ste,n,.1),Gr(this._passParameters.fogColor,ste,n,s);const o=Ee(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-fO(UBe*lf,VBe*lf,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([p({constructOnly:!0})],l1.prototype,"context",void 0),u([p({constructOnly:!0})],l1.prototype,"view",void 0),u([p({constructOnly:!0})],l1.prototype,"rctx",void 0),u([p({constructOnly:!0})],l1.prototype,"viewingMode",void 0),l1=u([R("esri.views.3d.environment.Fog")],l1);let zBe=class{constructor(){this.color=A(),this.strength=0,this.amount=0}};const ite=A(),ste=A();let No=class extends ha{};u([F({constValue:!0})],No.prototype,"hasSliceHighlight",void 0),u([F({constValue:!1})],No.prototype,"hasSliceInVertexProgram",void 0),u([F({constValue:!1})],No.prototype,"instancedDoublePrecision",void 0),u([F({constValue:!1})],No.prototype,"hasModelTransformation",void 0),u([F({constValue:Qr.Pass})],No.prototype,"pbrTextureBindType",void 0);var Bf;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Bf||(Bf={}));let _Z=class extends No{constructor(){super(...arguments),this.geometry=Bf.Cone}};u([F({count:Bf.COUNT})],_Z.prototype,"geometry",void 0);var L;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(L||(L={}));function IR(t){t.attributes.add(E.POSITION,"vec3"),t.vertex.code.add(b`vec3 positionModel() { return position; }`)}function SN({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(b`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(b`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let $h=class extends cs{constructor(e,r){super(e,"mat3",Qr.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function _2(t,e){t.include(IR);const r=t.vertex;r.include(SN,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new zt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new $h("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Ni("transformProjFromView",i=>i.transformProjFromView),new MO("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new nu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new nu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(b`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(b`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?b`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:b`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let nve=class extends ei{constructor(){super(...arguments),this.transformWorldFromViewTH=A(),this.transformWorldFromViewTL=A(),this.transformViewFromCameraRelativeRS=Fi(),this.transformProjFromView=ve()}},ove=class extends ei{constructor(){super(...arguments),this.transformWorldFromModelRS=Fi(),this.transformWorldFromModelTH=A(),this.transformWorldFromModelTL=A()}};function O_(t){t.varyings.add("linearDepth","float")}function Jb(t){t.vertex.uniforms.add(new Sr("nearFar",(e,r)=>r.camera.nearFar))}function sF(t){t.vertex.code.add(b`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function iE(t,e){const{vertex:r}=t;switch(e.output){case L.Color:if(e.receiveShadows)return O_(t),void r.code.add(b`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:return t.include(_2,e),O_(t),Jb(t),sF(t),void r.code.add(b`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(b`void forwardLinearDepth() {}`)}function wl(t){sF(t),t.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let vZ=class extends ei{constructor(){super(...arguments),this.texV=Ue(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new ave}},ave=class{constructor(){this.center=A(),this.v1=A(),this.v2=A()}};function kBe(t){const e=new wr,{vertex:r,fragment:i}=e;if(Wg(r),t.geometry===Bf.Underground)e.attributes.add(E.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new zt("cameraPosition",(s,n)=>n.camera.eye),new Oe("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(b`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(b`void main() {
fragColor = color;
}`);else{e.include(wl,t),e.attributes.add(E.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Bf.Cylinder;r.uniforms.add(new Ni("proj",(a,l)=>l.camera.projectionMatrix),new Ni("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new zt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new zt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new zt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Sr("texV",a=>a.texV)),r.uniforms.add(new Oe("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(b`
		void main(void) {
      ${s?b`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${b.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Je("tex",a=>a.texture)),s||i.uniforms.add(new Oe("altitudeFade",a=>a.altitudeFade)),i.code.add(b`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?b`fragColor = atmosphereColor;`:b`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const BBe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:ave,SimpleAtmospherePassParameters:vZ,build:kBe},Symbol.toStringTag,{value:"Module"}));let EN=class lve extends Pr{initializeProgram(e){return new Cr(e.rctx,lve.shader.get().build(this.configuration),br)}initializePipeline(){return this.configuration.geometry===Bf.Cylinder?Ot({blending:bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),culling:tZ,depthTest:{func:Kr.LEQUAL},colorWrite:jt}):Ot({blending:bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.LEQUAL},colorWrite:jt})}};EN.shader=new Er(BBe,()=>ae(()=>import("./SimpleAtmosphere.glsl-34adee54.js"),[]));const GBe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Sc(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).filter(i=>{var n;const s=(n=t.fields.get(i))==null?void 0:n.optional;return!(s&&s.glPadding)}).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=jBe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new mo(i,n,o,a,r,l,e)})}function jBe(t){const e=HBe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const HBe={u8:Ke.UNSIGNED_BYTE,u16:Ke.UNSIGNED_SHORT,u32:Ke.UNSIGNED_INT,i8:Ke.BYTE,i16:Ke.SHORT,i32:Ke.INT,f32:Ke.FLOAT};let bZ=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};bZ.ElementCount=9;let wZ=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};wZ.ElementCount=16;let Yg=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};Yg.ElementCount=1;let Jg=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,nr(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Jg.ElementCount=2;let Qg=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,se(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Qg.ElementCount=3;let Kg=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,wi(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Kg.ElementCount=4;let nF=class cve extends Yg{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new cve(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nF.ElementType="f32";let j_=class AB extends Jg{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(AB,e,r)}static fromTypedArray(e,r){return new AB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};j_.ElementType="f32";let an=class OB extends Qg{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(OB,e,r)}static fromTypedArray(e,r){return new OB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};an.ElementType="f32";let op=class RB extends Kg{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(RB,e,r)}static fromTypedArray(e,r){return new RB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};op.ElementType="f32";let R_=class PB extends bZ{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(PB,e,r)}static fromTypedArray(e,r){return new PB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};R_.ElementType="f32";let xZ=class MB extends bZ{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(MB,e,r)}static fromTypedArray(e,r){return new MB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};xZ.ElementType="f64";let TZ=class IB extends wZ{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(IB,e,r)}static fromTypedArray(e,r){return new IB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};TZ.ElementType="f32";let $O=class $B extends wZ{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer($B,e,r)}static fromTypedArray(e,r){return new $B(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};$O.ElementType="f64";let SZ=class LB extends Yg{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(LB,e,r)}static fromTypedArray(e,r){return new LB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};SZ.ElementType="f64";let EZ=class DB extends Jg{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(DB,e,r)}static fromTypedArray(e,r){return new DB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};EZ.ElementType="f64";let Ah=class NB extends Qg{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(NB,e,r)}static fromTypedArray(e,r){return new NB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ah.ElementType="f64";let oF=class FB extends Kg{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(FB,e,r)}static fromTypedArray(e,r){return new FB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};oF.ElementType="f64";let fS=class UB extends Yg{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(UB,e,r)}static fromTypedArray(e,r){return new UB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fS.ElementType="u8";let aF=class VB extends Jg{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(VB,e,r)}static fromTypedArray(e,r){return new VB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};aF.ElementType="u8";let lF=class zB extends Qg{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(zB,e,r)}static fromTypedArray(e,r){return new zB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lF.ElementType="u8";let ca=class kB extends Kg{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(kB,e,r)}static fromTypedArray(e,r){return new kB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ca.ElementType="u8";let cF=class BB extends Yg{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(BB,e,r)}static fromTypedArray(e,r){return new BB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cF.ElementType="u16";let CZ=class GB extends Jg{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(GB,e,r)}static fromTypedArray(e,r){return new GB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};CZ.ElementType="u16";let uF=class jB extends Qg{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(jB,e,r)}static fromTypedArray(e,r){return new jB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uF.ElementType="u16";let $R=class HB extends Kg{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(HB,e,r)}static fromTypedArray(e,r){return new HB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};$R.ElementType="u16";let hF=class qB extends Yg{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(qB,e,r)}static fromTypedArray(e,r){return new qB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hF.ElementType="u32";let AZ=class WB extends Jg{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(WB,e,r)}static fromTypedArray(e,r){return new WB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};AZ.ElementType="u32";let uve=class ZB extends Qg{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(ZB,e,r)}static fromTypedArray(e,r){return new ZB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uve.ElementType="u32";let hve=class XB extends Kg{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(XB,e,r)}static fromTypedArray(e,r){return new XB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hve.ElementType="u32";let OZ=class YB extends Yg{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(YB,e,r)}static fromTypedArray(e,r){return new YB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};OZ.ElementType="i8";let dF=class JB extends Jg{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(JB,e,r)}static fromTypedArray(e,r){return new JB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dF.ElementType="i8";let dve=class QB extends Qg{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(QB,e,r)}static fromTypedArray(e,r){return new QB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dve.ElementType="i8";let pve=class KB extends Kg{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(KB,e,r)}static fromTypedArray(e,r){return new KB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pve.ElementType="i8";let fve=class e7 extends Yg{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(e7,e,r)}static fromTypedArray(e,r){return new e7(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fve.ElementType="i16";let LR=class t7 extends Jg{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(t7,e,r)}static fromTypedArray(e,r){return new t7(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};LR.ElementType="i16";let mve=class r7 extends Qg{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(r7,e,r)}static fromTypedArray(e,r){return new r7(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};mve.ElementType="i16";let gve=class i7 extends Kg{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(i7,e,r)}static fromTypedArray(e,r){return new i7(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gve.ElementType="i16";let yve=class s7 extends Yg{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(s7,e,r)}static fromTypedArray(e,r){return new s7(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};yve.ElementType="i32";let _ve=class n7 extends Jg{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(n7,e,r)}static fromTypedArray(e,r){return new n7(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};_ve.ElementType="i32";let vve=class o7 extends Qg{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(o7,e,r)}static fromTypedArray(e,r){return new o7(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vve.ElementType="i32";let bve=class a7 extends Kg{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(a7,e,r)}static fromTypedArray(e,r){return new a7(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};bve.ElementType="i32";function nte(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let ote=class wve{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new wve(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}},xve=class Tve{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:ZBe(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,j_,r),this}vec2f64(e,r){return this._appendField(e,EZ,r),this}vec3f(e,r){return this._appendField(e,an,r),this}vec3f64(e,r){return this._appendField(e,Ah,r),this}vec4f(e,r){return this._appendField(e,op,r),this}vec4f64(e,r){return this._appendField(e,oF,r),this}mat3f(e,r){return this._appendField(e,R_,r),this}mat3f64(e,r){return this._appendField(e,xZ,r),this}mat4f(e,r){return this._appendField(e,TZ,r),this}mat4f64(e,r){return this._appendField(e,$O,r),this}vec4u8(e,r){return this._appendField(e,ca,r),this}f32(e,r){return this._appendField(e,nF,r),this}f64(e,r){return this._appendField(e,SZ,r),this}u8(e,r){return this._appendField(e,fS,r),this}u16(e,r){return this._appendField(e,cF,r),this}i8(e,r){return this._appendField(e,OZ,r),this}vec2i8(e,r){return this._appendField(e,dF,r),this}vec2i16(e,r){return this._appendField(e,LR,r),this}vec2u8(e,r){return this._appendField(e,aF,r),this}vec4u16(e,r){return this._appendField(e,$R,r),this}u32(e,r){return this._appendField(e,hF,r),this}_appendField(e,r,i){if(this._fields.has(e))return void tt(!1,`${e} already added to vertex buffer layout`);const s=r.ElementCount*nte(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:r,offset:n,optional:i})}createBuffer(e){return new ote(this,e)}createView(e){return new ote(this,e)}clone(){const e=new Tve;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,nte(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Hi(){return new xve}let qBe=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const s={...r,constructor:Sve(r.constructor)};this.fields.push([i,s])}),this.stride=e.stride}};const WBe=[nF,j_,an,op,R_,TZ,SZ,EZ,Ah,oF,xZ,$O,fS,aF,lF,ca,cF,CZ,uF,$R,hF,AZ,uve,hve,OZ,dF,dve,pve,fve,LR,mve,gve,yve,_ve,vve,bve];function Sve(t){return`${t.ElementType}_${t.ElementCount}`}function ZBe(t){return Eve.get(t)}const Eve=new Map;WBe.forEach(t=>Eve.set(Sve(t),t));function zo(t,e=!1){return t<=cu?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function Cve(t){return(ep(t)?t.length:t.byteLength/8)<=cu?Array.from(t):new Float64Array(t)}function fh(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function G3t(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function j3t(t){return Array.isArray(t)?new Float64Array(t):t}function Qi(t,e=!1){return t<=cu?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function H3t(t){return ep(t)?t.length<cu?t:new Float32Array(t):t.length<cu?Array.from(t):t}function ate(t){return(ep(t)?t.length:t.byteLength/8)<=cu?Array.from(t):new Float32Array(t)}function CN(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Pf(t){return ep(t)?t.length<cu?t:lte(t):t.length<cu?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:lte(t)}function lte(t){let e=!0;for(const r of t){if(r>=65536)return ep(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function AN(t){return t<=cu?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function XBe(t){return t<=cu?new Array(t):new Uint32Array(t)}let Hw=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const Ave=[0],AU=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function mS(t){if(t===1)return Ave;if(t<cu)return Array.from(new Uint16Array(AU.buffer,0,t));if(t<AU.length)return new Uint16Array(AU.buffer,0,t);if(t>Hw.length){const e=Math.max(2*Hw.length,t);Hw=new Uint32Array(e);for(let r=0;r<Hw.length;r++)Hw[r]=r}return new Uint32Array(Hw.buffer,0,t)}let KP=new Uint8Array(65536);function sE(t){if(t===1)return Ave;if(t<cu)return new Array(t).fill(0);if(t>KP.length){const e=Math.max(2*KP.length,t);KP=new Uint8Array(e)}return new Uint8Array(KP.buffer,0,t)}let Ve=class{constructor(e,r,i=!1,s=r){this.data=e,this.size=r,this.exclusive=i,this.stride=s}};var l7;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],d=1/Math.sqrt(l*l+c*c+h*h);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]+l[c],h[d+1]=o[a+1]+l[c+1],h[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,d=a){(h=h||o)[d]=o[a]-l[c],h[d+1]=o[a+1]-l[c+1],h[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(l7||(l7={}));var as;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(as||(as={}));function YBe(t){if(t.length<cu)return Array.from(t);if(ep(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return q4(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let Ove=class Rve{constructor(e,r,i,s){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,tt(e.length>=1),tt(i.length%this._numIndexPerPrimitive==0),tt(i.length>=e.length*this._numIndexPerPrimitive),tt(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];nv.clear(),nv.push(l);const c=Ae(n[l],n[l+1],n[l+2]),h=Is(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[y+_],nv.push(l);let v=n[l];c[0]=Math.min(v,c[0]),h[0]=Math.max(v,h[0]),v=n[l+1],c[1]=Math.min(v,c[1]),h[1]=Math.max(v,h[1]),v=n[l+2],c[2]=Math.min(v,c[2]),h[2]=Math.max(v,h[2])}}this.bbMin=c,this.bbMax=h;const d=Gr(A(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<nv.length;++m){l=nv.at(m);const y=n[l]-d[0],_=n[l+1]-d[1],v=n[l+2]-d[2],w=y*y+_*_+v*v;if(w<=f)continue;const T=Math.sqrt(w),x=.5*(T-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const S=x/T;d[0]+=y*S,d[1]+=_*S,d[2]+=v*S}this.center=d,nv.clear()}getChildren(){if(this._children||fo(this.bbMin,this.bbMax)<=1)return this._children;const e=Gr(A(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const d=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[d],m=n[f],y=n[f+1],_=n[f+2];for(let v=1;v<this._numIndexPerPrimitive;++v){f=o*this.indices[d+v];const w=n[f],T=n[f+1],x=n[f+2];w<m&&(m=w),T<y&&(y=T),x<_&&(_=x)}m<e[0]&&(h|=1),y<e[1]&&(h|=2),_<e[2]&&(h|=4),i[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new Rve(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){nv.prune()}};const nv=new Gt({deallocator:null});let DR=class{constructor(){this.id=pc()}unload(){}};function JBe(t){return t?{p0:Is(t.p0),p1:Is(t.p1),p2:Is(t.p2)}:{p0:A(),p1:A(),p2:A()}}function cte(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function QBe(t,e,r){return he(OU,e,t),he(ute,r,t),Ee(ot(OU,OU,ute))/2}new Hg(cp);new Hg(()=>JBe());const OU=A(),ute=A();function KBe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0),se(Zu,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*i,c=e[a+1]*i,h=e[a+2]*i;se(zn,s[l],s[l+1],s[l+2]),se(ag,s[c],s[c+1],s[c+2]),se(eM,s[h],s[h+1],s[h+2]);const d=QBe(zn,ag,eM);d?(le(zn,zn,ag),le(zn,zn,eM),ie(zn,zn,1/3*d),le(r,r,zn),n+=d):(le(Zu,Zu,zn),le(Zu,Zu,ag),le(Zu,Zu,eM),o+=3)}return(o!==0||n!==0)&&(n!==0?(ie(r,r,1/n),!0):o!==0&&(ie(r,Zu,1/o),!0))}function e7e(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;n!==l&&(r[0]+=s[l],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&ie(r,r,1/o),o>0}function t7e(t,e,r,i){if(!t)return!1;se(i,0,0,0),se(Zu,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const d=h<l?h:l,f=h<l?h+1:0,m=(e?e[d]:d)*o,y=(e?e[f]:f)*o;zn[0]=a[m],zn[1]=a[m+1],zn[2]=a[m+2],ag[0]=a[y],ag[1]=a[y+1],ag[2]=a[y+2],ie(zn,le(zn,zn,ag),.5);const _=gR(zn,ag);_>0?(le(i,i,ie(zn,zn,_)),s+=_):s===0&&(le(Zu,Zu,zn),n++)}return s!==0?(ie(i,i,1/s),!0):n!==0&&(ie(i,Zu,1/n),!0)}const zn=A(),ag=A(),eM=A(),Zu=A();let ON=class{constructor(e){this.channel=e,this.id=pc()}};function c7(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function r7e(t,e){const r=t.length;for(let i=0;i<r;++i)QT[0]=t[i],e[i]=QT[0];return e}function i7e(t,e){const r=t.length;for(let i=0;i<r;++i)QT[0]=t[i],QT[1]=t[i]-QT[0],e[i]=QT[1];return e}const QT=new Float32Array(2);function u7(t,e){return t==null&&(t=[]),t.push(e),t}function h7(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function s7e(t,e,r,i,s){tM[0]=t.get(e,0),tM[1]=t.get(e,1),tM[2]=t.get(e,2),c7(tM,ov,3),r.set(s,0,ov[0]),i.set(s,0,ov[1]),r.set(s,1,ov[2]),i.set(s,1,ov[3]),r.set(s,2,ov[4]),i.set(s,2,ov[5])}const tM=A(),ov=new Float32Array(6);let Hs=class Pve extends DR{constructor(e,r,i=[],s=null,n=as.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=n7e(this._vertexAttributes),c=mS(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of i)c&&(this._indices.set(l,Pf(c)),l===E.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new Pve(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:YBe(r.data)},this._vertexAttributes.set(e,r)),r}setAttributeData(e,r){const i=this._vertexAttributes.get(e);i&&this._vertexAttributes.set(e,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===as.Mesh?this._computeAttachmentOriginTriangles(e):this.type===as.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&$e(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return KBe(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(E.POSITION),i=this.indices.get(E.POSITION);return t7e(r,i,i&&o7e(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return e7e(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(E.POSITION),r=this.vertexAttributes.get(E.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===as.Mesh?3:1;tt(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const s=mS(e.length/i);return new Ove(s,i,e,r)}get transformation(){return this._transformation??nn}set transformation(e){this._transformation=e&&e!==nn?iS(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new ON(Vg.Highlight);return this.highlights=u7(this.highlights,e),e}removeHighlight(e){this.highlights=h7(this.highlights,e)}};function n7e(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function o7e(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const qw=l7,RU=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],a7e=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],l7e=[0,0,1,0,1,1,0,1],c7e=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],Mve=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)Mve[6*t+e]=t;const c1=new Array(36);for(let t=0;t<6;t++)c1[6*t]=0,c1[6*t+1]=1,c1[6*t+2]=2,c1[6*t+3]=2,c1[6*t+4]=3,c1[6*t+5]=0;function u7e(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=RU[i][0]*e[0],r[3*i+1]=RU[i][1]*e[1],r[3*i+2]=RU[i][2]*e[2];return new Hs(t,[[E.POSITION,new Ve(r,3,!0)],[E.NORMAL,new Ve(a7e,3)],[E.UV0,new Ve(l7e,2)]],[[E.POSITION,c7e],[E.NORMAL,Mve],[E.UV0,c1]])}const PU=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],h7e=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],d7e=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],p7e=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function f7e(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=PU[i][0]*e[0],r[3*i+1]=PU[i][1]*e[1],r[3*i+2]=PU[i][2]*e[2];return new Hs(t,[[E.POSITION,new Ve(r,3,!0)],[E.NORMAL,new Ve(h7e,3)]],[[E.POSITION,d7e],[E.NORMAL,p7e]])}const uL=Zr(-.5,0,-.5),hL=Zr(.5,0,-.5),dL=Zr(0,0,.5),pL=Zr(0,.5,0),Ww=ns(),Zw=ns(),v2=ns(),b2=ns(),w2=ns();he(Ww,uL,pL),he(Zw,uL,hL),ot(v2,Ww,Zw),ge(v2,v2),he(Ww,hL,pL),he(Zw,hL,dL),ot(b2,Ww,Zw),ge(b2,b2),he(Ww,dL,pL),he(Zw,dL,uL),ot(w2,Ww,Zw),ge(w2,w2);const MU=[uL,hL,dL,pL],m7e=[0,-1,0,v2[0],v2[1],v2[2],b2[0],b2[1],b2[2],w2[0],w2[1],w2[2]],g7e=[0,1,2,3,1,0,3,2,1,3,0,2],y7e=[0,0,0,1,1,1,2,2,2,3,3,3];function _7e(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=MU[i][0]*e[0],r[3*i+1]=MU[i][1]*e[1],r[3*i+2]=MU[i][2]*e[2];return new Hs(t,[[E.POSITION,new Ve(r,3,!0)],[E.NORMAL,new Ve(m7e,3)]],[[E.POSITION,g7e],[E.NORMAL,y7e]])}function X3t(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),d=(c+1)*(h+1),f=Qi(3*d),m=Qi(3*d),y=Qi(2*d),_=[];let v=0;for(let S=0;S<=h;S++){const O=[],C=S/h,P=a+C*l,$=Math.cos(P);for(let V=0;V<=c;V++){const z=V/c,B=n+z*o,k=Math.cos(B)*$,Z=Math.sin(P),W=-Math.sin(B)*$;f[3*v]=k*e,f[3*v+1]=Z*e,f[3*v+2]=W*e,m[3*v]=k,m[3*v+1]=Z,m[3*v+2]=W,y[2*v]=z,y[2*v+1]=C,O.push(v),++v}_.push(O)}const w=new Array;for(let S=0;S<h;S++)for(let O=0;O<c;O++){const C=_[S][O],P=_[S][O+1],$=_[S+1][O+1],V=_[S+1][O];S===0?(w.push(C),w.push($),w.push(V)):S===h-1?(w.push(C),w.push(P),w.push($)):(w.push(C),w.push(P),w.push($),w.push($),w.push(V),w.push(C))}const T=[[E.POSITION,w],[E.NORMAL,w]],x=[[E.POSITION,new Ve(f,3,!0)],[E.NORMAL,new Ve(m,3,!0)]];return s.uv&&(x.push([E.UV0,new Ve(y,2,!0)]),T.push([E.UV0,w])),s.offset&&(T[0][0]=E.OFFSET,x[0][0]=E.OFFSET,T.push([E.POSITION,sE(w.length)]),x.push([E.POSITION,new Ve(Float64Array.from(s.offset),3,!0)])),new Hs(t,x,T)}function v7e(t,e,r,i){const{vertexAttributes:s,indices:n}=Ive(e,r,i);return new Hs(t,s,n)}function Ive(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=i*(1+Math.sqrt(5))/2;s=[-i,h,0,i,h,0,-i,-h,0,i,-h,0,0,-i,h,0,i,h,0,-i,-h,0,i,-h,h,0,-i,h,0,i,-h,0,-i,-h,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)qw.scale(s,h,t/qw.length(s,h));let o={};function a(h,d){h>d&&([h,d]=[d,h]);const f=h.toString()+"."+d.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,qw.add(s,3*h,s,3*d,s,m),qw.scale(s,m,t/qw.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const d=n.length,f=new Array(4*d);for(let m=0;m<d;m+=3){const y=n[m],_=n[m+1],v=n[m+2],w=a(y,_),T=a(_,v),x=a(v,y),S=4*m;f[S]=y,f[S+1]=w,f[S+2]=x,f[S+3]=_,f[S+4]=T,f[S+5]=w,f[S+6]=v,f[S+7]=x,f[S+8]=T,f[S+9]=w,f[S+10]=T,f[S+11]=x}n=f,o={}}const l=ate(s);for(let h=0;h<l.length;h+=3)qw.normalize(l,h);const c=[[E.POSITION,n],[E.NORMAL,n]];return{vertexAttributes:[[E.POSITION,new Ve(ate(s),3,!0)],[E.NORMAL,new Ve(l,3,!0)]],indices:c}}function d7(t,e,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],f=s!=null&&s.length===2?s:[1,1],m=[[E.POSITION,new Ve(c,3,!0)],[E.NORMAL,new Ve(h,3,!0)],[E.UV0,new Ve(o,o.length)],[E.COLOR,new Ve(d,4,!0)],[E.SIZE,new Ve(f,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];m.push([E.AUXPOS1,new Ve(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];m.push([E.AUXPOS2,new Ve(y,4)])}return new Hs(t,m,null,null,as.Point,l)}const b7e=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Y3t(t,e=b7e){const r=new Array(12);for(let h=0;h<4;h++)for(let d=0;d<3;d++)r[3*h+d]=e[h][d];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[E.POSITION,i],[E.NORMAL,n],[E.UV0,i],[E.COLOR,n]],c=[[E.POSITION,new Ve(r,3,!0)],[E.NORMAL,new Ve(s,3,!0)],[E.UV0,new Ve(o,2,!0)],[E.COLOR,new Ve(a,4,!0)]];return new Hs(t,c,l)}function hte(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let h=Zr(0,a,0),d=Zr(0,a+c,0),f=Zr(0,-1,0),m=Zr(0,1,0);s&&(a=c,d=Zr(0,0,0),h=Zr(0,a,0),f=Zr(0,1,0),m=Zr(0,-1,0));const y=[d,h],_=[f,m],v=i+2,w=Math.sqrt(c*c+l*l);if(s)for(let $=i-1;$>=0;$--){const V=$*(2*Math.PI/i),z=Zr(Math.cos(V)*l,a,Math.sin(V)*l);y.push(z);const B=Zr(c*Math.cos(V)/w,-l/w,c*Math.sin(V)/w);_.push(B)}else for(let $=0;$<i;$++){const V=$*(2*Math.PI/i),z=Zr(Math.cos(V)*l,a,Math.sin(V)*l);y.push(z);const B=Zr(c*Math.cos(V)/w,l/w,c*Math.sin(V)/w);_.push(B)}const T=new Array,x=new Array;if(n){for(let $=3;$<y.length;$++)T.push(1),T.push($-1),T.push($),x.push(0),x.push(0),x.push(0);T.push(y.length-1),T.push(2),T.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let $=3;$<y.length;$++)T.push($),T.push($-1),T.push(0),x.push($),x.push($-1),x.push(1);T.push(0),T.push(2),T.push(y.length-1),x.push(1),x.push(2),x.push(_.length-1)}const S=Qi(3*v);for(let $=0;$<v;$++)S[3*$]=y[$][0],S[3*$+1]=y[$][1],S[3*$+2]=y[$][2];const O=Qi(3*v);for(let $=0;$<v;$++)O[3*$]=_[$][0],O[3*$+1]=_[$][1],O[3*$+2]=_[$][2];const C=[[E.POSITION,T],[E.NORMAL,x]],P=[[E.POSITION,new Ve(S,3,!0)],[E.NORMAL,new Ve(O,3,!0)]];return new Hs(t,P,C)}function w7e(t,e,r,i,s,n,o){const a=s?bN(s):Zr(1,0,0),l=n?bN(n):Zr(0,0,0);o??(o=!0);const c=ns();ge(c,a);const h=ns();ie(h,c,Math.abs(e));const d=ns();ie(d,h,-.5),le(d,d,l);const f=Zr(0,1,0);Math.abs(1-me(c,f))<.2&&se(f,0,0,1);const m=ns();ot(m,c,f),ge(m,m),ot(f,m,c);const y=2*i+(o?2:0),_=i+(o?2:0),v=Qi(3*y),w=Qi(3*_),T=Qi(2*y),x=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(y-2)]=d[0],v[3*(y-2)+1]=d[1],v[3*(y-2)+2]=d[2],T[2*(y-2)]=0,T[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+h[0],v[3*(y-1)+1]=v[3*(y-2)+1]+h[1],v[3*(y-1)+2]=v[3*(y-2)+2]+h[2],T[2*(y-1)]=1,T[2*(y-1)+1]=1,w[3*(_-2)]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const O=(B,k,Z)=>{x[B]=k,S[B]=Z};let C=0;const P=ns(),$=ns();for(let B=0;B<i;B++){const k=B*(2*Math.PI/i);ie(P,f,Math.sin(k)),ie($,m,Math.cos(k)),le(P,P,$),w[3*B]=P[0],w[3*B+1]=P[1],w[3*B+2]=P[2],ie(P,P,r),le(P,P,d),v[3*B]=P[0],v[3*B+1]=P[1],v[3*B+2]=P[2],T[2*B]=B/i,T[2*B+1]=0,v[3*(B+i)]=v[3*B]+h[0],v[3*(B+i)+1]=v[3*B+1]+h[1],v[3*(B+i)+2]=v[3*B+2]+h[2],T[2*(B+i)]=B/i,T[2*B+1]=1;const Z=(B+1)%i;O(C++,B,B),O(C++,B+i,B),O(C++,Z,Z),O(C++,Z,Z),O(C++,B+i,B),O(C++,Z+i,Z)}if(o){for(let B=0;B<i;B++){const k=(B+1)%i;O(C++,y-2,_-2),O(C++,B,_-2),O(C++,k,_-2)}for(let B=0;B<i;B++){const k=(B+1)%i;O(C++,B+i,_-1),O(C++,y-1,_-1),O(C++,k+i,_-1)}}const V=[[E.POSITION,x],[E.NORMAL,S],[E.UV0,x]],z=[[E.POSITION,new Ve(v,3,!0)],[E.NORMAL,new Ve(w,3,!0)],[E.UV0,new Ve(T,2,!0)]];return new Hs(t,z,V)}function J3t(t,e,r,i,s,n,o=Zr(0,0,0)){const a=e.length,l=Qi(r.length*a*3+(6*i.length||0)),c=Qi(r.length*a*3+(i?6:0)),h=new Array,d=new Array;let f=0,m=0;const y=ns(),_=ns(),v=ns(),w=ns(),T=ns(),x=ns(),S=ns(),O=A(),C=ns(),P=ns(),$=ns(),V=ns(),z=ns(),B=Ir();se(C,0,1,0),he(_,r[1],r[0]),ge(_,_),n?(le(O,r[0],o),ge(v,O)):se(v,0,0,1),RN(_,v,C,C,T,v,dte),re(w,v),re(V,T);for(let N=0;N<i.length;N++)ie(x,T,i[N][0]),ie(O,v,i[N][2]),le(x,x,O),le(x,x,r[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let N=0;N<s.length;N++)h.push(s[N][0]>0?s[N][0]:-s[N][0]-1+i.length),h.push(s[N][1]>0?s[N][1]:-s[N][1]-1+i.length),h.push(s[N][2]>0?s[N][2]:-s[N][2]-1+i.length),d.push(0),d.push(0),d.push(0);let k=i.length;const Z=i.length-1;for(let N=0;N<r.length;N++){let G=!1;N>0&&(re(y,_),N<r.length-1?(he(_,r[N+1],r[N]),ge(_,_)):G=!0,le(P,y,_),ge(P,P),le($,r[N-1],w),RR(r[N],P,B),Ew(B,pu($,y),O)?(he(O,O,r[N]),ge(v,O),ot(T,P,v),ge(T,T)):RN(P,w,V,C,T,v,dte),re(w,v),re(V,T)),n&&(le(O,r[N],o),ge(z,O));for(let X=0;X<a;X++)if(ie(x,T,e[X][0]),ie(O,v,e[X][1]),le(x,x,O),ge(S,x),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],le(x,x,r[N]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!G){const J=(X+1)%a;h.push(k+X),h.push(k+a+X),h.push(k+J),h.push(k+J),h.push(k+a+X),h.push(k+a+J);for(let ee=0;ee<6;ee++){const ye=h.length-6;d.push(h[ye+ee]-Z)}}k+=a}const W=r[r.length-1];for(let N=0;N<i.length;N++)ie(x,T,i[N][0]),ie(O,v,i[N][1]),le(x,x,O),le(x,x,W),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const j=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const Y=k-a;for(let N=0;N<s.length;N++)h.push(s[N][0]>=0?k+s[N][0]:-s[N][0]-1+Y),h.push(s[N][2]>=0?k+s[N][2]:-s[N][2]-1+Y),h.push(s[N][1]>=0?k+s[N][1]:-s[N][1]-1+Y),d.push(j),d.push(j),d.push(j);const M=[[E.POSITION,h],[E.NORMAL,d]],D=[[E.POSITION,new Ve(l,3,!0)],[E.NORMAL,new Ve(c,3,!0)]];return new Hs(t,D,M)}function Q3t(t,e,r,i){tt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),tt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),tt(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),tt(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=zo(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let d=0;d<3;d++)s[o++]=e[h][d];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([E.POSITION,n]),c.push([E.POSITION,new Ve(s,3,!0)]),r){const h=Qi(3*r.length);let d=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[d++]=r[f][m];l.push([E.NORMAL,n]),c.push([E.NORMAL,new Ve(h,3,!0)])}return i&&(c.push([E.COLOR,new Ve(i,4)]),l.push([E.COLOR,mS(i.length/4)])),new Hs(t,c,l,null,as.Line)}function x7e(t,e=t){const r=t.vertexAttributes,i=r.get(E.POSITION).data,s=r.get(E.NORMAL).data;if(s){const n=e.getMutableAttribute(E.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(E.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function IU(t,e,r,i,s){return!(Math.abs(me(e,t))>s)&&(ot(r,t,e),ge(r,r),ot(i,r,t),ge(i,i),!0)}function RN(t,e,r,i,s,n,o){return IU(t,e,s,n,o)||IU(t,r,s,n,o)||IU(t,i,s,n,o)}const dte=.99619469809;let T7e=class{constructor(e,r){this.type=Jo.Local,this._configuration=new _Z,this._passParameters=new vZ,this._configuration.geometry=Bf.Cylinder,this._technique=r.techniqueRepository.acquire(EN,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Do(this._vao,"geometry");const s=new vr;s.wrapMode=Dt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Ct(i,s,GBe)}destroy(){this._passParameters.texture=Fe(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);S7e(pte,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",pte),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Et.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=Ive(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=fte.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new up(e,br,{geometry:Sc(fte)},{geometry:Lr.createVertex(e,Tr.STATIC_DRAW,o.buffer)})}};function S7e(t,e){$s(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const pte=ve(),fte=Hi().vec3f(E.POSITION),E7e=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),rM=128,mte=-yB,gte=0,$U=50,C7e=()=>1-511/512,A7e=K$([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let O7e=class{constructor(e,r){this.view=e,this.type=Jo.Mars,this._passParameters=new vZ,this._vaoCount=0,this._texV1=1;const i=Nr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+mte)/this._planetRadius,this._middleRimFactor=(this._planetRadius+gte)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=gte/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=ue(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),As),this._vao=this._createRibbon(s),this._vaoCount=Do(this._vao,"geometry"),this._fadeVao=Ol(s),this._fadeVaoCount=Do(this._fadeVao,"geometry");const n=new vr;n.wrapMode=Dt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Ct(s,n,E7e);const o=new _Z;o.geometry=Bf.Cone,this._coneTechnique=this._techniqueRepository.acquire(EN,o),o.geometry=Bf.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(EN,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Fe(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(Et.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(Et.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=A(),i=this._planetRadius,s=Ee(e.eye),n=s-i;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max($U,n),a=i+mte;this._passParameters.innerScale=R7e(i+o,i,a)-1,this._passParameters.altitudeFade=eZ(n),ie(r,e.eye,(i+$U)/s),yte(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=C7e(),h=A7e(n);let d=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>$U){yte(e.eye,e.center,e.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=_e((m-1.5)/(l-1.5),0,1);d=this._texV0+y*c*this._texVScale,f=this._texV0+xt(this._texV1,l*h,y)*this._texVScale}nr(this._passParameters.texV,d,f)}_createRibbon(e){const r=Qi(3+3*rM*3),i=new Uint32Array(3*rM*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<rM;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===rM-1?1:l+3,h=15*o;i[h]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const s=_te.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new up(e,br,{geometry:Sc(_te)},{geometry:Lr.createVertex(e,Tr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return le(Xw,s.center,s.v2),ie(iM,Xw,this._outerRimFactor),L5(LU,r,Xw,i),Vee(Xw,LU,e.projectionMatrix,e.viewport,Xw),Vee(iM,LU,e.projectionMatrix,e.viewport,iM),mi(Xw,iM)/e.height}};function yte(t,e,r,i,s){const n=Ee(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return ie(s.center,t,a/n),ot(l,t,e),ra(l)<1&&ot(l,t,r),ie(l,l,o/Ee(l)),ot(c,l,t),ie(c,c,o/Ee(c)),o}const LU=ve(),Xw=A(),iM=A();function R7e(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const _te=Hi().vec3f(E.POSITION);var zg;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(zg||(zg={}));let p7=class extends ha{constructor(){super(...arguments),this.type=zg.Rain}};u([F({count:zg.COUNT})],p7.prototype,"type",void 0);function P7e(t){const e=new wr;return e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new zt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new zt("offset",(r,i)=>M7e(r,i))),e.vertex.uniforms.add(new Oe("width",r=>r.width)),e.vertex.uniforms.add(new Ni("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new Ni("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Oe("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(b`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===zg.Rain?b`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Oe("opacity",r=>r.opacity),new zt("particleColor",(r,i)=>I7e(i,t))),e.fragment.code.add(b`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===zg.Rain?b`d = 0.35 * smoothstep(0.5, 0.0, d);`:b`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function M7e(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=dpe(f7,se(f7,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return bn(n,r,ie(n,n,t.width))}function I7e(t,e){const r=e.type===zg.Rain?L7e:$7e,i=ie(f7,r,D7e),s=t.camera.eye;ge(vte,s);const n=Math.max(0,me(vte,t.lighting.mainLight.direction));return Gr(i,i,r,n)}const f7=A(),vte=A(),$7e=Ae(1,1,1),L7e=Ae(.85,.85,.85),D7e=.7,N7e=Object.freeze(Object.defineProperty({__proto__:null,build:P7e},Symbol.toStringTag,{value:"Module"}));let F7e=class extends ei{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},m7=class $ve extends Pr{initializeProgram(e){return new Cr(e.rctx,$ve.shader.get().build(this.configuration),fL)}initializePipeline(){return Ot({blending:bo(be.ONE,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.LEQUAL},colorWrite:jt})}};m7.shader=new Er(N7e,()=>ae(()=>import("./Precipitation.glsl-7539e44b.js"),[]));const fL=new Map([[E.POSITION,0],[E.INSTANCEFEATUREATTRIBUTE,1]]);let Lve=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},U7e=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},u1=class extends xe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new F7e,this._animation=new Lve,this._updatingTracking=new Ef,this._passParameters.time=0,this._passParameters.radius=Nr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Bi(this._snowTechniqueCached),this._rainTechniqueCached=Bi(this._rainTechniqueCached),this._vao=Fe(this._vao),this._instanceIdBuffer=Fe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new p7;e.type=zg.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(m7,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new p7;e.type=zg.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(m7,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){var l;const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?xt(0,o,2*r):xt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*jH(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),iZ(n,fL,this._instanceIdBuffer,bte,0),(l=n.capabilities.instancing)==null||l.drawArraysInstanced(Et.TRIANGLES,0,3,this._numParticles*r),sZ(n,fL,this._instanceIdBuffer,bte)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Lr.createVertex(e,Tr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new up(e,fL,{geometry:Sc(V7e)},{geometry:Lr.createVertex(e,Tr.STATIC_DRAW,r)})}};u([p({constructOnly:!0})],u1.prototype,"context",void 0),u([p({constructOnly:!0})],u1.prototype,"view",void 0),u([p({readOnly:!0})],u1.prototype,"updating",null),u([p()],u1.prototype,"_updatingTracking",void 0),u1=u([R("esri.views.3d.environment.Precipitation")],u1);const V7e=Hi().vec3f(E.POSITION),bte=Sc(Hi().f32(E.INSTANCEFEATUREATTRIBUTE),1);function z7e(){const t=new wr;return t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.COLOR,"vec4"),t.attributes.add(E.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Ni("transform",(e,r)=>k7e(e,r)),new ir("viewport",(e,r)=>r.camera.fullViewport),new Oe("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(b`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(b`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function k7e(t,e){return $s(_y,e.camera.projectionMatrix),_y[10]=24e-8-1,_y[11]=-1,_y[14]=(24e-8-2)*e.camera.near,ni(_y,_y,e.camera.viewMatrix),ni(_y,_y,t.modelMatrix)}const _y=ve(),B7e=Object.freeze(Object.defineProperty({__proto__:null,build:z7e},Symbol.toStringTag,{value:"Module"}));let G7e=class extends ei{constructor(){super(...arguments),this.modelMatrix=ve()}},Dve=class Nve extends Pr{constructor(e){super(e,new ha,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,Nve.shader.get().build(),br)}initializePipeline(){return Ot({blending:bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.LEQUAL},colorWrite:jt})}};Dve.shader=new Er(B7e,()=>ae(()=>import("./Stars.glsl-bfe56d84.js"),[]));let d0=class extends xe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new G7e,this._updatingTracking=new Ef}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=lu(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Bi(this._technique),this._vao=Fe(this._vao),av=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Et.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||av==null)return;this._technique=new Dve({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=av.byteLength/wte;const r=new Float32Array(av,0,2*this._numPoints),i=new Uint8Array(av,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),zr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=$s(this._renderParameter.modelMatrix,q7e);tS(s,s,-i*Math.PI),ni(s,H7e,s),tS(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=xte.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const h=r[2*c],d=r[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(d)),o.set(c,1,-Math.sin(h)*Math.sin(d)),o.set(c,2,-Math.cos(d));const f=this._unpackUint8Attributes(i[c]),m=this._hexToRGB(j7e[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new up(e,br,{geometry:Sc(xte)},{geometry:Lr.createVertex(e,Tr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(av!=null)return null;const e=kS(async r=>{const{data:i}=await t$e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),av=i});return e.promise.catch(r=>{ys(r)||Q.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new U("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/wte;if(r%1!=0||r>5e4||r<5e3)throw new U("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([p({constructOnly:!0})],d0.prototype,"view",void 0),u([p({constructOnly:!0})],d0.prototype,"requestRender",void 0),u([p({readOnly:!0})],d0.prototype,"updating",null),u([p()],d0.prototype,"_loadDataTask",void 0),u([p()],d0.prototype,"_updatingTracking",void 0),d0=u([R("esri.views.3d.environment.Stars")],d0);const j7e=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],H7e=PW(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),q7e=PW(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),wte=9,xte=Hi().vec3f(E.POSITION).vec4u8(E.COLOR).f32(E.SIZE);let av=null;function W7e(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function PN(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function RZ(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Xa()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function pF(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-i*c,t[2]=n*h+o*c+i*l-s*a,t[3]=o*h-i*a-s*l-n*c,t}function Z7e(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function X7e(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function Y7e(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function J7e(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function mL(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,d,f,m=r[0],y=r[1],_=r[2],v=r[3];return c=s*m+n*y+o*_+a*v,c<0&&(c=-c,m=-m,y=-y,_=-_,v=-v),1-c>Xa()?(l=Math.acos(c),h=Math.sin(l),d=Math.sin((1-i)*l)/h,f=Math.sin(i*l)/h):(d=1-i,f=i),t[0]=d*s+f*m,t[1]=d*n+f*y,t[2]=d*o+f*_,t[3]=d*a+f*v,t}function Q7e(t){const e=mR,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function K7e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function Gf(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Fve(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function eGe(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function tGe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const NR=ch,rGe=wi,iGe=Rq,sGe=pF,nGe=kb,oGe=bpe,aGe=l5,Uve=Pq,lGe=Uve,Vve=Mq,cGe=Vve,PZ=vpe,uGe=d2,hGe=kD;function dGe(t,e,r){const i=me(e,r);return i<-.999999?(ot(bp,pGe,e),Jl(bp)<1e-6&&ot(bp,fGe,e),ge(bp,bp),PN(t,bp,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ot(bp,e,r),t[0]=bp[0],t[1]=bp[1],t[2]=bp[2],t[3]=1+i,PZ(t,t))}const bp=A(),pGe=Ae(1,0,0),fGe=Ae(0,1,0);function mGe(t,e,r,i,s,n){return mL(Tte,e,s,n),mL(Ste,r,i,n),mL(t,Tte,Ste,2*n*(1-n)),t}const Tte=Mh(),Ste=Mh();function gGe(t,e,r,i){const s=yGe;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],PZ(t,Fve(t,s))}const yGe=Fi();Object.freeze(Object.defineProperty({__proto__:null,add:iGe,calculateW:J7e,conjugate:Gf,copy:NR,dot:oGe,equals:hGe,exactEquals:uGe,fromEuler:eGe,fromMat3:Fve,getAxisAngle:RZ,identity:W7e,invert:K7e,len:lGe,length:Uve,lerp:aGe,mul:sGe,multiply:pF,normalize:PZ,random:Q7e,rotateX:Z7e,rotateY:X7e,rotateZ:Y7e,rotationTo:dGe,scale:nGe,set:rGe,setAxes:gGe,setAxisAngle:PN,slerp:mL,sqlerp:mGe,sqrLen:cGe,squaredLength:Vve,str:tGe},Symbol.toStringTag,{value:"Module"}));function ey(t=vGe){return[t[0],t[1],t[2],t[3]]}function DU(t,e,r=ey()){return re(r,t),r[3]=e,r}function Ete(t,e,r=ey()){return ot(r,t,e),ge(r,r),r[3]=-fpe(t,e),r}function Cte(t,e,r=ey()){return PN(sM,t,Ate(t)),PN(Ote,e,Ate(e)),pF(sM,Ote,sM),_Ge(r,qa(RZ(r,sM)))}function lAt(t,e,r,i=ey()){return DU(upe,t,nM),DU(hpe,e,Rte),DU(Cq,r,Pte),Cte(nM,Rte,nM),Cte(nM,Pte,i),i}function cAt(t){return t}function uAt(t){return t[3]}function Ate(t){return Ut(t[3])}function _Ge(t,e){return t[3]=e,t}const vGe=[0,0,1,0],sM=Mh(),Ote=Mh();ey();const nM=ey(),Rte=ey(),Pte=ey();function bGe(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===tc.FINISHED&&(t.fadeIn.factor=0,re(i,ff),t.fadeIn.stage=tc.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=pn.FINISHED),t.fadeIn.stage===tc.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(uZ(t.data)&&t.renderingStage!==Os.RENDERING||t.renderingStage===Os.FADING_TEXTURE_CHANNELS)&&(re(i,ff),t.fadeIn.stage=tc.FADE_IN,t.startTime=e,t.renderingStage===Os.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Os.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===tc.FADE_IN?t.fadeIn.factor=r?_e((e-t.startTime)/(zve*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===tc.FADE_IN&&(t.fadeIn.stage=tc.FINISHED,t.fadeIn.factor=1)}function wGe(t,e,r){const{fadeInOut:i,crossFade:s}=t;i.stage===pn.FINISHED&&(t.startTime=e,i.factor=1,i.stage=pn.FADE_OUT),i.factor>0&&i.stage===pn.FADE_OUT?i.factor=r?1-_e((e-t.startTime)/(CGe*r),0,1):0:(i.factor<=0&&i.stage===pn.FADE_OUT&&(i.factor=0,re(t.parallax.anchorPointClouds,ff)),i.factor<=0&&i.stage===pn.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=pn.SWITCH,t.crossFade.enabled=!1,s.factor=1),i.stage===pn.SWITCH&&(uZ(t.data)&&t.renderingStage!==Os.RENDERING||t.renderingStage===Os.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=pn.FADE_IN,re(t.parallax.anchorPointClouds,ff),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===Os.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Os.SWITCH_CHANNELS)),i.factor<1&&i.stage===pn.FADE_IN?i.factor=r?_e((e-t.startTime)/(zve*r),0,1):1:i.factor>=1&&i.stage===pn.FADE_IN&&(i.stage=pn.FINISHED,i.factor=1))}function xGe(t,e,r,i){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(re(t.parallaxNew.anchorPointClouds,ff),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=r?_e((e-t.startTime)/(AGe*r),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,re(n,t.parallaxNew.anchorPointClouds),t.renderingStage===Os.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Os.SWITCH_CHANNELS))}function Mte(t,e,r,i){const s=t.fadeInOutHeight,n=s.stage===C_.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-n)/(OGe*i);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=r,s.factor=_e(s.factor,0,1),s.stage=C_.HEIGHT_FADE}function TGe(t,e,r,i,s){t.renderingStage===Os.FINISHED_RENDERING&&(t.renderingStage=Os.FADING_TEXTURE_CHANNELS);const n=Ee(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-sr.radius>lf?1:0),t.isCameraPositionFinal=m_(t.cameraPositionLastFrame,e.eye),ge(ff,e.eye),ie(ff,ff,sr.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&re(o.anchorPointClouds,ff);const a=Ee(he(EGe,o.anchorPointClouds,ff));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==tc.FINISHED?bGe(t,i,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==pn.FINISHED?wGe(t,i,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===Os.FADING_TEXTURE_CHANNELS?xGe(t,i,s,(r!==$r.IDLE||!uZ(t.data))&&t.renderingStage!==Os.FADING_TEXTURE_CHANNELS):l=!1;const c=n-sr.radius;if((c>1.7*lf||c<-lf)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>lf||c<-.35*lf)&&t.fadeInOutHeight.factor<1?Mte(t,!1,i,s):c<lf&&c>-.35*lf&&t.fadeInOutHeight.factor>0?Mte(t,!0,i,s):t.fadeInOutHeight.stage=C_.FINISHED,t.renderingStage===Os.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=Os.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-sr.radius*sr.radius,0))/n,Ete(Ite,o.anchorPointClouds,Yw),uc(o.transform,nn,Yw[3],Yw),l){const{parallaxNew:h}=t;Ete(Ite,h.anchorPointClouds,Yw),uc(h.transform,nn,Yw[3],Yw)}re(t.cameraPositionLastFrame,e.eye)}function SGe(t){return t.crossFade.enabled||t.fadeInOut.stage!==pn.FINISHED||t.fadeIn.stage!==tc.FINISHED||t.fadeInOutHeight.stage!==C_.FINISHED||t.renderingStage!==Os.FINISHED}const Ite=Ae(0,0,1),Yw=ey(),ff=A(),EGe=A(),zve=1,CGe=.5,AGe=1.3,OGe=1;let nE=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Gs;function $te(t=!oe("disable-feature:high-quality-idle"),e=null){const r=new nE;return t?(r.set($r.IDLE,Gs.Antialiasing,e!=="low"),r.set($r.IDLE,Gs.HighResolutionAtmosphere,e!=="low"),r.set($r.IDLE,Gs.HighQualityTransparency,!0),r.set($r.IDLE,Gs.SSAO,!0),r.set($r.IDLE,Gs.WaterReflection,!0),r.set($r.IDLE,Gs.PhysicalPixelRendering,!oe("esri-mobile"))):(r.set($r.ANIMATING,Gs.HighResolutionShadows,!0),r.set($r.INTERACTING,Gs.HighResolutionShadows,!0)),r.set($r.IDLE,Gs.HighResolutionShadows,!0),r.set($r.IDLE,Gs.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Gs||(Gs={}));var x2;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(x2||(x2={}));var b3;const RGe=[ce.POSTPROCESSING_ENVIRONMENT_OPAQUE,ce.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let So=b3=class extends xe{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new NU,this._newWeatherParameters=new NU,this._fadedWeatherParameters=new NU,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(RGe,this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Jo.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===Jo.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Ee(this.view.state.camera.eye)-Nr(this.view.spatialReference).radius<=lf}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new d0({view:t,requestRender:()=>this._setNeedsRender()}):(Pe(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Pe(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Pe(t),new u1({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Pe(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Pe(t),new cl({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Pe(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Nr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Pe(t),new a1({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Pe(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new l1({context:r,view:e,rctx:i,viewingMode:s})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([ue(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),As),ue(()=>this._stars,e),ue(()=>this._precipitation,e),ue(()=>this._clouds,()=>this._updateWeather(),zr),ue(()=>this._fog,()=>this._updateFogHaze(),zr),ue(()=>this.view.state.mode,()=>{this._setNeedsRender()},jr),ue(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},As)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Pe(this._atmosphere),this._set("_stars",Pe(this._stars)),this._set("_precipitation",Pe(this._precipitation)),this._set("_clouds",Pe(this._clouds)),this._set("_cloudsComposition",Pe(this._cloudsComposition)),this._set("_fog",Pe(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=yke(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(TGe(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===Os.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){var e,r,i,s,n,o,a,l,c;if(t.output===L.Color)switch(t.bindParameters.slot){case ce.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,((e=this.view)==null?void 0:e.qualitySettings.highResolutionAtmosphere)||((s=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer)==null?void 0:s.isFeatureEnabled(Gs.HighResolutionAtmosphere))),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),SGe(t.bindParameters.cloudsFade)&&this._context!=null&&((n=t.bindParameters.cloudsFade.data)==null?void 0:n.cubeMap)!=null&&this._context.requestRender());break;case ce.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,((o=this.view)==null?void 0:o.qualitySettings.highResolutionAtmosphere)||((c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.isFeatureEnabled(Gs.HighResolutionAtmosphere))),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const h=this.view.environment.weather;h.type!=="rainy"&&h.type!=="snowy"||this._precipitation.render(t,h.precipitation,h.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===x2.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===tc.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===pn.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(Yo[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=xt(3e-5,.005,t.weatherAdjustment**3),re(this._newWeatherParameters.fog.color,Lte),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=xt(4e-6,2e-4,(t.effect??0)**3),re(this._newWeatherParameters.fog.color,PGe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=xt(4e-6,2e-4,(t.effect??0)**3),re(this._newWeatherParameters.fog.color,Lte),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==Jo.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Pe(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Pe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case Jo.Realistic:return Jee;case Jo.Local:return T7e;case Jo.Mars:return O7e;default:case Jo.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||Jf(this.view.spatialReference)?Jo.None:r===Le.Local?Jo.Local:this._context!=null&&Jee.isSupported(this._context)&&cO(this.view.spatialReference)?Jo.Realistic:Yf(this.view.spatialReference)?Jo.Mars:Jo.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{Dte=b3.prototype._getAtmosphereClass,b3.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{b3.prototype._getAtmosphereClass=Dte}}}};u([p({constructOnly:!0})],So.prototype,"view",void 0),u([p({readOnly:!0})],So.prototype,"atmosphere",null),u([p({readOnly:!0})],So.prototype,"_atmosphereType",null),u([p({type:Boolean,readOnly:!0})],So.prototype,"updating",null),u([p({readOnly:!0})],So.prototype,"weatherVisible",null),u([p()],So.prototype,"_context",void 0),u([p()],So.prototype,"_atmosphere",void 0),u([p({readOnly:!0})],So.prototype,"_stars",null),u([p({readOnly:!0})],So.prototype,"_precipitation",null),u([p({readOnly:!0})],So.prototype,"_clouds",null),u([p({readOnly:!0})],So.prototype,"_cloudsComposition",null),u([p({readOnly:!0})],So.prototype,"_fog",null),u([p({readOnly:!0})],So.prototype,"weatherEnabled",null),u([p({readOnly:!0})],So.prototype,"_precipitationEnabled",null),u([p({readOnly:!0})],So.prototype,"_weatherUpdateParameters",null),So=b3=u([R("esri.views.3d.environment.EnvironmentRenderer")],So);let NU=class{constructor(){this.fog=new zBe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,re(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=xt(e.fog.amount,r.fog.amount,i),this.hazeAmount=xt(e.hazeAmount,r.hazeAmount,i),this.fog.strength=xt(e.fog.strength,r.fog.strength,i),Gr(this.fog.color,e.fog.color,r.fog.color,i)}};const PGe=Ae(.5,.5,.5),Lte=Ae(1.5,1.5,1.5);let Dte;function Nte(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return MGe(t,e.longitude,e.latitude,r.longitude,r.latitude)}function MGe(t,e,r,i,s){const n=Ut(r),o=Ut(s),a=n-o,l=Ut(e)-Ut(i),c=Math.sin(a/2),h=Math.sin(l/2),d=2*_h(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*d)/1e4}function IGe(t,e,r){const i=e.spatialReference,s=Nr(i),n=new ct(e.x,t.y,i),o=new ct(r.x,t.y,i),a=new ct(t.x,e.y,i),l=new ct(t.x,r.y,i);return{lon:Nte(s.radius,n,o),lat:Nte(s.radius,a,l)}}function $Ge(t,e,r){const i=e/r,s=Ut(t),n=Math.sin(i/2),o=Math.cos(s),a=2*_h(Math.sqrt(n*n/(o*o)));return qa(a)}function LGe(t,e){let r=t/15;return e||(r=Math.round(r)),r}function Fte(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=LGe(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var pAt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function FR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ute,Vte,zte,g7={exports:{}};g7.exports,Ute=g7,Vte=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,d={dec:0,ra:0};function f(M){return M.valueOf()/l-.5+c}function m(M){return new Date((M+.5-c)*l)}function y(M){return f(M)-h}var _=23.4397*a;function v(M,D){return n(e(M)*r(_)-i(D)*e(_),r(M))}function w(M,D){return s(e(D)*r(_)+r(D)*e(_)*e(M))}function T(M,D,N){return n(e(M),r(M)*e(D)-i(N)*r(D))}function x(M,D,N){return s(e(D)*e(N)+r(D)*r(N)*r(M))}function S(M,D){return a*(280.16+360.9856235*M)-D}function O(M){return a*(357.5291+.98560028*M)}function C(M){return a*(1.9148*e(M)+.02*e(2*M)+3e-4*e(3*M))}function P(M,D){return M+D+102.9372*a+t}function $(M,D){var N=O(M),G=P(N,C(N));return D||(D={dec:0,ra:0}),D.dec=w(G,0),D.ra=v(G,0),D}var V={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(M,D,N,G){var X=a*-N,J=a*D,ee=y(M),ye=$(ee,d),Me=S(ee,X)-ye.ra;return G||(G={azimuth:0,altitude:0}),G.azimuth=T(Me,J,ye.dec),G.altitude=x(Me,J,ye.dec),G}},z=[[-.83,"sunrise","sunset"]];V.addTime=function(M,D,N){z.push([M,D,N])};var B=9e-4;function k(M,D){return Math.round(M-B-D/(2*t))}function Z(M,D,N){return B+(M+D)/(2*t)+N}function W(M,D,N){return h+M+.0053*e(D)-.0069*e(2*N)}function j(M,D,N){return o((e(M)-e(D)*e(N))/(r(D)*r(N)))}function Y(M){var D=a*(134.963+13.064993*M),N=a*(93.272+13.22935*M),G=a*(218.316+13.176396*M)+6.289*a*e(D),X=5.128*a*e(N),J=385001-20905*r(D);return{ra:v(G,X),dec:w(G,X),dist:J}}return V.getTimes=function(M,D,N){var G=a*-N,X=a*D,J=k(y(M),G),ee=Z(0,G,J),ye=O(ee),Me=C(ye),ft=P(ye,Me),Rt=w(ft,0),at=W(ee,ye,ft);function vt(mt){return W(Z(j(mt,X,Rt),G,J),ye,ft)}function ze(mt){var ut=(e(mt)-e(X)*e(Rt))/(r(X)*r(Rt));return ut<-1?V.PolarException.MIDNIGHT_SUN:ut>1?V.PolarException.POLAR_NIGHT:V.PolarException.NORMAL}var fe,Tt,bt,Ce,Be,je={solarNoon:m(at),nadir:m(at-.5),polarException:V.PolarException.NORMAL};for(fe=0,Tt=z.length;fe<Tt;fe+=1)Be=at-((Ce=vt((bt=z[fe])[0]*a))-at),je[bt[1]]=m(Be),je[bt[2]]=m(Ce);return je.polarException=ze(z[0][0]*a),je},V.getMoonPosition=function(M,D,N){var G=a*-N,X=a*D,J=y(M),ee=Y(J),ye=S(J,G)-ee.ra,Me=x(ye,X,ee.dec);return Me+=.017*a/i(Me+10.26*a/(Me+5.1*a)),{azimuth:T(ye,X,ee.dec),altitude:Me,distance:ee.dist}},V.getMoonFraction=function(M){var D=y(M),N=$(D),G=Y(D),X=149598e3,J=o(e(N.dec)*e(G.dec)+r(N.dec)*r(G.dec)*r(N.ra-G.ra)),ee=n(X*e(J),G.dist-X*r(J));return(1+r(ee))/2},V},(zte=Vte())!==void 0&&(Ute.exports=zte);const Qb=FR(g7.exports),Na={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let oM=class{constructor(e,r){this.direct=e,this.ambient=r}};function DGe(t,e,r,i,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=Na.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=Na.global.direct;const o=e[2],a=_e((Math.abs(o)-Na.local.altitude)/(Na.global.altitude-Na.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=Qb.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=BGe(t,l,i);else{const h=Gve(i);c={direct:{intensity:Na.local.directAtNoon*h.direct,color:Ae(1,1,1)},ambient:{intensity:Na.local.ambientAtNoon*h.ambient,color:Ae(1,1,1)},timeOfDay:"early afternoon"}}Gr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=xt(c.ambient.intensity,n.ambient.intensity,a),Gr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=xt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=t!=null?kGe(t,l):1,t!=null?NGe(t,e,r,n.direct.directionToLightSource):kve(s,r,n.direct.directionToLightSource)}function kve(t,e,r){e===Le.Global?ge(zU,t.eye):se(zU,0,0,1),ie(kU,t.viewForward,-1);const i=Q$(kU,zU),s=Math.max(i-2*BU,0),n=.85*s/(s+1),o=Math.max(BU,i-BU-n);du(Jte,-o,t.viewRight),$e(r,kU,Jte),le(r,r,ie(GGe,t.viewRight,jGe)),ge(r,r)}function NGe(t,e,r,i){const s=zGe,n=Th(VGe);if(r===Le.Global)Qb.getPosition(t,0,0,s),se(i,0,0,-1),eS(n,n,-s.azimuth),$5(n,n,-s.altitude),$e(i,i,n);else{const o=Na.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=_e(c,0,1),c<1?(Qb.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(i,0,-1,0),tS(n,n,-s.azimuth),eS(n,n,-s.altitude),$e(i,i,n)}}function FGe(t,e){if(e===Le.Global)return!0;const r=Na.planarDirection;return Math.abs(t)<r.localAltitude}const UGe=Ae(.5773502691896258,-.5773502691896258,.5773502691896258);let Bve=class{constructor(){this.ambient={color:Ae(1,1,1),intensity:.55},this.direct={color:Ae(1,1,1),intensity:.55,directionToLightSource:Is(UGe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const VGe=ve(),zGe={azimuth:0,altitude:0};function kGe(t,e){const r=t.valueOf();let i,s;e.polarException===Qb.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===Qb.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-_e(Math.abs(r-n)/432e5,0,1)}function Gve(t){switch(t){case"disabled":case"sunny":case"cloudy":return new oM(1,1);case"rainy":return new oM(.4,1.2);case"snowy":return new oM(.5,1.3);case"foggy":return new oM(.2,1.6)}}function kte(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const FU=Ae(.01,.01,.01),y7=Ae(1,.6,.5),_7=Ae(1,.98,.98),Bte=Ae(1,1,1),UU=Ae(.8,.8,1),v7=Ae(.8,.8,1),b7=Ae(.98,.98,1),Gte=Ae(1,1,1),VU=ur(.01,Na.local.ambientAtNight),w7=ur(Na.local.directAtTwilight,Na.local.ambientAtTwilight),x7=ur(.9*Na.local.directAtNoon,Na.local.ambientAtNoon),jte=ur(Na.local.directAtNoon,Na.local.ambientAtNoon),Hte=x7,qte=_7,Wte=b7,Zte=w7,Xte=y7,Yte=v7;function BGe(t,e,r){const i=t.valueOf();let s,n;e.polarException===Qb.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Qb.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,d=.06*o,f=s-d/2,m=s+d/2,y=n-d/2,_=n+d/2,v=Ue(),w=A(),T=A();let x="";if(i<f||i>_)cn(v,VU),re(w,FU),re(T,UU),x="night";else if(i<m){const C=(i-f)/(m-f);eh(v,VU,w7,C),Gr(w,FU,y7,C),Gr(T,UU,v7,C),x="sun rising"}else if(i<c){const C=(i-m)/(c-m);eh(v,w7,x7,C),Gr(w,y7,_7,C),Gr(T,v7,b7,C),x="early morning"}else if(i<a){const C=(i-c)/(a-c);eh(v,x7,jte,C),Gr(w,_7,Bte,C),Gr(T,b7,Gte,C),x="late morning"}else if(i<h){const C=(i-a)/(h-a);eh(v,jte,Hte,C),Gr(w,Bte,qte,C),Gr(T,Gte,Wte,C),x="early afternoon"}else if(i<y){const C=(i-h)/(y-h);eh(v,Hte,Zte,C),Gr(w,qte,Xte,C),Gr(T,Wte,Yte,C),x="late afternoon"}else if(i<_){const C=(i-y)/(_-y);eh(v,Zte,VU,C),Gr(w,Xte,FU,C),Gr(T,Yte,UU,C),x="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(kte(w,S),kte(T,S));const O=Gve(r);return{direct:{intensity:v[0]*O.direct,color:w},ambient:{intensity:v[1]*O.ambient,color:T},timeOfDay:x}}const Jte=ve(),zU=A(),kU=A(),GGe=A(),BU=.25,jGe=.2;let od=class extends Ls.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Mi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new TN,this._ambientLight=new yZ,this._moonLight=new J_e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===Le.Global&&cO(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new So({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([ue(()=>e.environment.lighting,s=>this._updateLightingHandler(s),jr),ue(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),jr),ue(()=>e.stationary,()=>this._interactingStationaryHandler()),ue(()=>e.environment.lighting.directShadowsEnabled,r,jr),ue(()=>e.qualitySettings.ambientOcclusion,r,jr),ue(()=>e.qualitySettings.reflections,r,jr),ue(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},r,jr),ue(()=>e.spatialReference,()=>this._resetReferencePosition(!0),jr),ue(()=>e.environment.weather.type,()=>this._updateLighting(null,x2.Faded),jr),ue(()=>this.weatherEnabled,()=>this._updateLighting(null,x2.Faded),jr),ue(()=>e.viewingMode,()=>this._resetReferencePosition(!0),As),ue(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),As),ue(()=>e.state.camera,i,As),ue(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Pe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!S_(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=Fte(this._referencePosWGS84Comparable,Qte);s!=null&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=cO(this._view.spatialReference);if(i&&!S_(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=A()),i?Bge(s,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=x2.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=s!=null?HGe:qGe,o=this.weatherVisible?i.environment.weather.type:"disabled";s!=null?DGe(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&kve(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;ie(a.intensity,l.color,l.intensity*Math.PI),re(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;ie(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;Gr(h.intensity,ZGe,XGe,n.globalFactor);const d=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));ie(h.intensity,h.intensity,d),re(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=WGe;i.setTime((r||this._view.environment.lighting.date).getTime());const s=Fte(e,Qte);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||FGe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),i=this._view.environment.background,s=i instanceof Z0e?{type:"color",color:MW(ke.toUnitRGBA(i.color))}:{type:"color",color:Ft(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=sO(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=sO(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};u([p({type:Boolean,readOnly:!0})],od.prototype,"updating",null),u([p()],od.prototype,"disableQueries",void 0),u([p()],od.prototype,"_disableWeather",void 0),u([p()],od.prototype,"weatherEnabled",null),u([p()],od.prototype,"weatherVisible",null),u([p()],od.prototype,"referencePositionWGS84Comparable",null),u([p()],od.prototype,"_renderer",void 0),u([p()],od.prototype,"_referencePosWGS84Comparable",void 0),od=u([R("esri.views.3d.environment.SceneViewEnvironmentManager")],od);const HGe=new Bve,qGe=new Bve,WGe=new Date,Qte={hours:0,minutes:0,seconds:0},ZGe=Ae(.22,.22,.33),XGe=Ae(.22,.22,.22);var Pi;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Pi||(Pi={}));var Jt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Jt||(Jt={}));var Hn;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Hn||(Hn={}));function LO(t,e){return(t&e)!=0}function MN(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const P_={selection:Pi.NONE,interactionType:Jt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Hn.TUMBLE};function jve(t,e,r,i){return e=e||t.viewForward,re(i,e),ie(i,i,Math.sign(me(e,r))),i}function YGe(t,e,r,i){return tje(t,e,r,KGe(i,e,r,!0))}function JGe(t,e,r,i){const s=me(r,he(t,i,e));return le(t,e,ie(t,r,s))}const QGe={dir:A(),len:0,clip:Ue()};function KGe(t,e,r,i){const s=QGe;return t?(r&&i&&(s.len=mi(e,r)),re(s.dir,t)):i?(s.len=mi(e,r),he(s.dir,r,e),ie(s.dir,s.dir,1/s.len)):(he(s.dir,r,e),ge(s.dir,s.dir)),s}function eje(t,e,r){const i=me(t,r.dir),s=-fi(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function tje(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!eje(t[s],e,i))return!1;return!0}function rje(t,e,r=P_){const i=MZ(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=jve(e,r.interactionDirection,nje(t,e,Math.sign(i),cje),lje),a=re(uje,e.viewForward),l=s.intersectInfiniteManifold(pu(e.eye,o),n,GU);return e.eye=l??s.setAltitude(GU,n,e.eye),e.center=JGe(GU,e.eye,a,e.center),!0}function MZ(t,e,r=P_){if(!ije(t,r)||!t.state.constraints.altitude)return 0;const i=oje(t.state.constraints.altitude,aje);sje(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=_e(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function ije(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==Jt.TUMBLE||!LO(e.selection,Pi.TILT))}function sje(t,e,r){const i=e.interactionType;if(i===Jt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Jt.TUMBLE||i===Jt.ZOOM,c=MZ(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,MN(c,h,l,a,.05*h,r)}function nje(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),ie(i,i,r),i}function oje(t,e){return e.min=t.min,e.max=t.max,e}const aje={min:0,max:0},lje=A(),cje=A(),uje=A(),GU=A();function IZ(t,e,r=P_){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;aM.min=0,aM.max=i,dje(t,r,aM);const s=$Z(t,e),n=aM.max-s;return n>=-1e-6?0:n}function hje(t,e,r=P_){const i=IZ(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=$Z(t,e)+i,o=re(fje,e.eye),a=jve(e,r.interactionDirection,pje(e,s.renderLocation,yje),gje);if(!B_(Eye(s.renderLocation,n),pu(e.eye,a),lM))return!1;e.eye=lM;const l=he(mje,e.eye,o);e.center=le(lM,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,lM);return h!=null&&(e.center=h),!0}function dje(t,e,r){const i=e.interactionType;if(i===Jt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Jt.ZOOM||i===Jt.PAN,c=IZ(t,o),h=c===0?0:$Z(t,o);r.min=s,r.max=n,MN(c,h,l,a,.05*h,r)}function $Z(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?mi(e.eye,r.renderLocation):0}function pje(t,e,r){return Gg(r,t.eye,e)}const aM={min:0,max:0},fje=A(),mje=A(),gje=A(),yje=A(),lM=A();var Gi,go;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Gi||(Gi={}));let _je=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=go.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(go||(go={}));let vje=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},bje=class extends vje{constructor(e,r,i,s){super(e,r,i),this.center=s!=null?Is(s):null}},Hve=class{constructor(e){this.layerUid=e}},fF=class extends Hve{constructor(e,r){super(e),this.graphicUid=r}};function hp(t){return t!=null&&t.dist!=null}function Kte(t){return(e,r,i)=>(Gr(ere,e,r,i),!VW(t,ere))}function mF(t){return hp(t)&&t.intersector===Gi.OBJECT&&!!t.target}function gF(t){return hp(t)&&t.intersector===Gi.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const ere=A();let wje=class{constructor(){this._transform=ve(),this._transformInverse=new cM({value:this._transform},xn,ve),this._transformInverseTranspose=new cM(this._transformInverse,bc,ve),this._transformTranspose=new cM({value:this._transform},bc,ve),this._transformInverseRotation=new cM({value:this._transform},P_e,Fi)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){$s(this._transform,e)}multiplyTransform(e){ni(this._transform,this._transform,e)}set(e){$s(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},cM=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},xje=class{constructor(e=0){this.offset=e,this.tmpVertex=A()}applyToVertex(e,r,i){const s=e+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)vy[n]=e[0+n]+this.localOrigin[n],uM[n]=e[3+n]+this.localOrigin[n],NE[n]=vy[n];const r=this.applyToVertex(vy[0],vy[1],vy[2]);for(let n=0;n<3;++n)e[n]=r[n],e[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)NE[o]=n&1<<o?uM[o]:vy[o];i(NE)}let s=0;for(let n=0;n<3;++n)vy[n]*uM[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)NE[o]=s&1<<o?0:n&1<<o?vy[o]:uM[o];i(NE)}}for(let n=0;n<3;++n)e[n]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const vy=A(),uM=A(),NE=A();let Tje=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=A(),this._mbs=_s(),this._obb={center:A(),halfSize:ns(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const s=e,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),d=Math.sqrt(l*l+c*c+h*h);if(d<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(r),Math.abs(n)),m=Math.max(Math.abs(i),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+y*y),v=this._totalOffset/_,w=this._totalOffset/d;return e[0]+=r*(r>0?v:w),e[1]+=i*(i>0?v:w),e[2]+=s*(s>0?v:w),e[3]+=n*(n<0?v:w),e[4]+=o*(o<0?v:w),e[5]+=a*(a<0?v:w),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,mc(this._obb.halfSize,e.halfSize,e.quaternion),le(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,he(this._obb.halfSize,this._obb.halfSize,e.center),Gf(sre,e.quaternion),mc(this._obb.halfSize,this._obb.halfSize,sre),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},Sje=class{constructor(e=0){this.offset=e,this.sphere=_s(),this.tmpVertex=A()}applyToVertex(e,r,i){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*r+s[8]*i+s[12],o=s[1]*e+s[5]*r+s[9]*i+s[13],a=s[2]*e+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const tre=new Sje;function T7(t){return t!=null?(tre.offset=t,tre):null}const rre=new Tje;function Eje(t){return t!=null?(rre.offset=t,rre):null}const ire=new xje;function Cje(t){return t!=null?(ire.offset=t,ire):null}const N0="terrain",sre=Mh(),gS=1e-5;let Aje=class{constructor(e){this.options=new _je,this._results=new Oje,this.transform=new wje,this.tolerance=gS,this.verticalOffset=null,this._ray=Gn(),this._rayEnd=A(),this._rayBeginTransformed=A(),this._rayEndTransformed=A(),this.viewingMode=e??Le.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(rUe(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&uN(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Le.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,le(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i??gS;const o=T7(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.shaderTransformation,s=T7(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),$e(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),$e(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,d,f,m,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,v=f?w=>{const T=new bje(e,a,d,y);w.set(Gi.HUD,T,c,h,nn,m)}:w=>w.set(Gi.OBJECT,{object:e,geometryId:a,triangleNr:d},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==go.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===go.ALL)if(f){const w=new S7(this._ray);v(w),this._results.hud.all.push(w)}else{const w=new T2(this._ray);v(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function Oh(t){return new Aje(t)}let Oje=class{constructor(){this.min=new T2(Gn()),this.max=new T2(Gn()),this.hud={min:new S7(Gn()),max:new S7(Gn()),all:new Array},this.ground=new T2(Gn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},T2=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ie(hM,this.ray.direction,this.dist),Ee(hM)):null}getIntersectionPoint(e){return!!hp(this)&&(ie(hM,this.ray.direction,this.dist),le(e,this.ray.origin,hM),!0)}getTransformedNormal(e){return re(FE,this.normal),FE[3]=0,eu(FE,FE,this.transformation),re(e,FE),ge(e,e)}constructor(e){this.intersector=Gi.OBJECT,this.normal=A(),this.transformation=ve(),this._ray=Gn(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Gi.OBJECT,uN(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,re(this.normal,s??Cq),$s(this.transformation,n??nn),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){uN(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,re(this.normal,e.normal),$s(this.transformation,e.transformation)}},S7=class extends T2{constructor(){super(...arguments),this.intersector=Gi.HUD}};function LZ(t){return new T2(t)}const hM=A(),FE=Yt();function qve(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,IN,i)!=null&&Dpe(r,IN)}function yF(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Pw(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),Rje(t,s.ray,by)||re(by,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(fo(s.eye,by)<o){const a=n.collision.enabled;re(lv,s.viewForward),ie(lv,lv,o),a?s.eye=he(IN,by,lv):le(by,s.eye,lv);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(he(lv,by,s.eye),s.eye=l.setAltitude(IN,h,s.eye),le(by,s.eye,lv))}return s.center=by,s}function nre(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=yF(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,Mje),o=n*n;return fo(e,r)>o}function Rje(t,e,r){let i=ore[t.viewingMode];i||(i=Oh(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,ore[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||nre(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||nre(t,e.origin,r))||!!s&&Pje(e,r,Nr(t.spatialReference).radius)}function Pje(t,e,r){const i=me(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return ie(e,t.direction,s/Ee(t.direction)),le(e,e,t.origin),!0}const ore={},IN=A(),by=A(),lv=A(),Mje={near:0,far:0};function oE(t,e,r=dh.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=yF(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Ee(e.eye);if(he(dM,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(Ije,o,e.eye),r===dh.EYE_AND_CENTER)e.center=le(dM,e.eye,dM);else if(r===dh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ie(dM,e.center,l)}return!0}var dh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(dh||(dh={}));const dM=A(),Ije=A();function M_(t,e,r){t.worldUpAtPosition(e,are),he(jU,r,e);const i=Ee(jU);return i===0?0:Sn(me(jU,are)/i)}const are=A(),jU=A();function Wve(t,e,r=P_,i=!0){UE.eyeCenterDistance=0,UE.requiresTwoSteps=!1;const s=DZ(t,e,r,void 0,UE);if(s===0)return!1;switch(du(pM,-s,e.viewRight),r.tiltMode){case Hn.LOOK_AROUND:$e(wy,e.viewForward,pM),ie(wy,wy,UE.eyeCenterDistance),e.center=le(F0,e.eye,wy);break;case Hn.TUMBLE:he(wy,e.center,e.eye),$e(wy,wy,pM),e.eye=he(F0,e.center,wy);break;default:r.tiltMode}return e.up=$e(F0,e.up,pM),!UE.requiresTwoSteps||!i||Wve(t,e,r,!1)}function DZ(t,e,r=P_,i=P_,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,Bje);return kje(t,r,o),i.interactionType===Jt.TUMBLE&&LO(i.selection,Pi.ALTITUDE)&&Zve(t,i.interactionStartCamera,o),r.tiltMode===Hn.LOOK_AROUND||i.tiltMode===Hn.LOOK_AROUND?Lje(t,e,o,s):$je(t,e,o)}function $je(t,e,r){const i=M_(t.renderCoordsHelper,e.center,e.eye),s=i-_e(i,r.min,r.max);return DO(s)?s:0}function Lje(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return Nje(t,e,r,i);case"local":return Dje(t,e,r,i)}}function Dje(t,e,r,i){const s=M_(t.renderCoordsHelper,e.center,e.eye),n=_e(s,r.min,r.max),o=s-n;if(!DO(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function Nje(t,e,r,i){const s=Fje(t,e,Gje),n=_e(s.tiltAtCenter,r.min,r.max);if(!DO(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=Uje(s),a=Vje(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=zje(s,o)),i&&(i.eyeCenterDistance=E7(s,o)),a}function Fje(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Nr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,F0);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=mi(e.eye,n),r.tiltAtCenter=M_(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=M_(t.renderCoordsHelper,e.center,e.eye):(tE(k5(B5,s),e.ray,F0),r.eyeCenterDistance=mi(e.eye,F0),r.tiltAtCenter=Sn(-me(e.viewForward,ge(F0,F0)))),r.radius=s,r.eyeRadius=Ee(e.eye),r.constraints=t.state.constraints,r}function DO(t){return Math.abs(t)>1e-9}function Uje(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=E7(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&DO(n-s);){const l=(s+n)/2,c=E7(t,l);DO(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function E7(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-_e(e,0,Math.PI),i=_h(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function Vje(t,e){const r=_h(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=_h(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function zje(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function kje(t,e,r){if(e.interactionType===Jt.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=DZ(t,i,P_,e),l=a===0?0:M_(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===Jt.TUMBLE?(LO(e.selection,Pi.ALTITUDE)&&Zve(t,i,r),MN(a,l,!0,s,lre,r)):MN(a,l,!1,s,lre,r)}function Zve(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=ra(e.center),n=Math.sqrt(s),o=e.distance,a=Nr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-Sn(d),r.max)),r.max=Math.min(r.max,Math.PI-Sn(h))}const wy=A(),pM=ve(),F0=A(),lre=Ut(5),Bje={min:0,max:0},Gje={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},UE={eyeCenterDistance:0,requiresTwoSteps:!1};function jje(t){return t}const _F=t=>t*t,NZ=t=>1-_F(1-t),Hje=t=>t<.5?_F(2*t)/2:(NZ(2*(t-.5))+1)/2,FZ=t=>t*t*t,Xve=t=>1-FZ(1-t),Yve=t=>t<.5?FZ(2*t)/2:(Xve(2*(t-.5))+1)/2,UZ=t=>t*t*t*t,Jve=t=>1-UZ(1-t),qje=t=>t<.5?UZ(2*t)/2:(Jve(2*(t-.5))+1)/2,VZ=t=>t*t*t*t*t,Qve=t=>1-VZ(1-t),Wje=t=>t<.5?VZ(2*t)/2:(Qve(2*(t-.5))+1)/2,zZ=t=>1-Math.cos(t*Math.PI/2),Kve=t=>1-zZ(1-t),Zje=t=>t<.5?zZ(2*t)/2:(Kve(2*(t-.5))+1)/2,kZ=t=>2**(10*(t-1)),UR=t=>1-kZ(1-t),Xje=t=>t<.5?kZ(2*t)/2:(UR(2*(t-.5))+1)/2,BZ=t=>-(Math.sqrt(1-t*t)-1),e1e=t=>1-BZ(1-t),Yje=t=>t<.5?BZ(2*t)/2:(e1e(2*(t-.5))+1)/2;function Lh(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Dh(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const Jje=Dh(Lh(1),1),Qje=Dh(Lh(1),0),t1e=Dh(Lh(1),.5),Kje=Dh(Lh(2),1),eHe=Dh(Lh(2),0),tHe=Dh(Lh(2),.5),rHe=Dh(Lh(3),1),iHe=Dh(Lh(3),0),sHe=Dh(Lh(3),.5),nHe=Dh(Lh(4),1),oHe=Dh(Lh(4),0),aHe=Dh(Lh(4),.5),lHe={linear:jje,"in-quad":_F,"out-quad":NZ,"in-out-quad":Hje,"in-coast-quad":Jje,"out-coast-quad":Qje,"in-out-coast-quad":t1e,"in-cubic":FZ,"out-cubic":Xve,"in-out-cubic":Yve,"in-coast-cubic":Kje,"out-coast-cubic":eHe,"in-out-coast-cubic":tHe,"in-quart":UZ,"out-quart":Jve,"in-out-quart":qje,"in-coast-quart":rHe,"out-coast-quart":iHe,"in-out-coast-quart":sHe,"in-quint":VZ,"out-quint":Qve,"in-out-quint":Wje,"in-coast-quint":nHe,"out-coast-quint":oHe,"in-out-coast-quint":aHe,"in-sine":zZ,"out-sine":Kve,"in-out-sine":Zje,"in-expo":kZ,"out-expo":UR,"in-out-expo":Xje,"in-circ":BZ,"out-circ":e1e,"in-out-circ":Yje};function Rs(t,e,r=dHe,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<pHe;a++){let l=0;for(const c of hHe)if(LO(r.selection,c.type)){const h=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=h)}if(l===0)break}const n=LO(r.selection,Pi.COLLISION),o=cHe(r.interactionType,t);return n&&oE(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function cHe(t,e){switch(t){case Jt.PAN:return dh.EYE_AND_CENTER;case Jt.ASCEND:return e.state.isGlobal?dh.EYE_AND_CENTER_SCALE:dh.EYE_AND_CENTER;default:return dh.EYE}}function Id(t){const e=Math.min(1,t/150);return Yve(e)}function uHe(t,e,r){return DZ(t,e,r)*e.distance}const hHe=[{type:Pi.TILT,error:uHe,apply:Wve},{type:Pi.ALTITUDE,error:MZ,apply:rje},{type:Pi.DISTANCE,error:IZ,apply:hje}],dHe={selection:Pi.ALL,interactionType:Jt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Hn.TUMBLE},pHe=5,Ec=A(),Ml=A(),xy=A(),Ho=A(),cv=A(),fHe=A(),Cc={upward:Ae(0,0,1),forward:Ae(0,1,0),sideway:Ae(1,0,0)},cre=Fi();let ure=class{constructor(e=Le.Global){this.viewingMode=e,this.center=A(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Is(Cc.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Le.Global){const n=(Ee(this.center)+Ee(e.center))/2;r.pan=Q$(this.center,e.center)*n}else r.pan=mi(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===Le.Global?vUe(e.center,r.center,i.pan,this.center):Gr(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?xt(e.distance,r.distance,i.zoom):e.distance,this.pitch=xt(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=xt(s,n,i.rotate)}copyFrom(e){re(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,re(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,cre);re(this.center,e.center),he(Ho,e.center,e.eye),cc(Ho,Ho,r),cc(cv,e.up,r),this.distance=Ee(Ho),this.distance!==0&&(Ho[0]/=this.distance,Ho[1]/=this.distance,Ho[2]/=this.distance),this.pitch=this._eyeUpToPitch(Ho),this.yaw=this._eyeUpToYaw(Ho,cv),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,cre);Ch(r,r),this._axisAngleVec3(Cc.sideway,this.pitch-Math.PI/2,Cc.forward,Ho),this._axisAngleVec3(Cc.upward,this.yaw,Ho),this._axisAngleVec3(Cc.sideway,this.pitch-Math.PI/2,Cc.upward,cv),this._axisAngleVec3(Cc.upward,this.yaw,cv),ie(Ho,Ho,this.distance),cc(Ho,Ho,r),cc(cv,cv,r),e.center=this.center,e.eye=he(Ho,this.center,Ho),e.up=cv}_axisAngleVec3(e,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return ie(Ec,i,n),ot(Ml,e,i),ie(Ml,Ml,o),ie(xy,e,(1-n)*me(e,i)),le(s,le(s,Ec,Ml),xy)}_lookAtOrientation(e,r=Fi()){return this._upAtLookAt(e,xy),ot(Ec,this.lookAtDirection,xy),ge(Ec,Ec),Ec[0]===0&&Ec[1]===0&&Ec[2]===0&&re(Ec,Cc.sideway),ot(Ml,xy,Ec),ge(Ml,Ml),r[0]=Ec[0],r[1]=Ml[0],r[2]=xy[0],r[3]=Ec[1],r[4]=Ml[1],r[5]=xy[1],r[6]=Ec[2],r[7]=Ml[2],r[8]=xy[2],r}_upAtLookAt(e,r){return this.viewingMode===Le.Local?re(r,Cc.upward):ge(r,e)}_eyeUpToPitch(e){return Math.PI-Q$(Cc.upward,e)}_eyeUpToYaw(e,r){const i=fHe;return Math.abs(r[2])<.5?(re(i,r),e[2]>0&&ie(i,i,-1)):re(i,e),ot(Ml,i,Cc.upward),ge(Ml,Ml),Q$(Cc.sideway,Ml,Cc.upward)}};const $N={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let mHe=class r1e{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:$N.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new r1e(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:$N.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},gHe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-h)/(d-h)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},HU=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function yHe(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function _He(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function vHe(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function bHe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function wHe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function xHe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function THe(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function SHe(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function EHe(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function CHe(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function AHe(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function OHe(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function RHe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function PHe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function MHe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function IHe(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function $He(t,e){let r=LHe(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?bHe:yHe,a=s?wHe:_He,l=s?xHe:vHe,c=n?RHe:CHe,h=n?PHe:AHe,d=n?MHe:OHe,f=S=>o(t,S,i)+THe(t,S,i)+c(t,S,i),m=S=>a(t,S,i)+SHe(t,S,i)+h(t,S,i),y=S=>l(t,S,i)+EHe(t,S,i)+d(t,S,i);let _=f(r);const v=IHe(t);let w;const T=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<T;w++){const O=(m(r)+1e-6)/y(r);if(isNaN(O)||r>=x&&O<0){if(!isFinite(x))return null;r=x,_=f(r);break}if(r-=O,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const C=f(r);if(Math.abs(C-_)/_<=.005)break;_=C}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function LHe(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let DHe=class extends gHe{constructor(e,r){super(),this._preallocSegments=[new HU,new HU,new HU],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=$He(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=NZ(i.zoom):e===this._descensionSegment&&(i.zoom=_F(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const NHe={zoom:0,pan:0,rotate:0};let FHe=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new mHe(e),this.path=new DHe}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Ihe(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?t1e:UR)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,NHe);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:$N.minDuration/i,n=r.maxDuration!=null?r.maxDuration:$N.maxDuration/i;return Math.min(Math.max(s,e),n)}};const UHe=A();let VHe=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new FHe(()=>new ure(e)),this._current=new ure(e)}update(e,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=he(UHe,r.center,e.center),a=Ee(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),re(s.lookAtDirection,o),re(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new lt,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+Ihe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var Zi;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Zi||(Zi={}));let ig=class extends xe{constructor(e){super(e),this.state=Zi.Ready}get active(){return this.state===Zi.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Zi.Stopped,!0)}finishController(){this.state=Zi.Finished}get steppingFinished(){return!1}};u([p({constructOnly:!0})],ig.prototype,"view",void 0),u([p({readOnly:!0})],ig.prototype,"active",null),u([p()],ig.prototype,"state",void 0),u([p({readOnly:!0})],ig.prototype,"isInteractive",null),ig=u([R("esri.views.3d.state.controllers.CameraController")],ig);let NO=class extends ig{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Dr()),this._asyncResult=null),this.state===Zi.Finished||this.state===Zi.Stopped?(B4(e),this.state===Zi.Finished?e.resolve():e.reject(Dr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Zi.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Zi.Ready&&this.state!==Zi.Running||(this.viewAnimation.state===uS.State.FINISHED?this.finish():this.viewAnimation.state===uS.State.STOPPED&&(this.state=Zi.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Zi.Finished?this.viewAnimation.finish():this.state===Zi.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Zi.Finished?this._asyncResult.resolve():this._asyncResult.reject(Dr()))}finish(){this.finishController()}};NO=u([R("esri.views.3d.state.controllers.AnimationController")],NO);let dg=class extends NO{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new VHe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new uS}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);fM.copyFrom(this.view.state.camera);const s=Oh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(fM.ray,s,hre)&&(fM.center=hre),this.animation.update(fM,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?lHe[e.easing]:e.easing}}};u([p({constructOnly:!0})],dg.prototype,"mode",void 0),u([p({readOnly:!0})],dg.prototype,"isInteractive",null),dg=u([R("esri.views.3d.state.controllers.PointToPointAnimationController")],dg);const fM=new lt,hre=A();function vF(t=kHe){return[t[0],t[1],t[2],t[3]]}function FO(t,e){return zHe(t[0],t[1],t[2],e,IW.get())}function zHe(t,e,r,i,s=vF()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function GZ(t,e,r){return ot(r,t,e),ge(r,r),r[3]=z5(t,e),r}const kHe=[0,0,1,0];function i1e(t,e,r){return BHe(t,t.screenToRender(e,Ne.get()),r)}function BHe(t,e,r){const i=cn(Ne.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=cn(Ne.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Ne.get());return n==null?null:(he(r.direction,n,r.origin),r)}function aE(t,e,r){return jZ(t,t.screenToRender(e,Ne.get()),r)}function jZ(t,e,r){re(r.origin,t.eye);const i=se(Ne.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,Ne.get());return s==null?null:(he(r.direction,s,r.origin),r)}function HZ(t,e,r,i){const s=aE(e,r,GHe);return B_(t,s,i)}const GHe=Gn();var yS;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(yS||(yS={}));const s1e=30,LN=[1,3e8],bF=80,n1e=8,o1e=200,a1e=1508e5,l1e=5,c1e=50,jHe=5,HHe=10,qU=90,Mw={exclude:new Set([N0])};function Tb(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function C7(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function I_(t,e,r){const i=du($W.get(),r[3],r);i==null||Sge(i,nn)||(he(Wr,t.eye,e),$e(Wr,Wr,i),t.eye=le(Wr,Wr,e),he(Wr,t.center,e),$e(Wr,Wr,i),t.center=le(Wr,Wr,e),t.up=$e(Wr,t.up,i))}function qHe(t,e,r,i){return Ew(t,i1e(e,r,ZZ),i)}function A7(t,e,r,i){return Ew(t,aE(e,r,ZZ),i)}function qZ(t,e,r,i){const s=Ne.get();let n=1-r;he(s,e,t.eye);const o=Ee(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ie(s,s,n),t.eye=le(Wr,t.eye,s),t.center=Gr(Wr,t.center,e,n))}function u1e(t,e,r){e.getScreenCenter(dre),HZ(t,e,dre,Wr)&&(e.center=Wr);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=ie(Ne.get(),e.viewForward,s);e.eye=he(Wr,e.center,n)}const dre=Yi();function WU(t,e){se(e,0,0,0);for(const r of t)le(e,e,r);ie(e,e,1/t.length)}function gL(t,e,r,i){return Math.sin(t/Ee(e))*(r+i.radius)}function pre(t,e,r,i){return gL(Math.PI/2,e,r,i)+(t-Math.PI/2)}var jn;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(jn||(jn={}));const fre={Elevation:3e4,Angle:Ut(16)},mM={Pole:.95,Angle:Ut(18),Tilt:45},h1e=Ut(80);function d1e(t,e,r,i,s,n){const o=A(),a=_s();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=Ee(o):(c=!1,e.aboveGround&&s!==yS.Ellipsoid?a[3]=Math.max(Ee(e.center),.9*i.radius):a[3]=Ee(e.eye)-e.relativeElevation,s===yS.Silhouette?UO(a,e,r,o):l=HZ(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function wF(t,e,r){return Ee(t.eye)-r.radius>fre.Elevation?jn.Horizontal:(aE(t,e,xre),-Math.sign(t.relativeElevation)*(.5*Math.PI+z5(t.eye,xre.direction))<fre.Angle?jn.Vertical:jn.Horizontal)}function p1e(t,e,r){he(ZU,r,e),t.eye=he(Wr,t.eye,ZU),t.center=he(Wr,t.center,ZU)}const ZU=A();function UO(t,e,r,i){const s=aE(e,r,ZZ);return s!=null&&(tE(t,s,gM),B_(t,s,i)?!(fo(gM,s.origin)<fo(i,s.origin))||(re(i,gM),!1):(he(Jw,e.eye,e.center),ge(Jw,Jw),Iye(Jw,-me(ge(Jw,Jw),gM),mre),Ew(mre,s,i),!1))}const gM=A(),Jw=A(),mre=Ir();function f1e(t,e,r,i,s,n){let o=0;if(ot(FN,t,e),he(bM,t,e),Ee(t)<=s||!i.aboveGround){ot(r,bM,i.eye);const a=me(t,e)/(Ee(t)*Ee(e));if(a<.9999)o=Sn(a);else{const c=Ee(ot(A(),t,e))/(Ee(t)*Ee(e));o=_h(c)}const l=Math.cos(_e(__.normalize(Ut(n)),0,h1e));o=-o-Math.max(0,Ee(e)-s)/(l*s)}else he(gre,i.eye,i.center),ot(r,bM,gre),o=-Ee(bM)/s;return ge(r,r),ie(r,r,Ee(FN)),o}const gre=A();function yre(t,e,r,i){let s,n;const o=Math.cos(_e(__.normalize(Ut(i)),0,h1e));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Sn(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Sn(t/r),(n-s)*r}function WHe(t,e,r,i,s,n,o,a,l,c){const h=yre(t[2],e[2],n[3],a),d=l?yre(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*d-Math.cos(o)*h,m=Math.cos(o)*d+Math.sin(o)*h;ge(Wr,s);const y=l?f/Math.sqrt(Math.abs(n[3]**2-me(r,Wr)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-me(r,i)**2));nr(c,y,_)}function m1e(t,e,r,i,s,n,o,a,l,c){ot(FN,t,e),Jk(n.up,n.eye,yM,_M,vM),Jk([0,0,1],n.eye,_g,h_,v1e),re(r,h_),re(i,_g),ge(r,r),ie(r,r,Ee(FN)),WK(t,ge(_M,_M),ge(vM,vM),ge(yM,yM),_re),WK(e,_M,vM,yM,vre),WHe(_re,vre,t,_g,h_,o,a,l,c,s)}function ZHe(t,e,r,i,s,n,o){du(DN,s,i),du(NN,o,n),ni(KT,DN,NN),he(e,t,r),$e(e,e,KT),le(e,e,r)}function g1e(t,e,r,i,s,n){du(DN,i,r),du(NN,n,s),ni(KT,DN,NN),he(Wr,t.eye,e),$e(Wr,Wr,KT),t.eye=le(Wr,Wr,e),he(Wr,t.center,e),$e(Wr,Wr,KT),t.center=le(Wr,Wr,e),he(Wr,t.up,e),$e(Wr,Wr,KT),t.up=le(Wr,Wr,e)}function WZ(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-mM.Angle||Math.abs(i)<mM.Angle)&&(Math.abs(t[2])<r*mM.Pole||Math.abs(e)>r)&&n.aboveGround&&s<mM.Tilt}function y1e(t,e,r,i,s,n){if(n)GZ(r,i,bre),I_(e,t,bre);else{const o=f1e(r,i,wre,e,t[3],s);I_(e,t,FO(wre,o))}}function _1e(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,h;re(uv,i),wM.copyFrom(e);for(let d=0;d<a&&fo(r,uv)>l&&(c=fo(r,uv),m1e(r,uv,h_,_g,VE,wM,t,s,n,o),g1e(wM,t,_g,VE[1],h_,VE[0]),ZHe(uv,uv,t,_g,VE[1],h_,VE[0]),h=fo(r,uv),h<c||d===0);d++)e.copyFrom(wM)}function XHe(t,e,r,i,s,n,o){WZ(r,me(e.up,r),t[3],-__.normalize(Ut(s)),n,e)?_1e(t,e,r,i,-__.normalize(Ut(s)),n,o):y1e(t,e,r,i,n,o)}function YHe(t,e,r,i,s,n){const{eye:o}=t;Jk([0,0,1],o,_g,h_,v1e);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-me(t.center,_g)**2/Ee(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(uc(i.pan.matrix,i.pan.matrix,h,_g),i.pan.enabled=!0,s.mode){case"pan":uc(i.pan.matrix,i.pan.matrix,d,h_),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function JHe(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=ot(Ne.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(uc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(uc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function QHe(t,e,r,i,s,n,o,a,l){WZ(t.center,me(t.up,t.center),Ee(t.center),-__.normalize(Ut(n)),o,e)?YHe(e,r,i,a,l,-__.normalize(Ut(s))):JHe(e,r,i,a,l)}const _g=A(),h_=A(),v1e=A(),yM=A(),_M=A(),vM=A(),_re=A(),vre=A(),VE=Ue(),bre=vF(),DN=ve(),NN=ve(),KT=ve(),uv=A(),Wr=A(),bM=A(),wM=new lt,FN=A(),wre=A(),ZZ={origin:A(),direction:A()},xre={origin:A(),direction:A()},Tre=.6,XU=4,KHe=60;let UN=class extends dg{constructor(){super(...arguments),this._zoomLocation=A(),this._tmpCamera=new lt,this._tmpViewDir=A(),this._tmpRayDir={origin:A(),direction:A()},this._targetOnSphere=A(),this._tmpCenter=A(),this._constraintOptions={selection:Pi.ALL_EXCEPT_COLLISION,interactionType:Jt.ZOOM,interactionFactor:null,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Hn.TUMBLE},this._sphere=_s()}initialize(){this._intersector=Oh(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?Mw:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:UR}}_updateCamera(e,r,i,s,n){const o=Nr(this.view.spatialReference),a=wF(e,s,o),l=Math.abs(this.view.camera.position.z);ge(TM,e.eye),ie(TM,TM,-1),aE(e,s,this._tmpRayDir),ge(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=_e(Math.min(n1e,1/Math.abs(me(TM,this._tmpRayDir.direction)))*l,o1e,a1e);if(a===jn.Horizontal){let h=Tre**r;this._sphere[3]=Ee(i),he(this._tmpViewDir,e.center,e.eye);const d=Math.min(Ee(this._tmpViewDir),c);let f=d*h;if(h<=1&&f<XU&&(f=XU,h=f/d),Math.abs(d-f)<1e-6)return;const m=Ee(e.center);if(this._sphere[3]!==m){const y=this._sphere[3]+h*(m-this._sphere[3]);e.center=ie(xM,e.center,y/m)}ie(this._tmpViewDir,this._tmpViewDir,-h),e.eye=le(xM,e.center,this._tmpViewDir),Rs(this.view,e,this._constraintOptions),fo(i,e.center)>1e-12&&HZ(this._sphere,e,s,this._targetOnSphere)&&XHe(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=Tre**Math.abs(r);const d=r>0?1:-1;he(this._tmpViewDir,i,e.eye);const f=Ee(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,KHe);let y=m??c;y=n&&r>0?Math.min(y,f):y,ie(this._tmpRayDir.direction,this._tmpRayDir.direction,y),le(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*h;const v=Math.max(XU,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,h=_/y),Math.abs(y-_)<1e-6)return;ie(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-h)),e.eye=le(xM,e.eye,this._tmpRayDir.direction),e.center=le(xM,e.center,this._tmpRayDir.direction)}oE(this.view,e)}};UN=u([R("esri.views.3d.state.controllers.global.ZoomStepController")],UN);const xM=A(),TM=A(),eqe=.6,tqe=4,rqe=60;let VN=class extends dg{constructor(){super(...arguments),this._zoomLocation=A(),this._tmpCamera=new lt,this._tmpRayDir=A(),this._tmpCenter=A(),this._constraintOptions={selection:Pi.ALL,interactionType:Jt.ZOOM,interactionFactor:null,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Hn.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(i.camera);const n=Oh(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?Mw:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center);const a=eqe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,rqe);he(SM,this._tmpCamera.eye,this._zoomLocation),ge(SM,SM);const c=_e(Math.min(n1e,1/Math.abs(me(iqe,SM)))*Math.abs(this.view.camera.position.z),o1e,a1e);if(l=l??c,l){const h=A();he(h,this._zoomLocation,this._tmpCamera.eye),(l<Ee(h)||!o)&&(ge(h,h),le(this._zoomLocation,this._tmpCamera.eye,ie(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:UR}}_updateCamera(e,r,i){he(this._tmpRayDir,i,e.eye);const s=Ee(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(tqe,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,r),e.eye=he(Sre,i,this._tmpRayDir),e.center=Gr(Sre,e.center,i,1-r),Rs(this.view,e,this._constraintOptions)))}};VN=u([R("esri.views.3d.state.controllers.local.ZoomStepController")],VN);const Sre=A(),iqe=Ae(0,0,1),SM=A();function sqe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function XZ(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let nqe=class extends wo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(sqe(r,"primary")){const i=this._view.state.isGlobal?new UN({view:this._view,mode:"animation"}):new VN({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Yi(r.x,r.y)),e.stopPropagation()}}};function oqe(t,e,r){return t===Le.Global?new lqe(r):new aqe(e,r)}let aqe=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Nr(r),this._unitInMeters=Za(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){var x;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(i=i??new _r({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},d=Math.max(h.x,h.y,h.z);he(hv,r,e),Qw[0]=hv[0]>0?i.xmax:i.xmin,Qw[1]=hv[1]>0?i.ymax:i.ymin,Qw[2]=hv[2]>0?d/2:-d/2,he(Qw,Qw,e),ge(hv,hv);const f=1.1*me(Qw,hv)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*hqe*this._unitInMeters,v=y*dqe*this._unitInMeters,w=_e((o-v)/(_-v),0,1)**3,T=Math.min(xt(m,f,w),m)*Math.max(Math.log(Math.abs(l)),1);return b1e(Math.min(T,Math.max(34064e4,d))/this._unitInMeters,cqe,this._unitInMeters,n)}},lqe=class{constructor(e){this._referenceEllipsoid=Nr(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=Ee(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),d=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return b1e(1.2*xt(d,f,eZ(h)),_e(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function b1e(t,e,r,i){const s=uqe/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const cqe=2e4,uqe=2,hqe=.001,dqe=1e-4,Qw=A(),hv=A();let yL=class extends xe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&qve(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>oE(this.view,e,dh.EYE_AND_CENTER))}};u([p({constructOnly:!0})],yL.prototype,"view",void 0),yL=u([R("esri.views.3d.state.ElevationCollisionConstraint")],yL);let w3=class extends xe{constructor(e){super(e),this.nearFarHeuristic=oqe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ue(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(s=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ue(()=>this.view.renderDataExtent,()=>this._updateNearFar(),jr),ue(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(s=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),jr),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),jr),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),jr),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),jr),ue(()=>{var e,r,i,s,n,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),jr)]),this.view.state.isLocal&&this.addHandles(ue(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),zr)),this._updateNearFar(),this.view.state.viewingMode!==Le.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new yL({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,yF(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Pi.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Le.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Ut(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(qa(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=Pi.ALL){this.view.state.updateCamera(r=>Rs(this.view,r,{selection:e,interactionType:Jt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Hn.TUMBLE}))}};u([p({constructOnly:!0})],w3.prototype,"view",void 0),u([p({readOnly:!0})],w3.prototype,"surfaceCollisionConstraint",void 0),w3=u([R("esri.views.3d.state.ConstraintsManager")],w3);let U0=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=IO(),this._points=H_e(),this.lines=new Array(12),this._origin=A(),this._direction=A(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:A(),endpoint:null}}update(e){q_e(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),re(this._origin,e.eye),re(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)re(this._points[r],e[r]);W_e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return t_(this.frustum,e)}intersectsRay(e){return dBe(this.frustum,e)}intersectsLineSegment(e,r){return pBe(this.frustum,e,r)}intersectsPoint(e){return Z_e(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;YU(this.lines[r],e[r],e[i]),YU(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),YU(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function YU(t,e,r){t.origin=e,t.endpoint=r,Gg(t.direction,e,r)}U0.planePointIndices=fBe,U0.nearFarLineIndices=[[Ye.NEAR_BOTTOM_LEFT,Ye.FAR_BOTTOM_LEFT],[Ye.NEAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_RIGHT],[Ye.NEAR_TOP_RIGHT,Ye.FAR_TOP_RIGHT],[Ye.NEAR_TOP_LEFT,Ye.FAR_TOP_LEFT]];let CA=class extends ig{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Zi.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||qve(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),oE(this.view,e,dh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Zi.Stopped)})}};u([p({constructOnly:!0})],CA.prototype,"desiredCamera",null),CA=u([R("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],CA);const pqe=A(),EM=A();function YZ(){return{direction:A(),up:A()}}function w1e(t,e,r,i,s){let n=ge(pqe,t),o=me(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(me(e,i)),o<.99?(re(n,e),a&&ie(n,n,-1)):n=null);let l=0;if(n){ie(EM,i,me(i,n)),he(n,n,EM);const h=me(n,s)/(Ee(n)*Ee(s));ot(EM,n,s),l=(me(EM,i)>0?1:-1)*qa(Sn(h))}const c=qa(Sn(-me(i,t)/Ee(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const x1e=Ae(0,1,0),T1e=Ae(0,0,1),zE=ve(),cm=A(),um=A();function S1e(t,e,r,i=YZ()){const{direction:s,up:n}=i;return yge(zE,-Ut(e)),eS(zE,zE,Ut(r)),$e(s,T1e,zE),ie(s,s,-1),$e(n,x1e,zE),i}function fqe(t,e,r,i){return w1e(e,r,i,T1e,x1e)}function mqe(t,e,r,i){const s=S1e(t,r,i),n=A();return ie(n,s.direction,-e),le(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function gqe(t){return qa(t)}function yqe(t){return Ut(t)}function E1e(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return vo(e,cm,n),vo(e,um,n),cm[0]-=r/2,um[0]+=r/2,cm[1]-=i/2,um[1]+=i/2,js(cm,n,cm,o),js(um,n,um,o),s?(s.xmin=cm[0],s.ymin=cm[1],s.xmax=um[0],s.ymax=um[1],s.spatialReference=o):s=new _r(cm[0],cm[1],um[0],um[1],o),s}const _qe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:fqe,eyeForCenterWithHeadingTilt:mqe,eyeTiltToLookAtTilt:yqe,headingTiltToDirectionUp:S1e,lookAtTiltToEyeTilt:gqe,toExtent:E1e},Symbol.toStringTag,{value:"Module"})),C1e=Ae(0,0,1),A1e=ge(A(),Ae(1,1,1)),vqe=new y_(-180,180),kE=ve(),O0=A(),Kw=A();function O1e(t,e,r,i=YZ()){ot(O0,t,C1e),me(O0,O0)===0&&ot(O0,t,A1e),du(kE,-Ut(e),t),uc(kE,kE,-Ut(r),O0);const{up:s,direction:n}=i;return ot(s,O0,t),ge(s,s),$e(s,s,kE),ge(n,t),aa(n,n),$e(n,n,kE),i}function bqe(t,e,r,i){const s=O0,n=Kw;return ge(s,t),ot(Kw,s,C1e),me(Kw,Kw)===0&&ot(Kw,s,A1e),ot(n,Kw,s),w1e(e,r,i,s,n)}function wqe(t,e,r,i){const s={eye:A(),up:null,tilt:i,heading:r},n=O0;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=Ut(r),l=Ut(i),c=Math.sin(a),h=Math.cos(a),d=Math.sin(l),f=Math.cos(l),m=Ee(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const Y=m/d,M=_h(o/Y),D=Math.PI-l-M;y=Y*Math.sin(D)}const _=f*o,v=o*o*(d*d),w=h*h*v,T=y-_,x=T*T,S=w*(w+x-n[1]*n[1]);if(S<0)return ie(s.eye,n,y/m),s.tilt=0,CM(s,t);const O=Math.sqrt(S),C=n[1]*T,P=w+x;let $;if($=h>0?-O+C:O+C,Math.abs(P)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ie(s.eye,n,y/m),s.tilt=0,JU(s.eye),CM(s,t);s.eye[1]=$/P;const V=c*c*v,z=d*o,B=h*z*s.eye[1],k=s.eye[1]*s.eye[1],Z=1-k,W=Math.sqrt(Z),j=w*k+V-2*B*W*T+Z*x;return Math.abs(j)<1e-8?(ie(s.eye,n,y/m),s.tilt=0,JU(s.eye),CM(s,t)):(s.eye[0]=(Z*(y*n[0]-_*n[0])-z*W*(n[0]*s.eye[1]*h+n[2]*c))/j,s.eye[2]=(Z*(y*n[2]-_*n[2])-z*W*(n[2]*s.eye[1]*h-n[0]*c))/j,ie(s.eye,s.eye,y),JU(s.eye),CM(s,t))}function JU(t){const e=t[1];t[1]=-t[2],t[2]=e}function CM(t,e){const r=O1e(e,t.heading,t.tilt);return t.up=r.up,t}function xqe(t,e,r){const i=Ee(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=_h(r/(s/Math.sin(t)));return qa(t-n)}function Tqe(t,e,r){const i=Ut(t),s=Ee(e);return _h(r/(s/Math.sin(i)))+i}function R1e(t,e,r,i,s){let n,o,a,l;const c=e.latitude,h=Nr(t.spatialReference).radius,d=e.longitude,f=$Ge(c,r,h)/2;n=d-f,o=d+f;const m=Ut(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(i/h/2),v=_*_;function w(x){const S=Math.PI/2;return(x=aDe.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+i/h,a=w(a),l=w(l),l<a){const x=l;l=a,a=x}if(a=Math.max(qa(a),-90),l=Math.min(qa(l),90),o=vqe.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const T=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Ge.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new _r(n,a,o,l,T),t.spatialReference&&t.spatialReference.isWebMercator&&uA(s,!1,s),s}const Sqe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:bqe,eyeForCenterWithHeadingTilt:wqe,eyeTiltToLookAtTilt:Tqe,headingTiltToDirectionUp:O1e,lookAtTiltToEyeTilt:xqe,toExtent:R1e},Symbol.toStringTag,{value:"Module"}));function zN(t){return t.type==="point"}let JZ=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function P1e(t){return"array"in t}function yf(t,e,r="ground"){if(zN(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(P1e(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function O7(t,e){return t!=null&&(e==null||(e===Le.Local?!t.isGeographic||t.isWGS84||t.wkid===oh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===oh.CGCS2000||t.wkid===oh.GCSMARS2000||t.wkid===oh.GCSMARS2000_SPHERE||t.wkid===oh.GCSMOON2000))}const M1e=Q.getLogger("esri.views.3d.support.cameraUtils"),I1e=39.37,$1e=96,R7=1,Eqe=8,Cqe=5,L1e=1,Ere=A(),Aqe={heading:0,tilt:0},V0=new ct,Oqe=new y_(-20037508342788905e-9,20037508342788905e-9),Rqe=new y_(-180,180);var ko;function VR(t){return t.spatialReference||Ge.WGS84}function lE(t){return t.viewingMode==="global"?Sqe:_qe}function Pqe(t,e,r,i,s){return lE(t).headingTiltToDirectionUp(e,r,i,s)}function Qm(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=lE(t).headingTiltToDirectionUp,s=A();if(!vo(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);ie(n.direction,n.direction,t.state.camera.distance),le(n.direction,n.direction,s);const o=Pw(t,s,n.direction,n.up);return o.fov=Ut(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(ko||(ko={}));const ex=A();function _S(t,e,r){const i=t.renderSpatialReference,s=xF(t,e.eye,e.viewForward,e.up,Aqe);let n=VR(t);return js(e.eye,i,ex,n)||(n=Ge.WGS84,js(e.eye,i,ex,n)),r==null?new vh(new ct(ex,n),s.heading,s.tilt,qa(e.fov)):(r.position.x=ex[0],r.position.y=ex[1],r.position.z=ex[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=qa(e.fov),r)}function QZ(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===Le.Global&&r!=null&&(e*=Math.cos(Ut(r))),e/=t.renderCoordsHelper.unitInMeters,s/($1e*I1e/e)/Math.tan(i.fovX/2)}function Kb(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=$1e*I1e/(n/s);return t.renderCoordsHelper.viewingMode===Le.Global&&r!=null&&(o/=Math.cos(Ut(r))),o*t.renderCoordsHelper.unitInMeters}function D1e(t,e,r,i,s,n){return N1e(t,e,QZ(t,r,e.latitude),i,s,n)}function N1e(t,e,r,i,s,n){if(Sb(n)){const a=new cE(n.signal);return VO(t,i.heading,i.tilt,e,r,s,a),void a.resolver.promise.then(l=>{const c=BN(t,l,i.fov);if(c!=null)return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=VO(t,i.heading,i.tilt,e,r,s);return BN(t,o,i.fov,n)}function xF(t,e,r,i,s){return lE(t).directionToHeadingTilt(e,r,i,s)}function Mqe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,V0,t.spatialReference)&&t.elevationProvider&&(yf(t.elevationProvider,V0)??0)>(V0.z??0)-L1e)}async function Iqe(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,V0,t.spatialReference)||!t.elevationProvider)return!1;const i=V0.z??0;return(await t.elevationProvider.queryElevation(V0.x,V0.y,i,V0.spatialReference,"ground",r)??0)>i-L1e}async function $qe(t,e,r){const i=A();if(e)if(e instanceof ct){if(vo(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return s!=null&&t.renderCoordsHelper.setAltitude(i,s),i}}else re(i,e);else re(i,t.state.camera.center);return i}function Lqe(t,e){const r=A();if(e&&e instanceof ct){if(vo(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=yf(t.elevationProvider,e);i!=null&&t.renderCoordsHelper.setAltitude(r,i)}}else re(r,e||t.state.camera.center);return r}function VO(t,e,r,i,s,n,o){const a=i&&i instanceof ct?i:null;if(Sb(o))return $qe(t,i,o.signal).then(c=>{P7(t,e,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=Lqe(t,i);return P7(t,e,r,a,l,s,n,o)}function P7(t,e,r,i,s,n,o,a){if(i==null){const d=t.renderSpatialReference;if((i=Ng(s,d,VR(t)))==null)return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=Fqe(t,e,r,s,n,o),c=(0,lE(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===ko.ADJUST&&t.viewingMode==="global"&&r>0){const d=()=>{const m=F1e(t,s,n,Vqe(t,n,r,s));return o=r-m<1?ko.LOCKED:ko.ADJUST,P7(t,e,m,i,s,n,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(Mqe(t,c.eye))return d();if(Sb(a))return Iqe(t,c.eye,a.signal).then(m=>m?d():(a.resolver.resolve({eye:c.eye,up:c.up,center:Is(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||Sb(a)?{center:A(),eye:A(),up:A(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=Is(s),h.heading=c.heading,h.tilt=c.tilt,Sb(a)&&a.resolver.resolve(h),h}function AA(t,e,r,i,s,n=null){let o,a,l;if(t.state.isGlobal){if(!O7(e.spatialReference,Le.Global))return Sb(n)&&n.resolver.reject(),null;const v=new ct(e.xmin,e.ymin,e.spatialReference),w=new ct(e.xmax,e.ymax,e.spatialReference),T=e.spatialReference.isGeographic?Rqe:Oqe;o=new ct({x:T.center(v.x,w.x),y:(w.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const x=Nr(e.spatialReference),S=IGe(o,v,w);a=S.lon,l=S.lat,T.diff(v.x,w.x)>T.range/2&&(a+=x.halfCircumference),a=Math.min(a,x.halfCircumference),l=Math.min(l,x.halfCircumference)}else{const v=t.renderSpatialReference??e.spatialReference;v.equals(e.spatialReference)||(e=Sw(e,v)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const w=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new ct({x:e.xmin+.5*a,y:e.ymin+.5*l,z:w,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,d=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),y=Math.max(.5*a*d,.5*l*f,.5*c*m)/R7;if(Sb(n)){const v=new cE(n.signal);return VO(t,r,i,o,y,s,v),void v.resolver.promise.then(w=>{const T=BN(t,w,t.camera.fov);if(T!=null)return n.resolver.resolve(T);n.resolver.reject()},w=>n.resolver.reject(w))}const _=VO(t,r,i,o,y,s);return BN(t,_,t.camera.fov,n)}function Dqe(t,e,r){const i=t.renderSpatialReference,s=Ng(r,i,VR(t));if(s==null)return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=gR(e.eye,r),l=2*a*n*R7,c=2*a*o*R7;return t.viewingMode==="global"?R1e(t,s,l,c):E1e(t,s,l,c)}function Nqe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>Eqe)return!0;const s=t.renderSpatialReference,n=VR(t),o=Ng(e,s,n),a=Ng(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>Cqe}function Fqe(t,e,r,i,s,n){let o=0;return n===ko.ADJUST&&Nqe(t,i,s)?(e=0,o=Uqe(t,s,r,i)):o=KZ(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=F1e(t,i,s,o)}}const kN=.7;function Uqe(t,e,r,i){const s=KZ(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-kN)+n.max*kN;return Math.min(s,o)}function Vqe(t,e,r,i){let s=KZ(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-kN)+s*kN}function F1e(t,e,r,i){return lE(t).lookAtTiltToEyeTilt(i,e,r)}function KZ(t,e,r,i){return lE(t).eyeTiltToLookAtTilt(i,e,r)}function BN(t,e,r,i){if(e==null)return null;const s=t.renderSpatialReference,n=Ng(e.eye,s,VR(t));return n==null?null:i!=null?(i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new vh(n,e.heading,e.tilt,r)}function zqe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);M1e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function U1e(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);M1e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function V1e(t,e){return js(e.center,t.renderSpatialReference,Ere,Ge.WGS84),Kb(t,e.distance,Ere[1])}let cE=class{constructor(e){this.signal=e,this.resolver=yo()}};function Sb(t){return t&&"resolver"in t}const kqe=.66;function z1e(t){return 360-Hq.normalize(t)}function TF(t){return Hq.normalize(360-t)}function BE(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function Bqe(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function k1e(t,e,r,i=null){if(!e)return BE(i);const s=t.spatialReference||Ge.WGS84;if(e.camera!=null){const c=mw(e.camera.position,s);if(c==null)return BE(i);const h=e.camera.clone();return h.position=c.clone(),Bqe(i,h)}if(e.targetGeometry==null)return BE(i);const n=e.get("targetGeometry.spatialReference");if(n&&!a_(n,s))return BE(i);const o=_S(t,t.state.camera);let a=ko.ADJUST;if(e.rotation!=null&&(o.heading=z1e(e.rotation),a=ko.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const d=e.targetGeometry.clone();return h=e.scale!=null?QZ(t,e.scale,c.latitude):t.state.camera.distance,N1e(t,d,h,o,a,i)}const l=e.targetGeometry.extent;return l?AA(t,l,o.heading,o.tilt,a,i):BE(i)}function Gqe(t,e,r=null){return r==null&&(r=new sp),rX(t,null,e.clone(),r)}async function jqe(t,e,r){const i=eWe(t,e);if(!i)throw new U("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new vh({fov:t.camera.fov}),n=new sp({camera:s});if(i.target instanceof sp)return dv(await Wqe(t,i.target,i,r,n));if(i.target instanceof vh)return dv(G1e(t,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof _r){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return dv(o||c?await M7(t,i,i.target.center,s,r,n):await Jqe(t,i,i.target,s,r,n))}const a={boundingBox:Ti(),hasZ:!1,screenSpaceObjects:[]},l=o?Hqe(t,i):void 0;if(await B1e(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(Ud(a.boundingBox,Cs),Gc.x=Cs[0],Gc.y=Cs[1],Gc.z=Cs[2],Gc.spatialReference=t.spatialReference,isFinite(Gc.z)&&a.hasZ?c=dW(a.boundingBox):(Gc.z=void 0,c=jLe(hW(a.boundingBox,rWe))),o||c)return dv(await M7(t,i,Gc,s,r,n));const h=tWe(t,a.screenSpaceObjects);return dv(await Kqe(t,i,Gc,a.boundingBox,h,s,r,n))}return i.position?dv(Xqe(t,i,s,n)):dv(await Yqe(t,i,s,r,n))}function eX(t,e){return e.scale==null&&e.zoom!=null?U1e(t,e.zoom):e.scale}function Hqe(t,e){const r=eX(t,e);return r?n8e(r):void 0}function tX(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=z1e(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function rX(t,e,r,i){const s=t.spatialReference||Ge.WGS84;return(e=e??Qm(t,r))==null||(i.targetGeometry=Ng(e.center,t.renderSpatialReference,s),i.scale=V1e(t,e),i.rotation=TF(r.heading),i.camera=r),i}function GN(t,e,r){var a,l;const i=()=>new U("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!a_(e.spatialReference,t.spatialReference))throw new U("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&t.basemapTerrain.spatialReference!=null&&a_(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?Cs[2]=yf(t.elevationProvider,c)??0:Cs[2]=0}(0,iWe[e.type])(e,c=>{s.push(c[0],c[1],c[2])},Cs);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(ai(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(Cs[0]=o[c],Cs[1]=o[c+1],Cs[2]=o[c+2]):(Cs[0]=o[c],Cs[1]=o[c+1]),Ff(r.boundingBox,Cs)}}async function qqe(t,e,r,i){const s=await uu(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void GN(t,e.geometry,i);const n=s.value,o=await uu(n.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void GN(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;J2(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function B1e(t,e,r,i){var s;if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return Gc.x=n,Gc.y=o,Gc.z=void 0,Gc.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:Ge.WGS84,void GN(t,Gc,i)}e&&"map"in e&&typeof e.map=="function"?await Zf(e.map(n=>B1e(t,n,r,i))):e instanceof U_?GN(t,e,i):e instanceof hu&&await qqe(t,e,r,i)}async function Wqe(t,e,r,i,s){if(e.camera!=null)return G1e(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=TF(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=eX(t,r);n!=null&&(s.scale=n);const o=new cE(i);return k1e(t,s,r.tilt,o),s.camera=await o.resolver.promise,s}function G1e(t,e,r){const i=t.spatialReference,s=mw(e.position,i);return s==null?null:((e=e.clone()).fov=t.camera.fov,e.position=s,rX(t,null,e,r))}function Zqe(t,e,r,i,s,n){const o=t.renderSpatialReference;return vo(r,OM,o),vo(e,QU,o),n.targetGeometry=new ct(e),s.position=new ct(r),he(jN,QU,OM),xF(t,OM,jN,i.up,s),n.scale=Kb(t,mi(OM,QU),n.targetGeometry.latitude),n.rotation=TF(s.heading),n.camera=s,n}async function M7(t,e,r,i,s,n){if(r==null)throw new U("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=Pw(t);if(e.position)return Zqe(t,n.targetGeometry,e.position,o,i,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ie(Cs,o.viewForward,-l);o.eye=le(Cs,o.center,c),n.scale=Kb(t,l,r.latitude)}_S(t,o,i);const a=tX(i,e)?ko.LOCKED:ko.ADJUST;if(!e.zoomFactor){const l=eX(t,e);l==null?(vo(r,Cs,t.renderSpatialReference),Z_e(o.frustum,Cs)?n.scale=Kb(t,mi(o.eye,Cs),r.latitude):n.scale=V1e(t,o)):n.scale=l;const c=new cE(s);D1e(t,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function Xqe(t,e,r,i){const s=Pw(t);return re(jN,s.viewForward),xF(t,s.eye,jN,s.up,KU),r.position=new ct(e.position),r.heading=e.heading!=null?e.heading:KU.heading,r.tilt=e.tilt!=null?e.tilt:KU.tilt,rX(t,null,r,i)}async function Yqe(t,e,r,i,s){const n=Pw(t);return M7(t,e,Ng(n.center,t.renderSpatialReference,t.spatialReference),r,i,s)}async function Jqe(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=Pw(t);_S(t,o,i);const a=tX(i,e)?ko.LOCKED:ko.ADJUST,l=new cE(s);return AA(t,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function Qqe(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=yf(t.elevationProvider,r)),se(Cs,r.x,r.y,n),xl(t.spatialReference,Cs,Cre,t.renderSpatialReference),Eh(AM,Cre),Ch(AM,AM),Ti(GE);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=i[_[2]];isFinite(v)||(v=n),se(Cs,i[_[0]],i[_[1]],v),js(Cs,t.spatialReference,Cs,t.renderSpatialReference),Ff(GE,cc(Cs,Cs,AM))}const a=_w(GE),l=z_(GE),c=vw(GE),h=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(d,h)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(f,m)/s}async function Kqe(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=Pw(t),c=Qqe(t,l,r,i,s);_S(t,l,n);const h=tX(n,e)?ko.LOCKED:ko.ADJUST;a.scale=Kb(t,c,a.targetGeometry.latitude);const d=new cE(o);return D1e(t,a.targetGeometry,a.scale,n,h,d),a.camera=await d.resolver.promise,a}function eWe(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function dv(t){return t&&t.camera!=null&&(t.rotation=TF(t.camera.heading)),t}function tWe(t,e){const r=kqe;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const Cs=A(),Cre=ve(),AM=Fi(),GE=ln(),rWe=kt(),jN=A(),OM=A(),QU=A(),KU={heading:0,tilt:0},Gc=new ct,iWe={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(se(r,t.xmin,t.ymin,t.zmin)),e(se(r,t.xmax,t.ymin,t.zmin)),e(se(r,t.xmin,t.ymax,t.zmin)),e(se(r,t.xmax,t.ymax,t.zmin)),e(se(r,t.xmin,t.ymin,t.zmax)),e(se(r,t.xmax,t.ymin,t.zmax)),e(se(r,t.xmin,t.ymax,t.zmax)),e(se(r,t.xmax,t.ymax,t.zmax))):(e(se(r,t.xmin,t.ymin,r[2])),e(se(r,t.xmax,t.ymin,r[2])),e(se(r,t.xmin,t.ymax,r[2])),e(se(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)e(se(r,i[s],i[s+1],i[s+2]))}};let sWe=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&oa(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Dr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await K2(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,jqe(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var n;const r=!!(this.target instanceof sp&&this.target.camera||this.target instanceof vh),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new U("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const s=Qm(this.view,i);return s==null?(this.reject(new U("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new U("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new CA({view:this.view,desiredCamera:e.camera}),oE(this.view,e.camera,dh.EYE_AND_CENTER)):Rs(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof dg&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case Zi.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Zi.Ready:case Zi.Rejected:case Zi.Running:case Zi.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof dg&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new dg({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new U("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},dn=class extends xe{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=_S(this.view,this.view.state.camera,e8);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(Qm(this.view,e),{applyConstraints:!1})||Q.getLogger(this).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=_S(this.view,this.view.state.contentCamera,e8);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=Qm(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(t8),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=Da(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([ue(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(t8),this.test.contentCameraResetState.clear())}),ue(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),ue(()=>this.view.state.camera,o=>{const a=fo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],t8),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Q.getLogger(this).error("#center=","Invalid center",e):Q.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):Q.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=Dqe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#extent=","Invalid extent",e):Q.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):Q.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Kb(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[tr.TOP]/i),o=Math.round(r[tr.RIGHT]/i),a=Math.round(r[tr.BOTTOM]/i),l=Math.round(r[tr.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,RM),this.view.state.updateCamera(r=>r.padding=RM))}_paddingToArray(e,r,i){e?wi(i,e.top||0,e.right||0,e.bottom||0,e.left||0):wi(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return wh((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Gqe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Q.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,s=i!=null&&i.spatialReference;Q.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else Q.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?zqe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Q.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return ob(this._tmpCanvasSize,i)?this._tmpCanvasSize.pixelRatio=r:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(Gs.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(Gs.PhysicalPixelRendering,$r.IDLE)||e.isFeatureEnabled(Gs.PhysicalPixelRendering,$r.INTERACTING)||e.isFeatureEnabled(Gs.PhysicalPixelRendering,$r.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new Ug({frustum:U0},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new nWe}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Ga(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),jr)]),xh(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([k2({prepare:()=>this._prepareFrame()}),ue(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(PM)}),Ga(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Pe(this._propertiesPool)}init(){this.constraintsManager=new w3({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===Le.Local&&this.addHandles(xh(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(PM),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),PM)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(PM),this.constraintsManager=Pe(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new sWe(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Pw(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of aWe){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof vh)return void this.setStateCamera(Qm(this.view,e),{applyConstraints:!1});if(e instanceof sp){if(e.targetGeometry instanceof _r){const n=AA(this.view,e.targetGeometry,0,.5,ko.LOCKED);return void(n!=null&&this.setStateCamera(Qm(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=AA(this.view,e,0,.5,ko.LOCKED);r!=null&&this.setStateCamera(Qm(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&oWe.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof sp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof vh?this.isCompatible(e.position):e.spatialReference&&a_(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=lWe){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=Ty){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=VO(this.view,s,n,e,r,ko.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=AA(this.view,e,r,i,ko.ADJUST,e8);return s?Qm(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude;if(s==null)return null;const n=QZ(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera(U1e(this.view,e))}_viewpointToCamera(e){return Qm(this.view,k1e(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&Rs(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new CA({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===i.width&&s.fullHeight===i.height&&s.pixelRatio===i.pixelRatio||(Ty.copyFrom(s),Ty.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,RM),Ty.padding=RM),Ty.fullWidth=i.width,Ty.fullHeight=i.height,Ty.pixelRatio=i.pixelRatio,this.view.state.camera=Ty),this._updateViewState()}}_updateElevation(e){var n;const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=((n=this.view.renderCoordsHelper)==null?void 0:n.getAltitude(e.eye))??0,s=r?yF(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=$r.ANIMATING:this.view.interacting?this.view.state.mode=$r.INTERACTING:(this.view.state.mode===$r.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=cWe?this.view.state.mode=$r.INTERACTING:this.view.state.mode=$r.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([p({type:vh,dependsOn:["view.state.camera","ready"]})],dn.prototype,"camera",null),u([p({type:vh,dependsOn:["view.state.contentCamera","ready"]})],dn.prototype,"contentCamera",null),u([p({type:ct})],dn.prototype,"center",null),u([p({type:_r})],dn.prototype,"extent",null),u([p({readOnly:!0})],dn.prototype,"frustum",null),u([p({readOnly:!0})],dn.prototype,"hasInitialView",null),u([p({readOnly:!0,type:Boolean})],dn.prototype,"ready",void 0),u([p({type:Number})],dn.prototype,"scale",null),u([p()],dn.prototype,"padding",null),u([p({readOnly:!0})],dn.prototype,"screenCenter",null),u([p({constructOnly:!0})],dn.prototype,"view",void 0),u([p({type:sp})],dn.prototype,"viewpoint",null),u([p({type:Number})],dn.prototype,"zoom",null),u([p({readOnly:!0})],dn.prototype,"_rasterPixelRatio",null),u([p({readOnly:!0})],dn.prototype,"_usePhysicalPixelRendering",null),u([p({readOnly:!0})],dn.prototype,"_usePhysicalPixelRenderingAny",null),u([p()],dn.prototype,"_windowDevicePixelRatio",void 0),u([p()],dn.prototype,"_devicePixelRatioOverride",void 0),dn=u([R("esri.views.3d.state.ViewStateManager")],dn);let nWe=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const oWe=["camera","viewpoint","extent","scale","center","zoom"],aWe=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],lWe={heading:0,tilt:0},e8=new vh,Ty=new lt,RM=Yt(),PM="pending-initial-view",t8="content-camera-reset",cWe=300,Are=100;let _f=class extends ig{constructor(){super(...arguments),this.startCamera=new lt,this.currentCamera=new lt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Are}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Zi.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Are),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([p({readOnly:!0})],_f.prototype,"isInteractive",null),u([p()],_f.prototype,"_lastInteraction",void 0),_f=u([R("esri.views.3d.state.controllers.InteractiveController")],_f);var Kl;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Kl||(Kl={}));let OA=class extends _f{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Kl.CENTER,this._rotScale=0,this._lastPoint=Ue(),this._tmpWorldUp=A(),this._tmpViewDir=A(),this._tmpRotCurPoint=Ue(),this._tmpTransf=ve(),this._tmpAxis=A(),this._tmpPivotPoint=A(),this._pivotPos=A(),this._constraintOptions={selection:Pi.ALL,interactionType:Jt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Hn.TUMBLE}}initialize(){this._rotScale=this.pivot===Kl.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Kl.EYE:re(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Jt.LOOK_AROUND,this._constraintOptions.tiltMode=Hn.LOOK_AROUND,this._constraintOptions.selection=Pi.NONE;break;case Kl.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Mw:{});r||re(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Jt.TUMBLE,this._constraintOptions.tiltMode=Hn.TUMBLE,this._constraintOptions.selection=Pi.ALL&~Pi.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,Tb(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=A();he(s,this._pivotPos,i.eye);const n=Ee(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Ore);let a=Math.max(Math.min(jHe,1/Math.abs(me(Ore,i.viewForward)))*o,HHe);r&&(a=Math.min(n,a));const l=Nr(this.view.spatialReference),c=Yi(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),h=wF(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*qU,qU),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,qU);d==null&&f==null||(d=d??f??0,f=f==null||h===jn.Horizontal?d:f,a=d>f?f:d,a=r?Math.min(a,n):a),ge(s,s),re(this._pivotPos,le(this._tmpPivotPoint,i.eye,ie(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case Kl.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Kl.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Rs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),Tb(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;he(this._tmpViewDir,i,s);const a=Ee(this._tmpViewDir),l=Sn(me(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Kl.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=_e(n+l,Mo.min,Mo.max)-l,ot(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Kl.CENTER&&(o=-o),du(this._tmpTransf,o,this._tmpWorldUp),uc(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),$e(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=$e(r8,e.up,this._tmpTransf),le(r8,s,this._tmpViewDir),cn(this._lastPoint,this._tmpRotCurPoint),r8}};u([p()],OA.prototype,"pivot",void 0),OA=u([R("esri.views.3d.state.controllers.RotateController")],OA);const r8=A(),Ore=A();let i8=class extends wo{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!XZ(e.data,this.pointerAction))return;const i=Yi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new OA({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},I7=class extends _f{constructor(){super(...arguments),this._pickPoint=A(),this._tmpP0=Ue(),this._panAxisAngle=vF(),this._tmpRayDir=A(),this._tmpRayDirPick=A(),this._targetOnSphere=A(),this._navMode=jn.Horizontal,this._tmpRay={origin:A(),direction:A()},this.dragBeginPoint=Yi(),this._normalizedAnchorPoint=Ue(),this._constraintOptions={selection:Pi.ALL_EXCEPT_COLLISION,interactionType:Jt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Hn.TUMBLE},this._sphere=_s(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;cn(this.dragBeginPoint,e),Tb(this.startCamera,e,this._normalizedAnchorPoint);const r=Nr(this.view.spatialReference),i=d1e(this._intersectionHelper,this.startCamera,e,r,yS.Ellipsoid,this.view.map.ground.opacity===0?Mw:{});if(this._navMode=wF(this.startCamera,e,r),this._navMode===jn.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let s;aE(this.startCamera,e,this._tmpRay),ge(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(he(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Ee(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Rre);let o=_e(Math.min(s1e,1/Math.abs(me(Rre,this._tmpRay.direction)))*n,LN[0],LN[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,bF);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ie(this._tmpRay.direction,this._tmpRay.direction,o),le(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===jn.Horizontal){he(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Ee(this._tmpRayDir);Tb(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/Ee(this.currentCamera.center));this.currentCamera.center=ie(MM,this.currentCamera.center,o)}ie(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=le(MM,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Id(Wb(this.dragBeginPoint,e)),Rs(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(UO(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),GZ(this._pickPoint,this._targetOnSphere,this._panAxisAngle),I_(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Ee(this._tmpRay.direction);Tb(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;ie(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=le(MM,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=le(MM,this.currentCamera.center,this._tmpRayDir)}oE(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};I7=u([R("esri.views.3d.state.controllers.global.ZoomController")],I7);const MM=A(),Rre=A();let $7=class extends _f{constructor(){super(...arguments),this._tmpP=A(),this._tmpDir=A(),this._tmpN=A(),this._tmpP0=Ue(),this._tmpPoi=A(),this._tmpRayDir=A(),this.dragBeginPoint=Yi(),this._normalizedAnchorPoint=Ue(),this._constraintOptions={selection:Pi.ALL,interactionType:Jt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:A(),tiltMode:Hn.TUMBLE},this._plane=Ir()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;cn(this.dragBeginPoint,e),Tb(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Mw:{});he(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Ee(this._tmpDir);ge(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=_e(Math.min(s1e,1/Math.abs(me(uWe,this._tmpDir)))*s,LN[0],LN[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,bF);n=o??n,n=r?Math.min(n,i):n,ie(this._tmpDir,this._tmpDir,n),le(this._tmpP,this.startCamera.eye,this._tmpDir),he(this._tmpN,this.startCamera.eye,this.startCamera.center),ge(this._tmpN,this._tmpN),this._tmpN[1]<0&&aa(this._tmpN,this._tmpN),RR(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;qHe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||re(this._tmpPoi,this.currentCamera.center),Tb(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);cn(this._normalizedAnchorPoint,this._tmpP0),he(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Ee(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(re(this._constraintOptions.interactionDirection,this._tmpRayDir),ie(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=le(pv,this.currentCamera.eye,this._tmpRayDir),Gr(pv,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?pv[2]=Math.max(this.startCamera.center[2],pv[2]):pv[2]=Math.min(this.startCamera.center[2],pv[2]),this.currentCamera.center=pv,this._constraintOptions.interactionFactor=Id(Wb(this.dragBeginPoint,e)),Rs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};$7=u([R("esri.views.3d.state.controllers.local.ZoomController")],$7);const pv=A(),uWe=Ae(0,0,1);let hWe=class extends wo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!XZ(e.data,this.pointerAction))return;const i=Yi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new I7({view:this._view}):this._cameraController=new $7({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Gh(t){let e=t*t;return t<0&&(e*=-1),e}function Pre(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=Gh(s.axes[0]),i.translation[1]=Gh(s.axes[1]),i.translation[2]=Gh(s.buttons[7])-Gh(s.buttons[6]),i.heading=Gh(s.axes[2]),i.tilt=Gh(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*Gh(s.axes[0]),i.translation[1]=1.2*Gh(s.axes[1]),i.translation[2]=2*-Gh(s.axes[2]),i.heading=1.2*Gh(s.axes[5]),i.tilt=1.2*Gh(s.axes[3])),i.tilt*=o,ie(i.translation,i.translation,a),i}function Mre(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function s8(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let ab=class extends _f{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new lt,this._headingStart=0,this._constraintOptions={selection:Pi.ALL,interactionType:Jt.NONE,interactionStartCamera:new lt,interactionFactor:0,interactionDirection:null,tiltMode:Hn.LOOK_AROUND}}handleEventGamepad(e){const r=Pre(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||s8(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Mre(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=Mre(this._keysButtonState,this._transformation);s8(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,fv),this._applyDisabledMovementTypes(fv),this._applyPan(fv.pan),this._applyRotate(fv.rotate),this._applyZoom(fv.zoom),this._applyAscend(fv.ascend),this._constraintOptions.interactionType=Jt.NONE,this._constraintOptions.selection=Pi.COLLISION,Rs(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;he(Qa,r.center,r.eye),$e(Qa,Qa,e.matrix),r.center=le(Qa,Qa,r.eye),r.up=$e(Qa,r.up,e.matrix),this._constraintOptions.interactionType=Jt.LOOK_AROUND,this._constraintOptions.selection=Pi.ALL_EXCEPT_COLLISION,Rs(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=$e(Qa,r.eye,e.matrix),r.center=$e(Qa,r.center,e.matrix),this.view.state.isGlobal&&(r.up=$e(Qa,r.up,e.matrix)),this._constraintOptions.interactionType=Jt.PAN,this._constraintOptions.selection=Pi.ALL,Rs(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=le(Qa,this.currentCamera.eye,ie(Ne.get(),r,e)),re(jE,r),aa(jE,jE),this._constraintOptions.interactionDirection=jE,this._constraintOptions.interactionType=Jt.ZOOM,this._constraintOptions.selection=Pi.ALL_EXCEPT_COLLISION,Rs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ne.get());if(this._constraintOptions.interactionDirection=re(jE,r),this.view.state.isGlobal){const i=Ee(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=ie(Qa,this.currentCamera.eye,s),this.currentCamera.center=ie(Qa,this.currentCamera.center,s)}else{const i=ie(Ne.get(),r,e);this.currentCamera.eye=le(Qa,this.currentCamera.eye,i),this.currentCamera.center=le(Qa,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Jt.ASCEND,this._constraintOptions.selection=Pi.COLLISION,Rs(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Pi.ALL_EXCEPT_COLLISION,Rs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){_We(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,Qa)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=se(Ne.get(),n[0],n[1],0);ge(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=ie(Ne.get(),s,c);Cl(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=ie(Ne.get(),l,_);Cl(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;i.ascend=h;const d=-o.heading*e.rotate;d!==0&&(uc(i.rotate.matrix,i.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Ne.get())),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=M_(this.view.renderCoordsHelper,r.center,r.eye),y=_e(m+f,Mo.min,Mo.max)-m;y&&(uc(i.rotate.matrix,i.rotate.matrix,y,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=ot(Ne.get(),n,s);ge(l,l),aa(l,l),QHe(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(fv.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;i.ascend=h;const d=-o.heading*e.rotate;d!==0&&(uc(i.rotate.matrix,i.rotate.matrix,d,this._tmpCamera.eye),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,r.ray,c);m!==0&&(uc(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=Nr(this.view.spatialReference),n=gL(Mo.min,r.origin,i,s);let o=0,a=0;const l=Ne.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=M_(this.view.renderCoordsHelper,l,r.origin);o=gL(c,r.origin,i,s),a=gL(Mo.max,r.origin,i,s)}else{tE(k5(B5,i+s.radius),r,l);const c=Math.PI+z5(r.direction,l);o=pre(c,r.origin,i,s),a=pre(Mo.max,r.origin,i,s)}return _e(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=Pqe(this.view,r,0,j1e,yWe),o=i.intersectManifoldClosestSilhouette(pu(r,n),e,Ne.get()),a=mi(r,o),l=i.intersectManifoldClosestSilhouette(pu(r,Gg(Ne.get(),r,s.center)),e,Ne.get()),c=mi(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Ne.get());if(n){const a=he(Ne.get(),e,o),l=Ee(a);ie(a,a,1/l);const c=ge(Ne.get(),e),h=Sn(me(c,a));return l*Math.sin(Math.min(pWe,h))}{const a=re(Ne.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),mi(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:fWe}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Nr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Ne.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,h=Ire*s.width,d=Ire*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/i,y=f/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:_e(y*d,mWe,gWe)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Th(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Th(e.rotate.matrix))}static activatesFor(e,r){const i=Pre(r,e.navigation.gamepad,dWe);return!(r.action==="end"||s8(i))}};u([p({constructOnly:!0})],ab.prototype,"gamepadDevice",void 0),u([p({constructOnly:!0})],ab.prototype,"disableMovements",void 0),ab=u([R("esri.views.3d.state.controllers.GamepadKeyboardController")],ab);const dWe={translation:[0,0,0],heading:0,tilt:0,zoom:0},j1e=80,pWe=Ut(j1e),Ire=.75,fWe=5,mWe=Ut(30),gWe=Ut(80),fv={zoom:0,ascend:0,pan:{enabled:!1,matrix:ve()},rotate:{enabled:!1,matrix:ve()}},Qa=A(),jE=A(),yWe=YZ();function _We(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Th(t.pan.matrix),t.rotate.enabled=!1,Th(t.rotate.matrix)}let vWe=class extends wo{constructor(e){super(!0),this._view=e,this._watchHandles=new Mi,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ue(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},zr),ue(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||ab.activatesFor(this._view,e.data)){if(!i){const s=new ab({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var ql;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(ql||(ql={}));let bWe=class extends wo{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Le.Local},this._keyToNumber={[r.left]:ql.LEFT,[r.right]:ql.RIGHT,[r.forward]:ql.FORWARD,[r.backward]:ql.BACKWARD,[r.up]:ql.UP,[r.down]:ql.DOWN,[r.headingLeft]:ql.HEADINGLEFT,[r.headingRight]:ql.HEADINGRIGHT,[r.tiltUp]:ql.TILTUP,[r.tiltDown]:ql.TILTDOWN,[r.zoomIn]:ql.ZOOMIN,[r.zoomOut]:ql.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new ab({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},wWe=class extends wo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new UN({view:this._view,mode:"interaction"}):new VN({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Yi(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},HN=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},ew=class extends NO{constructor(){super(...arguments),this._beginCamera=new lt,this._elapsedTimeSec=0,this.constraintOptions={selection:Pi.ALL,interactionType:Jt.PAN,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Hn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new uS}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),Rs(this.view,r,this.constraintOptions)}};ew=u([R("esri.views.3d.state.controllers.momentum.MomentumController")],ew);let RA=class extends ew{constructor(e){super(e),this.interactionType=Jt.PAN,this._tmpPan=A()}momentumStep(e,r){const i=this.momentum.value(e);ie(this._tmpPan,this.momentum.direction,i),r.eye=he($re,r.eye,this._tmpPan),r.center=he($re,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([p({constructOnly:!0})],RA.prototype,"momentum",void 0),RA=u([R("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],RA);const $re=A(),xWe=A(),IM=A();let _L=class extends ew{constructor(e){super(e),this.interactionType=Jt.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);re(IM,r.eye),ge(IM,IM),ot(this.momentum.axis2,IM,this.momentum.axis1),g1e(r,xWe,this.momentum.axis1,i,this.momentum.axis2,s)}};u([p({constructOnly:!0})],_L.prototype,"momentum",void 0),_L=u([R("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],_L);let q1=class extends ew{set center(e){this._set("center",Is(e))}set axis(e){this._set("axis",Is(e))}constructor(e){super(e),this.interactionType=Jt.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);I_(r,this.center,FO(this.axis,i))}};u([p({constructOnly:!0})],q1.prototype,"momentum",void 0),u([p({constructOnly:!0})],q1.prototype,"center",null),u([p({constructOnly:!0})],q1.prototype,"axis",null),q1=u([R("esri.views.3d.state.controllers.momentum.MomentumController")],q1);let e2=class extends ew{set zoomCenter(e){this._set("zoomCenter",Is(e))}constructor(e){super(e),this.interactionType=Jt.ZOOM,this.constraintOptions.interactionDirection=A()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;re(i,r.eye);const s=this.momentum.valueDelta(0,e);qZ(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Gg(i,r.eye,i)}};u([p({constructOnly:!0})],e2.prototype,"momentum",void 0),u([p({constructOnly:!0})],e2.prototype,"zoomCenter",null),e2=u([R("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],e2);let h1=class extends ew{set screenCenter(e){this._set("screenCenter",Yi(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Is(e))}constructor(e){super(e),this.interactionType=Jt.ZOOM,this.radius=0,this._tmpSceneCenter=A(),this._tmpZoomAxisAngle=vF(),this._sphere=_s()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);u1e(this._sphere,r,i),this.constraintOptions.interactionType=Jt.ZOOM,Rs(this.view,r,this.constraintOptions),UO(this._sphere,r,this.screenCenter,this._tmpSceneCenter),GZ(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),I_(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Jt.PAN}};u([p({constructOnly:!0})],h1.prototype,"momentum",void 0),u([p({constructOnly:!0})],h1.prototype,"screenCenter",null),u([p({constructOnly:!0})],h1.prototype,"sceneCenter",null),u([p({constructOnly:!0})],h1.prototype,"radius",void 0),h1=u([R("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],h1);let $d=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},SF=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},TWe=class extends SF{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},H1e=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new $d(.6),this._screen=[new $d(.4),new $d(.4)],this._scene=[new $d(.6),new $d(.6),new $d(.6)],this._tmpDirection=A()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ee(this._tmpDirection);s>0&&ie(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new TWe(e,r,i,n==null?0:s/n,this._tmpDirection)}},Lre=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Dre=1e-5;let SWe=class extends SF{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},EWe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=A(),this._tmpAxis2=A(),this._tmpAngles=Ue(),this._time=new $d(.3),this._screen=[new $d(.4),new $d(.4)],this._angle1=new Lre(.6),this._angle2=new Lre(.6),this._axis1=A(),this._axis2=A(),this._lastScene=A()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=f1e(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),ra(this._tmpAxis2)<Dre?a=0:ge(this._axis1,this._tmpAxis2),this._angle1.update(a),re(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;m1e(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),ra(this._tmpAxis2)<Dre?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ge(this._axis1,this._tmpAxis1),ge(this._axis2,this._tmpAxis2)),re(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new SWe(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},q1e=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new $d(.8),this.time=new $d(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=_e(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new SF(e,r,i)}},W1e=class extends q1e{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},CWe=class extends SF{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},Z1e=class extends q1e{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new CWe(e,r,i)}},L7=class extends _f{constructor(){super(...arguments),this._smoothRotation=new HN(.05),this._rotationAxis=A(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Ir(),this._beginRadius=0,this._smoothScaling=new HN(.05),this._zoomCenterScreen=Yi(),this._zoomMomentumEstimator=new Z1e,this._rotationMomentumEstimator=new W1e,this._panSphericalMomentumEstimator=new EWe,this._panPlanarMomentumEstimator=new H1e,this._adjustedSphere=_s(),this._tmp3d=A(),this._tmpScreenPointArray=Yi(),this._beginScreenPoint=Yi(),this._beginScenePoint=A(),this._screenPickPoint=Yi(),this._scenePickPoint=A(),this._mode=jn.Horizontal,this._sphere=_s(),this._pointerCount=0,this._tmpInteractionDirection=A(),this._constraintOptions={selection:Pi.ALL,interactionType:Jt.NONE,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Hn.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var n;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-__.normalize(Ut(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),hf(e.center,this._screenPickPoint),cn(this._beginScreenPoint,this._screenPickPoint);const i=Nr(this.view.spatialReference),s=d1e(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,yS.Silhouette,this.view.map.ground.opacity===0?Mw:{});s.scenePickPoint!=null&&(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,re(this._beginScenePoint,this._scenePickPoint),this._mode=wF(this.startCamera,this._screenPickPoint,i),this._mode===jn.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(n=this._constraintOptions.interactionStartCamera)==null||n.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===jn.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===jn.Horizontal?new h1({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new e2({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new q1({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===jn.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new _L({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new RA({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=aa(this._tmp3d,this.startCamera.viewForward);RR(this._scenePickPoint,i,this._panningPlane);const s=Yi(this._screenPickPoint[0],0),n=A(),o=Ee(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],UO(this._adjustedSphere,this.startCamera,s,n);const a=Vo();this.startCamera.projectToRenderScreen(n,a);const l=A(),c=A(),h=A();he(l,this._scenePickPoint,this.currentCamera.eye);const d=Ee(l);ge(l,l);const f=l1e*Math.max(Math.abs(this.view.camera.position.z),c1e),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,bF);let y=m??f;y=r?Math.min(y,d):y,re(h,le(c,this.currentCamera.eye,ie(c,l,y))),this._panningPlane[3]=-me(this._panningPlane,h),this.startCamera.center=le(c,this.startCamera.eye,ie(c,this.startCamera.viewForward,y));const _=hf(e.center,this._tmpScreenPointArray);A7(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),u1e(this._sphere,this.currentCamera,this._smoothScaling.value),hf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Jt.ZOOM,this._constraintOptions.interactionFactor=Id(e.radius-this._beginRadius),Rs(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=hf(e.center,this._tmpScreenPointArray);UO(this._sphere,this.currentCamera,r,this._tmp3d),WZ(this._beginScenePoint,me(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(_1e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(y1e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Jt.PAN,this._constraintOptions.interactionFactor=Id(Wb(this._screenPickPoint,r)),Rs(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ge(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||aa(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+C7(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),I_(this.currentCamera,this._sphere,FO(this._rotationAxis,n)),this._constraintOptions.interactionType=Jt.TUMBLE,this._constraintOptions.interactionFactor=Id(e.radius*i),Rs(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=hf(e.center,this._tmpScreenPointArray);A7(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(p1e(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Jt.PAN,this._constraintOptions.interactionFactor=Id(Wb(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Rs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),qZ(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Jt.ZOOM,this._constraintOptions.interactionFactor=Id(e.radius-this._beginRadius),Rs(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){re(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||aa(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=C7(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),I_(this.currentCamera,this._sphere,FO(this._rotationAxis,o)),this._constraintOptions.interactionType=Jt.TUMBLE,this._constraintOptions.interactionFactor=Id(e.radius*o),Rs(this.view,this.currentCamera,this._constraintOptions)}};L7=u([R("esri.views.3d.state.controllers.global.PinchAndPanController")],L7);const Nre=Ae(0,0,1),AWe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let D7=class extends _f{constructor(){super(...arguments),this._rotationValueSmooth=new HN(.05),this._scalingValueSmooth=new HN(.05),this._planeHorizontal=Ir(),this._planeVertical=Ir(),this._rotationMomentumEstimator=new W1e,this._panMomentumEstimator=new H1e(300,12,.9),this._zoomMomentumEstimator=new Z1e,this._beginRadius=0,this._beginCenter=A(),this._beginAngle=0,this._tmpPoints=[],this._panMode=jn.Horizontal,this._beginCenterScreen=Yi(),this._tmpCentroid3d=A(),this._tmpCentroid2d=Yi(),this._tmp2d=Yi(),this._pointerCount=0,this._constraintOptions={selection:Pi.ALL,interactionType:Jt.NONE,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Hn.TUMBLE}}begin(e){var y;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),hf(e.center,this._beginCenterScreen),Iye(Nre,0,this._planeHorizontal);const i=A(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?Mw:{}),n=A();aa(n,this.startCamera.viewForward);const o=A();re(o,Nre);const a=me(n,o),l=_h(a<0?-a:a);this._panMode=l>=AWe.ANGLE_THRESHOLD?jn.Horizontal:jn.Vertical;const c=Math.min(l1e,1/Math.abs(me(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),c1e);Zk(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||Xk(this._planeHorizontal,this._planeHorizontal);const h=A(),d=A(),f=A();he(h,i,this.currentCamera.eye);const m=Ee(h);if(ge(h,h),this._panMode===jn.Vertical){ie(o,o,a),he(this._planeVertical,n,o),ge(this._planeVertical,this._planeVertical),Zk(this._planeVertical,this._planeVertical,i);const _=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,bF);let v=_??c;v=s?Math.min(v,m):v,re(f,le(d,this.currentCamera.eye,ie(d,h,v))),this._planeVertical[3]=-me(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),WU(this._tmpPoints,this._beginCenter)}else{const _=s?m:c;re(f,le(d,this.currentCamera.eye,ie(d,h,_))),this._planeHorizontal[3]=-me(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),WU(this._tmpPoints,this._beginCenter)}(y=this._constraintOptions.interactionStartCamera)==null||y.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===jn.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),qZ(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Jt.ZOOM,this._constraintOptions.interactionFactor=Id(Math.abs(e.radius-this._beginRadius)),Rs(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),WU(this._tmpPoints,this._tmpCentroid3d),hf(e.center,this._tmpCentroid2d),p1e(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Jt.PAN,this._constraintOptions.interactionFactor=Id(Wb(this._beginCenterScreen,this._tmpCentroid2d)),Rs(this.view,this.currentCamera,this._constraintOptions),r){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+C7(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),I_(this.currentCamera,o,FO(n,h)),this._constraintOptions.interactionType=Jt.TUMBLE,this._constraintOptions.interactionFactor=Id(Math.abs(e.radius*h)),Rs(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new e2({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new q1({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new RA({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=A()),A7(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};D7=u([R("esri.views.3d.state.controllers.local.PinchAndPanController")],D7);let Fre=class extends wo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!XZ(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new L7({view:this._view}):new D7({view:this._view})}},OWe=class extends wo{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},X1e=class extends wo{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},RWe=class extends X1e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},PWe=class extends X1e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},MWe=class extends wo{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var s,n,o;const r=this._invert?-1:1,i=Yi(0,e.data.delta*r);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new OA({view:this._view,pivot:Kl.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(n=this._cameraController)==null||n.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function Ure(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>LWe(r,t.axisThreshold))}:{buttons:[],axes:[]}}function IWe(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function $We(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function LWe(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let DWe=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Ure(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new XW(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=k2({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=Ure(n),l=i||$We(a);o&&(o.timestamp===s.timestamp||!o.active&&l||IWe(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const Vre=oe("edge"),NWe=oe("chrome"),FWe=oe("ff"),UWe=oe("safari"),zre="esri-view-surface",tx={touchNone:`${zre}--touch-none`,touchPan:`${zre}--touch-pan`};let Y1e=class J1e{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new DWe(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Pe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(n8[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&n8[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(n8[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?tx.touchNone:tx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?tx.touchPan:tx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(tx.touchNone),this._element.classList.remove(tx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=R0e(this._element,e);return J1e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=j9e(r);i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:Vre&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}Vre?i*=.7:NWe||UWe?i*=.6:FWe&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};Y1e.test={disableSubpixelCoordinates:!1};const n8={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let VWe=class extends wo{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function Q1e(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function zWe(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function kWe(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:wh()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[O,C]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(O*O+C*C)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let r=0,i=0;for(let x=0;x<t.length;x++)r+=t[x].x,i+=t[x].y;r/=t.length,i/=t.length;const s=t.map(x=>x.x-r),n=t.map(x=>x.y-i);let o=0,a=0,l=0,c=0,h=0,d=0,f=0;for(let x=0;x<s.length;x++){const S=s[x],O=n[x],C=S*S,P=O*O;o+=C,a+=P,l+=S*O,c+=C*S,h+=P*O,d+=S*P,f+=O*C}const m=.5*(c+d),y=.5*(h+f),_=o*a-l*l,v=(m*a-y*l)/_,w=(o*y-l*m)/_,T=wh(v+r,w+i);return{radius:Math.sqrt(v*v+w*w+(o+a)/t.length),center:T}}function PA(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let BWe=class extends wo{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:GWe(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=$M(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=vL(s,K1e(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=$M(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=$M(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=vL(i,r)-e,i.lastAngle=vL(i,r)-e})}_emitEvent(e,r,i){const s=$M(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function K1e(t){const e=[];return t.forEach(r=>{e.push(wh(r.event.x,r.event.y))}),kWe(e)}function $M(t){const e=K1e(t);let r=0;return t.forEach(i=>{let s=vL(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function GWe(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function vL(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var kre;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(kre||(kre={}));const r_={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let jWe=class extends wo{constructor(e=r_.maximumDoubleClickDelay,r=r_.maximumDoubleClickDistance,i=r_.maximumDoubleTouchDelay,s=r_.maximumDoubleTouchDistance,n=dR){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Di(e.doubleClickTimer))}get hasPendingInputs(){return Lo(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=Di(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Q1e(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=PA(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=PA(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},HWe=class extends wo{constructor(e=r_.maximumDoubleClickDelay,r=r_.maximumDoubleClickDistance,i=r_.maximumDoubleTouchDelay,s=r_.maximumDoubleTouchDistance,n=dR){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=PA(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=PA(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Q1e(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=PA(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const HE={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let qWe=class extends wo{constructor(e=HE.maximumClickDelay,r=HE.movementUntilMouseDrag,i=HE.movementUntilPenDrag,s=HE.movementUntilTouchDrag,n=HE.holdDelay,o=dR){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Di(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):zWe(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},WWe=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},ZWe=class extends wo{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new WWe({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),h=Math.min(h,v);const d=i-s,f=n-o,m=a-l,y=c-h;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},ad=class extends xe{constructor(){super(...arguments),this._handles=new Mi}destroy(){this._handles=Pe(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Pe(this._inputManager)}connect(){const e=this.view;this._source=new Y1e(this.view.surface,e.input);const r=[new HWe,new qWe,new jWe,new BWe(this.view.navigation),new ZWe],i=new Du({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new VWe],c_.INTERNAL),this._modeDragPan=new Fre(e,"primary"),this._modeDragRotate=new i8(e,"secondary",Kl.CENTER),this._modeDragZoom=new hWe(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new OWe(e),new nqe(e),new vWe(e),new bWe(e,s.pan),new wWe(e),new PWe(e,s.resetTilt),new RWe(e,s.resetHeading),new i8(e,"primary",Kl.EYE,[s.lookAround]),new i8(e,"secondary",Kl.CENTER,[s.lookAround]),new Fre(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new MWe(e)],c_.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ue(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},zr))}_updateMode(){var s;const e=this.mode,r=this.primaryDragAction,i=(s=N7.get(e))==null?void 0:s.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([p()],ad.prototype,"view",void 0),u([p({value:"pan"})],ad.prototype,"primaryDragAction",null),u([p({value:"default"})],ad.prototype,"mode",null),u([p({readOnly:!0})],ad.prototype,"updating",null),u([p()],ad.prototype,"latestPointerType",null),u([p()],ad.prototype,"latestPointerLocation",null),u([p()],ad.prototype,"multiTouchActive",null),u([p()],ad.prototype,"_inputManager",void 0),ad=u([R("esri.views.3d.input.SceneInputManager")],ad);const N7=new Map,o8=new Map,a8=new Map;o8.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),o8.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),a8.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),a8.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),N7.set("default",o8),N7.set("pro",a8);const XWe=ad;let bs=class extends xe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([p()],bs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([p()],bs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([p()],bs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([p()],bs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([p()],bs.prototype,"LABELS_SHOW_BORDER",void 0),u([p()],bs.prototype,"TEXT_SHOW_BASELINE",void 0),u([p()],bs.prototype,"TEXT_SHOW_BORDER",void 0),u([p()],bs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([p()],bs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([p()],bs.prototype,"SHOW_POI",void 0),u([p()],bs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([p()],bs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([p()],bs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([p()],bs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([p()],bs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([p()],bs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([p()],bs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([p()],bs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([p()],bs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([p()],bs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([p()],bs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([p()],bs.prototype,"LINE_WIREFRAMES",void 0),bs=u([R("esri.views.3d.support.DebugFlags")],bs);const oi=new bs;let jc,S2,F7=!1,U7=!1,V7=!1,z7=!1,MA=null;function YWe(t,e){if(!U7||!S2)return;ebe();const r=S2;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),tbe(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function JWe(t){V7=oi.DECONFLICTOR_SHOW_VISIBLE,z7=oi.DECONFLICTOR_SHOW_INVISIBLE,F7=V7||z7,U7=oi.DECONFLICTOR_SHOW_GRID,MA=null,F7||U7?MA=()=>QWe(t):jc&&(jc.parentElement.removeChild(jc),jc=null)}function ebe(){MA&&(MA(),MA=null)}function QWe(t){jc==null&&(jc=document.createElement("canvas"),jc.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(jc));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;jc.setAttribute("width",`${o}px`),jc.setAttribute("height",`${a}px`),jc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),S2=jc.getContext("2d"),S2.clearRect(0,0,s,n),S2.font="12px Arial"}function tbe(t,e,r,i,s){ebe();const n=jc.height,o=S2;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function KWe(t,e){F7&&(e&&V7||!e&&z7)&&tbe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Fo,Bn;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Fo||(Fo={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Bn||(Bn={}));function rbe(t,e){return new obe(t,lbe,e)}function eZe(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=lbe;return new obe(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:l8.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:l8.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:l8.minPixelSize},e)}function tZe(t){return Math.abs(t*t*t)}function ibe(t,e,r){const i=r.parameters,s=r.paddingPixelsOverride;return qE.scale=Math.min(i.divisor/(e-i.offset),1),qE.factor=tZe(t),qE.minPixelSize=i.minPixelSize,qE.paddingPixels=s,qE}function sbe(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function iX(t,e){return Math.max(xt(t*e.scale,t,e.factor),sbe(t,e))}function rZe(t,e,r){const i=ibe(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,iX(1,i)}function Bre(t,e,r,i){i.scale=rZe(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function nbe(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,sbe(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function iZe(t,e,r,i){return iX(t,ibe(e,r,i))}let obe=class abe{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,s=sZe(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===Le.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new abe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),h=this._coverageCompensation(e,r,c),{tiltAngle:d,scaleFallOffFactor:f}=c,m=Math.sin(d)*l,y=.5*Math.PI-d-a*(.5-s*h),_=m/Math.cos(y),v=y+a*n*h,w=(_-f*(m/Math.cos(v)))/(1-f);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=w,i.divisor=_-w,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=Gre){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=Gre){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=_e((o-a)/(l-a),0,1),[h,d]=[s.min,s.max];return i.tiltAngle=xt(h.tiltAngle,d.tiltAngle,c),i.scaleFallOffFactor=xt(h.scaleFallOffFactor,d.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const lbe={curvatureDependent:{min:{curvature:Ut(10),tiltAngle:Ut(12),scaleFallOffFactor:.5},max:{curvature:Ut(70),tiltAngle:Ut(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},l8={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function sZe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const qE={scale:0,factor:0,minPixelSize:0,paddingPixels:0},Gre={tiltAngle:0,scaleFallOffFactor:0};function nZe(t){return t instanceof Float32Array&&t.length>=16}function oZe(t){return Array.isArray(t)&&t.length>=16}function aZe(t){return nZe(t)||oZe(t)}function sX(t){t.vertex.code.add(b`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(b`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(b`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(b`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(b`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(b`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(b`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function lZe(t){t.uniforms.add(new ir("screenSizePerspective",e=>cbe(e.screenSizePerspective)))}function EF(t){t.uniforms.add(new ir("screenSizePerspectiveAlignment",e=>cbe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function cbe(t){return wi(cZe,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const cZe=Yt();var $i,th,IA,ss,en;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})($i||($i={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(th||(th={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(IA||(IA={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(ss||(ss={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(en||(en={}));let uZe=class{constructor(e,r){this.vec3=e,this.id=r}};function qN(t,e,r,i){return new uZe(Ae(t,e,r),i)}var $a;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})($a||($a={}));const nX=1.3;let jre=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=kt(),this.resolution=0,this.renderLocalOrigin=qN(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new hZe,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===$a.ColorAndWater?this.renderTargets.getTarget(ss.Color):e===$a.Highlight?this.renderTargets.getTarget(ss.Highlight):e===$a.ObjectAndLayerIdColor?this.renderTargets.getTarget(ss.ObjectAndLayerIdColor):this.renderTargets.getTarget(ss.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(ss.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(ss.Color):null}getNormalTexture(e){const r=e===$a.ColorAndWater?this.renderTargets.getTarget(ss.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==ss.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?dS.CHANGED:dS.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[ss.Color]|+e[ss.ColorNoRasterImage]<<1|+e[ss.Highlight]<<2|+e[ss.Water]<<3|+e[ss.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];jD(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];jD(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Ig(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===$i.INNER?0:this.resolution,0,this.resolution,this.resolution)}},hZe=class{constructor(){this.extents=[kt(),kt(),kt()],this.numViews=0}},ube=class extends cs{constructor(e,r){super(e,"mat4",Qr.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function ap(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Ba):t.uniforms.add(new nu("cameraPosition",(r,i)=>se(hbe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function gc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Ni("proj",(i,s)=>s.camera.projectionMatrix),new ube("view",(i,s)=>Cl(Hre,s.camera.viewMatrix,i.origin)),new nu("localOrigin",i=>i.origin));const r=i=>se(hbe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Ni("proj",(i,s)=>s.camera.projectionMatrix),new Ni("view",(i,s)=>Cl(Hre,s.camera.viewMatrix,r(s))),new zt("localOrigin",(i,s)=>r(s)))}const Hre=ve(),hbe=A();function vS(t){t.uniforms.add(new Ni("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function uE(t,e){t.uniforms.add(new Oe("pixelRatio",(r,i)=>i.camera.pixelRatio/(e.draped?nX:1)))}function dbe(t,e){const r=t.vertex;e.hasVerticalOffset?(pbe(r),e.hasScreenSizePerspective&&(t.include(sX),EF(r),ap(t.vertex,e)),r.code.add(b`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?b`vec3 worldNormal = normalize(worldPos + localOrigin);`:b`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?b`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(b`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const dZe=Yt();function pbe(t){t.uniforms.add(new ir("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return wi(dZe,n*a,o,i,s)}))}function CF(t){t.uniforms.add(new Rf("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(b`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(b`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var Yl;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Yl||(Yl={}));var _l;function fbe(t,e){t.include(sX),t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.NORMAL,"vec3"),t.attributes.add(E.AUXPOS1,"vec4");const r=t.vertex;gc(r,e),ap(r,e),r.uniforms.add(new ir("viewport",(i,s)=>s.camera.fullViewport),new Oe("polygonOffset",i=>i.shaderPolygonOffset),new Oe("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new Oe("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===Yl.Occluded?1:s.renderTransparentlyOccludedHUD===Yl.NotOccluded?0:.75),new Je("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)),e.hasVerticalOffset&&pbe(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(b`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(b`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.draped&&!e.hasVerticalOffset||vS(r),e.draped||(r.uniforms.add(new Oe("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(b`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===_l.Screen&&uE(r,e),e.hasScreenSizePerspective&&EF(r),r.code.add(b`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===_l.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?b`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==_l.Screen?b`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===_l.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===_l.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(CF),r.code.add(b`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(_l||(_l={}));const LM=ln();function mbe(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){tt(t.type===as.Mesh);const o=e.tolerance;gbe(t.boundingInfo,r,i,o,s,n)}else{const o=t.indices.get(E.POSITION),a=t.vertexAttributes.get(E.POSITION);zR(r,i,0,o.length/3,o,a,void 0,s,n)}}const pZe=A();function gbe(t,e,r,i,s,n){if(t==null)return;const o=_be(e,r,pZe);if(Ome(LM,t.bbMin),Rme(LM,t.bbMax),s!=null&&s.applyToAabb(LM),aX(LM,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>yZe){const d=t.getChildren();if(d!==void 0){for(const f of d)gbe(f,e,r,i,s,n);return}}zR(e,r,0,h,l,c,a,s,n)}}const ybe=A();function zR(t,e,r,i,s,n,o,a,l){if(o)return fZe(t,e,r,i,s,n,o,a,l);const{data:c,stride:h}=n,d=t[0],f=t[1],m=t[2],y=e[0]-d,_=e[1]-f,v=e[2]-m;for(let w=r,T=3*r;w<i;++w){let x=h*s[T++],S=c[x++],O=c[x++],C=c[x];x=h*s[T++];let P=c[x++],$=c[x++],V=c[x];x=h*s[T++];let z=c[x++],B=c[x++],k=c[x];a!=null&&([S,O,C]=a.applyToVertex(S,O,C,w),[P,$,V]=a.applyToVertex(P,$,V,w),[z,B,k]=a.applyToVertex(z,B,k,w));const Z=P-S,W=$-O,j=V-C,Y=z-S,M=B-O,D=k-C,N=_*D-M*v,G=v*Y-D*y,X=y*M-Y*_,J=Z*N+W*G+j*X;if(Math.abs(J)<=Number.EPSILON)continue;const ee=d-S,ye=f-O,Me=m-C,ft=ee*N+ye*G+Me*X;if(J>0){if(ft<0||ft>J)continue}else if(ft>0||ft<J)continue;const Rt=ye*j-W*Me,at=Me*Z-j*ee,vt=ee*W-Z*ye,ze=y*Rt+_*at+v*vt;if(J>0){if(ze<0||ft+ze>J)continue}else if(ze>0||ft+ze<J)continue;const fe=(Y*Rt+M*at+D*vt)/J;fe>=0&&l(fe,oX(Z,W,j,Y,M,D,ybe),w,!1)}}function fZe(t,e,r,i,s,n,o,a,l){const{data:c,stride:h}=n,d=t[0],f=t[1],m=t[2],y=e[0]-d,_=e[1]-f,v=e[2]-m;for(let w=r;w<i;++w){const T=o[w];let x=3*T,S=h*s[x++],O=c[S++],C=c[S++],P=c[S];S=h*s[x++];let $=c[S++],V=c[S++],z=c[S];S=h*s[x];let B=c[S++],k=c[S++],Z=c[S];a!=null&&([O,C,P]=a.applyToVertex(O,C,P,w),[$,V,z]=a.applyToVertex($,V,z,w),[B,k,Z]=a.applyToVertex(B,k,Z,w));const W=$-O,j=V-C,Y=z-P,M=B-O,D=k-C,N=Z-P,G=_*N-D*v,X=v*M-N*y,J=y*D-M*_,ee=W*G+j*X+Y*J;if(Math.abs(ee)<=Number.EPSILON)continue;const ye=d-O,Me=f-C,ft=m-P,Rt=ye*G+Me*X+ft*J;if(ee>0){if(Rt<0||Rt>ee)continue}else if(Rt>0||Rt<ee)continue;const at=Me*Y-j*ft,vt=ft*W-Y*ye,ze=ye*j-W*Me,fe=y*at+_*vt+v*ze;if(ee>0){if(fe<0||Rt+fe>ee)continue}else if(fe>0||Rt+fe<ee)continue;const Tt=(M*at+D*vt+N*ze)/ee;Tt>=0&&l(Tt,oX(W,j,Y,M,D,N,ybe),T,!1)}}const qre=A(),Wre=A();function oX(t,e,r,i,s,n,o){return se(qre,t,e,r),se(Wre,i,s,n),ot(o,qre,Wre),ge(o,o),o}function _be(t,e,r){return se(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function aX(t,e,r,i){return lX(t,e,r,i,1/0)}function lX(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],h=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const d=(t[2]-i-e[2])*r[2],f=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(d,f)),!(l<0)&&(a=Math.max(a,Math.min(d,f)),!(a>l)&&a<s)}function vbe(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;s!=null&&(n=iZe(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return _e(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function bbe(t,e){const r=e?bbe(e):{};for(const i in t){let s=t[i];s&&s.forEach&&(s=gZe(s)),s==null&&i in r||(r[i]=s)}return r}function mZe(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):DH(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function gZe(t){const e=[];return t.forEach(r=>e.push(r)),e}const wbe={multiply:1,ignore:2,replace:3,tint:4},yZe=1e3;let H_=class extends DR{constructor(e,r){super(),this.type=as.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=br,this._pp0=Ae(0,0,1),this._pp1=Ae(0,0,0),this._parameters=bbe(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){mZe(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},xbe=class extends U7e{constructor(e,r,i){super(r,i),this.camera=e}};var Li;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Li||(Li={}));let cX=class extends ei{constructor(){super(...arguments),this.renderOccluded=Li.Occlude}},Tbe=class{constructor(){this.factor=new Zre,this.factorAlignment=new Zre}},Zre=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function tRt(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<s;h++)n[i]=c,i+=o}}function Xre(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length;i*=n;for(let a=0;a<o;++a){const l=2*t[a];s[i]=e[l],s[i+1]=e[l+1],i+=n}}function Sbe(t,e,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}}function bS(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}}function Yre(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function uX(t,e,r,i,s,n=1){if(!r)return void Sbe(t,e,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],h=r[1],d=r[2],f=r[4],m=r[5],y=r[6],_=r[8],v=r[9],w=r[10],T=r[12],x=r[13],S=r[14];s*=a;let O=0,C=0,P=0;const $=D5(r)?V=>{O=e[V]+T,C=e[V+1]+x,P=e[V+2]+S}:V=>{const z=e[V],B=e[V+1],k=e[V+2];O=c*z+f*B+_*k+T,C=h*z+m*B+v*k+x,P=d*z+y*B+w*k+S};if(n===1)for(let V=0;V<l;++V)$(3*t[V]),o[s]=O,o[s+1]=C,o[s+2]=P,s+=a;else for(let V=0;V<l;++V){$(3*t[V]);for(let z=0;z<n;++z)o[s]=O,o[s+1]=C,o[s+2]=P,s+=a}}function hX(t,e,r,i,s,n=1){if(!r)return void Sbe(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],d=o[1],f=o[2],m=o[4],y=o[5],_=o[6],v=o[8],w=o[9],T=o[10],x=!xW(o),S=1e-6,O=1-S;s*=l;let C=0,P=0,$=0;const V=D5(o)?z=>{C=e[z],P=e[z+1],$=e[z+2]}:z=>{const B=e[z],k=e[z+1],Z=e[z+2];C=h*B+m*k+v*Z,P=d*B+y*k+w*Z,$=f*B+_*k+T*Z};if(n===1)if(x)for(let z=0;z<c;++z){V(3*t[z]);const B=C*C+P*P+$*$;if(B<O&&B>S){const k=1/Math.sqrt(B);a[s]=C*k,a[s+1]=P*k,a[s+2]=$*k}else a[s]=C,a[s+1]=P,a[s+2]=$;s+=l}else for(let z=0;z<c;++z)V(3*t[z]),a[s]=C,a[s+1]=P,a[s+2]=$,s+=l;else for(let z=0;z<c;++z){if(V(3*t[z]),x){const B=C*C+P*P+$*$;if(B<O&&B>S){const k=1/Math.sqrt(B);C*=k,P*=k,$*=k}}for(let B=0;B<n;++B)a[s]=C,a[s+1]=P,a[s+2]=$,s+=l}}function _Ze(t,e,r,i,s,n=1){if(!r)return void bS(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],d=o[1],f=o[2],m=o[4],y=o[5],_=o[6],v=o[8],w=o[9],T=o[10],x=!xW(o),S=1e-6,O=1-S;if(s*=l,n===1)for(let C=0;C<c;++C){const P=4*t[C],$=e[P],V=e[P+1],z=e[P+2],B=e[P+3];let k=h*$+m*V+v*z,Z=d*$+y*V+w*z,W=f*$+_*V+T*z;if(x){const j=k*k+Z*Z+W*W;if(j<O&&j>S){const Y=1/Math.sqrt(j);k*=Y,Z*=Y,W*=Y}}a[s]=k,a[s+1]=Z,a[s+2]=W,a[s+3]=B,s+=l}else for(let C=0;C<c;++C){const P=4*t[C],$=e[P],V=e[P+1],z=e[P+2],B=e[P+3];let k=h*$+m*V+v*z,Z=d*$+y*V+w*z,W=f*$+_*V+T*z;if(x){const j=k*k+Z*Z+W*W;if(j<O&&j>S){const Y=1/Math.sqrt(j);k*=Y,Z*=Y,W*=Y}}for(let j=0;j<n;++j)a[s]=k,a[s+1]=Z,a[s+2]=W,a[s+3]=B,s+=l}}function Ebe(t,e,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(s*=a,r!==e.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let d=0;d<n;++d)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let d=0;d<n;++d)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const h=4*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),h=a/4,d=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=d,s+=h}}function vZe(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length,a=e[0];i*=n;for(let l=0;l<o;++l)s[i]=a,i+=n}function Cbe(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function Abe(t,e,r,i,s,n){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)Obe(o,a,l,r,i,s,n);else if(o===E.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(E.POSITION);if(tt(!!c,`No buffer view for ${o}`),c){const h=c.length,d=s.getField(o,ca);Cbe(t.objectAndLayerIdColor,d,h,n)}}}}function Obe(t,e,r,i,s,n,o){switch(t){case E.POSITION:{tt(e.size===3);const a=n.getField(t,an);tt(!!a,`No buffer view for ${t}`),a&&uX(r,e.data,i,a,o);break}case E.NORMAL:{tt(e.size===3);const a=n.getField(t,an);tt(!!a,`No buffer view for ${t}`),a&&hX(r,e.data,s,a,o);break}case E.NORMALCOMPRESSED:{tt(e.size===2);const a=n.getField(t,LR);tt(!!a,`No buffer view for ${t}`),a&&Xre(r,e.data,a,o);break}case E.UV0:{tt(e.size===2);const a=n.getField(t,j_);tt(!!a,`No buffer view for ${t}`),a&&Xre(r,e.data,a,o);break}case E.COLOR:case E.SYMBOLCOLOR:{const a=n.getField(t,ca);tt(!!a,`No buffer view for ${t}`),tt(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||Ebe(r,e.data,e.size,a,o);break}case E.COLORFEATUREATTRIBUTE:{const a=n.getField(t,nF);tt(!!a,`No buffer view for ${t}`),tt(e.size===1),a&&e.size===1&&vZe(r,e.data,a,o);break}case E.TANGENT:{tt(e.size===4);const a=n.getField(t,op);tt(!!a,`No buffer view for ${t}`),a&&_Ze(r,e.data,s,a,o);break}case E.PROFILERIGHT:case E.PROFILEUP:case E.PROFILEVERTEXANDNORMAL:case E.FEATUREVALUE:{tt(e.size===4);const a=n.getField(t,op);tt(!!a,`No buffer view for ${t}`),a&&bS(r,e.data,a,o)}}}function zO(t,e,r=0){const i=_e(t,0,xZe);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*TZe(i*bZe[s]))}function dX(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*wZe[i];return r}const bZe=[1,256,65536,16777216],wZe=[1/256,1/65536,1/16777216,1/4294967296],xZe=dX(new Uint8ClampedArray([255,255,255,255]));function TZe(t){return t-Math.floor(t)}async function kg(t,e){const{data:r}=await Fr(t,{responseType:"image",...e});return r}function SZe(){if(c8==null){const t=e=>Br(`esri/libs/basisu/${e}`);c8=ae(()=>import("./basis_transcoder-a19e5b80.js"),[]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return c8}let c8;var W1;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(W1||(W1={}));let Yd=null,DM=null;async function Rbe(){return DM==null&&(DM=SZe(),Yd=await DM),DM}function EZe(t,e){if(Yd==null)return t.byteLength;const r=new Yd.BasisFile(new Uint8Array(t)),i=Mbe(r)?Pbe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function CZe(t,e){if(Yd==null)return t.byteLength;const r=new Yd.KTX2File(new Uint8Array(t)),i=Ibe(r)?Pbe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function Pbe(t,e,r,i,s){const n=nZ(e?ds.COMPRESSED_RGBA8_ETC2_EAC:ds.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function Mbe(t){return t.getNumImages()>=1&&!t.isUASTC()}function Ibe(t){return t.getFaces()>=1&&t.isETC1S()}async function AZe(t,e,r){Yd==null&&(Yd=await Rbe());const i=new Yd.BasisFile(new Uint8Array(r));if(!Mbe(i))return null;i.startTranscoding();const s=$be(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function OZe(t,e,r){Yd==null&&(Yd=await Rbe());const i=new Yd.KTX2File(new Uint8Array(r));if(!Ibe(i))return null;i.startTranscoding();const s=$be(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function $be(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,d]=l?i?[W1.ETC2_RGBA,ds.COMPRESSED_RGBA8_ETC2_EAC]:[W1.ETC1_RGB,ds.COMPRESSED_RGB8_ETC2]:c?i?[W1.BC3_RGBA,ds.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[W1.BC1_RGB,ds.COMPRESSED_RGB_S3TC_DXT1_EXT]:[W1.RGBA32,St.RGBA],f=e.hasMipmap?r:Math.min(1,r),m=[];for(let y=0;y<f;y++)m.push(new Uint8Array(o(y,h))),a(y,h,m[y]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,e.width=s,e.height=n,new Ct(t,e,{type:"compressed",levels:m})}const NM=Q.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),RZe=542327876,PZe=131072,MZe=4;function pX(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function IZe(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const $Ze=pX("DXT1"),LZe=pX("DXT3"),DZe=pX("DXT5"),NZe=31,FZe=0,UZe=1,VZe=2,zZe=3,kZe=4,BZe=7,GZe=20,jZe=21;function HZe(t,e,r){const i=qZe(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return e.samplingMode=s.levels.length>1?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Ct(t,e,s)}function qZe(t,e){const r=new Int32Array(t,0,NZe);if(r[FZe]!==RZe)return NM.error("Invalid magic number in DDS header"),null;if(!(r[GZe]&MZe))return NM.error("Unsupported format, must contain a FourCC code"),null;const i=r[jZe];let s,n;switch(i){case $Ze:s=8,n=ds.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case LZe:s=16,n=ds.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case DZe:s=16,n=ds.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return NM.error("Unsupported FourCC code:",IZe(i)),null}let o=1,a=r[kZe],l=r[zZe];!(3&a)&&!(3&l)||(NM.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let d,f;r[VZe]&PZe&&e!==!1&&(o=Math.max(1,r[BZe]));let m=r[UZe]+4;const y=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t,m,f),y.push(d),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}let Iw=class extends DR{constructor(e,r){super(),this._data=e,this.type=as.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Ls,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:Dt.REPEAT,t:Dt.REPEAT},this._startPreload(e)}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(f_(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){Xf(e.src)||f_(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}dispose(){this._data=void 0}_createDescriptor(e){const r=new vr;return r.wrapMode=this.parameters.wrap??Dt.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.gpuMemoryUsage)||WZe(this._data,this.parameters)}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Ct(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(CC(r)||G0(r))&&this.parameters.encoding===yg.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(CC(r)||G0(r))&&this.parameters.encoding===yg.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(CC(r)||G0(r))&&this.parameters.encoding===yg.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):G0(r)?this._loadFromPixelData(e,r):CC(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<$A.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,r){return this._glTexture=HZe(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>OZe(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>AZe(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){tt(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.parameters.components===1?St.LUMINANCE:this.parameters.components===3?St.RGB:St.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new Ct(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const s=await kg(r,{signal:i});return Qt(i),this._loadFromImage(e,s)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const s=await kde(r,r.src,!1,i);return Qt(i),this._loadFromImage(e,s)})}_loadFromVideoElement(e,r){return r.readyState>=$A.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),Di(c)},a=()=>{r.readyState>=$A.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,r)))},l=h=>{o(),n(h||new U("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=oa(i,()=>l(Dr()))}))}_loadFromImage(e,r){const i=Lbe(r);this.parameters.width=i.width,this.parameters.height=i.height;const s=this._createDescriptor(e);return s.pixelFormat=this.parameters.components===3?St.RGB:St.RGBA,s.width=i.width,s.height=i.height,this._glTexture=new Ct(e,s,r),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture=Fe(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function WZe(t,e){if(t==null)return 0;if(CC(t)||G0(t))return e.encoding===yg.KTX2_ENCODING?CZe(t,!!e.mipmap):e.encoding===yg.BASIS_ENCODING?EZe(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Lbe(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function Lbe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var $A;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})($A||($A={}));const kO=128,fX=.5;function ZZe(t,e=kO,r=e*fX,i=0){const s=Dbe(t,e,r,i);return new Iw(s,{mipmap:!1,wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function Dbe(t,e=kO,r=e*fX,i=0){switch(t){case"circle":default:return XZe(e,r);case"square":return YZe(e,r);case"cross":return QZe(e,r,i);case"x":return KZe(e,r,i);case"kite":return JZe(e,r);case"triangle":return eXe(e,r);case"arrow":return tXe(e,r)}}function XZe(t,e){const r=t/2-.5;return kR(t,Ube(r,r,e/2))}function YZe(t,e){return Nbe(t,e,!1)}function JZe(t,e){return Nbe(t,e,!0)}function QZe(t,e,r=0){return Fbe(t,e,!1,r)}function KZe(t,e,r=0){return Fbe(t,e,!0,r)}function eXe(t,e){return kR(t,Vbe(t/2,e,e/2))}function tXe(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=Ube(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=Vbe(s,r,i);return kR(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function Nbe(t,e,r){return r&&(e/=Math.SQRT2),kR(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function Fbe(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return kR(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function Ube(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function Vbe(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function kR(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,zO(o,r,4*n)}return r}let iRt=class extends ei{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function rXe(t,e){zbe(t,e,new zt("slicePlaneOrigin",(r,i)=>jbe(e,r,i)),new zt("slicePlaneBasis1",(r,i)=>{var s;return WN(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new zt("slicePlaneBasis2",(r,i)=>{var s;return WN(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function ms(t,e){zbe(t,e,new nu("slicePlaneOrigin",(r,i)=>jbe(e,r,i)),new nu("slicePlaneBasis1",(r,i)=>{var s;return WN(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new nu("slicePlaneBasis2",(r,i)=>{var s;return WN(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function zbe(t,e,...r){if(!e.hasSlicePlane){const o=b`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=b`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=b`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?b`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:b`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function kbe(t,e,r){return t.instancedDoublePrecision?se(iXe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function Bbe(t,e){return t!=null?he(ZN,e.origin,t):e.origin}function Gbe(t,e,r){return t.hasSliceTranslatedView?e!=null?Cl(sXe,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function jbe(t,e,r){if(r.slicePlane==null)return Ba;const i=kbe(t,e,r),s=Bbe(i,r.slicePlane),n=Gbe(t,i,r);return n!=null?$e(ZN,s,n):s}function WN(t,e,r,i){if(i==null||r.slicePlane==null)return Ba;const s=kbe(t,e,r),n=Bbe(s,r.slicePlane),o=Gbe(t,s,r);return o!=null?(le(WE,i,n),$e(ZN,n,o),$e(WE,WE,o),he(WE,WE,ZN)):i}const iXe=A(),ZN=A(),WE=A(),sXe=ve();function BR(t,e){const r=e.output===L.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(E.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(E.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(b`
     void forwardObjectAndLayerIdColor() {
      ${r?i?b`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:b`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b``} }`),t.fragment.code.add(b`
      void outputObjectAndLayerIdColor() {
        ${r?b`fragColor = objectAndLayerIdColorVarying;`:b``} }`)}function nXe(t,e){const{vertex:r,fragment:i}=t;r.include(CF),e.hasMultipassGeometry&&r.include(G_e),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(b`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?b`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(fu),e.hasMultipassTerrain&&i.uniforms.add(new Je("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new Sr("nearFar",(s,n)=>n.camera.nearFar)),i.include(Tc),i.code.add(b`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?b`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const oXe=Ft(1,1,0,1),Hbe=Ft(1,0,1,1);function ty(t){t.fragment.uniforms.add(new Je("depthTexture",(e,r)=>r.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",oXe).add("unoccludedHighlightFlag","vec4",Hbe),t.fragment.code.add(b`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let qbe=class extends cs{constructor(e,r,i){super(e,"vec4",Qr.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},vl=class extends cs{constructor(e,r,i){super(e,"float",Qr.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}};const wS={unknown:1,inches:Po(1,"meters","inches"),feet:Po(1,"meters","feet"),"us-feet":Po(1,"meters","us-feet"),yards:Po(1,"meters","yards"),miles:Po(1,"meters","miles"),"nautical-miles":Po(1,"meters","nautical-miles"),millimeters:Po(1,"meters","millimeters"),centimeters:Po(1,"meters","centimeters"),decimeters:Po(1,"meters","decimeters"),meters:Po(1,"meters","meters"),kilometers:Po(1,"meters","kilometers"),"decimal-degrees":1/XMe(1,"meters",sr.radius)};var ta,Jre;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(ta||(ta={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Jre||(Jre={}));let mX=class{constructor(e){this.field=e}},aXe=class extends mX{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[ta.Undefined,ta.Undefined,ta.Undefined]}},lXe=class extends mX{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},cXe=class extends mX{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},uXe=class{};function ZE(t){return t!=null}function rx(t){return typeof t=="number"}function AF(t){return typeof t=="string"}function hXe(t){return t==null||AF(t)}function tn(t,e){t&&t.push(e)}function dXe(t,e,r,i=ve()){const s=t||0,n=e||0,o=r||0;return s!==0&&tS(i,i,-s/180*Math.PI),n!==0&&eS(i,i,n/180*Math.PI),o!==0&&$5(i,i,o/180*Math.PI),i}function Sy(t,e,r,i,s){const n=t.minSize,o=t.maxSize;if(t.expression)return tn(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=ta.DefinedSize,!0}if(ZE(t.field))return ZE(t.stops)?t.stops.length===2&&rx(t.stops[0].size)&&rx(t.stops[1].size)?(Qre(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=ta.DefinedSize,!0):(tn(s,"Could not convert size info: stops only supported with 2 elements"),!1):rx(n)&&rx(o)&&ZE(t.minDataValue)&&ZE(t.maxDataValue)?(Qre(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=ta.DefinedSize,!0):t.valueUnit==="unknown"?(tn(s,"Could not convert size info: proportional size not supported"),!1):wS[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/wS[t.valueUnit],e.type[r]=ta.DefinedSize,!0):(tn(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!ZE(t.field)){if(t.stops&&t.stops[0]&&rx(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=ta.DefinedSize,!0;if(rx(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=ta.DefinedSize,!0}return tn(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Qre(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function pXe(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return tn(i,"Could not convert size info: unsupported property"),null;if(!hXe(t.field))return tn(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return tn(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new aXe(t.field);let s;switch(t.axis){case"width":return s=Sy(t,e.size,0,r,i),s?e:null;case"height":return s=Sy(t,e.size,2,r,i),s?e:null;case"depth":return s=Sy(t,e.size,1,r,i),s?e:null;case"width-and-depth":return s=Sy(t,e.size,0,r,i),s&&Sy(t,e.size,1,r,i),s?e:null;case null:case void 0:case"all":return s=Sy(t,e.size,0,r,i),s=s&&Sy(t,e.size,1,r,i),s=s&&Sy(t,e.size,2,r,i),s?e:null;default:return tn(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function fXe(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===ta.DefinedSize&&(n*=e.modelSize[s],t.type[s]=ta.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==ta.Undefined)i=0;else if(t.type[1]!==ta.Undefined)i=1;else{if(t.type[2]===ta.Undefined)return tn(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)t.type[s]===ta.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function Kre(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function mXe(t,e,r){if(t.normalizationField)return tn(r,"Could not convert color info: unsupported property"),null;if(AF(t.field)){if(!t.stops)return tn(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return tn(r,"Could not convert color info: too many color stops"),null;e.color=new lXe(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,Kre(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return tn(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,Kre(e.color.colors,s,i)}}return e}function gXe(t,e,r){if(t.normalizationField)return tn(r,"Could not convert opacity info: unsupported property"),null;if(AF(t.field)){if(!t.stops)return tn(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return tn(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new cXe(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return tn(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function u8(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function yXe(t,e,r){if(!AF(t.field))return tn(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return tn(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return u8(t,e.rotation,0),e;case"roll":return u8(t,e.rotation,1),e;case null:case void 0:case"heading":return u8(t,e.rotation,2),e;default:return tn(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let GR=class{constructor(e,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function Wbe(t,e,r){if(!t)return null;const i=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return tn(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?pXe(n,s,e,r):s;case"color":return e.supports.color?mXe(n,s,r):s;case"opacity":return e.supports.opacity?gXe(n,s,r):null;case"rotation":return e.supports.rotation?yXe(n,s,r):s;default:return null}},new uXe);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!fXe(i.size,e,r)?null:i:null}let _Xe=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function xS(t,e){if(!t||oi.TESTS_DISABLE_FAST_UPDATES)return null;const r=Wbe(t.visualVariables,e);return r?new _Xe(r,Xbe(r,e),!!r.size):null}function TS(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,s=Wbe(e.visualVariables,r);return!!s&&!!(FM(i.size,s.size,"size")&&FM(i.color,s.color,"color")&&FM(i.rotation,s.rotation,"rotation")&&FM(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=Xbe(s,r),t.requiresShaderTransformation=!!s.size,!0)}function FM(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}let Zbe=class extends ei{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function Xbe(t,e){const r=new Zbe(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,Th(LA),dXe(e.rotation[2],e.rotation[0],e.rotation[1],LA),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||Fi(),Eh(r.vvSymbolRotationMatrix,LA)),r}function k7(t,e,r){if(!t.vvSize)return r;$s(Ey,r);const i=t.vvSymbolRotationMatrix;Kf(LA,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),ni(Ey,Ey,LA);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];eie[s]=_e(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return I5(Ey,Ey,eie),Cl(Ey,Ey,t.vvSymbolAnchor),Ey}function vXe(t,e,r){if(e.vvSize)for(let i=0;i<3;++i){const s=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=_e(s,e.vvSize.minSize[i],e.vvSize.maxSize[i])}else se(t,1,1,1)}function Jd(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const Ey=ve(),eie=A(),LA=ve();let jR=class extends Zbe{constructor(){super(...arguments),this.renderOccluded=Li.Occlude}};const E2=8;function vg(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(E.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new zt("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new zt("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new zt("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new zt("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new $h("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new zt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(b`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(b`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?b`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(b`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",E2),r.uniforms.add(new vl("vvColorValues",s=>s.vvColor.values,E2),new qbe("vvColorColors",s=>s.vvColor.colors,E2)),r.code.add(b`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?b`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(b`vec4 vvColor() { return vec4(1.0); }`)}const XN=.1,ho=.001;function bXe(t){const e=new wr,r=t.signedDistanceFieldEnabled;if(e.include(fbe,t),e.include(ms,t),t.occlusionPass)return e.include(nXe,t),e;const{vertex:i,fragment:s}=e;e.include(sX),s.include(Tc),s.include(rm),e.include(vg,t),e.include(BR,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add(new ir("viewport",(c,h)=>h.camera.fullViewport),new Sr("screenOffset",(c,h)=>nr(Ybe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Sr("anchorPosition",c=>YN(c)),new ir("materialColor",c=>c.color)),uE(i,t),r&&(i.uniforms.add(new ir("outlineColor",c=>c.outlineColor)),s.uniforms.add(new ir("outlineColor",c=>tie(c)?c.outlineColor:Cf),new Oe("outlineSize",c=>tie(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(lZe(i),EF(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.COLOR,"vec4"),e.attributes.add(E.SIZE,"vec2"),e.attributes.add(E.AUXPOS2,"vec4"),i.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?b`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=b`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&i.include(CF);const o=t.pixelSnappingEnabled?r?b`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b`posProj += quadOffset;`;i.code.add(b`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===L.ObjectAndLayerIdColor?b`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.float(ho)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.float(ho)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?b`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Je("tex",c=>c.texture));const a=t.debugDrawLabelBorder?b`(isBorder > 0.0 ? 0.0 : ${b.float(XN)})`:b.float(XN),l=b`
    ${t.debugDrawLabelBorder?b`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?b`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${b.float(kO)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.float(ho)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?b`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===L.Alpha&&s.code.add(b`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===L.ObjectAndLayerIdColor&&s.code.add(b`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===L.Color&&s.code.add(b`
    void main() {
      ${l}
      ${t.transparencyPassType===st.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===L.Highlight&&(e.include(ty,t),s.code.add(b`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?b`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function tie(t){return t.outlineColor[3]>0&&t.outlineSize>0}function YN(t,e=Ybe){return t.textureIsSignedDistanceField?wXe(t.anchorPosition,t.distanceFieldBoundingBox,e):cn(e,t.anchorPosition),e}function wXe(t,e,r){e!=null?nr(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):nr(r,0,0)}const Ybe=Ue(),xXe=Object.freeze(Object.defineProperty({__proto__:null,build:bXe,calculateAnchorPosForRendering:YN},Symbol.toStringTag,{value:"Module"})),ou=bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),TXe=wc(be.ONE,be.ONE),Jbe=wc(be.ZERO,be.ONE_MINUS_SRC_ALPHA);function ry(t){return t===st.FrontFace?null:t===st.Alpha?Jbe:TXe}function OF(t){return t===st.FrontFace?Al:null}const RF=5e5,PF={factor:-1,units:-2};function MF(t){return t?PF:null}function q_(t,e=Kr.LESS){return t===st.NONE||t===st.FrontFace?e:Kr.LEQUAL}let Qbe=class Kbe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Le.Global}initializeProgram(e){return new Cr(e.rctx,Kbe.shader.get().build(this.configuration),br)}_setPipelineState(e){const r=this.configuration,i=e===st.NONE,s=e===st.FrontFace,n=this.configuration.hasPolygonOffset?SXe:null,o=(i||s)&&r.output!==L.Highlight&&(r.depthEnabled||r.occlusionPass)?Al:null;return Ot({blending:r.output===L.Color||r.output===L.Alpha||r.output===L.Highlight?i?EXe:ry(e):null,depthTest:{func:Kr.LEQUAL},depthWrite:o,colorWrite:jt,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Et.POINTS:Et.TRIANGLES}};Qbe.shader=new Er(xXe,()=>ae(()=>import("./HUDMaterial.glsl-eb156beb.js"),[]));const SXe={factor:0,units:-4},EXe=wc(be.ONE,be.ONE_MINUS_SRC_ALPHA);let ws=class extends No{constructor(){super(...arguments),this.output=L.Color,this.screenCenterOffsetUnitsEnabled=_l.World,this.transparencyPassType=st.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([F({count:L.COUNT})],ws.prototype,"output",void 0),u([F({count:_l.COUNT})],ws.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([F({count:st.COUNT})],ws.prototype,"transparencyPassType",void 0),u([F()],ws.prototype,"spherical",void 0),u([F()],ws.prototype,"occlusionTestEnabled",void 0),u([F()],ws.prototype,"signedDistanceFieldEnabled",void 0),u([F()],ws.prototype,"vvSize",void 0),u([F()],ws.prototype,"vvColor",void 0),u([F()],ws.prototype,"hasVerticalOffset",void 0),u([F()],ws.prototype,"hasScreenSizePerspective",void 0),u([F()],ws.prototype,"debugDrawLabelBorder",void 0),u([F()],ws.prototype,"binaryHighlightOcclusionEnabled",void 0),u([F()],ws.prototype,"hasSlicePlane",void 0),u([F()],ws.prototype,"hasPolygonOffset",void 0),u([F()],ws.prototype,"depthEnabled",void 0),u([F()],ws.prototype,"pixelSnappingEnabled",void 0),u([F()],ws.prototype,"draped",void 0),u([F()],ws.prototype,"hasMultipassGeometry",void 0),u([F()],ws.prototype,"hasMultipassTerrain",void 0),u([F()],ws.prototype,"cullAboveGround",void 0),u([F()],ws.prototype,"occlusionPass",void 0),u([F()],ws.prototype,"objectAndLayerIdColorInstanced",void 0),u([F({constValue:!0})],ws.prototype,"hasSliceInVertexProgram",void 0),u([F({constValue:!1})],ws.prototype,"hasVvInstancing",void 0);let SS=class extends H_{constructor(e){super(e,new DXe),this._configuration=new ws}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?_l.Screen:_l.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===ce.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===L.Color||e===L.Alpha),e===L.Color&&(this._configuration.debugDrawLabelBorder=!!oi.LABELS_SHOW_BORDER),e===L.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Eh(d8,r),e.shaderTransformer!=null){const T=e.shaderTransformer(sie);l=T[0],c=T[5],OXe(d8)}const h=e.vertexAttributes.get(E.POSITION),d=e.vertexAttributes.get(E.SIZE),f=e.vertexAttributes.get(E.NORMAL),m=e.vertexAttributes.get(E.AUXPOS1);tt(h.size>=3);const y=i.point,_=i.camera,v=YN(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<h.data.length/h.size;T++){const x=T*h.size;se(qo,h.data[x],h.data[x+1],h.data[x+2]),$e(qo,qo,r);const S=T*d.size;Cy[0]=d.data[S]*l,Cy[1]=d.data[S+1]*c,$e(qo,qo,_.viewMatrix);const O=T*m.size;if(se(Ac,m.data[O],m.data[O+1],m.data[O+2]),!w&&(qo[0]+=Ac[0],qo[1]+=Ac[1],Ac[2]!==0)){const P=Ac[2];ge(Ac,qo),he(qo,qo,ie(Ac,Ac,P))}const C=T*f.size;if(se(XE,f.data[C],f.data[C+1],f.data[C+2]),this._normalAndViewAngle(XE,d8,_,p8),this._applyVerticalOffsetTransformationView(qo,p8,_,h8),_.applyProjection(qo,ga),ga[0]>-1){ga[0]=Math.floor(ga[0]),ga[1]=Math.floor(ga[1]),w&&(Ac[0]||Ac[1])&&(ga[0]+=Ac[0],Ac[1]!==0&&(ga[1]+=iX(Ac[1],h8.factorAlignment)),_.unapplyProjection(ga,qo)),ga[0]+=this.parameters.screenOffset[0],ga[1]+=this.parameters.screenOffset[1],nbe(Cy,h8.factor,Cy);const P=IXe*_.pixelRatio;let $=0;if(a.textureIsSignedDistanceField&&($=a.outlineSize*_.pixelRatio/2),y&&rie(y,ga[0],ga[1],Cy,P,$,a,v)){const V=i.ray;if($e(iie,qo,xn(MXe,_.viewMatrix)),ga[0]=y[0],ga[1]=y[1],_.unprojectFromRenderScreen(ga,qo)){const z=A();re(z,V.direction);const B=1/Ee(z);ie(z,z,B),o(mi(V.origin,qo)*B,z,-1,!0,1,iie)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.vertexAttributes.get(E.POSITION),l=e.vertexAttributes.get(E.SIZE),c=this.parameters,h=YN(c);let d=1,f=1;if(e.shaderTransformer!=null){const y=e.shaderTransformer(sie);d=y[0],f=y[5]}d*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=$Xe*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],w=a.data[_+1],T=y*l.size;Cy[0]=l.data[T]*d,Cy[1]=l.data[T+1]*f;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),rie(s,v,w,Cy,m,x,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new FXe(this)}_normalAndViewAngle(e,r,i,s){return aZe(r)&&(r=Eh(PXe,r)),cc(s.normal,e,r),$e(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=me(ewe,LXe),s}_updateScaleInfo(e,r,i){const s=this.parameters;s.screenSizePerspective!=null?Bre(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),s.screenSizePerspectiveAlignment!=null?Bre(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,p8);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),n!=null&&re(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return re(n,e);const c=_e(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ie(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=Ee(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=ie(qo,r.normal,o*a);return le(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Ee(e);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Ee(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=vbe(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),ie(r.normal,r.normal,l),le(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&re(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(ge(XE,i),le(i,i,ie(XE,XE,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&re(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&re(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,r){if(r===L.Color||r===L.Alpha||r===L.Highlight||r===L.ObjectAndLayerIdColor){if(e===ce.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return e===(i?ce.LABEL_MATERIAL:ce.HUD_MATERIAL)||s&&e===ce.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new CXe(e)}calculateRelativeScreenBounds(e,r,i=kt()){return AXe(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},CXe=class extends aZ{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(Qbe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function AXe(t,e,r,i=RXe){return cn(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function OXe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+r*r+i*i),d=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=r*h,t[2]=i*h,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function rie(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,h=r-s-(a[1]>0?i[1]*a[1]:0),d=h+i[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=i[0]*f[0],h+=i[1]*f[1],c-=i[0]*(1-f[2]),d-=i[1]*(1-f[3]),l-=n,c+=n,h-=n,d+=n),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<d}const h8=new Tbe,RXe=Ue(),qo=A(),XE=A(),ga=Yt(),ewe=A(),iie=A(),d8=Fi(),PXe=Fi(),MXe=ve(),Ac=A(),p8={normal:ewe,cosAngle:0},sie=ve(),IXe=1,$Xe=2,Cy=[0,0],LXe=Ae(0,0,1);let DXe=class extends C_e{constructor(){super(...arguments),this.renderOccluded=Li.Occlude,this.color=Ft(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=ur(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Ft(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const twe=Hi().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4u8(E.COLOR).vec2f(E.SIZE).vec4f(E.AUXPOS1).vec4f(E.AUXPOS2),NXe=twe.clone().vec4u8(E.OBJECTANDLAYERIDCOLOR);let FXe=class{constructor(e){this._material=e,this.vertexBufferLayout=oe("enable-feature:objectAndLayerId-rendering")?NXe:twe}elementCount(e){return 6*e.indices.get(E.POSITION).length}write(e,r,i,s,n){uX(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,e,s.position,n,6),hX(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(E.UV0).data;let a,l,c,h;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],h=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let d=i.indices.get(E.POSITION).length,f=n;const m=s.uv0;for(let w=0;w<d;++w)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;Ebe(i.indices.get(E.COLOR),i.vertexAttributes.get(E.COLOR).data,4,s.color,n,6);const y=i.indices.get(E.SIZE),_=i.vertexAttributes.get(E.SIZE).data;d=y.length;const v=s.size;f=n;for(let w=0;w<d;++w){const T=_[2*y[w]],x=_[2*y[w]+1];for(let S=0;S<6;++S)v.set(f,0,T),v.set(f,1,x),f+=1}if(i.indices.get(E.AUXPOS1)&&i.vertexAttributes.get(E.AUXPOS1)?bS(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,s.auxpos1,n,6):Yre(s.auxpos1,n,6*d),i.indices.get(E.AUXPOS2)&&i.vertexAttributes.get(E.AUXPOS2)?bS(i.indices.get(E.AUXPOS2),i.vertexAttributes.get(E.AUXPOS2).data,s.auxpos2,n,6):Yre(s.auxpos2,n,6*d),i.objectAndLayerIdColor!=null&&i.indices.get(E.POSITION)){const w=i.indices.get(E.POSITION).length,T=s.getField(E.OBJECTANDLAYERIDCOLOR,ca);Cbe(i.objectAndLayerIdColor,T,w,n,6)}}};const wp=A(),ix=Yt(),YE=Yt(),f8=A(),UXe=ve(),VXe=_s(),m8=Gn(),zXe=A(),kXe=kt();class BXe{constructor(){this.aabr=kt(),this.distance=0,this.culled=!1,this.visible=!1}}class GXe{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var Xl;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Xl||(Xl={}));class rwe{constructor(){this.camera=new lt,this.slicePlane=qg(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Cw(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let t2=class extends xe{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new rwe,this._state=Xl.Idle,this._active=new Map,this._visible=new Map,this._iterators=new WXe,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Xl.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Xl.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Xl.Idle:this._startUpdate(),t.madeProgress();case Xl.Process:if(this._state=Xl.Process,!this._processActiveGraphics(t))return;case Xl.Sort:if(this._state=Xl.Sort,!this._sortVisibleGraphics(t))return;case Xl.Deconflict:if(this._state=Xl.Deconflict,!this._deconflictVisibleGraphics(t))return;default:YWe(this,this._visible),this._state=Xl.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof SS}_startUpdate(){JWe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new BXe,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),jXe(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=QS(UXe,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?VXe:null;let s=0;for(i!=null&&($e(i,Ba,this._runningViewState.camera.viewMatrix),i[3]=Nr(this.view.spatialReference).radius,s=Oye(i,Ba));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Bn.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),KWe(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=nie(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=nie(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=HXe(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(Bn.GRAPHIC,Fo.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);vc(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=YXe,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,wp)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;$e(wp,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(E.NORMAL).data,h=l.get(E.AUXPOS1).data;o.applyShaderOffsetsView(wp,c,s.transformation,h,i,r.scaleInfo,wp),wi(ix,wp[0],wp[1],wp[2],1),eu(YE,ix,i.projectionMatrix),ie(r.positionNDC,YE,1/YE[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,f8),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(f8[2]),r.distance=f8[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),wi(YE,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),eu(ix,YE,e),kb(ix,ix,1/ix[3]),se(r.positionView,wp[0],wp[1],wp[2])}_isCulledByHorizon(t,e,r){return re(m8.direction,t.positionView),se(m8.origin,0,0,0),!!B_(e,m8,zXe)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&VW(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(ZXe);nbe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=jD(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,kXe),xt(0,n.fullWidth,.5+.5*i[0]),xt(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Qc(a),rp(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}l_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,_R(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Gt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,Fo.DECONFLICTION,e),this.visibilityGroup===Bn.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function jXe(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,Fo.DECONFLICTION,!0)}function*nie(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*HXe(t,e,r){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,Fo.DECONFLICTION);const a=s.info&&s.info[r];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([p({constructOnly:!0})],t2.prototype,"view",void 0),u([p({type:Boolean,readOnly:!0})],t2.prototype,"updating",null),t2=u([R("esri.views.3d.layers.graphics.Deconflictor")],t2);class qXe{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class WXe{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Gt({allocator:s=>s||new qXe})}}const ZXe=Ue();class XXe{constructor(){this.positionView=A(),this.positionNDC=A(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new Tbe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const YXe=new XXe,JXe=2e3;let bL=class extends t2{constructor(e){super(e),this.visibilityGroup=Bn.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Bo.YIELD;const r=performance.now();if(e.state!==$r.IDLE&&r-this._lastDeconfliction<JXe)return Bo.YIELD;super.runTask(e),this.state===Xl.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([p({constructOnly:!0})],bL.prototype,"parent",void 0),bL=u([R("esri.views.3d.layers.graphics.LabelDeconflictor")],bL);let B7=class extends t2{constructor(){super(...arguments),this._handles=new Mi,this._contexts=new Map,this._viewState=new rwe,this.visibilityGroup=Bn.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ue(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),ue(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),ue(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},zr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(pt.GRAPHICS_DECONFLICTOR,this),this._labels=new bL({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&g8(e));r.setVisibilityFlag(Bn.GRAPHIC,Fo.DECONFLICTION,i)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&Gye(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Lo(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new GXe(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),g8(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=g8(e);i||QXe(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function g8(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function QXe(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(Bn.GRAPHIC,Fo.DECONFLICTION,!0))}B7=u([R("esri.views.3d.layers.graphics.GraphicsDeconflictor")],B7);function iwe(t){return 32+t.length}function swe(t){return 16}function nwe(t){if(!t)return 0;let e=lwe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=iwe(i);break;case"number":e+=swe();break;case"boolean":e+=4}}return e}function owe(t){if(!t)return 0;if(Array.isArray(t))return KXe(t);let e=lwe;for(const r in t)t.hasOwnProperty(r)&&(e+=awe(t[r]));return e}function KXe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=cwe;for(let i=0;i<e;i++)r+=awe(t[i]);return r}function awe(t){switch(typeof t){case"object":return owe(t);case"string":return iwe(t);case"number":return swe();case"boolean":return 4;default:return 8}}function TRt(t,e){return cwe+t.length*e}const lwe=32,cwe=32,gX=(t,e,r)=>[e,r],ES=(t,e,r)=>[e,r,t[2]],yX=(t,e,r)=>[e,r,t[2],t[3]];function SRt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function eYe({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function tYe({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function uwe({scale:t,translate:e},r){return r*t[0]+e[0]}function hwe({scale:t,translate:e},r){return e[1]-r*t[1]}function dwe(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=uwe(t,r[0][0]),a=hwe(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function pwe(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=dwe(t,e,r[s]);return i}function rYe(t,e,r,i){return dwe(t,r?i?yX:ES:i?ES:gX,e)}function iYe(t,e,r,i){return pwe(t,r?i?yX:ES:i?ES:gX,e)}function sYe(t,e,r,i){return pwe(t,r?i?yX:ES:i?ES:gX,e)}function ERt(t,e,r,i,s){return e.x=eYe(t,r.x),e.y=tYe(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function fwe(t,e,r,i,s){return r!=null&&(e.points=rYe(t,r.points,i,s)),e}function mwe(t,e,r,i,s){return r==null||(e.x=uwe(t,r.x),e.y=hwe(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function gwe(t,e,r,i,s){return r!=null&&(e.rings=sYe(t,r.rings,i,s)),e}function ywe(t,e,r,i,s){return r!=null&&(e.paths=iYe(t,r.paths,i,s)),e}var G7;let x3=G7=class extends de{constructor(t){super(t),this.name=null,this.code=null}clone(){return new G7({name:this.name,code:this.code})}};u([p({type:String,json:{write:!0}})],x3.prototype,"name",void 0),u([p({type:[String,Number],json:{write:!0}})],x3.prototype,"code",void 0),x3=G7=u([R("esri.layers.support.CodedValue")],x3);const nYe=new Rr({inherited:"inherited",codedValue:"coded-value",range:"range"});let T3=class extends de{constructor(e){super(e),this.name=null,this.type=null}};u([p({type:String,json:{write:!0}})],T3.prototype,"name",void 0),u([et(nYe)],T3.prototype,"type",void 0),T3=u([R("esri.layers.support.Domain")],T3);const IF=T3;var j7;let S3=j7=class extends IF{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new j7({codedValues:K(this.codedValues),name:this.name})}};u([p({type:[x3],json:{write:!0}})],S3.prototype,"codedValues",void 0),u([et({codedValue:"coded-value"})],S3.prototype,"type",void 0),S3=j7=u([R("esri.layers.support.CodedValueDomain")],S3);const _we=S3;var H7;let wL=H7=class extends IF{constructor(t){super(t),this.type="inherited"}clone(){return new H7}};u([et({inherited:"inherited"})],wL.prototype,"type",void 0),wL=H7=u([R("esri.layers.support.InheritedDomain")],wL);const vwe=wL;var q7;let hT=q7=class extends IF{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new q7({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([p({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],hT.prototype,"maxValue",void 0),u([p({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],hT.prototype,"minValue",void 0),u([et({range:"range"})],hT.prototype,"type",void 0),hT=q7=u([R("esri.layers.support.RangeDomain")],hT);const bwe=hT,wwe={key:"type",base:IF,typeMap:{range:bwe,"coded-value":_we,inherited:vwe}};function _X(t){if(!t||!t.type)return null;switch(t.type){case"range":return bwe.fromJSON(t);case"codedValue":return _we.fromJSON(t);case"inherited":return vwe.fromJSON(t)}return null}const oYe=new Rr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var W7;const aYe=new Rr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Sa=W7=class extends de{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?aYe.fromJSON(r.fieldValueType):null}clone(){return new W7({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([p({type:String,json:{write:!0}})],Sa.prototype,"alias",void 0),u([p({type:[String,Number],json:{write:{allowNull:!0}}})],Sa.prototype,"defaultValue",void 0),u([p()],Sa.prototype,"description",void 0),u([Se("description")],Sa.prototype,"readDescription",null),u([p({types:wwe,json:{read:{reader:_X},write:!0}})],Sa.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],Sa.prototype,"editable",void 0),u([p({type:Ji,json:{write:!0}})],Sa.prototype,"length",void 0),u([p({type:String,json:{write:!0}})],Sa.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0}})],Sa.prototype,"nullable",void 0),u([et(oYe)],Sa.prototype,"type",void 0),u([p()],Sa.prototype,"valueType",void 0),u([Se("valueType",["description"])],Sa.prototype,"readValueType",null),u([p({type:Boolean,json:{read:!1}})],Sa.prototype,"visible",void 0),Sa=W7=u([R("esri.layers.support.Field")],Sa);const $F=Sa;let ARt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function RRt(t){return t.geometry!=null}let PRt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function IRt(t){var n;const e=Xpe.fromJSON(t.geometryType),r=Ge.fromJSON(t.spatialReference),i=t.transform,s=t.features.map(o=>{const a=lYe(o,e,r,t.objectIdFieldName),l=a.geometry;if(l!=null&&i)switch(l.type){case"point":a.geometry=mwe(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=fwe(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=gwe(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=ywe(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:s,spatialReference:r,fields:((n=t.fields)==null?void 0:n.map(o=>$F.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function lYe(t,e,r,i){return{uid:pc(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:cYe(t.geometry,e,r),visible:!0}}function cYe(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function $w(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function uYe(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=j0(t.vertexAttributes.position),e+=j0(t.vertexAttributes.normal),e+=j0(t.vertexAttributes.uv),e+=j0(t.vertexAttributes.tangent)}return e}function $Rt(t){let e=32;return e+=nwe(t.attributes),e+=3,e+=8+uYe(t.geometry),e}function hYe(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function LRt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function DRt(t,e){switch(Ti(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)Y6(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)Y6(e,t.rings[r],!!t.hasZ);break;case"multipoint":Y6(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function dYe(t,e){switch(vc(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)U6(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)U6(e,t.rings[r]);break;case"multipoint":U6(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function NRt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function xwe(t){return"declaredClass"in t}function oie(t){return"declaredClass"in t}function pYe(t){return"declaredClass"in t}function fYe(t,e){return t?pYe(t)?t:new hu({layer:e,sourceLayer:e,visible:t.visible,symbol:K(t.symbol),attributes:K(t.attributes),geometry:Twe(t.geometry)}):null}function Twe(t){return t==null?null:xwe(t)?t:g_(mYe(t))}function mYe(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,s={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:aie(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:aie(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:d,mmax:f,hasZ:m,hasM:y}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:d,mmax:f,hasZ:m,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:Ewe(n)?Swe(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function aie(t){return gYe(t)?t.map(e=>Swe(e)):t}function Swe(t){return t.map(e=>Array.from(e))}function gYe(t){for(const e of t)if(e.length!==0)return Ewe(e);return!1}function Ewe(t){return t.length>0&&(NS(t[0])||FS(t[0]))}function yYe(t,e){if(!t)return null;let r;if(oie(t)){if(e==null)return t.clone();if(oie(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=$w(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function FRt(t){const{wkid:e,wkt:r,latestWkid:i}=t,s={wkid:e,wkt:r,latestWkid:i};return Ge.fromJSON(s)}const vX="__begin__",bX="__end__",_Ye=new RegExp(vX,"ig"),vYe=new RegExp(bX,"ig"),lie=new RegExp("^"+vX,"i"),cie=new RegExp(bX+"$","i"),JN='"',bYe=JN+" + ",wYe=" + "+JN;function xYe(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function TYe(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function LF(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=xYe(t.labelExpression),e.type="conventional"),e}function SYe(t){const e=LF(t);if(!e)return null;switch(e.type){case"conventional":return Z7(e.expression);case"arcade":return e.expression}return null}function EYe(t){const e=LF(t);if(!e)return null;switch(e.type){case"conventional":return AYe(e.expression);case"arcade":return wX(e.expression)}return null}function Z7(t){let e;return t?(e=X4(t,r=>vX+'$feature["'+r+'"]'+bX),e=lie.test(e)?e.replace(lie,""):JN+e,e=cie.test(e)?e.replace(cie,""):e+JN,e=e.replaceAll(_Ye,bYe).replaceAll(vYe,wYe)):e='""',e}const CYe=/^\s*\{([^}]+)\}\s*$/i;function AYe(t){const e=t==null?void 0:t.match(CYe);return e&&e[1].trim()||null}const OYe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,RYe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,PYe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function wX(t){if(!t)return null;let e=OYe.exec(t)||RYe.exec(t);return e?e[1]||e[3]:(e=PYe.exec(t),e?e[2]:null)}const y8=Q.getLogger("esri.layers.support.labelFormatUtils"),_8={type:"simple",evaluate:()=>null},MYe={getAttribute:(t,e)=>t.field(e)};async function Cwe(t,e,r){if(!t||!t.symbol||!e)return _8;const i=t.where,s=LF(t),n=i?await ae(()=>import("./WhereClause-47630fa1.js").then(a=>a.W),["assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js"]):null;let o;if(s.type==="arcade"){const a=await uDe(s.expression,r,e);if(a==null)return _8;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){y8.error(new U("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>wX(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let d=null;return"attributes"in a?a&&a.attributes&&(d=a.attributes[h.name]):d=a.field(h.name),d==null?"":Awe(d,h)})};if(i){let a;try{a=n.WhereClause.create(i,e)}catch(c){return y8.error(new U("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),_8}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:MYe;try{if(a.testFeature(c,h))return l(c)}catch(d){y8.error(new U("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:d}))}return null}}return o}function Awe(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+t,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=b_(i,DC("short-date")):Zq(e)&&(i=Y2(+i)),i||""}const URt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:Cwe,formatField:Awe},Symbol.toStringTag,{value:"Module"}));let Owe=class{constructor(e=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,d=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=d}};function xX(t,e){if(t.type==="point")return Ay(t,e,!1);if(xwe(t))switch(t.type){case"extent":return Ay(t.center,e,!1);case"polygon":return Ay(t.centroid,e,!1);case"polyline":return Ay(uie(t),e,!0);case"mesh":return Ay(t.origin,e,!1)}else switch(t.type){case"extent":return Ay(IYe(t),e,!0);case"polygon":return Ay($Ye(t),e,!0);case"polyline":return Ay(uie(t),e,!0)}}function uie(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=Ope(e,Ape(e)/2);return $w(r[0],r[1],r[2],t.spatialReference)}function IYe(t){return $w(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function $Ye(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=Mpe(t.rings,!!t.hasZ);return $w(r[0],r[1],r[2],t.spatialReference)}function Ay(t,e,r){const i=r?t:yYe(t);return e&&t?Dge(t,i,e)?i:null:i}function zRt(t,e,r,i=0){if(t){e||(e=kt());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),wi(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function Rwe(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(E.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function DA(t,e,r=null){const i=OR(ah);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function kRt(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?n[o]=t[o]:r!=null&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return n[3]=e??i??s[3],n}function hie(t=ug,e,r,i=1){const s=new Array(3);if(e==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,d=a===0&&!n&&!h,f=r[a];l==="symbol-value"||d?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return Da(s)}function LYe(t){return t.isPrimitive!=null}function DF(t){return X7(LYe(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function X7(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function DYe(t,e,r,i=ve()){return t&&tS(i,i,-t/180*Math.PI),e&&eS(i,i,e/180*Math.PI),r&&$5(i,i,r/180*Math.PI),i}function TX(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Za(e),s=_w(t)*i,n=vw(t)*i,o=z_(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function Pwe(t,e,r,i,s,n,o,a,l,c,h){const d=GYe[h.mode];let f,m,y=0;if(ai(t,e,r,i,l.spatialReference,s,a))return d.requiresAlignment(h)?(y=d.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,h),f=n,m=o):(f=i,m=s),ai(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function $_(t,e,r,i,s){const n=(zN(t)?t.z:P1e(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=yf(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=yf(e,t,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=yf(e,t,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=yf(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function NYe(t,e,r,i){return $_(t,e,r,i,r2),r2.z}function HR(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?ls.UPDATE:t.onTheGroundChanged}function Rh(t){return t==="relative-to-ground"||t==="relative-to-scene"}function L_(t){return t!=="absolute-height"}function FYe(t,e,r,i,s){$_(e,r,s,i,r2),Rwe(t,r2.verticalDistanceToGround);const n=r2.sampledElevation,o=$s(jYe,t.transformation);return UM[0]=e.x,UM[1]=e.y,UM[2]=r2.z,xl(e.spatialReference,UM,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function UYe(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e],h=t[e+1],d=t[e+2],f=n.getElevation(c,h,d,a,"ground")??0;o+=f,r[i]=c,r[i+1]=h,r[i+2]=f,e+=3,i+=3}return o/s}function VYe(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(m,y,_,d,"ground")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function zYe(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(m,y,_,d,"scene")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function kYe(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function BYe(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let h=0;h<s;++h){const d=t[e],f=t[e+1],m=t[e+2];r[i]=d,r[i+1]=f,r[i+2]=c==null?m+l:l,e+=3,i+=3}return 0}let qR=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var ls;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(ls||(ls={}));const GYe={"absolute-height":{applyElevationAlignmentBuffer:BYe,requiresAlignment:kYe},"on-the-ground":{applyElevationAlignmentBuffer:UYe,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:VYe,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:zYe,requiresAlignment:()=>!0}},jYe=ve(),r2=new qR,UM=A();function SX(t){return t.mapPositions!=null}function Mwe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!SX(l))continue;const{update:c,averageGeometrySampledElevation:h}=$we(l,e,r,i,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function Eb(t,e,r,i,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,yl),Rwe(o,yl.verticalDistanceToGround),l=yl.sampledElevation):(i(a,yl),e.mode!=="absolute-height"&&(l=yl.sampledElevation));const c=$s(HYe,n??o.transformation),h=se(Iwe,c[12],c[13],c[14]);oi.TESTS_DISABLE_OPTIMIZATIONS?(gl[0]=a.x,gl[1]=a.y,gl[2]=yl.z,xl(a.spatialReference,gl,c,s.spatialReference)&&(n?$s(n,c):o.transformation=c)):s.setAltitudeOfTransformation(yl.z,c);const d=EX/s.unitInMeters;return(Math.abs(c[12]-h[0])>=d||Math.abs(c[13]-h[1])>=d||Math.abs(c[14]-h[2])>=d)&&(n?$s(n,c):o.transformation=c),l}const HYe=ve();function qYe(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;i(o,yl);const a=e.mode!=="absolute-height"?yl.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=ZYe;l.getGlobalTransform(c,h);const d=se(Iwe,h[12],h[13],h[14]);oi.TESTS_DISABLE_OPTIMIZATIONS?(gl[0]=o.x,gl[1]=o.y,gl[2]=yl.z,xl(o.spatialReference,gl,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(yl.z,h);const f=EX/s.unitInMeters;return(oi.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-d[0])>=f||Math.abs(h[13]-d[1])>=f||Math.abs(h[14]-d[2])>=f)&&l.setGlobalTransform(c,h),a}function WYe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const d of o){if(!SX(d))continue;const f=d.vertexAttributes.get(E.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=$we(d,e,r,i,s);c=y,l=f,h=m}h&&n.geometryVertexAttrsUpdated(d),a+=c}return a/o.length}const EX=.01,gl=A(),vu=A(),sx=A(),ZYe=ve(),Iwe=A(),yl=new qR;function $we(t,e,r,i,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;vu[0]=o[12],vu[1]=o[13],vu[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(E.POSITION),c=l.data,h=l.size,d=c.length/h,f=new JZ(t.mapPositions,r);let m=0,y=0;for(let _=0;_<d;_++){if(sx[0]=c[m],sx[1]=c[m+1],sx[2]=c[m+2],i(f,yl),a&&(y+=yl.sampledElevation),oi.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=yl.z,ai(c,r,m,c,s.spatialReference,m,1),c[m]-=vu[0],c[m+1]-=vu[1],c[m+2]-=vu[2],n=!0;else{gl[0]=c[m]+vu[0],gl[1]=c[m+1]+vu[1],gl[2]=c[m+2]+vu[2],s.setAltitude(gl,yl.z),c[m]=gl[0]-vu[0],c[m+1]=gl[1]-vu[1],c[m+2]=gl[2]-vu[2];const v=EX/s.unitInMeters;(Math.abs(sx[0]-c[m])>=v||Math.abs(sx[1]-c[m+1])>=v||Math.abs(sx[2]-c[m+2])>=v)&&(n=!0)}m+=h,f.offset+=3}return y/=d,{update:n,averageGeometrySampledElevation:y}}function XYe(t){return!!t&&wS[t]!=null}function YYe(t){return 1/(wS[t]||1)}function JYe(){const t=Object.keys(wS);return t.sort(),t}const QYe=JYe(),KYe=Q.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function eJe(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function GRt(t){const e=t&&t.expression;if(typeof e=="string"){const r=Nwe(e);if(r!=null)return{cachedResult:r}}return null}async function jRt(t,e,r,i){const s=t&&t.expression;if(typeof s!="string")return null;const n=Nwe(s);if(n!=null)return{cachedResult:n};const o=await v_();Qt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function Lwe(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function NF(t,e){if(t!=null&&!Dwe(t)){if(!e||!t.arcade)return void KYe.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=Twe(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function tJe(t){if(t!=null){if(Dwe(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function HRt(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const rJe={cachedResult:0};function Dwe(t){return t.cachedResult!=null}function Nwe(t){return t==="0"?0:null}let dp=class Fwe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=YYe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=tJe(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=XYe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=eJe(e),NF(this._featureExpressionInfoContext,Lwe(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new Fwe;return e!=null&&r.setFromElevationInfo(e),r}},iJe=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var Wt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Wt||(Wt={}));let sJe=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},im=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=die(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;i!=null&&NF(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>$_(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=A()){return re(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=ln()){const r=this.stageObject.boundingVolumeObjectSpace;return Ome(e,r.min),Rme(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.shaderTransformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(hm)&&($e(hm,hm,this.stageObject.shaderTransformation),le(e.render.origin,e.render.origin,hm),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=nJe,l=dW(o)?1:a.length;for(let h=0;h<l;h++){const d=a[h];Oy[0]=o[d[0]],Oy[1]=o[d[1]],Oy[2]=o[d[2]],$e(Oy,Oy,this.stageObject.transformation),mv[3*h]=Oy[0],mv[3*h+1]=Oy[1],mv[3*h+2]=Oy[2]}if(!e(mv,0,l))return null;Ti(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],mv[h+d]),o[d+3]=Math.max(o[d+3],mv[h+d]);c&&i.push({location:mv.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){Ud(o,hm);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(r.useViewElevation)d=r.service.getElevation(hm[0],hm[1],h)??0;else try{const f=TX(o,r.service.spatialReference,r);d=await r.service.queryElevation(hm[0],hm[1],s,f,h)??0}catch{}Ame(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,r){e===Vg.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===Vg.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const s=die(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function die(t){return t.isVisible()?t.parameters.transparent?Wt.TRANSPARENT:Wt.OPAQUE:Wt.INVISIBLE}const mv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Oy=A(),hm=A(),nJe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let Uwe=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};var Ms;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Ms||(Ms={}));let CX=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Zc.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===Zc.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Zc.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Zc.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=Zc.FAILED,!ys(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=lu(this._abortController):this._loadStatus===Zc.LOADING&&(this._loadStatus=Zc.FAILED),this._loader=null}};var Zc;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Zc||(Zc={}));const Vwe=3,Y7=3,zwe=10;let kwe=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function VM(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),j4(e)}function pie(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})}),j4(e)}function Bwe(t){const e=t.components.map(r=>r.geometry);return j4(e)}function fie(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),j4(e)}function oJe(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Gwe(t,e){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&x7e(a),{components:[new kwe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>v7e(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>u7e(e,1));case"cone":return r(v8,i=>hte(e,1,.5,i,!1),!0);case"inverted-cone":return r(v8,i=>hte(e,1,.5,i,!0),!0);case"cylinder":return r(v8,i=>w7e(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>_7e(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>f7e(e,1),!0);default:return}}const v8=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function aJe(t){return t.type==="fill"}function lJe(t){return t.type==="extrude"}function cJe(t){return t&&t.enabled&&(lJe(t)||aJe(t))&&t.edges!=null}function uJe(t){return t&&t.enabled&&t.edges||null}function jwe(t,e){return Hwe(uJe(t),e)}function Hwe(t,e){if(t==null)return null;const r=t.color!=null?MW(ke.toUnitRGBA(t.color)):Ft(0,0,0,0),i=po(t.size),s=po(t.extensionLength);switch(t.type){case"solid":return qwe({color:r,size:i,extensionLength:s,...e});case"sketch":return hJe({color:r,size:i,extensionLength:s,...e});default:return}}function qwe(t){return{...dJe,...t,type:"solid"}}function hJe(t){return{...pJe,...t,type:"sketch"}}const dJe={color:Ft(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Wt.OPAQUE,hasSlicePlane:!1},pJe={color:Ft(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Wt.OPAQUE,hasSlicePlane:!1},AX={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function QRt(t){return t.type==="web-style"?AX:OX(t.symbolLayers.toArray().map(e=>Wwe(t,e)))}function OX(t){let e=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function KRt(t){const e=OX(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const mie={};function Wwe(t,e){var s;const r=Zwe(t,e),i=cJe(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return(s=e.resource)!=null&&s.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...fJe(e.resource&&e.resource.primitive||zme),memory:r};case"path":{let n=0,o=0;switch(e.profile){case"circle":n=zwe;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":o=Vwe;break;case"miter":case"bevel":o=1;break;default:return}const a=2*n,l=n*o*2;let c=-2*l-a;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(n-1);break;case"round":c+=2*(n*(Y7-1)*2+n);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:l+a,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function Zwe(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Ka.EXTRUDE_EDGES:Ka.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?Ka.FILL_OUTLINE:Ka.FILL;case"water":return Ka.FILL;case"line":return e.join==="round"?Ka.LINE_ROUND:Ka.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Ka.PATH_ROUND_CIRCLE;case"quad":return Ka.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Ka.PATH_MITER_CIRCLE;case"quad":return Ka.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?Ka.OBJECT_POINT:Ka.OBJECT_POLYGON;case"icon":case"text":return r?Ka.ICON_POINT:Ka.ICON_POLYGON;default:return}}function fJe(t){let e=mie[t];if(e)return e;const r=Gwe(t,null);return e={primitivesPerFeature:Bwe(r.levels[0]).reduce((i,s)=>i+s.indices.get(E.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},mie[t]=e,e}const Ka={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},nx=Q.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let sm=class extends CX{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=nx,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new dp,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=gie(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=gie(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&nx.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(nx.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(nx.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return nx.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return mJe}_defaultElevationInfoZ(){return gJe}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?rJe:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=yie){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=yie){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return DA(null,i);const s=e!=null?ke.toUnitRGB(e):ug;return DA(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=DA(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return Wwe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==ls.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let s=ls.UPDATE;return e.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=ls.RECREATE}),s}applyRendererDiff(e,r){return Ms.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?Jd(r.size.field,e):0,s=r.color?Jd(r.color.field,e):0,n=r.opacity?Jd(r.opacity.field,e):0;return Ft(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&nx.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,s,n,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function gie(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const mJe={mode:"on-the-ground",offset:0,unit:"meters"},gJe={mode:"absolute-height",offset:0,unit:"meters"},yie={hasIntrinsicColor:!1};let iy=class extends DR{get geometries(){return this._geometries}get transformation(){return this._transformation??nn}set transformation(e){this._transformation=$s(this._transformation??ve(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(e){this._shaderTransformation=$s(this._shaderTransformation??ve(),e),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(e={}){super(),this.type=as.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new Xwe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){tt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new ON(Vg.MaskOccludee);for(const r of this._geometries)r.occludees=u7(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=h7(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new ON(Vg.Highlight);for(const r of this._geometries)r.highlights=u7(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=h7(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return ni(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=ve()){return ni(r,this.shaderTransformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new _ie,this._validateBoundingVolume(this._bvWorldSpace,NA.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new _ie,this._validateBoundingVolume(this._bvObjectSpace,NA.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===NA.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&yJe(n,e,i?s.shaderTransformation:this.getCombinedShaderTransformation(s))}Gr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.shaderTransformation:this.getCombinedShaderTransformation(s),a=nS(o);$e(vie,n.center,o);const l=mi(vie,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},Xwe=class{constructor(){this.min=Ae(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ae(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},_ie=class extends Xwe{constructor(){super(...arguments),this.bounds=_s()}};function yJe(t,e,r){const i=t.bbMin,s=t.bbMax;if(D5(r)){const n=se(_Je,r[12],r[13],r[14]);le(Oc,i,n),le(jh,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Oc[o]),e.max[o]=Math.max(e.max[o],jh[o])}else if($e(Oc,i,r),na(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Oc[n]),e.max[n]=Math.max(e.max[n],Oc[n]);else{$e(jh,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Oc[n],jh[n]),e.max[n]=Math.max(e.max[n],Oc[n],jh[n]);for(let n=0;n<3;++n){re(Oc,i),re(jh,s),Oc[n]=s[n],jh[n]=i[n],$e(Oc,Oc,r),$e(jh,jh,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Oc[o],jh[o]),e.max[o]=Math.max(e.max[o],Oc[o],jh[o])}}}const _Je=A(),Oc=A(),jh=A(),vie=A();var NA;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(NA||(NA={}));function RX(t,e,r,i,s,n){const o=t.clippingExtent;if(vo(e,i_,t.elevationProvider.spatialReference),o!=null&&!uW(o,i_))return null;vo(e,i_,t.renderCoordsHelper.spatialReference),r.shaderTransformer=n,r.localOrigin=t.localOriginFactory.getOrigin(i_);const a=new iy({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:FYe(a,e,t.elevationProvider,t.renderCoordsHelper,i)}}function BO(t,e,r){const i=t.elevationContext,s=r.spatialReference;vo(e,i_,s),i.centerPointInElevationSR=$w(i_[0],i_[1],e.hasZ?i_[2]:0,s??null)}function GO(t){switch(t.type){case"point":return t;case"polygon":case"extent":return xX(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=Ope(e,Ape(e)/2);return $w(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const i_=A();function Ywe(){return new Float32Array(2)}function vJe(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function rh(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function bJe(t,e){return new Float32Array(t,e,2)}function Jwe(){return Ywe()}function Qwe(){return rh(1,1)}function Kwe(){return rh(1,0)}function exe(){return rh(0,1)}const txe=Jwe(),rxe=Qwe(),wJe=Kwe(),xJe=exe();Object.freeze(Object.defineProperty({__proto__:null,ONES:rxe,UNIT_X:wJe,UNIT_Y:xJe,ZEROS:txe,clone:vJe,create:Ywe,createView:bJe,fromValues:rh,ones:Qwe,unitX:Kwe,unitY:exe,zeros:Jwe},Symbol.toStringTag,{value:"Module"}));function TJe(t){const e=new wr,{vertex:r,fragment:i}=e;return r.include(CF),e.include(fbe,t),e.include(ms,t),e.attributes.add(E.UV0,"vec2"),r.uniforms.add(new ir("viewport",(s,n)=>n.camera.fullViewport),new Oe("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Sr("pixelToNDC",(s,n)=>nr(wie,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Oe("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Sr("screenOffset",(s,n)=>nr(wie,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&EF(r),r.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?b`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?b`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:b`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?b`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:b`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?b`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:b`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new ir("uColor",s=>bie(s.color)),new ir("borderColor",s=>bie(s.borderColor))),t.hasMultipassGeometry&&(i.include(G_e,t),i.uniforms.add(new Sr("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(b`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?b`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:b`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function bie(t){return t??Cf}const wie=Ue(),SJe=Object.freeze(Object.defineProperty({__proto__:null,build:TJe},Symbol.toStringTag,{value:"Module"}));let ixe=class sxe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Le.Global}initializeProgram(e){return new Cr(e.rctx,sxe.shader.get().build(this.configuration),br)}setPipelineState(e){const r=e?Kr.ALWAYS:Kr.LESS;return this.configuration.depthHudEnabled?Ot({depthTest:{func:r},depthWrite:Al}):Ot({blending:bo(be.ONE,be.SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:jt})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};ixe.shader=new Er(SJe,()=>ae(()=>import("./LineCallout.glsl-8d26276d.js"),[]));let Uu=class extends No{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=_l.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([F({count:_l.COUNT})],Uu.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([F()],Uu.prototype,"spherical",void 0),u([F()],Uu.prototype,"occlusionTestEnabled",void 0),u([F()],Uu.prototype,"hasVerticalOffset",void 0),u([F()],Uu.prototype,"hasScreenSizePerspective",void 0),u([F()],Uu.prototype,"depthHudEnabled",void 0),u([F()],Uu.prototype,"depthHudAlignStartEnabled",void 0),u([F()],Uu.prototype,"hasSlicePlane",void 0),u([F()],Uu.prototype,"hasMultipassGeometry",void 0),u([F({constValue:!0})],Uu.prototype,"hasSliceInVertexProgram",void 0),u([F({constValue:!1})],Uu.prototype,"draped",void 0);let zM=class J7 extends H_{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new nxe),this._configuration=new Uu,this._uniqueMaterialIdentifier=J7.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==ce.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?_l.Screen:_l.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===L.Color)switch(e){case ce.LINE_CALLOUTS:case ce.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new EJe(e)}createBufferWriter(){return new AJe}validateParameters(e){const r=J7.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},EJe=class extends G_{beginSlot(e){return this.ensureTechnique(ixe,e)}},nxe=class extends cX{constructor(){super(...arguments),this.screenOffset=np,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const CJe=Hi().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4f(E.AUXPOS1),xie=[rh(0,0),rh(1,0),rh(0,1),rh(1,0),rh(1,1),rh(0,1)];let AJe=class{constructor(){this.vertexBufferLayout=CJe}elementCount(e){return 6*e.indices.get(E.POSITION).length}write(e,r,i,s,n){uX(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,e,s.position,n,6),hX(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,s.normal,n,6),bS(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<xie.length;++o)s.uv0.setVec(n+o,xie[o])}},oxe=class axe extends sm{constructor(e,r){super(e,null,r,PJe),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new zM(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||np,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new nxe,r=this.symbol,i=r.callout;if(e.color=i.color!=null?ke.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=po(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:po(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=i.border!=null&&i.border.color!=null?ke.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.at(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return RJe}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new dp,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!qme(l)))return null;const a=xX(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){var e;(e=this._material)==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HR(axe.elevationModeChangeTypes,i,s);return n!==ls.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._material)==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Rh(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:AX.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new Ve(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new Ve(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[E.POSITION,s],[E.NORMAL,new Ve([0,0,1],3,!0)],[E.AUXPOS1,n]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=zM.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(i);return s==null&&(s=new zM(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new zM(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new Hs(a.material,this._createVertexData(i),OJe,null,as.Point,o),c=RX(this._context,e,l,r,s);if(c==null)return null;const h=new im(this,c.object,[l],a.isUnique?[a.material]:null,null,Eb,r);return h.metadata=new Uwe(i.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Rh(r.mode),BO(h,e,this._context.elevationProvider),h}};oxe.elevationModeChangeTypes={definedChanged:ls.UPDATE,staysOnTheGround:ls.UPDATE,onTheGroundChanged:ls.RECREATE};const b8=[0],OJe=[[E.POSITION,b8],[E.NORMAL,b8],[E.AUXPOS1,b8]],RJe={mode:"relative-to-ground",offset:0},PJe={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let MJe=class{constructor(e,r,i=A(),s=Yt(),n=Ue(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},IJe=class extends iJe{};const Tie=Q.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function $Je(t,e){if(!yW(t))return Tie.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=LJe[t.callout.type];return r?new r(t,e):(Tie.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const LJe={line:oxe};let tw=class lxe{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new lxe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function uPt(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let hPt=class extends tw{},DJe=class cxe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new cxe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},D_=class xL{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new xL([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(e){return e?(e.set(this.coords),new xL(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new xL(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function ua(t,e){return t?e?4:3:e?3:2}const WR=Q.getLogger("esri.layers.graphics.featureConversionUtils"),uxe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},NJe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},Sie=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},FJe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},UJe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function PX(t,e,r,i){if(t){if(r)return e&&i?UJe:Sie;if(e&&i)return FJe}else if(e&&i)return Sie;return NJe}function w8({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function x8({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function T8({scale:t,translate:e},r,i){return r*t[i]+e[i]}function pPt(t,e,r){return t?e?r?$X(t):MX(t):r?IX(t):FF(t):null}function FF(t){const e=t.coords;return{x:e[0],y:e[1]}}function hxe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function MX(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function VJe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function IX(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function zJe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function $X(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function kJe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function BJe(t,e,r,i){let s=FF;r&&i?s=$X:r?s=MX:i&&(s=IX);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function LX(t,e){return t&&e?kJe:t?VJe:e?zJe:hxe}function GJe(t,e,r,i,s){const n=LX(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new D_,o):null;t.push(new tw(l,a,null,s?a[s]:void 0))}return t}function fPt(t,e,r=LX(e.z!=null,e.m!=null)){return r(t,e)}function jJe(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?dxe(s,r,i):null});return t}function dxe(t,e,r){if(t==null)return null;const i=ua(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function HJe(t,e,r,i,s){const n=ua(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?pxe(new D_,o,n):null;t.push(new tw(l,a,null,s?a[s]:void 0))}return t}function pxe(t,e,r=ua(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function qJe(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?fxe(s,r,i):null});return t}function fxe(t,e,r){if(!t)return null;const i=ua(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<i;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function WJe(t,e,r,i,s){const n=ua(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?mxe(new D_,o,n):null;t.push(new tw(l,a,null,s?a[s]:void 0))}return t}function mxe(t,e,r=ua(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function ZJe(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?gxe(s,r,i):null;if(o!=null){const l=FF(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function gxe(t,e,r){if(!t)return null;const i=ua(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const d=[];for(let f=0;f<i;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function XJe(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?yxe(new D_,n,r,i):null,c=s?a[s]:void 0;o!=null?t.push(new tw(l,a,hxe(new D_,o),c)):t.push(new tw(l,a,null,c))}return t}function yxe(t,e,r=e.hasZ,i=e.hasM){return YJe(t,e.rings,r,i)}function YJe(t,e,r,i){const s=ua(r,i),{lengths:n,coords:o}=t;let a=0;bg(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const C2=[],FA=[];function mPt(t,e,r,i,s){C2[0]=t;const[n]=_xe(FA,C2,e,r,i,s);return lp(C2),lp(FA),n}function _xe(t,e,r,i,s,n){if(lp(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new tw(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return GJe(t,e,i,s,n);case"esriGeometryMultipoint":return HJe(t,e,i,s,n);case"esriGeometryPolyline":return WJe(t,e,i,s,n);case"esriGeometryPolygon":return XJe(t,e,i,s,n);default:WR.error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${r}'`)),lp(t)}return t}function gPt(t,e,r,i){FA[0]=t,vxe(C2,FA,e,r,i);const s=C2[0];return lp(C2),lp(FA),s}function JJe(t,e,r){if(t==null)return null;const i=new D_;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),zq(t)?LX(e??t.z!=null,r??t.m!=null)(i,t):m2(t)?yxe(i,t,e,r):kq(t)?mxe(i,t,ua(e,r)):Vq(t)?pxe(i,t,ua(e,r)):void WR.error("convertFromGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${t}'`))}function QJe(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=FF;return r&&i?n=$X:r?n=MX:i&&(n=IX),n(s)}case"esriGeometryMultipoint":return dxe(s,r,i);case"esriGeometryPolyline":return fxe(s,r,i);case"esriGeometryPolygon":return gxe(s,r,i);default:return WR.error("convertToGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${e}'`)),null}}function KJe(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function vxe(t,e,r,i,s){if(lp(t),r==null)return KJe(t,e);switch(r){case"esriGeometryPoint":return BJe(t,e,i,s);case"esriGeometryMultipoint":return jJe(t,e,i,s);case"esriGeometryPolyline":return qJe(t,e,i,s);case"esriGeometryPolygon":return ZJe(t,e,i,s);default:WR.error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${r}'`))}return t}function yPt(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:d,queryGeometryType:f}=t,m={features:vxe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:h,queryGeometry:QJe(d,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function _Pt(t,e){const r=new DJe,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:d}=t;return d&&(r.fields=d),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&_xe(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(WR.error(new U("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function vPt(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)n.geometry!=null&&Cie(n.geometry,n.geometry,i,s,e),n.centroid!=null&&Cie(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function bPt(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new D_,Eie(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new D_,Eie(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function Eie(t,e,r,i,s,n,o=r,a=i){if(bg(t),e==null||!e.coords.length)return null;const l=uxe[s],{coords:c,lengths:h}=e,d=ua(r,i),f=ua(r&&o,i&&a),m=PX(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,w8(n,c[0]),x8(n,c[1])),bg(t,d,0),t;let y,_,v,w,T=0,x=0,S=x;for(const O of h){if(O<l)continue;let C=0;x=S,v=y=w8(n,c[T]),w=_=x8(n,c[T+1]),m(t.coords,c,x,T,v,w),C++,T+=d,x+=f;for(let P=1;P<O;P++,T+=d)v=w8(n,c[T]),w=x8(n,c[T+1]),v===y&&w===_||(m(t.coords,c,x,T,v-y,w-_),x+=f,C++,y=v,_=w);C>=l&&(t.lengths.push(C),S=x)}return lp(t.coords,S),t.coords.length?t:null}function wPt(t,e,r,i,s,n,o=r,a=i){if(bg(t),!e||!e.coords.length)return null;const l=uxe[s],{coords:c,lengths:h}=e,d=ua(r,i),f=ua(r&&o,i&&a),m=PX(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),bg(t,d,0),t;let y=0;const _=n*n;for(const v of h){if(v<l){y+=v*d;continue}const w=t.coords.length/f,T=y,x=y+(v-1)*d;m(t.coords,c,t.coords.length,T,c[T],c[T+1]),Q7(t.coords,c,d,_,m,T,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/f-w;S>=l?t.lengths.push(S):lp(t.coords,w*f),y+=v*d}return t.coords.length?t:null}function eQe(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let h=o,d=a,f=l-h,m=c-d;if(f!==0||m!==0){const y=((s-h)*f+(n-d)*m)/(f*f+m*m);y>1?(h=l,d=c):y>0&&(h+=f*y,d+=m*y)}return f=s-h,m=n-d,f*f+m*m}function Q7(t,e,r,i,s,n,o){let a,l=i,c=0;for(let h=n+r;h<o;h+=r)a=eQe(e,h,n,o),a>l&&(c=h,l=a);l>i&&(c-n>r&&Q7(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&Q7(t,e,r,i,s,c,o))}function xPt(t,e,r,i){if(e==null||!e.coords||!e.coords.length)return null;const s=ua(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const d=c[h],f=c[h+1];n=Math.min(n,d),a=Math.max(a,d),o=Math.min(o,f),l=Math.max(l,f)}}return ek(t)?k5e(t,n,o,a,l):Lq(n,o,a,l,t),t}function Cie(t,e,r,i,s){const{coords:n,lengths:o}=e,a=ua(r,i);if(!n.length)return t!==e&&bg(t),t;B4(s);const{originPosition:l,scale:c,translate:h}=s,d=rQe;d.originPosition=l;const f=d.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=d.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=T8(d,n[_],_);return t!==e&&bg(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let x=0;x<a;++x)t.coords[y+x]=T8(d,n[y+x],x);let w=t.coords[y],T=t.coords[y+1];y+=a;for(let x=1;x<v;x++,y+=a){w+=n[y]*f[0],T+=n[y+1]*f[1],t.coords[y]=w,t.coords[y+1]=T;for(let S=2;S<a;++S)t.coords[y+S]=T8(d,n[y+S],S)}}return t!==e&&bg(t,n.length,o.length),t}function TPt(t,e,r,i,s,n){if(bg(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=ua(r,i),a=PX(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function tQe(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function SPt(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=tQe(r,s,a,e),s+=a}return Math.abs(n)}function bg(t,e=0,r=0){lp(t.lengths,r),lp(t.coords,e)}function lp(t,e=0){t.length!==e&&(t.length=e)}const rQe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Aie=new Uo(Array,t=>x5(t,Pme),null,10,5),iQe=kt();let sQe=class{get labelLayers(){return this._labelLayers||JOe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=Fo.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=n?Lwe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(Bn.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=Bn.GRAPHIC,r){const i=r?this._visibleFlags|r|Bn.LABEL*r:this._visibleFlags;return e===Bn.GRAPHIC?(i&Fo.ALL_GRAPHIC)===Fo.ALL_GRAPHIC:(i&Fo.ALL_LABEL)===Fo.ALL_LABEL}setVisibilityFlag(e,r,i){const s=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const n=this.isVisible(e);if(s===n)return!1;if(e===Bn.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Bn.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=kt(),dYe(r,this._extent);const i=r.spatialReference;if(!Tn(i,e)&&!AR(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Zd.fromExtent(s.type==="mesh"?s.extent:s)),JJe(s,r,i)}get usedMemory(){let e=nwe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const s=r.type==="draped"?i.memory.draped:i.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=hYe(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:A(),num:0},draped:{origin:Ue(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&ie(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&oc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Ti(n.boundingBox):n.boundingBox=Ti(),n.requiresDrapedElevation=!1,await r5(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=Aie.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&J2(n.boundingBox,l),Aie.release(l)}),V5e(n.boundingBox)||az(hW(n.boundingBox,iQe))?n:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},CPt=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},nQe=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Oie,Rie,Pie,K7={exports:{}};K7.exports,Oie=K7,Rie=function(){function t(M,D,N){N=N||2;var G,X,J,ee,ye,Me,ft,Rt=D&&D.length,at=Rt?D[0]*N:M.length,vt=e(M,0,at,N,!0),ze=[];if(!vt||vt.next===vt.prev)return ze;if(Rt&&(vt=l(M,D,vt,N)),M.length>80*N){G=J=M[0],X=ee=M[1];for(var fe=N;fe<at;fe+=N)(ye=M[fe])<G&&(G=ye),(Me=M[fe+1])<X&&(X=Me),ye>J&&(J=ye),Me>ee&&(ee=Me);ft=(ft=Math.max(J-G,ee-X))!==0?1/ft:0}return i(vt,ze,N,G,X,ft),ze}function e(M,D,N,G,X){var J,ee;if(X===Y(M,D,N,G)>0)for(J=D;J<N;J+=G)ee=Z(J,M[J],M[J+1],ee);else for(J=N-G;J>=D;J-=G)ee=Z(J,M[J],M[J+1],ee);if(ee&&O(ee,ee.next)){var ye=ee.next;W(ee),ee=ye}return ee}function r(M,D){if(!M)return M;D||(D=M);var N,G=M;do if(N=!1,G.steiner||!O(G,G.next)&&S(G.prev,G,G.next)!==0)G=G.next;else{var X=G.prev;if(W(G),(G=D=X)===G.next)break;N=!0}while(N||G!==D);return D}function i(M,D,N,G,X,J,ee){if(M){!ee&&J&&y(M,G,X,J);for(var ye,Me,ft=M;M.prev!==M.next;)if(ye=M.prev,Me=M.next,J?n(M,G,X,J):s(M))D.push(ye.i/N),D.push(M.i/N),D.push(Me.i/N),W(M),M=Me.next,ft=Me.next;else if((M=Me)===ft){ee?ee===1?i(M=o(r(M),D,N),D,N,G,X,J,2):ee===2&&a(M,D,N,G,X,J):i(r(M),D,N,G,X,J,1);break}}}function s(M){var D=M.prev,N=M,G=M.next;if(S(D,N,G)>=0)return!1;for(var X=M.next.next;X!==M.prev;){if(T(D.x,D.y,N.x,N.y,G.x,G.y,X.x,X.y)&&S(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function n(M,D,N,G){var X=M.prev,J=M,ee=M.next;if(S(X,J,ee)>=0)return!1;for(var ye=X.x<J.x?X.x<ee.x?X.x:ee.x:J.x<ee.x?J.x:ee.x,Me=X.y<J.y?X.y<ee.y?X.y:ee.y:J.y<ee.y?J.y:ee.y,ft=X.x>J.x?X.x>ee.x?X.x:ee.x:J.x>ee.x?J.x:ee.x,Rt=X.y>J.y?X.y>ee.y?X.y:ee.y:J.y>ee.y?J.y:ee.y,at=v(ye,Me,D,N,G),vt=v(ft,Rt,D,N,G),ze=M.prevZ,fe=M.nextZ;ze&&ze.z>=at&&fe&&fe.z<=vt;){if(ze!==M.prev&&ze!==M.next&&T(X.x,X.y,J.x,J.y,ee.x,ee.y,ze.x,ze.y)&&S(ze.prev,ze,ze.next)>=0||(ze=ze.prevZ,fe!==M.prev&&fe!==M.next&&T(X.x,X.y,J.x,J.y,ee.x,ee.y,fe.x,fe.y)&&S(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ze&&ze.z>=at;){if(ze!==M.prev&&ze!==M.next&&T(X.x,X.y,J.x,J.y,ee.x,ee.y,ze.x,ze.y)&&S(ze.prev,ze,ze.next)>=0)return!1;ze=ze.prevZ}for(;fe&&fe.z<=vt;){if(fe!==M.prev&&fe!==M.next&&T(X.x,X.y,J.x,J.y,ee.x,ee.y,fe.x,fe.y)&&S(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function o(M,D,N){var G=M;do{var X=G.prev,J=G.next.next;!O(X,J)&&C(X,G,G.next,J)&&z(X,J)&&z(J,X)&&(D.push(X.i/N),D.push(G.i/N),D.push(J.i/N),W(G),W(G.next),G=M=J),G=G.next}while(G!==M);return r(G)}function a(M,D,N,G,X,J){var ee=M;do{for(var ye=ee.next.next;ye!==ee.prev;){if(ee.i!==ye.i&&x(ee,ye)){var Me=k(ee,ye);return ee=r(ee,ee.next),Me=r(Me,Me.next),i(ee,D,N,G,X,J),void i(Me,D,N,G,X,J)}ye=ye.next}ee=ee.next}while(ee!==M)}function l(M,D,N,G){var X,J,ee,ye=[];for(X=0,J=D.length;X<J;X++)(ee=e(M,D[X]*G,X<J-1?D[X+1]*G:M.length,G,!1))===ee.next&&(ee.steiner=!0),ye.push(w(ee));for(ye.sort(c),X=0;X<ye.length;X++)N=r(N=d(ye[X],N),N.next);return N}function c(M,D){return M.x-D.x}function h(M){if(M.next.prev===M)return M;let D=M;for(;;){const N=D.next;if(N.prev===D||N===D||N===M)break;D=N}return D}function d(M,D){var N=f(M,D);if(!N)return D;var G=k(N,M),X=r(N,N.next);let J=h(G);return r(J,J.next),X=h(X),h(D===N?X:D)}function f(M,D){var N,G=D,X=M.x,J=M.y,ee=-1/0;do{if(J<=G.y&&J>=G.next.y&&G.next.y!==G.y){var ye=G.x+(J-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(ye<=X&&ye>ee){if(ee=ye,ye===X){if(J===G.y)return G;if(J===G.next.y)return G.next}N=G.x<G.next.x?G:G.next}}G=G.next}while(G!==D);if(!N)return null;if(X===ee)return N;var Me,ft=N,Rt=N.x,at=N.y,vt=1/0;G=N;do X>=G.x&&G.x>=Rt&&X!==G.x&&T(J<at?X:ee,J,Rt,at,J<at?ee:X,J,G.x,G.y)&&(Me=Math.abs(J-G.y)/(X-G.x),z(G,M)&&(Me<vt||Me===vt&&(G.x>N.x||G.x===N.x&&m(N,G)))&&(N=G,vt=Me)),G=G.next;while(G!==ft);return N}function m(M,D){return S(M.prev,M,D.prev)<0&&S(D.next,M,M.next)<0}function y(M,D,N,G){var X=M;do X.z===null&&(X.z=v(X.x,X.y,D,N,G)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==M);X.prevZ.nextZ=null,X.prevZ=null,_(X)}function _(M){var D,N,G,X,J,ee,ye,Me,ft=1;do{for(N=M,M=null,J=null,ee=0;N;){for(ee++,G=N,ye=0,D=0;D<ft&&(ye++,G=G.nextZ);D++);for(Me=ft;ye>0||Me>0&&G;)ye!==0&&(Me===0||!G||N.z<=G.z)?(X=N,N=N.nextZ,ye--):(X=G,G=G.nextZ,Me--),J?J.nextZ=X:M=X,X.prevZ=J,J=X;N=G}J.nextZ=null,ft*=2}while(ee>1);return M}function v(M,D,N,G,X){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M=32767*(M-N)*X)|M<<8))|M<<4))|M<<2))|M<<1))|(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-G)*X)|D<<8))|D<<4))|D<<2))|D<<1))<<1}function w(M){var D=M,N=M;do(D.x<N.x||D.x===N.x&&D.y<N.y)&&(N=D),D=D.next;while(D!==M);return N}function T(M,D,N,G,X,J,ee,ye){return(X-ee)*(D-ye)-(M-ee)*(J-ye)>=0&&(M-ee)*(G-ye)-(N-ee)*(D-ye)>=0&&(N-ee)*(J-ye)-(X-ee)*(G-ye)>=0}function x(M,D){return M.next.i!==D.i&&M.prev.i!==D.i&&!V(M,D)&&(z(M,D)&&z(D,M)&&B(M,D)&&(S(M.prev,M,D.prev)||S(M,D.prev,D))||O(M,D)&&S(M.prev,M,M.next)>0&&S(D.prev,D,D.next)>0)}function S(M,D,N){return(D.y-M.y)*(N.x-D.x)-(D.x-M.x)*(N.y-D.y)}function O(M,D){return M.x===D.x&&M.y===D.y}function C(M,D,N,G){var X=$(S(M,D,N)),J=$(S(M,D,G)),ee=$(S(N,G,M)),ye=$(S(N,G,D));return X!==J&&ee!==ye||!(X!==0||!P(M,N,D))||!(J!==0||!P(M,G,D))||!(ee!==0||!P(N,M,G))||!(ye!==0||!P(N,D,G))}function P(M,D,N){return D.x<=Math.max(M.x,N.x)&&D.x>=Math.min(M.x,N.x)&&D.y<=Math.max(M.y,N.y)&&D.y>=Math.min(M.y,N.y)}function $(M){return M>0?1:M<0?-1:0}function V(M,D){var N=M;do{if(N.i!==M.i&&N.next.i!==M.i&&N.i!==D.i&&N.next.i!==D.i&&C(N,N.next,M,D))return!0;N=N.next}while(N!==M);return!1}function z(M,D){return S(M.prev,M,M.next)<0?S(M,D,M.next)>=0&&S(M,M.prev,D)>=0:S(M,D,M.prev)<0||S(M,M.next,D)<0}function B(M,D){var N=M,G=!1,X=(M.x+D.x)/2,J=(M.y+D.y)/2;do N.y>J!=N.next.y>J&&N.next.y!==N.y&&X<(N.next.x-N.x)*(J-N.y)/(N.next.y-N.y)+N.x&&(G=!G),N=N.next;while(N!==M);return G}function k(M,D){var N=new j(M.i,M.x,M.y),G=new j(D.i,D.x,D.y),X=M.next,J=D.prev;return M.next=D,D.prev=M,N.next=X,X.prev=N,G.next=N,N.prev=G,J.next=G,G.prev=J,G}function Z(M,D,N,G){var X=new j(M,D,N);return G?(X.next=G.next,X.prev=G,G.next.prev=X,G.next=X):(X.prev=X,X.next=X),X}function W(M){M.next.prev=M.prev,M.prev.next=M.next,M.prevZ&&(M.prevZ.nextZ=M.nextZ),M.nextZ&&(M.nextZ.prevZ=M.prevZ)}function j(M,D,N){this.i=M,this.x=D,this.y=N,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Y(M,D,N,G){for(var X=0,J=D,ee=N-G;J<N;J+=G)X+=(M[ee]-M[J])*(M[J+1]+M[ee+1]),ee=J;return X}return t.deviation=function(M,D,N,G){var X=D&&D.length,J=X?D[0]*N:M.length,ee=Math.abs(Y(M,0,J,N));if(X)for(var ye=0,Me=D.length;ye<Me;ye++){var ft=D[ye]*N,Rt=ye<Me-1?D[ye+1]*N:M.length;ee-=Math.abs(Y(M,ft,Rt,N))}var at=0;for(ye=0;ye<G.length;ye+=3){var vt=G[ye]*N,ze=G[ye+1]*N,fe=G[ye+2]*N;at+=Math.abs((M[vt]-M[fe])*(M[ze+1]-M[vt+1])-(M[vt]-M[ze])*(M[fe+1]-M[vt+1]))}return ee===0&&at===0?0:Math.abs((at-ee)/ee)},t.flatten=function(M){for(var D=M[0][0].length,N={vertices:[],holes:[],dimensions:D},G=0,X=0;X<M.length;X++){for(var J=0;J<M[X].length;J++)for(var ee=0;ee<D;ee++)N.vertices.push(M[X][J][ee]);X>0&&(G+=M[X-1].length,N.holes.push(G))}return N},t},(Pie=Rie())!==void 0&&(Oie.exports=Pie);const CS=FR(K7.exports),UF=Q.getLogger("esri.views.3d.support.buffer.math");function oQe(t,e,r){AS(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function AS(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return UF.error("source and destination buffers need to have the same number of elements"),t;const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],h=r[5],d=r[6],f=r[8],m=r[9],y=r[10],_=r[12],v=r[13],w=r[14];let T=0,x=0;for(let S=0;S<n;S++){const O=e[T],C=e[T+1],P=e[T+2];t[x]=o*O+c*C+f*P+_,t[x+1]=a*O+h*C+m*P+v,t[x+2]=l*O+d*C+y*P+w,T+=s,x+=i}return t}function bxe(t,e,r){rw(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function rw(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return void UF.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],d=r[5],f=r[6],m=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const T=e[_],x=e[_+1],S=e[_+2];t[v]=o*T+c*x+f*S,t[v+1]=a*T+h*x+m*S,t[v+2]=l*T+d*x+y*S,_+=s,v+=i}}function aQe(t,e,r){QN(t.typedBuffer,e,r,t.typedBufferStride)}function QN(t,e,r,i=3){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],a+=o,l+=i}function lQe(t,e){VF(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function VF(t,e,r=3,i=r){const s=Math.min(t.length/r,e.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],h=e[n+2],d=l*l+c*c+h*h;if(d>0){const f=1/Math.sqrt(d);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*h}n+=i,o+=r}}function cQe(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<i;h++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:VF,normalizeView:lQe,scale:QN,scaleView:aQe,shiftRight:cQe,transformMat3:rw,transformMat3View:bxe,transformMat4:AS,transformMat4View:oQe},Symbol.toStringTag,{value:"Module"}));function uQe(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function Mie(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}var wg,co;function s_(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function jO(t){return t!=null&&!isNaN(t)&&isFinite(t)}function wxe(t){return t.valueExpression?wg.Expression:t.field&&typeof t.field=="string"?wg.Field:wg.Unknown}function hQe(t,e){const r=e||wxe(t),i=t.valueUnit||"unknown";return r===wg.Unknown?co.Constant:t.stops?co.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?co.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?co.Proportional:co.Additive:co.Identity:co.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(wg||(wg={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(co||(co={}));const N_=Q.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Iie=new hu,TL=Math.PI,xxe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function Txe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void N_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let d=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void N_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!d){const T=_.createSyntaxTree(i.valueExpression);d=_.createFunction(T),i.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=NX(a,c);if(y){const _=y[0],v=y[1],w=_===v?i.stops[_].color:ke.blendColors(i.stops[_].color,i.stops[v].color,y[2],r!=null?r.color:void 0);return new ke(w)}}}function Sxe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void N_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let d=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void N_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!d){const T=_.createSyntaxTree(i.valueExpression);d=_.createFunction(T),i.cache.compiledFunc=d}a=_.executeFunction(d,w)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=NX(a,c);if(y){const _=y[0],v=y[1];if(_===v)return i.stops[_].opacity;{const w=i.stops[_].opacity;return w+(i.stops[v].opacity-w)*y[2]}}}}function Exe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void N_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let d=i.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(r==null||r.arcade==null)return void N_.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(m),v=y.createExecContext(a,_);if(!d){const w=y.createSyntaxTree(i.valueExpression);d=y.createFunction(w),i.cache.compiledFunc=d}f=y.executeFunction(d,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function dQe(t,e,r){const i=typeof e=="number",s=i?null:e,n=s&&s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=r!=null?r.scale:void 0,d=r!=null?r.view:void 0;o=h==null||d==="3d"?pQe(t):h}else if(!i)switch(t.inputValueType){case wg.Expression:{if(r==null||r.arcade==null)return void N_.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,f=d.getViewInfo(h),m=d.createExecContext(s,f);if(!l){const y=d.createSyntaxTree(t.valueExpression);l=d.createFunction(y),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case wg.Field:n&&(o=n[t.field]);break;case wg.Unknown:o=null}if(!jO(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return jO(c)&&c!==0?o/c:null}function pQe(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function zF(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void N_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Axe(dQe(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function yc(t,e,r){return t==null?null:s_(t)?zF(t,e,r):jO(t)?t:null}function Cxe(t,e,r){return jO(r)&&t>r?r:jO(e)&&t<e?e:t}function fQe(t,e,r,i){return t+((yc(e.minSize,r,i)||e.minDataValue)??0)}function mQe(t,e,r){const i=t.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=t.minSize),yc(s,e,r)}function gQe(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=yc(e.minSize,r,i),o=yc(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?TL*(n/2)**2:n*n,h=c+s*((l?TL*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/TL):Math.sqrt(h)}return n+s*(o-n)}function yQe(t,e,r,i){const s=i!=null?i.shape:void 0,n=t/e.minDataValue,o=yc(e.minSize,r,i),a=yc(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,Cxe(l,o,a)}function _Qe(t,e,r,i,s){var l,c,h;const[n,o,a]=NX(t,s);if(n===o)return yc((l=e.stops)==null?void 0:l[n].size,r,i);{const d=yc((c=e.stops)==null?void 0:c[n].size,r,i);return d+(yc((h=e.stops)==null?void 0:h[o].size,r,i)-d)*a}}function vQe(t,e,r,i){const s=(i!=null&&i.resolution?i.resolution:1)*wS[e.valueUnit],n=yc(e.minSize,r,i),o=yc(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/TL)/s:a==="radius"||a==="distance"?2*t/s:t/s,Cxe(l,n,o)}function Axe(t,e,r,i,s){switch(e.transformationType){case co.Additive:return fQe(t,e,r,i);case co.Constant:return mQe(e,r,i);case co.ClampedLinear:return gQe(t,e,r,i);case co.Proportional:return yQe(t,e,r,i);case co.Stops:return _Qe(t,e,r,i,s);case co.RealWorldSize:return vQe(t,e,r,i);case co.Identity:return t;case co.Unknown:return null}}function bQe(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=yc(t.minSize,Iie,s),o=yc(t.maxSize,Iie,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function DX(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=Txe(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=Sxe(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=Exe(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=zF(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function NX(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function wQe(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":zF(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const RPt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:wQe,getColor:Txe,getOpacity:Sxe,getRotationAngle:Exe,getSize:zF,getSizeForValue:Axe,getSizeFromNumberOrVariable:yc,getSizeRangeAtScale:bQe,getVisualVariableValues:DX,viewScaleRE:xxe},Symbol.toStringTag,{value:"Module"}));function kF(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function xQe(t,e){if(t.symbol!=null)return t.symbol;const r=kF(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function PPt(t,e){const r=kF(t,e),i=xQe(t,e);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=DX(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function TQe(t,e){if(t.symbol!=null)return t.symbol;const r=kF(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function MPt(t,e){const r=kF(t,e),i=await TQe(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=DX(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=ke.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function SQe(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function EQe(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function $ie(t){const e=[[E.POSITION,t.indices]],r=[[E.POSITION,new Ve(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(r.push([E.COLORFEATUREATTRIBUTE,new Ve([t.attributeData.colorFeature],1,!0)]),e.push([E.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(r.push([E.COLOR,new Ve(t.attributeData.color,4,!0)]),e.push([E.COLOR,sE(t.indices.length)])),t.attributeData.uvMapSpace&&(r.push([E.UVMAPSPACE,new Ve(t.attributeData.uvMapSpace,4,!0)]),e.push([E.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(r.push([E.BOUNDINGRECT,new Ve(t.attributeData.boundingRect,9,!0)]),e.push([E.BOUNDINGRECT,t.indices])),new Hs(t.material,r,e,t.mapPositions,as.Mesh,t.attributeData.objectAndLayerIdColor)}function Lie(t,e=null){const r=[[E.POSITION,t.indices],[E.UV0,t.indices]],i=[[E.POSITION,new Ve(t.attributeData.position,3,!0)],[E.UV0,new Ve(t.attributeData.uv0,2,!0)]];return new Hs(t.material,i,r,t.mapPositions,as.Mesh,e)}function HO(t){switch(t.type){case"extent":if(t instanceof _r)return Zd.fromExtent(t);break;case"polygon":return t}return null}let BF=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function eG(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let h=0;if(c)for(let C=0;C<c.length-1;C++){const P=c[C+1]-c[C];P>h&&(h=P)}else h=s;const d=Math.floor(1.1*h)+1;(xp==null||xp.length<2*d)&&(xp=new Uint32Array(uLe(2*d)));for(let C=0;C<2*d;C++)xp[C]=0;let f=0;const m=!!c&&!!a,y=m?l:s;let _=AN(s);const v=new Uint32Array(l),w=1.96;let T=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,x=1,S=c?c[1]:y;for(let C=0;C<y;C++){if(C===T){const k=1-f/C;if(k+w*Math.sqrt(k*(1-k)/C)<o)return null;T*=2}if(C===S){for(let k=0;k<2*d;k++)xp[k]=0;if(a)for(let k=c[x-1];k<c[x];k++)v[k]=_[a[k]];S=c[++x]}const P=m?a[C]:C,$=P*e,V=OQe(n,$,e);let z=V%d,B=f;for(;xp[2*z+1]!==0;){if(xp[2*z]===V){const k=xp[2*z+1]-1;if(CQe(n,$,k*e,e)){B=_[k];break}}z++,z>=d&&(z-=d)}B===f&&(xp[2*z]=V,xp[2*z+1]=P+1,f++),_[P]=B}if(o!==0&&1-f/s<o)return null;if(m){for(let C=c[x-1];C<v.length;C++)v[C]=_[a[C]];_=Pf(v)}const O=i?new Array(f):new Uint32Array(f*e);f=0;for(let C=0;C<y;C++)_[C]===f&&(AQe(n,(m?a[C]:C)*e,O,f*e,e),f++);if(a&&!m){const C=new Uint32Array(l);for(let P=0;P<C.length;P++)C[P]=_[a[P]];_=Pf(C)}return{buffer:Array.isArray(O)?O:O.buffer,indices:_,uniqueCount:f}}function CQe(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function AQe(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function OQe(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let xp=null;function $Pt(t){const e=ZR(t.rings,t.hasZ,jf.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=fh(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),f=Pf(CS(h,d,3));r.push({position:h,faces:f}),i+=h.length,s+=f.length}const n=RQe(r,i,s),o=Array.isArray(n.position)?eG(n.position,3,{originalIndices:n.faces}):eG(n.position.buffer,6,{originalIndices:n.faces});return n.position=Cve(new Float64Array(o.buffer)),n.faces=o.indices,n}function RQe(t,e,r){if(t.length===1)return t[0];const i=zo(e),s=new Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:Pf(s)}}function ZR(t,e,r){const i=t.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let m=0;m<i;++m)h+=t[m].length;const d=zo(3*h);let f=0;for(let m=i-1;m>=0;m--){const y=t[m],_=r===jf.CCW_IS_HOLE&&PQe(y);if(_&&i!==1)s[a++]=y;else{let v=y.length;for(let T=0;T<a;++T)v+=s[T].length;const w={index:f,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=_?kM(y,y.length-1,-1,d,f,y.length,e):kM(y,0,1,d,f,y.length,e);for(let T=0;T<a;++T){const x=s[T];w.holeIndices[T]=f,w.pathLengths[T+1]=x.length,x.length>0&&(o[c++]={index:f,count:x.length}),f=kM(x,0,1,d,f,x.length,e)}a=0,w.count>0&&(n[l++]=w)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=kM(y,0,1,d,f,y.length,e)}return n.length=l,o.length=c,{position:d,polygons:n,outlines:o}}function kM(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function PQe(t){return!Rpe(t,!1,!1)}var jf;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(jf||(jf={}));var UA,KN,tG;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(UA||(UA={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(KN||(KN={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(tG||(tG={}));let Oxe=class{constructor(e,r){this._fbo=null;const i=new vr;i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=At.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new on(e,i)}dispose(){this._fbo=Fe(this._fbo)}getTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}isValid(){return this._fbo!=null}resize(e,r){var i;(i=this._fbo)==null||i.resize(e,r)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){var r;const e=(r=this._fbo)==null?void 0:r.colorTexture;e!=null&&e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},ox=class{constructor(e,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new Oxe(e,s)}},MQe=class{constructor(e){this.renderTargets=[new ox(e,L.Color,ss.Color),new ox(e,L.Color,ss.ColorNoRasterImage),new ox(e,L.Highlight,ss.Highlight,!1),new ox(e,L.Normal,ss.Water),new ox(e,L.Color,ss.Occluded)],oe("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new ox(e,L.ObjectAndLayerIdColor,ss.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){return e?(r.lastUsed=i,!1):i-r.lastUsed>IQe?(r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0,!1):r.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const IQe=1e3;let Rxe=class extends ei{constructor(){super(...arguments),this.color=Ft(1,1,1,1)}};function $Qe(){const t=new wr;return t.include(Ih),t.fragment.uniforms.add(new Je("tex",e=>e.texture),new ir("uColor",e=>e.color)),t.fragment.code.add(b`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const LQe=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Rxe,build:$Qe},Symbol.toStringTag,{value:"Module"}));let Pxe=class{constructor(e){this._context=e,this._perConstructorInstances=new nE,this._frameCounter=0,this._keepAliveFrameCount=Die}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=NQe){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(s==null){const n=new e(this._context,r,()=>this.release(n));s=new DQe(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Die&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},DQe=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Die=-1,NQe=new ha;let Mxe=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new nE}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new FQe(n),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(Fe(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&Q.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},FQe=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,tt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const UQe={orderedRepackingEnabled:!1},VQe=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let rG=class SL{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Fn,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Fn.clearPool(),iG[0]=null,gv.prune(),d1.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Fn.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}Fn.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Fn.acquire();for(const s of e){const n=r??sS(this.objectToBoundingSphere(s),jQe);E3(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}Fn.release(i),this._shrink()}update(e,r){if(!E3(r[3])&&this._isDegenerate(e))return;const i=GQe(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=pu(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=pu(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=S8(e,r),h=d=>{if(--n,!s(d))return;const f=this.objectToBoundingSphere(d);if(!t_(i,f))return;const m=R0(e,r,f),y=m-f[3],_=m+f[3];y<o&&(o=y,a=_,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(n<=0||!t_(i,d.bounds)||(ie(bu,c,d.halfSize),le(bu,bu,d.bounds),R0(e,r,bu)>a))return!1;const f=d.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{i===SL.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(s);const d=R0(r,i,e),f=S8(r,i),m=S8(r,-i),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),w=v,T=R0(r,i,w)-d,x=T-v[3],S=T+v[3];x>c||S<l||!t_(o,v)||n(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!t_(o,_.bounds)||(ie(bu,f,_.halfSize),le(bu,bu,_.bounds),R0(r,i,bu)-d>c)||(ie(bu,m,_.halfSize),le(bu,bu,_.bounds),R0(r,i,bu)-d<l))return!1;const v=_.node;return v.terminals.forAll(w=>y(w)),v.residents!==null&&v.residents.forAll(w=>y(w)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=mg(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),h=mg(c),d=i+h;return!(fo(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=mg(l.bounds),h=i+c;if(fo(l.bounds,s)-h*h>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return BM(r.bounds,2*-r.halfSize,Hc),BM(r.bounds,2*r.halfSize,qc),Uee(e.origin,e.direction,Hc,qc)}_intersectsNodeWithOffset(e,r,i){return BM(r.bounds,2*-r.halfSize,Hc),BM(r.bounds,2*r.halfSize,qc),i.applyToMinMax(Hc,qc),Uee(e.origin,e.direction,Hc,qc)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||qk(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||qk(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=Fn.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(Fn.acquire().init(i).advance(n));Fn.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=SL.DepthOrder.FRONT_TO_BACK){let n=Fn.acquire().init(e);const o=[n];for(BQe(i,s,Uie);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Uie[a];n.node.children[l]&&o.push(Fn.acquire().init(n).advance(l))}Fn.release(n)}}_remove(e,r,i){gv.clear();const s=i.advanceTo(r,(n,o)=>{gv.push(n.node),gv.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=gv.length-2;n>=0;n-=2){const o=gv.data[n],a=gv.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Gt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=Fn.acquire().init(e);this._add(r.at(i),s),Fn.release(s)}}_grow(e,r){if(r!==0&&(Nie(e,r,i=>this.objectToBoundingSphere(i),dm),E3(dm[3])&&!this._fitsInsideTree(dm)))if(this._nodeIsEmpty(this._root.node))sS(dm,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(dm);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(dm,i):this._growRootAsSubNode(i),Fn.release(i)}}_rebuildTree(e,r){re(C8,r.bounds),C8[3]=r.halfSize,Nie([e,C8],2,s=>s,A8);const i=Fn.acquire().init(this._root);this._root.initFrom(null,A8,A8[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Fn.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),h=i[l]+r-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(d+f)*Math.LOG2E);s=Math.max(s,m),GM[l].min=d,GM[l].max=f}for(let l=0;l<3;l++){let c=GM[l].min,h=GM[l].max;const d=(s-(c+h))/2;c+=Math.ceil(d),h+=Math.floor(d);const f=n[l]-o-c*o*2;E8[l]=f+(h+c)*o}const a=s*o;return E8[3]=a*$xe,Fn.acquire().initFrom(null,E8,a,0)}_growRootAsSubNode(e){const r=this._root.node;re(dm,this._root.bounds),dm[3]=this._root.halfSize,this._root.init(e),e.advanceTo(dm,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!E3(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:s}}static fromJSON(e){const r=new SL(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},Fn=class dT{constructor(){this.bounds=_s(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=e??dT.createEmptyNode(),r!=null&&sS(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*$xe}advance(e){let r=this.node.children[e];r||(r=dT.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=Ixe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Gt({shrink:!0}),residents:new Gt({shrink:!0})}}static acquire(){return dT._pool.acquire()}static release(e){dT._pool.release(e)}static clearPool(){dT._pool.prune()}};function zQe(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function kQe(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function BM(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function Nie(t,e,r,i){if(e===1){const s=r(t[0]);sS(s,i)}else{Hc[0]=1/0,Hc[1]=1/0,Hc[2]=1/0,qc[0]=-1/0,qc[1]=-1/0,qc[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);E3(n[3])&&(zQe(Hc,n),kQe(qc,n))}Gr(i,Hc,qc,.5),i[3]=Math.max(qc[0]-Hc[0],qc[1]-Hc[1],qc[2]-Hc[2])/2}}function BQe(t,e,r){if(!d1.length)for(let i=0;i<8;++i)d1.push({index:0,distance:0});for(let i=0;i<8;++i){const s=Ixe[i];d1.data[i].index=i,d1.data[i].distance=R0(t,e,s)}d1.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=d1.data[i].index}function S8(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=R0(t,e,Fie[s]);n<i&&(i=n,r=Fie[s])}return r}function R0(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function E3(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Fn._pool=new Uo(Fn),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(rG||(rG={}));const Ixe=[Ae(-1,-1,-1),Ae(1,-1,-1),Ae(-1,1,-1),Ae(1,1,-1),Ae(-1,-1,1),Ae(1,-1,1),Ae(-1,1,1),Ae(1,1,1)],Fie=[Ae(-1,-1,-1),Ae(-1,-1,1),Ae(-1,1,-1),Ae(-1,1,1),Ae(1,-1,-1),Ae(1,-1,1),Ae(1,1,-1),Ae(1,1,1)],$xe=Math.sqrt(3),iG=[null];function GQe(t){return iG[0]=t,iG}const E8=_s(),bu=A(),Hc=A(),qc=A(),gv=new Gt,jQe=_s(),dm=_s(),C8=_s(),A8=_s(),GM=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],d1=new Gt,Uie=[0,0,0,0,0,0,0,0],Bd=rG;var d_;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(d_||(d_={}));let Lxe=class extends DR{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=as.Layer,this.events=new Ls,this.sliceable=!1,this._objects=new Gt,this._objectsAdded=new Gt,this._handles=new Mi,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??d_.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const s of VQe)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==d_.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Bd(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Pe(this._octree),this._objectsAdded.clear()}};function e4(t){return t!=null&&t.type===as.Layer}var au,iw;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(au||(au={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(iw||(iw={}));let so=class extends No{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=st.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=au.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=iw.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===au.Draped}};u([F({count:L.COUNT})],so.prototype,"output",void 0),u([F({count:st.COUNT})],so.prototype,"transparencyPassType",void 0),u([F()],so.prototype,"occluder",void 0),u([F()],so.prototype,"hasSlicePlane",void 0),u([F()],so.prototype,"writeDepth",void 0),u([F({count:au.COUNT})],so.prototype,"space",void 0),u([F()],so.prototype,"hideOnShortSegments",void 0),u([F()],so.prototype,"hasCap",void 0),u([F({count:iw.COUNT})],so.prototype,"anchor",void 0),u([F()],so.prototype,"hasTip",void 0),u([F()],so.prototype,"vvSize",void 0),u([F()],so.prototype,"vvColor",void 0),u([F()],so.prototype,"vvOpacity",void 0),u([F()],so.prototype,"hasOccludees",void 0),u([F()],so.prototype,"hasMultipassTerrain",void 0),u([F()],so.prototype,"cullAboveGround",void 0),u([F({constValue:!0})],so.prototype,"hasVvInstancing",void 0),u([F({constValue:!0})],so.prototype,"hasSliceTranslatedView",void 0);const Vie=8;function Dxe(t,e){const r=t.vertex;r.uniforms.add(new Oe("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(E.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new zt("vvSizeMinSize",i=>i.vvSize.minSize),new zt("vvSizeMaxSize",i=>i.vvSize.maxSize),new zt("vvSizeOffset",i=>i.vvSize.offset),new zt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(b`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(E.SIZE,"float"),r.code.add(b`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(E.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new vl("vvOpacityValues",i=>i.vvOpacity.values,Vie),new vl("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,Vie)),r.code.add(b`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(b`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(vg,e),t.attributes.add(E.COLORFEATUREATTRIBUTE,"float"),r.code.add(b`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(E.COLOR,"vec4"),r.code.add(b`vec4 getColor(){
return applyOpacity(color);
}`))}function Bg(t,e){switch(t.fragment.include(Tc),e.output){case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:t.fragment.code.add(b`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case L.Depth:t.fragment.code.add(b`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let Nxe=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${pc()}`,s=>s.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:s}=i,n=s.gpuMemoryUsage;this._orphanCache.put(r,s,n)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const s=this._orphanCache.pop(r)??this._createTexture(e),n=new HQe(s);return this._repository.set(r,n),s}},HQe=class{constructor(e){this.texture=e,this.refCount=1}};function qQe(t,e){return new Nxe(r=>{const{encodedData:i,paddedPixels:s}=WQe(r),n=new vr;return n.internalFormat=St.RGBA,n.width=s,n.height=1,n.wrapMode=Dt.CLAMP_TO_EDGE,new Ct(t,n,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function WQe(t){const e=FX(t),r=1/t.pixelRatio,i=Fxe(t),s=Uxe(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const m of e){for(let y=0;y<m;y++){const _=a*(Math.min(y,m-1-y)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=i+Vxe,d=new Uint8Array(4*h);let f=4;for(const m of c)zO(m,d,f),f+=4;return d.copyWithin(0,f-4,f),d.copyWithin(f,4,8),{encodedData:d,paddedPixels:h}}function FX(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function Fxe(t){if(t==null)return 1;const e=FX(t);return Math.floor(e.reduce((r,i)=>r+i))}function Uxe(t){return FX(t).reduce((e,r)=>Math.max(e,r))}const Vxe=2;function ZQe(t){return t==null?Cf:t.length===4?t:wi(XQe,t[0],t[1],t[2],1)}const XQe=Yt();function zxe(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?YQe(t,e):JQe(t)}function YQe(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(Tc),e.draped||(ap(i,e),i.uniforms.add(new Oe("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(b`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(b`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${KQe};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(b`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(b`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),uE(i,e),i.code.add(b`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?b`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",Vxe),s.uniforms.add(new Je("stipplePatternTexture",n=>n.stippleTexture),new Oe("stipplePatternSDFNormalizer",n=>QQe(n.stipplePattern)),new Oe("stipplePatternPixelSizeInv",n=>1/UX(n))),s.code.add(b`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),s.code.add(b`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?b`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:b`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?b`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?b`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:b`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?b`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:b`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new ir("stippleOffColor",n=>ZQe(n.stippleOffColor))),s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function JQe(t){t.fragment.code.add(b`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function QQe(t){return t?(Math.floor(.5*(Uxe(t)-1))+.5)/t.pixelRatio:1}function UX(t){const e=t.stipplePattern;return e?Fxe(t.stipplePattern)/e.pixelRatio:1}const KQe=b.float(.4),Cb=64,VX=Cb/2,kxe=VX/5,eKe=Cb/kxe,tKe=.25;function rKe(t,e){const r=Dbe(t,Cb,VX,kxe),i=new vr;return i.internalFormat=St.RGBA,i.width=Cb,i.height=Cb,i.wrapMode=Dt.CLAMP_TO_EDGE,new Ct(e,i,r)}function Bxe(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",eKe),uE(r,e),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(b`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===au.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Oe("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),r.code.add(b`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var mh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(mh||(mh={}));let ki=class extends No{constructor(){super(...arguments),this.output=L.Color,this.capType=mh.BUTT,this.transparencyPassType=st.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([F({count:L.COUNT})],ki.prototype,"output",void 0),u([F({count:mh.COUNT})],ki.prototype,"capType",void 0),u([F({count:st.COUNT})],ki.prototype,"transparencyPassType",void 0),u([F()],ki.prototype,"occluder",void 0),u([F()],ki.prototype,"hasSlicePlane",void 0),u([F()],ki.prototype,"hasPolygonOffset",void 0),u([F()],ki.prototype,"writeDepth",void 0),u([F()],ki.prototype,"draped",void 0),u([F()],ki.prototype,"stippleEnabled",void 0),u([F()],ki.prototype,"stippleOffColorEnabled",void 0),u([F()],ki.prototype,"stippleScaleWithLineWidth",void 0),u([F()],ki.prototype,"stipplePreferContinuous",void 0),u([F()],ki.prototype,"roundJoins",void 0),u([F()],ki.prototype,"applyMarkerOffset",void 0),u([F()],ki.prototype,"vvSize",void 0),u([F()],ki.prototype,"vvColor",void 0),u([F()],ki.prototype,"vvOpacity",void 0),u([F()],ki.prototype,"falloffEnabled",void 0),u([F()],ki.prototype,"innerColorEnabled",void 0),u([F()],ki.prototype,"hasOccludees",void 0),u([F()],ki.prototype,"hasMultipassTerrain",void 0),u([F()],ki.prototype,"cullAboveGround",void 0),u([F()],ki.prototype,"wireframe",void 0),u([F({constValue:!0})],ki.prototype,"stippleRequiresClamp",void 0),u([F({constValue:!0})],ki.prototype,"stippleRequiresStretchMeasure",void 0),u([F({constValue:!0})],ki.prototype,"hasVvInstancing",void 0),u([F({constValue:!0})],ki.prototype,"hasSliceTranslatedView",void 0),u([F()],ki.prototype,"objectAndLayerIdColorInstanced",void 0);const t4=1;function iKe(t){const e=new wr,{vertex:r,fragment:i}=e,s=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha);e.include(MR),e.include(Dxe,t),e.include(zxe,t);const n=t.applyMarkerOffset&&!t.draped;n&&(r.uniforms.add(new Oe("markerScale",m=>m.markerScale)),e.include(Bxe,{space:au.World,draped:!1})),t.output===L.Depth&&e.include(Bg,t),e.include(BR,t),gc(r,t),r.uniforms.add(new Ni("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new Sr("nearFar",(m,y)=>y.camera.nearFar),new Oe("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new ir("viewport",(m,y)=>y.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.SUBDIVISIONFACTOR,"float"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),e.attributes.add(E.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),O_(e),s&&e.varyings.add("depth","float");const o=t.stippleEnabled&&t.stippleScaleWithLineWidth;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===mh.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&a,d=t.falloffEnabled||h;d&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(b`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),sF(e),r.code.add(b`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),uE(r,t),r.code.add(b`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?b`vLineWidth = lineWidth;`:""}
      ${o?b`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(b`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(b`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&r.code.add(b`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?b`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(b`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(b`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?b`min(1.0, subdivisionFactor * ${b.float((t4+2)/(t4+1))})`:b`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(b`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==mh.BUTT;return r.code.add(b`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?b`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(b`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?b`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?b`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?b`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(b`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Oe("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(b`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(b`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Oe("stipplePatternPixelSize",m=>UX(m))),r.code.add(b`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(b`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(mu,t),e.include(ms,t),i.include(rm),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(b`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(b`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${b.float(ho)}) {
        discard;
      }
    `),h?i.code.add(b`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${b.float(ho)}, stippleCoverage);
      `):i.code.add(b`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new ir("intrinsicColor",m=>m.color)),t.output!==L.ObjectAndLayerIdColor&&i.code.add(b`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(b`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new ir("innerColor",m=>m.innerColor??m.color),new Oe("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),i.code.add(b`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(b`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Oe("falloff",m=>m.falloff)),i.code.add(b`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(b`
    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(ho)}) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Color&&t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===L.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""}
    ${t.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const sKe=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:t4,build:iKe},Symbol.toStringTag,{value:"Module"})),zX={func:Kr.LESS},r4={func:Kr.ALWAYS},Hf={mask:255},Gxe={mask:0},nKe=t=>({function:{func:Kr.NOTEQUAL,ref:t,mask:t},operation:{fail:gs.KEEP,zFail:gs.KEEP,zPass:gs.KEEP}}),oKe=t=>({function:{func:Kr.ALWAYS,ref:t,mask:t},operation:{fail:gs.KEEP,zFail:gs.KEEP,zPass:gs.REPLACE}}),W_={function:{func:Kr.ALWAYS,ref:Tl.OutlineVisualElementMask,mask:Tl.OutlineVisualElementMask},operation:{fail:gs.KEEP,zFail:gs.KEEP,zPass:gs.ZERO}},F_={function:{func:Kr.ALWAYS,ref:Tl.OutlineVisualElementMask,mask:Tl.OutlineVisualElementMask},operation:{fail:gs.KEEP,zFail:gs.KEEP,zPass:gs.REPLACE}},jxe={function:{func:Kr.EQUAL,ref:Tl.OutlineVisualElementMask,mask:Tl.OutlineVisualElementMask},operation:{fail:gs.KEEP,zFail:gs.KEEP,zPass:gs.KEEP}},Hxe={function:{func:Kr.NOTEQUAL,ref:Tl.OutlineVisualElementMask,mask:Tl.OutlineVisualElementMask},operation:{fail:gs.KEEP,zFail:gs.KEEP,zPass:gs.KEEP}},qxe=new Map([[E.POSITION,0],[E.SUBDIVISIONFACTOR,1],[E.UV0,2],[E.AUXPOS1,3],[E.AUXPOS2,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7],[E.OBJECTANDLAYERIDCOLOR,8]]);let Wxe=class Zxe extends Pr{initializeProgram(e){return new Cr(e.rctx,Zxe.shader.get().build(this.configuration),qxe)}_makePipelineState(e,r){const i=this.configuration,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:i.output===L.Color||i.output===L.Alpha?s?ou:ry(e):null,depthTest:{func:q_(e)},depthWrite:s?i.writeDepth?Al:null:OF(e),colorWrite:jt,stencilWrite:i.hasOccludees?Hf:null,stencilTest:i.hasOccludees?r?F_:W_:null,polygonOffset:s||n?i.hasPolygonOffset?zie:null:PF})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?zie:null;this._occluderPipelineTransparent=Ot({blending:ou,polygonOffset:r,depthTest:r4,depthWrite:null,colorWrite:jt,stencilWrite:null,stencilTest:Hxe}),this._occluderPipelineOpaque=Ot({blending:ou,polygonOffset:r,depthTest:r4,depthWrite:null,colorWrite:jt,stencilWrite:Gxe,stencilTest:jxe}),this._occluderPipelineMaskWrite=Ot({blending:null,polygonOffset:r,depthTest:zX,depthWrite:null,colorWrite:null,stencilWrite:Hf,stencilTest:F_})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Et.LINES:Et.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===ce.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ce.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};Wxe.shader=new Er(sKe,()=>ae(()=>import("./RibbonLine.glsl-0d91c2e5.js"),[]));const zie={factor:0,units:-4};var Wl;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Wl||(Wl={}));let i2=class extends H_{constructor(e){super(e,new lKe),this._configuration=new ki,this._vertexAttributeLocations=qxe}isClosed(e,r){return Yxe(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===ce.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==L.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&uKe(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Li.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(E.POSITION).data,l=e.vertexAttributes.get(E.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=s[0],d=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],T=h-v,x=d-w,S=a[_+3]-v,O=a[_+4]-w,C=_e((S*T+O*x)/(S*S+O*O),0,1),P=S*C-T,$=O*C-x,V=P*P+$*$;V<m&&(m=V,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!n_e(r))return void Q.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(E.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const T=a.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=_e(this.parameters.vvSize.offset[0]+T*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(E.SIZE)&&(c*=a.get(E.SIZE).data[0]);const h=i.camera,d=hKe;cn(d,i.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;se(JE[0],d[0]-f,d[1]+f,0),se(JE[1],d[0]+f,d[1]+f,0),se(JE[2],d[0]+f,d[1]-f,0),se(JE[3],d[0]-f,d[1]-f,0);for(let T=0;T<4;T++)if(!h.unprojectFromRenderScreen(JE[T],pm[T]))return;ea(h.eye,pm[0],pm[1],R8),ea(h.eye,pm[1],pm[2],P8),ea(h.eye,pm[2],pm[3],M8),ea(h.eye,pm[3],pm[0],I8);let m=Number.MAX_VALUE,y=0;const _=Xxe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let T=0;T<_;T+=3){el[0]=l[T]+r[12],el[1]=l[T+1]+r[13],el[2]=l[T+2]+r[14];const x=(T+3)%l.length;if(tl[0]=l[x]+r[12],tl[1]=l[x+1]+r[13],tl[2]=l[x+2]+r[14],fi(R8,el)<0&&fi(R8,tl)<0||fi(P8,el)<0&&fi(P8,tl)<0||fi(M8,el)<0&&fi(M8,tl)<0||fi(I8,el)<0&&fi(I8,tl)<0)continue;if(h.projectToRenderScreen(el,_v),h.projectToRenderScreen(tl,vv),_v[2]<0&&vv[2]>0){he(Tp,el,tl);const O=h.frustum,C=-fi(O[pi.NEAR],el)/me(Tp,O[pi.NEAR]);ie(Tp,Tp,C),le(el,el,Tp),h.projectToRenderScreen(el,_v)}else if(_v[2]>0&&vv[2]<0){he(Tp,tl,el);const O=h.frustum,C=-fi(O[pi.NEAR],tl)/me(Tp,O[pi.NEAR]);ie(Tp,Tp,C),le(tl,tl,Tp),h.projectToRenderScreen(tl,vv)}else if(_v[2]<0&&vv[2]<0)continue;_v[2]=0,vv[2]=0;const S=LW(bb(_v,vv,Gie),d);S<m&&(m=S,re(kie,el),re(Bie,tl),y=T/3)}const v=i.rayBegin,w=i.rayEnd;if(m<f*f){let T=Number.MAX_VALUE;if(bye(bb(kie,Bie,Gie),bb(v,w,dKe),yv)){he(yv,yv,v);const x=Ee(yv);ie(yv,yv,1/x),T=x/mi(v,w)}o(T,yv,y,!1)}}get _layout(){const e=Hi().vec3f(E.POSITION).f32(E.SUBDIVISIONFACTOR).vec2f(E.UV0).vec3f(E.AUXPOS1).vec3f(E.AUXPOS2);return this.parameters.vvSize?e.f32(E.SIZEFEATUREATTRIBUTE):e.f32(E.SIZE),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4f(E.COLOR),this.parameters.vvOpacity&&e.f32(E.OPACITYFEATUREATTRIBUTE),oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new cKe(this._layout,this.parameters)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth||r===L.ObjectAndLayerIdColor?e===ce.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Li.OccludeAndTransparentStencil?e===ce.OPAQUE_MATERIAL||e===ce.OCCLUDER_MATERIAL||e===ce.TRANSPARENT_OCCLUDER_MATERIAL:r===L.Color||r===L.Alpha?e===(this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ce.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new aKe(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},aKe=class extends G_{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(Wxe,e)}},lKe=class extends jR{constructor(){super(...arguments),this.width=0,this.color=ah,this.join="miter",this.cap=mh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},cKe=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=t4+i}}_isClosed(e){return Xxe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(E.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){var j;const o=pKe,a=fKe,l=mKe,c=i.vertexAttributes.get(E.POSITION).data,h=i.indices&&i.indices.get(E.POSITION),d=(j=i.vertexAttributes.get(E.DISTANCETOSTART))==null?void 0:j.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSize?m=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(f=i.vertexAttributes.get(E.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColor?_=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(y=i.vertexAttributes.get(E.COLOR).data);const v=oe("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacity&&(w=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const T=c.length/3,x=new Float32Array(s.buffer),S=oe("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,O=this.vertexBufferLayout.stride/4;let C=n*O;const P=C;let $=0;const V=d?(Y,M,D)=>$=d[D]:(Y,M,D)=>$+=mi(Y,M),z=oe("enable-feature:objectAndLayerId-rendering"),B=(Y,M,D,N,G,X,J)=>{if(x[C++]=M[0],x[C++]=M[1],x[C++]=M[2],x[C++]=N,x[C++]=J,x[C++]=G,x[C++]=Y[0],x[C++]=Y[1],x[C++]=Y[2],x[C++]=D[0],x[C++]=D[1],x[C++]=D[2],x[C++]=this._parameters.vvSize?m:f,this._parameters.vvColor)x[C++]=_;else{const ee=Math.min(4*X,y.length-4);x[C++]=y[ee],x[C++]=y[ee+1],x[C++]=y[ee+2],x[C++]=y[ee+3]}this._parameters.vvOpacity&&(x[C++]=w),z&&(v!=null&&(S[4*C]=v[0],S[4*C+1]=v[1],S[4*C+2]=v[2],S[4*C+3]=v[3]),C++)};C+=O,se(a,c[0],c[1],c[2]),e&&$e(a,a,e);const k=this._isClosed(i);if(k){const Y=c.length-3;se(o,c[Y],c[Y+1],c[Y+2]),e&&$e(o,o,e)}else se(l,c[3],c[4],c[5]),e&&$e(l,l,e),B(a,a,l,1,Wl.LEFT_CAP_START,0,0),B(a,a,l,1,Wl.RIGHT_CAP_START,0,0),re(o,a),re(a,l);const Z=k?0:1,W=k?T:T-1;for(let Y=Z;Y<W;Y++){const M=(Y+1)%T*3;se(l,c[M],c[M+1],c[M+2]),e&&$e(l,l,e),V(o,a,Y),B(o,a,l,0,Wl.LEFT_JOIN_END,Y,$),B(o,a,l,0,Wl.RIGHT_JOIN_END,Y,$);const D=this.numJoinSubdivisions;for(let N=0;N<D;++N){const G=(N+1)/(D+1);B(o,a,l,G,Wl.LEFT_JOIN_END,Y,$),B(o,a,l,G,Wl.RIGHT_JOIN_END,Y,$)}B(o,a,l,1,Wl.LEFT_JOIN_START,Y,$),B(o,a,l,1,Wl.RIGHT_JOIN_START,Y,$),re(o,a),re(a,l)}k?(se(l,c[3],c[4],c[5]),e&&$e(l,l,e),$=V(o,a,W),B(o,a,l,0,Wl.LEFT_JOIN_END,Z,$),B(o,a,l,0,Wl.RIGHT_JOIN_END,Z,$)):($=V(o,a,W),B(o,a,a,0,Wl.LEFT_CAP_END,W,$),B(o,a,a,0,Wl.RIGHT_CAP_END,W,$)),O8(x,P+O,x,P,O),C=O8(x,C-O,x,C,O),this._parameters.wireframe&&this._addWireframeVertices(s,P,C,O)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=O8(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function O8(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function Xxe(t,e,r){return Yxe(t,e.get(E.POSITION).data,r?r.get(E.POSITION):null)}function Yxe(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function uKe(t){return t.anchor===iw.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const el=A(),tl=A(),Tp=A(),yv=A(),hKe=A(),_v=Vo(),vv=Vo(),kie=A(),Bie=A(),Gie=cp(),dKe=cp(),pKe=A(),fKe=A(),mKe=A(),JE=[Vo(),Vo(),Vo(),Vo()],pm=[A(),A(),A(),A()],R8=Ir(),P8=Ir(),M8=Ir(),I8=Ir();let kX=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+pc()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const h=qN(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(he(Jn,e,r.vec3),Jn[0]=Math.abs(Jn[0]),Jn[1]=Math.abs(Jn[1]),Jn[2]=Math.abs(Jn[2]),Jn[0]<c&&Jn[1]<c&&Jn[2]<c){if(l){const h=Math.max(...Jn);if(he(Jn,e,l.vec3),Jn[0]=Math.abs(Jn[0]),Jn[1]=Math.abs(Jn[1]),Jn[2]=Math.abs(Jn[2]),Math.max(...Jn)<h)return l}return r}return l||(l=qN(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Ft(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new i2({width:2,color:r}),s.add(this._material);const m=new Lxe(s,{pickable:!1}),y=new iy({castShadow:!1});s.add(y),m.add(y),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&h.push(m-1,m);ai(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new Hs(this._material,[[E.POSITION,new Ve(c,3,!0)]],[[E.POSITION,h]],null,as.Line);s.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const Jn=A();let Jxe=class{constructor(e,r,i,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new lt,this.output=L.Color,this.renderOccludedMask=jie,this.bindParameters=new iF(r,i,s!=null?s.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=jie}},gKe=class extends Jxe{constructor(e,r,i,s,n){super(e,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const jie=Li.Occlude|Li.OccludeAndTransparent|Li.OccludeAndTransparentStencil;let C3=class extends lt{constructor(){super(...arguments),this._projectionMatrix=ve()}get projectionMatrix(){return this._projectionMatrix}};u([p()],C3.prototype,"_projectionMatrix",void 0),u([p({readOnly:!0})],C3.prototype,"projectionMatrix",null),C3=u([R("esri.views.3d.webgl-engine.lib.CascadeCamera")],C3);const Hie=16;function BX(t){return Math.ceil(t/Hie)*Hie}var OS;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(OS||(OS={}));let jM=class{constructor(){this.camera=new C3,this.lightMat=ve()}},yKe=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},GX=class{get depthTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return wi(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new yKe,this._projectionView=ve(),this._projectionViewInverse=ve(),this._modelViewLight=ve(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Yt(),this._cascades=[new jM,new jM,new jM,new jM],this._lastOrigin=null,this._maxTextureSize=Math.min(oe("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=Fe(this._fbo),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=_e(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)L8[e]=this._cascades[e];return L8.length=this._numCascades,L8}start(e,r,i,s,n){tt(this.enabled),this._textureSize=this._computeTextureSize(e,n,s),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,o,s),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,r);this._lastOrigin=null,this.clear()}finish(e){tt(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!na(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||A(),re(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Cl(Jie,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)Qie[16*r+i]=Jie[i]}}return Qie}takeCascadeSnapshotTo(e,r){tt(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,Ct.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(os.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,Ct.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(xi.COLOR_BUFFER_BIT|xi.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r,i){const s=Math.min(window.devicePixelRatio,r)/e.pixelRatio,n=Math.max(e.fullWidth,e.fullHeight)*s,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,BX((this.numCascades===1?1:2)*n*o)))}_ensureDepthTexture(){var r,i;if(((r=this._fbo)==null?void 0:r.width)===this._textureSize)return;const e=new vr(this._textureSize);e.wrapMode=Dt.CLAMP_TO_EDGE,e.samplingMode=At.NEAREST,(i=this._fbo)==null||i.dispose(),this._fbo=new on(this._rctx,e,new wN(Bs.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let r=this._snapshots[e];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i=new vr;return i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new Ct(this._rctx,i),this._snapshots[e]=r,r}_discardSnapshot(e){this._snapshots[e]=Fe(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);tt(l<c);for(let m=0;m<8;++m){wi(qie,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=Xu[m];eu(y,qie,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}aa($8,Xu[0]),n.camera.viewMatrix=Cl(_Ke,this._modelViewLight,$8);for(let m=0;m<8;++m)$e(Xu[m],Xu[m],n.camera.viewMatrix);let h=Xu[0][2],d=Xu[0][2];for(let m=1;m<8;++m)h=Math.min(h,Xu[m][2]),d=Math.max(d,Xu[m][2]);h-=200,d+=200,n.camera.near=-d,n.camera.far=-h,xKe(i,s,h,d,n.camera),ni(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/(this.numCascades===1?1:2);n.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,r){ni(this._projectionView,e.projectionMatrix,e.viewMatrix),xn(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Le.Global?e.eye:se($8,0,0,1);L5(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(Sze(e/r,4)),s);const n=(e-r)/this._numCascades,o=(e/r)**(1/this._numCascades);let a=r,l=r;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=xt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get gpuMemoryUsage(){var e;return this._snapshots.reduce((r,i)=>r+((i==null?void 0:i.gpuMemoryUsage)??0),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const _Ke=ve(),qie=Yt(),Xu=[];for(let t=0;t<8;++t)Xu.push(Yt());const Wie=Ue(),Zie=Ue(),vKe=Ue(),Xie=Ue(),Yie=Ue(),$8=A(),L8=[],Jie=ve(),Qie=new Array(64),Rc=Ue(),ax=Ue(),bv=[Ue(),Ue(),Ue(),Ue()],hn=Ue(),D8=Ue(),Ry=Ue(),QE=Ue(),lx=Ue(),cx=Ue(),HM=Ue();function bKe(t,e,r,i,s,n,o,a){nr(Rc,0,0);for(let O=0;O<4;++O)Cd(Rc,Rc,t[O]);oc(Rc,Rc,.25),nr(ax,0,0);for(let O=4;O<8;++O)Cd(ax,ax,t[O]);oc(ax,ax,.25),eh(bv[0],t[4],t[5],.5),eh(bv[1],t[5],t[6],.5),eh(bv[2],t[6],t[7],.5),eh(bv[3],t[7],t[4],.5);let l=0,c=mN(bv[0],Rc);for(let O=1;O<4;++O){const C=mN(bv[O],Rc);C<c&&(c=C,l=O)}pf(hn,bv[l],t[l+4]);const h=hn[0];let d,f;hn[0]=-hn[1],hn[1]=h,pf(D8,ax,Rc),Js(D8,hn)<0&&KW(hn,hn),eh(hn,hn,D8,r),PO(hn,hn),d=f=Js(pf(Ry,t[0],Rc),hn);for(let O=1;O<8;++O){const C=Js(pf(Ry,t[O],Rc),hn);C<d?d=C:C>f&&(f=C)}cn(i,Rc),oc(Ry,hn,d-e),Cd(i,i,Ry);let m=-1,y=1,_=0,v=0;for(let O=0;O<8;++O){pf(QE,t[O],i),PO(QE,QE);const C=hn[0]*QE[1]-hn[1]*QE[0];C>0?C>m&&(m=C,_=O):C<y&&(y=C,v=O)}Bw(m>0,"leftArea"),Bw(y<0,"rightArea"),oc(lx,hn,d),Cd(lx,lx,Rc),oc(cx,hn,f),Cd(cx,cx,Rc),HM[0]=-hn[1],HM[1]=hn[0];const w=YP(i,t[v],cx,Cd(Ry,cx,HM),1,s),T=YP(i,t[_],cx,Ry,1,n),x=YP(i,t[_],lx,Cd(Ry,lx,HM),1,o),S=YP(i,t[v],lx,Ry,1,a);Bw(w,"rayRay"),Bw(T,"rayRay"),Bw(x,"rayRay"),Bw(S,"rayRay")}function mr(t,e){return 3*e+t}const Kie=Ue();function Il(t,e){return nr(Kie,t[e],t[e+3]),Kie}const rl=Ue(),We=Fi();function wKe(t,e,r,i,s){pf(rl,r,i),oc(rl,rl,.5),We[0]=rl[0],We[1]=rl[1],We[2]=0,We[3]=rl[1],We[4]=-rl[0],We[5]=0,We[6]=rl[0]*rl[0]+rl[1]*rl[1],We[7]=rl[0]*rl[1]-rl[1]*rl[0],We[8]=1,We[mr(0,2)]=-Js(Il(We,0),t),We[mr(1,2)]=-Js(Il(We,1),t);let n=Js(Il(We,0),r)+We[mr(0,2)],o=Js(Il(We,1),r)+We[mr(1,2)],a=Js(Il(We,0),i)+We[mr(0,2)],l=Js(Il(We,1),i)+We[mr(1,2)];n=-(n+a)/(o+l),We[mr(0,0)]+=We[mr(1,0)]*n,We[mr(0,1)]+=We[mr(1,1)]*n,We[mr(0,2)]+=We[mr(1,2)]*n,n=1/(Js(Il(We,0),r)+We[mr(0,2)]),o=1/(Js(Il(We,1),r)+We[mr(1,2)]),We[mr(0,0)]*=n,We[mr(0,1)]*=n,We[mr(0,2)]*=n,We[mr(1,0)]*=o,We[mr(1,1)]*=o,We[mr(1,2)]*=o,We[mr(2,0)]=We[mr(1,0)],We[mr(2,1)]=We[mr(1,1)],We[mr(2,2)]=We[mr(1,2)],We[mr(1,2)]+=1,n=Js(Il(We,1),e)+We[mr(1,2)],o=Js(Il(We,2),e)+We[mr(2,2)],a=Js(Il(We,1),r)+We[mr(1,2)],l=Js(Il(We,2),r)+We[mr(2,2)],n=-.5*(n/o+a/l),We[mr(1,0)]+=We[mr(2,0)]*n,We[mr(1,1)]+=We[mr(2,1)]*n,We[mr(1,2)]+=We[mr(2,2)]*n,n=Js(Il(We,1),e)+We[mr(1,2)],o=Js(Il(We,2),e)+We[mr(2,2)],a=-o/n,We[mr(1,0)]*=a,We[mr(1,1)]*=a,We[mr(1,2)]*=a,s[0]=We[0],s[1]=We[1],s[2]=0,s[3]=We[2],s[4]=We[3],s[5]=We[4],s[6]=0,s[7]=We[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=We[6],s[13]=We[7],s[14]=0,s[15]=We[8]}function xKe(t,e,r,i,s){const n=1/Xu[0][3],o=1/Xu[4][3];tt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Sn(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,bKe(Xu,a,l,Wie,Zie,vKe,Xie,Yie),wKe(Wie,Zie,Xie,Yie,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function TKe(t){return hp(t)&&t.intersector===Gi.TERRAIN&&!!t.target}let SKe=class extends fF{constructor(e,r,i){super(e,r),this.triangleNr=i}};function Qxe(t){return hp(t)&&t.intersector===Gi.OVERLAY&&!!t.target}let sG=class{constructor(){this.adds=new Gt,this.removes=new Gt,this.updates=new Gt({allocator:e=>e||new EKe,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},EKe=class{},CKe=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Wi,gn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Wi||(Wi={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(gn||(gn={}));function Kxe(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new CKe,e.set(i,s)),s};return t.removes.forAll(i=>{N8(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{N8(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{N8(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function N8(t){return t.geometry.indexCount>=1}let eTe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===gg.LOADED)return s;this._repository.requestRender()}return null}};function XR(t,e){switch(e.normalType){case Or.Compressed:t.attributes.add(E.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(b`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Or.Attribute:t.attributes.add(E.NORMAL,"vec3"),t.vertex.code.add(b`vec3 normalModel() {
return normal;
}`);break;case Or.ScreenDerivative:t.fragment.code.add(b`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Or.COUNT:case Or.Ground:}}var Or;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Or||(Or={}));function GF(t,e){switch(e.normalType){case Or.Attribute:case Or.Compressed:t.include(XR,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new MO("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new $h("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(b`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Or.Ground:t.include(_2,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(b`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?b`normalize(vPositionWorldCameraRelative);`:b`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Or.ScreenDerivative:t.vertex.code.add(b`void forwardNormal() {}`);break;default:e.normalType;case Or.COUNT:}}let tTe=class extends nve{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Fi()}},rTe=class extends ove{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Fi(),this.toMapSpace=Yt()}},nG=class extends rTe{constructor(e=A()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},hE=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(E.POSITION).length}write(e,r,i,s,n){Abe(i,this.vertexBufferLayout,e,r,s,n)}};const AKe=Hi().vec3f(E.POSITION),OKe=Hi().vec3f(E.POSITION).vec2f(E.UV0),RKe=Hi().vec3f(E.POSITION).vec4u8(E.COLOR);Hi().vec3f(E.POSITION).vec4u8(E.OBJECTANDLAYERIDCOLOR);const PKe=Hi().vec3f(E.POSITION).vec2f(E.UV0).vec4u8(E.OBJECTANDLAYERIDCOLOR);Hi().vec3f(E.POSITION).vec4u8(E.COLOR).vec4u8(E.OBJECTANDLAYERIDCOLOR);let jX=class extends H_{intersect(e,r,i,s,n,o){return mbe(e,i,s,n,void 0,o)}};function MKe(t){t.fragment.code.add(b`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function IKe(t){t.fragment.code.add(b`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}let YR=class extends cs{constructor(e,r){super(e,"int",Qr.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}},$Ke=class extends cs{constructor(e,r,i){super(e,"mat4",Qr.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,r(n,o,a)),i)}},LKe=class extends cs{constructor(e,r,i){super(e,"mat4",Qr.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},DKe=class extends ei{constructor(){super(...arguments),this.origin=A()}},NKe=class extends DKe{},FKe=class extends ei{constructor(){super(...arguments),this.modelTransformation=nn}},HX=class extends FKe{constructor(){super(...arguments),this.origin=A()}};function jF(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new LKe("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),iTe(t))}function sw(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new $Ke("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),iTe(t))}function iTe(t){const e=t.fragment;e.include(Tc),e.uniforms.add(new Je("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new YR("numCascades",(r,i)=>i.shadowMap.numCascades),new ir("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(b`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function ese(t){t.fragment.uniforms.add(new Je("texWaveNormal",e=>e.waveNormal),new Je("texWavePerturbation",e=>e.wavePertubation),new ir("waveParams",e=>wi(UKe,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Sr("waveDirection",e=>nr(VKe,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(MKe),t.fragment.code.add(b`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const UKe=Yt(),VKe=Ue();function qO(t,e){e.spherical?t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function zKe(t){const e=t.fragment.code;e.add(b`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(b`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(b`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function qX(t,e){const r=t.fragment.code;t.include(MR),e.pbrMode!==rt.Normal&&e.pbrMode!==rt.Schematic&&e.pbrMode!==rt.Terrain&&e.pbrMode!==rt.TerrainWithWater||(r.add(b`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(b`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==rt.Normal&&e.pbrMode!==rt.Schematic||(t.include(zKe),r.add(b`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(b`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(b`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(b`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function kKe(t,e){const r=t.fragment.code;t.include(MR),r.add(b`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(b`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(b`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(b`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(b`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function sTe(t,e){t.include(kKe,e),t.include(K5),t.include(IKe),e.hasCloudsReflections&&t.include(A_e,e),e.hasScreenSpaceReflections&&t.include(lBe,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(b`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Oe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Oe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(b`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new Ni("view",(i,s)=>s.ssr.camera.viewMatrix),new Je("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new Oe("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(b`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(b`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(b`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor;
}`)}function BKe(t){const e=new wr,{vertex:r,fragment:i}=e;gc(r,t),e.include(wl,t),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.UV0,"vec2");const s=new ir("waterColor",n=>n.color);if(t.output===L.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(ho)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(b`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==L.Color&&t.output!==L.Alpha||(e.include(qO,t),e.include(iE,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(ho)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===L.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(mu,t),t.output){case L.Alpha:e.include(ms,t),i.uniforms.add(s),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case L.Color:e.include(gN),e.include(cZ,{pbrMode:rt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(ese),e.include(ms,t),e.include(sw,t),e.include(sTe,t),i.uniforms.add(s,new Oe("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),ap(i,t),i.include(rm),Wg(i),tm(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?b`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case L.Normal:e.include(qO,t),e.include(ese,t),e.include(ms,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(ho)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Oe("timeElapsed",n=>n.timeElapsed)),i.code.add(b`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case L.Highlight:e.include(ty,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(ho)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(ms,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case L.ObjectAndLayerIdColor:e.include(BR,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(ho)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(ms,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const GKe=Object.freeze(Object.defineProperty({__proto__:null,build:BKe},Symbol.toStringTag,{value:"Module"}));let nTe=class oTe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Le.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Cr(e.rctx,oTe.shader.get().build(this.configuration),br)}_setPipelineState(e){const r=this.configuration,i=e===st.NONE,s=e===st.FrontFace;return Ot({blending:r.output!==L.Normal&&r.output!==L.Highlight&&r.output!==L.ObjectAndLayerIdColor&&r.transparent?i?ou:ry(e):null,depthTest:{func:q_(e)},depthWrite:i?r.writeDepth?Al:null:OF(e),colorWrite:jt,polygonOffset:i||s?null:MF(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};nTe.shader=new Er(GKe,()=>ae(()=>import("./WaterSurface.glsl-816429a6.js"),[]));let Rn=class extends No{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=st.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([F({count:L.COUNT})],Rn.prototype,"output",void 0),u([F({count:st.COUNT})],Rn.prototype,"transparencyPassType",void 0),u([F()],Rn.prototype,"spherical",void 0),u([F()],Rn.prototype,"receiveShadows",void 0),u([F()],Rn.prototype,"hasSlicePlane",void 0),u([F()],Rn.prototype,"transparent",void 0),u([F()],Rn.prototype,"enableOffset",void 0),u([F()],Rn.prototype,"writeDepth",void 0),u([F()],Rn.prototype,"hasScreenSpaceReflections",void 0),u([F()],Rn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],Rn.prototype,"hasCloudsReflections",void 0),u([F()],Rn.prototype,"objectAndLayerIdColorInstanced",void 0),u([F()],Rn.prototype,"isDraped",void 0),u([F()],Rn.prototype,"hasMultipassTerrain",void 0),u([F()],Rn.prototype,"cullAboveGround",void 0),u([F({constValue:rt.Water})],Rn.prototype,"pbrMode",void 0),u([F({constValue:!0})],Rn.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!0})],Rn.prototype,"highStepCount",void 0),u([F({constValue:!1})],Rn.prototype,"useFillLights",void 0);let jKe=class extends G_{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===L.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(nTe,e)}},aTe=class extends jX{constructor(e){super(e,new lTe),this._configuration=new Rn,this.animation=new Lve}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<RF,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<HKe;const i=this.animation.advance(e);return this.setParameters({timeElapsed:jH(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case L.Normal:return e===ce.DRAPED_WATER;case L.Color:if(this.parameters.isDraped)return e===ce.DRAPED_MATERIAL;break;case L.Alpha:break;case L.Highlight:case L.ObjectAndLayerIdColor:return e===ce.OPAQUE_MATERIAL||e===ce.DRAPED_MATERIAL;default:return!1}let i=ce.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new jKe(e)}createBufferWriter(){return new hE(oe("enable-feature:objectAndLayerId-rendering")?PKe:OKe)}},lTe=class extends cX{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=ur(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Ft(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=A(),this.modelTransformation=null}};const HKe=35e3;let WX=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function tse(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const s=e.get(i.to);s&&(i.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0)})}let rse=class extends WX{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},qKe=class{constructor(){this.first=0,this.count=0}},WKe=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Gt({allocator:e=>e||new WX,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=qM(),this.drawCommandsHighlight=qM(),this.drawCommandsOccludees=qM(),this.drawCommandsShadowHighlightRest=qM()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(ise(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),ise(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function ZKe(t){return t.vao!=null}function qM(){return new Gt({allocator:t=>t||new qKe,deallocator:t=>t})}function ise(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(XKe(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function XKe(t,e){return t.first+t.count>=e.from}let YKe=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const EL=-3;var sg;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(sg||(sg={}));let JKe=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=QKe+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this,e,r,i,s)}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},cTe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Gt,this._users=new Gt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,r,i,s,n){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,sg.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,sg.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return void console.warn("Refusing to cache entry with invalid size "+s);const a=1+Math.max(n,EL)-EL;this._db.set(r,{entry:i,size:s,lifetime:a,lives:a}),this._size+=s,e.size+=s,this._checkSizeLimits()}updateSize(e,r,i,s){r=e.id+r;const n=this._db.get(r);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(r,i,sg.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSizeLimits()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:d}=c;if(a.startsWith(h)){const f=r[d]||0;r[d]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+EL-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,s)=>{s.startsWith(r)&&(this._size-=i.size,this._db.delete(s),this._notifyRemove(s,i.entry,sg.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,sg.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,r]of this._db)if(this._purgeItem(e,r),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[r,i]of this._db)if(r.startsWith(e.id)&&(this._purgeItem(r,i,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,r,i=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const s=this._notifyRemove(e,r.entry,sg.SOME);s!=null&&s>0&&(this._size+=s,i&&(i.size+=s),r.lives=r.lifetime,r.size=s,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},QKe=0;const KKe=EL+1;let eet=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache("VaoCache",tet)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(i!=null){const n=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,KKe),n}const s=new up(this._rctx,this._locations,{geometry:this._layout},{geometry:Lr.createVertex(this._rctx,Tr.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(e==null)return null;const r=e.byteSize,i=r.toString(),s=this._cache.pop(i);return s!=null?(s.push(e),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[e],r,-1),null}};function tet(t,e){if(e===sg.ALL)return void t.forEach(s=>s.dispose());const r=t.pop(),i=t.length*r.byteSize;return r.dispose(),i}let uTe=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new eTe(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new eet(e,i.vertexAttributeLocations,Sc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof aTe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Li.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(gn.GEOMETRY|gn.TRANSFORMATION)){const c=YM(r.elementCount(l.geometry.geometry)*i),h=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),JM()}s.updateType&(gn.HIGHLIGHT|gn.OCCLUDEE|gn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new nE;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new sse(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new sse(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),h=c!=null?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void tt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),iO(d.buffers,m),void(d.buffers.length===0&&h.length===0&&s.delete(l));const y=m.numElements,_=m.vao.byteSize/4,v=h.reduce((S,O)=>S+i.elementCount(O.geometry),0),w=f.changes.reduce((S,O)=>S+i.elementCount(O.geometry),0),T=Math.min((y+v-w)*n,XM),x=T>_;T>i4&&T<_/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(m.vao),iO(d.buffers,m)):x?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(d==null&&(d=new YKe(c.origin),s.set(l,d)),d.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)d.buffers.push(this._applyAndRebuild(new WKe,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,Lo(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const y of i.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(XM/o);let l=e.numElements;for(;r.length>0;){const y=r.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const v=new rse(y,0,0);tt(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,h=YM(c),d=s.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,d,f);const v=f;f+=s.elementCount(y.geometry.geometry),e.updateInstance(_,v,f),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(ase(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),JM(),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=Sp.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const d=Sp.pushNew();d.from=c.from,d.to=c.to}tse(Sp);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=Sp.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=YM(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Sp.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),JM(),e.holes.pushArray(Sp.data,Sp.length),Sp.forAll((a,l)=>Sp.data[l]=null),Sp.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!ZKe(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((w,T)=>w+i.elementCount(T.geometry),0),a=Math.min((n+o)*s,XM),l=4*a;if(e.vao.byteSize<ase(XM-i4)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);tse(e.holes);const c=new Array;for(const w of r){const T=i.elementCount(w.geometry),x=ret(e.holes,T);c.push(x)}const h=e.vao.vertexBuffers.geometry;let d=0,f=0,m=0;const y=YM(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((w,T)=>{const x=c[T];if(x==null)return;if(m!==x){const C=m-f;C>0&&h.setSubData(y,f*s,0,C*s),f=x,d=0}const S=i.elementCount(w.geometry);this._writeGeometry(w,_,d),d+=S,m=x+S;const O=new rse(w,x,x+S);tt(e.instances.get(w.id)==null),e.addInstance(w.id,O),e.drawCommandsDirty=!0});const v=m-f;v>0&&h.setSubData(y,f*s,0,v*s),XOe(r,(w,T)=>c[T]==null),JM()}_writeGeometry(e,r,i){const s=e.localOrigin.vec3;Eze(nse,-s[0],-s[1],-s[2]);const n=ni(iet,nse,e.transformation);xn(WM,n),bc(WM,WM),this._bufferWriter.write(n,WM,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}prepareTechnique(e){const{output:r,bindParameters:i}=e;if(!this.requiresSlot(i.slot,r))return null;const s=r===L.Highlight||r===L.ShadowHighlight;if(s&&!this._hasHighlights)return null;const n=r===L.ShadowExcludeHighlight,o=!(s||n);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(s&&!l.hasHighlights)continue;const c=(s?l.drawCommandsHighlight:n&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,h=o&&l.drawCommandsOccludees||null;if(c!=null&&c.length||h!=null&&h.length){const d=this._glMaterials.load(e.rctx,i.slot,r),f=d!=null?d.beginSlot(i):null;if(f!=null)return f}}return null}render(e,r){var c;const{output:i,bindParameters:s}=e,n=i===L.Highlight||i===L.ShadowHighlight,o=i===L.ShadowExcludeHighlight,a=!(n||o),l=this._rctx;(c=l.appleAmdDriverHelper)==null||c.resetIndicesType(),l.bindTechnique(r,this.material.parameters,s);for(const h of this._dataByOrigin.values())for(const d of h.buffers){if(n&&!d.hasHighlights)continue;const f=(n?d.drawCommandsHighlight:o&&d.needsMultipleCommands()?d.drawCommandsShadowHighlightRest:d.drawCommandsDefault)||null,m=a&&d.drawCommandsOccludees||null;(f!=null&&f.length||m!=null&&m.length)&&(r.program.bindDraw(new nG(h.origin),s,this.material.parameters),r.ensureAttributeLocations(d.vao),l.bindVAO(d.vao),f!=null&&f.length&&(r.bindPipelineState(l,s.slot,!1),f.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))),m!=null&&m.length&&(r.bindPipelineState(l,s.slot,!0),m.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},sse=class{constructor(e){this.origin=e,this.changes=new Array}};function ret(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const nse=ve(),iet=ve(),WM=ve(),Sp=new Gt({allocator:t=>t||new WX,deallocator:null}),i4=65536,ZM=4*i4,ose=1024,hTe=16777216,XM=hTe/4;let CL=new Float32Array(i4);function YM(t){return CL.length<t&&(CL=new Float32Array(t)),CL}function ase(t){const e=4*t;return e<=ose?ose:e<ZM?ZM:Math.max(Math.min(Math.ceil(1.5*e/ZM)*ZM,hTe),e)}function JM(){CL=new Float32Array(2)}let zc=class extends xe{constructor(e){super(e),this._pending=new set,this._changes=new sG,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Gt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Lo(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Kxe(this._changes);let r=!1,i=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new uTe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,s=!0),!a)return;const l=i||a.hasHighlights,c=s||a.hasWater;a.modify(n),i=i||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Lo(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=Lo(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===Wi.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===Wi.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case gn.TRANSFORMATION:case gn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case gn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{if(r.material.shouldRender(e)){const i=r.prepareTechnique(e);i!=null&&r.render(e,i)}})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const s=i.material.renderPriority-r.material.renderPriority;return s!==0?s:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],F8[0]=i[0]-s,F8[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,F8,(l,c,h)=>{net(r,h,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([p()],zc.prototype,"drapeSource",void 0),u([p()],zc.prototype,"updating",null),u([p()],zc.prototype,"rctx",null),u([p()],zc.prototype,"rendererContext",void 0),u([p()],zc.prototype,"_materialRepository",null),u([p()],zc.prototype,"_localOriginFactory",null),u([p({readOnly:!0})],zc.prototype,"isEmpty",null),u([p()],zc.prototype,"_materialRenderers",void 0),u([p()],zc.prototype,"_geometries",void 0),zc=u([R("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],zc);let set=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function net(t,e,r,i,s,n,o){const a=new SKe(n,o,e),l=c=>{c.set(Gi.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==go.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===go.ALL){const c=LZ(s.ray);l(c),s.results.all.push(c)}}const F8=Ue();let ZX=class extends cs{constructor(e,r){super(e,"vec2",Qr.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}};const U8=4;function oet(){const t=new wr,e=t.fragment;t.include(Ih);const r=(U8+1)/2,i=1/(2*r*r);return e.include(fu),e.uniforms.add(new Je("depthMap",s=>s.depthTexture),new ph("tex",s=>s.colorTexture),new ZX("blurSize",s=>s.blurSize),new Oe("projScale",(s,n)=>{const o=mi(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new Sr("nearFar",(s,n)=>n.camera.nearFar)),e.code.add(b`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${b.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(b`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${b.int(U8)}; r <= ${b.int(U8)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const aet=Object.freeze(Object.defineProperty({__proto__:null,build:oet},Symbol.toStringTag,{value:"Module"}));let dTe=class pTe extends Pr{initializeProgram(e){return new Cr(e.rctx,pTe.shader.get().build(),br)}initializePipeline(){return Ot({colorWrite:jt})}};dTe.shader=new Er(aet,()=>ae(()=>import("./SSAOBlur.glsl-4166c726.js"),[]));const cet="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function HF(t){t.fragment.uniforms.add(new ir("projInfo",(e,r)=>uet(r))),t.fragment.uniforms.add(new Sr("zScale",(e,r)=>fTe(r))),t.fragment.code.add(b`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function uet(t){const e=t.camera.projectionMatrix;return e[11]===0?wi(lse,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):wi(lse,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const lse=Yt();function fTe(t){return t.camera.projectionMatrix[11]===0?nr(cse,0,1):nr(cse,1,0)}const cse=Ue(),use=16;function het(){const t=new wr,e=t.fragment;return t.include(Ih),e.include(fu),t.include(HF),e.uniforms.add(new Oe("radius",(r,i)=>XX(i.camera))),e.code.add(b`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(b`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Sr("nearFar",(r,i)=>i.camera.nearFar),new Je("normalMap",r=>r.normalTexture),new Je("depthMap",r=>r.depthTexture),new Sr("zScale",(r,i)=>fTe(i)),new Oe("projScale",r=>r.projScale),new Je("rnm",r=>r.noiseTexture),new Sr("rnmScale",(r,i)=>nr(hse,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Oe("intensity",r=>r.intensity),new Sr("screenSize",(r,i)=>nr(hse,i.camera.fullWidth,i.camera.fullHeight))),e.code.add(b`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${b.int(use)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${b.int(use)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function XX(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const hse=Ue(),det=Object.freeze(Object.defineProperty({__proto__:null,build:het,getRadius:XX},Symbol.toStringTag,{value:"Module"}));let mTe=class gTe extends Pr{initializeProgram(e){return new Cr(e.rctx,gTe.shader.get().build(),br)}initializePipeline(){return Ot({colorWrite:jt})}};mTe.shader=new Er(det,()=>ae(()=>import("./SSAO.glsl-00e38e30.js"),[]));let pet=class extends ei{constructor(){super(...arguments),this.projScale=1}},fet=class extends pet{constructor(){super(...arguments),this.intensity=1}},met=class extends ei{},get=class extends met{constructor(){super(...arguments),this.blurSize=Ue()}};const A3=2;let yTe=class{constructor(e,r,i,s){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new fet,this._drawParameters=new get}dispose(){this.enabled=!1,this._quadVAO=Fe(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){var e,r;(e=this._ssaoFBO)==null||e.resize(0,0),(r=this._blurFBO)==null||r.resize(0,0)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){var e;return(e=this._ssaoFBO)==null?void 0:e.colorTexture}render(e,r,i,s){if(this._enableTime==null||i==null||s==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*yet/XX(o)**6*l;const c=o.fullViewport,h=c[2],d=c[3],f=h/A3,m=d/A3;this._ssaoFBO.resize(h,d),this._blurFBO.resize(f,m),this._quadVAO==null&&(this._quadVAO=Ol(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,d),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const y=Do(this._quadVAO,"geometry");n.drawArrays(Et.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,nr(this._drawParameters.blurSize,0,A3/d),_.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(Et.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,d),n.setClearColor(1,1,1,0),n.clear(xi.COLOR_BUFFER_BIT),n.setViewport(0,0,f,m),this._drawParameters.colorTexture=this._blurFBO.colorTexture,nr(this._drawParameters.blurSize,A3/h,0),_.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(Et.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new vr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._ssaoFBO=new on(this._rctx,e),this._blurFBO=new on(this._rctx,e);const r=Uint8Array.from(atob(cet),i=>i.charCodeAt(0));e.pixelFormat=St.RGB,e.wrapMode=Dt.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new Ct(this._rctx,e,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(mTe)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(dTe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=Fe(this._passParameters.noiseTexture),this._blurFBO=Fe(this._blurFBO),this._ssaoFBO=Fe(this._ssaoFBO)}get gpuMemoryUsage(){var e,r;return(((e=this._blurFBO)==null?void 0:e.gpuMemoryUsage)??0)+(((r=this._ssaoFBO)==null?void 0:r.gpuMemoryUsage)??0)}};const yet=.5;let YX=class _Te extends Pr{initializeProgram(e){return new Cr(e.rctx,_Te.shader.get().build(),br)}initializePipeline(){return this.configuration.hasAlpha?Ot({blending:bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt}):Ot({colorWrite:jt})}};YX.shader=new Er(LQe,()=>ae(()=>import("./TextureOnly.glsl-5468875a.js"),[]));let JX=class extends ha{constructor(){super(...arguments),this.hasAlpha=!1}};u([F()],JX.prototype,"hasAlpha",void 0);let Zp=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Mi,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Gt,this._passParameters=new Rxe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new lt,this.worldToPCSRatio=1,this.events=new Ls,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:i,markerTextureRepository:s}=e;this._shaderTechniqueRepository=new Pxe({rctx:this._rctx,viewingMode:Le.Local,stippleTextureRepository:i,markerTextureRepository:s,waterTextureRepository:r}),this._renderContext=new Jxe(this._rctx,new GX(this._rctx,this.view.state.viewingMode),new yTe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ue(()=>r.updating,()=>this.events.emit("content-changed"),As),ue(()=>this.spatialReference,n=>this._localOriginFactory=new kX(n),As),Ga(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new Mxe(e.textureRepository,this._shaderTechniqueRepository,n=>{(n.renderOccluded&s4)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ce.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=S_e(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=st.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new yZ(Ae(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(pt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Bi(this._debugTextureTechnique),this._passParameters.texture=Fe(this._passParameters.texture),this._bindParameters.highlightDepthTexture=Fe(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Pe(this._shaderTechniqueRepository),this._temporaryFBO=Fe(this._temporaryFBO),this._quadVAO=Fe(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||Lo(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,zc)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ue(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const r=MRe();if(this._overlayRenderTarget!=null)for(const i of this._overlayRenderTarget.renderTargets){const s=this.overlays[$i.INNER].validTargets[i.type];e=this._overlayRenderTarget.validateUsageForTarget(s,i,r)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=b$(e,i=>i.drapeTargetType===tG.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=b$(e,i=>i.drapeSourceType===UA.Features),r.hasDrapedRasterSource=b$(e,i=>i.drapeSourceType===UA.RasterImage)})}ensureOverlays(e,r){this._overlays==null&&(this._overlayRenderTarget=new MQe(this._rctx),this._overlays=[new jre($i.INNER,this._overlayRenderTarget),new jre($i.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Fe(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Va,e=>e.updatePolicy===d_.SYNC)}get isEmpty(){return!oi.OVERLAY_DRAW_DEBUG_TEXTURE&&!Lo(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const s=e.canvasGeometries;if(s.numViews===0)return!1;const{alignPixelEnabled:n,contentPixelRatio:o}=i;this._screenToWorldRatio=o*e.mapUnitsPerPixel/nX;const a=r.output;if(this.isEmpty||a===L.Highlight&&!this.hasHighlights||a===L.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=r.fbo;if(!l.isValid())return!1;const c=2*e.resolution,h=e.resolution;l.resize(c,h);const d=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===L.Normal?ce.DRAPED_WATER:ce.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(d),e.index===$i.INNER&&(d.setClearColor(0,0,0,0),d.clearSafe(xi.COLOR_BUFFER_BIT)),r.type===ss.Occluded&&(this._renderContext.renderOccludedMask=s4),oi.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==ss.Occluded)for(let f=0;f<s.numViews;f++)this._setViewParameters(s.extents[f],e),this._drawDebugTexture(e.resolution,vet[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:f,renderer:m})=>{if(r.type===ss.ColorNoRasterImage&&f.drapeSourceType===UA.RasterImage)return;const{fullOpacity:y}=f,_=y!=null&&y<1&&a===L.Color;_&&(this.bindTemporaryFramebuffer(this._rctx,c,h),d.clearSafe(xi.COLOR_BUFFER_BIT));for(let v=0;v<s.numViews;v++)this._setViewParameters(s.extents[v],e),m.render(this._renderContext);_&&this._temporaryFBO!=null&&(l.bind(d),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),y,e.index))}),d.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){this._temporaryFBO==null&&(this._temporaryFBO=new Oxe(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){var o;let n=0;for(const a of this._renderers.values())n=((o=a.intersect)==null?void 0:o.call(a,e,r,i,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,o=this._renderers.size*(i.renderGroup??(n?KN.MapLayer:KN.ViewLayer))+(n?s:0);this._sortedRenderers.push(new _et(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],wge(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),CR(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Lo(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Lo(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Lo(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(Et.TRIANGLE_STRIP,0,Do(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r){if(se(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>e-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}const n=new vr(e);n.samplingMode=At.NEAREST,this._passParameters.texture=new Ct(this._rctx,n,i);const o=new JX;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(YX,o),this._quadVAO=Ol(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([p()],Zp.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([p({autoDestroy:!0})],Zp.prototype,"_shaderTechniqueRepository",void 0),u([p({constructOnly:!0})],Zp.prototype,"view",void 0),u([p()],Zp.prototype,"worldToPCSRatio",void 0),u([p()],Zp.prototype,"spatialReference",void 0),u([p({type:Boolean,readOnly:!0})],Zp.prototype,"updating",null),u([p()],Zp.prototype,"isEmpty",null),Zp=u([R("esri.views.3d.terrain.OverlayRenderer")],Zp);let _et=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const vet=[[1,.5,.5],[.5,.5,1]],QX=-2,s4=Li.OccludeAndTransparent;function KX(t,e,r,i){const s=ZR(t.rings,!!t.hasZ,jf.CCW_IS_HOLE),n=zo(s.position.length),o=Pwe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new xet(s.position,n,wTe(s.polygons,s.position,n),bTe(s.outlines,s.position,n),a,o)}function vTe(t,e){const r=ZR(t.rings,!1,jf.CCW_IS_HOLE),i=ai(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=QX;return{position:r.position,polygons:wTe(r.polygons,r.position),outlines:bTe(r.outlines,r.position),projectionSuccess:i}}function bTe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new xTe(i,s,fh(e,n,o),fh(r,n,o)):new eY(i,s,fh(e,n,o))})}function wTe(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),d=r!=null?new bet(s,n,fh(e,3*s,3*n),fh(r,l,c),h,a):new wet(s,n,fh(e,3*s,3*n),h,a);i.push(d)}return i}let eY=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},xTe=class extends eY{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},bet=class extends xTe{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},wet=class extends eY{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},xet=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function nw(t,e,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=dse(c),t[d+1]=dse(h)}function Tet(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let s=0;s<e;++s)nw(r,s,t[i++],t[i++],t[i++]);return r}function Eet(t,e,r,i=2){const s=r*i,n=pse(e[s]),o=pse(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),ge(t,t)}function dse(t){return _e(Math.round(32767*t),-32767,32767)}function pse(t){return _e(t/32767,-1,1)}function TTe(t,e){const r=t.fragment;switch(r.code.add(b`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Ki.None:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Ki.View:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Ki.WindingOrder:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Ki.COUNT:}}var Ki;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Ki||(Ki={}));function STe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||na(n,Ba))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const qF=[1,1,.5],tY=[0,.6,.2],Cet=[0,1,.2];function ETe(t){t.vertex.code.add(b`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let Aet=class extends ha{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function CTe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(E.MODELORIGINHI,"vec3"),t.attributes.add(E.MODELORIGINLO,"vec3"),t.attributes.add(E.MODEL,"mat3"),t.attributes.add(E.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(SN,e),r.uniforms.add(new nu("viewOriginHi",(i,s)=>r7e(se(QM,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),QM)),new nu("viewOriginLo",(i,s)=>i7e(se(QM,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),QM)))),r.code.add(b`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(b`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?b`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(b`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===L.Normal&&(vS(r),r.code.add(b`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(b`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([F()],Aet.prototype,"instancedDoublePrecision",void 0);const QM=A();var Us;function ATe(t){switch(t){case"multiply":default:return Us.Multiply;case"ignore":return Us.Ignore;case"replace":return Us.Replace;case"tint":return Us.Tint}}function OTe(t,e,r){if(t==null||e===Us.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=_e(Math.round(t[3]*n4),0,n4),s=i===0||e===Us.Tint?0:e===Us.Replace?Oet:Ret;r[0]=_e(Math.round(t[0]*ux),0,ux),r[1]=_e(Math.round(t[1]*ux),0,ux),r[2]=_e(Math.round(t[2]*ux),0,ux),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Us||(Us={}));const ux=255,n4=85,Oet=n4,Ret=2*n4;function RTe(t){t.vertex.code.add(b`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.int(Us.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.int(Us.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.int(Us.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.int(Us.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function PTe(t,e){e.hasSymbolColors?(t.include(RTe),t.attributes.add(E.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(b`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new YR("colorMixMode",r=>wbe[r.colorMixMode])),t.vertex.code.add(b`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Lw(t,e){e.hasVertexColors?(t.attributes.add(E.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(b`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(b`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(b`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Pet(t){t.fragment.code.add(b`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.float(ho)}) { discard; } }
  `)}let Ab=class extends cs{constructor(e,r){super(e,"float",Qr.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function Ob(t,e){MTe(t,e,new Oe("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Met(t,e){MTe(t,e,new Ab("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function MTe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Xr.Mask&&e.alphaDiscardMode!==Xr.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Xr.Blend:return t.include(Pet);case Xr.Opaque:i.code.add(b`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Xr.Mask:i.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Xr.MaskBlend:t.fragment.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function ITe(t,e){const{vertex:r,fragment:i}=t,s=e.hasModelTransformation;if(s){const o=Fi();r.uniforms.add(new Ni("model",a=>a.modelTransformation??nn)),r.uniforms.add(new $h("normalTransform",a=>(A_(o,a.modelTransformation??nn),o)))}const n=e.hasColorTexture&&e.alphaDiscardMode!==Xr.Opaque;switch(e.output){case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:case L.ObjectAndLayerIdColor:gc(r,e),t.include(wl,e),t.include(Of,e),t.include(vg,e),t.include(Bg,e),t.include(ms,e),t.include(BR,e),Jb(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new Je("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(Ob,e),i.code.add(b`
          void main(void) {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:b`outputDepth(depth);`}
          }
        `);break;case L.Normal:{gc(r,e),t.include(wl,e),t.include(XR,e),t.include(GF,e),t.include(Of,e),t.include(vg,e),n&&i.uniforms.add(new Je("tex",a=>a.texture)),e.normalType===Or.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===Or.Attribute||e.normalType===Or.Compressed;r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?b`vNormalWorld = ${s?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:b`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ms,e),t.include(Ob,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Or.ScreenDerivative?b`vec3 normal = screenDerivativeNormal(vPositionView);`:b`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case L.Highlight:gc(r,e),t.include(wl,e),t.include(Of,e),t.include(vg,e),n&&i.uniforms.add(new Je("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(ms,e),t.include(Ob,e),t.include(ty,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function $Te(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(E.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Ki.WindingOrder?r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(b`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Ps.None&&(t.include(oZ,e),r.uniforms.add(e.pbrTextureBindType===Qr.Pass?new Je("normalTexture",i=>i.textureNormal):new ph("normalTexture",i=>i.textureNormal)),r.code.add(b`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function JR(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new Je("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/A3),r.code.add(b`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(b`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function QR(t){t.constants.add("ambientBoostFactor","float",tve)}function dE(t){t.uniforms.add(new Oe("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function ow(t,e){const r=t.fragment;switch(t.include(JR,e),e.pbrMode!==rt.Disabled&&t.include(qX,e),t.include(cZ,e),t.include(MR),r.code.add(b`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===rt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),QR(r),dE(r),Wg(r),r.code.add(b`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?b`normalize(vPosWorld)`:b`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),tm(r),r.code.add(b`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case rt.Disabled:case rt.WaterOnIntegratedMesh:case rt.Water:t.include(gN),r.code.add(b`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case rt.Normal:case rt.Schematic:r.code.add(b`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(b`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new Rf("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(b`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Oe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Oe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(b`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===rt.Schematic?b`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:b`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case rt.Terrain:case rt.TerrainWithWater:t.include(gN),r.code.add(b`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case rt.COUNT:}}function Sl(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function LTe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function AL(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Iet(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:LTe,create:Sl,createView:Iet,fromValues:AL},Symbol.toStringTag,{value:"Module"}));function $et(t){t.vertex.uniforms.add(new $h("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:Sl())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(b`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Let(t){t.vertex.uniforms.add(new $h("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:Sl())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(b`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Det(t){t.vertex.uniforms.add(new $h("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:Sl())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(b`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Net(t){t.vertex.uniforms.add(new $h("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:Sl())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(b`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Fet(t){t.vertex.uniforms.add(new $h("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:Sl())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(b`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function WO(t){t.include(rm),t.code.add(b`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.int(Us.Multiply)}) {
        return allMixed;
      }
      if (mode == ${b.int(Us.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Us.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.int(Us.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Us.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Uet(t){const e=new wr,{vertex:r,fragment:i,varyings:s}=e;if(gc(r,t),e.include(IR),s.add("vpos","vec3"),e.include(vg,t),e.include(CTe,t),e.include(dbe,t),t.hasColorTextureTransform&&e.include($et),t.output===L.Color||t.output===L.Alpha){t.hasNormalTextureTransform&&e.include(Let),t.hasEmissionTextureTransform&&e.include(Det),t.hasOcclusionTextureTransform&&e.include(Net),t.hasMetallicRoughnessTextureTransform&&e.include(Fet),ap(r,t),e.include(XR,t),e.include(wl,t);const n=t.normalType===Or.Attribute||t.normalType===Or.Compressed;n&&t.offsetBackfaces&&e.include(ETe),e.include($Te,t),e.include(GF,t),t.instancedColor&&e.attributes.add(E.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Of,t),e.include(iE,t),e.include(PTe,t),e.include(Lw,t),r.uniforms.add(new ir("externalColor",a=>a.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float");const o=t.hasModelTransformation;if(o){const a=Fi();r.uniforms.add(new Ni("model",l=>l.modelTransformation??nn)),r.uniforms.add(new $h("normalTransform",l=>(A_(a,l.modelTransformation??nn),a)))}r.code.add(b`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${b.float(ho)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?b`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?b`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?b`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?b`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?b`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?b`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case L.Alpha:e.include(ms,t),e.include(Ob,t),e.include(mu,t),i.uniforms.add(new Oe("opacity",n=>n.opacity),new Oe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),i.include(WO),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case L.Color:e.include(ms,t),e.include(ow,t),e.include(JR,t),e.include(Ob,t),e.include(t.instancedDoublePrecision?jF:sw,t),e.include(mu,t),ap(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("ambient",n=>n.ambient),new zt("diffuse",n=>n.diffuse),new Oe("opacity",n=>n.opacity),new Oe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),e.include(lZ,t),e.include(qX,t),i.include(WO),e.include(TTe,t),QR(i),dE(i),tm(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Or.ScreenDerivative?b`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:b`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===rt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?b`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?b`normalUV`:"vuv0"});`:b`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?b`normalize(posWorld);`:b`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?b`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===rt.Normal||t.pbrMode===rt.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===st.Color?b`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(ITe,t),e}const Vet=Object.freeze(Object.defineProperty({__proto__:null,build:Uet},Symbol.toStringTag,{value:"Module"}));let zet=class extends tTe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Da(qF),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=gi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ae(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Or.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ae(.2,.2,.2),this.diffuse=Ae(.8,.8,.8),this.externalColor=Ft(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=A(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Zb.Less,this.textureAlphaMode=Xr.Blend,this.textureAlphaCutoff=XN,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Li.Occlude}},ket=class extends rTe{constructor(){super(...arguments),this.origin=A(),this.slicePlaneLocalOrigin=this.origin}},rY=class DTe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Le.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Ps.Default:Ps.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,DTe.shader)}_initializeProgram(e,r){return new Cr(e.rctx,r.get().build(this.configuration),br)}_convertDepthTestFunction(e){return e===Zb.Lequal?Kr.LEQUAL:Kr.LESS}_makePipeline(e,r){const i=this.configuration,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:i.output!==L.Color&&i.output!==L.Alpha||!i.transparent?null:s?ou:ry(e),culling:Bet(i)?eF(i.cullFace):null,depthTest:{func:q_(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?Al:null,colorWrite:jt,stencilWrite:i.hasOccludees?Hf:null,stencilTest:i.hasOccludees?r?F_:W_:null,polygonOffset:s||n?null:MF(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function Bet(t){return t.cullFace!==gi.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}rY.shader=new Er(Vet,()=>ae(()=>import("./DefaultMaterial.glsl-c9118707.js"),[]));let qt=class extends No{constructor(){super(...arguments),this.output=L.Color,this.alphaDiscardMode=Xr.Opaque,this.doubleSidedMode=Ki.None,this.pbrMode=rt.Disabled,this.cullFace=gi.None,this.transparencyPassType=st.NONE,this.normalType=Or.Attribute,this.textureCoordinateType=Ps.None,this.customDepthTest=Zb.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([F({count:L.COUNT})],qt.prototype,"output",void 0),u([F({count:Xr.COUNT})],qt.prototype,"alphaDiscardMode",void 0),u([F({count:Ki.COUNT})],qt.prototype,"doubleSidedMode",void 0),u([F({count:rt.COUNT})],qt.prototype,"pbrMode",void 0),u([F({count:gi.COUNT})],qt.prototype,"cullFace",void 0),u([F({count:st.COUNT})],qt.prototype,"transparencyPassType",void 0),u([F({count:Or.COUNT})],qt.prototype,"normalType",void 0),u([F({count:Ps.COUNT})],qt.prototype,"textureCoordinateType",void 0),u([F({count:Zb.COUNT})],qt.prototype,"customDepthTest",void 0),u([F()],qt.prototype,"spherical",void 0),u([F()],qt.prototype,"hasVertexColors",void 0),u([F()],qt.prototype,"hasSymbolColors",void 0),u([F()],qt.prototype,"hasVerticalOffset",void 0),u([F()],qt.prototype,"hasSlicePlane",void 0),u([F()],qt.prototype,"hasSliceHighlight",void 0),u([F()],qt.prototype,"hasColorTexture",void 0),u([F()],qt.prototype,"hasMetallicRoughnessTexture",void 0),u([F()],qt.prototype,"hasEmissionTexture",void 0),u([F()],qt.prototype,"hasOcclusionTexture",void 0),u([F()],qt.prototype,"hasNormalTexture",void 0),u([F()],qt.prototype,"hasScreenSizePerspective",void 0),u([F()],qt.prototype,"hasVertexTangents",void 0),u([F()],qt.prototype,"hasOccludees",void 0),u([F()],qt.prototype,"hasMultipassTerrain",void 0),u([F()],qt.prototype,"hasModelTransformation",void 0),u([F()],qt.prototype,"offsetBackfaces",void 0),u([F()],qt.prototype,"vvSize",void 0),u([F()],qt.prototype,"vvColor",void 0),u([F()],qt.prototype,"receiveShadows",void 0),u([F()],qt.prototype,"receiveAmbientOcclusion",void 0),u([F()],qt.prototype,"textureAlphaPremultiplied",void 0),u([F()],qt.prototype,"instanced",void 0),u([F()],qt.prototype,"instancedColor",void 0),u([F()],qt.prototype,"objectAndLayerIdColorInstanced",void 0),u([F()],qt.prototype,"instancedDoublePrecision",void 0),u([F()],qt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],qt.prototype,"writeDepth",void 0),u([F()],qt.prototype,"transparent",void 0),u([F()],qt.prototype,"enableOffset",void 0),u([F()],qt.prototype,"cullAboveGround",void 0),u([F()],qt.prototype,"snowCover",void 0),u([F()],qt.prototype,"hasColorTextureTransform",void 0),u([F()],qt.prototype,"hasEmissionTextureTransform",void 0),u([F()],qt.prototype,"hasNormalTextureTransform",void 0),u([F()],qt.prototype,"hasOcclusionTextureTransform",void 0),u([F()],qt.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([F({constValue:!0})],qt.prototype,"hasVvInstancing",void 0),u([F({constValue:!1})],qt.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!1})],qt.prototype,"supportsTextureAtlas",void 0),u([F({constValue:!0})],qt.prototype,"useFillLights",void 0);function Get(t){const e=new wr,{vertex:r,fragment:i,varyings:s}=e;return gc(r,t),e.include(IR),s.add("vpos","vec3"),e.include(vg,t),e.include(CTe,t),e.include(dbe,t),t.output!==L.Color&&t.output!==L.Alpha||(ap(e.vertex,t),e.include(XR,t),e.include(wl,t),t.offsetBackfaces&&e.include(ETe),t.instancedColor&&e.attributes.add(E.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(Of,t),e.include(iE,t),e.include(PTe,t),e.include(Lw,t),r.uniforms.add(new ir("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(b`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${b.float(ho)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?b`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===L.Alpha&&(e.include(ms,t),e.include(Ob,t),e.include(mu,t),i.uniforms.add(new Oe("opacity",n=>n.opacity),new Oe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),i.include(WO),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===L.Color&&(e.include(ms,t),e.include(ow,t),e.include(JR,t),e.include(Ob,t),e.include(t.instancedDoublePrecision?jF:sw,t),e.include(mu,t),ap(e.fragment,t),Wg(i),QR(i),dE(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new zt("ambient",n=>n.ambient),new zt("diffuse",n=>n.diffuse),new Oe("opacity",n=>n.opacity),new Oe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),e.include(lZ,t),e.include(qX,t),i.include(WO),tm(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===rt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?b`albedo = mix(albedo, vec3(1), 0.9);`:b``}
        ${b`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===rt.Normal||t.pbrMode===rt.Schematic?t.spherical?b`vec3 normalGround = normalize(vpos + localOrigin);`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:b``}
        ${t.pbrMode===rt.Normal||t.pbrMode===rt.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===st.Color?b`fragColor = premultiplyAlpha(fragColor);`:b``}
      }
    `)),e.include(ITe,t),e}const jet=Object.freeze(Object.defineProperty({__proto__:null,build:Get},Symbol.toStringTag,{value:"Module"}));let NTe=class FTe extends rY{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Or.Attribute,r.doubleSidedMode=Ki.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,FTe.shader)}};NTe.shader=new Er(jet,()=>ae(()=>import("./RealisticTree.glsl-4e85b137.js"),[]));let qf=class extends H_{constructor(e){super(e,Wet),this.supportsEdges=!0,this._configuration=new qt,this._vertexBufferLayout=Zet(this.parameters)}isVisibleForOutput(e){return e!==L.Shadow&&e!==L.ShadowExcludeHighlight&&e!==L.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?gi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==L.Color&&e!==L.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Ki.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ki.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ki.WindingOrder:Ki.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?rt.Schematic:rt.Normal:rt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<RF,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(z8,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Le.Global:l=ge(fse,z8);break;case Le.Local:l=re(fse,Jet)}let c=0;const h=he(Qet,z8,a.eye),d=Ee(h),f=ie(h,h,1/d);let m=null;this.parameters.screenSizePerspective&&(m=me(l,f)),c+=vbe(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),ie(l,l,c),cc(V8,l,i.transform.inverseRotation),s=he(Xet,s,V8),n=he(Yet,n,V8)}mbe(e,i,s,n,T7(i.verticalOffset),o)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Depth||r===L.Normal||r===L.Shadow||r===L.ShadowHighlight||r===L.ShadowExcludeHighlight||r===L.Highlight||r===L.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ce.OPAQUE_MATERIAL)||e===ce.DRAPED_MATERIAL:!1}createGLMaterial(e){return new Het(e)}createBufferWriter(){return new hE(this._vertexBufferLayout)}},Het=class extends aZ{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==L.Color&&this._output!==L.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?NTe:rY,e)}},qet=class extends zet{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Wet=new qet;function Zet(t){const e=Hi().vec3f(E.POSITION);return t.normalType===Or.Compressed?e.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(E.NORMAL),t.hasVertexTangents&&e.vec4f(E.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(E.UV0),t.hasVertexColors&&e.vec4u8(E.COLOR),t.hasSymbolColors&&e.vec4u8(E.SYMBOLCOLOR),oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),e}const Xet=A(),Yet=A(),Jet=Ae(0,0,1),fse=A(),V8=A(),z8=A(),Qet=A(),Ket=["polygon","extent"];let ett=class extends sm{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=DF(this._getSymbolSize());if(c)throw new U("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=Da(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?gi.None:gi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Or.Compressed};this._material=new qf(o),this._bottomMaterial=new qf({...o,cullFace:gi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Ket,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new dp);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){var a,l;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(c=>{const h=r(c);h!=null&&h.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,L_)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const s=r(i);s!=null&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?SQe(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Ms.RecreateSymbol:Ms.RecreateGraphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/pO(r),{objectId:o,target:a}=e,l=K(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,d=K(c),f=K(h);return d.z=(d.z??0)+n,f.z=(f.z??0)+n,[Mie(o,l,1/0,d,f)]}case"vertex":return[uQe(o,l,1/0),Mie(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=HO(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some($=>$.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=KX(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=xX(o);if(l==null)return null;const c=new Array,h=new Array,d=ln(),f=ve(),m=A(),y=this._context.renderCoordsHelper.viewingMode===Le.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,m),xl(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const _=ve();xn(_,f);const v=Fi();A_(v,_);const{polygons:w,mapPositions:T,position:x}=a;for(const $ of w){const V=$.count;if(this._context.clippingExtent&&(Ti(d),tu(d,$.mapPositions),!Vd(d,this._context.clippingExtent)))continue;const z=CS($.mapPositions,$.holeIndices,3);if(z.length===0)continue;const B=z.length,k=6*V,Z=AN(k+B),W=AN(B),j=zo(3*k),Y=zo(3*k),M=zo(3*k),D=zo(k);ttt(x,T,z,$,j,M,Y,D,Z,W,this._getExtrusionSize(r),m,y),AS(j,j,_);const N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),G=new ott(j,M,Tet(Y),D);c.push(mse(this._material,Z,Z.length-W.length,G,i,N),mse(this._bottomMaterial,W,0,G,i,N)),h.push(G.heights)}if(c.length===0)return null;const S=new iy({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});S.transformation=f;const O=jwe(this.symbolLayer,{opacity:this._getLayerOpacity()}),C=O!=null?{baseMaterial:this._material,edgeMaterials:[O],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,P=new im(this,S,c,null,null,($,V,z,B,k)=>stt($,V,z,B,k,h),s,C);return P.alignedSampledElevation=a.sampledElevation,P.needsElevationUpdates=L_(s.mode),P}};function mse(t,e,r,i,s,n){const o=sE(e.length),a=[[E.POSITION,new Ve(i.positions,3,!0)],[E.NORMALCOMPRESSED,new Ve(i.normals,2,!0)],[E.COLOR,new Ve(s,4,!0)]],l=[[E.POSITION,e],[E.NORMALCOMPRESSED,e],[E.COLOR,o]];return new Hs(t,a,l,i.elevation,as.Mesh,n,r)}function ttt(t,e,r,i,s,n,o,a,l,c,h,d,f){const m=r.length/3;let y=0,_=2*i.count;rtt(t,e,i.index,i.count,r,0,m,s,n,o,a,l,c,_,h,d,f);let v=2*i.count;_=0,gse(s,n,a,o,y,i.pathLengths[0],i.count,v,l,_,h),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let w=1;w<i.pathLengths.length;++w)gse(s,n,a,o,y,i.pathLengths[w],i.count,v,l,_,h),v+=4*i.pathLengths[w],_+=2*i.pathLengths[w],y+=i.pathLengths[w]}function rtt(t,e,r,i,s,n,o,a,l,c,h,d,f,m,y,_,v){re(il,_);const w=y>0?1:-1;let T=3*r,x=0,S=3*x,O=i,C=3*O;for(let V=0;V<i;++V)v&&(il[0]=t[T],il[1]=t[T+1],il[2]=t[T+2],ge(il,il)),a[S]=t[T],a[S+1]=t[T+1],a[S+2]=t[T+2],l[S]=e[T],l[S+1]=e[T+1],l[S+2]=e[T+2],c[S]=-w*il[0],c[S+1]=-w*il[1],c[S+2]=-w*il[2],h[x]=0,a[C]=t[T]+y*il[0],a[C+1]=t[T+1]+y*il[1],a[C+2]=t[T+2]+y*il[2],l[C]=e[T],l[C+1]=e[T+1],l[C+2]=e[T+2],c[C]=w*il[0],c[C+1]=w*il[1],c[C+2]=w*il[2],h[O]=y,S+=3,C+=3,T+=3,x+=1,O+=1;T=3*n,S=0,C=3*m;const P=y<0?xse:wse,$=y<0?wse:xse;for(let V=0;V<o;++V)f[S]=s[T+P[0]],f[S+1]=s[T+P[1]],f[S+2]=s[T+P[2]],d[C]=s[T+$[0]]+i,d[C+1]=s[T+$[1]]+i,d[C+2]=s[T+$[2]]+i,S+=3,C+=3,T+=3}function KM(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const KE=A();function gse(t,e,r,i,s,n,o,a,l,c,h){let d=s,f=s+1,m=s+o,y=s+o+1,_=a,v=a+1,w=a+2*n,T=a+2*n+1;h<0&&(d=s+o+1,y=s),c*=3;for(let x=0;x<n;++x)x===n-1&&(h>0?(f=s,y=s+o):(f=s,d=s+o)),itt(t,d,f,m,KE),KM(t,e,i,r,KE,_,d),KM(t,e,i,r,KE,v,f),KM(t,e,i,r,KE,w,m),KM(t,e,i,r,KE,T,y),l[c++]=_,l[c++]=w,l[c++]=T,l[c++]=_,l[c++]=T,l[c++]=v,d++,f++,m++,y++,_+=2,v+=2,w+=2,T+=2}const k8=A(),yse=A(),_se=A(),vse=A(),bse=A();function itt(t,e,r,i,s){e*=3,r*=3,i*=3,se(k8,t[e++],t[e++],t[e++]),se(yse,t[r++],t[r++],t[r++]),se(_se,t[i++],t[i++],t[i++]),he(vse,yse,k8),he(bse,_se,k8),ot(s,bse,vse),ge(s,s)}const hx=A();function stt(t,e,r,i,s,n){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let h=0;const d=o.transformation,f=QS(ve(),d);for(let m=0;m<l;m+=2){const y=a[m];if(!SX(y))continue;const _=y.getMutableAttribute(E.POSITION).data,v=n[m/2],w=new JZ(y.mapPositions),T=_.length/3;let x=0,S=!1,O=0;for(let C=0;C<T;C++){hx[0]=_[x],hx[1]=_[x+1],hx[2]=_[x+2],i(w,eI),c&&(O+=eI.sampledElevation),oi.TESTS_DISABLE_OPTIMIZATIONS?(se($l,w.array[w.offset],w.array[w.offset+1],eI.z+v[x/3]),r!=null&&s.toRenderCoords($l,r,$l),$e($l,$l,f)):(se($l,_[x],_[x+1],_[x+2]),$e($l,$l,d),s.setAltitude($l,eI.z+v[x/3]),$e($l,$l,f)),_[x]=$l[0],_[x+1]=$l[1],_[x+2]=$l[2];const P=ntt/s.unitInMeters;(Math.abs(hx[0]-_[x])>=P||Math.abs(hx[1]-_[x+1])>=P||Math.abs(hx[2]-_[x+2])>=P)&&(S=!0),w.offset+=3,x+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m]),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m+1])),h+=O/T}return h/l}const $l=A(),il=A(),eI=new qR,wse=[0,2,1],xse=[0,1,2],ntt=.01;let ott=class{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}};function WF(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function att(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ltt(t,e,r,i,s,n,o,a,l,c,h,d,f,m,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=d,v[12]=f,v[13]=m,v[14]=y,v[15]=_,v}function ctt(t,e){return new Float32Array(t,e,16)}const utt=WF();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:utt,clone:att,create:WF,createView:ctt,fromValues:ltt},Symbol.toStringTag,{value:"Module"}));const htt=(t,e)=>{const r=Kf(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return bc(r,r)},dtt=(t,e)=>{const r=Kf(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return bc(r,r)},ptt=(t,e)=>{const r=1-e,i=Kf(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return bc(i,i)},ftt=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=Kf(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return bc(s,s)},mtt=(t,e)=>{const r=1-2*e,i=Kf(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return bc(i,i)},gtt=(t,e)=>{const r=Kf(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return bc(r,r)},ytt=(t,e)=>{const r=1-e,i=Kf(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return bc(i,i)};let UTe=class VTe{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=rc(e.strength,r.strength,i),this.radius=rc(e.radius,r.radius,i),this.threshold=rc(e.threshold,r.threshold,i)}clone(){return new VTe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:VA(this.radius),strength:this.strength,threshold:this.threshold}}},zTe=class kTe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(rc(e.radius,r.radius,i))}clone(){return new kTe(this.radius)}toJSON(){return{type:"blur",radius:VA(this.radius)}}},oG=class BTe{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=rc(e.amount,r.amount,i),this._updateMatrix()}clone(){return new BTe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||WF();switch(this.type){case"brightness":this._colorMatrix=htt(e,this.amount);break;case"contrast":this._colorMatrix=dtt(e,this.amount);break;case"grayscale":this._colorMatrix=ptt(e,this.amount);break;case"invert":this._colorMatrix=mtt(e,this.amount);break;case"saturate":this._colorMatrix=gtt(e,this.amount);break;case"sepia":this._colorMatrix=ytt(e,this.amount)}}},GTe=class jTe{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=rc(e.offsetX,r.offsetX,i),this.offsetY=rc(e.offsetY,r.offsetY,i),this.blurRadius=rc(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(rc(e.color[0],r.color[0],i)),this.color[1]=Math.round(rc(e.color[1],r.color[1],i)),this.color[2]=Math.round(rc(e.color[2],r.color[2],i)),this.color[3]=rc(e.color[3],r.color[3],i)}clone(){return new jTe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:VA(this.offsetX),yoffset:VA(this.offsetY),blurRadius:VA(this.blurRadius),color:e}}},HTe=class qTe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=rc(e.angle,r.angle,i),this._updateMatrix()}clone(){return new qTe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||WF();this._colorMatrix=ftt(e,this.angle)}},WTe=class ZTe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=rc(e.amount,r.amount,i)}clone(){return new ZTe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function rc(t,e,r){return t+(e-t)*r}function VA(t){return Math.round(1e3*bh(t))/1e3}function _tt(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new oG(t.type,0);case"saturate":case"brightness":case"contrast":return new oG(t.type,1);case"opacity":return new WTe(1);case"hue-rotate":return new HTe(0);case"blur":return new zTe(0);case"drop-shadow":return new GTe(0,0,0,[...Tq("transparent")]);case"bloom":return new UTe(0,0,1)}}function vtt(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function btt(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(_tt(r[s]))}function wtt(t){const e=t[0];return!!e&&"type"in e}var Tse,Sse,aG={exports:{}};aG.exports,Sse=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:om},h=om,d="none",f=")",m=",",y="(",_="%",v="px",w="cm",T="mm",x="in",S="pt",O="pc",C="deg",P="rad",$="grad",V="turn",z="#",B=".",k="e",Z=/^[ \t\n\r]/,W=/^[a-z\-]/,j=/^[0-9a-fA-F]/,Y=/^[+\-]/,M=/^[0-9]/,D=Ya("none"),N=An("none",!1),G=An(")",!1),X=An(",",!1),J=Ya("whitespace"),ee=Y_([" ","	",`
`,"\r"],!1,!1),ye=Ya("function"),Me=An("(",!1),ft=Ya("identifier"),Rt=Y_([["a","z"],"-"],!1,!1),at=Ya("percentage"),vt=An("%",!1),ze=Ya("length"),fe=An("px",!1),Tt=An("cm",!1),bt=An("mm",!1),Ce=An("in",!1),Be=An("pt",!1),je=An("pc",!1),mt=Ya("angle"),ut=An("deg",!1),dr=An("rad",!1),He=An("grad",!1),gt=An("turn",!1),pr=Ya("number"),nt=Ya("color"),ht=An("#",!1),yt=Y_([["0","9"],["a","f"],["A","F"]],!1,!1),Nt=Y_(["+","-"],!1,!1),Ht=Y_([["0","9"]],!1,!1),Si=An(".",!1),Hr=An("e",!1),yi=function(){return[]},Bt=function(H,pe){return{type:"function",name:H,parameters:pe||[]}},li=function(H,pe){return pe.length>0?_E(H,pe,3):[H]},Vr=function(H){return{type:"quantity",value:H.value,unit:H.unit}},ti=function(H){return{type:"color",colorType:H.type,value:H.value}},Mr=function(H){return H},Ei=function(){return Rl()},kr=function(H){return{value:H,unit:"%"}},ci=function(H){return{value:H,unit:"px"}},ri=function(H){return{value:H,unit:"cm"}},fr=function(H){return{value:H,unit:"mm"}},ui=function(H){return{value:H,unit:"in"}},Ui=function(H){return{value:H,unit:"pt"}},Wn=function(H){return{value:H,unit:"pc"}},Zn=function(H){return{value:H,unit:"deg"}},Xn=function(H){return{value:H,unit:"rad"}},Yn=function(H){return{value:H,unit:"grad"}},qi=function(H){return{value:H,unit:"turn"}},Vi=function(H){return{value:H,unit:null}},qr=function(){return{type:"hex",value:Rl()}},En=function(H){return{type:"function",value:H}},xo=function(){return{type:"named",value:Rl()}},da=function(){return parseFloat(Rl())},ne=0,Ci=0,Nh=[{line:1,column:1}],Cn=0,Fh=[],Qe=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function Rl(){return s.substring(Ci,ne)}function An(H,pe){return{type:"literal",text:H,ignoreCase:pe}}function Y_(H,pe,Te){return{type:"class",parts:H,inverted:pe,ignoreCase:Te}}function J_(){return{type:"end"}}function Ya(H){return{type:"other",description:H}}function nm(H){var pe,Te=Nh[H];if(Te)return Te;for(pe=H-1;!Nh[pe];)pe--;for(Te={line:(Te=Nh[pe]).line,column:Te.column};pe<H;)s.charCodeAt(pe)===10?(Te.line++,Te.column=1):Te.column++,pe++;return Nh[H]=Te,Te}function Q_(H,pe,Te){var lr=nm(H),zs=nm(pe),_i={source:l,start:{offset:H,line:lr.line,column:lr.column},end:{offset:pe,line:zs.line,column:zs.column}};return Te&&l&&typeof l.offset=="function"&&(_i.start=l.offset(_i.start),_i.end=l.offset(_i.end)),_i}function Kt(H){ne<Cn||(ne>Cn&&(Cn=ne,Fh=[]),Fh.push(H))}function ny(H,pe,Te){return new e(e.buildMessage(H,pe),H,pe,Te)}function om(){var H;return(H=oy())===a&&(H=pa()),H}function oy(){var H,pe;return Qe++,H=ne,es(),s.substr(ne,4)===d?(pe=d,ne+=4):(pe=a,Qe===0&&Kt(N)),pe!==a?(es(),Ci=H,H=yi()):(ne=H,H=a),Qe--,H===a&&Qe===0&&Kt(D),H}function pa(){var H,pe;if(H=[],(pe=Pl())!==a)for(;pe!==a;)H.push(pe),pe=Pl();else H=a;return H}function Pl(){var H,pe,Te,lr;return H=ne,es(),(pe=ay())!==a?(es(),(Te=fp())===a&&(Te=null),es(),s.charCodeAt(ne)===41?(lr=f,ne++):(lr=a,Qe===0&&Kt(G)),lr!==a?(es(),Ci=H,H=Bt(pe,Te)):(ne=H,H=a)):(ne=H,H=a),H}function fp(){var H,pe,Te,lr,zs,_i,fa,rv;if(H=ne,(pe=On())!==a){for(Te=[],lr=ne,zs=es(),s.charCodeAt(ne)===44?(_i=m,ne++):(_i=a,Qe===0&&Kt(X)),_i===a&&(_i=null),fa=es(),(rv=On())!==a?lr=zs=[zs,_i,fa,rv]:(ne=lr,lr=a);lr!==a;)Te.push(lr),lr=ne,zs=es(),s.charCodeAt(ne)===44?(_i=m,ne++):(_i=a,Qe===0&&Kt(X)),_i===a&&(_i=null),fa=es(),(rv=On())!==a?lr=zs=[zs,_i,fa,rv]:(ne=lr,lr=a);Ci=H,H=li(pe,Te)}else ne=H,H=a;return H}function On(){var H,pe;return H=ne,(pe=ev())===a&&(pe=Dw())===a&&(pe=tv())===a&&(pe=ly()),pe!==a&&(Ci=H,pe=Vr(pe)),(H=pe)===a&&(H=ne,(pe=uP())!==a&&(Ci=H,pe=ti(pe)),H=pe),H}function es(){var H,pe;for(Qe++,H=[],Z.test(s.charAt(ne))?(pe=s.charAt(ne),ne++):(pe=a,Qe===0&&Kt(ee));pe!==a;)H.push(pe),Z.test(s.charAt(ne))?(pe=s.charAt(ne),ne++):(pe=a,Qe===0&&Kt(ee));return Qe--,pe=a,Qe===0&&Kt(J),H}function ay(){var H,pe,Te;return Qe++,H=ne,(pe=K_())!==a?(s.charCodeAt(ne)===40?(Te=y,ne++):(Te=a,Qe===0&&Kt(Me)),Te!==a?(Ci=H,H=Mr(pe)):(ne=H,H=a)):(ne=H,H=a),Qe--,H===a&&(pe=a,Qe===0&&Kt(ye)),H}function K_(){var H,pe,Te;if(Qe++,H=ne,pe=[],W.test(s.charAt(ne))?(Te=s.charAt(ne),ne++):(Te=a,Qe===0&&Kt(Rt)),Te!==a)for(;Te!==a;)pe.push(Te),W.test(s.charAt(ne))?(Te=s.charAt(ne),ne++):(Te=a,Qe===0&&Kt(Rt));else pe=a;return pe!==a&&(Ci=H,pe=Ei()),Qe--,(H=pe)===a&&(pe=a,Qe===0&&Kt(ft)),H}function ev(){var H,pe,Te;return Qe++,H=ne,es(),(pe=Ja())!==a?(s.charCodeAt(ne)===37?(Te=_,ne++):(Te=a,Qe===0&&Kt(vt)),Te!==a?(Ci=H,H=kr(pe)):(ne=H,H=a)):(ne=H,H=a),Qe--,H===a&&Qe===0&&Kt(at),H}function Dw(){var H,pe,Te;return Qe++,H=ne,es(),(pe=Ja())!==a?(s.substr(ne,2)===v?(Te=v,ne+=2):(Te=a,Qe===0&&Kt(fe)),Te!==a?(Ci=H,H=ci(pe)):(ne=H,H=a)):(ne=H,H=a),H===a&&(H=ne,es(),(pe=Ja())!==a?(s.substr(ne,2)===w?(Te=w,ne+=2):(Te=a,Qe===0&&Kt(Tt)),Te!==a?(Ci=H,H=ri(pe)):(ne=H,H=a)):(ne=H,H=a),H===a&&(H=ne,es(),(pe=Ja())!==a?(s.substr(ne,2)===T?(Te=T,ne+=2):(Te=a,Qe===0&&Kt(bt)),Te!==a?(Ci=H,H=fr(pe)):(ne=H,H=a)):(ne=H,H=a),H===a&&(H=ne,es(),(pe=Ja())!==a?(s.substr(ne,2)===x?(Te=x,ne+=2):(Te=a,Qe===0&&Kt(Ce)),Te!==a?(Ci=H,H=ui(pe)):(ne=H,H=a)):(ne=H,H=a),H===a&&(H=ne,es(),(pe=Ja())!==a?(s.substr(ne,2)===S?(Te=S,ne+=2):(Te=a,Qe===0&&Kt(Be)),Te!==a?(Ci=H,H=Ui(pe)):(ne=H,H=a)):(ne=H,H=a),H===a&&(H=ne,es(),(pe=Ja())!==a?(s.substr(ne,2)===O?(Te=O,ne+=2):(Te=a,Qe===0&&Kt(je)),Te!==a?(Ci=H,H=Wn(pe)):(ne=H,H=a)):(ne=H,H=a)))))),Qe--,H===a&&Qe===0&&Kt(ze),H}function tv(){var H,pe,Te;return Qe++,H=ne,(pe=Ja())!==a?(s.substr(ne,3)===C?(Te=C,ne+=3):(Te=a,Qe===0&&Kt(ut)),Te!==a?(Ci=H,H=Zn(pe)):(ne=H,H=a)):(ne=H,H=a),H===a&&(H=ne,(pe=Ja())!==a?(s.substr(ne,3)===P?(Te=P,ne+=3):(Te=a,Qe===0&&Kt(dr)),Te!==a?(Ci=H,H=Xn(pe)):(ne=H,H=a)):(ne=H,H=a),H===a&&(H=ne,(pe=Ja())!==a?(s.substr(ne,4)===$?(Te=$,ne+=4):(Te=a,Qe===0&&Kt(He)),Te!==a?(Ci=H,H=Yn(pe)):(ne=H,H=a)):(ne=H,H=a),H===a&&(H=ne,(pe=Ja())!==a?(s.substr(ne,4)===V?(Te=V,ne+=4):(Te=a,Qe===0&&Kt(gt)),Te!==a?(Ci=H,H=qi(pe)):(ne=H,H=a)):(ne=H,H=a)))),Qe--,H===a&&(pe=a,Qe===0&&Kt(mt)),H}function ly(){var H,pe;return Qe++,H=ne,es(),(pe=Ja())!==a?(Ci=H,H=Vi(pe)):(ne=H,H=a),Qe--,H===a&&Qe===0&&Kt(pr),H}function uP(){var H,pe,Te,lr;if(Qe++,H=ne,s.charCodeAt(ne)===35?(pe=z,ne++):(pe=a,Qe===0&&Kt(ht)),pe!==a){if(Te=[],j.test(s.charAt(ne))?(lr=s.charAt(ne),ne++):(lr=a,Qe===0&&Kt(yt)),lr!==a)for(;lr!==a;)Te.push(lr),j.test(s.charAt(ne))?(lr=s.charAt(ne),ne++):(lr=a,Qe===0&&Kt(yt));else Te=a;Te!==a?(Ci=H,H=qr()):(ne=H,H=a)}else ne=H,H=a;return H===a&&(H=ne,(pe=Pl())!==a&&(Ci=H,pe=En(pe)),(H=pe)===a&&(H=ne,(pe=K_())!==a&&(Ci=H,pe=xo()),H=pe)),Qe--,H===a&&(pe=a,Qe===0&&Kt(nt)),H}function Ja(){var H,pe,Te,lr,zs,_i,fa;for(H=ne,Y.test(s.charAt(ne))?(s.charAt(ne),ne++):Qe===0&&Kt(Nt),pe=ne,Te=[],M.test(s.charAt(ne))?(lr=s.charAt(ne),ne++):(lr=a,Qe===0&&Kt(Ht));lr!==a;)Te.push(lr),M.test(s.charAt(ne))?(lr=s.charAt(ne),ne++):(lr=a,Qe===0&&Kt(Ht));if(s.charCodeAt(ne)===46?(lr=B,ne++):(lr=a,Qe===0&&Kt(Si)),lr!==a){if(zs=[],M.test(s.charAt(ne))?(_i=s.charAt(ne),ne++):(_i=a,Qe===0&&Kt(Ht)),_i!==a)for(;_i!==a;)zs.push(_i),M.test(s.charAt(ne))?(_i=s.charAt(ne),ne++):(_i=a,Qe===0&&Kt(Ht));else zs=a;zs!==a?pe=Te=[Te,lr,zs]:(ne=pe,pe=a)}else ne=pe,pe=a;if(pe===a)if(pe=[],M.test(s.charAt(ne))?(Te=s.charAt(ne),ne++):(Te=a,Qe===0&&Kt(Ht)),Te!==a)for(;Te!==a;)pe.push(Te),M.test(s.charAt(ne))?(Te=s.charAt(ne),ne++):(Te=a,Qe===0&&Kt(Ht));else pe=a;if(pe!==a){if(Te=ne,s.charCodeAt(ne)===101?(lr=k,ne++):(lr=a,Qe===0&&Kt(Hr)),lr!==a){if(Y.test(s.charAt(ne))?(zs=s.charAt(ne),ne++):(zs=a,Qe===0&&Kt(Nt)),zs===a&&(zs=null),_i=[],M.test(s.charAt(ne))?(fa=s.charAt(ne),ne++):(fa=a,Qe===0&&Kt(Ht)),fa!==a)for(;fa!==a;)_i.push(fa),M.test(s.charAt(ne))?(fa=s.charAt(ne),ne++):(fa=a,Qe===0&&Kt(Ht));else _i=a;_i!==a?Te=lr=[lr,zs,_i]:(ne=Te,Te=a)}else ne=Te,Te=a;Te===a&&(Te=null),Ci=H,H=da()}else ne=H,H=a;return H}function yE(H,pe){return H.map(function(Te){return Te[pe]})}function _E(H,pe,Te){return[H].concat(yE(pe,Te))}if((o=h())!==a&&ne===s.length)return o;throw o!==a&&ne<s.length&&Kt(J_()),ny(Fh,Cn<s.length?s.charAt(Cn):null,Cn<s.length?Q_(Cn,Cn+1):Q_(Cn,Cn))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,h=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,f=r("",c.line.toString().length," "),m=a[l.line-1],y=(l.line===d.line?d.column:m.length+1)-l.column||1;n+=`
 --> `+h+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+r("",l.column-1," ")+r("",y,"^")}else n+=`
 at `+h}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function d(m){var y,_,v=m.map(h);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:i}},(Tse=aG).exports&&(Tse.exports=Sse());var xtt=aG.exports;function XTe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=Ese(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new U("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Ese(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!vtt(e[r].effects,e[r+1].effects))throw new U("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});btt(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function Ese(t){let e;if(!t)return[];try{e=xtt.parse(t)}catch(r){throw new U("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>Ttt(r))}function Ttt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Stt(t);case"opacity":return Ett(t);case"hue-rotate":return Ctt(t);case"blur":return Att(t);case"drop-shadow":return Ott(t);case"bloom":return Rtt(t)}}catch(e){throw e.details.filter=t,e}throw new U("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Stt(t){let e=1;return pE(t.parameters,1),t.parameters.length===1&&(e=Ad(t.parameters[0])),new oG(t.name,e)}function Ett(t){let e=1;return pE(t.parameters,1),t.parameters.length===1&&(e=Ad(t.parameters[0])),new WTe(e)}function Ctt(t){let e=0;return pE(t.parameters,1),t.parameters.length===1&&(e=Dtt(t.parameters[0])),new HTe(e)}function Att(t){let e=0;return pE(t.parameters,1),t.parameters.length===1&&(e=nY(t.parameters[0]),KR(e,t.parameters[0])),new zTe(e)}function Ott(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new U("effect:type-error","Accepts only one color",{});r=Ntt(i)}else{const s=nY(i);if(Object.isFrozen(e))throw new U("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&KR(s,i)}if(e.length<2||e.length>3)throw new U("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new GTe(e[0],e[1],e[2]||0,r||YTe("black"))}function Rtt(t){let e=1,r=0,i=0;return pE(t.parameters,3),t.parameters[0]&&(e=Ad(t.parameters[0])),t.parameters[1]&&(r=nY(t.parameters[1]),KR(r,t.parameters[1])),t.parameters[2]&&(i=Ad(t.parameters[2])),new UTe(e,r,i)}function pE(t,e){if(t.length>e)throw new U("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function ZF(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in sY)return"<length>";if(t.unit in iY)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function KR(t,e){if(t<0)throw new U("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function Ptt(t){if(t.type!=="quantity"||t.unit!==null)throw new U("effect:type-error",`Expected <double>, Actual: ${ZF(t)}`,{term:t})}function Mtt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new U("effect:type-error",`Expected <double> or <percentage>, Actual: ${ZF(t)}`,{term:t})}const iY={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Itt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&iY[t.unit]!=null))throw new U("effect:type-error",`Expected <angle>, Actual: ${ZF(t)}`,{term:t})}const sY={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function $tt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&sY[t.unit]!=null))throw new U("effect:type-error",`Expected <length>, Actual: ${ZF(t)}`,{term:t})}function Ad(t){Mtt(t);const e=t.value;return KR(e,t),t.unit==="%"?.01*e:e}function Ltt(t){return Ptt(t),KR(t.value,t),t.value}function Dtt(t){return Itt(t),t.value*iY[t.unit]||0}function nY(t){return $tt(t),t.value*sY[t.unit]||0}function Ntt(t){switch(t.colorType){case"hex":return A$e(t.value);case"named":return YTe(t.value);case"function":return Vtt(t.value)}}function YTe(t){if(!spe(t))throw new U("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return C$e(t)}const Ftt=/^rgba?/i,Utt=/^hsla?/i;function Vtt(t){if(pE(t.parameters,4),Ftt.test(t.name))return[Ad(t.parameters[0]),Ad(t.parameters[1]),Ad(t.parameters[2]),t.parameters[3]?Ad(t.parameters[3]):1];if(Utt.test(t.name))return npe(Ltt(t.parameters[0]),Ad(t.parameters[1]),Ad(t.parameters[2]),t.parameters[3]?Ad(t.parameters[3]):1);throw new U("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function oY(t,e,r){var i;try{return ktt(t)}catch(s){(i=r==null?void 0:r.messages)==null||i.push(s)}return null}function aY(t,e,r,i){try{const s=ztt(t);Ha(r,s,e)}catch(s){i.messages&&i.messages.push(s)}}function ztt(t){const e=XTe(t);return e?wtt(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function ktt(t){if(!t||t.length===0)return null;if(Btt(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:Cse(r.value)});return e}return Cse(t)}function Btt(t){const e=t[0];return!!e&&"scale"in e}function Cse(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[fm(r,"amount")];break;case"blur":i=[fm(r,"radius","pt")];break;case"hue-rotate":i=[fm(r,"angle","deg")];break;case"drop-shadow":i=[fm(r,"xoffset","pt"),fm(r,"yoffset","pt"),fm(r,"blurRadius","pt"),Gtt(r,"color")];break;case"bloom":i=[fm(r,"strength"),fm(r,"radius","pt"),fm(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;XTe(s),e.push(s)}return e.join(" ")}function fm(t,e,r){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function Gtt(t,e){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}function jtt(t){return typeof t=="function"}function aIt(t,e,r,i){return jtt(t)?t(e,r,i):t}function lIt(t){return[t.r,t.g,t.b,t.a]}const Htt=` /-,
`;function Ase(t){let e=t.length;for(;e--;)if(!Htt.includes(t.charAt(e)))return!1;return!0}function qtt(t,e){const r=[];let i=0,s=-1;do if(s=t.indexOf("[",i),s>=i){if(s>i){const n=t.substr(i,s-i);r.push([n,null,Ase(n)])}if(i=s+1,s=t.indexOf("]",i),s>=i){if(s>i){const n=e[t.substr(i,s-i)];n&&r.push([null,n,!1])}i=s+1}}while(s!==-1);if(i<t.length-1){const n=t.substr(i);r.push([n,null,Ase(n)])}return r}function Wtt(t,e,r){let i="",s=null;for(const n of e){const[o,a,l]=n;if(o)l?s=o:(s&&(i+=s,s=null),i+=o);else{const c=t.attributes[a];c&&(s&&(i+=s,s=null),i+=c)}}return Ztt(i,r)}function cIt(t,e,r){const i=qtt(e,t);return s=>Wtt(s,i,r)}function Ztt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function uIt(t,e,r,i,s,n,o=!0){const a=e/s,l=r/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let d=0;d<n;d++)for(let f=0;f<s;f++){const m=4*(f+(o?n-d-1:d)*s);let y=0,_=0,v=0,w=0,T=0,x=0,S=0;const O=(d+.5)*l;for(let C=Math.floor(d*l);C<(d+1)*l;C++){const P=Math.abs(O-(C+.5))/h,$=(f+.5)*a,V=P*P;for(let z=Math.floor(f*a);z<(f+1)*a;z++){let B=Math.abs($-(z+.5))/c;const k=Math.sqrt(V+B*B);k>=-1&&k<=1&&(y=2*k*k*k-3*k*k+1,y>0&&(B=4*(z+C*e),S+=y*t[B+3],v+=y,t[B+3]<255&&(y=y*t[B+3]/250),w+=y*t[B],T+=y*t[B+1],x+=y*t[B+2],_+=y))}}i[m]=w/_,i[m+1]=T/_,i[m+2]=x/_,i[m+3]=S/v}}function JTe(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function Xtt(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function Ytt(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function Jtt(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function QTe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const hIt=(t,e=0)=>t==null||isNaN(t)?e:t,dIt=t=>t.tintColor?JTe(t.tintColor):{r:255,g:255,b:255,a:1},pIt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function fIt(){return ae(()=>import("./geometryEngineJSON-ec0b8702.js"),["assets/geometryEngineJSON-ec0b8702.js","assets/geometryEngineBase-df7c28c6.js","assets/geometryEngineJSON-f5db546b.js","assets/json-48e3ea08.js"])}function mIt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function gIt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function yIt(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function _It(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function Ose(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Ose(e);if(r!=null)return r}break;case"CIMTextSymbol":return Ose(t.symbol);case"CIMSolidFill":return t.color}}function Rse(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=Rse(r);if(i!=null)return i}break}case"CIMTextSymbol":return Rse(t.symbol);case"CIMSolidStroke":return t.color}}function Pse(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Pse(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return Pse(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function vIt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function bIt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function wIt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const xIt=t=>t.includes("data:image/svg+xml");function TIt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function KTe(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const s of t.effects)ert(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":Qtt(s,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":KTe(s.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function Qtt(t,e,r){if(t&&(t.markerPlacement&&Ktt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||KTe(i.symbol,e,!0,r)}function Ktt(t,e){switch(QTe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function ert(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function trt(t){const e=[];return lG(Xtt(t),e),e.length?new ke(JTe(e[0])):null}function lG(t,e){var s;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const n of r.symbolLayers)if(!(n.colorLocked||i&&(Jtt(n)||Ytt(n)&&n.markerPlacement&&QTe(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&Mse(e,n.tintColor);break;case"CIMVectorMarker":(s=n.markerGraphics)==null||s.forEach(o=>{lG(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Mse(e,n.color);break;case"CIMHatchFill":lG(n.lineSymbol,e)}}}function Mse(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}let e2e=class{constructor(e,r){this._storage=new cTe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new e2e(1e3);new ke([128,128,128]);const rrt=new ke("white");function irt(t){return ec(t.resource).href}function EIt(t,e){if(!t)return null;let r=null;return jb(t)?r=srt(t):R5(t)&&(r=t.type==="cim"?trt(t):t.color?new ke(t.color):null),r?ZO(r,e):null}function srt(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var s;i.type==="object"&&((s=i.resource)!=null&&s.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new ke(r):null}function ZO(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new ke(r)}function nrt(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>ZO(e=e??n??(r!=null?rrt:null),r);i.forEach(n=>{var o;if(n.type!=="object"||!((o=n.resource)!=null&&o.href)||e)if(n.type==="water")n.color=s(n.color);else{const a=n.material!=null?n.material.color:null,l=s(a);n.material==null?n.material=new su({color:l}):n.material.color=l,r!=null&&"outline"in n&&n.outline!=null&&n.outline.color!=null&&(n.outline.color=ZO(n.outline.color,r))}})}function ort(t,e,r){(e=e??t.color)&&(t.color=ZO(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=ZO(t.outline.color,r))}function CIt(t,e,r){t&&(e||r!=null)&&(e&&(e=new ke(e)),jb(t)?nrt(t,e,r):R5(t)&&ort(t,e,r))}async function art(t,e){const r=t.symbolLayers;r&&await r5(r,async i=>lrt(i,e))}async function lrt(t,e){switch(t.type){case"extrude":urt(t,e);break;case"icon":case"line":case"text":crt(t,e);break;case"path":drt(t,e);break;case"object":await hrt(t,e)}}function crt(t,e){const r=t2e(e);r!=null&&(t.size=r)}function t2e(t){for(const e of t)if(typeof e=="number")return e;return null}function urt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function hrt(t,e){const{resourceSize:r,symbolSize:i}=await prt(t),s=r2e(e,r,i);t.width=zA(e[0],i[0],r[0],s),t.depth=zA(e[1],i[1],r[1],s),t.height=zA(e[2],i[2],r[2],s)}function drt(t,e){const r=r2e(e,ug,[t.width,void 0,t.height]);t.width=zA(e[0],t.width,1,r),t.height=zA(e[2],t.height,1,r)}function r2e(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function prt(t){const{computeObjectLayerResourceSize:e}=await ae(()=>import("./symbolLayerUtils-893fa5ee.js"),[]),r=await e(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function zA(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function frt(t,e){const r=t2e(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function AIt(t,e){if(t&&e)return jb(t)?art(t,e):void(R5(t)&&frt(t,e))}function OIt(t,e,r){if(t&&e!=null)if(jb(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else R5(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function RIt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function PIt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function mrt(t,e,r,i,s){if(t==null)return null;const n=t.referencesGeometry()&&s?grt(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return Q.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const B8=new Map;function grt(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;B8.has(e)||B8.set(e,yrt(e));const o=B8.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function yrt(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>mwe(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>gwe(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>ywe(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>fwe(i,e,r,s,n);default:return Q.getLogger("esri.views.2d.support.arcadeOnDemand").error(new U("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const MIt=1.2,_rt=Cf;let XF=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Wi.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,gn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Wi.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=A()){return se(e,0,0,0)}getBoundingBoxObjectSpace(e=ln()){return Ti(e)}addObjectState(e,r){e===Vg.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,gn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,gn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(dx)&&(e.draped.origin[0]+=dx[0],e.draped.origin[1]+=dx[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){Ti(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Ise,i),U5e(n,Ise)}if(r){let o;Ud(n,dx);const a=TX(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(dx[0],dx[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)x5(Ep,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Ep[0]=n[0]-o,Ep[1]=n[1]-o,Ep[2]=n[2]-o,Ep[3]=n[0]+o,Ep[4]=n[1]+o,Ep[5]=n[2]+o}return r(Ep,0,2),this.calculateRelativeScreenBounds&&s.push({location:Ud(Ep),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),hW(Ep,i)}};const Ise=kt(),Ep=ln(),dx=A();let i2e=class{constructor(e,r,i,s=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=cG($se,tI,tI).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const v=e.measureText(y),w=v.width,T=w+r;this._textWidths.push(w),this._lineWidths.push(T),o=Math.max(o,T),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),_===0&&(s=v),_===this._lines.length-1&&(n=v)});const c=e.font;let h=Dse.get(c);if(!h){const y=e.measureText(brt);h=new xrt(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),Dse.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const d=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new wrt(a-f,l-m,d,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*vrt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case p_.Left:return this._backgroundHorizontalPadding;case p_.Center:return(this.displayWidth-this._lineWidths[e])/2;case p_.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,r+d,i),this._renderLineDecoration(e,r+d,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+d,i,this._textWidths[c]),i+=this._lineSpacing}if(oi.TEXT_SHOW_BASELINE){e.strokeStyle=Lse,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const d=c+this._baselinePosition;this._drawLine(e,[s,d],[s+this.displayWidth,d]),c+=this._lineSpacing}}if(oi.TEXT_SHOW_BORDER&&(e.strokeStyle=Lse,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=_e(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=cG($se,Math.max(o,tI),Math.max(a,tI)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,d,this._textWidths[f],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of s2e)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const d=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,h),e.stroke()}};const s2e=[];for(let e=0;e<360;e+=360/16)s2e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var p_;function cG(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(p_||(p_={}));const $se={canvas:null},vrt=.2,tI=512,Lse="rgb(255, 0, 255, 0.5)",brt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let wrt=class{constructor(e,r,i,s,n){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}},xrt=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const Dse=new Map,Trt=Object.freeze({left:0,center:.5,right:1}),OL=Object.freeze({"bottom-left":ur(0,0),bottom:ur(.5,0),"bottom-right":ur(1,0),left:ur(0,.5),center:ur(.5,.5),right:ur(1,.5),"top-left":ur(0,1),top:ur(.5,1),"top-right":ur(1,1)});function n2e(t){switch(t){case"left":return p_.Left;case"right":return p_.Right;default:return p_.Center}}function Nse(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Srt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Ert(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Crt(t){return t==="middle"?"center":t}let RS=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=ve(),this._shaderTransformation=null,this._boundingSphere=null,this.id=pc(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=$e(_s(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*nS(this.shaderTransformation),this._boundingSphere):Sye}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=$s(ve(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Art=ve(),Fse=Ae(0,0,1),Ort=16,Rrt=1.5,lb=fX,Prt=[lb/2,lb/2,1-lb/2,1-lb/2],Mrt=[kO*lb,kO*lb];let uG=class o2e extends sm{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=irt(this.symbolLayer),n=Db(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),e):await this._prepareResourcesHref(r,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=DF(this._getIconSize());if(e)throw new U("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?po(e.size):Ort);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height};i=new Iw(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(Irt(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:po(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(G8(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>ZZe(r));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=Prt;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/lb,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await uu(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw Io(o.error),new U("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[s,Math.round(s/l)]:[Math.round(s*l),s],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const s=new XS({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await ae(()=>import("./CIMSymbolRasterizer-a0c8a692.js"),["assets/CIMSymbolRasterizer-a0c8a692.js","assets/cimAnalyzer-08cbd577.js","assets/TileClipper-ae6eca9e.js","assets/definitions-411d1582.js","assets/number-e491b09e.js","assets/BidiEngine-9a40f2f4.js","assets/imageutils-a65e88aa.js","assets/rasterizingUtils-3cc107a1.js"])).CIMSymbolRasterizer;Qt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const d=h.scaleExpression,f=await hDe(d,this._context.layer.spatialReference,n);a=(m,y,_)=>{const v=mrt(f,m,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Qt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||iFe}_getOutlineSize(){let e=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(po(r.outline.size),0):(e=G8(this._getPrimitive())?Rrt:0,Math.max(e,0))}_getOutlineColor(){var s;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(s=r==null?void 0:r.outline)==null?void 0:s.color;if(i!=null){const n=ke.toUnitRGB(i),o=i.a*e;return[n[0],n[1],n[2],o]}return[0,0,0,0]}_getFillColor(){var i,s;if(G8(this._getPrimitive()))return _rt;const e=this._getPrimitive()==null,r=(s=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:s.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?ur((r.x||0)+.5,.5-(r.y||0)):e in OL?OL[e]:OL.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new SS(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=xS(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new SS(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Bi(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=po(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var d;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const f=this._generateTextureCIM(r),m={textureId:f.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(m,this._context.stage),s=[f.parameters.width,f.parameters.height]}else s=this._size,i=this._material;const n=GO(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((d=this._fastUpdates)!=null&&d.visualVariables.size)){const f=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,f)}l*=this._symbolTextureRatio;const c=ur(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(r,new dp);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,h,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HR(o2e.elevationModeChangeTypes,i,s);if(n!==ls.UPDATE)return n;const o=Rh(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!TS(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Ms.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return Ms.FastUpdate}_defaultElevationInfoNoZ(){return $rt}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?_=>k7(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=d7(i,Fse,null,s,n,Lrt,null,l,d),m=RX(this._context,r,f,o,a,c);if(m==null)return null;const y=new im(this,m.object,[f],null,null,Eb,o);return y.alignedSampledElevation=m.sampledElevation,y.needsElevationUpdates=Rh(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),BO(y,r,this._context.elevationProvider),y}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Yt();vo(r,a,this._context.overlaySR),a[2]=QX;const l=this._context.clippingExtent;if(l!=null&&!uW(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c&&this._fastUpdates?_=>k7(this._fastUpdates.materialParameters,c,_):void 0,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=d7(i,Fse,a,s,n,null,null,c,d),m=new RS(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h}),y=new XF(this,[m],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,h),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=Ue())=>{const a=r(Art);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=Ue())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Ae(e,e,e),i=bh(1),s=e*i,n=Ae(s,s,s);return new GR({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function Irt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function G8(t){return t!=null&&(t==="cross"||t==="x")}uG.PRIMITIVE_SIZE=Mrt,uG.elevationModeChangeTypes={definedChanged:ls.UPDATE,staysOnTheGround:ls.NONE,onTheGroundChanged:ls.RECREATE};const $rt={mode:"relative-to-ground",offset:0},Lrt=Ft(0,0,0,1);function hG(t){switch(t){case"butt":return mh.BUTT;case"square":return mh.SQUARE;case"round":return mh.ROUND;default:return null}}function Use(t){return t==="diamond"?"kite":t}function dG(t,e,r=null){const i=[],s=[],n=e.mapPositions;Drt(e,s,i);const o=s[0][1].data,a=i[0][1].length,l=sE(a);return Nrt(e,s,i,l),Vrt(e,s,i,l),Frt(e,s,i,l),Urt(e,s,i,l),zrt(e,s,i,l),krt(e,s,i,l),Brt(e,s,i,o),new Hs(t,s,i,n,as.Line,r)}function Drt(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=t,n=Grt(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([E.POSITION,new Ve(l,3,n)]),r.push([E.POSITION,a])}function Nrt(t,e,r,i){if(t.attributeData.colorFeature!=null)return;const s=t.attributeData.color;e.push([E.COLOR,new Ve(s??ah,4)]),r.push([E.COLOR,i])}function Frt(t,e,r,i){if(t.attributeData.normal==null)return;const s=t.attributeData.normal;e.push([E.NORMAL,new Ve(s,3)]),r.push([E.NORMAL,i])}function Urt(t,e,r,i){t.attributeData.colorFeature!=null&&(e.push([E.COLORFEATUREATTRIBUTE,new Ve([t.attributeData.colorFeature],1,!0)]),r.push([E.COLOR,i]))}function Vrt(t,e,r,i){t.attributeData.sizeFeature==null&&(e.push([E.SIZE,new Ve([t.attributeData.size??1],1,!0)]),r.push([E.SIZE,i]))}function zrt(t,e,r,i){t.attributeData.sizeFeature!=null&&(e.push([E.SIZEFEATUREATTRIBUTE,new Ve([t.attributeData.sizeFeature],1,!0)]),r.push([E.SIZEFEATUREATTRIBUTE,i]))}function krt(t,e,r,i){const s=t.attributeData.opacityFeature;s!=null&&(e.push([E.OPACITYFEATUREATTRIBUTE,new Ve([s],1,!0)]),r.push([E.OPACITYFEATUREATTRIBUTE,i]))}function Brt(t,e,r,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Le.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=zo(i.length),n=Nr(t.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)U5(i,f,s,f,n);const o=i.length/3,a=Qi(o+1);let l=jrt,c=Hrt,h=0,d=0;se(l,s[d++],s[d++],s[d++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(d=0),se(c,s[d++],s[d++],s[d++]),h+=s_e(l,c),a[f]=h,[l,c]=[c,l];e.push([E.DISTANCETOSTART,new Ve(a,1,!0)]),r.push([E.DISTANCETOSTART,r[0][1]])}function Grt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const jrt=A(),Hrt=A();function FIt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=zo(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function qrt(t,e,r,i){const s=t.type==="polygon"?jf.CCW_IS_HOLE:jf.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=ZR(n,!!t.hasZ,s),l=zo(o.length),c=Pwe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),h=c!=null;return{lines:h?a2e(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function Wrt(t,e){const r=t.type==="polygon"?jf.CCW_IS_HOLE:jf.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=ZR(i,!1,r),o=ai(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=QX;return{lines:o?a2e(n,s):[],projectionSuccess:o}}function a2e(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:fh(e,3*s,3*n),mapPositions:r!=null?fh(r,o,a):void 0})}return i}function Zrt(t){const e=new wr,r=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha),i=t.space===au.World;e.include(Dxe,t),e.include(Bxe,t),t.output===L.Depth&&e.include(Bg,t);const{vertex:s,fragment:n}=e;return n.include(Tc),gc(s,t),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),O_(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Sr("nearFar",(o,a)=>a.camera.nearFar),new ir("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(b`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(E.NORMAL,"vec3"),vS(s),s.constants.add("tiltThreshold","float",.7),s.code.add(b`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(b`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(b`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===iw.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===au.Screen&&(s.uniforms.add(new Ni("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(b`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(b`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Oe("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(b`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),uE(s,t),sF(e),s.code.add(b`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(b`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(b`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(b`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===au.Screen&&s.code.add(b`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(b`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(mu,t),e.include(ms,t),n.uniforms.add(new ir("intrinsicColor",o=>o.color),new Je("tex",o=>o.markerTexture)),n.include(rm),e.constants.add("texelSize","float",1/Cb),n.code.add(b`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",VX/Cb),e.constants.add("relativeTipLineWidth","float",tKe),n.code.add(b`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",ho),n.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Color&&t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===L.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""}
  }
  `),e}const Xrt=Object.freeze(Object.defineProperty({__proto__:null,build:Zrt},Symbol.toStringTag,{value:"Module"})),l2e=new Map([[E.POSITION,0],[E.UV0,2],[E.AUXPOS1,3],[E.NORMAL,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7]]);let c2e=class u2e extends Pr{initializeProgram(e){return new Cr(e.rctx,u2e.shader.get().build(this.configuration),l2e)}_makePipelineState(e,r){const i=this.configuration,s=e===st.NONE;return Ot({blending:i.output===L.Color||i.output===L.Alpha?s?ou:ry(e):null,depthTest:{func:q_(e)},depthWrite:s?i.writeDepth?Al:null:OF(e),colorWrite:jt,stencilWrite:i.hasOccludees?Hf:null,stencilTest:i.hasOccludees?r?F_:W_:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ot({blending:ou,depthTest:r4,depthWrite:null,colorWrite:jt,stencilWrite:null,stencilTest:Hxe}),this._occluderPipelineOpaque=Ot({blending:ou,depthTest:r4,depthWrite:null,colorWrite:jt,stencilWrite:Gxe,stencilTest:jxe}),this._occluderPipelineMaskWrite=Ot({blending:null,depthTest:zX,depthWrite:null,colorWrite:null,stencilWrite:Hf,stencilTest:F_})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===ce.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ce.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};c2e.shader=new Er(Xrt,()=>ae(()=>import("./LineMarker.glsl-6ba693d0.js"),[]));let Yrt=class extends H_{constructor(e){super(e,new Qrt),this._vertexAttributeLocations=l2e,this._configuration=new so,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===ce.DRAPED_MATERIAL?au.Draped:this.parameters.worldSpace?au.World:au.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==mh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Li.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Hi().vec3f(E.POSITION).vec2f(E.UV0).vec3f(E.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(E.NORMAL),this.parameters.vvSize?e.f32(E.SIZEFEATUREATTRIBUTE):e.f32(E.SIZE),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4f(E.COLOR),this.parameters.vvOpacity&&e.f32(E.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Krt(this._layout,this.parameters)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth?e===ce.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Li.OccludeAndTransparentStencil?e===ce.OPAQUE_MATERIAL||e===ce.OCCLUDER_MATERIAL||e===ce.TRANSPARENT_OCCLUDER_MATERIAL:r===L.Color||r===L.Alpha?e===(this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ce.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Jrt(e)}},Jrt=class extends aZ{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(c2e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Qrt=class extends jR{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=mh.BUTT,this.anchor=iw.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Krt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.vertexAttributes.get(E.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(E.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let h=1,d=0;this._parameters.vvSize?d=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(h=i.vertexAttributes.get(E.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(f=i.vertexAttributes.get(E.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const w=(O,C,P,$)=>{if(_[v++]=O[0],_[v++]=O[1],_[v++]=O[2],_[v++]=P[0],_[v++]=P[1],_[v++]=C[0],_[v++]=C[1],_[v++]=C[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=d:_[v++]=h,this._parameters.vvColor)_[v++]=m;else{const V=Math.min(4*$,f.length-4);_[v++]=f[V],_[v++]=f[V+1],_[v++]=f[V+2],_[v++]=f[V+3]}this._parameters.vvOpacity&&(_[v++]=y)};let T;(function(O){O[O.ASCENDING=1]="ASCENDING",O[O.DESCENDING=-1]="DESCENDING"})(T||(T={}));const x=(O,C)=>{const P=se(eit,o[3*O],o[3*O+1],o[3*O+2]),$=tit;let V=O+C;do se($,o[3*V],o[3*V+1],o[3*V+2]),V+=C;while(m_(P,$)&&V>=0&&V<a);e&&($e(P,P,e),$e($,$,e)),w(P,$,[-1,-1],O),w(P,$,[1,-1],O),w(P,$,[1,1],O),w(P,$,[-1,-1],O),w(P,$,[1,1],O),w(P,$,[-1,1],O)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,T.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,T.DESCENDING)}};const eit=A(),tit=A(),Wo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},rit={dash:Wo.dash,"dash-dot":[...Wo.dash,...Wo.dot],dot:Wo.dot,"long-dash":Wo["long-dash"],"long-dash-dot":[...Wo["long-dash"],...Wo.dot],"long-dash-dot-dot":[...Wo["long-dash"],...Wo.dot,...Wo.dot],none:null,"short-dash":Wo["short-dash"],"short-dash-dot":[...Wo["short-dash"],...Wo["short-dot"]],"short-dash-dot-dot":[...Wo["short-dash"],...Wo["short-dot"],...Wo["short-dot"]],"short-dot":Wo["short-dot"],solid:null},iit=8;function sit(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function BIt(t){return{pattern:[t,t],pixelRatio:2}}function h2e(t){return t!=null&&t.type==="style"?nit(t.style):null}function nit(t){return t!=null?sit(rit[t],iit):null}const oit=["polyline","polygon","extent"],Vse=new GR({size:!0,color:!0,rotation:!1,opacity:!0});let d2e=class p2e extends sm{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._fastUpdates=xS(this._context.renderer,Vse),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:bh(1))<0)throw new U("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){var n,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:hG(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:h2e(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return(o=this._fastUpdates)!=null&&o.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new i2(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new i2(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new i2({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new i2({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new Yrt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Use(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(e){return this._drivenProperties.size&&e.size?po(EQe(e.size)):1}_getDrivenColor(e){const r=Ft(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,oit,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new dp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return Ms.RecreateSymbol;{const s=this._fastUpdates;if(!TS(s,r,Vse))return Ms.RecreateSymbol;this._forEachMaterial(n=>n.setParameters(s.materialParameters))}}return Ms.FastUpdate}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=hG(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){var a,l;const i=e.parameters.color,s=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Ft(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HR(p2e.elevationModeChangeTypes,i,s);if(n!==ls.UPDATE)return n;const o=Rh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof _r)return Zd.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=ln(),c=qrt(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(Ti(l),tu(l,v),!Vd(l,this._context.clippingExtent)))continue;const w=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,n.type,kA.ELEVATED,i);a.push(w),oi.LINE_WIREFRAMES&&a.push(w.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new iy({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),f=new im(this,d,a,null,null,WYe,r);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=Rh(r.mode),f}_createGeometry(e,r,i,s,n,o,a){var _,v,w;const l=o===kA.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",h=(_=this._fastUpdates)==null?void 0:_.visualVariables.color,d=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,f=(w=this._fastUpdates)==null?void 0:w.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:i,size:d?null:this._getDrivenSize(r.renderingInfo),color:h?null:this._getDrivenColor(r.renderingInfo),sizeFeature:d?Jd(d.field,r.graphic):null,colorFeature:h?Jd(h.field,r.graphic):null,opacityFeature:f?Jd(f.field,r.graphic):null};return dG(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:y},m)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=oi.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=ln(),d=Ti(),f=Wrt(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(Ti(h),tu(h,y.position),!Vd(h,this._context.clippingExtent))continue;J2(d,h);const _=v=>{const w=this._createGeometry(v,e,y.position,void 0,s.type,kA.DRAPED,i.uid),T=new RS(w,{layerUid:r,graphicUid:i.uid});c.push(T)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||tu(h,y.position,0,1),v!=="end"&&v!=="begin-end"||tu(h,y.position,y.position.length-3,1)}_(o),oi.LINE_WIREFRAMES&&_(a)}return new XF(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??bh(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?po(1):1:po(e)}_prepareMaterialPatch(e,r,i){var a,l;const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?(a=s.newValue)==null?void 0:a.color:((l=s.diff.color)==null?void 0:l.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(OR(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){var h;const i=r.marker,s=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=i.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),s,e);const c=(h=i.diff.style)==null?void 0:h.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:Use(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var kA;d2e.elevationModeChangeTypes={definedChanged:ls.RECREATE,staysOnTheGround:ls.NONE,onTheGroundChanged:ls.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(kA||(kA={}));let eC=null,o4=!0;function j8(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(o4)try{return new ImageData(t,e)}catch{o4=!1}return f2e(t,e,r)}function ait(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(o4)try{return new ImageData(t,e,r)}catch{o4=!1}const s=f2e(e,r,i);return s.data.set(t,0),s}function lit(){return eC||(eC=document.createElement("canvas"),eC.width=1,eC.height=1),eC}function f2e(t,e,r){return r||(r=lit()),r.getContext("2d").createImageData(t,e)}var pT;const H8=new WeakMap;let cit=0,Xp=pT=class extends de{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:Dg(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:Dg(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(H8.has(this.data)||H8.set(this.data,++cit),e(H8.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new pT(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return ait(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new pT({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new pT({data:t}):$b(pT,t)}};u([p({type:String,json:{write:w_}})],Xp.prototype,"url",null),u([p({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),p()],Xp.prototype,"data",null),u([De("data")],Xp.prototype,"writeData",null),u([Se("data")],Xp.prototype,"readData",null),u([p({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Xp.prototype,"transparent",null),u([p({json:{write:!0}})],Xp.prototype,"wrap",void 0),u([p({readOnly:!0})],Xp.prototype,"contentHash",null),Xp=pT=u([R("esri.geometry.support.MeshTexture")],Xp);const BA=Xp;let fT=class extends ji(de){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};u([p({type:[Number],nonNullable:!0,json:{write:!0}})],fT.prototype,"offset",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],fT.prototype,"rotation",void 0),u([p({type:[Number],nonNullable:!0,json:{write:!0}})],fT.prototype,"scale",void 0),fT=u([R("esri.geometry.support.MeshTextureTransform")],fT);const A2=fT;var pG;let ld=pG=class extends de{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new pG(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){var e,r,i,s;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(i=this.colorTextureTransform)==null?void 0:i.clone(),normalTextureTransform:(s=this.normalTextureTransform)==null?void 0:s.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};u([p({type:ke,json:{write:!0}})],ld.prototype,"color",void 0),u([p({type:BA,json:{write:!0}})],ld.prototype,"colorTexture",void 0),u([p({type:A2,json:{write:!0}})],ld.prototype,"colorTextureTransform",void 0),u([p({type:BA,json:{write:!0}})],ld.prototype,"normalTexture",void 0),u([p({type:A2,json:{write:!0}})],ld.prototype,"normalTextureTransform",void 0),u([p({nonNullable:!0,json:{write:!0}})],ld.prototype,"alphaMode",void 0),u([p({nonNullable:!0,json:{write:!0}})],ld.prototype,"alphaCutoff",void 0),u([p({nonNullable:!0,json:{write:!0}})],ld.prototype,"doubleSided",void 0),ld=pG=u([R("esri.geometry.support.MeshMaterial")],ld);const lY=ld;var fG;let Vu=fG=class extends lY{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new fG(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,r,i,s,n,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(t),emissiveTextureTransform:(i=this.emissiveTextureTransform)==null?void 0:i.clone(),occlusionTexture:(s=this.occlusionTexture)==null?void 0:s.cloneWithDeduplication(t),occlusionTextureTransform:(n=this.occlusionTextureTransform)==null?void 0:n.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};u([p({type:ke,json:{write:!0}})],Vu.prototype,"emissiveColor",void 0),u([p({type:BA,json:{write:!0}})],Vu.prototype,"emissiveTexture",void 0),u([p({type:A2,json:{write:!0}})],Vu.prototype,"emissiveTextureTransform",void 0),u([p({type:BA,json:{write:!0}})],Vu.prototype,"occlusionTexture",void 0),u([p({type:A2,json:{write:!0}})],Vu.prototype,"occlusionTextureTransform",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Vu.prototype,"metallic",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Vu.prototype,"roughness",void 0),u([p({type:BA,json:{write:!0}})],Vu.prototype,"metallicRoughnessTexture",void 0),u([p({type:A2,json:{write:!0}})],Vu.prototype,"metallicRoughnessTextureTransform",void 0),Vu=fG=u([R("esri.geometry.support.MeshMaterialMetallicRoughness")],Vu);const m2e=Vu;var RL;const g2e="esri.geometry.support.MeshVertexAttributes",px=Q.getLogger(g2e);let wu=RL=class extends de{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return mT(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},px)}castPosition(t){return t&&t instanceof Float32Array&&px.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),mT(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},px)}castUv(t){return mT(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},px)}castNormal(t){return mT(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},px)}castTangent(t){return mT(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},px)}clone(){const t={position:K(this.position),uv:K(this.uv),normal:K(this.normal),tangent:K(this.tangent),color:K(this.color)};return new RL(t)}clonePositional(){const t={position:K(this.position),normal:K(this.normal),tangent:K(this.tangent),uv:this.uv,color:this.color};return new RL(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function q8(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function mT(t,e,r,i,s){if(!t)return t;if(t instanceof e)return q8(t,i,e,s);for(const n of r)if(t instanceof n)return q8(new e(t),i,e,s);if(Array.isArray(t))return q8(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function tC(t,e,r){e[r]=uit(t)}function uit(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}u([p({json:{write:tC}})],wu.prototype,"color",void 0),u([yr("color")],wu.prototype,"castColor",null),u([p({nonNullable:!0,json:{write:tC}})],wu.prototype,"position",void 0),u([yr("position")],wu.prototype,"castPosition",null),u([p({json:{write:tC}})],wu.prototype,"uv",void 0),u([yr("uv")],wu.prototype,"castUv",null),u([p({json:{write:tC}})],wu.prototype,"normal",void 0),u([yr("normal")],wu.prototype,"castNormal",null),u([p({json:{write:tC}})],wu.prototype,"tangent",void 0),u([yr("tangent")],wu.prototype,"castTangent",null),wu=RL=u([R(g2e)],wu);var O3;const y2e="esri.geometry.support.MeshComponent",hit=Q.getLogger(y2e);let Dm=O3=class extends de{static from(t){return $b(O3,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return mT(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},hit)}castMaterial(t){return $b(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?m2e:lY,t)}clone(){return new O3({faces:K(this.faces),shading:this.shading,material:K(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:K(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new O3(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};u([p({json:{write:!0}})],Dm.prototype,"faces",void 0),u([yr("faces")],Dm.prototype,"castFaces",null),u([p({type:lY,json:{write:!0}})],Dm.prototype,"material",void 0),u([yr("material")],Dm.prototype,"castMaterial",null),u([p({type:String,json:{write:!0}})],Dm.prototype,"shading",void 0),u([p({type:Boolean})],Dm.prototype,"trustSourceNormals",void 0),Dm=O3=u([R(y2e)],Dm);const dit=Dm,YF=Q.getLogger("esri.geometry.support.meshUtils.normalProjection");function pit(t,e,r,i,s){return QF(i)?(JF(xg.TO_PCPF,an.fromTypedArray(t),Ah.fromTypedArray(e),Ah.fromTypedArray(r),i,an.fromTypedArray(s)),s):(YF.error("Cannot convert spatial reference to PCPF"),s)}function jIt(t,e,r,i,s){return QF(i)?(JF(xg.FROM_PCPF,an.fromTypedArray(t),Ah.fromTypedArray(e),Ah.fromTypedArray(r),i,an.fromTypedArray(s)),s):(YF.error("Cannot convert to spatial reference from PCPF"),s)}function HIt(t,e,r){return ai(t,e,0,r,zf(e),0,t.length/3),r}function qIt(t,e,r){return ai(t,zf(r),0,e,r,0,t.length/3),e}function fit(t,e,r){return A_(Un,r),rw(e,t,Un),mZ(Un)||VF(e,e),e}function mit(t,e,r){if(A_(Un,r),rw(e,t,Un,4),mZ(Un)||VF(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function git(t,e,r,i,s){if(!QF(i))return YF.error("Cannot convert spatial reference to PCPF"),s;JF(xg.TO_PCPF,an.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Ah.fromTypedArray(e),Ah.fromTypedArray(r),i,an.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function WIt(t,e,r,i,s){if(!QF(i))return YF.error("Cannot convert to spatial reference from PCPF"),s;JF(xg.FROM_PCPF,an.fromTypedArray(t,16),Ah.fromTypedArray(e),Ah.fromTypedArray(r),i,an.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function JF(t,e,r,i,s,n){if(!e)return;const o=r.count,a=zf(s);if(_2e(s))for(let l=0;l<o;l++)i.getVec(l,rI),e.getVec(l,Cp),xl(a,rI,iI,a),Eh(Un,iI),t===xg.FROM_PCPF&&Ch(Un,Un),cc(Cp,Cp,Un),n.setVec(l,Cp);else for(let l=0;l<o;l++){i.getVec(l,rI),e.getVec(l,Cp),xl(a,rI,iI,a),Eh(Un,iI);const c=LD(r.get(l,1));let h=Math.cos(c);t===xg.TO_PCPF&&(h=1/h),Un[0]*=h,Un[1]*=h,Un[2]*=h,Un[3]*=h,Un[4]*=h,Un[5]*=h,t===xg.FROM_PCPF&&Ch(Un,Un),cc(Cp,Cp,Un),ge(Cp,Cp),n.setVec(l,Cp)}return n}function QF(t){return _2e(t)||yit(t)}function _2e(t){return t.isWGS84||Rde(t)||Yf(t)||Jf(t)}function yit(t){return t.isWebMercator}var xg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(xg||(xg={}));const rI=A(),Cp=A(),iI=ve(),Un=Fi();var GA;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(GA||(GA={}));let v2e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=yg.KTX2_ENCODING}};function Rb(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function _it(t){return new Promise((e,r)=>{const i=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function vit(t,e){return e===yg.KTX2_ENCODING?new v2e(t):new Promise((r,i)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=h=>{URL.revokeObjectURL(n),i(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function mf(t){if(t==null)return null;const e=t.offset!=null?t.offset:txe,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:rxe,s=AL(1,0,0,0,1,0,e[0],e[1],1),n=AL(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=AL(i[0],0,0,0,i[1],0,0,0,1),a=Sl();return pS(a,n,o),pS(a,s,a),a}Q.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");let bit=class extends im{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,s=i.geometries.slice();i.removeAllGeometries();const n=Pk(W8,i.transformation),o=r.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=s}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(s=>e(s.material));r.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=i[s];o.setParameters({modelTransformation:null}),o===n.material?r.addGeometry(n):r.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=Pk(W8,e),a=i.getOrigin(o);if(a===n)return;const l=(r==null?void 0:r.localMatrix)??nn;s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:s}=this,n=(r==null?void 0:r.localMatrix)??nn;if(!this._fastTransformUpdatesEnabled)return s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(m=>{m.transformation=n}),void this.resetEdgeObject(i);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,h=ni(zse,o,a),d=ni(kse,l,c);s.shaderTransformation=l,this._setFastMaterialTransformation({matA:h,matB:d});const f=()=>c;for(const m of s.geometries)m.shaderTransformer=f;this.resetEdgeObject(i)}alignWithElevation(e,r,i,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,s);i!=null&&NF(this.elevationContext.featureExpressionInfoContext,i);const n=(m,y)=>$_(m,e,this.elevationContext,r,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=ni(zse,a,l),h=$s(wit,o.shaderTransformation);this.alignedSampledElevation=Eb(this,this.elevationContext,e.spatialReference,n,r,h),o.shaderTransformation=h;const d=o.geometries[0].shaderTransformation,f=ni(kse,h,d);this._setFastMaterialTransformation({matA:c,matB:f}),this.resetEdgeObject(s)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const s=i.geometries[0].localOrigin,n=CR(xit,ie(W8,s.vec3,-1)),o=ni(Bse,n,e),a=ni(Gse,n,r),l=xn(Bse,o),c=ni(Gse,a,l);for(const h of i.geometries)h.material.setParameters({modelTransformation:c})}};const W8=A(),zse=ve(),kse=ve(),wit=ve(),Bse=ve(),Gse=ve(),xit=ve();let Tit=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=r.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),r.delete(s),s}const n=new qf(s.parameters);return i.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},i.localOriginFactory)}disable(e,r,i){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,h=this._fastTransformOriginalMaterials.get(c);return r.has(h.uid)?(s.add(c),r.byUid(h.uid).material):(n.add(c),h.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),a.dispose(),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o),o.dispose();for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},Sit=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){var i;const r=(i=this._byMaterial.get(e))==null?void 0:i.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function Eit(t){const e=new wr,{vertex:r,fragment:i}=e;return e.include(wl,t),e.include(Lw,t),e.include(zxe,t),gc(r,t),t.stippleEnabled&&(e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),r.uniforms.add(new ir("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(E.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(b`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(b`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Oe("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(b`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(b`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Oe("stipplePatternPixelSize",s=>UX(s))),r.code.add(b`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(b`}`),t.output===L.Highlight&&e.include(ty,t),e.include(ms,t),i.uniforms.add(new Oe("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new ir("constantColor",s=>s.color)),i.code.add(b`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(ho)}) {
      discard;
    }

    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Highlight?b`outputHighlight();`:""}
  }
  `),e}const Cit=Object.freeze(Object.defineProperty({__proto__:null,build:Eit},Symbol.toStringTag,{value:"Module"}));let b2e=class w2e extends Pr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==L.Highlight}initializeProgram(e){return new Cr(e.rctx,w2e.shader.get().build(this.configuration),br)}initializePipeline(){const e=this.configuration,r=bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Ot({blending:n,depthTest:zX,depthWrite:o,colorWrite:jt,stencilWrite:e.hasOccludees?Hf:null,stencilTest:e.hasOccludees?s?F_:W_:null});return e.output===L.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,Al),i(!1,e.transparent||this._stippleEnabled?r:null,Al)):i(!1)}get primitiveType(){return Et.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};b2e.shader=new Er(Cit,()=>ae(()=>import("./NativeLine.glsl-03a0c3fe.js"),[]));let Dc=class extends No{constructor(){super(...arguments),this.output=L.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([F({count:L.COUNT})],Dc.prototype,"output",void 0),u([F()],Dc.prototype,"hasSlicePlane",void 0),u([F()],Dc.prototype,"hasVertexColors",void 0),u([F()],Dc.prototype,"transparent",void 0),u([F()],Dc.prototype,"draped",void 0),u([F()],Dc.prototype,"stippleEnabled",void 0),u([F()],Dc.prototype,"stippleOffColorEnabled",void 0),u([F()],Dc.prototype,"stipplePreferContinuous",void 0),u([F()],Dc.prototype,"hasOccludees",void 0),u([F({constValue:!1})],Dc.prototype,"stippleRequiresClamp",void 0),u([F({constValue:!1})],Dc.prototype,"stippleScaleWithLineWidth",void 0),u([F({constValue:!1})],Dc.prototype,"stippleRequiresStretchMeasure",void 0);var a4;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(a4||(a4={}));let jse=class extends H_{constructor(e){super(e,new Rit),this._configuration=new Dc}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===ce.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!n_e(r))return void Q.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(E.POSITION).data,l=i.camera,c=Mit;cn(c,i.point);const h=2;se(rC[0],c[0]-h,c[1]+h,0),se(rC[1],c[0]+h,c[1]+h,0),se(rC[2],c[0]+h,c[1]-h,0),se(rC[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(rC[_],mm[_]))return;ea(l.eye,mm[0],mm[1],Z8),ea(l.eye,mm[1],mm[2],X8),ea(l.eye,mm[2],mm[3],Y8),ea(l.eye,mm[3],mm[0],J8);let d=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Ea[0]=a[_]+r[12],Ea[1]=a[_+1]+r[13],Ea[2]=a[_+2]+r[14],Ca[0]=a[_+3]+r[12],Ca[1]=a[_+4]+r[13],Ca[2]=a[_+5]+r[14],fi(Z8,Ea)<0&&fi(Z8,Ca)<0||fi(X8,Ea)<0&&fi(X8,Ca)<0||fi(Y8,Ea)<0&&fi(Y8,Ca)<0||fi(J8,Ea)<0&&fi(J8,Ca)<0)continue;if(l.projectToRenderScreen(Ea,xv),l.projectToRenderScreen(Ca,Tv),xv[2]<0&&Tv[2]>0){he(Ap,Ea,Ca);const w=l.frustum,T=-fi(w[pi.NEAR],Ea)/me(Ap,w[pi.NEAR]);ie(Ap,Ap,T),le(Ea,Ea,Ap),l.projectToRenderScreen(Ea,xv)}else if(xv[2]>0&&Tv[2]<0){he(Ap,Ca,Ea);const w=l.frustum,T=-fi(w[pi.NEAR],Ca)/me(Ap,w[pi.NEAR]);ie(Ap,Ap,T),le(Ca,Ca,Ap),l.projectToRenderScreen(Ca,Tv)}else if(xv[2]<0&&Tv[2]<0)continue;xv[2]=0,Tv[2]=0;const v=LW(bb(xv,Tv,Wse),c);v<d&&(d=v,re(Hse,Ea),re(qse,Ca),f=_/3)}const m=i.rayBegin,y=i.rayEnd;if(d<h*h){let _=Number.MAX_VALUE;if(bye(bb(Hse,qse,Wse),bb(m,y,Pit),wv)){he(wv,wv,m);const v=Ee(wv);ie(wv,wv,1/v),_=v/mi(m,y)}o(_,wv,f,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(E.POSITION).data,l=e.vertexAttributes.get(E.SIZE),c=l?l.data[0]:0,h=s[0],d=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],T=h-v,x=d-w,S=a[_+3]-v,O=a[_+4]-w,C=_e((S*T+O*x)/(S*S+O*O),0,1),P=S*C-T,$=O*C-x,V=P*P+$*$;V<m&&(m=V,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}requiresSlot(e,r){return!(r!==L.Color&&r!==L.Highlight&&r!==L.ObjectAndLayerIdColor||e!==ce.OPAQUE_MATERIAL&&e!==ce.DRAPED_MATERIAL)}createGLMaterial(e){return new Ait(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?RKe:AKe;return this.parameters.stipplePattern==null?new hE(e):new Oit(e.clone().vec3f(E.AUXPOS1).vec2f(E.UV0))}},Ait=class extends G_{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===L.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(b2e,e)}},Oit=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(E.POSITION).length}write(e,r,i,s,n){Abe(i,this.vertexBufferLayout,e,r,s,n),this._writeAuxpos1(e,i,s,n),this._writeUV0(e,i,s,n)}_writeAuxpos1(e,r,i,s){const n=i.getField(E.AUXPOS1,an),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let d=0;d<o.length-1;d+=2)for(const f of[1,0]){const m=3*o[d+f],y=a[m],_=a[m+1],v=a[m+2],w=l[0]*y+l[4]*_+l[8]*v+l[12],T=l[1]*y+l[5]*_+l[9]*v+l[13],x=l[2]*y+l[6]*_+l[10]*v+l[14];h[s]=w,h[s+1]=T,h[s+2]=x,s+=c}}_writeUV0(e,r,i,s){var x;const n=i.getField(E.UV0,j_),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=(x=r.vertexAttributes.get(E.DISTANCETOSTART))==null?void 0:x.data,c=n.typedBufferStride,h=n.typedBuffer;let d=0;h[s*=c]=a4.START,h[s+1]=d,s+=c;const f=3*o[0],m=se(Ea,a[f],a[f+1],a[f+2]);e&&$e(m,m,e);const y=Ca,_=o.length-1;let v=1;const w=l?(S,O,C)=>d=l[C]:(S,O,C)=>d+=mi(S,O);for(let S=1;S<_;S+=2){const O=3*o[S];se(y,a[O],a[O+1],a[O+2]),e&&$e(y,y,e),w(m,y,v++);for(let C=0;C<2;++C)h[s]=1-C,h[s+1]=d,s+=c;re(m,y)}const T=3*o[_];se(y,a[T],a[T+1],a[T+2]),e&&$e(y,y,e),w(m,y,v),h[s]=a4.END,h[s+1]=d}},Rit=class extends cX{constructor(){super(...arguments),this.color=ah,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Ea=A(),Ca=A(),Ap=A(),wv=A(),xv=Vo(),Tv=Vo(),Hse=A(),qse=A(),Wse=cp(),Pit=cp(),Mit=A(),rC=[Vo(),Vo(),Vo(),Vo()],mm=[A(),A(),A(),A()],Z8=Ir(),X8=Ir(),Y8=Ir(),J8=Ir(),Iit=["mesh"];let $it=class extends sm{constructor(e,r,i,s){super(e,r,i,s),this._materialInfoCache=new Sit,this._fastUpdateProcessor=new Tit,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){oi.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new jse({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new jse({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Iit,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new dp),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=r(s);n!=null&&n.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,L_)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const s=r(i);s!=null&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=Lit,{origin:a,transform:l}=i;switch(xl(r,se(Qn,a.x,a.y,a.z??0),o,n),s){case GA.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case GA.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case GA.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:h,renderCoordsHelper:d}=this._context,f=(m,y)=>$_(m,h,c,d,y);return e.alignedSampledElevation=Eb(e,c,h.spatialReference,f,d,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof ke?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:s}=e??Nit;return`${r[0]},${r[1]},${s},${i[0]},${i[1]}`}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:h,alphaCutoff:d,alphaMode:f}=r.material,m=this._colorOrTextureUid(n),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),w=this._textureTransformUid(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${m},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${w},ds:${h},ac:${d},am:${f}`,r.material instanceof m2e){const{metallic:T,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:O,emissiveColor:C,emissiveTexture:P,emissiveTextureTransform:$,occlusionTexture:V,occlusionTextureTransform:z}=r.material,B=this._colorOrTextureUid(S),k=this._textureTransformUid(O),Z=this._colorOrTextureUid(C),W=this._colorOrTextureUid(P),j=this._textureTransformUid($),Y=this._colorOrTextureUid(V),M=this._textureTransformUid(z);s.metallic=T,s.roughness=x,s.metallicRoughnessTexture=S,s.emissiveColor=C,s.emissiveTexture=P,s.occlusionTexture=V,s.colorTextureTransform=this._convertTextureTransform(a),s.normalTextureTransform=this._convertTextureTransform(c),s.emissiveTextureTransform=this._convertTextureTransform($),s.occlusionTextureTransform=this._convertTextureTransform(z),s.metallicRoughnessTextureTransform=this._convertTextureTransform(O),s.uid=`${s.uid},mrm:${T},mrr:${x},mrt:${B},mrtt:${k},emuid:${Z},etmuid:${W},ett:${j},otmuid:${Y},ott:${M}`}return s}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:s}=e;return{scale:r,offset:i,rotation:Ut(s)}}_setInternalColorValueParameters(e,r){r.diffuse=ke.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Xr.Opaque);return r!=null?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new Iw(Rb(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!Rb(i)&&r!==Xr.Opaque,encoding:Rb(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Dt.CLAMP_TO_EDGE;case"mirror":return Dt.MIRRORED_REPEAT;default:return Dt.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(r.emissiveFactor=ke.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=mf(e.colorTextureTransform),r.normalTextureTransformMatrix=mf(e.normalTextureTransform),r.occlusionTextureTransformMatrix=mf(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=mf(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=mf(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=ah;else{const s=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;s!=null?e.externalColor=ke.toUnitRGBA(s):(i=null,e.externalColor=ah)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var y,_,v;const i=(y=r.material)==null?void 0:y.color,s=(_=r.material)==null?void 0:_.colorTexture,n=(v=r.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||s!=null&&s.transparent||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const h={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},d=STe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:ke.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Ba,diffuse:ug,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:gi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=d?[...tY]:[l.metallic,l.roughness,qF[2]],r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?gi.None:gi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new qf(f);return h.material=m,this._materialInfoCache.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Xr.MaskBlend:Xr.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Xr.Opaque:r.alphaMode==="mask"?Xr.Mask:Xr.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const y=r[m],_=y.vertexAttributes.get(E.POSITION),v=y.vertexAttributes.get(E.NORMAL),w=y.indices.get(E.POSITION),T=y.indices.get(E.NORMAL),x=_.data,S=v.data;for(let O=0;O<w.length;O++){const C=3*w[O],P=3*T[O];for(let $=0;$<3;$++)o.push(x[C+$]);for(let $=0;$<3;$++)o.push(x[C+$]+S[P+$]*n);if(a.push(a.length),a.push(a.length),O%3==0){this._calculateFaceNormal(x,w,O,gx),this._getFaceVertices(x,w,O,Qn,fx,mx),le(Qn,Qn,fx),le(Qn,Qn,mx),ie(Qn,Qn,1/3);for(let $=0;$<3;$++)l.push(Qn[$]);for(let $=0;$<3;$++)l.push(Qn[$]+gx[$]*n);c.push(c.length),c.push(c.length)}}}const h=r[0].transformation,d=new Hs(this._debugVertexNormalMaterial,[[E.POSITION,new Ve(o,3,!0)]],[[E.POSITION,a]],null,as.Line);r.push(d),d.transformation=h;const f=new Hs(this._debugFaceNormalMaterial,[[E.POSITION,new Ve(l,3,!0)]],[[E.POSITION,c]],null,as.Line);f.transformation=h,r.push(f)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;oi.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new iy({geometries:a,layerUid:this._context.layer.uid,graphicUid:s});c.transformation=l;const h=jwe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=h!=null?new sJe(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new bit(this,c,a,null,null,Eb,i,d);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=L_(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(v,w)=>$_(v,m,i,y,w);return f.alignedSampledElevation=Eb(f,i,m.spatialReference,_,y),f}_getCenterPointInElevationSR(e){const r=$w(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return SW([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(r==null)return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,gx);for(let a=0;a<3;a++){const l=3*s[o+a];Qn[0]=r[l],Qn[1]=r[l+1],Qn[2]=r[l+2],me(gx,Qn)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new Q8(r,s,n)}_createComponentNormalsFlat(e,r){const i=Qi(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,gx);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new Q8(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,gx);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:A(),count:0},i[c]=h),le(h.normal,h.normal,a),h.count++}}const s=Qi(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(ge(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new Q8(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,Qn,fx,mx),he(fx,fx,Qn),he(mx,mx,Qn),ot(Qn,fx,mx),ge(s,Qn),s}_getOrCreateComponents(e){return e.components??Dit}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===Zl.ECEF?r.transformBeforeProject:null;if(s!=null&&(i=AS(new Float64Array(i.length),i,s)),r.reprojection===Zl.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s!=null?i:new Float64Array(i.length);return ai(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===Zl.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=fit(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Zl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return pit(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===Zl.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=mit(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Zl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return git(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const s=this._getVertexOpacityAndColor(e),n=ATe((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return OTe(s,n,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s!=null&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n!=null&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(r),d=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===Zl.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,d,f),geometryTransformation:a.reprojection===Zl.NONE&&a.geometryTransformation!=null?a.geometryTransformation:ve()}}_computeReprojectionInfo(e){var n;const{vertexSpace:r}=e,i=r.isRelative,s=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===Le.Local?Zl.NONE:Zl.ECEF:Zl.NONE;if(i){const{origin:o}=r,a=ve(),l=((n=e.transform)==null?void 0:n.localMatrix)??nn;if(s===Zl.NONE)return xl(e.spatialReference,o,a,this._context.renderCoordsHelper.spatialReference),{reprojection:s,objectTransformation:a,geometryTransformation:iS(l),needsBufferCopy:!1};const c=CR(ve(),o);return ni(c,c,l),{reprojection:s,transformBeforeProject:c,needsBufferCopy:!0}}return{reprojection:s,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;sI[0]=o.x,sI[1]=o.y,sI[2]=o.z??0;const a=ve();return xl(e.spatialReference,sI,a,n),xn(Zse,a),AS(r,r,Zse),i==null&&s==null||(Eh(iC,a),Ch(iC,iC),i!=null&&rw(i,i,iC),s!=null&&rw(s,s,iC,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??mS(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return i==null||e.spatialReference.equals(i)?s=r:(s=new Float64Array(r.length),ai(e.vertexAttributes.position,e.spatialReference,0,s,i,0,n)),Ti(K8),tu(K8,s,0,n),!Vd(K8,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!Uf(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:d,geometryTransformation:f}=s,m=this._getOrCreateComponents(e),y=new Array;let _=!1;for(const v of m){if(!this._validateFaces(e,v))return null;const w=this._getOrCreateFaces(e,v);if(w.length===0)continue;const T=this._createComponentNormals(n,c,v,w);T.didFlipNormals&&(_=!0);const x=[[E.POSITION,new Ve(n,3,!0)],[E.NORMAL,new Ve(T.normals,3,!0)]],S=[[E.POSITION,w],[E.NORMAL,T.indices]];a!=null&&(x.push([E.COLOR,new Ve(a,4,!0)]),S.push([E.COLOR,w])),l!=null&&(x.push([E.SYMBOLCOLOR,new Ve(l,4,!0)]),S.push([E.SYMBOLCOLOR,sE(w.length)])),o!=null&&(x.push([E.UV0,new Ve(o,2,!0)]),S.push([E.UV0,w])),h!=null&&(x.push([E.TANGENT,new Ve(h,4,!0)]),S.push([E.TANGENT,w]));const O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),C=this._getOrCreateMaterial(e,v),P=new Hs(C,x,S,null,as.Mesh,O);P.transformation=f,y.push(P)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},Q8=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const sI=A(),Qn=A(),fx=A(),mx=A(),gx=A(),Zse=ve(),iC=Fi(),Lit=ve(),K8=ln(),Dit=[new dit],Nit=new A2;var Zl;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Zl||(Zl={}));let Fit=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){NF(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>$_(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=A()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Op),$e(e,this._lodRenderer.baseBoundingSphere.center,Op)}getBoundingBoxObjectSpace(e=ln()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Op);const r=this._lodRenderer.baseBoundingBox;Ti(e);for(let i=0;i<8;++i)se(xu,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),$e(xu,xu,Op),Ff(e,xu);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Op),e.render.origin[0]+=Op[12],e.render.origin[1]+=Op[13],e.render.origin[2]+=Op[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Uit,l=dW(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Op);for(let h=0;h<l;h++){const d=a[h];xu[0]=o[d[0]],xu[1]=o[d[1]],xu[2]=o[d[2]],$e(xu,xu,Op),Sv[3*h]=xu[0],Sv[3*h+1]=xu[1],Sv[3*h+2]=xu[2]}if(!e(Sv,0,l))return null;Ti(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Sv[h+d]),o[d+3]=Math.max(o[d+3],Sv[h+d]);c&&i.push({location:Sv.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(Ud(o,e9),this.elevationContext.mode!=="absolute-height")){let h;const d=TX(o,r.service.spatialReference,r);try{h=await r.service.queryElevation(e9[0],e9[1],s,d,"ground")}catch{}h!=null&&Ame(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){if(e===Vg.Highlight){const i=new ON(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Sv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],xu=A(),e9=A(),Uit=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Op=ve();function Vit(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new kwe(r,i))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function zit(t){return{levels:t.map(e=>Vit(e))}}function kit(t){return t=t||globalThis.location.hostname,Bit.some(e=>(t==null?void 0:t.match(e))!=null)}function mG(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(x2e)!=null||e.match(S2e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(T2e)!=null||e.match(E2e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const x2e=/^devext.arcgis.com$/,T2e=/^qaext.arcgis.com$/,S2e=/^[\w-]*\.mapsdevext.arcgis.com$/,E2e=/^[\w-]*\.mapsqa.arcgis.com$/,Bit=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,x2e,T2e,/^jsapps.esri.com$/,S2e,E2e];function Git(t,e,r){if(t.count!==e.count)return void UF.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],d=r[7],f=r[8],m=r[9],y=r[10],_=r[11],v=r[12],w=r[13],T=r[14],x=r[15],S=t.typedBuffer,O=t.typedBufferStride,C=e.typedBuffer,P=e.typedBufferStride;for(let $=0;$<i;$++){const V=$*O,z=$*P,B=C[z],k=C[z+1],Z=C[z+2],W=C[z+3];S[V]=s*B+l*k+f*Z+v*W,S[V+1]=n*B+c*k+m*Z+w*W,S[V+2]=o*B+h*k+y*Z+T*W,S[V+3]=a*B+d*k+_*Z+x*W}}function jit(t,e,r){cY(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function cY(t,e,r,i=4,s=i){if(t.length/i!=e.length/s)return void UF.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],d=r[5],f=r[6],m=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const T=e[_],x=e[_+1],S=e[_+2],O=e[_+3];t[v]=o*T+c*x+f*S,t[v+1]=a*T+h*x+m*S,t[v+2]=l*T+d*x+y*S,t[v+3]=O,_+=s,v+=i}}function Hit(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],d=n[c+1],f=n[c+2],m=h*h+d*d+f*f;if(m>0){const y=1/Math.sqrt(m);i[l]=y*h,i[l+1]=y*d,i[l+2]=y*f}}}function qit(t,e,r){l4(t.typedBuffer,e,r,t.typedBufferStride)}function l4(t,e,r,i=4){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],t[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:Hit,scale:l4,scaleView:qit,transformMat3:cY,transformMat3View:jit,transformMat4:Git},Symbol.toStringTag,{value:"Module"}));function Wit(t,e){uY(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function uY(t,e,r=2,i=r){const s=e.length/2;let n=0,o=0;if(ep(e)||KOe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=r,o+=i;return}const a=eRe(e);if(QOe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=r,o+=i}function Zit(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:Zit,normalizeIntegerBuffer:uY,normalizeIntegerBufferView:Wit},Symbol.toStringTag,{value:"Module"}));function Xit(t,e){eP(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function eP(t,e,r=3,i=r){const s=e.length/i;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=r,o+=i}function Yit(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:eP,copyView:Xit,fill:Yit},Symbol.toStringTag,{value:"Module"}));function Jit(t,e){hY(t.typedBuffer,e,t.typedBufferStride)}function hY(t,e,r=4){const i=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=s}function Qit(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:hY,copyView:Jit,fill:Qit},Symbol.toStringTag,{value:"Module"}));let C2e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return Xf(e)?(Qt(r),nq(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await Fr(r,{responseType:Kit[e]})).data;const s=await uu(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw Io(s.error),new U("",`Request for resource failed: ${s.error}`)}};const Kit={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function est(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function tst(t,e={}){return{data:t,parameters:{wrap:{s:Dt.REPEAT,t:Dt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let aw=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new U(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new aw(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!n.test(i))throw new U((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!n.test(s))throw new U((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new aw(o,a,r)}};function PL(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:PL},Symbol.toStringTag,{value:"Module"}));let Xse=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var jA,Yse;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(jA||(jA={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Yse||(Yse={}));const A2e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},rst={pbrMetallicRoughness:A2e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},ist={ESRI_externalColorMixMode:"tint"},Jse=(t={})=>{const e={...A2e,...t.pbrMetallicRoughness},r=sst({...ist,...t.extras});return{...rst,...t,pbrMetallicRoughness:e,extras:r}};function sst(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const nst={magFilter:At.LINEAR,minFilter:At.LINEAR_MIPMAP_LINEAR,wrapS:Dt.REPEAT,wrapT:Dt.REPEAT},ost=t=>({...nst,...t});function ast(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const nI={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let lst=class p0{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=ast(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new U("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new U("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new U("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(Xf(r)){const o=Db(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new p0(e,r,l)}catch{}const a=nq(r);if(p0._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new p0(e,r,o)}const s=await e.loadBinary(r,i);if(p0._isGLBData(s))return this._fromGLBData(e,r,s);const n=await e.loadJSON(r,i);return new p0(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new Xse(e);return r.remainingBytes()>=4&&r.readUint32()===nI.MAGIC}static async _fromGLBData(e,r,i){const s=await p0._parseGLBData(i);return new p0(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new Xse(e);if(r.remainingBytes()<12)throw new U("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==nI.MAGIC)throw new U("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new U("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new U("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),h=r.readUint32();if(l===0){if(h!==nI.CHUNK_TYPE_JSON)throw new U("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new U("gltf-loader-error","No JSON data found.");o=await _it(r.readUint8Array(c))}else if(l===1){if(h!==nI.CHUNK_TYPE_BIN)throw new U("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new U("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new U("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new U("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new U("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new U("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[jA.MAT2,jA.MAT3,jA.MAT4])throw new U("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=hst[i.type],a=dst[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Ke.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Ke.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Ke.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Ke.UNSIGNED_BYTE:return PL(this._wrapAccessor(fS,i));case Ke.UNSIGNED_SHORT:return PL(this._wrapAccessor(cF,i));case Ke.UNSIGNED_INT:return PL(this._wrapAccessor(hF,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new U("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==Ke.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(an,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new U("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==Ke.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(an,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new U("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==Ke.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==4)throw new U("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new op(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new U("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new U("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Ke.FLOAT)return this._wrapAccessor(j_,i);if(!i.normalized)throw new U("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return pst(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new U("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Ke.FLOAT)return this._wrapAccessor(op,i);if(i.componentType===Ke.UNSIGNED_BYTE)return this._wrapAccessor(ca,i);if(i.componentType===Ke.UNSIGNED_SHORT)return this._wrapAccessor($R,i)}else if(i.componentCount===3){if(i.componentType===Ke.FLOAT)return this._wrapAccessor(an,i);if(i.componentType===Ke.UNSIGNED_BYTE)return this._wrapAccessor(lF,i);if(i.componentType===Ke.UNSIGNED_SHORT)return this._wrapAccessor(uF,i)}throw new U("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Ke[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var n,o,a,l,c,h,d,f,m,y;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const _=e.material!=null?Jse(this.json.materials[e.material]):Jse(),v=_.pbrMetallicRoughness,w=this.hasVertexColors(e),T=this.getTexture(v.baseColorTexture,r),x=this.getTexture(_.normalTexture,r),S=i?this.getTexture(_.occlusionTexture,r):void 0,O=i?this.getTexture(_.emissiveTexture,r):void 0,C=i?this.getTexture(v.metallicRoughnessTexture,r):void 0,P=e.material!=null?e.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:v.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await T,normalTexture:await x,name:_.name,id:P,occlusionTexture:await S,emissiveTexture:await O,emissiveFactor:_.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await C,hasVertexColors:w,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(f=(d=_.emissiveTexture)==null?void 0:d.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(y=(m=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:y.KHR_texture_transform}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new U("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=ost(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return Bhe(this._textureCache,i,()=>{const c=d=>d===33071||d===33648||d===10497,h=d=>{throw new U("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return cst;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=ni(ve(),i,s.matrix):s.translation||s.rotation||s.scale?(r=iS(i),s.translation&&Cl(r,r,s.translation),s.rotation&&(oI[3]=RZ(oI,s.rotation),uc(r,r,oI[3],oI)),s.scale&&I5(r,r,s.scale)):r=iS(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return Jc(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=aw.parse(this.json.asset.version,"glTF");ust.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new U("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new U("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new v2e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new U("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new U("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new U("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return vit(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await AV(Array.from(this._bufferLoaders.values())),r=await AV(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+((s==null?void 0:s.byteLength)??0),0)+r.reduce((i,s)=>i+(s?Rb(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const cst=gge(ve(),Math.PI/2),ust=new aw(2,0,"glTF"),oI=Mh(),hst={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},dst={[Ke.BYTE]:1,[Ke.UNSIGNED_BYTE]:1,[Ke.SHORT]:2,[Ke.UNSIGNED_SHORT]:2,[Ke.FLOAT]:4,[Ke.INT]:4,[Ke.UNSIGNED_INT]:4};function pst(t){switch(t.componentType){case Ke.BYTE:return new dF(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_BYTE:return new aF(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.SHORT:return new LR(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_SHORT:return new CZ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_INT:return new AZ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.FLOAT:return new j_(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let fst=0;async function O2e(t,e,r={},i=!0){const s=await lst.load(t,e,r),n="gltf_"+fst++,o={lods:[],materials:new Map,textures:new Map,meta:mst(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await gst(s,async(h,d,f,m)=>{const y=l.get(f)??0;l.set(f,y+1);const _=h.mode!==void 0?h.mode:Et.TRIANGLES,v=_===Et.TRIANGLES||_===Et.TRIANGLE_STRIP||_===Et.TRIANGLE_FAN?_:null;if(v==null)return void Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Et[_]+"). Skipping primitive.");if(!s.hasPositions(h))return void Q.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(h,r),T=s.getMaterial(h,r,i),x=s.hasNormals(h)?s.getNormalData(h,r):null,S=s.hasTangents(h)?s.getTangentData(h,r):null,O=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,r):null,C=s.hasVertexColors(h)?s.getVertexColors(h,r):null,P=s.getIndexData(h,r),$={transform:iS(d),attributes:{position:await w,normal:x?await x:null,texCoord0:O?await O:null,color:C?await C:null,tangent:S?await S:null},indices:await P,primitiveType:v,material:_st(o,await T,n)};let V=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(V=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:V},o.lods[f].parts[y]=$});for(const h of o.lods)h.parts=h.parts.filter(d=>!!d);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function mst(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function gst(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),yst(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&Q.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=r.meshes[c.mesh];for(const f of d.primitives)n.push(e(f,h,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function yst(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function _st(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=tst(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:vst.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=est({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const vst=[At.LINEAR_MIPMAP_LINEAR,At.LINEAR_MIPMAP_NEAREST];function bst(t,e){switch(e){case Et.TRIANGLES:return wst(t);case Et.TRIANGLE_STRIP:return xst(t);case Et.TRIANGLE_FAN:return Tst(t)}}function wst(t){return typeof t=="number"?mS(t):G0(t)?new Uint16Array(t):t}function xst(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=AN(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=t[n],i[s++]=t[n+1],i[s++]=t[n+2]):(i[s++]=t[n+1],i[s++]=t[n],i[s++]=t[n+2])}return i}function Tst(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}let Sst=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},Est=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new Sst,this.numberOfVertices=0}};const Nm=Q.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function R2e(t,e){const r=await Cst(t,e),i=await Mst(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+owe(r)}}async function Cst(t,e){const r=e!=null&&e.streamDataRequester;if(r)return Ast(t,r,e);const i=await uu(Fr(t,e));if(i.ok===!0)return i.value.data;Io(i.error),P2e(i.error)}async function Ast(t,e,r){const i=await uu(e.request(t,"json",r));if(i.ok===!0)return i.value;Io(i.error),P2e(i.error.details.url)}function P2e(t){throw new U("",`Request for object resource failed: ${t}`)}function Ost(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(Nm.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Nm.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Nm.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(Nm.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else Nm.warn("Indexed geometries must specify faces"),i=!1;break}default:Nm.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(Nm.warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(Nm.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function Rst(t,e){var y;const r=new Array,i=new Array,s=new Array,n=new nE,o=t.resource,a=aw.parse(o.version||"1.0","wosr");$st.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},d=t.textures;let f=0;const m=new Map;for(let _=0;_<c.length;_++){const v=c[_];if(!Ost(v))continue;const w=Ist(v),T=v.params.vertexAttributes,x=[];for(const k in T){const Z=T[k],W=Z.values;x.push([k,new Ve(W,Z.valuesPerElement,!0)])}const S=[];if(v.params.topology!=="PerAttributeArray"){const k=v.params.faces;for(const Z in k)S.push([Z,k[Z].values])}const O=w.texture,C=d&&d[O];if(C&&!m.has(O)){const{image:k,parameters:Z}=C,W=new Iw(k,Z);i.push(W),m.set(O,W)}const P=m.get(O),$=P?P.id:void 0,V=w.material;let z=n.get(V,O);if(z==null){const k=h[V.substring(V.lastIndexOf("/")+1)].params;k.transparency===1&&(k.transparency=0);const Z=C&&C.alphaChannelUsage,W=k.transparency>0||Z==="transparency"||Z==="maskAndTransparency",j=C?M2e(C.alphaChannelUsage):void 0,Y={ambient:Da(k.diffuse),diffuse:Da(k.diffuse),opacity:1-(k.transparency||0),transparent:W,textureAlphaMode:j,textureAlphaCutoff:.33,textureId:$,initTextureTransparent:!0,doubleSided:!0,cullFace:gi.None,colorMixMode:k.externalColorMixMode||"tint",textureAlphaPremultiplied:(C==null?void 0:C.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParamsMixin&&Object.assign(Y,e.materialParamsMixin),z=new qf(Y),n.set(V,O,z)}s.push(z);const B=new Hs(z,x,S);f+=((y=S.find(k=>k[0]===E.POSITION))==null?void 0:y[1].length)??0,r.push(B)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:Pst(r)}}function Pst(t){const e=Ti();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(Ff(e,i.bbMin),Ff(e,i.bbMax))}),e}async function Mst(t,e){const r=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){Nm.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Dt.REPEAT,t:Dt.REPEAT},preMultiplyAlpha:M2e(h)!==Xr.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):kg(l,e);r.push(f.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:h})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function M2e(t){switch(t){case"mask":return Xr.Mask;case"maskAndTransparency":return Xr.MaskBlend;case"none":return Xr.Opaque;default:return Xr.Blend}}function Ist(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const $st=new aw(1,2,"wosr"),yx=2.1;async function I2e(t,e){var d;const r=$2e(mG(t));if(r.fileType==="wosr"){const f=await(e.cache?e.cache.loadWOSR(r.url,e):R2e(r.url,e)),{engineResources:m,referenceBoundingBox:y}=Rst(f,e);return{lods:m,referenceBoundingBox:y,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):O2e(new C2e(e.streamDataRequester),r.url,e,e.usePBR)),s=(d=i.model.meta)==null?void 0:d.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,Fst(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...Cet]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...qF]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=L2e(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function $2e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function L2e(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Ti();return s.lods.forEach((h,d)=>{const f=i.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&d!==i.singleLodIndex;if(f&&d!==0)return;const m=new Est(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(y=>{const _=f?new qf({}):Lst(s,y,m,e,r,o,a),{geometry:v,vertexCount:w}=Dst(y,_??new qf({})),T=v.boundingInfo;T!=null&&d===0&&(Ff(c,T.bbMin),Ff(c,T.bbMax)),_!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=w)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function Lst(t,e,r,i,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,h=e.attributes.normal!=null;if(l==null)return null;const d=Nst(l.alphaMode);if(!n.has(a)){if(c){const O=(C,P=!1)=>{if(C!=null&&!o.has(C)){const $=t.textures.get(C);if($!=null){const V=$.data;o.set(C,new Iw(Rb(V)?V.data:V,{...$.parameters,preMultiplyAlpha:!Rb(V)&&P,encoding:Rb(V)&&V.encoding!=null?V.encoding:void 0}))}}};O(l.textureColor,d!==Xr.Opaque),O(l.textureNormal),O(l.textureOcclusion),O(l.textureEmissive),O(l.textureMetallicRoughness)}const m=l.color[0]**(1/yx),y=l.color[1]**(1/yx),_=l.color[2]**(1/yx),v=l.emissiveFactor[0]**(1/yx),w=l.emissiveFactor[1]**(1/yx),T=l.emissiveFactor[2]**(1/yx),x=l.textureColor!=null&&c?o.get(l.textureColor):null,S=STe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});n.set(a,new qf({...i,transparent:d===Xr.Blend,customDepthTest:Zb.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?gi.None:gi.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?Or.Attribute:Or.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:x!=null?x.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:x!=null&&!!x.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,w,T],mrrFactors:S?[...tY]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:mf(l.colorTextureTransform),normalTextureTransformMatrix:mf(l.normalTextureTransform),occlusionTextureTransformMatrix:mf(l.occlusionTextureTransform),emissiveTextureTransformMatrix:mf(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:mf(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(r.stageResources.materials.push(f),c){const m=y=>{y!=null&&r.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function Dst(t,e){const r=t.attributes.position.count,i=bst(t.indices||r,t.primitiveType),s=Qi(3*r),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;AS(s,n,t.transform,3,o);const a=[[E.POSITION,new Ve(s,3,!0)]],l=[[E.POSITION,i]];if(t.attributes.normal!=null){const c=Qi(3*r),{typedBuffer:h,typedBufferStride:d}=t.attributes.normal;A_(aI,t.transform),rw(c,h,aI,3,d),a.push([E.NORMAL,new Ve(c,3,!0)]),l.push([E.NORMAL,i])}if(t.attributes.tangent!=null){const c=Qi(4*r),{typedBuffer:h,typedBufferStride:d}=t.attributes.tangent;A_(aI,t.transform),cY(c,h,aI,4,d),a.push([E.TANGENT,new Ve(c,4,!0)]),l.push([E.TANGENT,i])}if(t.attributes.texCoord0!=null){const c=Qi(2*r),{typedBuffer:h,typedBufferStride:d}=t.attributes.texCoord0;uY(c,h,2,d),a.push([E.UV0,new Ve(c,2,!0)]),l.push([E.UV0,i])}if(t.attributes.color!=null){const c=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof op?l4(c,t.attributes.color,255):t.attributes.color instanceof ca?hY(c,t.attributes.color):t.attributes.color instanceof $R&&l4(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof an?QN(c,t.attributes.color,255,4):t.attributes.color instanceof lF?eP(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof uF&&QN(c,t.attributes.color,1/256,4)),a.push([E.COLOR,new Ve(c,4,!0)]),l.push([E.COLOR,i])}return{geometry:new Hs(e,a,l),vertexCount:r}}const aI=Fi();function Nst(t){switch(t){case"BLEND":return Xr.Blend;case"MASK":return Xr.Mask;case"OPAQUE":case null:case void 0:return Xr.Opaque}}function Fst(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=A(),c=A(),h=A(),d=new Uint8Array(4*a),f=new Float64Array(3*a),m=xn(ve(),s.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),$e(c,c,s.transform),he(h,c,e.center),UD(h,h,e.radius);const w=h[2],T=Ee(h),x=Math.min(.45+.55*T*T,1);UD(h,h,e.radius),m!==null&&$e(h,h,m),ge(h,h),r+1!==t.model.lods.length&&t.model.lods.length>1&&Gr(h,h,l,w>-1?.2:Math.min(-4*w-3.8,1)),f[y]=h[0],f[y+1]=h[1],f[y+2]=h[2],y+=3,d[_]=255*x,d[_+1]=255*x,d[_+2]=255*x,d[_+3]=255,_+=4}s.attributes.normal=new an(f),s.attributes.color=new ca(d)}}}const h$t=Object.freeze(Object.defineProperty({__proto__:null,fetch:I2e,gltfToEngineResources:L2e,parseUrl:$2e},Symbol.toStringTag,{value:"Module"})),Ust=()=>!!oe("enable-feature:force-wosr"),d$t=()=>!!oe("enable-feature:direct-3d-object-feature-layer-display"),Vst=()=>oe.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),zst=()=>oe.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),p$t=()=>!!oe("enable-i3s-patching"),kst=()=>oe.add("enable-i3s-patching",!0,!0,!0),Bst=()=>oe.add("enable-i3s-patching",!1,!0,!0),Qse=()=>!!oe("enable-feature:SceneLayer-editing"),Gst=(t="i3s-patching")=>{switch(Bst(),zst(),oe.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":Vst();break;case"i3s-patching":kst()}};Gst("i3s-patching");let t9={};async function jst(t,e){try{return{data:(await pY(t,e)).data,baseUrl:lq(t),styleUrl:t}}catch(r){return Io(r),null}}function Hst(t,e,r){const i=e.portal!=null?e.portal:qn.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return t9[n]||(t9[n]=qst(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),t9[n]}function qst(t,e,r){return e.load(r).then(()=>{const i=new uf({disableExtraQuery:!0,query:`owner:${Kse} AND type:${ene} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===ene&&a.owner===Kse){s=a;break}}if(!s)throw new U("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function dY(t,e,r){return t&&t.styleUrl!=null?jst(t.styleUrl,r):t&&t.styleName!=null?Hst(t.styleName,e,r):Promise.reject(new U("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function D2e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function N2e(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Ust())for(const i of r){const s=t.formatInfos.find(n=>n.type===i);if(s)return s.href}return t.webRef}function pY(t,e){const r={responseType:"json",query:{f:"json"},...e};return Fr(Hd(t),r)}const Kse="esri_en",ene="Style",Wst="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",sC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function Zst(t,e=sC){var a,l;if(!t)return{symbol:null};const{retainId:r=sC.retainId,ignoreDrivers:i=sC.ignoreDrivers,hasLabelingContext:s=sC.hasLabelingContext,retainCIM:n=sC.retainCIM}=e;let o=null;if(jb(t)||t instanceof xw)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new U("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():Z0.fromCIMSymbol(t)}else if(t instanceof Ph)o=C5.fromSimpleLineSymbol(t);else if(t instanceof k_)o=Z0.fromSimpleMarkerSymbol(t);else if(t instanceof O5)o=Z0.fromPictureMarkerSymbol(t);else if(t instanceof ww)o=e.geometryType&&e.geometryType==="mesh"?A5.fromSimpleFillSymbol(t):ER.fromSimpleFillSymbol(t);else{if(!(t instanceof JS))return{error:new U("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?E5.fromTextSymbol(t):Z0.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&jb(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function c4(t,e,r,i){const s=F2e(t,{},{context:i,isLabelSymbol:!1});s!=null&&(e[r]=s)}function tne(t,e,r,i){const s=F2e(t,{},{context:i,isLabelSymbol:!0});s!=null&&(e[r]=s)}function rne(t){return t instanceof YS||t instanceof xw}function F2e(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!rne(t)){const a=Zst(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!epe(i==null?void 0:i.layer))&&rne(t)?(o==null||o.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function U2e(t,e){return mFe(t,null,e)}function Xst(t,e,r,i){const s=t.name;return s==null?Promise.reject(new U("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?Yst(s,e,i):dY(t,e,i).then(n=>mY(ec(n),s,e,r,N2e,i))}function fY(t,e){return e.items.find(r=>r.name===t)}function mY(t,e,r,i,s,n){var m;const o=r&&r.portal!=null?r.portal:qn.getDefault(),a={portal:o,url:_o(t.baseUrl),origin:"portal-item"},l=fY(e,t.data);if(!l){const y=`The symbol name '${e}' could not be found`;return Promise.reject(new U("symbolstyleutils:symbol-name-not-found",y,{symbolName:e}))}let c=Lg(s(l,i),a),h=((m=l.thumbnail)==null?void 0:m.href)??null;const d=l.thumbnail&&l.thumbnail.imageData;kit()&&(c=mG(c)??"",h=mG(h));const f={portal:o,url:_o(lq(c)),origin:"portal-item"};return pY(c,n).then(y=>{const _=i==="cimRef"?D2e(y.data):y.data,v=U2e(_,f);if(v&&jb(v)){if(h){const w=Lg(h,a);v.thumbnail=new yb({url:w})}else d&&(v.thumbnail=new yb({url:`data:image/png;base64,${d}`}));t.styleUrl?v.styleOrigin=new vO({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(v.styleOrigin=new vO({portal:r.portal,styleName:t.styleName,name:e}))}return v})}function Yst(t,e,r){const i=Wst.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:qn.getDefault();return pY(i,r).then(n=>{const o=D2e(n.data);return U2e(o,{portal:s,url:_o(lq(i)),origin:"portal-item"})})}const Jst=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:mY,getStyleItemFromStyle:fY,resolveWebStyleSymbol:Xst},Symbol.toStringTag,{value:"Module"}));async function Qst(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new U("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await dY(t,r).catch(()=>null);if(i===null)return null;const s=fY(e,i.data);if(s&&!((a=s.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const n=await mY(i,e,r,"webRef",(l,c)=>N2e(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Kst=class{constructor(e,r,i){this._elementSize=r,this._buffer=Lr.createVertex(e,Tr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},ent=class{constructor(e){this.modelOriginHi=e.getField(E.MODELORIGINHI,an),this.modelOriginLo=e.getField(E.MODELORIGINLO,an),this.model=e.getField(E.MODEL,R_),this.modelNormal=e.getField(E.MODELNORMAL,R_),this.featureAttribute=e.getField(E.INSTANCEFEATUREATTRIBUTE,op),this.color=e.getField(E.INSTANCECOLOR,ca),this.objectAndLayerIdColor=e.getField(E.INSTANCEOBJECTANDLAYERIDCOLOR,ca)}},ine=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){tt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){tt(this._updating,"not updating"),this.size<BOe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){tt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),tt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){tt(this._updating,"not updating"),tt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(u4,Math.floor(this._capacity*G4));this._resize(e)}_shrink(){const e=Math.max(u4,Math.floor(this._capacity*kOe));this._resize(e)}_resize(e){if(tt(this._updating,"not updating"),e===this._capacity)return;const r=new Kst(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);tt(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new ent(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const u4=64;var Ii;function tnt(t){let e=Hi().mat4f64(E.LOCALTRANSFORM).mat4f64(E.GLOBALTRANSFORM).vec4f64(E.BOUNDINGSPHERE).vec3f64(E.MODELORIGIN).mat3f(E.MODEL).mat3f(E.MODELNORMAL).vec2f(E.MODELSCALEFACTORS);return t.includes(E.FEATUREATTRIBUTE)&&(e=e.vec4f(E.FEATUREATTRIBUTE)),t.includes(E.COLOR)&&(e=e.vec4u8(E.COLOR)),t.includes(E.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(E.OBJECTANDLAYERIDCOLOR)),e=e.u8(E.STATE).u8(E.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Ii||(Ii={}));let sne=class{constructor(e){this.localTransform=e.getField(E.LOCALTRANSFORM,$O),this.globalTransform=e.getField(E.GLOBALTRANSFORM,$O),this.modelOrigin=e.getField(E.MODELORIGIN,Ah),this.model=e.getField(E.MODEL,R_),this.modelNormal=e.getField(E.MODELNORMAL,R_),this.modelScaleFactors=e.getField(E.MODELSCALEFACTORS,j_),this.boundingSphere=e.getField(E.BOUNDINGSPHERE,oF),this.featureAttribute=e.getField(E.FEATUREATTRIBUTE,op),this.color=e.getField(E.COLOR,ca),this.objectAndLayerIdColor=e.getField(E.OBJECTANDLAYERIDCOLOR,ca),this.state=e.getField(E.STATE,fS),this.lodLevel=e.getField(E.LODLEVEL,fS)}},gT=class extends xe{constructor(e,r){super(e),this.events=new Ls,this._capacity=0,this._size=0,this._next=0,this._layout=tnt(r),this._capacity=u4,this._buffer=this._layout.createBuffer(this._capacity),this._view=new sne(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Ii.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;tt(e>=0&&e<this._capacity&&(r.get(e)&Ii.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Ii.ACTIVE)?this._setStateFlags(e,Ii.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;tt(e>=0&&e<this._capacity&&(r.get(e)&Ii.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=Ll,s=Hh;r.localTransform.getMat(e,nne),r.globalTransform.getMat(e,r9);const n=ni(r9,r9,nne);se(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),Eh(s,n),r.model.setMat(e,s);const o=_Ue(Ll,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),Rw(s,s),Ch(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,Ii.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Hh),i.modelOrigin.getVec(e,Ll),r[0]=Hh[0],r[1]=Hh[1],r[2]=Hh[2],r[3]=0,r[4]=Hh[3],r[5]=Hh[4],r[6]=Hh[5],r[7]=0,r[8]=Hh[6],r[9]=Hh[7],r[10]=Hh[8],r[11]=0,r[12]=Ll[0],r[13]=Ll[1],r[14]=Ll[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Ll,this,e),r*=Math.max(Ll[0],Ll[1],Ll[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Ll,this,e),r*=rnt(Ll[0],Ll[1],Ll[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Ii.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Ii.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Ii.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Ii.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(u4,Math.floor(this._capacity*G4)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new sne(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Ii.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function rnt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}u([p({constructOnly:!0})],gT.prototype,"shaderTransformation",void 0),u([p()],gT.prototype,"_size",void 0),u([p({readOnly:!0})],gT.prototype,"size",null),gT=u([R("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],gT);const Ll=A(),Hh=Fi(),nne=ve(),r9=ve();let int=class extends Bd{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=_s(),this._tmpMat4=ve()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);$e(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*nS(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},snt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},nnt=class extends fF{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function gY(t){return hp(t)&&t.intersector===Gi.LOD&&!!t.target}let ont=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new eTe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Lr.createVertex(i,Tr.STATIC_DRAW,l.buffer),this.vao=new up(i,br,{geometry:Sc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(h,d,f,m,y)=>{if(h>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,h))return;const _=new nnt(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(Gi.LOD,_,h,d,e.transform.transform,y),e.options.store!==go.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(Gi.LOD,_,h,d,e.transform.transform,y),e.options.store===go.ALL){const v=LZ(e.results.min.ray);v.set(Gi.LOD,_,h,d,e.transform.transform,y),e.results.all.push(v)}}})}},ant=class V2e{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new ont(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(fw);if(vn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Qt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new V2e(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Ti();this.components.forEach(r=>{r.boundingInfo!=null&&(Ff(e,r.boundingInfo.bbMin),Ff(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=A();Ud(e,r),this._boundingSphere={center:r,radius:.5*Cme(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const lnt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new snt(e,r)};let zu=class extends xe{constructor(e,r){super(e),this.type=Gi.LOD,this.isGround=!1,this._handles=new Mi,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new lt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[ce.OPAQUE_MATERIAL,ce.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new gT({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(r.registerTask(pt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=unt(this.optionalFields),this._glInstanceBufferLayout=Sc(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(r=>r.forEach(i=>{e.cpu+=i.memoryUsage.cpu,e.gpu+=i.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=i.triangleCount;r.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new ine(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new ine(i,this._instanceBufferLayout)),ant.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(fw);if(vn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Qt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=lnt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(ce.TRANSPARENT_MATERIAL,L.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!oi.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Va),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>i.push(this._beginComponent(e,s[o],a)))})),i}render(e,r){const i=this._getInstanceDatas(e.output);if(!i)return;let s=0;e.rctx.bindVAO(),i.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[s++],n[a],l,a))}))}_getInstanceDatas(e){const r=e!==L.Highlight&&e!==L.ShadowHighlight,i=e!==L.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=A();he(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,lne),e.transform.set(lne),$e(cne,i,e.transform.inverse),$e(une,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;tt((l&Ii.ACTIVE)!=0,"invalid instance state"),tt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,r,cne,une,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new int(r,this.baseBoundingSphere);for(let s=0;s<r.capacity;++s)i.get(s)&Ii.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Pe(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Bd.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,Bd.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Rp),he(Rp,Rp,n);const a=me(Rp,r)-Rp[3];o.boundingSphere.getVec(s,Rp),he(Rp,Rp,n);const l=me(Rp,r)+Rp[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._allRenderInstanceData.forEach(h=>h.forEach(d=>d.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const d=o.state.get(c);let f=0;if(!(d&Ii.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(d&Ii.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][m].freeTail(),d&Ii.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][m].freeTail(),d&Ii.REMOVE)n.freeInstance(c);else if(d&Ii.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,ane),y=s.selectLevel(ane,n.getCombinedMedianScaleFactor(c),i)),f=d&~(Ii.ACTIVE|Ii.TRANSFORM_CHANGED),y>=0&&(d&Ii.HIGHLIGHT?(one(this._highlightRenderInstanceData[0][y],o,c),f|=Ii.HIGHLIGHT_ACTIVE):(one(this._defaultRenderInstanceData[0][y],o,c),f|=Ii.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=d&~(Ii.ACTIVE|Ii.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const y=!!(d&Ii.ACTIVE),_=!!(f&Ii.ACTIVE);!y&&_?this._octreeCached.addInstance(c):y&&!_?this._octreeCached.removeInstance(c):y&&_&&d&Ii.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(d=>d.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){const{bindParameters:s,rctx:n,output:o}=e;if(r.size===0||!i.material.requiresSlot(s.slot,e.output))return null;const a=i.glMaterials.load(n,s.slot,o);return a!=null?a.beginSlot(s):null}_renderComponent(e,r,i,s,n){var v;if(!r)return;const{bindParameters:o,rctx:a}=e;(v=a.appleAmdDriverHelper)==null||v.resetIndicesType();const l=a.bindTechnique(r,s.material.parameters,o);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),l.bindDraw(hnt,o,s.material.parameters),oi.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===L.Color&&(l.setUniform4fv("externalColor",hne[Math.min(n,hne.length-1)]),l.setUniform1i("colorMixMode",wbe.replace));const c=a.capabilities.instancing,h=i.capacity,d=i.headIndex,f=i.tailIndex,m=i.firstIndex,y=this._glInstanceBufferLayout,_=(w,T)=>{iZ(a,br,i.buffer,y,w),c.drawArraysInstanced(r.primitiveType,0,s.vertexCount,T-w),sZ(a,br,i.buffer,y)};s.material.parameters.transparent&&m!=null?d>f?(tt(m>=f&&m<=d,"invalid firstIndex"),_(m,d),_(f,m)):d<f&&(m<=d?(tt(m>=0&&m<=d,"invalid firstIndex"),_(m,d),_(f,h),_(0,m)):(tt(m>=f&&m<=h,"invalid firstIndex"),_(m,h),_(0,d),_(f,m))):d>f?_(f,d):d<f&&(_(0,d),_(f,h)),a.bindVAO(null)}};function one(t,e,r){const i=t.allocateHead();cnt(e,r,t.view,i)}function cnt(t,e,r,i){s7e(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function unt(t){let e=Hi().vec3f(E.MODELORIGINHI).vec3f(E.MODELORIGINLO).mat3f(E.MODEL).mat3f(E.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(E.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(E.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(E.INSTANCEOBJECTANDLAYERIDCOLOR)),e}u([p({constructOnly:!0})],zu.prototype,"symbol",void 0),u([p({constructOnly:!0})],zu.prototype,"optionalFields",void 0),u([p({constructOnly:!0})],zu.prototype,"metadata",void 0),u([p({constructOnly:!0})],zu.prototype,"shaderTransformation",void 0),u([p()],zu.prototype,"_instanceData",void 0),u([p()],zu.prototype,"_cycleStartIndex",void 0),u([p({readOnly:!0})],zu.prototype,"_enableLevelSelection",null),u([p()],zu.prototype,"_updateCyclesWithStaticCamera",void 0),u([p({readOnly:!0})],zu.prototype,"running",null),zu=u([R("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],zu);const ane=A(),Rp=Yt(),lne=ve(),cne=A(),une=A(),hne=[Ft(1,0,1,1),Ft(0,0,1,1),Ft(0,1,0,1),Ft(1,1,0,1),Ft(1,0,0,1)],hnt=new ket;let dne=class{constructor(e,r,i,s,n,o,a,l,c,h,d,f){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=d,this.pivotOffset=f}},dnt=class extends sm{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&DF(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&oJe(r.primitive)?r.primitive:zme;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await Qst(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}_setMaterialTransparencyParams(e,r=(s=>(s=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:s.color)()){const n=this._getCombinedOpacity(r),o=n<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=n,e.cullFace=o?gi.None:gi.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,s=ln(W5e(e)),n=Da(RP(s)),o=Da(J6(n,i)),a=Ee(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...tY],ambient:ug,diffuse:ug,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:T,minWorldLength:x,maxWorldLength:S}=f.verticalOffset;h.verticalOffset={screenLength:po(T),minWorldLength:x||0,maxWorldLength:S??1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=ah;else{const T=i.material!=null?i.material.color:null,x=T!=null?ke.toUnitRGBA(T):ah;h.externalColor=x}this._fastUpdates=xS(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),h.isInstanced=!0,this._fastUpdates?(Object.assign(h,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(h.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),oe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const m=new qf(h),y=Gwe(e,m);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=VM(y).map(T=>({opacity:1,transparent:T.parameters.transparent})),v=await this._createStageResources(y,d,r),w=await this._createLodRenderer(y,r);return new dne(y,w,v,_,n,l,c,s,o,a,d,null)}async _createResourcesForUrl(e,r){var z,B;const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=xS(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),oe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:k,minWorldLength:Z,maxWorldLength:W}=s.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:po(k),minWorldLength:Z||0,maxWorldLength:W??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const n=i.usePBR,o=await I2e(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=zit(o.lods);c.levels.sort((k,Z)=>k.minScreenSpaceRadius-Z.minScreenSpaceRadius);const h=this._context,d=this.symbolLayer.material,f=this._getExternalColorParameters(d),m=(B=(z=this.symbolLayer)==null?void 0:z.material)==null?void 0:B.color,y=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=VM(c),w=VM(c).map(k=>({opacity:k.parameters.opacity||1,transparent:k.parameters.transparent}));v.forEach(k=>{const Z=k.parameters;k.setParameters(f);const W=Z.opacity*y,j=W<1||_||Z.transparent;k.setParameters({opacity:W,transparent:j}),h.screenSizePerspectiveEnabled&&k.setParameters({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})});const T=o.referenceBoundingBox,x=Da(RP(T)),S=Da(c.levels[0].pivotOffset),O=Da(J6(x,this.symbolLayer)),C=Ee(O),P=this._fastUpdates;TS(P,this._context.renderer,this._fastVisualVariableConvertOptions(T,O,x,S))&&v.forEach(k=>k.setParameters(P.materialParameters));const $=await this._createStageResources(c,n,r),V=await this._createLodRenderer(c,r);return new dne(c,V,$,w,x,a,l,T,O,C,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=VM(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=pie(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),Qt(i);const a=fie(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,h)=>{l.getFeatureAttribute(c,lI),$s(h,k7(n.materialParameters,lI,h))},scaleFactor:(l,c,h)=>{c.getFeatureAttribute(h,lI),vXe(l,n.materialParameters,lI)}}:null,a=new zu({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=ah:e!=null&&e.color!=null?r.externalColor=ke.toUnitRGBA(e.color):(r.externalColor=ah,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=GO(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new dp),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var n,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:o.color,h=s[a],d=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*h.opacity,f=d<1||e||h.transparent;l.setParameters({opacity:d,transparent:f}),this._isPrimitive&&l.setParameters({cullFace:f?gi.None:gi.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,L_)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return Ms.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!TS(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return Ms.RecreateSymbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Ms.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=Bwe(e.levels[0]).reduce((n,o)=>n+o.indices.get(E.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>o+j0(a.data),0)+Array.from(n.indices.values()).reduce((o,a)=>o+j0(a),0),s=pie(e).reduce((n,o)=>n+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+fie(e).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...Zwe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(vo(r,_x,this._context.elevationProvider.spatialReference),l!=null&&!uW(l,_x))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(r,s,i9,cI),d=this._computeLocalTransform(this._resources,this.symbolLayer,i,pne),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,d,!1),f.setGlobalTransform(m,h),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,DA(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const y=new Fit(this,m,qYe,s);return c&&(y.alignedSampledElevation=cI.sampledElevation),y.needsElevationUpdates=L_(s.mode),BO(y,r,this._context.elevationProvider),y}_computeGlobalTransform(e,r,i,s){return $_(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),_x[0]=e.x,_x[1]=e.y,_x[2]=s.z,xl(e.spatialReference,_x,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return Th(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=hie(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||I5(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&GO(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,i9,cI),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=cI.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,i9,!0),BO(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),d=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:d},m=this._resources;this.loadStatus===Zc.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Da(J6(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(m,f,_,pne),w=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?ke.toUnitRGBA(s):ah;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var s;if(!((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)||!r)return DYe(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=A();switch(i.anchor){case"center":re(s,Ud(e)),aa(s,s);break;case"top":{const n=Ud(e);se(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=Ud(e);se(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=Ud(e),o=RP(e),a=i.anchorPosition,l=a?Ae(a.x,a.y,a.z):Ba;o5(s,o,l),le(s,s,n),aa(s,s);break}default:r!=null?aa(s,r):re(s,Ba)}return s}_applyAnchor(e,r,i){var n;if((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&Cl(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=e!=null?Da(RP(e)):ug,o=e!=null?this._computeAnchor(e,s,this.symbolLayer):Ba,a=this._context.renderCoordsHelper.unitInMeters,l=hie(r??void 0,r,i,a),c=Ae(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new GR({size:!0,color:!0,rotation:!0,opacity:!1},n,r??ug,a,o,l,c)}};const _x=A(),pne=ve(),i9=ve(),lI=Yt(),cI=new qR;let pnt=class{constructor(e,r,i,s){this.vertices=e,this.positionsES=r,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],h=i[a+2];this.origin=Ae(l,c,h),this.positions=Qi(3*n);const d=this.offset+3*n;for(let f=this.offset;f<d;f+=3)this.positions[f]=i[f]-l,this.positions[f+1]=i[f+1]-c,this.positions[f+2]=i[f+2]-h;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=Ee(r.vRight);r.vMinSiblingLength=n,ge(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=Ee(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,ge(l.vRight,l.vRight)}else re(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}},fnt=class{constructor(e,r,i,s,n,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=XBe(1*this.numVerticesTotal),this.profileRightAxes=Qi(4*this.numVerticesTotal),this.profileUpAxes=Qi(4*this.numVerticesTotal),this.profileVertexAndNormals=Qi(4*this.numVerticesTotal),this.positions=CN(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=CN(e,r,3*i.length);let s=0;const n=(a,l,c,h,d)=>this.emitCapVertex(s,a,l,c,h,d),o=(a,l,c,h)=>this.emitVertex(s,a,l,c,h);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,d)=>{n.push(c),n.push(h),n.push(d),o.push(c),o.push(h),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[d])};for(let c=0;c<r;++c){const h=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let f=0;f<i;++f){const m=f*e+h,y=(f+1)*e+d,_=f*e+d;l(m,(f+1)*e+h,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Pf(n),this.normalIndices=Pf(o),this.pathVertexIndices=Pf(a)}onPathChanged(){this._rebuildGeometry()}},yY=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],0,0)}},fne=class extends yY{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},uI=class extends yY{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(e,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=z2e;nr(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,n,s)}buildTopology(e,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}},mne=class extends yY{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,s=e.frame,n=.5*this.sign,o=mnt,a=z2e;nr(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,h=Math.sin(c),d=Math.cos(c);for(let f=0;f<i.vertices.length;++f){const m=i.poles[i.poleIndices[f]];pf(o,i.vertices[f],m.position),oc(o,o,h),m.normal?(Cd(o,o,m.position),r(s,o,m.normal,n*d,0)):(PO(a,o),oc(a,a,h),Cd(o,o,m.position),r(s,o,a,n*d,this.sign*d))}}}buildTopology(e,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],h=this.vertexBufferStart+i.poleIndices[l];let d=s+a,f=s+l;for(let m=0;m<this.numSegments-1;++m){const y=n+m*i.vertices.length+a,_=n+m*i.vertices.length+l;this.flip?(r(y,f,d),r(f,y,_)):(r(d,f,y),r(_,y,f)),d=y,f=_}this.flip?(r(c,f,d),c!==h&&r(c,h,f)):(r(d,f,c),c!==h&&r(f,h,c))}}};const mnt=Ue(),z2e=Ue();let gnt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],!1)}},s9=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=_nt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){du(yne,.5*-n+c*n/this.numBendSubdivisions,l),ynt(s,a,yne);for(let h=0;h<r.vertices.length;++h)Js(r.vertices[h],o)*n>=0?i(s,r.vertices[h],r.normals[h],!1):i(a,e.applyMiterStretch(gne,r.vertices[h]),r.normals[h],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const h=Js(r.vertices[c],o)*n>=0;i(a,e.applyMiterStretch(gne,r.vertices[c]),r.normals[c],!h)}}},k2e=class{constructor(){this.up=A(),this.right=A()}};function ynt(t,e,r){$e(t.up,e.up,r),$e(t.right,e.right,r)}const gne=Ue(),yne=ve(),_nt=new k2e;let vnt=class extends Hs{constructor(e,r,i,s,n,o,a){super(e,r,i,null,as.Mesh,a),this.path=s,this.geometrySR=n,this.stencilWidth=o}};var Mf;function B2e(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Mf||(Mf={}));let G2e=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},j2e=class extends G2e{constructor(e){super(e),this.vertexAttributeColor=Ft(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Qi(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let h=i[c];const d=h===0||h===s.vertices.length-1;h*=3;const f=Snt;let m=0,y=0;const _=4*c,v=se(Ent,o[_],o[_+1],o[_+2]),w=se(Cnt,a[_],a[_+1],a[_+2]),T=nr(_ne,l[_]*e[0],l[_+1]*e[1]);if(d)ot(f,w,v),m=o[_+3]*e[0],y=a[_+3];else{const C=wnt,P=xnt;nr(C,o[_+3],a[_+3]);const $=QW(C);PO(C,C);const V=Js(T,C);if(Math.abs(V)>$){nr(P,-C[1],C[0]);const z=Js(T,P);oc(C,C,$*Math.sign(V)),oc(P,P,z),Cd(T,C,P)}se(f,0,0,0)}const x=se(Tnt,v[0]*T[0]+w[0]*T[1],v[1]*T[0]+w[1]*T[1],v[2]*T[0]+w[2]*T[1]),S=3*c;this.vertexAttributePosition[S]=n[h]+x[0]+f[0]*m,this.vertexAttributePosition[S+1]=n[h+1]+x[1]+f[1]*m,this.vertexAttributePosition[S+2]=n[h+2]+x[2]+f[2]*m;const O=nr(_ne,l[_+2],l[_+3]);nw(this.vertexAttributeNormal,c,v[0]*O[0]+w[0]*O[1]+f[0]*y,v[1]*O[0]+w[1]*O[1]+f[1]*y,v[2]*O[0]+w[2]*O[1]+f[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new H2e([[E.POSITION,new Ve(this.vertexAttributePosition,3,!0)],[E.NORMALCOMPRESSED,new Ve(this.vertexAttributeNormal,2,!0)],[E.COLOR,new Ve(this.vertexAttributeColor,4)]],[[E.POSITION,this.builder.vertexIndices],[E.NORMALCOMPRESSED,this.builder.normalIndices],[E.COLOR,sE(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new Ve(this.vertexAttributePosition,3),o=s.length/3;zR(e,r,0,o,s,n,void 0,void 0,i)}},bnt=class extends G2e{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new j2e(e),this.vvData=Qi(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return new H2e([[E.POSITION,new Ve(this.builder.positions,3,!0)],[E.PROFILERIGHT,new Ve(this.builder.profileRightAxes,4,!0)],[E.PROFILEUP,new Ve(this.builder.profileUpAxes,4,!0)],[E.PROFILEVERTEXANDNORMAL,new Ve(this.builder.profileVertexAndNormals,4,!0)],[E.FEATUREVALUE,new Ve(this.vvData,4,!0)]],[[E.POSITION,this.builder.pathVertexIndices],[E.PROFILERIGHT,this.builder.vertexIndices],[E.PROFILEUP,this.builder.vertexIndices],[E.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[E.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(E.POSITION);r&&(r.data=this.builder.positions)}},H2e=class{constructor(e,r){this.vertexAttributes=e,this.indices=r}};const _ne=Ue(),wnt=Ue(),xnt=Ue(),Tnt=A(),Snt=A(),Ent=A(),Cnt=A();function Ant(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=A(),o=A(),a=A(),l=A(),c=A(),h=A(),d=Ir();let f=t.vertices[0];re(o,e),se(n,0,1,0),RN(f.vRight,o,n,n,a,o,s),re(f.frame.up,o),re(f.frame.right,a);const m=t.positions;let y=t.offset;r=f;for(let _=1;_<i;++_){f=t.vertices[_],le(c,f.vLeft,f.vRight);let v=Ee(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),h[0]=m[y]+r.frame.up[0],h[1]=m[y+1]+r.frame.up[1],h[2]=m[y+2]+r.frame.up[2],y+=3;const w=se(Ont,m[y],m[y+1],m[y+2]);RR(w,c,d),Ew(d,pu(h,f.vLeft),l)?(l[0]-=m[y],l[1]-=m[y+1],l[2]-=m[y+2],ge(o,l),ot(a,c,o),ge(a,a)):RN(c,r.frame.up,r.frame.right,n,a,o,s),re(f.frame.up,o),re(f.frame.right,a),r=f}}const Ont=A();let q2e=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(i3(e)),this.normals.push(i3(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:i3(e),normal:r?i3(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};const W2e={top:[0,-.5],bottom:[0,.5]};function n9(t){const r=zwe,i=new q2e,s={v0:0,v1:0};i.addPole(ur(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),h=ur(l*.5,c*.5),d=ur(l,c);i.addVertex(h,d)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),t!=="center"){const o=W2e[t];i.translate(o[0],o[1])}return i}const Rnt={center:n9("center"),top:n9("top"),bottom:n9("bottom")},Pnt={center:o9("center"),top:o9("top"),bottom:o9("bottom")};function o9(t){const i=new q2e,s=ur(.5*-1,.5*-1),n=ur(.5*1,.5*-1),o=ur(.5*1,.5*1),a=ur(.5*-1,.5*1),l=ur(0,-1),c=ur(1,0),h=ur(0,1),d=ur(-1,0);if(i.addPole(ur(0,.5*1),h),i.addPole(ur(0,.5*1)),i.addPole(ur(0,.5*-1)),i.addPole(ur(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,h),i.addVertex(a,h),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,d),i.addVertex(s,d),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=W2e[t];i.translate(f[0],f[1])}return i}function Mnt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Int(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function Z2e(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function $nt(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function Lnt(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function Dnt(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function Nnt(t){return t[0]*t[3]-t[2]*t[1]}function X2e(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*h,t[3]=s*c+o*h,t}function Fnt(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function Unt(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function Vnt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function znt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function knt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Bnt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function Gnt(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function jnt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Y2e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Hnt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function qnt(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Xa();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function Wnt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Znt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const Xnt=X2e,Ynt=Y2e;Object.freeze(Object.defineProperty({__proto__:null,LDU:Gnt,add:jnt,adjoint:Dnt,copy:Mnt,determinant:Nnt,equals:qnt,exactEquals:Hnt,frob:Bnt,fromRotation:Vnt,fromScaling:znt,identity:Int,invert:Lnt,mul:Xnt,multiply:X2e,multiplyScalar:Wnt,multiplyScalarAndAdd:Znt,rotate:Fnt,scale:Unt,set:Z2e,str:knt,sub:Ynt,subtract:Y2e,transpose:$nt},Symbol.toStringTag,{value:"Module"}));function J2e(){return[1,0,0,1]}function Jnt(t){return[t[0],t[1],t[2],t[3]]}function Qnt(t,e,r,i){return[t,e,r,i]}function Knt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Jnt,create:J2e,createView:Knt,fromValues:Qnt},Symbol.toStringTag,{value:"Module"}));let Q2e=class{constructor(){this.vLeft=A(),this.vRight=A(),this.vMinSiblingLength=0,this.frame=new k2e}setFrameFromUpVector(e){re(this.frame.up,e),le(oC,this.vLeft,this.vRight),ge(oC,oC),ie(wne,this.frame.up,me(oC,this.frame.up)),he(hI,oC,wne),ge(hI,hI),ot(this.frame.right,hI,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},eot=class extends Q2e{get rotationFrameUp(){return this.frame.up}get rotationRight(){return dye}get rotationAngle(){return ie(Py,this.frame.up,me(this.frame.up,this.vLeft)),he(Py,this.vLeft,Py),aa(Py,Py),ge(Py,Py),ie(bx,this.frame.up,me(this.frame.up,this.vRight)),he(bx,this.vRight,bx),ge(bx,bx),ot(h4,this.rotationFrameUp,this.vLeft),Math.sign(me(h4,this.vRight))*(Math.PI-Sn(me(Py,bx)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=tz(Math.cos(.5*i));return nr(e,(s-1+1)*r[0],r[1])}},tot=class extends Q2e{get rotationFrameUp(){const e=Math.sign(me(this.frame.right,this.vRight));return ot(nC,this.vRight,this.vLeft),ie(nC,nC,e),ge(nC,nC)}get rotationRight(){const e=this.rotationFrameUp,r=me(e,this.frame.up),i=me(e,this.frame.right);return ie(vx,this.frame.up,-i),ie(bne,this.frame.right,r),le(vx,vx,bne),ge(vx,vx),rot(vne,this.frame,vx),vne}get rotationAngle(){const e=Math.sign(me(this.frame.right,this.vRight));return aa(h4,this.vLeft),-e*(Math.PI-Sn(me(h4,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*tz(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=tz(Math.cos(.5*i)),n=this.rotationRight,o=Z2e(sot,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return e_e(e,r,o)}};function rot(t,e,r){nr(t,me(r,e.right),me(r,e.up))}function iot(t){switch(t){case Mf.World:return new eot;case Mf.Path:return new tot}}const nC=A(),vne=Ue(),vx=A(),bne=A(),h4=A(),Py=A(),bx=A(),wne=A(),oC=A(),hI=A(),sot=J2e(),a9=8;function not(t,e){const r=E.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(b`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Sr("size",s=>s.size)),e.vvSize?(i.uniforms.add(new zt("vvSizeMinSize",s=>s.vvSize.minSize),new zt("vvSizeMaxSize",s=>s.vvSize.maxSize),new zt("vvSizeOffset",s=>s.vvSize.offset),new zt("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(b`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(b`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",a9),i.uniforms.add(new vl("vvOpacityValues",s=>s.vvOpacity.values,a9),new vl("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,a9)),i.code.add(b`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(b`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",E2),i.uniforms.add(new vl("vvColorValues",s=>s.vvColor.values,E2),new qbe("vvColorColors",s=>s.vvColor.colors,E2)),i.code.add(b`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(b`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(IR),t.attributes.add(E.PROFILERIGHT,"vec4"),t.attributes.add(E.PROFILEUP,"vec4"),t.attributes.add(E.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(b`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(b`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(b`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(b`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let oot=class extends jR{constructor(){super(...arguments),this.size=ur(1,1)}};function aot(t){const e=new wr,{vertex:r,fragment:i}=e;switch(gc(r,t),e.varyings.add("vpos","vec3"),e.include(not,t),t.output!==L.Color&&t.output!==L.Alpha||(e.include(wl,t),e.include(sw,t),e.include(iE,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(b`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===L.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(mu,t),t.output){case L.Alpha:e.include(ms,t),i.uniforms.add(new Oe("opacity",s=>s.opacity)),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case L.Color:e.include(ms,t),e.include(ow,t),e.include(JR,t),e.include(sw,t),e.include(TTe,t),ap(i,t),QR(i),dE(i),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("ambient",s=>s.ambient),new zt("diffuse",s=>s.diffuse),new zt("specular",s=>s.specular),new Oe("opacity",s=>s.opacity)),i.include(rm),tm(i),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:e.include(wl,t),Jb(e),e.varyings.add("depth","float"),r.code.add(b`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(ms,t),e.include(Bg,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case L.Normal:e.include(wl,t),e.include(qO,t),vS(r),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ms,t),i.code.add(b`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case L.Highlight:e.include(wl,t),e.include(qO,t),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(ms,t),e.include(ty,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const lot=Object.freeze(Object.defineProperty({__proto__:null,build:aot},Symbol.toStringTag,{value:"Module"})),K2e=new Map([[E.POSITION,0],[E.PROFILERIGHT,1],[E.PROFILEUP,2],[E.PROFILEVERTEXANDNORMAL,3],[E.FEATUREVALUE,4]]);let cot=class extends oot{constructor(){super(...arguments),this.ambient=Ae(.2,.2,.2),this.diffuse=Ae(.8,.8,.8),this.specular=Ae(0,0,0),this.opacity=1,this.origin=A(),this.modelTransformation=null}},eSe=class tSe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Le.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Cr(e.rctx,tSe.shader.get().build(this.configuration),K2e)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===st.NONE,s=e===st.FrontFace;return Ot({blending:r.output!==L.Color&&r.output!==L.Alpha||!r.transparent?null:i?ou:ry(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Ki.None?u_e:null,depthTest:{func:q_(e)},depthWrite:i||s?Al:null,colorWrite:jt,stencilWrite:r.hasOccludees?Hf:null,stencilTest:r.hasOccludees?W_:null,polygonOffset:i||s?null:PF})}};eSe.shader=new Er(lot,()=>ae(()=>import("./Path.glsl-1d41ba48.js"),[]));let Pn=class extends No{constructor(){super(...arguments),this.output=L.Color,this.doubleSidedMode=Ki.None,this.transparencyPassType=st.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([F({count:L.COUNT})],Pn.prototype,"output",void 0),u([F({count:Ki.COUNT})],Pn.prototype,"doubleSidedMode",void 0),u([F({count:st.COUNT})],Pn.prototype,"transparencyPassType",void 0),u([F()],Pn.prototype,"spherical",void 0),u([F()],Pn.prototype,"receiveShadows",void 0),u([F()],Pn.prototype,"receiveAmbientOcclusion",void 0),u([F()],Pn.prototype,"vvSize",void 0),u([F()],Pn.prototype,"vvColor",void 0),u([F()],Pn.prototype,"vvOpacity",void 0),u([F()],Pn.prototype,"hasSlicePlane",void 0),u([F()],Pn.prototype,"transparent",void 0),u([F()],Pn.prototype,"hasOccludees",void 0),u([F()],Pn.prototype,"hasMultipassTerrain",void 0),u([F()],Pn.prototype,"cullAboveGround",void 0),u([F()],Pn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F({constValue:rt.Disabled})],Pn.prototype,"pbrMode",void 0),u([F({constValue:!0})],Pn.prototype,"hasVvInstancing",void 0),u([F({constValue:!1})],Pn.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!1})],Pn.prototype,"useFillLights",void 0);let uot=class rSe extends H_{constructor(e){super(e,new dot),this.supportsEdges=!0,this._vertexAttributeLocations=K2e,this._configuration=new Pn,this._vertexBufferLayout=rSe.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==L.Color&&e!==L.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ki.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ki.WindingOrder:Ki.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==L.Shadow&&e!==L.ShadowExcludeHighlight&&e!==L.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!B2e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:w,minSize:T,maxSize:x}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=_e(v[0]+S*w[0],T[0],x[0]),c[1]*=_e(v[2]+S*w[2],T[2],x[2])}const h=Math.max(c[0],c[1]),d=e.boundingInfo;if(d==null)return void this._intersectTriangles(l,c,s,n,o);const f=Gb(d.bbMin[0]-h,d.bbMin[1]-h,d.bbMin[2]-h,d.bbMax[0]+h,d.bbMax[1]+h,d.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];aX(f,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new hE(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case L.Color:case L.Alpha:case L.Depth:case L.Normal:case L.Highlight:case L.ObjectAndLayerIdColor:return e===(this.parameters.transparent?ce.TRANSPARENT_MATERIAL:ce.OPAQUE_MATERIAL)||e===ce.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new hot(e)}static getVertexBufferLayout(){return Hi().vec3f(E.POSITION).vec4f(E.PROFILERIGHT).vec4f(E.PROFILEUP).vec4f(E.PROFILEVERTEXANDNORMAL).vec4f(E.FEATUREVALUE)}},hot=class extends G_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(eSe,e)}},dot=class extends cot{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const pot=["polyline"];let fot=class extends sm{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=ur(1,1),this._upVectorAlignment=Mf.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){var f,m,y,_;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new GR({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((m=(f=this._context.renderer)==null?void 0:f.visualVariables)==null?void 0:m.length)>0?xS(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Mf.World:Mf.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=Rnt[i];break;case"quad":this._profile=Pnt[i]}switch(this.symbolLayer.join){case"round":this._extruder=new s9(0,Vwe);break;case"bevel":this._extruder=new s9(0,1);break;case"miter":this._extruder=new s9(.8*Math.PI,1);break;default:this._extruder=new gnt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new fne,this._endCap=new fne;break;case"butt":default:this._startCap=new uI(this._profile,0),this._endCap=new uI(this._profile,0,!0);break;case"square":this._startCap=new uI(this._profile,-.5),this._endCap=new uI(this._profile,.5,!0);break;case"round":{const v=s==="quad";this._startCap=new mne({profile:this._profile,flip:!1,breakNormals:v,subdivisions:Y7}),this._endCap=new mne({profile:this._profile,flip:!0,breakNormals:v,subdivisions:Y7});break}}const o=(_=(y=this.symbolLayer)==null?void 0:y.material)==null?void 0:_.color,a=this._getCombinedOpacityAndColor(o),l=Da(a),c=a[3],h=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:h,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||n==="none"?gi.None:gi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(nr(this._intrinsicSize,e,r),!X7(this._intrinsicSize[0])||!X7(this._intrinsicSize[1])))throw new U("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||oc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const v={...d,...this._fastUpdates.materialParameters,size:oye(this._intrinsicSize)};this._material=new uot(v)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=Or.Compressed,this._material=new qf(d);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,pot,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new dp),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){var s,n;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,L_)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!TS(this._fastUpdates,r,this._vvConvertOptions))return Ms.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Ms.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of i)r+=d.length;const l=zo(3*r);let c,h=0;for(const d of i){s.push({offset:h,numVertices:d.length});for(const f of d)l[h++]=f[0],l[h++]=f[1],l[h++]=e.hasZ?f[2]:0}return o==null||n.equals(o)||ai(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=Cve(l):(c=zo(3*r),ai(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,s){var y,_,v;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(w=>w.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=ln(),h=this._context.renderCoordsHelper,d=new JZ(o.vertexDataES);for(const w of o.pathVertexDataInfos){const T=w.numVertices;if(T<2)continue;const x=w.offset;if(this._context.clippingExtent!=null&&(Ti(c),tu(c,o.vertexDataES,x,T),!Vd(c,this._context.clippingExtent)))continue;const S=new Array,O=x+3*T;for(let Z=x;Z<O;Z+=3){d.offset=Z;const W=NYe(d,this._context.elevationProvider,i,h);se(ps,o.vertexDataRS[Z],o.vertexDataRS[Z+1],o.vertexDataRS[Z+2]),h.setAltitude(ps,W),o.vertexDataRS[Z]=ps[0],o.vertexDataRS[Z+1]=ps[1],o.vertexDataRS[Z+2]=ps[2],S.push(iot(this._upVectorAlignment))}const C=new pnt(S,o.vertexDataES,o.vertexDataRS,x);iSe(C,this._upVectorAlignment,this._context.renderCoordsHelper);const P=new fnt(C,this._profile,this._extruder,this._startCap,this._endCap);let $=null;if(this._fastUpdates){const Z=this._fastUpdates.visualVariables,W=Jd((y=Z.size)==null?void 0:y.field,e)??0,j=Jd((_=Z.color)==null?void 0:_.field,e)??0,Y=Jd((v=Z.opacity)==null?void 0:v.field,e)??0;$=new bnt(P,W,j,Y)}else{const Z=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Y=r.size;Z[0]*=xne(Y[0],Y[2]==="symbol-value"?this.symbolLayer.height||0:Y[2],this.symbolLayer.width||0),Z[1]*=xne(Y[2],Y[0]==="symbol-value"?this.symbolLayer.width||0:Y[0],this.symbolLayer.height||0)}let W;this._drivenProperties.color&&(W=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(W=W?[W[0],W[1],W[2],r.opacity]:[1,1,1,r.opacity]);const j=new j2e(P);j.bake(Z),W&&j.bakeVertexColors(W),$=j}const{vertexAttributes:V,indices:z}=$.createGeometryData(),B=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),k=new vnt(this._material,V,z,$,l,this._stencilWidth,B);k.transformation=Cl(ve(),nn,P.path.origin),a.push(k)}if(a.length===0)return null;const f=new iy({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),m=new im(this,f,a,null,null,(w,T,x,S,O)=>got(w,T,S,O,this._upVectorAlignment),i);return m.alignedSampledElevation=0,m.needsElevationUpdates=L_(i.mode),m}};function iSe(t,e,r){const{origin:i,positions:s}=t;let n=t.offset;switch(e){default:case Mf.World:for(const o of t.vertices)ps[0]=s[n++]+i[0],ps[1]=s[n++]+i[1],ps[2]=s[n++]+i[2],r.worldUpAtPosition(ps,ps),o.setFrameFromUpVector(ps);break;case Mf.Path:ps[0]=s[n]+i[0],ps[1]=s[n+1]+i[1],ps[2]=s[n+2]+i[2],r.worldUpAtPosition(ps,ps),Ant(t,ps)}}function xne(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function mot(t,e,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let h=t.offset;h<c;h+=3)se(ps,l[h],l[h+1],l[h+2]),r(ps,l9),s+=l9.sampledElevation,ps[0]=a[h]+n[0],ps[1]=a[h+1]+n[1],ps[2]=a[h+2]+n[2],i.setAltitude(ps,l9.z),a[h]=ps[0]-n[0],a[h+1]=ps[1]-n[1],a[h+2]=ps[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function got(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!B2e(l))continue;const c=l.path,h=c.builder.path;a+=mot(h,e,r,i),s!==Mf.World&&iSe(h,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const ps=A(),l9=new qR;function yot(t,e,r,i,s=1){if(r.isGeographic&&i===Le.Global){const c=zo(e.length),h=e.length,d=Nr(r);for(let f=0;f<h;f+=3)U5(e,f,c,f,d);e=c}nr(Ks,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Ks[0]=Math.min(Ks[0],e[c]),Ks[1]=Math.min(Ks[1],e[c+1]);const n=Ks[0]%s,o=Ks[1]%s,a=Ks[0]-n,l=Ks[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/s,t[h+1]=(e[c+1]-l)/s,t[h+2]=a/s,t[h+3]=l/s}}function sSe(t,e,r,i,s=1){se(Ev,1,0,0),se(Cv,0,1,0),se(xx,0,0,1),bot(c9,r),_ot(r,Tne)&&vot(Tne,Ev,Cv,xx,i,c9),nr(Ks,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),nr(Av,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<r.length;h+=3){se(wx,r[h],r[h+1],r[h+2]);const d=me(Ev,wx),f=me(Cv,wx);Ks[0]=Math.min(Ks[0],d),Ks[1]=Math.min(Ks[1],f),Av[0]=Math.max(Av[0],d),Av[1]=Math.max(Av[1],f)}const n=me(xx,c9);h9(My,Ks[0],Ks[1],n,Ev,Cv,xx),h9(Ov,Av[0],Ks[1],n,Ev,Cv,xx),h9(Rv,Ks[0],Av[1],n,Ev,Cv,xx),he(Ov,Ov,My),ie(Ov,Ov,.5),he(Rv,Rv,My),ie(Rv,Rv,.5),le(My,My,Ov),le(My,My,Rv);const o=Ks[0]%s,a=Ks[1]%s,l=Ks[0]-o,c=Ks[1]-a;for(let h=0;h<r.length;h+=3){se(wx,r[h],r[h+1],r[h+2]);const d=h/3,f=4*d;t[f]=(me(Ev,wx)-l)/s,t[f+1]=(me(Cv,wx)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*d;for(let y=0;y<3;y++)e[m+y]=My[y],e[m+y+3]=Ov[y],e[m+y+6]=Rv[y]}}const c9=A(),wx=A(),Tne=Ir(),Ev=A(),Cv=A(),xx=A(),Ks=Ue(),Av=Ue(),My=A(),Ov=A(),Rv=A();function _ot(t,e){const r=t.length/3-1;return $ye(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function vot(t,e,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,Pp),se(dI,Pp[0],Pp[1],Pp[2]),se(pI,Pp[4],Pp[5],Pp[6]),se(u9,Pp[8],Pp[9],Pp[10])):(se(dI,1,0,0),se(pI,0,1,0),se(u9,0,0,1));const o=t;me(o,u9)<0&&ie(o,o,-1),re(i,o);const a=me(o,pI),l=me(o,dI);Math.abs(a)<Math.abs(l)?(tb(e,dI,o,-l),ge(e,e),ot(r,e,o),ge(r,r),ie(r,r,-1)):(tb(r,pI,o,-a),ge(r,r),ot(e,r,o),ge(e,e))}const Pp=ve(),dI=A(),pI=A(),u9=A();function bot(t,e){se(aC,0,0,0);for(let r=0;r<e.length-3;r+=3)aC[0]+=e[r],aC[1]+=e[r+1],aC[2]+=e[r+2];ie(t,aC,1/(e.length/3-1))}const aC=A();function h9(t,e,r,i,s,n,o){se(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}function wot(t){const e=new wr,{vertex:r,fragment:i,attributes:s,varyings:n}=e;gc(r,t),e.include(wl,t),e.include(Lw,t),e.include(vg,t),e.include(BR,t),s.add(E.POSITION,"vec3"),t.vvColor&&s.add(E.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha);o&&n.add("depth","float"),r.uniforms.add(new ir("eColor",c=>c.color));const a=t.output===L.Depth;a&&(e.include(Bg,t),Jb(e),O_(e)),r.code.add(b`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ms,t),o&&e.include(mu,t),i.include(rm);const l=t.output===L.Highlight;return l&&e.include(ty,t),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===L.ObjectAndLayerIdColor?b`fColor.a = 1.0;`:""}

    if (fColor.a < ${b.float(ho)}) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(fColor.a);`:""}

    ${t.output===L.Color?b`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?b`outputHighlight();`:""};
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""};
    ${t.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const xot=Object.freeze(Object.defineProperty({__proto__:null,build:wot},Symbol.toStringTag,{value:"Module"}));let nSe=class oSe extends Pr{initializeProgram(e){return new Cr(e.rctx,oSe.shader.get().build(this.configuration),br)}_createPipeline(e,r){const i=this.configuration,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:i.output!==L.Color&&i.output!==L.Alpha||!i.transparent?null:s?ou:ry(e),culling:eF(i.cullFace),depthTest:{func:q_(e)},depthWrite:(s||n)&&i.writeDepth?Al:null,colorWrite:jt,stencilWrite:i.hasOccludees?Hf:null,stencilTest:i.hasOccludees?r?F_:W_:null,polygonOffset:s||n?i.polygonOffset?Tot:null:MF(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};nSe.shader=new Er(xot,()=>ae(()=>import("./ColorMaterial.glsl-408fad96.js"),[]));const Tot={factor:1,units:1};let Eo=class extends No{constructor(){super(...arguments),this.output=L.Color,this.cullFace=gi.None,this.transparencyPassType=st.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};u([F({count:L.COUNT})],Eo.prototype,"output",void 0),u([F({count:gi.COUNT})],Eo.prototype,"cullFace",void 0),u([F({count:st.COUNT})],Eo.prototype,"transparencyPassType",void 0),u([F()],Eo.prototype,"hasSlicePlane",void 0),u([F()],Eo.prototype,"hasVertexColors",void 0),u([F()],Eo.prototype,"transparent",void 0),u([F()],Eo.prototype,"polygonOffset",void 0),u([F()],Eo.prototype,"enableOffset",void 0),u([F()],Eo.prototype,"writeDepth",void 0),u([F()],Eo.prototype,"hasOccludees",void 0),u([F()],Eo.prototype,"hasMultipassTerrain",void 0),u([F()],Eo.prototype,"cullAboveGround",void 0),u([F()],Eo.prototype,"objectAndLayerIdColorInstanced",void 0),u([F()],Eo.prototype,"vvColor",void 0),u([F({constValue:!0})],Eo.prototype,"hasVvInstancing",void 0),u([F({constValue:!1})],Eo.prototype,"vvSize",void 0),u([F({constValue:!1})],Eo.prototype,"vvOpacity",void 0);let Sne=class extends jX{constructor(e){super(e,new Eot),this.supportsEdges=!0,this._configuration=new Eo}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<RF,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth&&this.parameters.writeLinearDepth||r===L.ObjectAndLayerIdColor?e===ce.DRAPED_MATERIAL?!0:r===L.Highlight?e===ce.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ce.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new Sot(e)}createBufferWriter(){const e=Hi().vec3f(E.POSITION);return oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4u8(E.COLOR),new hE(e)}},Sot=class extends G_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this.ensureTechnique(nSe,e)}},Eot=class extends jR{constructor(){super(...arguments),this.color=Cf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=gi.None,this.hasOccludees=!1}};var uo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(uo||(uo={}));const gG=.70710678118,Ene=gG,Cot=.08715574274;function Aot(t){const e=new wr,r=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha),{vertex:i,fragment:s,attributes:n,varyings:o}=e;gc(i,t),e.include(wl,t),e.include(Lw,t),e.include(vg,t),t.draped?i.uniforms.add(new Oe("worldToScreenRatio",(c,h)=>1/h.screenToPCSRatio)):n.add(E.BOUNDINGRECT,"mat3"),n.add(E.POSITION,"vec3"),n.add(E.UVMAPSPACE,"vec4"),t.vvColor&&n.add(E.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new ir("uColor",c=>c.color));const a=t.style===uo.ForwardDiagonal||t.style===uo.BackwardDiagonal||t.style===uo.DiagonalCross;a&&i.code.add(b`
      const mat2 rotate45 = mat2(${b.float(gG)}, ${b.float(-Ene)},
                                 ${b.float(Ene)}, ${b.float(gG)});
    `),t.draped||(ap(i,t),i.uniforms.add(new Oe("worldToScreenPerDistanceRatio",(c,h)=>1/h.camera.perScreenPixelRatio)),i.code.add(b`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(b`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(b`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${b.float(Cot)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(b`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":b`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${b.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===L.Depth;return l&&(e.include(Bg,t),Jb(e),O_(e)),i.code.add(b`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(ms,t),s.include(rm),t.draped&&s.uniforms.add(new Oe("texelSize",(c,h)=>1/h.camera.pixelRatio)),t.output===L.Highlight&&e.include(ty,t),r&&e.include(mu,t),t.output!==L.Highlight&&(s.code.add(b`
      const float lineWidth = ${b.float(t.lineWidth)};
      const float spacing = ${b.float(t.patternSpacing)};
      const float spacingINV = ${b.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(b`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.code.add(b`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==L.Highlight?b`color.a *= ${Oot(t)};`:""}

      ${t.output===L.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

      if (color.a < ${b.float(ho)}) {
        discard;
      }

      ${t.output===L.Alpha?b`fragColor = vec4(color.a);`:""}

      ${t.output===L.Color?b`fragColor = color; ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===L.Highlight?b`outputHighlight();`:""}
      ${t.output===L.Depth?b`outputDepth(linearDepth);`:""};
    }
  `),e}function Oot(t){function e(r){return t.draped?b`coverage(vuv.${r}, texelSize)`:b`sampleAA(vuv.${r})`}switch(t.style){case uo.ForwardDiagonal:case uo.Horizontal:return e("y");case uo.BackwardDiagonal:case uo.Vertical:return e("x");case uo.DiagonalCross:case uo.Cross:return b`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const Rot=Object.freeze(Object.defineProperty({__proto__:null,build:Aot},Symbol.toStringTag,{value:"Module"}));let aSe=class lSe extends Pr{initializeProgram(e){return new Cr(e.rctx,lSe.shader.get().build(this.configuration),cSe)}_setPipelineState(e,r){const i=this.configuration,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:i.output===L.Color||i.output===L.Alpha?s?ou:ry(e):null,culling:eF(i.cullFace),depthTest:{func:q_(e)},depthWrite:s?i.writeDepth?Al:null:OF(e),colorWrite:jt,stencilWrite:i.hasOccludees?Hf:null,stencilTest:i.hasOccludees?r?F_:W_:null,polygonOffset:s||n?i.polygonOffset?Pot:null:MF(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};aSe.shader=new Er(Rot,()=>ae(()=>import("./Pattern.glsl-191b7316.js"),[]));const Pot={factor:1,units:1};let Mn=class extends No{constructor(){super(...arguments),this.output=L.Color,this.cullFace=gi.None,this.transparencyPassType=st.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}};u([F({count:L.COUNT})],Mn.prototype,"output",void 0),u([F({count:gi.COUNT})],Mn.prototype,"cullFace",void 0),u([F({count:uo.COUNT})],Mn.prototype,"style",void 0),u([F({count:st.COUNT})],Mn.prototype,"transparencyPassType",void 0),u([F()],Mn.prototype,"hasSlicePlane",void 0),u([F()],Mn.prototype,"hasVertexColors",void 0),u([F()],Mn.prototype,"polygonOffset",void 0),u([F()],Mn.prototype,"writeDepth",void 0),u([F()],Mn.prototype,"hasOccludees",void 0),u([F()],Mn.prototype,"patternSpacing",void 0),u([F()],Mn.prototype,"lineWidth",void 0),u([F()],Mn.prototype,"enableOffset",void 0),u([F()],Mn.prototype,"draped",void 0),u([F()],Mn.prototype,"hasMultipassTerrain",void 0),u([F()],Mn.prototype,"cullAboveGround",void 0),u([F()],Mn.prototype,"vvColor",void 0),u([F({constValue:!1})],Mn.prototype,"hasVvInstancing",void 0),u([F({constValue:!1})],Mn.prototype,"vvSize",void 0),u([F({constValue:!1})],Mn.prototype,"vvOpacity",void 0);const cSe=new Map([[E.POSITION,0],[E.COLOR,3],[E.UVMAPSPACE,4],[E.COLORFEATUREATTRIBUTE,5],[E.BOUNDINGRECT,6]]);let _Y=class extends jX{constructor(e){super(e,new $ot),this.supportsEdges=!0,this._vertexAttributeLocations=cSe,this._configuration=new Mn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<RF,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth&&this.parameters.writeLinearDepth?e===ce.DRAPED_MATERIAL?!0:r===L.Highlight?e===ce.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new Mot(e)}createBufferWriter(){const e=Hi().vec3f(E.POSITION).vec4f(E.UVMAPSPACE);return this.parameters.draped||e.mat3f(E.BOUNDINGRECT),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4u8(E.COLOR),new Iot(e)}},Mot=class extends G_{_updateParameters(e){return this.ensureTechnique(aSe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Iot=class extends hE{write(e,r,i,s,n){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case E.UVMAPSPACE:{tt(a.size===4);const c=s.getField(o,op);c&&bS(l,a.data,c,n);break}case E.BOUNDINGRECT:{tt(a.size===9);const c=s.getField(o,R_);c&&this.writeBoundingRect(l,a.data,e,c,n);break}default:Obe(o,a,l,e,r,s,n)}}}writeBoundingRect(e,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const d=9*e[h],f=r[d],m=r[d+1],y=r[d+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=r[d+_];n+=l}}},$ot=class extends jR{constructor(){super(...arguments),this.color=Ft(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=gi.None,this.hasOccludees=!1,this.style=uo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function Lot(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new Sne(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Ft(0,0,0,0),e.transparent=!0),new Sne(e)):(e.style=Dot(r.style),new _Y(e))}function Dot(t){switch(t){case"horizontal":return uo.Horizontal;case"vertical":return uo.Vertical;case"cross":return uo.Cross;case"forward-diagonal":return uo.ForwardDiagonal;case"backward-diagonal":return uo.BackwardDiagonal;case"diagonal-cross":return uo.DiagonalCross;default:return}}function Not(t){return t.material instanceof _Y&&!t.material.parameters.draped}function Fot(t,e){if(Not(t)){const r=t.vertexAttributes.get(E.POSITION).data,i=t.getMutableAttribute(E.UVMAPSPACE).data,s=t.getMutableAttribute(E.BOUNDINGRECT).data;sSe(i,s,r,e)}}function Uot(t,e,r,i,s){const n=Mwe(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)Fot(a,s);return n}const Vot=["polyline","polygon","extent"],Cne=new GR({size:!1,color:!0,rotation:!1,opacity:!1});let uSe=class hSe extends sm{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=xS(this._context.renderer,Cne)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){var i,s,n;if(this._material!=null)return;const e=(s=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:s.color,r=this._getCombinedOpacityAndColor(e);this._material=Lot(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(n=this._fastUpdates)==null?void 0:n.materialParameters}),this._needsUV=this._material instanceof _Y,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const s=h2e(e.pattern);return new i2({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:hG(e.patternCap||"butt")})};this._outlineMaterial=r(po(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Vot,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new dp);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!TS(this._fastUpdates,r,Cne))return Ms.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return Ms.FastUpdate}layerOpacityChanged(){var e,r;if(this._material!=null){const i=this._material.parameters.color,s=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,n=this._getCombinedOpacity(s);this._material.setParameters({color:[i[0],i[1],i[2],n],transparent:n<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const i=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HR(hSe.elevationModeChangeTypes,i,s);if(n!==ls.UPDATE)return n;const o=Rh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var h;const s=HO(e.geometry);if(!s)return null;const n=KX(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new zot(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Qi(4*a,!0),o.boundingRect=zo(9*a,!0),sSe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new iy({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new im(this,l,o.outGeometries,null,null,Uot,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Rh(i.mode),c}_createAs3DShapeFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(Ti(qh),tu(qh,o),!Vd(qh,this._context.clippingExtent)))continue;const h=CS(o,a,3);if(h.length===0)continue;const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,f=$ie({material:this._material,indices:h,mapPositions:o,attributeData:{position:n,color:d?null:r.color,colorFeature:d?Jd(d.field,e):null,uvMapSpace:this._needsUV?CN(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?fh(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(f)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(this._context.clippingExtent!=null&&(Ti(qh),tu(qh,s),!Vd(qh,this._context.clippingExtent)))continue;const o=dG(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,r){var a;const i=HO(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=vTe(i,this._context.overlaySR),n=new kot(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Qi(4*o,!0),yot(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Ti(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new XF(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,holeIndices:o,index:a,count:l}of i){const c=Ti(qh);if(tu(c,n),!Vd(c,this._context.clippingExtent))continue;const h=CS(n,o,3);if(h.length===0)continue;J2(r.outBoundingBox,c);const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,f=$ie({material:this._material,indices:h,attributeData:{position:n,color:d?null:r.color,colorFeature:d?Jd(d.field,e):null,uvMapSpace:this._needsUV?CN(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new RS(f,r))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(Ti(qh),tu(qh,s),!Vd(qh,this._context.clippingExtent))continue;J2(e.outBoundingBox,qh);const n=dG(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new RS(n,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,s;const e=(s=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:s.color,r=this._getOutlineOpacity();return DA(e!=null?ke.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};uSe.elevationModeChangeTypes={definedChanged:ls.RECREATE,staysOnTheGround:ls.NONE,onTheGroundChanged:ls.RECREATE};const qh=ln();let zot=class extends BF{constructor(e,r,i,s){super(e,i,s),this.color=r}},kot=class extends BF{constructor(e,r,i,s){super(e,i,s),this.color=r}};const Bot="arial-unicode-ms",Ane="woff2",One=new Map,dSe=new Set;let Got=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function jot(t){const e=Wot(t),r=One.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${Yr.fontsUrl}/woff2/${e}.${Ane}') format('${Ane}')`,{style:t.style,weight:t.weight}),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return One.set(e,new Got(i,n)),dSe.add(i),n}function Hot(t){return dSe.has(t)}function qot(t){if(!t)return Bot;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Wot(t){const e=Zot(t)+Xot(t);return qot(t.family)+(e.length>0?e:"-regular")}function Zot(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Xot(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let pSe=class fSe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var f,m,y,_,v;const i=(f=e==null?void 0:e.material)==null?void 0:f.color,s=ke.toUnitRGBA(i)??Cf,n=e.size!=null?po(e.size):12,o=e.lineHeight,a=e.background!=null?ke.toUnitRGBA(e.background.color):Cf,l={family:((m=e.font)==null?void 0:m.family)??"sans-serif",decoration:((y=e.font)==null?void 0:y.decoration)??"none",weight:((_=e.font)==null?void 0:_.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,h=c!=null&&c.color!=null&&c.size>0?{size:po(c.size),color:ke.toUnitRGBA(c.color)}:{size:0,color:Cf},d=new fSe({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r});if(e.font){let w=!1;const T=d.fontString(n);try{w=(await document.fonts.load(T)).some(x=>!Hot(x))}catch{Q.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${T}'. Some text symbology may be rendered using the default browser font.`)}if(!w&&!Yot.has(e.font.family))try{await jot(e.font)}catch{}}return d}};const Yot=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let Jot=class{constructor(e,r,i){this._renderer=new i2e(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=cG(Qot,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Iw(e,{wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Qot={canvas:null},Kot=[0,0,1];let eat=class extends sm{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=DF(this.symbolLayer.size);if(e)throw new U("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await pSe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=GO(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=yW(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!qme(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new Owe(n,this.symbolLayer.horizontalAlignment,Crt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(e,r,i,s){const n=e.graphic,o=GO(n.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return Rne(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),ls.UPDATE}slicePlaneEnabledChanged(e,r){return Rne(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Rh(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return rat}_createAs3DShape(e,r,i,s,n,o){var $;const a=this.setGraphicElevationContext(e,new dp,s.elevationOffset),l=(($=e.geometry)==null?void 0:$.type)==="polyline",c=e.uid;let h=null,d=null;if(o==null){const V=n2e(s.horizontalPlacement);h=new Jot(i,V,this._textRenderParameters);let z=null;if(this._context.sharedResources.textures!=null){d=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{z!=null&&z.release()});const B=this._context.stage.renderView.textureRepository.acquire(d.texture.id);if(B==null||gu(B))return d.release(),null;z=B}}const f=tat(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?m.textureId=o.id:d!=null&&(m.textureId=d.texture.id),s.verticalOffset!=null){const{screenLength:V,minWorldLength:z,maxWorldLength:B}=s.verticalOffset;m.verticalOffset={screenLength:po(V),minWorldLength:z||0,maxWorldLength:B??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:V,screenSizePerspectiveSettingsLabels:z}=this._context.sharedResources;m.screenSizePerspective=z.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=V}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,n!=null){const V=JSON.stringify(m);y=n.get(V),y==null&&(y=new SS(m),n.add(V,y))}else y=new SS(m);const _=s.translation,v=h?ur(h.displayWidth,h.displayHeight):np,w=s.centerOffset,T=d7(y,Kot,_,null,v,w,[0,0],null),x=RX(this._context,r,T,a,c);if(x==null)return null;const S=new im(this,x.object,[T],n==null?[y]:null,d,Eb,a);S.alignedSampledElevation=x.sampledElevation,S.needsElevationUpdates=Rh(a.mode)||a.mode==="absolute-height";const{displayWidth:O,displayHeight:C}=h??s;S.getScreenSize=(V=Ue())=>(V[0]=O,V[1]=C,V);const P=new Uwe(s.elevationOffset,i);return S.metadata=P,BO(S,r,this._context.elevationProvider),S}};function Rne(t,e,r){t&&t.forEach(i=>{const s=e(i);s!=null&&r(s,i.graphic)})}function tat(t,e){if(e.verticalPlacement==="baseline"){const i=Trt[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return ur(i,s)}const r=Ert(e.horizontalPlacement,e.verticalPlacement);return OL[r]}const rat={mode:"relative-to-ground",offset:0},iat={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},sat=["polyline","polygon","extent"];let yG=class p1 extends sm{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,sat,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new dp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const e=new lTe,r=this.symbolLayer.color;r!=null&&(e.color=ke.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?p1.headingVectorFromAngle(this.symbolLayer.waveDirection):ur(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=iat[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new aTe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=HR(p1.elevationModeChangeTypes,i,s);if(n!==ls.UPDATE)return n;const o=Rh(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var d;const s=HO(e.geometry);if(s==null)return null;const n=KX(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=zo(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new nat(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(d=this._context.stage.renderView)==null?void 0:d.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new iy({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),h=new im(this,c,l.outGeometries,null,null,Mwe,r);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=Rh(r.mode),h}_createUVCoordsFromVertices(e,r,i,s){const n=Za(s);vc(Iy);for(let l=0;l<i;l++)nr(Pne,r[3*l],r[3*l+1]),f2(Iy,Pne);kb(Iy,Iy,n);const o=Iy[0]%p1.unitSizeOfTexture,a=Iy[1]%p1.unitSizeOfTexture;fI[0]=Iy[0]-o,fI[1]=Iy[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-fI[0])/p1.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-fI[1])/p1.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(Ti(Pv),tu(Pv,a),!Vd(Pv,this._context.clippingExtent)))continue;const c=CS(a,l,3);if(c.length===0)continue;const h=fh(i,2*n,2*s),d=Lie({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){var a;const r=HO(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=vTe(r,this._context.overlaySR),s=i.position.length/3,n=zo(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new oat(i,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=Ti(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new XF(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(Ti(Pv),tu(Pv,s),!Vd(Pv,this._context.clippingExtent))continue;J2(e.outBoundingBox,Pv);const l=CS(s,n,3);if(l.length===0)continue;const c=fh(r,2*o,2*a),h=Lie({material:this._material,indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new RS(h,e))}}static headingVectorFromAngle(e){const r=Ue(),i=n5(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};yG.unitSizeOfTexture=100,yG.elevationModeChangeTypes={definedChanged:ls.RECREATE,staysOnTheGround:ls.NONE,onTheGroundChanged:ls.RECREATE};const fI=Ue(),Iy=kt(),Pne=Ue(),Pv=ln();let nat=class extends BF{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}},oat=class extends BF{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function aat(t,e,r,i){var n;const s=((n=cat[t.type])==null?void 0:n[e.type])||lat[e.type];return s?new s(t,e,r,i):(Q.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const lat={icon:uG,object:dnt,line:d2e,path:fot,fill:uSe,extrude:ett,text:eat,water:yG},cat={"mesh-3d":{fill:$it}};let uat=class extends CX{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.at(n);if(o.enabled===!1)continue;mI.renderPriority=1-(1+n)/i,mI.renderPriorityStep=1/i,mI.ignoreDrivers=o.ignoreDrivers;const a=aat(this.symbol,o,this._context,mI),l=BH(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await r5(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Qt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,s=this.symbolLayers.map(o=>(o==null?void 0:o.createGraphics3DGraphic(e))??null),n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new sQe(i,r||this,s,e.layer,n)}get complexity(){return OX(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof im?l:null};if(n!=null&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==Zc.LOADED?Ms.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==Ms.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(e,r)):i,Ms.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Zc.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];h!=null&&a.graphics3DGraphicPatches.forEach(d=>d(h,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,s)=>i.updateGeometry(s,r))}updateTransform(e,r,i,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,r,i,s))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=e.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=e.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===Zc.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(fw).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return Qt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const mI=new nQe;let hat=class extends CX{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:AX}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):Ms.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,s){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,r,i,s))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function vY(t){return t instanceof hat?t.graphics3DSymbol:t instanceof uat?t:null}const XO=Q.getLogger("esri.views.3d.layers.graphics.labelPlacement");function dat(t){const e=wat(t);if(e==null)return null;const r=pat(t,e);if(r==null)return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset;return mat({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Ue(),centerOffset:Ft(0,0,0,-1),centerOffsetUnits:"world",translation:A(),elevationOffset:0,hasLabelVerticalOffset:s},r,t)}function pat(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=Gd[r],s=i||d4(t);return r&&!i&&XO.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),fat(s,t)}function bY(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=vY(e);return r!=null?r.symbol.symbolLayers.at(0):null}function fat(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(XO.warnOncePerTick(Mne(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),d4(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return XO.warnOncePerTick(Mne(t==null?void 0:t.placement,`'${i}' geometries`)),d4(e);break;case"point":case"mesh":return t}return t}function Mne(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function d4(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=bY(t);return r!=null&&r.type==="extrude"?Gd["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Gd["above-center"];default:return}}function mat(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":yat(t,e,r);break;case"polygon":gat(t,e,r);break;case"mesh":wY(t,e,r.graphics3DGraphic.layers[0])}return t}function gat(t,e,r){const i=bY(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(HA),Ud(HA,t.translation),t.translation[2]=z_(HA)/2):se(t.translation,0,0,0),wY(t,e,s);break}}}function yat(t,e,r){const i=bY(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):se(t.translation,0,0,0),i.type){case"icon":case"text":_at(t,e,r,s);break;case"object":wY(t,e,s)}}function _at(t,e,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Gd[r.labelClass.labelPlacement]&&XO.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=vat(r);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function vat(t,e=xat){const{graphics3DGraphic:r}=t,i=r.layers[0],s=i!=null?i.stageObject.geometries[0].material:null;if(s&&s instanceof SS){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function wY(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(HA):HA,s=Ae(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Ee(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function bat(t){return t==="above-center"}function wat(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=vY(i.graphics3DSymbol),n=lc(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Gd[e]||d4(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Ine(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&bat(o.placement)?{placement:"above-center",verticalOffset:Ine(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(XO.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function Ine(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const Gd={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},$ne={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in $ne){const e=$ne[t],r=Gd[t];e.forEach(i=>{Gd[i]=r})}Object.freeze&&(Object.freeze(Gd),Object.keys(Gd).forEach(t=>{var e;Object.freeze(Gd[t]),Object.freeze((e=Gd[t])==null?void 0:e.normalizedOffset)}));const xat=[0,0],HA=ln();let Lne=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const gI=4096;let Tat=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Yt()}},Sat=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new Tat,this.rendered=!1}},Eat=class{constructor(e,r,i){this.size=e,this.cursor=r,this.lineHeight=i}resize(e){this.size.height=e}resetCursor(){this.cursor.x=qA,this.cursor.y=qA+mSe,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}},R3=class extends xe{constructor(e){super(e),this.type=as.Texture,this.id=pc(),this.events=new Ls,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new Eat({width:gI,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=Fe(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const r=new vr;return r.wrapMode=Dt.CLAMP_TO_EDGE,r.flipped=!0,r.samplingMode=At.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,r}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new Ct(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(pt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Di(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Fe(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,r,i,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,wi(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=i,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].setAttributeData(E.SIZE,[0,0]),r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+qA,l=o+qA+mSe;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=i.cursor.y+l+i.lineHeight-i.size.height,h=i.size.height+c<gI;if(h){const d=Math.ceil(i.size.height*Math.max(1.3,(c+i.size.height)/i.size.height));this._resizeAtlas(Math.min(BX(d),gI))}return!r||!h&&i.size.height===gI?(this._processRemovals(),s2.OK):(this._repack(),s2.REPACK)}i.cursor.x=qA,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return s2.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].setAttributeData(E.UV0,e.placement.uvMinMax),i.geometries[0].setAttributeData(E.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(this._glTexture==null)return Bo.YIELD;let i=!1;if(Lo(this._elementsToAddOrUpdate,(n,o)=>{const a=this._elements.get(o);if(a!=null&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0],d=this._elements.get(o);h.setAttributeData(E.UV0,d.placement.uvMinMax),h.setAttributeData(E.SIZE,[d.textRenderer.displayWidth,d.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===s2.REPACK&&(i=!0,!0)}),i)return this.runTask(Va,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),Lo(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&UQe.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new Sat(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,s)=>e.push({element:i,key:s}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,s)=>i.key.localeCompare(s.key)),this._elements.clear();for(const{element:i,key:s}of e)this._elements.set(s,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:s}=this,n=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:s,resizeAtlas:o=>n._resizeAtlas(o),run:(o,a)=>n.runTask(o,a)}}};u([p({constructOnly:!0})],R3.prototype,"view",void 0),u([p({type:Boolean})],R3.prototype,"updating",void 0),R3=u([R("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],R3);const qA=2,mSe=2;var s2;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(s2||(s2={}));let Dne=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},Cat=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},Aat=class{constructor(e,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new Lxe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},f1=class extends xe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Mi,this._handles.add([ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(pt.LABELER,this)]),this._textTextureAtlas=new R3({view:this.view}),this._hudMaterialCollection=new Lne(this.view._stage),this._calloutMaterialCollection=new Lne(this.view._stage)}dispose(){this._handles=Pe(this._handles),this._textTextureAtlas=Fe(this._textTextureAtlas),this._hudMaterialCollection=Fe(this._hudMaterialCollection),this._calloutMaterialCollection=Fe(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),Wh.graphic=null,Wh.renderingInfo=null,Wh.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new Dne(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(Bn.LABEL,Fo.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(Bn.LABEL,Fo.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Bo.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!Nne(r)){if(Oat(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),d9(r)){this._dirty=!0;continue}if(!Nne(r))continue}Lo(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),Qt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=s.labelingInfo&&s.labelingInfo.filter(c=>!!c.symbol);!n||n.length===0||(await r5(n,async(c,h)=>{const d=c.symbol,f=vY(i.getOrCreateGraphics3DSymbol(d));if(f==null)return void Q.getLogger(this).error("Failed to create Graphics3DSymbol for label");await f.load(),Qt(r);let m=null;yW(d)&&d.hasVisibleCallout()&&(m=$Je(d,i.symbolCreationContext),await m.load(),Qt(r));const y=await uu(Cwe(c,e.layer.fieldsIndex,this.view.spatialReference));if(Qt(r),y.ok===!0){const _=await this._createTextRenderParameters(f.symbol);Qt(r),e.labelClassContexts[h]=new Cat(c,f,m,_,y.value)}else Q.getLogger(this).error(`Label expression failed to evaluate: ${y.error}`)}),Qt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(ys(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return(r==null?void 0:r.type)!=="text"?null:pSe.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,lu(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n){const o=new Owe(i.verticalOffset,Nse(i.anchor),Srt(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return Wh.graphic=r,Wh.renderingInfo=null,Wh.layer=s,n.createLabel(Wh,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,s,n){return Wh.graphic=e,Wh.layer=n,Wh.renderingInfo=new MJe(null,r,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(Wh)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=yI(i.layer);for(let h=0;h<s.length;h++){const d=e.textRenderers[h],f=e.textLabelPlacements[h];if(d==null||f==null)continue;const m=s[h],y=m.graphics3DSymbol,_=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,v=y.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(i.elevationInfoOverride);const w=this._createTextSymbolGraphic(d,o,f,a,v);if(w==null)return!1;w._labelClass=m.labelClass,w._labelIndex=h,r.addLabelGraphic(w,i.stageLayer),r.deconflictionPriority=((c=m.textRenderParameters)==null?void 0:c.definition.size)??0,r.setVisibilityFlag(Bn.LABEL,Fo.USER,l),r.setVisibilityFlag(Bn.LABEL,Fo.SCALE_RANGE,!0),r.setVisibilityFlag(Bn.LABEL,Fo.DECONFLICTION,!1),n=!0;const T=m.graphics3DCalloutSymbolLayer;if(T&&f.hasLabelVerticalOffset){T.setElevationInfoOverride(i.elevationInfoOverride);const x=this._createLineCalloutGraphic(o,_,T,f,a);x!=null&&(m.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(x,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s!=null&&s.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const T=l.needsHydrationToEvaluate()?fYe(s,r.layer):s;c=l.evaluate(T)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol,d=((n=h.symbol)==null?void 0:n.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,y=r.disablePlacement,_=dat({graphics3DGraphic:f,labelSymbol:d,labelClass:m,disablePlacement:y});if(_==null)continue;const v=Nse(_.anchor),w=n2e(v);e.textRenderers[o]=new i2e(c,w,a.textRenderParameters),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new Dne(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=yI(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new Aat(this.view._stage,a,e,r,s,n,o,yI(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>yI(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.rendered?(this._labelsToAdd.set(i,s),this._labelsToRemove.delete(i),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.rendered&&(this._labelsToRemove.set(i,s),this._labelsToAdd.delete(i)),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>d9(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(d9(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function d9(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function Nne(t){return t.labelClassContexts&&t.labelClassContexts.length}function Oat(t){return t.labelClassContexts===null}function yI(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}u([p({constructOnly:!0})],f1.prototype,"view",void 0),u([p({constructOnly:!0})],f1.prototype,"deconflictor",void 0),u([p()],f1.prototype,"_textTextureAtlas",void 0),u([p({type:Boolean,readOnly:!0})],f1.prototype,"updating",null),f1=u([R("esri.views.3d.layers.graphics.Labeler")],f1);const Wh=new IJe(null,null,null);let P3=class yT{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=kt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Qo.VISIBLE_ON_SURFACE,screenRect:kt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=yT.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new yT(r,i,s,this.tilingScheme),new yT(r,i+1,s,this.tilingScheme),new yT(r,i,s+1,this.tilingScheme),new yT(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Ig(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Qo;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Qo||(Qo={}));const gSe=.5*Math.PI,Rat=gSe/Math.PI*180;let Pat=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:A(),direction:A()};for(let r=0;r<4;r++)this._extent[r]={origin:A(),direction:A(),cap:{next:null,direction:A()}},this._planes[r]=Ir();this._planes[pi.NEAR]=Ir(),this._planes[pi.FAR]=Ir(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),le(this._center.origin,n[0].origin,n[2].origin),ie(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ie(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Gg(a.cap.direction,a.origin,l.origin),SO(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ie(a.direction,a.direction,-1)}SO(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[pi.NEAR]),s?Xk(this._planes[pi.NEAR],this._planes[pi.FAR]):(G5(this._planes[pi.FAR],this._planes[pi.NEAR]),Xk(this._planes[pi.NEAR],this._planes[pi.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Nr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Le.Global){const n=this._maxSpanSpatialReference.isGeographic?Rat:gSe*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay(pu(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay(pu(o.origin,o.direction))||e.intersectsLineSegment(bb(o.origin,o.cap.next,Iat),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(YGe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){Dq(e,Zh),Zh[2]=i,xl(r,Zh,p9,this._renderCoordsHelper.spatialReference),xn(Fne,p9),Ti(Dl);for(const{x0:n,x1:o,y0:a,y1:l}of Mat)for(let c=0;c<5;c++){const h=c/4;Zh[0]=xt(e[n],e[o],h),Zh[1]=xt(e[a],e[l],h),Zh[2]=i,js(Zh,r,Zh,this._renderCoordsHelper.spatialReference),$e(Zh,Zh,Fne),Ff(Dl,Zh)}se(this._extent[0].origin,Dl[0],Dl[1],Dl[2]),se(this._extent[1].origin,Dl[3],Dl[1],Dl[2]),se(this._extent[2].origin,Dl[3],Dl[4],Dl[2]),se(this._extent[3].origin,Dl[0],Dl[4],Dl[2]);for(let n=0;n<4;++n)$e(this._extent[n].origin,this._extent[n].origin,p9)}_toRenderBoundingExtentLocal(e,r,i){AR(e,r,gm,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,gm[0],gm[1],i),se(this._extent[1].origin,gm[2],gm[1],i),se(this._extent[2].origin,gm[2],gm[3],i),se(this._extent[3].origin,gm[0],gm[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case Le.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case Le.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(fi(e.planes[pi.NEAR],this._center.origin)<0&&me(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(fi(e.planes[pi.NEAR],i.origin)<0&&me(i.direction,e.direction)<0)return!0}return!1}};const Mat=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Zh=A(),p9=ve(),Fne=ve(),Dl=ln(),gm=kt(),Iat=cp();let $at=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new U0(e),this._extendedFrustum=new U0(e),this._intersector=new Pat({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Qo.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===Le.Global&&e.lij[0]>=Lat&&e.lij[0]<Dat,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Qo.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=U0.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];he(Pc,l,a),ie(Pc,Pc,Fat),le(i[o],a,Pc)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Qo.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=kne.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Qo.INVISIBLE&&(r=o,o===Qo.VISIBLE_ON_SURFACE))break}return kne.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Le.Global&&e.lij[0]<Nat?this._calculateSingleTileVisibilitySided(e,!1)===Qo.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Nr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Qo.VISIBLE_ON_SURFACE:Qo.VISIBLE_WHEN_EXTENDED:Qo.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Pc);this._aboveGround||aa(r,r);const i=Sn(-me(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Pc),a){case Ye.FAR_BOTTOM_LEFT:case Ye.FAR_TOP_LEFT:case Ye.NEAR_BOTTOM_LEFT:case Ye.NEAR_TOP_LEFT:Yk(this._extendedFrustum.planes[pi.LEFT],Pc,Pc);break;case Ye.FAR_BOTTOM_RIGHT:case Ye.FAR_TOP_RIGHT:case Ye.NEAR_BOTTOM_RIGHT:case Ye.NEAR_TOP_RIGHT:Yk(this._extendedFrustum.planes[pi.RIGHT],Pc,Pc)}ie(Pc,Pc,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(pu(l,Pc),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),ea(n[Ye.NEAR_BOTTOM_LEFT],n[Ye.NEAR_BOTTOM_RIGHT],n[Ye.NEAR_TOP_RIGHT],Vne),ea(n[Ye.NEAR_BOTTOM_RIGHT],n[Ye.NEAR_TOP_RIGHT],n[Ye.NEAR_TOP_LEFT],zne),me(Vne,zne)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[Ye.NEAR_BOTTOM_LEFT],o[Ye.NEAR_BOTTOM_RIGHT]]=[o[Ye.NEAR_BOTTOM_RIGHT],o[Ye.NEAR_BOTTOM_LEFT]]:[o[Ye.NEAR_TOP_LEFT],o[Ye.NEAR_TOP_RIGHT]]=[o[Ye.NEAR_TOP_RIGHT],o[Ye.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Une;return{zWithMargin:e,pointIndices:U0.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Une;return{zWithMargin:e,pointIndices:U0.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const Lat=2,Dat=6,Nat=12,Fat=.95,Une=1,Pc=A(),Vne=Ir(),zne=Ir(),kne=new Uo(Array,t=>{t.length!==4&&(t[0]=new P3,t[1]=new P3,t[2]=new P3,t[3]=new P3)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let Uat=class{constructor(e){this._camera=new lt,this._focusOnMap=[0,0],this._screenRect=kt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new $at(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,Lq(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=GLe(e.extent,this._focusOnMap),e.measures.visibility!==Qo.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=Vat,i=1<<r,s=e.measures.screenRect;vc(s);let n=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),h=c*c;for(let d=0;d<i;d++)for(let f=0;f<i;f++)if(n+=this._computeScreenArea(e,o,a+d,l+f,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Qo.VISIBLE_WHEN_EXTENDED?this._tileSize*zat:this._tileSize}_computeScreenArea(e,r,i,s,n){const o=e.measures.visibility===Qo.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,$y),vc(f9);for(let a=0;a<4;a++)f2(f9,$y[a]);return l_(n,f9,n),cte($y[0],$y[1],$y[2])+cte($y[0],$y[2],$y[3])}_projectToScreen(e,r,i,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,lC),this._toRenderCoords(lC,0,3,Ly[0]),this._toRenderCoords(lC,2,3,Ly[1]),this._toRenderCoords(lC,2,1,Ly[2]),this._toRenderCoords(lC,0,1,Ly[3]),s&&(this._projectToPlane(Ly,this._camera.frustum[pi.NEAR]),this._projectToPlane(Ly,this._camera.frustum[pi.TOP]),this._projectToPlane(Ly,this._camera.frustum[pi.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(Ly[o],Bne),this._camera.renderToScreen(Bne,n[o])}_projectToPlane(e,r){for(let s=0;s<4;s++)uC[s]=fi(r,e[s]);const i=Math.max(uC[0],uC[1],uC[2],uC[3]);if(i>0){const s=ie(cC,r,-i);for(let n=0;n<4;n++)le(e[n],e[n],s)}}_toRenderCoords(e,r,i,s){return cC[0]=e[r],cC[1]=e[i],cC[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(cC,this._tilingScheme.spatialReference,s),s}};const f9=kt(),Vat=2,zat=5,$y=[Yi(),Yi(),Yi(),Yi()],lC=kt(),cC=A(),Ly=[A(),A(),A(),A()],uC=[0,0,0,0],Bne=Vo();function CLt(t,e,r){if(t==null||r==null)return!1;let i=!0;return Qs[0]=t.xmin!=null?t.xmin:0,Qs[1]=t.ymin!=null?t.ymin:0,Qs[2]=t.zmin!=null?t.zmin:0,i=i&&ai(Qs,t.spatialReference,0,e,r,0,1),Qs[0]=t.xmax!=null?t.xmax:0,Qs[1]=t.ymax!=null?t.ymax:0,Qs[2]=t.zmax!=null?t.zmax:0,i=i&&ai(Qs,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function ySe(t,e,r){if(t==null||r==null)return!1;let i=!0;return Qs[0]=t.xmin!=null?t.xmin:0,Qs[1]=t.ymin!=null?t.ymin:0,Qs[2]=t.zmin!=null?t.zmin:0,i=i&&ai(Qs,t.spatialReference,0,Qs,r,0,1),e[0]=Qs[0],e[1]=Qs[1],Qs[0]=t.xmax!=null?t.xmax:0,Qs[1]=t.ymax!=null?t.ymax:0,Qs[2]=t.zmax!=null?t.zmax:0,i=i&&ai(Qs,t.spatialReference,0,Qs,r,0,1),e[2]=Qs[0],e[3]=Qs[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const Qs=A();let oo=class extends xe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void Q.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=kt();return ySe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Mt,this.tileSize=512,this._idToTile=new Map,this._handles=new Mi,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Gt}initialize(){this._handles.add([ue(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),jr),ue(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),As)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(pt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Di(this._frameWorker),this._handles=Pe(this._handles)}addClient(){const e=Bat();return this._clients.add(e),this._clients.size===1&&this._setDirty(),ja(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Va))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=pt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=pt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Uat({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new P3(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),vc(_I);for(let r=0;r<e.length;r++)if(l_(_I,e.data[r].measures.screenRect,_I),rp(_I)>Gat)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!_R(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Qo.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Qo.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};u([p({constructOnly:!0})],oo.prototype,"scheduler",void 0),u([p({constructOnly:!0})],oo.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],oo.prototype,"tilingSchemeOwner",void 0),u([p({constructOnly:!0})],oo.prototype,"cameraOnSurface",void 0),u([p({constructOnly:!0})],oo.prototype,"focus",void 0),u([p({constructOnly:!0})],oo.prototype,"viewState",void 0),u([p({constructOnly:!0})],oo.prototype,"terrain",void 0),u([p()],oo.prototype,"tiles",void 0),u([p()],oo.prototype,"tileSize",void 0),u([p({readOnly:!0})],oo.prototype,"tilingScheme",null),u([p()],oo.prototype,"filterExtent",null),u([p({readOnly:!0})],oo.prototype,"_filterExtentRect",null),u([p({readOnly:!0})],oo.prototype,"_rootTileIds",null),u([p({value:!1})],oo.prototype,"suspended",null),u([p({readOnly:!0})],oo.prototype,"updating",null),oo=u([R("esri.views.3d.layers.support.FeatureTileTree3D")],oo);let kat=0;function Bat(){return kat++}const _I=kt(),Gat=10;let ts=class extends xe{constructor(){super(...arguments),this._propertiesPool=new Ug({camera:lt},this),this._lastSeenCameraProjectionValues=new lt,this.mode=$r.ANIMATING,this._cssCamera=new lt,this._camera=new lt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Ls,this.viewingMode=Le.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new Lm({mode:this.viewingMode}))}exit(){var e;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Ug({camera:lt},this)}destroy(){var e,r;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,(r=this._propertiesPool)==null||r.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Le.Global){const e=Nr(this.spatialReference).radius;this.camera=new lt({eye:Ae(4*e,0,0),center:Ae(e,0,0),up:Ae(0,0,1)})}else this.camera=new lt({eye:Ae(0,0,100),center:Ae(0,0,0),up:Ae(0,1,0)})}get animation(){return this.cameraController instanceof NO&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/s),e.width=Math.round(i/s),e}set camera(e){e!==Tu&&Tu.copyFrom(e),Tu.computeUp(this.viewingMode),this.events.emit("before-camera-change",Tu);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Tu)&&(this._lastSeenCameraProjectionValues.copyFrom(Tu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(Tu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Tu),this._cameraChanged=!r.almostEquals(Tu),this._cameraChanged)){const i=khe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===$r.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Le.Global}get isLocal(){return this.viewingMode===Le.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(Gne),this.addHandles(xh(()=>e.state===Zi.Finished||e.state===Zi.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),Gne),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Zi.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Zi.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Tu.copyFrom(this._get("camera")),e(Tu),this.camera=Tu,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[tr.TOP]!==r.padding[tr.TOP]||e.padding[tr.RIGHT]!==r.padding[tr.RIGHT]||e.padding[tr.BOTTOM]!==r.padding[tr.BOTTOM]||e.padding[tr.LEFT]!==r.padding[tr.LEFT]}};u([p()],ts.prototype,"mode",void 0),u([p({readOnly:!0,type:uS})],ts.prototype,"animation",null),u([p({type:lt})],ts.prototype,"camera",null),u([p({type:lt})],ts.prototype,"cssCamera",null),u([p()],ts.prototype,"_cssCamera",void 0),u([p()],ts.prototype,"_camera",void 0),u([p({readOnly:!0})],ts.prototype,"pixelRatio",null),u([p()],ts.prototype,"rasterPixelRatio",void 0),u([p()],ts.prototype,"contentPixelRatio",void 0),u([p({readOnly:!0})],ts.prototype,"alignPixelEnabled",null),u([p({readOnly:!0})],ts.prototype,"updating",null),u([p({})],ts.prototype,"_contentCamera",void 0),u([p({type:lt})],ts.prototype,"contentCamera",null),u([p({readOnly:!0})],ts.prototype,"fixedContentCamera",null),u([p({readOnly:!0})],ts.prototype,"constraints",void 0),u([p({readOnly:!0})],ts.prototype,"events",void 0),u([p({readOnly:!0})],ts.prototype,"isGlobal",null),u([p({readOnly:!0})],ts.prototype,"isLocal",null),u([p({readOnly:!0})],ts.prototype,"viewingMode",void 0),u([p({readOnly:!0})],ts.prototype,"spatialReference",void 0),u([p()],ts.prototype,"navigating",null),u([p()],ts.prototype,"stationary",null),u([p()],ts.prototype,"_cameraChanged",void 0),u([p()],ts.prototype,"cameraController",null),ts=u([R("esri.views.3d.state.ViewState")],ts);const jat=ts,Tu=new lt,Gne="ViewStateHandles";let Hat=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Gt,this._tolerance=gS,this._tmpRay=Gn(),this._tmpRegion=kt(),this._validateHUDIntersector=Oh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),jne(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,jne(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=go.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(wI,i,s),wI[0]+=.0466,wI[1]-=.0123,jZ(e,wI,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||hp(s)&&s.intersector!==Gi.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=gS){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Gi.TERRAIN?1:i.type===Gi.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Gi.TERRAIN?1:i.type===Gi.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return i1e(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==Le.Local||e==null||le(r,e.origin,ge(Ne.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(e==null)return null;const n=r!=null?r.mode:"absolute-height",o=(r==null?void 0:r.offset)??0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,bI)){const T=this._view.computeMapPointFromVec3d(bI);return T.z??(T.z=0),T.z-=o,T}return null}const c=this._view.state.camera,h=Ne.get();c.projectToRenderScreen(e.origin,h);const d=new Hne(null,this._forEachLayer),f=this._view.slicePlane,m=f!=null?Kte(f):null,y=Oh(this.viewingMode);y.options.store=go.MIN,y.options.verticalOffset=l;const _=e.origin,v=le(Ne.get(),_,e.direction);y.reset(_,v,c),y.point=h;const w=s?"type"in s&&s.type==="graphics"?T=>T.layerUid!==s.uid:T=>T.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const T=x=>(!w||w(x))&&!!x.lastValidElevationBB;y.intersect(d.layers,h,this._tolerance,null,T),this._externalIntersectionHandlers.forAll(x=>{if(x.type===Gi.I3S||x.type===Gi.TERRAIN){const S=x.slicePlaneEnabled?m:null;x.intersect(y,S,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(T=>{if(T.isGround){const x=T.slicePlaneEnabled?m:null;T.intersect(y,x,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(bI)){const T=this._view.computeMapPointFromVec3d(bI);return T.z=i,T}return null}computeIntersection(e,r,i){var y;if(e==null)return;const s=this._view.state.camera,n=Ne.get();s.projectToRenderScreen(e.origin,n);const o=new Hne(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=le(Ne.get(),e.origin,e.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=c!=null?Kte(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,h);const d=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const v=_.layerUid,w=Array.isArray(v),T=w?v:[v];w&&(r.options.filteredLayerUids=[]);let x=!1;for(const S of T)o.filterLayerUid(S)?x=!0:w&&r.options.filteredLayerUids.push(S);if(r.options.isFiltered=!x,_.isGround&&d||!r.options.isFiltered){const S=_.slicePlaneEnabled?h:null;_.intersect(r,S,a,l,n)}});const f=Ne.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&m.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const _=m.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,w=Ne.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(f[0],f[1],f[2],v,"ground"))??0,_.intersect(r,w,r.results.ground,T=>o.filterRenderGeometry(T))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;Ig(this._tmpRegion,uz);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=w=>{const T=new Wat(w);i.projectToRenderScreen(w.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),f2(n,T.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const w of r.all)r.min.target.object!==w.target.object&&r.max.target.object!==w.target.object&&o(w);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-M3),h=Math.max(0,n[1]-M3),d=Math.min(Qc(n)+2*M3,a-c),f=Math.min(rp(n)+2*M3,l-h),m=new Uint8Array(d*f*4);this._view._stage.renderer.readHUDVisibility(c,h,d,f,m);let y=!0;const _=e.results.max.dist==null;let v=0;for(const w of s)for(const T of qat)if(m[4*(Math.min(w.screenPoint[0]+T[0],a)-n[0]+(Math.min(w.screenPoint[1]+T[1],l)-n[1])*d)]){y&&(e.results.min.copy(w.result),y=!1),_&&e.results.max.copy(w.result),e.options.store===go.ALL&&e.results.all.splice(v++,0,w.result);break}}};const M3=1,qat=(()=>{const t=[],e=M3;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let Wat=class{constructor(e){this.result=e,this.screenPoint=Vo()}},vI;function jne(t){return vI&&vI.viewingMode===t||(vI=Oh(t)),vI}let Hne=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function qne(t){return typeof t=="object"&&"intersect"in t}const bI=A(),wI=Vo();let ILt=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},Zat=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(pt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,s=0){const n=yo(),o={x:e,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),oa(i,()=>{NH(this._queries,o),n.reject(Dr())}),n.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(h=>h.result.reject()),void e.madeProgress();const s=r.map(h=>[h.x,h.y]),n=r.reduce((h,d)=>Math.min(h,d.minDemResolution),1/0),o=new yR({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let h=0;r.forEach(d=>oa(d.signal,()=>{h++,d.result.reject(Dr()),h===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(h=>{r.forEach((d,f)=>{d.signal!=null&&d.signal.aborted?d.result.reject(Dr()):d.result.resolve(h.geometry.points[f][2])})}).catch(h=>{r.forEach(d=>d.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(Va)}}},I3=class extends Ls.EventedMixin(xe){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Pe(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new Zat(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&Tn(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=xI(o,this._im,e,r,i,s,n),o==null&&(o=xI(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=xI(o,this._scene,e,r,i,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,s=-1/0;for(const n of[this._im,this._ground,this._scene])n.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),s=Math.max(s,a.max))}});return{min:i,max:s}}queryElevation(e,r,i,s,n,o=null,a=0){const l=yo();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{n==="scene"&&(c=xI(c,this._scene,e,r,i,s,n)),l.resolve(c)}).catch(c=>{ys(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,s,n))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){var r;this._handles.has(e)&&((r=this._handles.get(e))==null||r.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const s=i.indexOf(e);s>-1&&i.splice(s,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function xI(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([p({constructOnly:!0})],I3.prototype,"view",void 0),u([p()],I3.prototype,"spatialReference",null),I3=u([R("esri.views.3d.support.CombinedElevationProvider")],I3);let $3=class _G{static isValidProfile(e){return e in _G.profiles}static getDefaultProfile(){return oe("esri-iPhone")?"low":"medium"}static apply(e,r){const i=_G.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function Wne(){const t=!!oe("esri-mobile"),e=!!oe("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!oe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!oe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}$3.test={reset(){const t=Wne();for(const e of Object.keys(t))$3.profiles[e]=t[e]}},function(t){t.profiles=Wne()}($3||($3={}));const ML=$3;function _Se(){return new Float32Array(4)}function Xat(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Wf(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Yat(t,e){return new Float32Array(t,e,4)}function vSe(){return _Se()}function bSe(){return Wf(1,1,1,1)}function wSe(){return Wf(1,0,0,0)}function xSe(){return Wf(0,1,0,0)}function TSe(){return Wf(0,0,1,0)}function SSe(){return Wf(0,0,0,1)}const Jat=vSe(),Qat=bSe(),Kat=wSe(),elt=xSe(),tlt=TSe(),rlt=SSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Qat,UNIT_W:rlt,UNIT_X:Kat,UNIT_Y:elt,UNIT_Z:tlt,ZEROS:Jat,clone:Xat,create:_Se,createView:Yat,fromValues:Wf,ones:bSe,unitW:SSe,unitX:wSe,unitY:xSe,unitZ:TSe,zeros:vSe},Symbol.toStringTag,{value:"Module"}));const Zne=new ke([0,255,255]),Xne=new ke([0,0,0]),Yne=1,Jne=.25,Qne=.4,Kne=.2;let Yp=class extends xe{constructor(){super(...arguments),this.color=Zne.clone(),this.haloColor=null,this.haloOpacity=Yne,this.fillOpacity=Jne,this.shadowOpacity=Qne,this.shadowColor=Xne.clone(),this.shadowDifference=Kne}static toEngineOptions(e){const r=ke.toUnitRGBA(e.color??Zne),i=e.haloColor!=null?ke.toUnitRGBA(e.haloColor):r,s=ke.toUnitRGBA(e.shadowColor??Xne),n=e.haloOpacity??Yne,o=e.fillOpacity??Jne,a=e.shadowOpacity??Qne,l=e.shadowDifference??Kne;return{color:Wf(r[0],r[1],r[2],r[3]),haloColor:Wf(i[0],i[1],i[2],i[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Ft(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};u([p({type:ke})],Yp.prototype,"color",void 0),u([p({type:ke})],Yp.prototype,"haloColor",void 0),u([p()],Yp.prototype,"haloOpacity",void 0),u([p()],Yp.prototype,"fillOpacity",void 0),u([p()],Yp.prototype,"shadowOpacity",void 0),u([p({type:ke})],Yp.prototype,"shadowColor",void 0),u([p()],Yp.prototype,"shadowDifference",void 0),Yp=u([R("esri.views.3d.support.HighlightOptions")],Yp);const vG=Yp;function ilt(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function slt(t){return typeof t=="string"?_o(t):K(t)}function nlt(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=nlt(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=e?o:JSON.stringify(o)}else i[s]=e?n:JSON.stringify(n);else i[s]=n}return i}function FLt(t){return{geometryType:Bq(t[0]),geometries:t.map(e=>e.toJSON())}}function olt(t,e,r){const i=rDe(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let m1=class extends de{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:Bq(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([p()],m1.prototype,"geometries",void 0),u([p({json:{read:{source:"outSR"}}})],m1.prototype,"outSpatialReference",void 0),u([p()],m1.prototype,"transformation",void 0),u([p()],m1.prototype,"transformForward",void 0),m1=u([R("esri.rest.support.ProjectParameters")],m1);const xY=m1,alt=qs(xY);async function ESe(t,e,r){e=alt(e);const i=slt(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=Bq(e.geometries[0]),a=ilt(s,r);return Fr(i.path+"/project",a).then(({data:{geometries:l}})=>olt(l,o,n))}async function TY(t=null,e){var s,n;if(Yr.geometryServiceUrl)return Yr.geometryServiceUrl;if(!t)throw new U("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||qn.getDefault():t,await r.load({signal:e});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new U("internal:geometry-service-url-not-configured");return i}async function llt(t,e,r=null,i){const s=await TY(r,i),n=new xY;n.geometries=[t],n.outSpatialReference=e;const o=await ESe(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new U("internal:geometry-service-projection-failed")}const clt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:TY,projectGeometry:llt},Symbol.toStringTag,{value:"Module"}));let ult=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=Za(this.spatialReference,Nr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=TY(e&&e.get("portalItem")).catch(()=>{throw new U("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof ct?l:new ct(l,this.spatialReference)),o=new xY({geometries:n,outSpatialReference:Ge.WGS84}),a=(await ESe(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},xd=class extends xe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([p()],xd.prototype,"minTotalNumberOfFeatures",void 0),u([p()],xd.prototype,"maxTotalNumberOfFeatures",void 0),u([p()],xd.prototype,"maxTotalNumberOfPrimitives",void 0),u([p()],xd.prototype,"snapshotAvailable",void 0),u([p()],xd.prototype,"polygonLodFactor",void 0),u([p()],xd.prototype,"polylineLodFactor",void 0),u([p()],xd.prototype,"skipHighSymbolLods",void 0),xd=u([R("esri.views.3d.support.QualitySettings.Graphics3DSettings")],xd);let If=class extends xe{constructor(){super(...arguments),this.lodFactor=1}};u([p()],If.prototype,"lodFactor",void 0),If=u([R("esri.views.3d.support.QualitySettings.LoDFactorSettings")],If);let p4=class extends If{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};p4=u([R("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],p4);let Km=class extends xe{constructor(){super(...arguments),this.object=new p4,this.point=new If,this.integratedMesh=new If,this.pointCloud=new If,this.uncompressedTextureDownsamplingEnabled=!1}};u([p({type:p4})],Km.prototype,"object",void 0),u([p({type:If})],Km.prototype,"point",void 0),u([p({type:If})],Km.prototype,"integratedMesh",void 0),u([p({type:If})],Km.prototype,"pointCloud",void 0),u([p()],Km.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Km=u([R("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Km);let P0=class extends xe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([p()],P0.prototype,"lodBias",void 0),u([p()],P0.prototype,"angledSplitBias",void 0),u([p()],P0.prototype,"reduceTileLevelDifferences",void 0),u([p()],P0.prototype,"textureFadeDuration",void 0),P0=u([R("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],P0);let n2=class extends xe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([p()],n2.prototype,"pixelRatio",void 0),u([p()],n2.prototype,"maxTotalNumberOfFeatures",void 0),n2=u([R("esri.views.3d.support.QualitySettings.HeatmapSettings")],n2);let Co=class extends xe{constructor(){super(...arguments),this.graphics3D=new xd,this.sceneService=new Km,this.tiledSurface=new P0,this.heatmap=new n2,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([p({type:xd})],Co.prototype,"graphics3D",void 0),u([p({type:Km})],Co.prototype,"sceneService",void 0),u([p({type:P0})],Co.prototype,"tiledSurface",void 0),u([p({type:n2})],Co.prototype,"heatmap",void 0),u([p()],Co.prototype,"fadeDuration",void 0),u([p()],Co.prototype,"antialiasingEnabled",void 0),u([p()],Co.prototype,"physicallyBasedRenderingEnabled",void 0),u([p()],Co.prototype,"highQualityTransparency",void 0),u([p()],Co.prototype,"highResolutionAtmosphere",void 0),u([p()],Co.prototype,"reflections",void 0),u([p()],Co.prototype,"ambientOcclusion",void 0),u([p()],Co.prototype,"memoryLimit",void 0),u([p()],Co.prototype,"additionalCacheMemory",void 0),u([p()],Co.prototype,"frameRate",void 0),u([p()],Co.prototype,"maximumPixelRatio",void 0),Co=u([R("esri.views.3d.support.QualitySettings.QualitySettings")],Co);const eoe=Co;function hlt(t){return NS(t)&&t.length>=3}function dlt(t){return(FS(t)||Array.isArray(t))&&t.length>=3}function plt(t){return hlt(t)||dlt(t)}let flt=class bG{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=qUe(s)}set extent(e){e&&WUe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return t8e(this._coordinateSystem,e)}setAltitude(e,r,i=e){return Zye(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){r8e(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return JUe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return QUe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,hc.X,Ne.get()),s=this.worldBasisAtPosition(e,hc.Y,Ne.get()),n=this.worldBasisAtPosition(e,hc.Z,Ne.get());return Kf(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Ne.get()),s=this.worldBasisAtPosition(e,hc.Y,Ne.get()),n=Tye(r,s,i);return qa(n)}intersectManifoldClosestSilhouette(e,r,i){return aU(this._coordinateSystem,r,this._tmpCoordinateSystem),e8e(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){aU(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=Ne.get();return KUe(this._tmpCoordinateSystem,e,s)?re(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===Le.Global)return this.intersectManifold(e,r,i);aU(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Ne.get();return Ew(s.plane,e,n)?re(i,n):null}toRenderCoords(e,r,i){return zN(e)?vo(e,r,this.spatialReference):js(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return zN(r)?(i!=null&&(r.spatialReference=i),SW(e,this.spatialReference,r)):plt(r)?js(e,this.spatialReference,r,i)?r:null:Ng(e,this.spatialReference,r)}static create(e,r){switch(e){case Le.Local:return new bG(Le.Local,r,Za(r),YUe());case Le.Global:return new bG(Le.Global,r,1,XUe(r))}}static renderUnitScaleFactor(e,r){return uQ(e)/uQ(r)}};var gf;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(gf||(gf={}));const mlt=(()=>{const t=new Array;return t[gf.ELEVATION]=10,t[gf.BASEMAP]=10,t[gf.I3S_INDEX]=10,t[gf.I3S_DATA]=10,t[gf.SYMBOLOGY]=5,t})(),glt=30;function CSe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function ylt(t){return new ul({view:t})}const TI=1,m9=1,_lt=.75,vlt=.6,toe=1.3;let ul=class extends xe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new cTe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(TI),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,r){return new JKe(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<vlt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(TI);else if(e)(this._memoryPredicted>1.1*m9||this._usedMemory>m9)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/toe),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>m9)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/toe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<_lt&&this._quality<TI){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),TI))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l;if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const r=((a=this.view)==null?void 0:a._stage)&&this.view._stage.renderView&&((l=this.view._stage.renderer)==null?void 0:l.edgeView);r!=null&&(e+=r.usedMemory);let i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(c=>{if(CSe(c)){const h=c.ignoresMemoryFactor?this._quality:1;e+=c.usedMemory*h,i+=c.unloadedMemory*h}});const s=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const c=d=>(d/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",h=Math.round(100*this._quality);Q.getLogger(this).warn(`Memory Limit exceeded! Limit: ${c(n)} Current: ${c(e)} Projected: ${c(e+i)} Quality: ${h}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};u([p({constructOnly:!0})],ul.prototype,"view",void 0),u([p()],ul.prototype,"maxMemory",null),u([p()],ul.prototype,"additionalCacheMemory",null),u([p()],ul.prototype,"memoryFactor",null),u([p()],ul.prototype,"updating",null),u([p()],ul.prototype,"usedMemory",null),u([p()],ul.prototype,"_quality",void 0),u([p()],ul.prototype,"_usedMemory",void 0),u([p()],ul.prototype,"_updating",void 0),u([p()],ul.prototype,"_stableQuality",void 0),u([p()],ul.prototype,"_maxMemory",void 0),u([p()],ul.prototype,"_additionalCacheMemory",void 0),ul=u([R("esri.views.3d.support.MemoryController")],ul);let blt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},wlt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new xlt}},xlt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Tlt=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new wlt(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,tt(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},IL=class extends xe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new Tlt((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(pt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Di(this._frameTask),this._tasks.forEach(e=>lu(e.abortController)),this._loadQueue=Pe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=yo();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return oa(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new Clt(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;iO(e.resolvers,r),r.reject(Dr()),e.resolvers.length===0&&(e.status===Hu.DOWNLOADING&&(e.status=Hu.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=Hu.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=Alt(s!=null&&s.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(tt(e.status===Hu.DOWNLOADING),e.status=Hu.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();Qt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==Hu.DOWNLOADED&&(r.err=r.err||Dr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!ys(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)ys(r)?s.reject(r):s.reject(new U("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i<=0?e.result:K(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===Hu.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=Hu.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Fr(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===Hu.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,d=Elt(h);if(s="image",e.size=h.byteLength,d==="unknown")return e.request=Fr(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(y=>a(y.data),l);const f=new Blob([h],{type:d}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=Fr(m,{responseType:s,timeout:i,signal:n}),e.request.then(y=>a(new KF(y.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([p({readOnly:!0})],IL.prototype,"updating",void 0),IL=u([R("esri.views.3d.support.StreamDataLoader")],IL);const Slt={numRetries:0};function Elt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let KF=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},Clt=class extends blt{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=Hu.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Slt.numRetries}};function Alt(t,e,r){return`${t}:${e}:${r}`}var Hu;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Hu||(Hu={}));let $L=class extends xe{constructor(){super(...arguments),this.updating=!1}};function Olt(t){return new cd({view:t})}u([p({readOnly:!0})],$L.prototype,"updating",void 0),$L=u([R("esri.views.3d.support.ResourceControllerMain")],$L);let cd=class extends $L{constructor(){super(...arguments),this._immediateTask=cS,this._normalTask=cS,this._updatingObjects=AO([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=mVe(),this._memoryController=ylt(this.view),this._streamDataLoader=new IL,this._streamDataLoader.setup(glt,mlt,this._scheduler),this.addHandles([ue(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},jr),ue(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=k2({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(pt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(pt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Di(this._frameTask),this._streamDataLoader=Pe(this._streamDataLoader),this._memoryController=Pe(this._memoryController),this._scheduler=Pe(this._scheduler),this.view=null}get updating(){var e,r,i,s;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],ja(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(jH(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([p()],cd.prototype,"view",void 0),u([p()],cd.prototype,"_scheduler",void 0),u([p()],cd.prototype,"_memoryController",void 0),u([p()],cd.prototype,"_streamDataLoader",void 0),u([p()],cd.prototype,"_immediateTask",void 0),u([p()],cd.prototype,"_normalTask",void 0),u([p()],cd.prototype,"_updatingObjects",void 0),u([p({readOnly:!0})],cd.prototype,"updating",null),cd=u([R("esri.views.3d.support.ResourceControllerImpl")],cd);function Rlt(t){return CSe(t)}function Plt(t){return"performanceInfo"in t}var Ko,it;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Ko||(Ko={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(it||(it={}));const Tx=A(),Mlt=A(),ym=A(),_m=A();function Ilt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return Dpe(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return BLe(i,e,r*s)}function SI(t,e,r,i){re(Tx,r),Tx[i]=e[i];const s=he(Tx,Tx,e),n=he(Mlt,t,e),o=me(n,s),a=me(s,s);let l;l=o<=0?e:a<=o?r:le(Tx,e,ie(s,s,o/a));const c=he(Tx,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function $lt(t,e,r){const i=t.extent;if(i==null)return 0;ym[0]=i[0],ym[1]=i[1],ym[2]=r,_m[0]=i[2],_m[1]=i[3],_m[2]=r;let s=1/0,n=1/0;return e[0]<ym[0]?s=SI(e,ym,_m,0):e[0]>_m[0]&&(s=SI(e,_m,ym,0)),e[1]<ym[1]?n=SI(e,ym,_m,1):e[1]>_m[1]&&(n=SI(e,_m,ym,1)),Math.min(s,n)}function Llt(t,e,r){if(t==null)return ZW();if(t.spatialReference.isGeographic&&!S_(t.spatialReference))return new U("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=nc.checkUnsupported(t);if(i!=null)return i;if(r==null)return new U("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=Dlt(t,r);if(s)return s;const n=t.spatialReference;return e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function Dlt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=$pe(e),a=kt();nc.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>ZT){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const d=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**d)*10**d,new U("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:ZT})}return null}const Nlt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Llt,isInsideExtent:Ilt,tiltToExtentEdge:$lt},Symbol.toStringTag,{value:"Module"}));function Flt(){return!0}function Ult(){return 0}function Vlt(t,e){if(t==null)return ZW();const r=t.lods.length-1,i=t.spatialReference,s=S_(i)||Yf(i)||Jf(i);if(i.isWebMercator){if(!nc.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new U("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new U("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!nc.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new U("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new U("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const zlt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Vlt,isInsideExtent:Flt,tiltToExtentEdge:Ult},Symbol.toStringTag,{value:"Module"})),klt={[Le.Global]:zlt,[Le.Local]:Nlt};function cf(t,e){t||console.warn("Terrain: "+e)}let sn=!1,f4=!1;function Blt(t){f4=t,sn=sn||t}function Glt(t){sn=t}function we(t,e){var r;if(sn&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function wG(t){return e6(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function m4(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function e6(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function SY(t){return(t==null?void 0:t.type)==="tile-3d"}function YO(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function ASe(t){return(t==null?void 0:t.type)==="wmts-3d"}function xG(t){return(t==null?void 0:t.type)==="elevation-3d"}function hC(t){return(t==null?void 0:t.type)==="group"}function g4(t){return t&&(SY(t)||ASe(t)||e6(t)||YO(t))}function TG(t){return t&&(SY(t)||e6(t)||YO(t)||ASe(t))}function JO(t){return TG(t)||xG(t)}function jlt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function OSe(t){return RSe(t==null?void 0:t.sourceLayerInfo)}function Hlt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function qlt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof KF||e instanceof HTMLCanvasElement||e instanceof ImageData}function RSe(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function O2(t){return t!=null&&"release"in t&&t.release(),null}function roe(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function EY(t,e,r,i){return klt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function t6(t,e,r){let i=null,s=null;if((t==null?void 0:t.type)==="wmts"){const n=Wlt(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=m4(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===Le.Local;if(m4(t))i=t.getCompatibleTileInfo(e,s,n);else if((t==null?void 0:t.type)==="vector-tile"){const o=n&&!Zlt(e)||Xlt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&s!=null&&EY(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function Wlt(t,e,r){const i=h$e(t);if(i!=null){if(!Mt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>EY(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Zlt(t){return t.isWGS84||t.isWebMercator||Rde(t)||!cO(t)}const Xlt={force512VTL:!1};function ioe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function vm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function ih(t,e,r=Qlt){return Math.abs(t-e)<r}function y4(t){return t===it.NORTH_EAST?it.SOUTH_WEST:t===it.NORTH_WEST?it.SOUTH_EAST:t===it.SOUTH_WEST?it.NORTH_EAST:it.NORTH_WEST}function _4(t){return t===it.NORTH?it.SOUTH:t===it.EAST?it.WEST:t===it.SOUTH?it.NORTH:it.EAST}function Ylt(t){return t===it.NORTH_WEST||t===it.SOUTH_WEST}function Jlt(t){return t===it.NORTH_WEST||t===it.NORTH_EAST}function soe(t){return t===it.NORTH_WEST||t===it.WEST||t===it.SOUTH_WEST}function noe(t){return t===it.NORTH_EAST||t===it.EAST||t===it.SOUTH_EAST}function ooe(t){return t===it.SOUTH_EAST||t===it.SOUTH||t===it.SOUTH_WEST}function aoe(t){return t===it.NORTH_EAST||t===it.NORTH||t===it.NORTH_WEST}const vf=[it.NORTH,it.EAST,it.SOUTH,it.WEST],QO=[it.NORTH_EAST,it.SOUTH_EAST,it.SOUTH_WEST,it.NORTH_WEST],Qlt=1e-5;let Klt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=JO(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,Plt(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},ect=class{constructor(e){var i;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const s=e.resourceController.memoryController;this.totalMemory=(s.maxMemory??0)*lN.MEGABYTES,this.usedMemory=Math.round(s.usedMemory*this.totalMemory),this.quality=s.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,e.allLayerViews.items.forEach(s=>{(Rlt(s)||JO(s))&&this.layerPerformanceInfos.push(new Klt(s,e))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}},tct=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>O2e(new C2e(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>R2e(e,n),r)}async _loadOnce(e,r,i,s,n){Qt(n);const o=oa(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),Qt(n),l}finally{Di(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},rct=class extends XT{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){Qt(i);const s=i!=null?i.signal:null,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new E0e,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const d=this._createTexture(e,h,r);return c.texture=d,c.abortController=null,this._stage.add(d),await this._stage.load(d),{uid:n,texture:d,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await Mhe(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){var n;const s={width:r.width,height:r.height,wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(Tde(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new Iw(r,s)}},ict=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(gf.SYMBOLOGY),this.objectResourceCache=new tct((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new rct(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Nr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=rbe(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=eZe(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return ja();this._graphicsOwners.push(e);const r=ue(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),ja(()=>{r.remove(),iO(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Mi;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ue(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,jr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Pe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;EI.distance=e.centerOnSurfaceInfrequent.distance,EI.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(EI),this.screenSizePerspectiveSettingsLabels.update(EI),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const EI={distance:0,fovY:0};let _T=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new Z0({symbolLayers:[new W0({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new bw({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(r==null)return;this.hide();const i=new ct({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new hu({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},z0=class extends xe{constructor(e){super(e),this.handles=new Mi}destroy(){this.handles.destroy()}};u([p({constructOnly:!0})],z0.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],z0.prototype,"surface",void 0),u([p({constructOnly:!0})],z0.prototype,"state",void 0),z0=u([R("esri.views.3d.support.PointOfInterest")],z0);const sct=Array;let ud=class extends z0{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Ug({location:ct,renderLocation:sct},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=A(),this._tmpPoint=new ct}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Ga(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=mi(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Kb(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Bo.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>nct&&this.renderCoordsHelper.viewingMode===Le.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?oct:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{ys(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Bo.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(g9,this._estimatedSurfaceAltitude,this._camera.eye),na(this._get("renderLocation"),g9)||(this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),g9)),this.notifyChange("renderLocation"))}};u([p({constructOnly:!0})],ud.prototype,"scheduler",void 0),u([p({constructOnly:!0})],ud.prototype,"cache",void 0),u([p({constructOnly:!0})],ud.prototype,"task",void 0),u([p({readOnly:!0})],ud.prototype,"location",null),u([p({constructOnly:!0})],ud.prototype,"map",void 0),u([p({readOnly:!0})],ud.prototype,"renderLocation",void 0),u([p({readOnly:!0})],ud.prototype,"scale",null),u([p({readOnly:!0})],ud.prototype,"updating",null),ud=u([R("esri.views.3d.support.CameraOnSurface")],ud);const g9=A(),nct=1e5,oct=1e6,act=Array;let qu=class extends z0{constructor(e){super(e),this._propertiesPool=new Ug({location:ct,renderLocation:act},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=A(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Di(this._frameWorker),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Bo.YIELD}_updateRenderLocation(){const e=cct;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=uct;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(re(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=mi(this._camera.eye,e):(ie(e,this._camera.viewForward,this._get("distance")),le(e,e,this._camera.eye)),na(this._get("renderLocation"),e)||this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var s,n;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=Nr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=ra(i.eye),c=l<a*a,h=mi(i.eye,r);if(c&&h>o/4){const d=a-Math.sqrt(l);return ie(r,i.viewForward,d),le(r,r,i.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&AR(o,(n=this.surface)==null?void 0:n.spatialReference,dC,this.renderCoordsHelper.spatialReference)&&(r[0]=_e(r[0],dC[0],dC[2]),r[1]=_e(r[1],dC[1],dC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(oi.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=mi(i,e),n=mi(i,r);if(Math.abs(n-s)/s>lct)return!0}return!1}};u([p({constructOnly:!0})],qu.prototype,"scheduler",void 0),u([p({constructOnly:!0})],qu.prototype,"task",void 0),u([p()],qu.prototype,"distance",void 0),u([p({constructOnly:!0})],qu.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([p({readOnly:!0})],qu.prototype,"location",null),u([p({readOnly:!0})],qu.prototype,"renderLocation",void 0),u([p()],qu.prototype,"updating",void 0),qu=u([R("esri.views.3d.support.CenterOnSurface")],qu);const lct=.05,cct=A(),uct=A(),dC=kt();let hct=class{constructor(e){this._handles=new Mi,this.events=new Ls,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Pe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",dct)}};const dct={},pct=Array;let Jp=class extends z0{constructor(e){super(e),this._propertiesPool=new Ug({location:ct,renderLocation:pct},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ue(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ue(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(pt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Pe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,loe);const n=Math.max(0,(Math.acos(me(loe,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!m_(e,r)){const c=this._propertiesPool.get("renderLocation");re(c,r),this._set("renderLocation",c)}return Bo.YIELD}const o=1-_e(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(coe);const l=this._propertiesPool.get("renderLocation");return Gr(l,r,coe,a),e&&m_(e,l)||this._set("renderLocation",l),Bo.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(Vo());if(i[1]=r.aboveGround?r.padding[tr.BOTTOM]:r.fullHeight-r.padding[tr.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,pC)){he(pC,pC,r.eye);const n=ge(pC,pC);if(this.renderCoordsHelper.intersectManifold(pu(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};u([p()],Jp.prototype,"_dirty",void 0),u([p({constructOnly:!0})],Jp.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Jp.prototype,"centerOnSurface",void 0),u([p({constructOnly:!0})],Jp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([p({readOnly:!0})],Jp.prototype,"updating",null),u([p({readOnly:!0})],Jp.prototype,"location",null),u([p({readOnly:!0})],Jp.prototype,"renderLocation",void 0),Jp=u([R("esri.views.3d.support.pointsOfInterest.Focus")],Jp);const loe=A(),pC=A(),coe=A();let Fm=class extends xe{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=A();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Mi}initialize(){this.view.state.isLocal&&(this._handles.add([ue(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Ga(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=Dq(this.surfaceView.extent),r=new ct({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{ys(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};u([p({constructOnly:!0})],Fm.prototype,"view",void 0),u([p({constructOnly:!0})],Fm.prototype,"cache",void 0),u([p()],Fm.prototype,"surface",null),u([p()],Fm.prototype,"surfaceView",null),u([p({readOnly:!0})],Fm.prototype,"location",void 0),u([p({readOnly:!0})],Fm.prototype,"renderLocation",null),Fm=u([R("esri.views.3d.terrain.StableSurfaceCenter")],Fm);let Um=class extends xe{constructor(e){super(e),this._tileGeometryUpdateExtent=vc(),this._tileGeometryUpdateSpatialReference=null,this.events=new Ls,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(pt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",fct),vc(this._tileGeometryUpdateExtent),this._set("updating",!1)),Bo.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,l_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=mct,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Mv,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Iv,r),Mv[0]<Iv[0]?(s[0]=Mv[0],s[2]=Iv[0]):(s[0]=Iv[0],s[2]=Mv[0]),Mv[1]<Iv[1]?(s[1]=Mv[1],s[3]=Iv[1]):(s[1]=Iv[1],s[3]=Mv[1]),_R(s,e)}};u([p({constructOnly:!0})],Um.prototype,"state",void 0),u([p({constructOnly:!0})],Um.prototype,"centerOnSurfaces",void 0),u([p({constructOnly:!0})],Um.prototype,"renderCoordsHelper",void 0),u([p({constructOnly:!0})],Um.prototype,"scheduler",void 0),u([p({constructOnly:!0})],Um.prototype,"surface",void 0),u([p({readOnly:!0})],Um.prototype,"updating",void 0),Um=u([R("esri.views.3d.support.SurfaceGeometryUpdates")],Um);const fct={},Mv=A(),Iv=A(),mct=vc();let pl=class extends xe{constructor(e){super(e),this._handles=new Mi,this._tmpRay=Gn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Ug({renderPointOfView:gct},this),this.renderPointOfView=A(),this._pois=new Array,this._debugCenters=new Map}initialize(){var h;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=Oh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=go.MIN,this._contentIntersector=Oh(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(h=this.view.basemapTerrain)==null?void 0:h.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new qu({...l,task:pt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new qu({...l,task:pt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new qu({...l,task:pt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new ud({...l,cache:a,task:pt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new Um({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new hct({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new Fm({cache:a,view:this.view})),this._set("focus",new Jp({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(d,f)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new _T(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new _T(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new _T(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new _T(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new _T(c,"green","Focus")),this._handles.add([ue(()=>e.contentCamera,d=>this._cameraChanged(d),jr),ue(()=>r.extent,()=>this._updateCenterPointsOfInterest()),xh(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),jr),Ga(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Ga(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),xh(()=>oi.SHOW_POI,d=>this._setDebug(d),zr)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Sx,_ct)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Sx):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=le(Sx,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(Sx)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Sx)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=jZ(r,e,yct);if(s==null)return null;const n=s.origin,o=le(Sx,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;na(this.renderPointOfView,r)||this._set("renderPointOfView",re(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(ue(()=>r.renderLocation,i=>{var s;return(s=this._debugCenters.get(r))==null?void 0:s.show(i,r.renderCoordsHelper.spatialReference)},zr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([p({readOnly:!0})],pl.prototype,"centerOnContent",void 0),u([p({readOnly:!0})],pl.prototype,"centerOnSurfaceFrequent",void 0),u([p({readOnly:!0})],pl.prototype,"centerOnSurfaceInfrequent",void 0),u([p({readOnly:!0})],pl.prototype,"cameraOnSurface",void 0),u([p({readOnly:!0})],pl.prototype,"focus",void 0),u([p({readOnly:!0})],pl.prototype,"renderPointOfView",void 0),u([p({readOnly:!0})],pl.prototype,"surfaceOrigin",void 0),u([p({readOnly:!0})],pl.prototype,"contentGeometryUpdates",void 0),u([p({readOnly:!0})],pl.prototype,"surfaceGeometryUpdates",void 0),u([p({constructOnly:!0})],pl.prototype,"view",void 0),u([p({readOnly:!0})],pl.prototype,"updating",null),pl=u([R("esri.views.3d.support.PointsOfInterest")],pl);const gct=Array,Sx=A(),yct=Gn(),_ct={exclude:new Set([N0])},KO=new Mt,WA=new WeakMap;function vct(t){PSe(t)&&KO.push(t)}function bct(t){PSe(t)&&KO.includes(t)&&KO.remove(t)}function PSe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function MSe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:MSe(e,t%e):0}let y9=0,CI=0;function wct(){const t=Date.now();for(const e of KO)e.refreshInterval&&t-(WA.get(e)??0)+5>=6e4*e.refreshInterval&&(WA.set(e,t),e.refresh(t))}Uhe(()=>{const t=Date.now();let e=0;for(const r of KO)e=MSe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?WA.get(r)||WA.set(r,t):WA.delete(r);if(e!==CI){if(CI=e,clearInterval(y9),CI===0)return void(y9=0);y9=setInterval(wct,CI)}});function xct(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Tct=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=GH(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||vct(this)},()=>{})}destroy(){bct(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){CV(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{Q.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([p({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([p()],e.prototype,"refreshParameters",null),e=u([R("esri.layers.mixins.RefreshableLayer")],e),e};let Sct=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},Ect=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},ISe=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=pge(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Q.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),ja(()=>{i.removed=!0,NH(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(Qt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},uoe=class extends ISe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(ZA.forEach((e,r)=>{e===this&&ZA.delete(r)}),this.destroy())}};const ZA=new Map;function Cct(t=null){let e=ZA.get(t);return e||(t!=null?(e=new uoe(r=>t.immediate.schedule(r)),ZA.set(t,e)):(e=new uoe,ZA.set(null,e))),++e.ref,e}var ic,hoe,doe;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(ic||(ic={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(hoe||(hoe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(doe||(doe={}));let Act=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},xDt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function SDt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let EDt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function Oct(t,e,r,i,s,n){const o=e[i++];for(let a=0;a<o;a++){const l=new Act(n);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let f=0;f<c;f++){const m=e[i++],y=e[i++],_=e[i++],v=e[i++],w=!!e[i++],T=e[i++],x=r[i++],S=r[i++],O=e[i++],C=e[i++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:v,hard:w,partIndex:T,width:O,height:C,minLod:x,maxLod:S})}const h=t[i++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[i++],t[i++]]);const d=t[i++];for(let f=0;f<d;f++)l.iconVertexRanges.push([t[i++],t[i++]]);s.push(l)}return i}function ADt(t,e,r){for(const[i,s]of t.symbols)Rct(t,e,r,s,i)}function Rct(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===ic.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=r?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let d=c;d<c+h;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const f=r?Math.floor(127*h)|d<<7:d?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let d=c;d<c+h;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let r6=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},Pct=class extends r6{constructor(e,r){super(e,r),this.type=ic.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Fe(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.lineMaterial;this.vao=new Sh(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}},Mct=class extends r6{constructor(e,r){super(e,r),this.type=ic.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.fillVAO)==null?void 0:r.memoryEstimate)??0)+(((i=this.outlineVAO)==null?void 0:i.memoryEstimate)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Fe(this.fillVAO),this.outlineVAO=Fe(this.outlineVAO)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],d=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new Sh(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Sh(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},m)}},Ict=class extends r6{constructor(e,r,i){super(e,r),this.type=ic.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const h=s[a++],d=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(d),a=Oct(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.iconVAO)==null?void 0:r.memoryEstimate)??0)+(((i=this.textVAO)==null?void 0:i.memoryEstimate)??0)+j0(this.iconOpacity)+j0(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=Fe(this.iconVAO),this.textVAO=Fe(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.byteLength&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.byteLength&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],d=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const y=Lr.createVertex(e,Tr.STATIC_DRAW,this.iconOpacity.buffer),_=Lr.createVertex(e,Tr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,w=v.iconMaterial,T=v.textMaterial;this.iconVAO=new Sh(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new Sh(e,T.getAttributeLocations(),T.getLayoutInfo(),{geometry:d,opacity:_},m)}},$ct=class extends r6{constructor(e,r){super(e,r),this.type=ic.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Fe(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Lr.createVertex(e,Tr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Lr.createIndex(e,Tr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.circleMaterial;this.vao=new Sh(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}};const $Dt=!0,LDt=32,poe=200,Lct=1/oe("mapview-transitions-duration");let Dct=class extends Ls{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=yo(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=yo(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*Lct;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},SG=class g1{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new g1(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new g1(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new g1(e,r,i,s),new g1(e,r,i+1,s),new g1(e,r+1,i,s),new g1(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};SG.pool=new Uo(SG,null,null,25,50);let Nct=class extends Dct{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new SG(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;hZ(i,o,0,0,0,a,0,s,n,1),pS(this.transforms.dvs,e.displayViewMat3,i)}},_9=class $Se extends Nct{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<poe}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<poe)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){var i;let r=!1;for(const s of e)if(this.layerData.has(s)){const n=this.layerData.get(s);this._memoryUsedByLayerData-=n.memoryUsed,n.type===ic.SYMBOL&&this.symbols.has(s)&&(this.symbols.delete(s),r=!0),n.destroy(),this.layerData.delete(s),this.layerCount--}(i=this._memCache)==null||i.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(LSe.delete(this),$Se._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var i;let r=!1;if(e){const{bucketsWithData:s,emptyBuckets:n}=e,o=this._createRenderBuckets(s);if(n&&n.byteLength>0){const a=new Uint32Array(n);for(const l of a)this._deleteLayerData(l)}for(const[a,l]of o)this._deleteLayerData(a),l.type===ic.SYMBOL&&(this.symbols.set(a,l.symbols),r=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(a,l),this.layerCount++;(i=this._memCache)==null||i.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[s,n]of this.layerData)n.type===ic.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;dZ(o),vN(o,o,n),pZ(o,o,Math.PI*e.rotation/180),fZ(o,o,[i,s,1])}_createTransforms(){return{dvs:Sl(),tileMat3:Sl(),tileUnitsToPixels:Sl()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case ic.FILL:i=new Mct(e,this.styleRepository);break;case ic.LINE:i=new Pct(e,this.styleRepository);break;case ic.SYMBOL:i=new Ict(e,this.styleRepository,this);break;case ic.CIRCLE:i=new $ct(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const LSe=new Map;function Fct(){LSe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const FDt={value:.5,readOnly:!0},Uct={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let o2=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},Vct=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},zct=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new Vct(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,d=.5*CO;let f=(c-1)/o,m=(i-this.j*o)*f,y=(r-this.i*o)*f;if(f<1){const _=Math.floor(m),v=Math.floor(y),w=_+v*c,T=h[w],x=h[w+1],S=h[w+c],O=h[w+c+1];if(T+x+S+O<d){const C=m-_,P=y-v,$=VP(T,x,S,O,C,P),V=VP(T,x,S,O,C+f,P),z=VP(T,x,S,O,C,P+f),B=VP(T,x,S,O,C+f,P+f);return s.min=Math.min($,V,z,B),s.max=Math.max($,V,z,B),s}m=_,y=v,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let v=y;v<=y+f;v++){const w=h[_+v*c];w<d?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const kct=.5*CO;function Xi(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=_e(i.dy*(i.y1-e),0,s),o=_e(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,h=a*c+l,d=i.data.values,f=d[h],m=d[h+1],y=h+c,_=d[y],v=d[y+1];if(f+_+m+v<kct){n-=a,o-=l;const w=f+(m-f)*o;return w+(_+(v-_)*o-w)*n}}return null}let ju=class extends xe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=DSe(i.fullExtent,this.viewSpatialReference);s!=null&&e.push($pe(s))}}),e}};function Bct(t,e){return t===Le.Global?new EG(e):new CG(e)}u([p({readOnly:!0})],ju.prototype,"layerViewsExtent",null),u([p({readOnly:!0})],ju.prototype,"tiledLayersExtent",null),u([p({readOnly:!0})],ju.prototype,"stencilEnabledExtents",null),u([p()],ju.prototype,"viewSpatialReference",void 0),u([p()],ju.prototype,"tilingScheme",void 0),u([p()],ju.prototype,"defaultTiledLayersExtent",void 0),u([p({constructOnly:!0})],ju.prototype,"layers",void 0),u([p({constructOnly:!0})],ju.prototype,"layerViews",void 0),ju=u([R("esri.views.3d.terrain.ExtentHelper")],ju);let EG=class extends ju{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?T0e:N9e}};EG=u([R("esri.views.3d.terrain.ExtentHelperGlobal")],EG);let CG=class extends ju{_computeLayerViewsExtent(){const e=vc(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=DSe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);l_(e,a,e)}});const i=az(e)?e:null,s=this._get("layerViewsExtent");return mb(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=vc();this.layers.forEach(o=>{if(o.loaded&&pA(o)){const a=t6(o,r,Le.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(m4(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&l_(i,c,i)}}),l_(i,this.defaultTiledLayersExtent,i);const s=az(i)?i:null,n=this._get("tiledLayersExtent");return mb(s,n)?n:s}};function DSe(t,e){return t==null||t.spatialReference.equals(e)?t:TW(t,t.spatialReference,e)}CG=u([R("esri.views.3d.terrain.ExtentHelperLocal")],CG);var rr;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(rr||(rr={}));const y1=[rr.ELEVATION,rr.MAP];function NSe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.search(".glsl")!==-1&&delete t[i]}}const Gct=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Dy,Aa=class extends xe{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||oi.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Nr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Mi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=oe("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){var s;const e=this.view;this.renderer=new Zp({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const r=()=>this.setDrawTexturesDirty();this._groundIntersector=Oh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{r(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",n=>{var o;return(o=e._stage)==null?void 0:o.renderer.setParameters({hasOverlayWater:n})}),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),ue(()=>e.state.camera.pixelRatio,r),ue(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ue(()=>{var n,o,a;return[(n=e.pointsOfInterest)==null?void 0:n.renderPointOfView,(a=(o=e.pointsOfInterest)==null?void 0:o.centerOnSurfaceFrequent)==null?void 0:a.location]},()=>this.setPlacementDirty()),ue(()=>{var n,o;return[(n=e.state)==null?void 0:n.pixelRatio,(o=e.state)==null?void 0:o.contentPixelRatio]},()=>this.setPlacementDirty(),jr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(pt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",n=>{this._updateOverlays(Va,n.camera,fs.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,fs.BACKGROUND,n)})]);let i=n=>this._renderOverlayCallback(n);this._removeRenderOverlayCallback=()=>{i=()=>{}},(s=e._stage)==null||s.renderer.setParameters({renderOverlay:n=>i(n)})}_renderOverlayCallback(e){this._contentUpdated=!1;const r=this.renderer;r.processSyncDrapeSources(),r.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(r.overlays,fs.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){var e,r;this._handles=Pe(this._handles),this._removeRenderOverlayCallback(),(r=(e=this.view)==null?void 0:e._stage)==null||r.renderer.setParameters({renderOverlay:()=>{}}),Dy!=null&&(Dy.hide(),Dy=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new y_(-20037508342787e-6,20037508342787e-6):new y_(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,zc)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,fs.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return Bo.YIELD;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,bm);const n=Qc(bm.inner)/Qc(bm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay($i.INNER,bm.inner,s,1*bm.pixelRatioAdjustment,bm.mapUnitsPerPixel),a=this._updateOverlay($i.OUTER,bm.outer,s,n*bm.pixelRatioAdjustment,bm.mapUnitsPerPixel);o!==sf.EXTENT&&a!==sf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===sf.NONE&&a===sf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r,n=Math.ceil(1.5*Math.max(i,s));return Math.min(BX(n),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return sf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,jct(r,o.extent)&&i===o.resolution)return a===n?sf.NONE:sf.RERENDER_ONLY;Ig(o.extent,r),o.resolution=i;const l=Dq(o.extent);return o.renderLocalOrigin=qN(l[0],l[1],0,"OV_"+this._latestOriginId++),sf.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[$i.INNER],s=this.renderer.overlays[$i.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,$i.INNER,r),this._setTileOverlayData(n,$i.OUTER,r)):(this._clearTileOverlayData($i.INNER,r),this._clearTileOverlayData($i.OUTER,r))}else this._clearTileOverlayData($i.INNER,r),this._clearTileOverlayData($i.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[$i.INNER],i=this.renderer.overlays[$i.OUTER],s=this._pointIsInExtent(e,r.extent)?r:i;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=Qc(s),o=rp(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,Qc(e)/n,rp(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){NSe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Va)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new xbe(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Wct,r,i);if(n==null)return!1;const o=n.origin,a=le(AI,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=_e(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=AI;tE(k5(B5,Nr(this.view.spatialReference).radius+l),pu(e.eye,e.viewForward),h),he(h,h,e.eye);const d=__.normalize(Tye(e.viewForward,h,e.viewRight))/e.fovY+.5,f=d<=0||d>=1?.5:s;i=c?f*d:d+f*(1-d)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(h),f=Ft(0,d,1,0),m=eu(f,f,e.projectionMatrix)[1],y=_e(.5+.5*m,0,1);i=y===1||y===0?.5:c?y*s:1-(1-y)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&a5(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=A();this._findHorizonBasedPointOfInterest(e,n)||re(n,s),oi.OVERLAY_SHOW_CENTER?(Dy==null&&(Dy=new _T(this.view.graphics,"red")),Dy.show(n,this._renderSR)):Dy!=null&&Dy.hide();const o=Math.max(.1,mi(e.eye,n)),a=M_(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||js(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,h=c&&this._spatialReference!=null?1/Nr(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/d*o*h;i.mapUnitsPerPixel=f/this._worldToPCSRatio;let m=r*f/2*nX,y=!1,_=c?90:1/0;this._isSpherical&&l!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(m/=Math.cos(LD(n[1])),_=l[3]):(y=!0,m/=Nr(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;y&&(v=1/Math.max(.2,Math.cos(Math.abs(Ut(n[1])))),m*v>180&&(v=180/m),i.mapUnitsPerPixel*=v);const w=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/w)*w);const T=m*v,x=32,S=.5*r/(x*T),O=.5*r/(x*m);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*O)/O;const C=i.inner;C[0]=n[0]-T,C[1]=n[1]-m,C[2]=n[0]+T,C[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,_);const P=i.outer;if(6*T>Qc(l))Ig(P,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)P[0]=C[0]-T,P[1]=C[1]-m,P[2]=C[2]+T,P[3]=C[3]+m;else{js(e.eye,this._renderSR,AI,this._spatialReference),pf($v,n,AI);let V=-Math.atan2($v[1],$v[0])+.125*Math.PI;V<0&&(V+=2*Math.PI);const z=Math.floor(V/(.25*Math.PI));kb($v,Gct[z],2*m),$v[0]*=v,$v[2]*=v,Rq(P,C,$v)}if(this._isSpherical)P[0]=this._longitudeCyclical.clamp(P[0]),P[2]=this._longitudeCyclical.clamp(P[2]),P[1]=Math.max(P[1],-_),P[3]=Math.min(P[3],_);else{const V=lz(C,l,Hct),z=lz(P,l,qct);UQ(V,z)&&(P[2]=P[0],P[3]=P[1])}const $=Math.abs(C[2]-C[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,$),i.pixelRatioAdjustment=i.mapUnitsPerPixel/$}_drawOverlayTextures(e,r,i){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[$i.INNER],i),o=this._drawOverlay(e[$i.OUTER],i);n!==dS.CHANGED&&o!==dS.CHANGED||this.surface.updateTileOverlayParams(fs.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(r),r===fs.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(fs.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):_R(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:UQ(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),jD(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Va)}}};function jct(t,e){const i=oi.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}u([p()],Aa.prototype,"_spatialReference",void 0),u([p({readOnly:!0})],Aa.prototype,"running",null),u([p()],Aa.prototype,"_placementDirty",void 0),u([p()],Aa.prototype,"_contentUpdated",void 0),u([p()],Aa.prototype,"_isSpherical",null),u([p()],Aa.prototype,"_worldToPCSRatio",null),u([p({autoDestroy:!0})],Aa.prototype,"renderer",void 0),u([p({constructOnly:!0})],Aa.prototype,"view",void 0),u([p({constructOnly:!0})],Aa.prototype,"surface",void 0),u([p()],Aa.prototype,"suspended",null),u([p()],Aa.prototype,"updating",null),u([p({type:Boolean})],Aa.prototype,"hasHighlights",null),u([p({type:Boolean})],Aa.prototype,"rendersOccluded",null),Aa=u([R("esri.views.3d.terrain.OverlayManager")],Aa);const $v=Yt(),AI=A(),bm={inner:kt(),outer:kt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Hct=kt(),qct=kt(),Wct=Gn();var sf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(sf||(sf={}));let FSe=class AG{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!AG.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+s),r}}release(e){if(AG.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Gt({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};FSe.test={disabled:!1};let Zct=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Ti(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},foe=class{constructor(e,r,i,s,n){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return we(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),le(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:s}=this.attributes.normalCompressed;Eet(e,i,this.getAttributeIndex(r),s)}_setNormal(e,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.attributes.normalCompressed;nw(n,e,r,i,s,o)}_setUV(e,r,i){Qd(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,s){this._setNormal(this.getAttributeIndex(e),r,i,s)}setVertexFromValuesRawPositionUV(e,r,i,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,r,i,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}};const Xct=Hi().vec3f(E.POSITION).vec2i16(E.UV0).vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),CY=new FSe(t=>Xct.createBuffer(t),t=>t.count);function Yct(){CY.clear()}function USe(t){return CY.acquire(t)}function Jct(t){CY.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const moe=16384;function Qd(t,e,r,i){t.setValues(e,r*moe,i*moe)}function gh(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let Qct=class{constructor(){this.sinLonLUT=new Array(n3+1),this.cosLonLUT=new Array(n3+1),this.sinLatLUT=new Array(n3+1),this.cosLatLUT=new Array(n3+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},OI=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},Kct=class{constructor(){this.cornerNeighborData=[new OI,new OI,new OI,new OI],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},eut=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Kct}},VSe=class LL{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Pe(this._current),this._next=Pe(this._next),this._waiting=Pe(this._waiting),this._delayed=Pe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=LL.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Tg.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==en.FADING,n=e-this._fadeStart>=r;(i||s||n)&&(Pe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=LL.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=Tg.Immediate){this._delayed=Pe(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=LL.test.fadeMoment||performance.now();return r!==Tg.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Pe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Tg;VSe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Tg||(Tg={}));var PS;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(PS||(PS={}));let zSe=class{constructor(){this._queue=new Gt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},tut=class{constructor(){this._q=new Gt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function XA(t,e,r){if(e==null||e.fullExtent==null)return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Sg(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function kSe(t,e,r=null){r==null||r.length===0?t===PS.BACK_TO_FRONT?e.sort(rut):e.sort(iut):e.sort((i,s)=>sut(i,s,t,r))}function rut(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function iut(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function BSe(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:Sg(t,e)}function sut(t,e,r,i){return goe(t,i)===goe(e,i)?BSe(t,e,r):t?r:-r}function goe(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function nut(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function out(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(nut)}function aut(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function lut(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function KDt(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let AY=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,en.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=wG(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?XA:()=>!0;let h=this.tile;const d=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=m!=null?m.tile.level:-1,_=m!=null&&y-d>=a,v=s==null?void 0:s.tilemapCache,w=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;h&&c(h,s,!1)&&h.level>=n;){const T=h.level,x=d-T,S=h.layerInfo[r][e];if(S.data&&x>=a){(!_||T>y)&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}const O=(w==null?void 0:w.getLevelRowColumn(h.lij))??h.lij;if((v==null?void 0:v.getAvailability(O[0],O[1],h.lij[2]))!=="unavailable"&&T<=o&&!S.data&&!S.dataMissing&&((!f||h.level===n||T%x0e==0||d-f.level<a)&&(f=h),x>=l))break;h=h.parent}if(f!=null&&d-f.level<a)if(m)f=null;else{const T=this._findAncestorWithData();T!=null&&(this._setUpsampleTile(T),f=T.layerInfo[r][e].dataInvalidated?T:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,en.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},cut=class extends AY{get _desiredMinLevelDelta(){throw yoe}get _progressiveLevelModulo(){throw yoe}dispose(){}};const yoe=new Error("Abstract method called on TileAgent"),Nl=new cut;let GSe=class extends AY{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return rB(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},jSe=class extends AY{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return x0e}};var Pb,lw;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(Pb||(Pb={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(lw||(lw={}));function uut(t){t.fragment.uniforms.add(new Je("u_colormap",e=>e.u_colormap),new Oe("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Oe("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Oe("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(b`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function hut(t){t.fragment.uniforms.add(new Je("u_transformGrid",e=>e.u_transformGrid),new Sr("u_transformSpacing",e=>e.common.u_transformSpacing),new Sr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(b`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let HSe=class extends ei{constructor(){super(...arguments),this.scale=1,this.offset=np}};function qSe(t){t.attributes.add(E.POSITION,"vec2"),t.attributes.add(E.UV0,"vec2"),t.vertex.uniforms.add(new Oe("scale",e=>e.scale)),t.vertex.uniforms.add(new Sr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let dut=class extends HSe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function put(t,e){t.include(hut),t.fragment.uniforms.add(new Je("u_image",i=>i.u_image),new Rf("u_flipY",i=>i.common.u_flipY),new Rf("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new Sr("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(b`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(b`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(b`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Re;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Re||(Re={}));const OG={normal:Re.Normal,average:Re.Average,lighten:Re.Lighten,lighter:Re.Lighter,screen:Re.Screen,plus:Re.Plus,"color-dodge":Re.ColorDodge,darken:Re.Darken,multiply:Re.Multiply,"color-burn":Re.ColorBurn,overlay:Re.Overlay,"soft-light":Re.SoftLight,"hard-light":Re.HardLight,"vivid-light":Re.VividLight,hue:Re.Hue,saturation:Re.Saturation,luminosity:Re.Luminosity,color:Re.Color,difference:Re.Difference,exclusion:Re.Exclusion,minus:Re.Minus,invert:Re.Invert,reflect:Re.Reflect,"destination-over":Re.DestinationOver,"destination-atop":Re.DestinationAtop,"destination-in":Re.DestinationIn,"destination-out":Re.DestinationOut,"source-atop":Re.SourceAtop,"source-in":Re.SourceIn,"source-out":Re.SourceOut,xor:Re.Xor};function fut(t){return t===Re.DestinationOver||t===Re.DestinationAtop||t===Re.DestinationIn||t===Re.DestinationOut||t===Re.SourceAtop||t===Re.SourceIn||t===Re.SourceOut||t===Re.Xor}function OY(t){t.code.add(b`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.float(257)};
      if(pos < 0.5 || pos > ${b.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function mut(t,e){const r=e.blendMode;r!==Re.Normal&&(r===Re.Reflect&&t.code.add(b`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Re.ColorDodge&&r!==Re.VividLight||t.code.add(b`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Re.ColorBurn&&r!==Re.VividLight||t.code.add(b`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Re.Overlay&&t.code.add(b`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Re.HardLight&&t.code.add(b`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Re.SoftLight&&t.code.add(b`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Re.VividLight&&t.code.add(b`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Re.Hue&&r!==Re.Saturation&&r!==Re.Color&&r!==Re.Luminosity||(t.code.add(b`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Re.Hue&&r!==Re.Saturation||t.code.add(b`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(b`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Re.Multiply?b`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Average?b`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Lighten?b`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Darken?b`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Lighter?b`return vec4(cl * ol + cb * ob, ol + ob);`:r===Re.Plus?b`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Re.Minus?b`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Re.Screen?b`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Difference?b`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Invert?b`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Re.DestinationOver?b`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Re.DestinationAtop?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Re.DestinationOut?b`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Re.SourceAtop?b`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Re.SourceOut?b`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Re.Xor?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Re.DestinationIn?b`return vec4(cb * ob * ol, ol * ob);`:r===Re.SourceIn?b`return vec4(cl * ol * ob, ol * ob);`:r===Re.Hue?b`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Saturation?b`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Color?b`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Luminosity?b`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Exclusion?b`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Reflect?b`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.ColorDodge?b`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.ColorBurn?b`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Overlay?b`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.SoftLight?b`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.HardLight?b`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.VividLight?b`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b``}
    }
  `))}var yn,jd,Od;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(yn||(yn={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(jd||(jd={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Od||(Od={}));function WSe(t,e){const r=e.output===yn.GridComposite,i=e.output===yn.ColorComposite,s=e.output===yn.GroupBackgroundComposite,n=e.output===yn.Composite;r&&t.fragment.include(OY),i&&t.fragment.uniforms.add(new zt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===jd.Required;o&&t.fragment.uniforms.add(new Oe("baseOpacity",c=>c.baseOpacity)),n&&t.fragment.uniforms.add(new Je("fboColor",c=>c.fboTexture));const a=e.blendMode!==Re.Normal,l=e.premultipliedSource===Od.On;t.fragment.include(mut,e),t.fragment.code.add(b`
    vec4 getBackground(vec2 uv) {
      return ${o?b`baseOpacity *`:""} ${s?b`vec4(0.0, 0.0, 0.0, 0.0)`:i?b`vec4(backgroundColor, 1.0)`:r?b`vec4(gridColor(uv), 1.0)`:b`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?b`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:b`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?b`colorLayer * opacity;`:b`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let i6=class extends dut{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Ba,this.fboTexture=null,this.baseOpacity=1}},gut=class extends i6{},yut=class extends i6{};function _ut(t){const e=new wr;return e.include(qSe),e.include(put,t),e.include(uut,t),e.include(WSe,t),e.fragment.code.add(b`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===Pb.Stretch?but(e,t):t.colorizerType===Pb.Lut?vut(e):t.colorizerType===Pb.Hillshade&&wut(e,t),e}function vut(t){t.fragment.code.add(b`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function but(t,e){t.fragment.uniforms.add(new YR("u_bandCount",i=>i.symbolizer.u_bandCount),new vl("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new vl("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new vl("u_factor",i=>i.symbolizer.u_factor,3),new Oe("u_minOutput",i=>i.symbolizer.u_minOutput),new Oe("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Rf("u_useGamma",i=>i.symbolizer.u_useGamma),new vl("u_gamma",i=>i.symbolizer.u_gamma,3),new vl("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Oe("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(b`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?b`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:b`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(b`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===lw.Noop?b`
        fragColor = applyBackgroundBlend(currentPixel);`:b`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function wut(t,e){const r=t.fragment;r.uniforms.add(new Je("u_image",s=>s.u_image),new YR("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new vl("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new vl("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new vl("u_cosZs",s=>s.symbolizer.u_cosZs,6),new vl("u_weights",s=>s.symbolizer.u_weights,6),new Sr("u_factor",s=>s.symbolizer.u_factor),new Oe("u_minValue",s=>s.symbolizer.u_minValue),new Oe("u_maxValue",s=>s.symbolizer.u_maxValue),new Sr("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(rm),r.code.add(b`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(b`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?b`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:b`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(b`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const xut=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:yut,ColorizerStretchUniforms:gut,ColorizerUniforms:i6,build:_ut},Symbol.toStringTag,{value:"Module"}));function Tut(t,e,r="nearest",i=!1){var c;const s=!(i&&e.pixelType==="u8"),n=s?Vs.FLOAT:Vs.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new vr;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===ar.WEBGL2&&s?Xe.RGBA32F:St.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?At.NEAREST:At.LINEAR,l.dataType=n,l.wrapMode=Dt.CLAMP_TO_EDGE,new Ct(t,l,o)}function Sut(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l=new vr;l.width=a?4*n:n,l.height=o,l.internalFormat=t.type===ar.WEBGL2?Xe.RGBA32F:St.RGBA,l.dataType=Vs.FLOAT,l.samplingMode=At.NEAREST,l.wrapMode=Dt.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let h=0,d=0;h<s.length;h++)c[d++]=s[h],h%3==2&&(c[d++]=1);else for(let h=0;h<o;h++)for(let d=0;d<n;d++){const f=4*(h*n+d),m=2*(d*o+h);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new Ct(t,l,c)}function _oe(t,e){const r=new vr;return r.internalFormat=St.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=At.NEAREST,r.wrapMode=Dt.CLAMP_TO_EDGE,new Ct(t,r,e)}function Eut(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:np,u_transformGridSize:t?t.size:np,u_targetImageSize:e,u_srcImageSize:r}}function Cut(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Aut(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function Out(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const voe={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let Rut=class{constructor(e,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Fe(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...voe,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||voe}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var s;return!!((s=this._bandIds)!=null&&s[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?At.LINEAR:At.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Fe(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=Sut(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=Eut(r,[i,s],[this.source.width,this.source.height],n),a=Cut(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Aut(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Out(this.symbolizerParameters):null;return new i6(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Fe(this._rasterTexture),this._transformGridTexture=Fe(this._transformGridTexture),this._colormapTexture=Fe(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Fe(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=Fe(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Tut(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=Fe(this._colormapTexture),this._colormapTexture=_oe(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=_oe(e,i),void(this._colormap=i)):(this._colormapTexture=Fe(this._colormapTexture),void(this._colormap=null))}},DL=class{constructor(){this.waitingAgents=new Gt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=v9.acquire();return r._init(e),r}release(){this.dispose(),NL.delete(this),v9.release(this)}dispose(){this.loadingAgent=Fe(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=O2(this._data)}static prune(){v9.prune(0)}_init(e){this.waitingAgents.clear(),this._data=O2(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=lu(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),aut(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){O2(this._data),this._data=e}};const v9=new Uo(DL,null,()=>{}),NL=new Map;function Put(){NL.size>0&&(console.log(`${NL.size} live TilePerLayerInfo allocations:`),NL.forEach(t=>console.log(t,`
`)))}let vT=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}};var _t;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(_t||(_t={}));const Mut=.1;let RY=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=kt(),this._elevationBounds=Ue(),this.layerInfo=[[],[]],this.extentInRadians=kt(),this.centerAtSeaLevel=A(),this._center=[A(),_s(),A()],this.up=Eq(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=A()}static prune(){PY.prune(0),MY.prune(0),DL.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Fs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??Ko.INTERSECTS;this._frustumVisibility=r===Ko.INSIDE?Ko.INSIDE:r===Ko.OUTSIDE?Ko.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==Ko.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Nr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Fs.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,r&&r.elevationBounds?cn(this._elevationBounds,r.elevationBounds):nr(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of y1){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=DL.acquire(this._surface.upsampleInfoPool),s===rr.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,n3)}release(){cf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of y1){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[rr.MAP].reduce((e,r)=>e+(r instanceof _9?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){var i;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:s}of this.layerInfo[rr.MAP])s instanceof _9?e+=this._getTerrainDataMemory(s):this._mapTileMemoryInternal+=this._getTerrainDataMemory(s);const r=this._cpuImageMemorySize;for(const s of this.layerInfo[rr.ELEVATION])this._usedMemory+=s.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((i=this.renderData.texture)==null?void 0:i.gpuMemoryUsage)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===rr.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===rr.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof vT?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof KF?this._cpuImageMemorySize:e instanceof Rut?e.memoryUsage:e instanceof _9?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const r=this._center[Fs.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Ko.OUTSIDE))return _t.NONE;const s=this.level;he(PI,this._center[Fs.MIDDLE],r);let n=ra(PI),o=PI,a=Fs.MIDDLE;he(b9,this._center[Fs.TOP],r);const l=ra(b9);l<n&&(n=l,o=b9,a=Fs.TOP),he(w9,this._center[Fs.BOTTOM],r);const c=ra(w9);if(c<n&&(n=c,o=w9,a=Fs.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return _t.SPLIT;const h=i!=null?i-s:1/0,d=Math.sqrt(n),f=e.fovX*d*2,m=this._edgeLen/f,y=()=>{if(s<e.maxLod)return this.elevationLevel=s,_t.NONE;const P=s+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return P!==this.elevationLevel?(this.elevationLevel=P,_t.ELEVATION):_t.NONE};if(h<=.5)return y();const _=me(this.up,PI),v=this._elevationBounds[1]-this._elevationBounds[0],w=v/this.edgeLen;if(e.aboveGround&&_>0&&w<.001&&_/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-w>0)return _t.NONE;const T=i!=null?3-Math.min(h,2):1;if(m*T<e.relativeWidthLimit||s>=e.maxLod)return y();if(s<7)return _t.SPLIT;ie(Kn,this.up,_),he(Kn,Kn,o);const x=ra(Kn);if(x<=this.radius*this.radius)return _t.SPLIT;ie(Kn,Kn,this.radius/Math.sqrt(x)),le(Kn,Kn,this._center[a]),he(Kn,r,Kn);const S=Math.min(1,(Math.abs(me(Kn,this.up))+.5*v+this._curvatureHeight)/Ee(Kn)),O=Mut/e.angledSplitBias,C=e.fovY*d*2;return S*(this._edgeLen/C*T)<O*e.relativeHeightLimit?_t.NONE:_t.SPLIT}setChildren(e,r,i,s){cf(!!(e&&r&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of y1)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of y1){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==Nl&&(RI(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(_t.GEOMETRY),this.resetPendingUpdate(_t.TEXTURE_NOFADING),this.resetPendingUpdate(_t.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[rr.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Nl&&(RI(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(mb(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(_t.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of y1){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Nl&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(_t.SPLIT)||e!==rr.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===_t.SPLIT||e===_t.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e);const a=s.data&&"type"in s.data&&s.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(s.requestPromise)return!0;lu(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return ra(he(Kn,this._center[Fs.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;cf(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=i!=null&&"type"in i&&i.type==="vector-tile",n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,r)),e){case rr.MAP:return this._updateTexture(r);case rr.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===en.FADING?_t.TEXTURE_NOFADING:_t.TEXTURE_FADING),this.setPendingUpdate(e===en.FADING?_t.TEXTURE_FADING:_t.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(_t.GEOMETRY);for(const e of this.layerInfo[rr.ELEVATION])e.pendingUpdates|=_t.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];nr(e,1/0,-1/0);const s=this.layerInfo[rr.ELEVATION];let n=!0;for(const o of s)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;ie(Kn,this.up,r),le(i[Fs.MIDDLE],this.centerAtSeaLevel,Kn),ie(Kn,this.up,e[0]),le(i[Fs.TOP],this.centerAtSeaLevel,Kn),ie(Kn,this.up,e[1]),le(i[Fs.BOTTOM],this.centerAtSeaLevel,Kn)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[rr.ELEVATION][e],s=rB(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,rr.ELEVATION),l=wG(a);if(!XA(this,l,!1))return;const c=$ut;let h=!1;const d=i.data;if(d&&d.level<=n){const f=i.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,y=0;for(let _=this._parent;_&&(!m||y<s)&&(y=this.elevationLevel-_.level,f=m||f,m=_.layerInfo[rr.ELEVATION][e].data,!(!m&&f&&_.level<=n));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(i.elevationBounds==null&&(i.elevationBounds=new o2),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==Nl&&(RI(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:DL.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,en.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Nl&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of y1){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Nl&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Nl&&this.updateRenderData(e,en.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Nl&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Nl,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||j2(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var s,n,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(g4(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||j2((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=wG(l);if(o.loadingAgent?XA(this,c,!1)?(o.loadingAgent!==Nl&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Nl&&(a=o.loadingAgent.update())):o.dispose():XA(this,c,!1)&&(o.loadingAgent=Iut(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Nl&&this.setPendingUpdate(_t.GEOMETRY):(RI(o.loadingAgent),o.loadingAgent=Nl)),o.loadingAgent===Nl&&this.updateRenderData(r,en.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,rB(this.level)-r),s=_e(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(Lut(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?Dut(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===it.NORTH_EAST?1:e===it.NORTH_WEST?0:e===it.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(y4(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===it.NORTH?[0,1]:e===it.NORTH_EAST?[1]:e===it.EAST?[1,3]:e===it.SOUTH_EAST?[3]:e===it.SOUTH?[2,3]:e===it.SOUTH_WEST?[2]:e===it.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){QO.forEach(r=>this.findNeighborCornerTileExact(r,e)),vf.forEach(r=>{var i;return(i=this.findNeighborTile(r,s=>s.level===this.level||e(s)))==null?void 0:i.forAllSubtreeOnSide(_4(r),e)})}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(we(!sn||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return sn&&(we(a<=l&&l<a+s),we(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;vf.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(_4(s),o=>!!o.isLoaded&&(e(o,s),!0))}),QO.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(y4(s),a=>a.isLoaded);we(!n||RG(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=aoe(r)?-1:ooe(r)?1:0,s=soe(r)?-1:noe(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+Xa()>=r}checkGeometryWaterproofness(){var e;f4&&(we(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(aoe(e)&&r[3]+s>=i[3]||ooe(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&soe(e)&&r[0]-s<=i[0])&&!(!n&&noe(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;re(this._lastPOI,e);const i=this._center[Fs.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function Iut(t,e,r,i){const s=r===rr.ELEVATION?MY.acquire():PY.acquire();return s.init(t,e,r,i),s}function RI(t){t.dispose(),t instanceof GSe?MY.release(t):t instanceof jSe&&PY.release(t)}const PY=new Uo(jSe),MY=new Uo(GSe),$ut=new o2;var Fs;function Lut(t,e){const r=t.level,i=e[0];if(r>i)return!1;const s=i-r,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function Dut(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Nut(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===it.EAST||t.isWestEnd&&e.isEastEnd&&r===it.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case it.NORTH:return ih(t.extent[3],e.extent[1],i);case it.SOUTH:return ih(t.extent[1],e.extent[3],i);case it.EAST:return ih(t.extent[2],e.extent[0],i)||ih(t.extent[2],-e.extent[0],i);case it.WEST:return ih(t.extent[0],e.extent[2],i)||ih(t.extent[0],-e.extent[2],i)}}function RG(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?boe(t,e,r):boe(e,t,y4(r)))}function boe(t,e,r){we(t.level>=e.level);const i=Ylt(r),s=Jlt(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=ih(a[0],l[0],c)||t.surface.isGlobal&&ih(a[0],-l[0],c),d=ih(a[1],l[1],c);if(h&&d)return!0;if(t.level===e.level||!h&&!d)return we(!1),!1;const f=h?woe(o[1],o[3],n[1],n[3],c):woe(o[0],o[2],n[0],n[2],c);return we(f),f}function woe(t,e,r,i,s){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Fs||(Fs={}));const PI=A(),b9=A(),w9=A(),Kn=A();let Fut=class{constructor(){this._scales=Ft(-1,-1,-1,-1),this._offsets=Ft(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function Uut(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(b`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let IY=class extends tTe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=A(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var ac;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(ac||(ac={}));let Vut=class extends IY{constructor(){super(...arguments),this.identifier=ac.Material,this.output=L.Color,this.transparent=!1,this.integratedMesh=!1}},zut=class extends IY{constructor(){super(...arguments),this.identifier=ac.ShadowMap}},kut=class extends IY{constructor(){super(...arguments),this.identifier=ac.Highlight}},v4=class extends cs{constructor(e,r){super(e,"vec4",Qr.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var Eg;function But(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new v4("overlayTexOffset",(s,n)=>Gut(s,n)),new v4("overlayTexScale",(s,n)=>jut(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Je("ovColorTex",(s,n)=>PG(s,n))),ZSe(t,e)}function ZSe(t,e){e.pbrMode!==rt.Water&&e.pbrMode!==rt.WaterOnIntegratedMesh&&e.pbrMode!==rt.TerrainWithWater||t.include(sTe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(b`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(b`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(b`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(b`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==rt.Water&&e.pbrMode!==rt.WaterOnIntegratedMesh&&e.pbrMode!==rt.TerrainWithWater||(Wg(i),tm(i),i.code.add(b`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function PG(t,e){return e.overlays.length===0?null:t.identifier===ac.Material&&t.output===L.Color?e.overlays[$i.INNER].getColorTextureNoRasterImage():t.identifier===ac.Material&&t.output===L.ObjectAndLayerIdColor?e.overlays[$i.INNER].getColorTexture($a.ObjectAndLayerIdColor):t.identifier===ac.Highlight?e.overlays[$i.INNER].getValidTexture(ss.Highlight):null}function Gut(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Lpe(s)>0&&(R2[2*i]=t.toMapSpace[0]/Qc(s)-s[0]/Qc(s),R2[2*i+1]=t.toMapSpace[1]/rp(s)-s[1]/rp(s))}return R2}function jut(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;Lpe(s)>0&&(R2[2*i]=t.toMapSpace[2]/Qc(s),R2[2*i+1]=t.toMapSpace[3]/rp(s))}return R2}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Eg||(Eg={}));const R2=Yt();var bf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(bf||(bf={}));let Hut=class extends HX{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=$a.None}};function fC(t,e){t.vertex.uniforms.add(new b4("overlayTexOffset"),new b4("overlayTexScale")),t.fragment.uniforms.add(new Oe("overlayOpacity",r=>r.overlayOpacity),new Je("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[$i.INNER].getColorTexture(r.overlaySource))),ZSe(t,e)}function qut(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new b4("texOffsetAndScale")),i.uniforms.add(new xoe("tex")),i.uniforms.add(new x9("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new b4("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new xoe("texNext")),i.uniforms.add(new x9("nextTexOpacities")),i.uniforms.add(new Wut("fadeFactor")));const o=e.tileBlendInput===bf.ColorComposite,a=e.tileBlendInput===bf.GridComposite;a&&i.include(OY),o&&i.uniforms.add(new x9("backgroundColor")),r.code.add(b`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?b`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b``}
  }`),i.code.add(b`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?b`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?b`backgroundColor`:b`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:b`return color;`}
    }`),n?i.code.add(b`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(b`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let Wut=class extends cs{constructor(e){super(e,"float")}},x9=class extends cs{constructor(e){super(e,"vec3")}},b4=class extends cs{constructor(e){super(e,"vec4")}},xoe=class extends cs{constructor(e){super(e,"sampler2D")}},XSe=class extends Hut{};function Zut(t){const e=new wr,{vertex:r,fragment:i,varyings:s}=e;e.include(IR),e.include(XR,t),e.include(Of,t);const n=()=>{e.include(qO,t),r.code.add(b`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};gc(r,t),e.include(wl,t);const o=t.overlayMode!==Eg.Disabled,a=o&&t.invisible;switch(t.output){case L.Color:{e.include(qut,t),e.include(ow,t),o&&e.include(fC,{...t,pbrMode:t.pbrMode===rt.Terrain?rt.TerrainWithWater:rt.Water});const l=t.overlayMode===Eg.EnabledWithWater;l&&e.include(Uut,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&vS(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(iE,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(b`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?b`forwardVertexTangent(vnormal);`:b``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?b`setOverlayVTC(uv);`:""}
          ${t.tileBorders?b`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?b`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?b`forwardLinearDepth();`:""}

        }
      `),e.include(ms,t),e.include(ow,t),e.include(JR,t),e.include(sw,t),ap(i,t),QR(i),dE(i),i.uniforms.add(r.uniforms.get("localOrigin"),new zt("viewDirection",(h,d)=>ge(Toe,se(Toe,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&i.uniforms.add(new Je("ovWaterTex",(h,d)=>d.overlays.length===0?null:d.overlays[$i.INNER].getNormalTexture(h.overlaySource)),new ube("view",(h,d)=>Cl(Xut,d.camera.viewMatrix,h.origin))),i.code.add(b`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Wg(i),tm(i),i.code.add(b`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?b`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?b`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===rt.Terrain||t.pbrMode===rt.TerrainWithWater?b`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:b`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?b`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?b`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?b`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:b`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?b`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case L.Depth:a&&e.include(fC,t),e.include(Bg,t),O_(e),Jb(e),r.code.add(b`
              void main(void) {
                ${a?b`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(b`
              void main() {
                ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:e.include(Bg,t),O_(e),Jb(e),r.code.add(b`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(b`void main() {
outputDepth(linearDepth);
}`);break;case L.Normal:a&&e.include(fC,t),s.add("vnormal","vec3"),vS(r),n(),r.code.add(b`
            void main(void) {
              ${a?b`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(b`
            void main() {
              ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case L.Highlight:o&&e.include(fC,t),r.code.add(b`
          void main() {
            ${o?b`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(ty,t),i.code.add(b`
          void main() {
            ${o?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===L.ObjectAndLayerIdColor&&(e.include(fC,{...t,pbrMode:rt.Disabled}),r.code.add(b`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(b`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const Xut=ve(),Toe=A(),Yut=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:XSe,build:Zut},Symbol.toStringTag,{value:"Module"}));let YSe=class JSe extends Pr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===Le.Global}initializeProgram(e){return new Cr(e.rctx,JSe.shader.get().build(this.configuration),QSe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Ot({blending:r.renderOccluded?wc(be.ONE,be.ONE_MINUS_SRC_ALPHA):null,culling:i?tZ:null,depthTest:r.renderOccluded?null:{func:Kr.LESS},depthWrite:r.renderOccluded?null:Al,colorWrite:jt,stencilTest:e?nKe(Tl.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};YSe.shader=new Er(Yut,()=>ae(()=>import("./Terrain.glsl-bb1160e5.js"),[]));const QSe=new Map([[E.POSITION,0],[E.UV0,1],[E.NORMALCOMPRESSED,2]]);let Jut=class{constructor(){this.geometry=new Zct,this.intersectionData=null,this.geometryState=null,this._textureRef=new VSe(()=>this.tile.surface.textureFadeDuration),this.overlay=new Fut,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,Ti(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new eut,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),sn&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)we(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return s}const n=i.level,o=vf[e];if(!r)return we(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const c=r,h=c.renderData.geometryState,d=n-c.level;if(we(d>=0),d===0){const y=h.numVerticesPerSide-1;return Math.max(y,s)}const f=2**d,m=h.neighborData.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}we(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(_4(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(we(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(vf[l],i),h=Z1(e,c),d=((a=h==null?void 0:h.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,f=s[l],m=h!==Z1(e,f),y=n[l]!==d;s[l]=c,(m||y)&&(n[l]=d,this._markEdgeDirty(l));const _=r.edgeResolutions[l],v=this._calculateEdgeResolution(l,c);we(Bb(v)),we(v>=1),r.edgeResolutions[l]=v,_!==v&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(QO[l],i);o[l]=c;const h=Z1(e,s[l]),d=Z1(e,s[(l+1)%4]),f=Z1(e,c);Xh[l]=f,Xh[(l+1)%4]=d,Xh[(l+2)%4]=e,Xh[(l+3)%4]=h,we(Xh.some(v=>(v==null?void 0:v.isLoaded)||v===e));const m=Xh.reduce((v,w)=>Math.min(v,(w==null?void 0:w.level)??1/0),1/0);Xh.forEach((v,w)=>{v&&(v==null?void 0:v.level)>m&&(Xh[w]=null)}),we(Xh.some(v=>(v==null?void 0:v.isLoaded)||v===e));const y=r.cornerNeighborData[l].cornerTiles,_=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let v=0;v<4;++v){const w=Xh[v],T=(w==null?void 0:w.renderData.geometryState.samplerDataVersion)??-1,x=y[v]!==w,S=!x&&_[v]!==T;(x||S)&&(y[v]=w,_[v]=T,this._markCornerDirty(l))}we(y.some(v=>(v==null?void 0:v.isLoaded)||v===e))}sn&&we(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)Xh[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;sn&&we(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometry.vertexAttributes,n=!i||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,Jct(this.geometry),!0)}ensureTexture(e,r){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Og(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=e.gl;this._vao=new up(e,QSe,{geometry:Sc(r.layout)},{geometry:Lr.createVertex(e,s.STATIC_DRAW,r.buffer)},Lr.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=Tg.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[rr.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let h=0;h<i;h++){const d=r[h];if(d.upsampleInfo!=null){const f=d.upsampleInfo.tile,m=f.layerInfo[rr.ELEVATION][h].data,y=m&&m.samplerData;e&&e[n]===y||(a=!0),s[n++]=y,o=Math.max(o,f.lij[0])}else if(d.data){const f=this.tile.surface.layerViewByIndex(h,rr.ELEVATION);if(XA(this.tile,f.layer,!1)){const m=d.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,s;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!sn)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void we(e==null?void 0:e.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=vf.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),s=e.level;we(this._dirtyCorners===0),we(this._dirtyEdges===0),we(this._dirtyEdgeResolutions===0),we(!this._numVerticesPerSideChanged),we(!this._samplerDataChanged),we(!this._clippingAreaChanged),we(!this._wireframeChanged);const n=QO.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];we(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}vf.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,N=>(N.level===s||(N==null?void 0:N.isLoaded))&&(N==null?void 0:N.intersectsClippingArea));if(!c){const N=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void we(!N)}we(c.isLoaded||c.level===e.level),we(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const h=s-c.level;if(!c.isLoaded)return we(!c.isLeaf),void we(h===0);const d=c.renderData;we(Nut(e,c,a)),we(h>=0);const f=2**h;if(h<0)return void we(!1);const m=e.renderData,y=m.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,w=d.geometry;if(!w)return void we(!1);const T=this.geometryState.neighborData.edgePeerNeighbors[l];if(T!=null&&T.isLoaded){const N=T.renderData;we(T==T),we(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===N.geometryState.samplerDataVersion),we(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===N.geometryState.samplerDataVersion)}const x=(l+2)%4,S=w.outerEdges[x],O=_.count-1,C=S.count-1;we(O*f===C,`Tile[${e.lij}]:e${l},res=${O} edgeRes mismatch with Neighbor[${c.lij}]:e${x},res=${C} (expected:${O*f})`);const P=e.extent,$=a===it.NORTH||a===it.SOUTH,V=S.count-1,z=V/2**h,B=_.count-1;if(z<1)return void we(B===1);we(z===B),we(Bb(z));const k=w.numVerticesPerSide-1;we(h>0||z===Math.max(k,v));const Z=e.getNeighborEdgeStartVertexIndex(l,c);we(0<=Z&&Z<f);const W=Z*z;we(0<=W&&W<=V-z);let j=0,Y=W;_.getVertexPos(Mp,0),_.getVertexPos(Ip,_.count-1);const M=mi(Mp,Ip),D=Math.max(Qut,1e-4*M);for(let N=0;N<=z;++N){_.getVertexPos(Mp,j),S.getVertexPos(Ip,Y);const G=N/z,X=$?P[0]+G*(P[2]-P[0]):a===it.WEST?P[0]:P[2],J=$?a===it.SOUTH?P[1]:P[3]:P[1]+G*(P[3]-P[1]),ee=e.surface.extent;if(ee==null||d5(ee,X,J)){const ye=gR(Mp,Ip),Me=Jl(Mp)-sr.radius,ft=Jl(Ip)-sr.radius,Rt=ye<D;if(!Rt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${j}/${_.count}] and [${c.lij}].edge${x}[${Y}/${S.count}]`),ee!=null&&console.warn("  surface extent= ",ee," x,y=",X,",",J);const ze=A();he(ze,m.localOrigin,d.localOrigin),Jl(ze)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${Jl(ze)} [${ze}]`),(()=>{const fe=Is(Mp),Tt=Is(Ip);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(Mp,j),S.getVertexPos(Ip,Y);const bt=A();bn(bt,Mp,fe),Jl(bt)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${fe} vs ${Mp} d=${Jl(bt)} [${bt}]`),bn(bt,Ip,Tt),Jl(bt)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Tt} vs ${Ip} d=${Jl(bt)} [${bt}]`)})(),we(Rt,`Mismatch in tile [${e.lij}].edge[${l}][${j}/${_.count}] vs neighbor [${c.lij}].edge[${x}][${Y}/${S.count}] ${vm(Mp)} vs ${vm(Ip)}  dist=${ye} h(t|n|d)=${Me}|${ft}|${ft-Me}`)}_.getNormal(Ex,j),S.getNormal(Cx,Y),ge(Soe,Ex),ge(Eoe,Cx);const at=me(Soe,Eoe),vt=1-at<.01||!1||e===c;if(!vt){const ze=A();bn(ze,Ex,Cx);const fe=()=>`Mismatch in tile edge normal ${ioe(e.lij)} (${j}/${_.count-1}) edge ${l} vs neighbor ${ioe(c.lij)}  (${Y}/${S.count-1}) nedge ${x} :${vm(Ex)} vs ${vm(Cx)}  dot = ${at} : ${vm(ze)}`;console.warn("Mismatch in tile edge normal: ",fe());{e.updateEdgeElevations(),c.updateEdgeElevations();const Tt=A(),bt=A();_.getNormal(Tt,j),S.getNormal(bt,Y),m_(Ex,Tt)||console.warn("Missing update in tile normal: ",vm(Ex)," => ",vm(Tt)),m_(Cx,bt)||console.warn("Missing update in neighbor normal: ",vm(Cx)," => ",vm(bt))}we(vt,fe())}}j+=1,Y+=1}})}};const Mp=A(),Ip=A(),Ex=A(),Cx=A(),Soe=A(),Eoe=A(),Qut=1,Xh=[null,null,null,null];function Z1(t,e){return e!=null&&e.isLoaded||e===t?e:null}const Kut=65536;function eht(t,e){const r=t.tile,{extent:i,extentInRadians:s,surface:n}=r,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=a.numVerticesPerSide,h=c-1,d=(c-2)**2,f=l&&(e===th.HAS_SOUTH_POLE||e===th.HAS_BOTH_POLES),m=l&&(e===th.HAS_NORTH_POLE||e===th.HAS_BOTH_POLES),y=6,_=((f?1:0)+(m?1:0))*y*(h+1),v=a.neighborData,w=v.edgeResolutions.reduce((P,$)=>P+$+1,0),T=USe(d+_+w),x=t.geometry;x.numVerticesPerSide=a.numVerticesPerSide,x.vertexAttributes=T;const S=x.boundingBox;Ti(S);const O=$Y(t);ao.update(h,s,O),tht(t),lEe(t,d),KSe(t);const C=[];if((()=>{let P=d+w;const $=o[0],V=o[1],z=o[2],B=r.ellipsoid.radius,k=i[1],Z=i[3],W=(j,Y)=>{const M=Y*c;gh(-$,-V,j*B-z,S),C.push({connectedRowOffset:M,connectedOuterEdgeOffset:j===1?0:2,rowOffset:P,latitudeResolution:y});const D=rEe(j===-1?k:Z,B),N=j*Math.PI/2-D,G=.99*(j===1?1:-1),X=B+0,J=T.position,ee=T.uv0,{typedBuffer:ye,typedBufferStride:Me}=T.normalCompressed;for(let ft=1;ft<=y;++ft){const Rt=D+N*(ft/y),at=Math.cos(Rt),vt=Math.sin(Rt);for(let ze=0;ze<=h;ze++){const fe=ze/h,Tt=ao.sinLonLUT[ze],bt=ao.cosLonLUT[ze]*at,Ce=Tt*at,Be=vt,je=bt*X-$,mt=Ce*X-V,ut=Be*X-z;gh(je,mt,ut,S),J.setValues(P,je,mt,ut),Qd(ee,P,fe,G),nw(ye,P,bt,Ce,Be,Me),++P}}};f&&W(-1,0),m&&W(1,h)})(),aEe(x,a.numVerticesPerSide,C,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,sn)for(let P=0;P<4;++P)we(x.outerEdges[P].count===v.edgeResolutions[P]+1)}function tht(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,s=i-2,n=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:h,typedBufferStride:d}=a.normalCompressed,f=e.extent,m=f[0],y=f[2],_=f[1],v=f[3],w=e.ellipsoid.radius,T=r.samplerData,x=t.localOrigin,S=x[0],O=x[1],C=x[2],P=l.typedBuffer,$=l.typedBufferStride,V=1/n,z=o.boundingBox;let B=0;if(1<=s){const k=V,Z=_*(1-k)+v*k,W=ao.sinLatLUT[1],j=ao.cosLatLUT[1];for(let Y=1;Y<=s;Y++){const M=Y*V,D=m*(1-M)+y*M,N=ao.sinLonLUT[Y],G=ao.cosLonLUT[Y],X=w+Xi(D,Z,T),J=X*G*j-S,ee=X*N*j-O,ye=X*W-C;gh(J,ee,ye,z);const Me=(Y-1)*$;P[Me]=J,P[Me+1]=ee,P[Me+2]=ye,Qd(c,Y-1,M,k)}}for(let k=1;k<=s;k++){const Z=k*V,W=_*(1-Z)+v*Z,j=ao.sinLatLUT[k],Y=ao.cosLatLUT[k],M=k+1,D=M*V,N=_*(1-D)+v*D,G=ao.sinLatLUT[M],X=ao.cosLatLUT[M],J=ao.sinLonLUT[0],ee=ao.cosLonLUT[0],ye=w+Xi(m,W,T);let Me=ee*Y*ye-S,ft=J*Y*ye-O,Rt=j*ye-C;const at=B*$;let vt=P[at],ze=P[at+1],fe=P[at+2];for(let Tt=1;Tt<=s;Tt++){const bt=Tt*V,Ce=m*(1-bt)+y*bt,Be=ao.sinLonLUT[Tt],je=ao.cosLonLUT[Tt];let mt=0,ut=0,dr=0;if(Tt<s){const fr=(B+1)*$;mt=P[fr],ut=P[fr+1],dr=P[fr+2]}else{const fr=ao.sinLonLUT[n],ui=ao.cosLonLUT[n],Ui=w+Xi(y,W,T);mt=ui*Y*Ui-S,ut=fr*Y*Ui-O,dr=j*Ui-C}const He=Me,gt=ft,pr=Rt;Me=vt,ft=ze,Rt=fe,vt=mt,ze=ut,fe=dr;const nt=mt-He,ht=ut-gt,yt=dr-pr;let Nt=0,Ht=0,Si=0;if(k>1){const fr=(B-s)*$;Nt=P[fr],Ht=P[fr+1],Si=P[fr+2]}else{const fr=ao.sinLatLUT[0],ui=ao.cosLatLUT[0],Ui=w+Xi(Ce,_,T);Nt=je*ui*Ui-S,Ht=Be*ui*Ui-O,Si=fr*Ui-C}const Hr=w+Xi(Ce,N,T),yi=je*X*Hr-S,Bt=Be*X*Hr-O,li=G*Hr-C;if(k<s){const fr=B+s,ui=fr*$;P[ui]=yi,P[ui+1]=Bt,P[ui+2]=li,gh(yi,Bt,li,z),Qd(c,fr,bt,D)}const Vr=Nt-yi,ti=Ht-Bt,Mr=Si-li;let Ei=je*Y,kr=Be*Y,ci=j;ci*ci<.999&&(Ei=yt*ti-ht*Mr,kr=nt*Mr-yt*Vr,ci=ht*Vr-nt*ti);const ri=1/Math.sqrt(Ei*Ei+kr*kr+ci*ci);nw(h,B,Ei*ri,kr*ri,ci*ri,d),++B}}}function rht(t){t.tile.intersectsClippingArea&&(KSe(t),s6(t))}function iht(t){t.tile.intersectsClippingArea&&(tEe(t),eEe(t,!0),s6(t))}function KSe(t){t.tile.intersectsClippingArea&&(tEe(t),eEe(t))}function eEe(t,e=!1){const r=t.geometryState,i=t.geometry,s=r.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],d=c[2],f=c[1],m=c[3],y=r.samplerData,_=a[0],v=a[2],w=a[1],T=a[3],x=$Y(t),S=i.boundingBox,O=t.localOrigin,C=O[0],P=O[1],$=O[2],V=i.vertexAttributes,z=V.position,B=z.typedBuffer,k=z.typedBufferStride,Z=V.uv0;for(let W=0;W<4;++W){const j=W===1||W===3,Y=s.edgeResolutions[W];we(Bb(Y));const M=Y+1,D=Z1(n,s.edgePeerNeighbors[W]);if(hEe(n,D,W)){cEe(t,W,D);continue}const N=D!=null;we(!N||D.level===n.level),we(!N||Sg(n,D)<=0);const G=D==null?void 0:D.renderData,X=G==null?void 0:G.geometryState;if(sn){const nt=n.surface;if(!D&&nt&&!nt.updatingRootTiles){const ht=vf[W],yt=n.findNeighborTile(ht,Nt=>Nt.isLoaded||Nt.isLeaf||Nt.level===n.level);yt?yt.intersectsClippingArea&&(we(!yt.isLoaded),we(!yt.isLeaf),we(yt.level===o)):we((nt==null?void 0:nt.rootTiles)==null||!n.shouldHaveNeighbor(ht))}}const J=W===1?a[2]:a[0],ee=D==null?void 0:D.extent,ye=ee&&j?W===1?ee[0]:ee[2]:J,Me=W===0?a[3]:a[1],ft=W===1?1:0,Rt=W===0?1:0,at=W===1?d:h,vt=W===0?m:f,ze=Math.sin(at),fe=Math.cos(at),Tt=Math.sin(vt),bt=Math.cos(vt),Ce=X==null?void 0:X.samplerData,Be=N?(nt,ht,yt)=>.5*(Xi(nt,ht,y)+Xi(yt,ht,Ce)):(nt,ht,yt)=>Xi(nt,ht,y),je=i.outerEdges[W],mt=e&&M>3?M-3:1,ut=y!=null&&y.some(nt=>nt!=null),dr=Ce!=null&&Ce.some(nt=>nt!=null),He=ut||dr,gt=1/Y,pr=je.index0;we(!ee||ih(ee[2]-ee[0],a[2]-a[0])),(()=>{const nt=W===1?-1:W===3?1:0,ht=W===0?-1:W===2?1:0,yt=(a[2]-a[0])*gt,Nt=nt*yt,Ht=ht*yt,Si=j?nt*((d-h)*gt):0,Hr=j?0:ht*gt,yi=Rt,Bt=j?at+Si:at,li=j?Math.sin(Bt):ze,Vr=j?Math.cos(Bt):fe,ti=j?at-Si:at,Mr=j?Math.sin(ti):ze,Ei=j?Math.cos(ti):fe,kr=j?vt:x(yi+Hr),ci=j?Tt:Math.sin(kr),ri=j?bt:Math.cos(kr),fr=j?vt:x(yi-Hr),ui=j?Tt:Math.sin(fr),Ui=j?bt:Math.cos(fr);let Wn=0,Zn=0,Xn=0;{const qr=0*gt,En=j?J:_*(1-qr)+v*qr,xo=j?ye:En,da=j?w*(1-qr)+T*qr:Me,ne=j?at:h*(1-qr)+d*qr,Ci=j?ze:Math.sin(ne),Nh=j?fe:Math.cos(ne),Cn=j?x(qr):vt,Fh=j?Math.sin(Cn):Tt,Qe=j?Math.cos(Cn):bt,Rl=l+Be(En,da,xo);Wn=Nh*Qe*Rl,Zn=Ci*Qe*Rl,Xn=Fh*Rl}let Yn=0,qi=0,Vi=0;{const qr=1*gt,En=j?J:_*(1-qr)+v*qr,xo=j?ye:En,da=j?w*(1-qr)+T*qr:Me,ne=j?at:h*(1-qr)+d*qr,Ci=j?ze:Math.sin(ne),Nh=j?fe:Math.cos(ne),Cn=j?x(qr):vt,Fh=j?Math.sin(Cn):Tt,Qe=j?Math.cos(Cn):bt,Rl=l+Be(En,da,xo);Yn=Nh*Qe*Rl,qi=Ci*Qe*Rl,Vi=Fh*Rl}for(let qr=1;qr<M-1;qr+=mt){let En=0,xo=0,da=0;{const pa=(qr+1)*gt,Pl=j?J:_*(1-pa)+v*pa,fp=j?ye:Pl,On=j?w*(1-pa)+T*pa:Me,es=j?at:h*(1-pa)+d*pa,ay=j?ze:Math.sin(es),K_=j?fe:Math.cos(es),ev=j?x(pa):vt,Dw=j?Math.sin(ev):Tt,tv=j?Math.cos(ev):bt,ly=l+Be(Pl,On,fp);En=K_*tv*ly,xo=ay*tv*ly,da=Dw*ly}const ne=En,Ci=xo,Nh=da,Cn=Yn,Fh=qi,Qe=Vi;Yn=ne,qi=Ci,Vi=Nh;{const pa=pr+qr,Pl=pa*k,fp=Cn-C,On=Fh-P,es=Qe-$;B[Pl]=fp,B[Pl+1]=On,B[Pl+2]=es,gh(fp,On,es,S);const ay=qr*gt;Qd(Z,pa,j?ft:ay,j?ay:Rt)}const Rl=Wn,An=Zn,Y_=Xn;Wn=Cn,Zn=Fh,Xn=Qe;const J_=Cn,Ya=Fh,nm=Qe,Q_=1/Math.sqrt(J_*J_+Ya*Ya+nm*nm),Kt=nm*Q_;let ny=0,om=0,oy=0;if(He&&Kt*Kt<.999){let pa=0,Pl=0,fp=0;{const On=W===0?-1:1;pa=On*(ne-Rl),Pl=On*(Ci-An),fp=On*(Nh-Y_)}{const On=qr*gt,es=j?J:_*(1-On)+v*On,ay=j?ye:es,K_=j?w*(1-On)+T*On:Me,ev=j?at:h*(1-On)+d*On,Dw=j?ze:Math.sin(ev),tv=j?fe:Math.cos(ev),ly=j?x(On):vt,uP=j?Math.sin(ly):Tt,Ja=j?Math.cos(ly):bt;let yE=J_,_E=Ya,H=nm;if(N){const pe=l+Xi(ay-Nt,K_-Ht,Ce),Te=j?Ja:Ui;yE=(j?Ei:tv)*Te*pe,_E=(j?Mr:Dw)*Te*pe,H=(j?uP:ui)*pe}{const pe=l+Xi(es+Nt,K_+Ht,y),Te=j?Ja:ri,lr=(j?Vr:tv)*Te*pe,zs=(j?li:Dw)*Te*pe,_i=(j?uP:ci)*pe;N||(yE=2*J_-lr,_E=2*Ya-zs,H=2*nm-_i);const fa=W===3?-1:1,rv=fa*(yE-lr),PJ=fa*(_E-zs),MJ=fa*(H-_i);ny=fp*PJ-Pl*MJ,om=pa*MJ-fp*rv,oy=Pl*rv-pa*PJ;const S6=1/Math.sqrt(ny*ny+om*om+oy*oy);ny*=S6,om*=S6,oy*=S6}}}else ny=J_*Q_,om=Ya*Q_,oy=nm*Q_;je.setNormalFromValues(qr,ny,om,oy)}})()}}function tEe(t){uEe(t)}function rEe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function sht(t,e,r,i){return rEe(t*(1-i)+e*i,r)}function nht(t,e,r){return t*(1-r)+e*r}function $Y(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>sht(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>nht(r[1],r[3],i)}function oht(t,e){const r=t.tile.extent,i=t.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-s)/o):0,h=l!=null?Math.max(0,(l[1]-n)/a):0,d=l!=null?Math.min(1,(l[2]-s)/o):1,f=l!=null?Math.min(1,(l[3]-n)/a):1,m=i.numVerticesPerSide,y=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((x,S)=>x+S+1,0),v=USe(y+_),w=t.geometry,T=w.boundingBox;Ti(T),w.numVerticesPerSide=i.numVerticesPerSide,w.vertexAttributes=v,wi(w.uvRange,c,h,d,f),aht(t),lEe(t,y),iEe(t),aEe(w,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),t.intersectionData=null}function aht(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,s=i.samplerData,n=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??LY,c=e.extent,h=c[0],d=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),v=Math.max(d,l[1]),w=Math.min(m,l[3]),T=e.ellipsoid.radius,x=e.horizontalScale,S=i.numVerticesPerSide,O=S-1,C=S-2,P=t.geometry,$=P.vertexAttributes,V=$.position,z=$.uv0,{typedBuffer:B,typedBufferStride:k}=$.normalCompressed,Z=P.uvRange,W=Z[0],j=Z[1],Y=Z[2],M=Z[3],D=P.boundingBox,N=n[0],G=n[1],X=n[2],J=V.typedBuffer,ee=V.typedBufferStride;let ye=0;const Me=_e(d,v,w),ft=o?(Math.PI/2-2*Math.atan(Math.exp(-Me/T)))*T:Me*x,Rt=1/O,at=_e(d*(1-Rt)+m*Rt,v,w);let vt=ft,ze=o?(Math.PI/2-2*Math.atan(Math.exp(-at/T)))*T:at*x;for(let fe=1;fe<=C;fe++){const Tt=fe/O,bt=_e(d*(1-Tt)+m*Tt,v,w),Ce=_e(Tt,j,M),Be=ze,je=(fe-1)/O,mt=_e(d*(1-je)+m*je,v,w),ut=vt,dr=(fe+1)/O,He=_e(d*(1-dr)+m*dr,v,w),gt=o?(Math.PI/2-2*Math.atan(Math.exp(-He/T)))*T:He*x,pr=_e(dr,j,M);vt=ze,ze=gt;const nt=_e(h,y,_);let ht=nt*x,yt=Xi(nt,bt,s);const Nt=1/O,Ht=_e(Nt,W,Y),Si=_e(h*(1-Ht)+f*Ht,y,_);let Hr=Ht,yi=Si,Bt=Si*x,li=Xi(Si,bt,s);if(fe===1){const Vr=Bt-N,ti=vt-G,Mr=li-X,Ei=0*ee;J[Ei]=Vr,J[Ei+1]=ti,J[Ei+2]=Mr,gh(Vr,ti,Mr,D);const kr=_e(Nt,W,Y);Qd(z,ye,kr,Ce)}for(let Vr=1;Vr<=C;Vr++){const ti=Bt,Mr=li,Ei=(Vr+1)/O,kr=_e(Ei,W,Y),ci=_e(h*(1-Ei)+f*Ei,y,_),ri=yi;yi=ci;{const qi=ye+1,Vi=qi*ee;if(fe===1||Vr===C){const qr=ci*x,En=Xi(ci,bt,s);if(fe===1&&Vr<C){const xo=qr-N,da=Be-G,ne=En-X;J[Vi]=xo,J[Vi+1]=da,J[Vi+2]=ne,gh(xo,da,ne,D),Qd(z,qi,kr,Ce)}Bt=qr,li=En}else Bt=J[Vi]+N,li=J[Vi+2]+X}const fr=Bt,ui=li,Ui=ht,Wn=yt;ht=ti,yt=Mr;const Zn=(ye-C)*ee,Xn=fe===1?Xi(ri,mt,s):J[Zn+2]+X,Yn=Xi(ri,He,s);if(fe<C){const qi=ye+C,Vi=qi*ee,qr=ti-N,En=gt-G,xo=Yn-X;J[Vi]=qr,J[Vi+1]=En,J[Vi+2]=xo,gh(qr,En,xo,D);const da=Hr;Hr=kr,Qd(z,qi,da,pr)}{const qi=fr-Ui,Vi=ut-gt,qr=Vi*(ui-Wn),En=qi*(Xn-Yn),xo=-Vi*qi,da=qr*qr+En*En+xo*xo;if(da===0)nw(B,ye,0,0,1,k);else{const ne=1/Math.sqrt(da);nw(B,ye,qr*ne,En*ne,xo*ne,k)}}++ye}}}function lht(t,e){t.tile.intersectsClippingArea&&(nEe(t),sEe(t,!0),s6(t))}function cht(t,e){t.tile.intersectsClippingArea&&(iEe(t),s6(t))}function iEe(t,e){t.tile.intersectsClippingArea&&(nEe(t),sEe(t,!1))}function sEe(t,e){const r=t.geometryState,i=r.neighborData,s=t.tile,n=s.surface,o=s.extent,a=r.clippingArea,l=a??LY,c=o[0],h=o[2],d=o[1],f=o[3],m=[f>l[3],h>l[2],d<l[1],c<l[0]],y=t.geometry,_=s.horizontalScale,v=oEe(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,_),w=y.boundingBox,T=y.uvRange[0],x=y.uvRange[1],S=y.uvRange[2],O=y.uvRange[3],C=Math.max(c,l[0]),P=Math.min(h,l[2]),$=Math.max(d,l[1]),V=Math.min(f,l[3]),z=t.localOrigin,B=z[0],k=z[1],Z=z[2],W=r.samplerData;for(let j=0;j<4;++j){const Y=j===1||j===3,M=i.edgeResolutions[j];we(Bb(M));const D=M+1,N=m[j],G=Z1(s,i.edgePeerNeighbors[j]);if(!N&&hEe(s,G,j)){cEe(t,j,G);continue}const X=G!=null&&!N,J=G==null?void 0:G.renderData,ee=J==null?void 0:J.geometryState;if(sn&&(we(!X||G.level===s.level),we(!X||Sg(s,G)<=0),s&&!G&&!n.updatingRootTiles)){const nt=vf[j],ht=s.findNeighborTile(nt,yt=>yt.isLoaded||yt.isLeaf||yt.level===s.level);n.updatingRootTiles||(ht?ht.intersectsClippingArea&&(we(!ht.isLoaded),we(!ht.isLeaf),we(ht.level===s.level)):we((n==null?void 0:n.rootTiles)==null||!s.shouldHaveNeighbor(nt)))}const ye=_e(j===1?h:c,C,P),Me=_e(j===0?f:d,$,V),ft=ee==null?void 0:ee.samplerData,Rt=y.outerEdges[j],at=e&&D>3?D-3:1,vt=_e(j===1?1:0,T,S),ze=_e(j===0?1:0,x,O),fe=X?(nt,ht)=>.5*(Xi(nt,ht,ft)+Xi(nt,ht,W)):(nt,ht)=>Xi(nt,ht,W),Tt=(h-c)/M,bt=Y?j===1?Tt:-Tt:0,Ce=Y?0:j===0?Tt:-Tt,Be=-bt,je=-Ce;let mt=0,ut=0,dr=0;{const nt=0/M,ht=Y?ye:_e(c*(1-nt)+h*nt,C,P),yt=Y?_e(d*(1-nt)+f*nt,$,V):Me,Nt=fe(ht,yt);mt=ht*_,ut=v(yt),dr=Nt}let He=0,gt=0,pr=0;{const nt=1/M,ht=Y?ye:_e(c*(1-nt)+h*nt,C,P),yt=Y?_e(d*(1-nt)+f*nt,$,V):Me,Nt=fe(ht,yt);He=ht*_,gt=v(yt),pr=Nt}for(let nt=1;nt<D-1;nt+=at){const ht=nt/M,yt=He,Nt=gt,Ht=pr;{const kr=Y?vt:_e(ht,T,S),ci=Y?_e(ht,x,O):ze,ri=yt-B,fr=Nt-k,ui=Ht-Z;gh(yt,fr,ui,w),Rt.setVertexFromValuesRawPositionUV(nt,ri,fr,ui,kr,ci)}{const kr=(nt+1)/M,ci=Y?ye:_e(c*(1-kr)+h*kr,C,P),ri=Y?_e(d*(1-kr)+f*kr,$,V):Me,fr=fe(ci,ri);He=ci*_,gt=v(ri),pr=fr}const Si=He,Hr=pr,yi=mt,Bt=ut,li=dr;mt=yt,ut=Nt,dr=Ht;let Vr=0,ti=0,Mr=0;if(Y){const kr=gt-Nt,ci=Hr-Ht,ri=Bt-Nt,fr=li-Ht,ui=_e(d*(1-ht)+f*ht,$,V),Ui=ye+Be,Wn=Ui*_-yt,Zn=Xi(Ui,ui,W)-Ht,Xn=j===3?-1:1;if(Vr=Xn*(-ri+kr)*Zn,ti=Xn*Wn*(-fr+ci),Mr=-Xn*Wn*(-ri+kr),X){const Yn=ye+bt,qi=Yn*_-yt;Vr=(-ri+kr)*(Zn-(Xi(Yn,ui,ft)-Ht)),ti=(Wn-qi)*(-fr+ci),Mr=-(Wn-qi)*(-ri+kr)}}else{const kr=Si-yt,ci=Hr-Ht,ri=yi-yt,fr=li-Ht,ui=_e(c*(1-ht)+h*ht,C,P),Ui=Me+je,Wn=Xi(ui,Ui,W)-Ht,Zn=v(Ui)-Nt,Xn=j===2?-1:1;if(Vr=Xn*Zn*(-fr+ci),ti=Xn*(-ri+kr)*Wn,Mr=-Xn*Zn*(-ri+kr),X){const Yn=ui,qi=Me+Ce,Vi=v(qi)-Nt;Vr=(-Zn+Vi)*(-fr+ci),ti=(-ri+kr)*(-Wn+(Xi(Yn,qi,ft)-Ht)),Mr=-(-Zn+Vi)*(-ri+kr)}}const Ei=1/Math.sqrt(Vr*Vr+ti*ti+Mr*Mr);Rt.setNormalFromValues(nt,Vr*Ei,ti*Ei,Mr*Ei)}}}function nEe(t,e){uEe(t)}function uht(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function hht(t,e){return t*e}function oEe(t,e,r){return t?i=>uht(i,e):i=>hht(i,r)}function aEe(t,e,r,i,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=vf.map((x,S)=>S===0&&s[1]<e-2||S===1&&i[1]<e-2||S===2&&s[0]>1||S===3&&i[0]>1),h=t.outerEdges.reduce((x,S,O)=>x+(c[O]?0:o-2+S.count-1),0),d=r.reduce((x,S)=>x+o*(2*(S.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+d)*f,y=a>=Kut?new Uint32Array(m):new Uint16Array(m);let _=0;const v=e-2,w=o-2;we(w>=0);const T=(x,S,O,C,P,$)=>{const V=x*P,z=$[V],B=$[V+1],k=$[V+2],Z=S*P,W=$[Z],j=$[Z+1],Y=$[Z+2],M=O*P,D=$[M],N=$[M+1],G=$[M+2],X=C*P,J=$[X],ee=$[X+1],ye=$[X+2];return(W-J)*(W-J)+(j-ee)*(j-ee)+(Y-ye)*(Y-ye)>(z-D)*(z-D)+(B-N)*(B-N)+(k-G)*(k-G)};if(n){const x=(O,C,P)=>{y[_++]=O,y[_++]=C,y[_++]=C,y[_++]=P,y[_++]=P,y[_++]=O,sn&&(we(O<a),we(C<a),we(P<a),we(_<=m))};(()=>{for(let O=Math.max(s[0],1)-1;O<Math.min(s[1],e-2)-1;++O){const C=O*v;for(let P=Math.max(i[0],1)-1;P<Math.min(i[1],e-2)-1;++P){const $=O*v+P,V=$+1,z=V+v,B=z-1,k=C+P,Z=k+1,W=Z+v,j=W-1,Y=t.vertexAttributes.position.typedBuffer,M=t.vertexAttributes.position.typedBufferStride;T(k,Z,W,j,M,Y)?(x($,V,z),x(z,B,$)):(x($,V,B),x(B,z,V))}}})(),we(_===3*l*f),(()=>{for(let O=0;O<4;++O){const C=_;if(c[O])continue;const P=t.outerEdges[O],$=t.innerEdges[O];let V=0,z=0;const B=P.count,k=$.count;we(k===o-1);let Z=0;const W=O===1||O===2?(j,Y,M)=>x(j,Y,M):(j,Y,M)=>x(j,M,Y);for(;V<B-1||z<k-1;){const j=$.getVertexIndex(z),Y=P.getVertexIndex(V),M=V<B-1,D=z<k-1;M&&(!D||(M?0+o*(V+.5)/(B-1):0)<=(D?1+w*(z+.5)/(k-1):0))?(++V,sn&&we(V<B),W(j,Y,P.getVertexIndex(V)),Z++):(++z,sn&&we(z<k),W(j,Y,$.getVertexIndex(z)),Z++)}sn&&(we(V===B-1),we(z===k-1),we(Z===B+k-2),we(Z===o-2+P.count-1),we(_===C+3*Z*f))}})(),we(_===3*(l+h)*f);const S=O=>{const C=t.outerEdges[O.connectedOuterEdgeOffset];let P=C.getVertexIndex(0),$=C.stride;for(let V=0;V<O.latitudeResolution;++V){const z=V===0?O.rowOffset:P+e;for(let B=0;B<o;B++)x(P,P+1,z+B),V<O.latitudeResolution-1&&x(P+1,z+B+1,z+B),P+=$;P=z,$=1}};r.forEach(S)}else{(()=>{const S=Math.max(s[0],1)-1,O=Math.min(s[1],e-2)-1,C=Math.max(i[0],1)-1,P=Math.min(i[1],e-2)-1;for(let $=S;$<O;++$){const V=$*v;for(let z=C;z<P;++z){const B=V+z,k=B+1,Z=k+v,W=Z-1,j=t.vertexAttributes.position.typedBuffer,Y=t.vertexAttributes.position.typedBufferStride;T(B,k,Z,W,Y,j)?(y[_]=B,y[_+1]=k,y[_+2]=Z,y[_+3]=Z,y[_+4]=W,y[_+5]=B):(y[_]=B,y[_+1]=k,y[_+2]=W,y[_+3]=W,y[_+4]=k,y[_+5]=Z),_+=6}}})(),we(_===3*l*f),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const O=t.outerEdges[S],C=t.innerEdges[S];let P=0,$=0;const V=O.count,z=C.count;we(z===o-1);const B=S===1||S===2,k=B?1:2,Z=B?2:1,W=O.index0,j=O.stride,Y=C.index0,M=C.stride;for(;P<V-1||$<z-1;){const D=Y+$*M,N=W+P*j,G=P<V-1,X=$<z-1,J=G&&(!X||(G?0+o*(P+.5)/(V-1):0)<=(X?1+w*($+.5)/(z-1):0));J?++P:++$;const ee=J?N+j:D+M;y[_]=D,y[_+k]=N,y[_+Z]=ee,_+=3}}})(),we(_===3*(l+h)*f);const x=S=>{const O=t.outerEdges[S.connectedOuterEdgeOffset];let C=O.getVertexIndex(0),P=O.stride;for(let $=0;$<S.latitudeResolution;++$){const V=$===0?S.rowOffset:C+e;for(let z=0;z<o;z++){const B=V+z;y[_]=C,y[_+1]=C+1,y[_+2]=B,$<S.latitudeResolution-1?(y[_+3]=C+1,y[_+4]=B+1,y[_+5]=B,_+=6):_+=3,C+=P}C=V,P=1}};r.forEach(x)}we(_===m),t.indices=y,t.indexCount=m}function lEe(t,e){const r=t.localOrigin,i=t.geometry,s=t.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),d=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new foe(o,r,h,d,n)}{const c=a,h=s[l]+1;i.outerEdges[l]=new foe(o,r,c,1,h),a+=h}}}function cEe(t,e,r){const i=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];we(Bb(c));const h=c+1,d=t.geometry,f=d.boundingBox,m=d.outerEdges[e],y=d.uvRange[0],_=d.uvRange[1],v=d.uvRange[2],w=d.uvRange[3],T=_e(e===1?1:0,y,v),x=_e(e===0?1:0,_,w),S=r.renderData,O=S.geometryState,C=S.geometry.outerEdges[i],P=n.getNeighborEdgeStartVertexIndex(e,r)*c,$=c*2**a;we(O.neighborData.edgeResolutions[i]===$),we(C.count-1===$);const V=S.localOrigin[0]-t.localOrigin[0],z=S.localOrigin[1]-t.localOrigin[1],B=S.localOrigin[2]-t.localOrigin[2],k=m.attributes,Z=m.index0,W=m.stride,j=k.position.typedBuffer,Y=k.position.typedBufferStride,M=k.normalCompressed.typedBuffer,D=k.normalCompressed.typedBufferStride,N=k.uv0,G=C.attributes,X=C.index0,J=C.stride,ee=G.position.typedBuffer,ye=G.position.typedBufferStride,Me=G.normalCompressed.typedBuffer,ft=G.normalCompressed.typedBufferStride;for(let Rt=1;Rt<h-1;++Rt){const at=Z+W*Rt,vt=X+J*(P+Rt),ze=at*Y,fe=vt*ye,Tt=ee[fe]+V,bt=ee[fe+1]+z,Ce=ee[fe+2]+B;j[ze]=Tt,j[ze+1]=bt,j[ze+2]=Ce,gh(Tt,bt,Ce,f);const Be=at*D,je=vt*ft;M[Be]=Me[je],M[Be+1]=Me[je+1];const mt=Rt/c,ut=l?T:_e(mt,y,v),dr=l?_e(mt,_,w):x;Qd(N,at,ut,dr)}}function uEe(t){var ze;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,s=r.cornerNeighborData,n=t.geometry,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=((ze=t.tile.surface.view)==null?void 0:ze.viewingMode)==="local",h=l.ellipsoid.radius,d=l.extentInRadians,f=l.horizontalScale;let m=0,y=0,_=0;const v=(fe,Tt,bt)=>{const Ce=d[Tt===0?1:3],Be=d[fe===0?0:2],je=Math.cos(Ce),mt=Math.sin(Ce),ut=Math.sin(Be),dr=Math.cos(Be),He=h+bt;m=dr*je*He,y=ut*je*He,_=mt*He},w=c?(()=>{const fe=t.geometryState.clippingArea,Tt=l.extent,bt=fe!=null&&(Tt[3]>fe[3]||Tt[2]>fe[2]||Tt[1]<fe[1]||Tt[0]<fe[0]),Ce=oEe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Be,je,mt)=>{const ut=Be===0?Z[0]:Z[2],dr=je===0?Z[1]:Z[3],He=bt?_e(ut,fe[0],fe[2]):ut,gt=bt?_e(dr,fe[1],fe[3]):dr,pr=mt;m=He*f,y=Ce(gt),_=pr}})():v;let T=0,x=0,S=0,O=0,C=0,P=0,$=0,V=0,z=0;const B=c&&t.tile.surface.isWebMercatorOnPlateeCarree,k=(fe,Tt,bt,Ce,Be)=>{let je=0,mt=0,ut=0;if(c){const dr=Tt*f,He=B?(Math.PI/2-2*Math.atan(Math.exp(-bt/h)))*h:bt*f;je=dr-m,mt=He-y,ut=Ce-_}else{const dr=$Y(fe),He=fe.tile,gt=He.extent,pr=He.extentInRadians,nt=(Tt-gt[0])/(gt[2]-gt[0]),ht=(bt-gt[1])/(gt[3]-gt[1]),yt=pr[0]*(1-nt)+pr[2]*nt,Nt=dr(ht),Ht=Math.cos(Nt),Si=Math.sin(Nt),Hr=Math.sin(yt),yi=Math.cos(yt),Bt=h+Ce;je=yi*Ht*Bt-m,mt=Hr*Ht*Bt-y,ut=Si*Bt-_}switch(Be){case 0:$+=je,V+=mt,z+=ut;break;case 1:O-=je,C-=mt,P-=ut;break;case 2:$-=je,V-=mt,z-=ut;break;case 3:O+=je,C+=mt,P+=ut}},Z=l.extent,W=e.clippingArea,j=W??LY,Y=Z[0],M=Z[2],D=Z[1],N=Z[3],G=[N>j[3],M>j[2],D<j[1],Y<j[0]],X=Math.max(Y,j[0]),J=Math.min(M,j[2]),ee=Math.max(D,j[1]),ye=Math.min(N,j[3]),Me=n.uvRange[0],ft=n.uvRange[1],Rt=n.uvRange[2],at=n.uvRange[3],vt=fe=>{var dr;const Tt=s[fe].cornerTiles;T=0,x=0,S=1,O=0,C=0,P=0,$=0,V=0,z=0;let bt=1/0;for(let He=0;He<4;++He)bt=Math.min(bt,((dr=Tt[He])==null?void 0:dr.level)??1/0);for(let He=0;He<4;++He){const gt=Tt[He];mC[He]=(gt==null?void 0:gt.level)===bt?gt:null}let Ce=1,Be=0;for(let He=0;He<4;++He){const gt=mC[He];gt&&(Ce=Math.max(Ce,gt==null?void 0:gt.renderData.geometryState.numVerticesPerSide),Be=gt.extent[2]-gt.extent[0])}const je=Be,mt=Ce;we(mt>1);const ut=je/mt;for(let He=0;He<4;++He){const gt=mC[(He+3)%4],pr=mC[He%4];if(!gt&&!pr)continue;const nt=He===0?1:He===1?2:He===2?3:0,ht=He===0?2:He===1?3:He===2?0:1;if(gt&&pr){const yt=T9[He][0]*ut,Nt=T9[He][1]*ut,Ht=gt.extent,Si=Ht[nt===0||nt===1?2:0]+yt,Hr=Ht[nt===0||nt===3?3:1]+Nt,yi=pr.extent,Bt=yi[ht===0||ht===1?2:0]+yt,li=yi[ht===0||ht===3?3:1]+Nt,Vr=gt.renderData,ti=pr.renderData,Mr=Xi(Si,Hr,Vr.geometryState.samplerData),Ei=Xi(Bt,li,ti.geometryState.samplerData);k(Vr,Si,Hr,.5*(Mr+Ei),He)}else{const yt=gt??pr,Nt=gt?nt:ht,Ht=yt.extent,Si=T9[He],Hr=Ht[Nt===0||Nt===1?2:0]+Si[0]*ut,yi=Ht[Nt===0||Nt===3?3:1]+Si[1]*ut,Bt=yt.renderData,li=Xi(Hr,yi,Bt.geometryState.samplerData);k(Bt,Hr,yi,li,He)}}if(!c){const He=Math.sqrt(m*m+y*y+_*_);T=m/He,x=y/He,S=_/He}if(c||S*S<.999){const He=Math.sqrt(O*O+C*C+P*P);O/=He,C/=He,P/=He;const gt=Math.sqrt($*$+V*V+z*z);$/=gt,V/=gt,z/=gt,T=P*V-C*z,x=O*z-P*$,S=C*$-O*V;const pr=1/Math.sqrt(T*T+x*x+S*S);T*=pr,x*=pr,S*=pr}};for(let fe=0;fe<4;++fe){const Tt=fe,bt=(fe+1)%4,Ce=fe===0||fe===1?1:0,Be=fe===0||fe===3?1:0,je=_e(Ce,Me,Rt),mt=_e(Be,ft,at),ut=o[Tt],dr=fe===0||fe===3?ut.count-1:0,He=o[bt],gt=fe===0||fe===1?He.count-1:0,pr=s[fe].cornerTiles;let nt=-1;for(let Nt=0;Nt<4;++Nt){const Ht=pr[Nt];Ht&&(nt===-1||Sg(pr[nt],Ht)>0)&&(nt=Nt)}const ht=nt,yt=pr[ht];if(yt!==l){const Nt=l.level-yt.level,Ht=2**Nt,Si=[yt.lij[0]+Nt,yt.lij[1]*Ht,yt.lij[2]*Ht],Hr=[Si[1]+Ht===l.lij[1],fe===0&&(ht===1||ht===0&&yt!==pr[3])||fe===1&&(ht===0||ht===1&&yt!==pr[2]),Si[1]===l.lij[1]+1,fe===2&&(ht===3||ht===2&&yt!==pr[1])||fe===3&&(ht===2||ht===3&&yt!==pr[0])],yi=Hr.reduce((Mr,Ei)=>Mr+(Ei?1:0),0);we(yi===1||yi===2);let Bt=-1,li=-1;const Vr=yt.renderData;if(yi===1){const Mr=Hr.findIndex(kr=>kr);we(0<=Mr&&Mr<=3),Bt=(Mr+2)%4;const Ei=t.geometryState.neighborData.edgeResolutions[Mr];li=l.getNeighborEdgeStartVertexIndex(Mr,yt)*Ei+Ei*(Mr===0&&fe===0||Mr===1&&fe===0||Mr===2&&fe===1||Mr===3&&fe===3?1:0)}else{we(Hr[1]||Hr[3]),Bt=Hr[1]?3:1;const Mr=Vr.geometryState.neighborData.edgeResolutions[Bt];li=fe===0||fe===3?0:Mr}const ti=Vr.geometry.outerEdges[Bt];{const Mr=ut.index0+dr*ut.stride,Ei=He.index0+gt*He.stride,kr=ti.index0+li*ti.stride;{const ci=ti.attributes.position,ri=ci.typedBuffer,fr=kr*ci.typedBufferStride,ui=t.localOrigin,Ui=ti.localOrigin,Wn=ri[fr]+Ui[0]-ui[0],Zn=ri[fr+1]+Ui[1]-ui[1],Xn=ri[fr+2]+Ui[2]-ui[2];gh(Wn,Zn,Xn,a);{const Yn=ut.attributes.position,qi=Yn.typedBuffer,Vi=Mr*Yn.typedBufferStride;qi[Vi]=Wn,qi[Vi+1]=Zn,qi[Vi+2]=Xn}{const Yn=He.attributes.position,qi=Yn.typedBuffer,Vi=Ei*Yn.typedBufferStride;qi[Vi]=Wn,qi[Vi+1]=Zn,qi[Vi+2]=Xn}}Qd(ut.attributes.uv0,Mr,je,mt),Qd(He.attributes.uv0,Ei,je,mt);{const ci=ti.attributes.normalCompressed.typedBuffer,ri=kr*ti.attributes.normalCompressed.typedBufferStride;{const fr=ut.attributes.normalCompressed,ui=fr.typedBuffer,Ui=Mr*fr.typedBufferStride;ui[Ui]=ci[ri],ui[Ui+1]=ci[ri+1]}{const fr=He.attributes.normalCompressed,ui=fr.typedBuffer,Ui=Ei*fr.typedBufferStride;ui[Ui]=ci[ri],ui[Ui+1]=ci[ri+1]}}}}else{const Nt=G[Tt],Ht=G[bt];let Si;if(Nt||Ht){const li=_e(Y*(1-Ce)+M*Ce,X,J),Vr=_e(D*(1-Be)+N*Be,ee,ye),ti=e.samplerData;Si=Xi(li,Vr,ti)}else Si=dht(pr);w(Ce,Be,Si),vt(fe);const Hr=m-i[0],yi=y-i[1],Bt=_-i[2];gh(Hr,yi,Bt,a),ut.setVertexFromValuesRawPositionUVNormal(dr,Hr,yi,Bt,je,mt,T,x,S),He.setVertexFromValuesRawPositionUVNormal(gt,Hr,yi,Bt,je,mt,T,x,S)}}for(let fe=0;fe<4;++fe)mC[fe]=null}function dht(t){var n,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);sn&&(we(!t[0]||!t[2]||RG(t[0],t[2],it.SOUTH_WEST)),we(!t[1]||!t[3]||RG(t[1],t[3],it.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,h=a===0||a===3,d=l.extent,f=d[c?0:2],m=d[h?1:3],y=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;i+=Xi(f,m,y),r++}}const s=r?i/r:0;return we(s!=null),s}function s6(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const T9=[[0,1],[1,0],[0,-1],[-1,0]],ao=new Qct,LY=Lq(-1/0,-1/0,1/0,1/0),mC=[null,null,null,null];function hEe(t,e,r){if(!e)return!1;const i=Sg(t,e);return i>0||i===0&&r>=2}let pht=class extends RY{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=kt(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=s!=null&&hO(s)&&n!=null&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Ae(c[0],c[1],0);js(h,Ge.WebMercator,h,Ge.PlateCarree);const d=Ae(c[2],c[3],0);js(d,Ge.WebMercator,d,Ge.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=d[0],l[3]=d[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Fs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let h=0;h<6;h++){const d=e[h],f=d[0],m=d[1],y=d[2],_=d[3];if(f*(f>0?i:o)+m*(m>0?s:a)+y*(y>0?n:l)+_>=0)return Ko.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?s:a)+y*(y<0?n:l)+_<=0}return c?Ko.INSIDE:Ko.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return B5e(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,s){return MI[0]=1/r[0],MI[1]=1/r[1],MI[2]=1/r[2],lX(this._aabb(),e,MI,i,s)}createGeometry(){oht(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){lht(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){cht(this.renderData,this._horizontalScaleFactor)}};const MI=A();let fht=class{constructor(){this.extent=Yt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},FL=class extends xe{constructor(){super(...arguments),this._queries=new Gt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Gt({initialSize:30}),this._queryPool=new Uo(fht)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();ch(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([p()],FL.prototype,"updating",null),FL=u([R("esri.views.3d.terrain.ScaleRangeQueries")],FL);let mht=class extends RY{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=_s(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=xt(o,l,.5),d=xt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),Xge(this.centerAtSeaLevel,d,h,this.ellipsoid.radius),ge(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[Fs.MIDDLE],0,0,0),se(e[Fs.TOP],0,0,0),se(e[Fs.BOTTOM],0,0,0),e[Fs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Fs.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,ght(r,i,3*n));e[Fs.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!t_(e,this._boundingSphere))return Ko.OUTSIDE;if(this.lij[0]<10)return Ko.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<rE;n++){const o=n===pi.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],d=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*r[y]+c*r[y+1]+h*r[y+2]+d<0){if(f=!0,!s)break}else s=!1}if(!f)return Ko.OUTSIDE}return s?Ko.INSIDE:Ko.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){eht(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),sn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)se(r,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];Lv(Ooe,a,l,s),Lv(Roe,a,c,s),le(r,Ooe,Roe);const h=.5*(i[0]+i[1]);ie(r,r,(s+h)/Jl(r));const d=this.convexHull;let f=0;const m=(_,v)=>{const w=_[0]-d[3*v],T=_[1]-d[3*v+1],x=_[2]-d[3*v+2];return Math.sqrt(w*w+T*T+x*x)};for(let _=0;_<8;++_){const v=m(r,_);f=Math.max(f,v)}const y=f;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===th.HAS_NORTH_POLE,a=n&&s===th.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],d=e[2],f=a?-c:e[1],m=o?c:e[3],y=.5*(h+d),_=i[0],v=r+(l?Math.min(0,_-1):_),w=(Y,M,D)=>Lv(Y,M,D,v),T=A(),x=A(),S=A(),O=A();w(T,h,f),w(x,h,m),w(S,d,m),w(O,d,f);const C=(Y,M)=>{for(let D=0;D<3;++D)this._convexHull[3*M+D]=Y[D]};C(T,0),C(x,1),C(S,2),C(O,3);const P=i[1],$=r+(l?Math.max(0,P+1):P),V=A(),z=A(),B=A();Lv(z,y,m,v),Lv(B,y,f,v),le(V,z,B),ge(V,V);const k=A(),Z=A(),W=(Y,M)=>{bn(Z,Y,M),ge(Z,Z);const D=-me(Y,k)/me(Z,k);we(D>=0),ie(Z,Z,D),le(Y,Y,Z)};if(2**this.lij[0]>2*this.lij[1]){const Y=B,M=A();ot(M,Aoe,Y),ge(M,M),ot(k,Y,M),ge(k,k),we(ih(me(k,Y)/Jl(Y),0)),W(T,x),W(O,S),C(T,0),C(O,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Y=z,M=A();ot(M,Aoe,Y),ge(M,M),ot(k,M,Y),ge(k,k),W(x,T),W(S,O),C(x,1),C(S,2)}const j=(Y,M)=>{const D=$/me(M,V);for(let N=0;N<3;++N)this._convexHull[3*Y+N]=M[N]*D};j(4,T),j(5,x),j(6,S),j(7,O)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?th.HAS_BOTH_POLES:th.HAS_NORTH_POLE:i?th.HAS_SOUTH_POLE:th.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],d=(l*r[0]+c*r[1]+h*r[2])/a,f=r[0]*d-l,m=r[1]*d-c,y=r[2]*d-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<Coe.length?Coe[this.level]+1:2}updateCornerElevations(){iht(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){rht(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var bt;if(!sn||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=A(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[Fs.MIDDLE][3],d=this.convexHull,f=(Ce,Be)=>{for(let je=0;je<3;++je)Ce[je]=d[3*Be+je]};{const Ce=A(),Be=A(),je=A(),mt=A(),ut=A(),dr=(He,gt,pr,nt)=>{f(Be,He),f(je,gt),f(mt,pr),bn(Be,Be,je),bn(mt,mt,je),ot(Ce,Be,mt),ge(Ce,Ce);const ht=me(Ce,je);f(ut,nt);const yt=me(Ce,ut),Nt=Math.abs(yt-ht);we(ih(Nt,0),`Non coplanar ${He},${gt},${pr},${nt} diff = ${Nt}`)};dr(0,1,2,3),dr(4,5,6,7),dr(0,1,4,5),dr(1,2,5,6),dr(2,3,6,7),dr(3,0,7,4)}const m=zo(24),y=(Ce,Be,je)=>{const mt=4*Ce;for(let ut=0;ut<3;++ut)m[mt+ut]=Be[ut];m[mt+3]=je},_=A(),v=A(),w=A(),T=A(),x=(Ce,Be,je,mt)=>{f(_,Be),f(v,je),f(w,mt),bn(_,_,v),ge(_,_),bn(w,w,v),ge(w,w),ot(T,_,w),ge(T,T);const ut=me(T,v);y(Ce,T,ut)};x(0,0,1,2),x(1,1,0,4),x(2,1,5,2),x(3,3,2,6),x(4,4,0,3),x(5,4,6,5);const S=1,O=(Ce,Be,je,mt)=>{const ut=4*Ce;return m[ut]*Be+m[ut+1]*je+m[ut+2]*mt-m[ut+3]},C=(Ce,Be,je,mt)=>O(Ce,Be,je,mt)>=-S,P=(Ce,Be)=>C(Ce,Be[0],Be[1],Be[2]),$=2**this.lij[0]>2*this.lij[1],V=(Ce,Be,je)=>Math.sqrt(dEe(Ce,Be,je,i[0],i[1],i[2]))<r,z=Ce=>V(Ce[0],Ce[1],Ce[2]),B=(Ce,Be)=>V(Ce[Be],Ce[Be+1],Ce[Be+2]),k=this.extentInRadians,Z=.5*(k[0]+k[2]),W=k[1],j=k[3],Y=A(),M=A();Lv(Y,Z,j,a),Lv(M,Z,W,a);const D=$?"Upper":"Lower";let N=!0;for(let Ce=0;Ce<6;++Ce){for(let Be=0;Be<8;++Be){const je=3*Be,mt=C(Ce,d[je],d[je+1],d[je+2]);N&&(N=mt),we(mt,`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${Ce}`)}we(P(Ce,M),`Tile[${this.lij}] (${D}) bottom mid outside of plane ${Ce}`),we(P(Ce,Y),`Tile[${this.lij}] (${D}) top mid outside of plane ${Ce}`)}we(N,"Not all convex hull points are inside  convex hull polyhedron"),we(z(M),`Tile[${this.lij}] (${D}) bottom mid outside of bounding sphere`),we(z(Y),`Tile[${this.lij}] (${D}) top mid outside of bounding sphere`);for(let Ce=0;Ce<8;++Ce){const Be=B(d,3*Ce);we(Be,`Tile[${this.lij}] Convex hull point ${Ce} outside of bounding sphere`)}for(let Ce=0;Ce<6;++Ce)for(let Be=0;Be<8;++Be){const je=3*Be;C(Ce,d[je],d[je+1],d[je+2])||console.error(`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${Ce}`)}const G=this.extentInRadians,X=Math.max(G[2]-G[0],G[3]-G[1]),J=Math.round(X*n),ee=this.renderData;if(!ee)return;const{geometry:ye,localOrigin:Me}=ee,ft=(bt=ye.vertexAttributes)==null?void 0:bt.position;if(!ft)return;const Rt=ft.count,at=A(),vt=ye.numVerticesPerSide-2,ze=vt*vt,fe=ee.geometryState.neighborData,Tt=fe.edgeResolutions.reduce((Ce,Be)=>Ce+Be+1,0);for(let Ce=0;Ce<Rt;++Ce){const Be=Ce<ze,je=!Be&&Ce<ze+Tt;let mt=!1,ut=-1;if(je){let Bt=ze;for(let li=0;li<4;++li){const Vr=fe.edgeResolutions[li];if(Ce===Bt||Ce===Bt+Vr-1){mt=!0;break}if(Bt+=Vr,Ce<Bt){ut=li;break}}}const dr=je?fe.edgePeerNeighbors[ut]:null,He=je&&dr&&Sg(this,dr)>0;ft.getVec(Ce,s),le(at,s,Me);const gt=Jl(at)-n;let pr=0,nt=!1;const ht=o[0]-gt,yt=gt-o[1],Nt=ht>l,Ht=yt>l,Si=Nt||Ht,Hr=()=>{const Bt=Be?"internal":je&&!mt?"edge":mt?"corner":"pole";return`Tile[${this.lij}].vertex[${Ce}]:${Bt}`+(Nt?"(below)":Ht?"(above)":"")+(He?"(Neighbor)":"")},yi=gR(at,i);if(yi>=r+c){const Bt=yi-r;Si||(console.error(`${Hr()} is out of the bounding sphere by ${Bt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${gt.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Bt/r).toFixed(0)})`),nt=!0)}for(let Bt=0;Bt<6;++Bt)if(!C(Bt,at[0],at[1],at[2])){const li=O(Bt,at[0],at[1],at[2]),Vr=Ce%vt,ti=(Ce-Vr)/vt;Bt===0&&ht||Bt===5&&yt||(console.error(`${Hr()} (${Vr},${ti})|${vt}] is out of the bounding trapezoid plane ${Bt} h=${Math.round(gt)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(li)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${J}`),++pr)}if(nt||pr>0)break}}};const Coe=[128,64,64,32,16,8,8,4];function ght(t,e,r){return dEe(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function dEe(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const Lv=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},Aoe=[0,0,1],Ooe=A(),Roe=A();let hd=class extends xe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([p()],hd.prototype,"fovX",void 0),u([p()],hd.prototype,"fovY",void 0),u([p()],hd.prototype,"relativeWidthLimit",void 0),u([p()],hd.prototype,"relativeHeightLimit",void 0),u([p()],hd.prototype,"maxLod",void 0),u([p()],hd.prototype,"angledSplitBias",void 0),u([p()],hd.prototype,"aboveGround",void 0),u([p()],hd.prototype,"frustum",void 0),hd=u([R("esri.views.3d.terrain.SplitLimits")],hd);let pEe=class extends ha{constructor(){super(...arguments),this.blendMode=Re.Normal}};u([F({count:Re.COUNT})],pEe.prototype,"blendMode",void 0);let YA=class extends pEe{constructor(){super(...arguments),this.output=yn.Composite,this.baseOpacityMode=jd.NotRequired,this.premultipliedSource=Od.Off}};u([F({count:yn.COUNT})],YA.prototype,"output",void 0),u([F({count:jd.COUNT})],YA.prototype,"baseOpacityMode",void 0),u([F()],YA.prototype,"premultipliedSource",void 0);var cw;function yht(t){const e=new wr;if(e.include(qSe),t.background===cw.Only){const r=t.output===yn.ColorComposite;return r?e.fragment.uniforms.add(new zt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(OY),e.fragment.code.add(b`
    void main() {
      fragColor = vec4(${r?b`backgroundColor`:b`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(WSe,t),e.fragment.uniforms.add(new Je("tex",r=>r.texture)),e.fragment.uniforms.add(new Oe("opacity",r=>r.opacity)),e.fragment.code.add(b`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(cw||(cw={}));const _ht=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return cw},build:yht},Symbol.toStringTag,{value:"Module"}));let vht=class extends HSe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Ba}},fEe=class mEe extends Pr{initializeProgram(e){return new Cr(e.rctx,mEe.shader.get().build(this.configuration),br)}initializePipeline(){return Ot({blending:wc(be.ONE,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt})}};fEe.shader=new Er(_ht,()=>ae(()=>import("./BlendLayers.glsl-07adf4f7.js"),[]));let gEe=class extends YA{constructor(){super(...arguments),this.background=cw.BelowLayer}};u([F()],gEe.prototype,"background",void 0);let S9=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Ft(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ae(s,n,o)}destroy(){this.texture.release()}};function bht(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function wht(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function xht(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function yEe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function Tht(t){return t[0]*t[3]-t[1]*t[2]}function _Ee(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1],d=r[2],f=r[3],m=r[4],y=r[5];return t[0]=i*c+n*h,t[1]=s*c+o*h,t[2]=i*d+n*f,t[3]=s*d+o*f,t[4]=i*m+n*y+a,t[5]=s*m+o*y+l,t}function DY(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*c,t[1]=s*h+o*c,t[2]=i*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function vEe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function NY(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*h+a,t[5]=s*c+o*h+l,t}function Sht(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function Eht(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function FY(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Cht(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Aht(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Oht(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function bEe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Rht(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function Pht(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function Mht(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Iht(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],d=e[3],f=e[4],m=e[5],y=Xa();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=y*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-d)<=y*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const $ht=_Ee,Lht=bEe;Object.freeze(Object.defineProperty({__proto__:null,add:Oht,copy:bht,determinant:Tht,equals:Iht,exactEquals:Mht,frob:Aht,fromRotation:Sht,fromScaling:Eht,fromTranslation:FY,identity:wht,invert:yEe,mul:$ht,multiply:_Ee,multiplyScalar:Rht,multiplyScalarAndAdd:Pht,rotate:DY,scale:vEe,set:xht,str:Cht,sub:Lht,subtract:bEe,translate:NY},Symbol.toStringTag,{value:"Module"}));function wEe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Dht(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Nht(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function Fht(t,e){return new Float32Array(t,e,6)}function xEe(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function Uht(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)xEe(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Dht,create:wEe,createView:Fht,fromValues:Nht,transform:xEe,transformMany:Uht},Symbol.toStringTag,{value:"Module"}));function UL(){return[1,0,0,1,0,0]}function Vht(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function zht(t,e,r,i,s,n){return[t,e,r,i,s,n]}function kht(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Vht,create:UL,createView:kht,fromValues:zht},Symbol.toStringTag,{value:"Module"}));function Bht(t){return t instanceof Float32Array&&t.length>=2}function Ght(t){return Array.isArray(t)&&t.length>=2}function E9(t){return Bht(t)||Ght(t)}const jht=96,Hht=39.37;function UY(t,e){return e.type?nr(t,e.x,e.y):cn(t,e)}function qht(t){return Za(t)}function Wht(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const Zht=function(){const t=Ue();return function(e,r,i){const s=r.targetGeometry;UY(t,s);const n=.5*n6(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function n6(t){return t.scale*Xht(t.targetGeometry)}function Xht(t){return t!=null&&sa(t.spatialReference)?1/(qht(t.spatialReference)*Hht*jht):1}function Yht(t){return n5(t.rotation)||0}const VY=function(){const t=Ue(),e=Ue(),r=Ue();return function(i,s,n,o,a,l){return KW(t,s),oc(e,n,.5*l),nr(r,1/o*l,-1/o*l),FY(i,e),a&&DY(i,i,a),vEe(i,i,r),NY(i,i,t),i}}(),Jht=function(){const t=Ue();return function(e,r,i,s){const n=n6(r),o=Yht(r);return UY(t,r.targetGeometry),VY(e,t,i,n,o,s)}}(),Qht=function(){const t=Ue();return function(e,r,i,s){const n=n6(r);return UY(t,r.targetGeometry),VY(e,t,i,n,0,s)}}();function Kht(t){const e=db(t);return e?e.valid[1]-e.valid[0]:0}function edt(t,e){return Math.round(Kht(t)/e)}var MG;const wm=[0,0];let f0=MG=class extends de{constructor(t){super(t),this._viewpoint2D={center:Ue(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new _r,this.id=0,this.inverseTransform=UL(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=UL(),this.transformNoRotation=UL(),this.displayMat3=Sl(),this.displayViewMat3=Sl(),this.viewMat3=Sl(),this.viewMat2d=wEe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=Wht(r,t.viewpoint),this._set("size",cn(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new MG({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return E9(e)?n1(t,e,this.inverseTransform):(wm[0]=e,wm[1]=r,n1(t,wm,this.inverseTransform))}toScreen(t,e,r){return E9(e)?n1(t,e,this.transform):(wm[0]=e,wm[1]=r,n1(t,wm,this.transform))}toScreenNoRotation(t,e,r){return E9(e)?n1(t,e,this.transformNoRotation):(wm[0]=e,wm[1]=r,n1(t,wm,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return VY(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new sp({targetGeometry:new ct(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=n6(o),this.rotation=i,this.scale=r,this.spatialReference=e,cn(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;hZ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=dZ(this.viewMat3),h=rh(n[0]/2,n[1]/2),d=rh(-n[0]/2,-n[1]/2),f=n5(i);vN(c,c,h),pZ(c,c,f),vN(c,c,d),pS(this.displayViewMat3,this.displayMat3,c);const m=FY(this.viewMat2d,h);return DY(m,m,f),NY(m,m,d),Zht(this.extent,o,n),Jht(this.transform,o,n,s),yEe(this.inverseTransform,this.transform),Qht(this.transformNoRotation,o,n,s),this.worldScreenWidth=edt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([p({readOnly:!0})],f0.prototype,"id",void 0),u([p({value:1,json:{write:!0}})],f0.prototype,"pixelRatio",null),u([p({json:{write:!0}})],f0.prototype,"size",null),u([p()],f0.prototype,"spatialReference",void 0),u([p({type:sp,json:{write:!0}})],f0.prototype,"viewpoint",null),f0=MG=u([R("esri.views.2d.ViewState")],f0);const tdt=f0;var IG,$G,Poe,Moe,Ioe,$oe,Loe,Doe,Noe,Foe,Uoe,Voe,zoe,koe,Boe,Goe,joe,Hoe,qoe,Woe,Zoe,Xoe,Yoe,Joe,Qoe,Koe,eae,tae,rae,iae,sae,nae,oae,aae,lae,cae,uae,hae,dae,pae,fae,mae,gae,yae,_ae,vae,bae,wae,xae,Tae,Sae,Eae,Cae,Aae,Oae,Rae,Pae,Mae,Iae,$ae,Lae;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(IG||(IG={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}($G||($G={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Poe||(Poe={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Moe||(Moe={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Ioe||(Ioe={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}($oe||($oe={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(Loe||(Loe={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Doe||(Doe={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Noe||(Noe={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Foe||(Foe={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Uoe||(Uoe={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Voe||(Voe={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(zoe||(zoe={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(koe||(koe={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Boe||(Boe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Goe||(Goe={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(joe||(joe={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Hoe||(Hoe={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(qoe||(qoe={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(Woe||(Woe={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(Zoe||(Zoe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Xoe||(Xoe={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Yoe||(Yoe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Joe||(Joe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(Qoe||(Qoe={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(Koe||(Koe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(eae||(eae={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(tae||(tae={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(rae||(rae={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(iae||(iae={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(sae||(sae={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(nae||(nae={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(oae||(oae={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(aae||(aae={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(lae||(lae={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(cae||(cae={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(uae||(uae={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(hae||(hae={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(dae||(dae={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(pae||(pae={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(fae||(fae={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(mae||(mae={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(gae||(gae={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(yae||(yae={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(_ae||(_ae={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(vae||(vae={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(bae||(bae={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(wae||(wae={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(xae||(xae={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Tae||(Tae={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Sae||(Sae={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Eae||(Eae={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Cae||(Cae={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Aae||(Aae={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Oae||(Oae={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Rae||(Rae={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(Pae||(Pae={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Mae||(Mae={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Iae||(Iae={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}($ae||($ae={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Lae||(Lae={}));var LG,X1,DG,w4,NG,x4,FG,Y1,UG;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(LG||(LG={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(X1||(X1={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(DG||(DG={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(w4||(w4={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(NG||(NG={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(x4||(x4={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(FG||(FG={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(Y1||(Y1={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(UG||(UG={}));let Yh=class{};Yh.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:X1.VISIBLE}},Yh.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:X1.VISIBLE}},Yh.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:X1.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:IG.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:$G.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Yh.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:X1.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:DG.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:x4.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:w4.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:x4.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:NG.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:w4.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:FG.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[UG.HORIZONTAL]}},Yh.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:X1.VISIBLE}},Yh.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Yh.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:Y1.MAP}},Yh.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:Y1.MAP},"line-width":{type:"number",minimum:0,default:1}},Yh.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:Y1.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:Y1.MAP}},Yh.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Yh.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:Y1.MAP}};const rdt=.125;let idt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new tdt({viewpoint:new sp({targetGeometry:new ct(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,s,n,o,a,l,c,h,d){this._render(e,r,i,s,n,o,a,l,c,h,d)}renderSymbols(e,r,i,s,n,o,a,l,c,h,d){this._render(e,r,i,s,n,o,a,l,c,h,d,LG.SYMBOL)}_render(e,r,i,s,n,o,a,l,c,h,d,f){const m=r[0]-o.getLevelShift(r[0]),y=this._renderParams;y.context=e,y.painter=s,y.glyphMosaic=s.glyphMosaic,y.spriteMosaic=s.spriteMosaic,y.pixelRatio=h*d,y.displayLevel=m,y.requiredLevel=m;const _=o.getScale(r[0]),[v,w]=o.getOffset(r,a*_),T=rdt*a*_/c,x=i.transforms.dvs;x[0]=T,x[4]=-T,x[6]=-1-v-l[0]*a*2,x[7]=1+w+(1-l[1])*a*2-2,y.state.size[0]=c/d,y.state.size[1]=c/d,y.state.pixelRatio=d,i.stage||i.attachWithContext(e),i.triangleCount=0,s.drawTile(y,i,n,f)}},TEe=class SEe extends Pr{initializeProgram(e){return new Cr(e.rctx,SEe.shader.get().build(this.configuration),br)}initializePipeline(){return Ot({blending:wc(be.ONE,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt})}};TEe.shader=new Er(xut,()=>ae(()=>import("./RasterColorizer.glsl-158854a1.js"),[]));let L3=class extends YA{constructor(){super(...arguments),this.colorizerType=Pb.Stretch,this.stretchType=lw.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([F({count:Pb.COUNT})],L3.prototype,"colorizerType",void 0),u([F({count:lw.COUNT})],L3.prototype,"stretchType",void 0),u([F()],L3.prototype,"applyColormap",void 0),u([F()],L3.prototype,"requireBilinearWithNN",void 0);let Dae=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new on(this._rctx,new vr(e),new wN(Bs.DEPTH_COMPONENT16,e));return this._fbos.set(e,i),i}};const sdt=Q.getLogger("esri.views.3d.terrain");let ndt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new idt,this._bindParameters=new iF(null,null,null),this._blendLayersTechniqueConfig=new gEe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Ol(this._rctx,PR)}dispose(){this._fbos.forEach(Fe),this._fbos=null,this._vtFBO=Fe(this._vtFBO),this._vaoQuad=Fe(this._vaoQuad),this._vectorTileHelper=Fe(this._vectorTileHelper),this._backgroundTechnique=Bi(this._backgroundTechnique),this._applyOpacityTechnique=Bi(this._applyOpacityTechnique),this._blendLayersTechnique=Bi(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=Od.Off,n=cw.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(fEe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Re.Normal,r?yn.ColorComposite:yn.GridComposite,jd.NotRequired,Od.Off,cw.Only),s=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Et.TRIANGLE_STRIP,0,Do(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n,o=Od.On){r===yn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,s,n,o=Od.Off){if(e.texture==null)return;e.fboTexture=r===yn.GroupBackgroundComposite||s===Re.Normal&&n===jd.NotRequired&&o===Od.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,rr.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Re.Normal&&n===jd.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new L3,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?lw.Noop:lw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(TEe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l,c){const h=this._rctx,d=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,rr.MAP),m=n===jd.Required||e.opacity<1||s!==Re.Normal||r!==yn.Composite,y=m?Od.On:Od.Off;this._getBlendLayersTechnique(s,r,n,y).bindPipelineState(h);let _=null,v=null;m?(v=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new Dae(this._rctx)),_=this._vtFBO.get(i),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(xi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,d,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom),o.vtlNeighborInfos.forAll(w=>this._vectorTileHelper.renderSymbols(h,w.sourceLod,w.sourceLayerInfo.data,f.painter,f.layer.styleRepository,f.schemaHelper,1,w.offset,l,a,f.contentZoom))}catch(w){sdt.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return _==null||(h.bindFramebuffer(v),e.texture=_.colorTexture,e.offset=np,e.scale=1,this.drawRasterData(e,r,i,s,n,y),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Ct.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(os.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,Ct.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(xi.COLOR_BUFFER_BIT|xi.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new Dae(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},odt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new Gt({allocator:e=>e||new adt})}},adt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},ldt=class{constructor(e,r,i,s){this.start=e,this.end=r,this.blendMode=i,this.opacity=s}},cdt=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new vht,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new ndt(this._rctx,this._techniqueRepository),this._blackTex=new vT(gke(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Fe(this._composition),this._backgroundTexture=Bi(this._backgroundTexture),this._blackTex=Bi(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let h=!1;T4.clear(),Ax.length=0;const d=e.layerInfo[rr.MAP];let f=d.length,m=0,y=null;for(;m<d.length;m++){const v=i.layerViewByIndex(m,rr.MAP),w=v.layer.opacity;Nae[m]=w;const T=v.fullOpacity;if(Fae[m]=T,tpe(v.layer)&&f>=d.length&&(f=m),g4(v)){Uae[m]=v.layer.blendMode;let S=v.layer.blendMode!=="normal";if(j2(v.layer.parent)){const O=VG(v.layer.parent);O!=null&&O!==""&&(S=EEe(v.layer.parent)||S)}S&&(h=S,l=!1)}if(w===0&&!h){d[m].pendingUpdates&=~(_t.TEXTURE_NOFADING&_t.TEXTURE_FADING);continue}++o;const x=C9(e,m);if(x){if(d[m].pendingUpdates&=~(_t.TEXTURE_NOFADING&_t.TEXTURE_FADING),j2(v.layer.parent)){const S=VG(v.layer.parent);S!=null&&S!==""&&CEe(v.layer.parent,m)}YO(v)?a=Math.max(a,this.tileSize*c):s===1&&T===1&&(v.isOpaque||this._dataToTexture(x)&&x.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,y===null&&(y=m)}}const _=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),n!==0&&y!==null?n===1&&!h&&this._useLayerTexture(e,y,f,Fae[y])||this._composeMapLayers(e,r,m-1,f,Nae,Uae,a,_,!l||h,T4,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=np,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=Tg.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=Tg.Delayed);const s=e.renderData;this._backgroundTexture&&s.textureReference==null&&(i=Tg.Immediate),s.setTextureReference(this._backgroundTexture!=null?new S9(this._backgroundTexture,en.FADING,Vae,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,s){const n=r<i,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=C9(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new S9(l.sourceLayerInfo.data,en.FADING,l,o,a,s)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c,h,d){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,y=At.LINEAR_MIPMAP_LINEAR,_=!1,v=0;for(let x=i;x>=0;x--){const S=C9(e,x);if(!S||n[x]===0&&!d)continue;const O=x<s&&f<1&&!m;this._passParameters.baseOpacity=O?f:1;const C=this._passParameters.baseOpacity<1?jd.Required:jd.NotRequired;O&&(m=!0);let P=!1;h.forEach(B=>{B.start===x&&(Ax.push(B),this._composition.openGroup(a),P=!0)});const $=v===0,V=P?yn.GroupBackgroundComposite:c&&$?this.backgroundIsGrid?yn.GridComposite:yn.ColorComposite:yn.Composite,z=OG[o[x]];for(OSe(S)?(this._passParameters.opacity=n[x],_=this._composition.drawVectorData(this._passParameters,V,a,z,C,S,l,this.tileSize,_)):jlt(S)?(this._passParameters.opacity=n[x],this._composition.drawImageryTileData(this._passParameters,V,a,z,C,S),this._hasNearestInterpolation(S)&&(y=At.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=n[x],this._composition.drawRasterData(this._passParameters,V,a,z,C));Ax.length>0&&Ax[Ax.length-1].end===x;){const B=Ax.pop();this._passParameters.opacity=B.opacity,this._passParameters.offset=np,this._passParameters.scale=1;const k=c&&$?this.backgroundIsGrid?yn.GridComposite:yn.ColorComposite:yn.Composite;this._composition.drawGroup(this._passParameters,k,a,OG[B.blendMode],C)}v++}const w=e.renderData,T=w.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(T),this._composition.unbind(),w.setTextureReference(new S9(T,r,Vae,m?1:f,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(qlt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return Hlt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=At.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const i=new vr;i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const s=this._rctx;let n;if(typeof e=="number")i.width=i.height=e,n=new vT(new Ct(s,i));else if(e instanceof KF)i.isOpaque=e.isOpaque,n=new vT(new Ct(s,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,n=new vT(new Ct(s,i,e))}catch{n=new vT(T_e(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,Ct.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,Ct.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function C9(t,e){ya.layerIndex=e,ya.vtlNeighborInfos.clear();const r=t.layerInfo[rr.MAP][e];if(r.data)return nr(ya.offset,0,0),ya.tile=t,ya.scale=1,ya.sourceLod=t.lij,ya.sourceLayerInfo=r,OSe(ya)&&t.forEachLoadedNeighbor((s,n)=>{if(s.level!==t.level)return;const o=s.layerInfo[rr.MAP][e];if(!RSe(o)||r.data===o.data)return;const a=ya.vtlNeighborInfos.pushNew();a.offset=Vm[n],a.sourceLod=s.lij,a.sourceLayerInfo=o}),ya;const i=r.upsampleInfo;if(i){const s=i.tile.layerInfo[rr.MAP][e];return ya.tile=i.tile,cn(ya.offset,i.offset),ya.scale=i.scale,ya.sourceLod=i.tile.lij,ya.sourceLayerInfo=s,ya}return null}function VG(t){return t.get("uid")}function EEe(t){let e=t.blendMode!=="normal";return j2(t.parent)&&(e=EEe(t.parent)||e),e}function CEe(t,e){j2(t.parent)&&CEe(t.parent,e);const r=VG(t);if(r!=null&&r!==""){const i=T4.get(r);i?i.start=e:T4.set(r,new ldt(e,e,t.blendMode,t.opacity))}}const Nae=new Array,Fae=new Array,Uae=new Array,T4=new Map,Ax=new Array,ya=new odt,Vae={offset:[0,0],scale:1},Vm=new Array;Vm[it.NORTH]=[0,-1],Vm[it.NORTH_EAST]=[-1,-1],Vm[it.EAST]=[-1,0],Vm[it.SOUTH_EAST]=[-1,1],Vm[it.SOUTH]=[0,1],Vm[it.SOUTH_WEST]=[1,1],Vm[it.WEST]=[1,0],Vm[it.NORTH_WEST]=[1,-1];const AEe=200,A9=40,udt=.8,hdt=10,D3=1e-6;function ddt(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=D3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-D3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-D3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=D3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let zae=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},zY=class zG{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=A(),this.bspNodeTree=new Array;const n=i-r,o=n<=OEe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=ydt(e,r,i,s.data,s.stride),l=_e(Math.log2(n/A9),2,hdt),c=(h,d,f)=>{const m=mdt(o,a,h,d),y=d-h;if(y<=A9){const S=new zae(m,void 0,0,h,d);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=gdt(m),w=fdt(o,a,h,d,_,v),T=(S,O)=>{if(f>l)return;const C=O-S;return C<A9||C>=udt*y?void 0:c(S,O,f+1)},x=new zae(m,_,v,w.next,w.mid);return this.bspNodeTree.push(x),x.leftNode=T(h,w.next),x.rightNode=T(w.mid,d),x};c(0,n,0),this.triangleVertexIndices=_dt(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,d=h[0],f=h[1],m=h[2];for(let y=e,_=3*e;y<r;++y){let v=i[_++]*n;const w=s[v++],T=s[v++],x=s[v];v=i[_++]*n;const S=s[v++],O=s[v++],C=s[v];v=i[_++]*n;const P=S-w,$=O-T,V=C-x,z=s[v++]-w,B=s[v++]-T,k=s[v]-x,Z=f*k-B*m,W=m*z-k*d,j=d*B-z*f,Y=P*Z+$*W+V*j;if(Math.abs(Y)<=Number.EPSILON)continue;const M=a-w,D=l-T,N=c-x,G=M*Z+D*W+N*j;if(Y>0){if(G<0||G>Y)continue}else if(G>0||G<Y)continue;const X=D*V-$*N,J=N*P-V*M,ee=M*$-P*D,ye=d*X+f*J+m*ee;if(Y>0){if(ye<0||G+ye>Y)continue}else if(ye>0||G+ye<Y)continue;const Me=(z*X+B*J+k*ee)/Y;if(Me>=0){const ft=this.indices[y]+this.firstTriangleIndex,Rt=oX(P,$,V,z,B,k,pdt);this._callback(Me,Rt,ft,!1)}}}zG.numFacesTested+=r-e}intersectRay(e,r){zG.numFacesTested=0;const i=Ae(e.r0[0],e.r0[1],e.r0[2]),s=Ae(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<D3)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!ddt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};zY.numFacesTested=0;const pdt=A(),Ox=[1/0,1/0,1/0],Rx=[-1/0,-1/0,-1/0];function fdt(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function mdt(t,e,r,i){if(i<=r)return Gb(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)Ox[n]=e[s+0+n],Rx[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)Ox[o]=Math.min(Ox[o],e[n+0+o]),Rx[o]=Math.max(Rx[o],e[n+3+o])}return Gb(Ox[0],Ox[1],Ox[2],Rx[0],Rx[1],Rx[2])}function gdt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function ydt(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,h=t[l+1]*s,d=t[l+2]*s;for(let f=0;f<3;++f){const m=i[c+f],y=i[h+f],_=i[d+f];o[6*a+f]=Math.min(m,y,_),o[6*a+3+f]=Math.max(m,y,_)}}return o}function _dt(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=OEe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const OEe=65535;let Ds=class extends No{constructor(){super(...arguments),this.output=L.Color,this.overlayMode=Eg.Disabled,this.tileBlendInput=bf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=rt.Terrain}};u([F({count:L.COUNT})],Ds.prototype,"output",void 0),u([F({count:Eg.COUNT})],Ds.prototype,"overlayMode",void 0),u([F({count:bf.COUNT})],Ds.prototype,"tileBlendInput",void 0),u([F()],Ds.prototype,"spherical",void 0),u([F()],Ds.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],Ds.prototype,"receiveShadows",void 0),u([F()],Ds.prototype,"hasSlicePlane",void 0),u([F()],Ds.prototype,"backfaceCullingEnabled",void 0),u([F()],Ds.prototype,"textureFadingEnabled",void 0),u([F()],Ds.prototype,"renderOccluded",void 0),u([F()],Ds.prototype,"hasScreenSpaceReflections",void 0),u([F()],Ds.prototype,"hasCloudsReflections",void 0),u([F()],Ds.prototype,"invisible",void 0),u([F()],Ds.prototype,"tileBorders",void 0),u([F()],Ds.prototype,"visualizeNormals",void 0),u([F()],Ds.prototype,"screenSizePerspective",void 0),u([F()],Ds.prototype,"receiveAmbientOcclusion",void 0),u([F({count:rt.COUNT})],Ds.prototype,"pbrMode",void 0),u([F({constValue:Or.Compressed})],Ds.prototype,"normalType",void 0),u([F({constValue:Ps.Compressed})],Ds.prototype,"textureCoordinateType",void 0),u([F({constValue:!1})],Ds.prototype,"highStepCount",void 0),u([F({constValue:!1})],Ds.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!1})],Ds.prototype,"useFillLights",void 0);const O9=7,vdt=10,R9=ln();var fn;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(fn||(fn={}));let kl=class extends xe{get _isGlobal(){return this._stage.viewingMode===Le.Global}constructor(e){super(e),this.type=Gi.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ds,this._passParameters=new XSe,this._rctx=null,this._renderDataPool=new Uo(Jut),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new zSe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=fn.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Li.Occlude}initialize(){const e=[ce.OPAQUE_TERRAIN,ce.TRANSPARENT_TERRAIN,ce.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),Yct()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===fn.TransparentWithDraped||e===fn.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return N0}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?s4:Li.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,_t.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===_t.TEXTURE_FADING?en.FADING:en.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[rr.ELEVATION])i.pendingUpdates&=~_t.GEOMETRY;e.resetPendingUpdate(_t.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=vdt-O9,i=Math.max(0,Math.floor((e.level-r)/O9)*O9);if(this._isGlobal&&i===0)return Ba;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=fs.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=fs.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=fs.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new cdt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=T_e(this._rctx)}uninitializeRenderContext(){this._emptyTex=Fe(this._emptyTex),this._tileRenderer=Fe(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==fn.Opaque)return;const n=bdt,o=wdt;he(n,s,i),se(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===go.MIN,d=!!e.results.ground.target,f=Cje(e.verticalOffset),m=e.tolerance;let y,_=h&&a.dist!=null?a.dist:1/0;const v=T=>{const x=T.renderData;if(!(x!=null&&x.vao))return;const S=x.geometry;x5(R9,S.boundingBox);const O=x.localOrigin;f!=null&&(f.localOrigin=O,f.applyToAabb(R9));const C=R9;if(Px[0]=i[0]-O[0],Px[1]=i[1]-O[1],Px[2]=i[2]-O[2],!lX(C,Px,o,m,_))return;const P=(j,Y,M)=>{j.set(this.type,T,Y,M,nn),_=h&&a.dist!=null?a.dist:1/0},$=(j,Y)=>{if(Y!=null&&j>=0&&(e.options.backfacesTerrain||me(Y,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,j))){if((c.dist==null||j<c.dist)&&P(c,j,Y),e.options.isFiltered)return;e.options.store===go.ALL&&(y==null?(y=LZ(e.ray),P(y,j,Y),e.results.all.push(y)):j<y.dist&&P(y,j,Y)),(a.dist==null||j<a.dist)&&P(a,j,Y),e.options.store!==go.MIN&&(l.dist==null||j>l.dist)&&P(l,j,Y)}},V=xdt;he(V,s,O);const z=S.indices,B=S.vertexAttributes,k=B.getField(E.POSITION,an),Z=new Ve(k.typedBuffer,3,!1,B.stride/4),W=S.indexCount/3;if(!f&&W>AEe){const j=T.renderData;j.intersectionData==null&&(j.intersectionData=new zY(z,0,W,Z)),j.intersectionData.intersectRay({r0:Px,r1:V},$)}else zR(Px,V,0,W,z,Z,null,f,$)},w=this._rootTiles;w!=null&&(()=>{const T=this._tileIterator;T.reset(w);const x=e.options.invisibleTerrain;for(let S=T.next();S;S=T.next())!(S.visible||x&&S.intersectsClippingArea)||f==null&&!S.intersectsRay(i,n,m,_)||d&&this._useStencilForTile(S)?T.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const s of this._patchGroups.values())for(const n of s)((i=n.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(n);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===ce.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&s4))return null}else{const r=this.transparency===fn.Opaque?ce.OPAQUE_TERRAIN:ce.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case L.Color:return this.transparency===fn.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?Eg.Disabled:this._overlayRenderer.hasWater?Eg.EnabledWithWater:Eg.Enabled,this._updateTechnique(L.Color,e.bindParameters.slot===ce.OCCLUDED_TERRAIN));case L.Shadow:case L.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Shadow,!1)):null;case L.Depth:return this.transparency===fn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Depth,!1));case L.Normal:return this.transparency===fn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Normal,!1));case L.ObjectAndLayerIdColor:return this.transparency===fn.Empty?null:this._updateTechnique(L.ObjectAndLayerIdColor,!1);case L.Highlight:return this.transparency!==fn.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case L.Color:{const s=e.bindParameters.slot===ce.OCCLUDED_TERRAIN?$a.Occluded:$a.ColorAndWater;this.transparency===fn.Opaque?this._renderMaterialPass(e,r,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case L.Depth:case L.Normal:this._renderAuxiliaryPass(e,r,$a.ColorAndWater);break;case L.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,$a.Highlight);break;case L.Shadow:case L.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,$a.None);break;case L.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,$a.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:s}=e;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const s=e.rctx;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i=null;if(e!=null){const s=ke.toUnitRGBA(e);i=Ae(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,en.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?bf.GridComposite:r.backgroundColor!=null?bf.ColorComposite:bf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==PS.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)kSe(this.renderOrder,i,r);e.sort((i,s)=>BSe(i[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(i),(!this._highestVisibleLODTile||i.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;r.program.bindDraw(new nG(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,r,n[a],Et.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const s=e.bindParameters.camera,n=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const d=rbe(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;d.update({distance:f,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===$a.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",Ba),n.setUniform4fv("texOffsetAndScale",Cf));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:Ba;this._techniqueConfiguration.tileBlendInput===bf.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Et.LINES:Et.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const d of h.values()){const f=d[0].renderData.localOrigin;r.program.bindDraw(new nG(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of d){const y=m.renderData,_=y.textureReference;if(_!=null){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);const v=y.textureFadeFactor,w=v<1?y.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&w!=null&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",w.offsetAndScale),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),y.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,r,m,c,o,i),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(sn&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const h=r.program;o===$a.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const d=a.geometry.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(YSe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([p({constructOnly:!0})],kl.prototype,"_overlayRenderer",void 0),u([p({constructOnly:!0})],kl.prototype,"_stage",void 0),u([p({readOnly:!0})],kl.prototype,"_isGlobal",null),u([p({constructOnly:!0})],kl.prototype,"_allTiles",void 0),u([p({constructOnly:!0})],kl.prototype,"_ellipsoidRadius",void 0),u([p({value:!1})],kl.prototype,"renderingDisabled",null),u([p()],kl.prototype,"renderPatchBorders",null),u([p()],kl.prototype,"visualizeNormals",null),u([p()],kl.prototype,"cullBackFaces",null),u([p({value:PS.FRONT_TO_BACK})],kl.prototype,"renderOrder",null),u([p()],kl.prototype,"wireframe",null),kl=u([R("esri.views.3d.terrain.TerrainRenderer")],kl);const bdt=A(),wdt=A(),Px=A(),xdt=A();let Tdt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Qp=class extends xe{constructor(e){super(e),this._handles=new Mi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ue(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Pe(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!pA(r)||r.isRejected())&&!(r.isFulfilled()&&!Sdt(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||m4(r)))),e)if(e.isResolved()){const r=t6(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new nc(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===Le.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=nc.makeWebMercatorAuxiliarySphere(r):S_(e.spatialReference)&&(e=nc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ue(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Le.Global){const e=this.extentHelper.viewSpatialReference,r=S_(e)||Yf(e)||Jf(e);e.isWebMercator?this.tilingScheme=nc.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=nc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||mb(e,this.extent)||(this.tilingScheme=nc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Sdt(t,e,r){return t6(t,e,r)!=null}u([p()],Qp.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],Qp.prototype,"extent",void 0),u([p({value:!1})],Qp.prototype,"tilingSchemeLocked",void 0),u([p({constructOnly:!0})],Qp.prototype,"viewSpatialReference",void 0),u([p({constructOnly:!0})],Qp.prototype,"layers",void 0),u([p({constructOnly:!0})],Qp.prototype,"extentHelper",void 0),u([p({constructOnly:!0})],Qp.prototype,"viewingMode",void 0),Qp=u([R("esri.views.3d.terrain.TilingSchemeLogic")],Qp);let Edt=class{constructor(){this.offset=Ue(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},Zt=class extends Ls.EventedMixin(xe){constructor(e){var r,i;super(e),this._scaleRangeQueries=new FL,this._iteratorPool=new Uo(zSe,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new tut,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new Tdt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=A(),this._eyePosSurfaceSR=A(),this._splitLimits=new hd,this._frustum=IO(),this._viewProjectionMatrix=ve(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Mi,this._watchUpdatingTracking=new Ef,this._frameTask=cS,this._allTiles=new Gt,this._upsampleInfoPool=new Uo(Edt),this._rootTilesExtent=kt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ge.WebMercator,this.visibleElevationBounds=new o2(1/0,-1/0),this.rootTileElevationBounds=new o2(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Aa({...e,surface:this}),this._isGlobal=!((i=(r=e.view)==null?void 0:r.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=Cct(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Uo(pht):new Uo(mht);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",o=>o.unloadMapData()),this._elevationQueryCache=new Sct(e.newCache("elevation-query")),this._handles.add([ue(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),ue(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),ue(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new kl({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Nr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ue(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?en.UNFADED:en.IMMEDIATE)},As),ue(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?en.UNFADED:en.IMMEDIATE),As),ue(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},jr),ue(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},As),ue(()=>this.snapLevel,()=>this._viewChanged=!0,jr),ue(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),ue(()=>oi.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?ae(()=>import("./TerrainTileTree3DDebugger-700ba941.js"),["assets/TerrainTileTree3DDebugger-700ba941.js","assets/TileTreeDebugger-2e4c7d48.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&oi.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Pe(this._treeDebugger))},zr)]);const{spatialReference:r}=this.view;this._extentHelper=Bct(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new mO({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new Qp({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(gf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(gf.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(pt.TERRAIN_SURFACE,this),this._handles.add([ue(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),zr),ue(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),jr),ue(()=>this.extent,()=>this._updateRootTiles(),zr),this.view.on("resize",()=>this._viewChangeUpdate()),ue(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),As),ue(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,zr),ue(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?rt.Terrain:rt.Disabled,zr),ue(()=>this._userClippingExtent,()=>this._updateClippingExtent(),jr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Bi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Pe(this._upsampleMapCache),this._elevationQueryCache=Pe(this._elevationQueryCache),this._set("tilingSchemeLogic",Pe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Pe(this.overlayManager)),this._tilePool=Pe(this._tilePool),RY.prune(),this._treeDebugger=Pe(this._treeDebugger),this._renderer=Pe(this._renderer),this._iteratorPool=Pe(this._iteratorPool),this._set("view",null),this._extentHelper=Pe(this._extentHelper),this._upsampleInfoPool=Pe(this._upsampleInfoPool),Fct(),Put()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,r;if(this.lodSnapping===IA.ON){const i=this.view,s=this.tilingScheme,n=(r=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:r.scale;if(s&&n){const o=i.state.contentCamera;let a=xF(i,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=s.levelAtScale(n)-l,h=Math.min(c,this._splitLimits.maxLod||1/0);return h<=0?null:h}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?IA.ON:IA.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(r==null||e==null)return null;const i=kt(),s=ySe(r,i,e)?i:null,n=this._get("extent");return mb(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=lz(this.groundExtent,this._userClippingExtent,kt()),r=this._get("extent");return mb(e,r)?r:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){var e,r;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(e=this._watchUpdatingTracking)!=null&&e.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(r=this.overlayManager)!=null&&r.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var e,r,i;return((i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity)??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}get wireframe(){var e;return(e=this._renderer)==null?void 0:e.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===fn.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,s){this._renderer.intersect(e,r,i,s)}getElevation(e,r,i,s){const n=this._rootTiles;if(n==null||!n.length||n[0].layerInfo[rr.ELEVATION].length===0)return null;const o=sl;return o[0]=e,o[1]=r,o[2]=i,js(o,s,o,this._spatialReference)?Bae(n,o[0],o[1]):(Q.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const s=this._rootTiles,n=s?s[0].layerInfo[rr.ELEVATION].length:0;if(s!=null&&s.length&&n!==0)for(let o=0;o<r;++o){const a=3*o;i(o,Bae(s,e[a],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!vo(e,sl,this.spatialReference))return Q.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(r!=null){for(const i of r)if(i!=null&&i.containsPoint(sl)){let s=i;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;sl[0]>n[2]&&(o+=1),sl[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,r){var a;if(sl[0]=e[0],sl[1]=e[1],sl[2]=e[2],sl[3]=e[3],!js(sl,r,sl,(a=this.tilingScheme)==null?void 0:a.spatialReference))return Q.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,s=-1/0;const n=l=>{if(l&&FQ(l.extent,sl))if(l.isLeaf||l.rendered)i=Math.min(i,l.elevationBounds[0]),s=Math.max(s,l.elevationBounds[1]);else for(const c of l.children)n(c)},o=this._rootTiles;if(o!=null)for(const l of o)n(l);return{min:i,max:s}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!vo(e,sl,this.spatialReference))return Q.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;sl[3]=r;let i=null;const s=o=>{if(o&&FQ(o.extent,sl)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},n=this._rootTiles;if(n!=null)for(const o of n)s(o);return i}queryVisibleScaleRange(e,r,i,s){const n=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?r?fn.Empty:fn.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?fn.Opaque:fn.Semitransparent,n=i!==s;return n&&(this._renderer.transparency=s,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){var i,s,n;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;cf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((s=(i=this.view)==null?void 0:i.state)!=null&&s.isLocal),this.tilingScheme&&this._removeAllTiles();const r=(e==null?void 0:e.spatialReference)??Ge.WebMercator;this._spatialReference=r,this._isWebMercator=!!(r!=null&&r.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&hO((n=this.view)==null?void 0:n.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,s){const n=this._tilePool.acquire();return II[0]=e,II[1]=r,II[2]=i,n.init(II,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=Odt;let s=r.rootTilesInExtent(e,i,5*ZT);if(this._rootTiles!=null){if(s.length>ZT)return void Q.getLogger(this).warn(F9e);const n=this._rootTiles.map(a=>a.lij),o=GOe(n,s,kae);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>kae(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>ZT&&(Q.getLogger(this).warn(U9e),s=r.rootTilesInExtent(e,i,ZT)),this._setRootTiles(s.map(n=>this._newRootTile(n)));mb(i,this._rootTilesExtent)||(this._rootTilesExtent=kt(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Sg);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===_t.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(_t.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(_t.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const r=lut(e),i=this.visibleElevationBounds;let s=r?i.min:1/0,n=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(_t.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(_t.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(i.min!==s||i.max!==n)&&(this.visibleElevationBounds=new o2(s,n))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),r=Math.max(r,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===r||(this.rootTileElevationBounds=new o2(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),s=Math.tan(.5*r.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=IO()),xN(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,xN(this._frustum,e.frustum),ni(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),re(this._eyePosRenderSR,r.eye),js(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(REe(e)?this._loadChildren(e):Adt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(_t.TEXTURE_FADING)?_t.TEXTURE_FADING:!!e.resetPendingUpdate(_t.TEXTURE_NOFADING)&&_t.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=M9.extent;vc(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>l_(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),M9.spatialReference=this.spatialReference,this.emit("elevation-change",M9)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(s,n,i);if(a!==_t.SPLIT){if(o.resetPendingUpdate(_t.SPLIT)&&o.updateAgentSuspension(),a===_t.ELEVATION&&o.updateAgents(rr.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(_t.MERGE),o.resetPendingUpdate(_t.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(_t.MERGE),o.isLeaf&&(o.setPendingUpdate(_t.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(_t.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(out(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){we(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),i=(n,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(Sg);const s=r.length;for(let n=0;n<s;++n){const o=r[n];we(o.isLoaded),we(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,h=d=>{var m;const f=QO[d];i(o,(m=c[d])==null?void 0:m.findCorner(y4(f),y=>y.isLoaded))};for(let d=0;d<4;++d)if(l&1<<d){const f=a.geometryState.neighborData.edgePeerNeighbors[d];f&&(f==null?void 0:f.level)>=o.level&&f.forAllSubtreeOnSide(_4(vf[d]),m=>!(!m.isLoaded||!m.intersectsClippingArea)&&(we(e.has(m)||Sg(o,m)<0),i(o,m),!0)),h((d+1)%4),h(d)}}e.clear(),this._updateTilesGeometries(r),sn&&f4&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{var h;if(!i&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(_t.MERGE)){if(!r)return l.setPendingUpdate(_t.MERGE),e.done;for(;(h=c.parent)!=null&&h.resetPendingUpdate(_t.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(_t.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(_t.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(_t.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(fs.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*D9e}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=_e(e-this._lodBias,0,r.length-1),s=i-Math.floor(i);return r[Math.floor(i)].scale*(1-s)+r[Math.ceil(i)].scale*s}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){cf(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(r,i,s,e),this._createTile(r,i,s+1,e),this._createTile(r,i+1,s,e),this._createTile(r,i+1,s+1,e)),e.setPendingUpdate(_t.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){$I.spatialReference=this.spatialReference,$I.extent=e.extent,$I.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",$I)}_createTile(e,r,i,s){cf(!!s,"_createTile sanity check");const n=this._acquireTile(e,r,i,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(_t.SPLIT),n}get shortBatches(){return this.view.state.mode!==$r.IDLE}_mergeTile(e){cf(!e.hasPendingUpdate(_t.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(cf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){cf(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const s=r[i];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(_t.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const s=new zct(e.lij,e.extent,i);e.dataArrived(r,rr.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=Va){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),JO(n)||hC(n))if(this._basemapLayerViewHandles.has(n.uid)&&!hC(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<s||s==null)&&(r=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((n,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var r,i;let e=((i=(r=this.view.map)==null?void 0:r.ground)==null?void 0:i.opacity)===0;for(const s of this.view.allLayerViews.items)if(TG(s)&&!tpe(s.layer)&&s.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((g4(e)||hC(e))&&fut(OG[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return xG(e)?rr.ELEVATION:rr.MAP}_registerTiledLayerView(e){const r=[];if((g4(e)||hC(e))&&r.push(ue(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(en.UNFADED)})),!hC(e)){const i=this._layerClassFromLayerView(e);r.push(ue(()=>e.suspended,()=>this._updateTiledLayers())),r.push(ue(()=>e.fullOpacity,()=>this._updateTileTextures(en.UNFADED))),r.push(ue(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),r.push(e.on("data-changed",()=>{const s=this._getLayerIdxByUID(i,e.uid);s!=null&&this._invalidateLayerData(s,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(const i of r)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(s=>{if(!s.layer||s.suspended||!JO(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===rr.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[n].push(s)});for(const s of y1){const n=this._layerViews[s],o=r[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let d=0;d<a;d++){const f=o[d].uid;this._layerIndexByUid[s].set(f,d);const m=n.indexOf(o[d]);c[d]=m,d!==m&&(l=!0),m>-1&&(h[m]=d)}if(l){const d=this._postorderIterator;for(d.reset(this._rootTiles);!d.done;)d.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===rr.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(rr.MAP),e===en.IMMEDIATE?this.renderer.updateTileTexture(r,_t.TEXTURE_NOFADING):r.updateRenderData(rr.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=fs.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,s){const n=this.layerViewByIndex(r,i),o=n.layer;return!o.tilemapCache||YO(n)?this._requestTileData(e,i,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Qt(s),ys(a)||this._dataMissing(e,i,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,s),s.signal)))}_requestTileData(e,r,i,s){return r===rr.ELEVATION?xG(i)?this._requestElevationTileData(e,i,s):Promise.reject():TG(i)?this._requestMapTileData(e,i,s):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const s=a=>{if(vn(i))return;const l=this._layerIndexByUid[rr.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):Q.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",rr.ELEVATION,e.lij.toString())},n=a=>{ys(a)||(this._dataMissing(e,rr.ELEVATION,r,a),this.requestUpdate())};if(roe(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:CO,signal:i.signal}).then(a=>{if(!vn(i))return this._frameTask.schedule(()=>s(a),i.signal,n);Q.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:CO},i.signal)).then(a=>{a?s(new Ect(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const s=(h,d)=>{--this._asyncWorkItems,O2(d),vn(i)||(this._dataMissing(e,rr.MAP,r,h),this.requestUpdate())},n=h=>d=>s(d,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),vn(i)?O2(h):this._mapTileDataArrived(e,r,h)},i.signal,n(h)).catch(n(h)),a=(h,d=null)=>this._frameTask.schedule(()=>s(h,d));if(YO(r)){const h=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(h[0],h[1],h[2],i).then(o,a)}if(e6(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(SY(r)&&roe(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(h=>{if(vn(i))return Q.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Dr());o(h)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);xct(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const s=this._getLayerIdxByUID(rr.MAP,r.uid);s!=null?e.dataArrived(s,rr.MAP,i):(O2(i),Q.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,s){const n=this._getLayerIdxByUID(r,i.uid);n!=null?e.dataMissing(n,r,s):Q.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=this.overlayManager.gpuMemoryUsage;const i=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(i,e.uid);return s!=null&&this._allTiles.forAll(n=>r+=n.getUsedMemoryForLayer(i,s)),r}getTile(e){if(e==null||this._rootTiles==null)return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],s=Math.floor(r[1]/i),n=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return cf(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){P9.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&P9.push(i)});const r=P9.toArray();return kSe(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!f4)return;const e=this._rootTiles;if(e==null)return;const r=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometry)==null?void 0:l.indices)==null?void 0:c.length)>0},i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometry)||(((l=o.renderData.geometry.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),r(o)){o.checkGeometryWaterproofness();for(const c of o.children)i(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)s(c)},n=o=>{var h;const a=((h=o.parent)==null?void 0:h.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const d of o.children)n(d)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const s=(i+(i<0?r:0))%r;return[e[0],e[1],s]}enableInternalChecks(e){Glt(e)}enableWaterproofnessChecks(e){Blt(e)}};u([p()],Zt.prototype,"_renderer",void 0),u([p({constructOnly:!0})],Zt.prototype,"_scaleRangeQueries",void 0),u([p({constructOnly:!0})],Zt.prototype,"view",void 0),u([p({constructOnly:!0})],Zt.prototype,"overlayManager",void 0),u([p()],Zt.prototype,"_hasPendingUpdates",void 0),u([p()],Zt.prototype,"_asyncWorkItems",void 0),u([p()],Zt.prototype,"_allTilesDirty",void 0),u([p()],Zt.prototype,"_allTilesSorted",void 0),u([p()],Zt.prototype,"_viewChanged",void 0),u([p()],Zt.prototype,"_splitLimits",void 0),u([p({readOnly:!0})],Zt.prototype,"_watchUpdatingTracking",void 0),u([p()],Zt.prototype,"_frameTask",void 0),u([p({readOnly:!0})],Zt.prototype,"snapLevel",null),u([p({readOnly:!0})],Zt.prototype,"lodSnapping",null),u([p()],Zt.prototype,"_userClippingExtent",null),u([p()],Zt.prototype,"_rootTilesExtent",void 0),u([p({readOnly:!0})],Zt.prototype,"extent",null),u([p({readOnly:!0})],Zt.prototype,"groundExtent",null),u([p({readOnly:!0})],Zt.prototype,"_tilingSchemeExtent",null),u([p({readOnly:!0})],Zt.prototype,"updating",null),u([p({readOnly:!0})],Zt.prototype,"running",null),u([p(Uct)],Zt.prototype,"updatingProgress",void 0),u([p({readOnly:!0})],Zt.prototype,"updatingProgressValue",null),u([p()],Zt.prototype,"_maxNumUpdating",void 0),u([p()],Zt.prototype,"baseOpacity",null),u([p()],Zt.prototype,"hasCompositeBlendMode",void 0),u([p({readOnly:!0})],Zt.prototype,"viewingMode",null),u([p()],Zt.prototype,"maxTextureScale",void 0),u([p({readOnly:!0})],Zt.prototype,"ready",null),u([p({value:PS.FRONT_TO_BACK})],Zt.prototype,"renderOrder",null),u([p({readOnly:!0})],Zt.prototype,"rootTiles",null),u([p()],Zt.prototype,"_rootTiles",void 0),u([p({readOnly:!0})],Zt.prototype,"spatialReference",null),u([p({type:ke})],Zt.prototype,"backgroundColor",null),u([p({value:!1})],Zt.prototype,"slicePlaneEnabled",null),u([p({readOnly:!0})],Zt.prototype,"tilingScheme",void 0),u([p({readOnly:!0})],Zt.prototype,"tilingSchemeLocked",null),u([p({readOnly:!0})],Zt.prototype,"tilingSchemeLogic",void 0),u([p()],Zt.prototype,"wireframe",null),u([p({value:!1})],Zt.prototype,"suspended",null),u([p()],Zt.prototype,"textureFadeDuration",null),u([p()],Zt.prototype,"visibleElevationBounds",void 0),u([p()],Zt.prototype,"rootTileElevationBounds",void 0),u([p()],Zt.prototype,"_layerViewsDirty",void 0),u([p()],Zt.prototype,"renderPatchBorders",null),u([p()],Zt.prototype,"visualizeNormals",null),u([p()],Zt.prototype,"renderingDisabled",null),Zt=u([R("esri.views.3d.terrain.TerrainSurface")],Zt);const Cdt=Zt;function kae(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function REe(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(REe(r))return!0;return!1}function Adt(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const sl=Yt(),Odt=kt(),II=[0,0,0],P9=new Gt,M9={spatialReference:null,extent:kt(),context:"ground"},$I={spatialReference:null,extent:null,scale:0};function Bae(t,e,r){var i;for(const s of t){if(!s.containsPointXY(e,r))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(r<n.extentMidY?2:0);n=n.children[a]}const o=((i=n==null?void 0:n.renderData)==null?void 0:i.geometryState.samplerData)??null;return Xi(e,r,o)}return null}let Rdt=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},N3=class extends xe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},h)=>{let d=!1;if(l===Wi.UPDATE){const f=o.get(h);if(f){if(c&gn.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(d=!0)}d||r.updates.push({renderGeometry:f,updateType:c})}else tt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===Wi.REMOVE||d){const f=o.get(h);f?(r.removes.push(f),o.delete(h)):l===Wi.REMOVE&&tt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===Wi.ADD||d){const f=this.model.getObject(n);if(f!=null){const m=this.model.getRenderGeometry(f,a);r.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,Wi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(gn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(gn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(gn.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Wi.UPDATE,gn.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryRemoved(r,s,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,Wi.UPDATE,gn.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Wi.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Wi.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=gn.NONE){i=i??this._getParentLayerId(e);const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const h=c.operation;h===Wi.REMOVE&&s===Wi.ADD&&c.states!==gn.NONE?c.operation=Wi.UPDATE:h===Wi.REMOVE&&s===Wi.ADD||h===Wi.ADD&&s===Wi.REMOVE?l.delete(a):h!==Wi.UPDATE||s!==Wi.REMOVE&&s!==Wi.UPDATE?(tt((h===Wi.REMOVE||h===Wi.ADD)&&s===Wi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new Rdt(s,r,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return Lo(this._dirtyGeomRecords,e=>Lo(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:kRe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};u([p({constructOnly:!0})],N3.prototype,"model",void 0),u([p()],N3.prototype,"dirty",void 0),N3=u([R("esri.views.3d.webgl-engine.lib.ModelDirtySet")],N3);const Pdt=N3;let VL=class extends xe{constructor(){super(...arguments),this.dirtySet=new Pdt({model:this}),this._content=new Map,this._originFactory=new kX(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;tt(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),e4(e)&&this.dirtySet.layerAdded(e)}remove(e){tt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),e4(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)r!=null&&(tt(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)tt(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:s}=r,n=new RS(r,{shaderTransformer:i,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),n.localOrigin=s??this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.updateTransformation(n=>e.getCombinedStaticTransformation(r,n));const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<as.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([p({constructOnly:!0})],VL.prototype,"dirtySet",void 0),VL=u([R("esri.views.3d.webgl-engine.parts.Model")],VL);function PEe(){const t=new Float32Array(4);return t[3]=1,t}function MEe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Mdt(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function IEe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:MEe,create:PEe,createView:IEe,fromValues:Mdt},Symbol.toStringTag,{value:"Module"}));const MS=1e-6,gC=[0,0,0],LI=[0,0,0];function Idt(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new kdt(t);zL(gC,n.minProj,n.maxProj),J1(gC,gC,.5),sh(LI,n.maxProj,n.minProj);const o=kG(LI),a=new Bdt;a.quality=o,s<14&&(t=new Ve(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],d=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch($dt(n,t,y,l,c,h,d,f,m,a)){case 1:return void qae(gC,LI,e);case 2:return void zdt(t,d,e)}Ldt(t,y,l,c,h,d,f,m,a),$Ee(t,a.b0,a.b1,a.b2,M2,I2);const _=[0,0,0];sh(_,I2,M2),a.quality=kG(_),a.quality<o?LEe(a.b0,a.b1,a.b2,M2,I2,_,e):qae(gC,LI,e)}function $dt(t,e,r,i,s,n,o,a,l,c){return Ddt(t,i,s),BG(i,s)<MS?1:(sh(o,i,s),Ro(o,o),Ndt(e,i,o,n)<MS?2:(sh(a,s,n),Ro(a,a),sh(l,n,i),Ro(l,l),nh(r,a,o),Ro(r,r),_1(e,r,o,a,l,c),0))}const yC=[0,0,0],_C=[0,0,0],Su=[0,0,0],Eu=[0,0,0],Cu=[0,0,0],Ny=[0,0,0],Fy=[0,0,0],Uy=[0,0,0];function Ldt(t,e,r,i,s,n,o,a,l){Fdt(t,e,r,yC,_C),yC[0]!==void 0&&(sh(Su,yC,r),Ro(Su,Su),sh(Eu,yC,i),Ro(Eu,Eu),sh(Cu,yC,s),Ro(Cu,Cu),nh(Ny,Eu,n),Ro(Ny,Ny),nh(Fy,Cu,o),Ro(Fy,Fy),nh(Uy,Su,a),Ro(Uy,Uy),_1(t,Ny,n,Eu,Su,l),_1(t,Fy,o,Cu,Eu,l),_1(t,Uy,a,Su,Cu,l)),_C[0]!==void 0&&(sh(Su,_C,r),Ro(Su,Su),sh(Eu,_C,i),Ro(Eu,Eu),sh(Cu,_C,s),Ro(Cu,Cu),nh(Ny,Eu,n),Ro(Ny,Ny),nh(Fy,Cu,o),Ro(Fy,Fy),nh(Uy,Su,a),Ro(Uy,Uy),_1(t,Ny,n,Eu,Su,l),_1(t,Fy,o,Cu,Eu,l),_1(t,Uy,a,Su,Cu,l))}function Ddt(t,e,r){let i=BG(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=BG(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}dc(e,t.minVert[s]),dc(r,t.maxVert[s])}const Au=[0,0,0];function Ndt(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Au[0]=s[l]-e[0],Au[1]=s[l+1]-e[1],Au[2]=s[l+2]-e[2];const c=r[0]*Au[0]+r[1]*Au[1]+r[2]*Au[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],d=Au[0]*Au[0]+Au[1]*Au[1]+Au[2]*Au[2]-c*c/h;d>o&&(o=d,a=l)}return dc(i,s,a),o}const mn=[0,0];function Fdt(t,e,r,i,s){Vdt(t,e,mn,s,i);const n=NEe(r,e);mn[1]-MS<=n&&(i[0]=void 0),mn[0]+MS>=n&&(s[0]=void 0)}const Gae=[0,0,0],jae=[0,0,0],Hae=[0,0,0],Mx=[0,0,0],Ix=[0,0,0],DI=[0,0,0];function _1(t,e,r,i,s,n){if(DEe(e)<MS)return;nh(Gae,r,e),nh(jae,i,e),nh(Hae,s,e),P2(t,e,mn),Ix[1]=mn[0],Mx[1]=mn[1],DI[1]=Mx[1]-Ix[1];const o=[r,i,s],a=[Gae,jae,Hae];for(let l=0;l<3;++l){P2(t,o[l],mn),Ix[0]=mn[0],Mx[0]=mn[1],P2(t,a[l],mn),Ix[2]=mn[0],Mx[2]=mn[1],DI[0]=Mx[0]-Ix[0],DI[2]=Mx[2]-Ix[2];const c=kG(DI);c<n.quality&&(dc(n.b0,o[l]),dc(n.b1,e),dc(n.b2,a[l]),n.quality=c)}}const Udt=[0,0,0];function P2(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function Vdt(t,e,r,i,s){const{data:n,size:o}=t;dc(i,n),dc(s,i),r[0]=NEe(Udt,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,dc(i,n,a)),l>r[1]&&(r[1]=l,dc(s,n,a))}}function qae(t,e,r){dc(r.center,t),J1(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const xm=[0,0,0],$x=[0,0,0],vC=[0,0,0],M2=[0,0,0],I2=[0,0,0],Wae=[0,0,0];function zdt(t,e,r){dc(xm,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?xm[0]=0:Math.abs(e[1])>Math.abs(e[2])?xm[1]=0:xm[2]=0,DEe(xm)<MS&&(xm[0]=xm[1]=xm[2]=1),nh($x,e,xm),Ro($x,$x),nh(vC,e,$x),Ro(vC,vC),$Ee(t,e,$x,vC,M2,I2),sh(Wae,I2,M2),LEe(e,$x,vC,M2,I2,Wae,r)}function $Ee(t,e,r,i,s,n){P2(t,e,mn),s[0]=mn[0],n[0]=mn[1],P2(t,r,mn),s[1]=mn[0],n[1]=mn[1],P2(t,i,mn),s[2]=mn[0],n[2]=mn[1]}const NI=[0,0,0],$p=[1,0,0,0,1,0,0,0,1],Lx=[0,0,0];function LEe(t,e,r,i,s,n,o){$p[0]=t[0],$p[1]=t[1],$p[2]=t[2],$p[3]=e[0],$p[4]=e[1],$p[5]=e[2],$p[6]=r[0],$p[7]=r[1],$p[8]=r[2],Gdt(o.quaternion,$p),zL(Lx,i,s),J1(Lx,Lx,.5),J1(o.center,t,Lx[0]),J1(NI,e,Lx[1]),zL(o.center,o.center,NI),J1(NI,r,Lx[2]),zL(o.center,o.center,NI),J1(o.halfSize,n,.5)}const Mc=7;let kdt=class{constructor(e){this.minVert=new Array(Mc),this.maxVert=new Array(Mc);const r=64*Mc;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Mc),i+=8*Mc,this.maxProj=new Float64Array(this.buffer,i,Mc),i+=8*Mc;for(let l=0;l<Mc;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Mc;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Mc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Mc),n=new Array(Mc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Mc;++l){let c=s[l];dc(this.minVert[l],o,c),c=n[l],dc(this.maxVert[l],o,c)}}},Bdt=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function kG(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function zL(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function sh(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function J1(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function dc(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function nh(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function Ro(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function DEe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function BG(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function NEe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Gdt(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}}const Mb=Mh(),Ia=A(),GG=A(),jdt=Fi();let i4t=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:Sq(this.buffer,56*a+0),halfSize:I_e(this.buffer,56*a+24),quaternion:IEe(this.buffer,56*a+36)}}};function kY(t=[0,0,0],e=[-1,-1,-1],r=Mh()){return{center:Is(t),halfSize:bN(e),quaternion:MEe(r)}}function Zae(t){return kY(t.center,t.halfSize,t.quaternion)}function n4t(t,e){re(e.center,t.center),re(e.halfSize,t.halfSize),NR(e.quaternion,t.quaternion)}function FEe(t,e){return e=e||kY(),Idt(t,e),e}function v1(t,e){const r=fi(e,t.center),i=o6(t,e);return r>i?1:r<-i?-1:0}function o4t(t,e){return Ia[0]=t.center[0]-e[0],Ia[1]=t.center[1]-e[1],Ia[2]=t.center[2]-e[2],Gf(Mb,t.quaternion),mc(Ia,Ia,Mb),VD(Ia,Ia),Oq(GG,Ia,t.halfSize),a5(GG,Ia)<e[3]*e[3]}function a4t(t,e){e||(e=ln());const r=tF(jdt,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),s=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),n=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+i,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function l4t(t,e){return fi(e,t.center)-o6(t,e)}function c4t(t,e){return fi(e,t.center)+o6(t,e)}function u4t(t,e){return v1(t,e[0])<=0&&v1(t,e[1])<=0&&v1(t,e[2])<=0&&v1(t,e[3])<=0&&v1(t,e[4])<=0&&v1(t,e[5])<=0}function h4t(t,e,r,i=0){Gf(Mb,t.quaternion),he(Ia,e,t.center);const s=mc(Ia,Ia,Mb),n=mc(GG,r,Mb);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+t.halfSize[l]-s[l])/n[l],h=(-i-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>t.halfSize[l]+i||s[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function o6(t,e){Gf(Mb,t.quaternion),mc(Ia,e,Mb);const r=t.halfSize;return Math.abs(Ia[0]*r[0])+Math.abs(Ia[1]*r[1])+Math.abs(Ia[2]*r[2])}function UEe(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],mc(i,i,t.quaternion),le(i,i,t.center)}}function Hdt(t){return Jl(t.halfSize)}function qdt(t,e,r,i,s){if(NR(s.quaternion,t.quaternion),i===Le.Global){Gf(FI,t.quaternion),mc(Vy,t.center,FI),VD(Dx,Vy),Oq(Nx,Dx,t.halfSize),bn(Nx,Dx,Nx);const n=Ee(Nx);le(Nx,Dx,t.halfSize);const o=Ee(Nx);if(n<r)re(s.center,t.center),se(Vy,r,r,r),le(s.halfSize,t.halfSize,Vy);else{const a=o>0?1+e/o:1,l=n>0?1+r/n:1,c=(l+a)/2,h=(l-a)/2;ie(s.halfSize,Dx,h),tb(s.halfSize,s.halfSize,t.halfSize,c),ie(s.center,Dx,c),tb(s.center,s.center,t.halfSize,h),ppe(Vy,Vy),o5(s.center,s.center,Vy),mc(s.center,s.center,s.quaternion)}}else{const n=se(Vy,0,0,1);tb(s.center,t.center,n,(r+e)/2),Gf(FI,t.quaternion),mc(n,n,FI),VD(n,n),tb(s.halfSize,t.halfSize,n,(r-e)/2)}return s}const Vy=A(),Dx=A(),Nx=A(),FI=Mh();let Wdt=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Zdt(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function Zdt(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let Xdt=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new Wdt(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=Ydt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function Ydt(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let F3=class extends xe{constructor(){super(...arguments),this.visible=$2.Hidden}};var $2;u([p({autoDestroy:!0})],F3.prototype,"renderable",void 0),u([p({autoDestroy:!0})],F3.prototype,"components",void 0),F3=u([R("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],F3),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}($2||($2={}));function Jdt(t,e,r,i){if(r>=e)return t;t==null&&(t=Qdt());const s=t.isVisibleBit;let n=t.data;const o=zEe(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,h=n,d=i===s;if(!(r<h.length*o)&&d){const f=a+1,m=Math.ceil(h.length*G4),y=c+1;let _=Math.max(f,m);_=Math.min(_,y),n=new Uint32Array(_),n.set(h)}return a<n.length&&(n[a]=ept(n[a],l,d)),t.data=n,t}function VEe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=zEe(i);return e<i.length*s?Kdt(r,i,e,s):!t.isVisibleBit}function Qdt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function Kdt(t,e,r,i){const s=r/i|0,n=r-s*i;return tpt(e[s],n)===t}function zEe(t){return t.BYTES_PER_ELEMENT*8}function ept(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function tpt(t,e){return(t&1<<e)!=0}let rpt=class{constructor(e,r){this._components=r,this._indices=e.indices!=null?Pf(e.indices):mS(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a){const l=new Ve(this._positions,3,!1,3),c=this._indices,h=this._components.offsets,d=_be(e,r,ipt),f=e[2],m=r[2];this._components.visibility.forEachComponent(y=>{if(!VEe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,spt);if(o!=null){const x=o[y];n!=null?n.componentOffset=x:(e[2]=f-x,r[2]=m-x)}if(n!=null&&n.applyToAabb(_),!aX(_,e,d,i))return!0;const v=h[y]/3,w=h[y+1]/3,T=(x,S,O)=>a(y,x,cc(S,S,s),O);return n==null&&w-v>AEe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new zY(this._indices,v,w,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:r},T)):zR(e,r,v,w,c,l,void 0,n,T),!0})}_computePerComponentAabbs(){const e=this._components.count,r=Qi(6*e),i=this._indices,s=this._positions,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let h=1/0,d=1/0,f=1/0,m=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const w=3*i[v],T=s[w],x=s[w+1],S=s[w+2];h=Math.min(h,T),d=Math.min(d,x),f=Math.min(f,S),m=Math.max(m,T),y=Math.max(y,x),_=Math.max(_,S)}r[o++]=h,r[o++]=d,r[o++]=f,r[o++]=m,r[o++]=y,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}};const ipt=A(),spt=ln();let npt=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},opt=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},apt=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function lpt(t,e){return{near:t,far:e}}function tP(t){return t?eR(t,1/0,-1/0):lpt(1/0,-1/0)}function eR(t,e,r){return t.near=e,t.far=r,t}function IS(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function UI(t,e){return t.near<=e&&e<=t.far}const jG={near:0,far:0};function cpt(t,e){const r=tP(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=me(bn(Nc,a.center,i),n),c=o6(a,n);if(UI(r,l-c)&&UI(r,l+c))return;const h=fpt(a,s);if(h===-1)return;if(h===0)return Tm.far=l+c,Tm.near=l-c,void IS(r,Tm);const d=VI.pushNew();d.near=l-c,d.far=l+c,d.mask=h,d.object=o});for(let o=0;o<VI.length;o++){const a=VI.data[o];if(UI(r,a.near)&&UI(r,a.far))continue;Tm.far=a.far,Tm.near=1/0,ppt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,upt,c=>{let h=hpt;for(let d=0;d<kEe&&c.length>0;d++){if(!(a.mask&1<<d))continue;dpt(s[d],c,h);const f=c;c=h,h=f}for(let d=0;d<c.length;d+=3){se(fl,c.data[d],c.data[d+1],c.data[d+2]);const f=me(bn(fl,fl,i),n);Tm.near=Math.min(Tm.near,f)}})===0&&(Tm.near=0),IS(r,Tm)}return VI.length=0,r}const VI=new Gt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=DS(t.object),t)}),Tm=tP(),fl=A(),Dv=A(),upt=new Gt({deallocator:null}),hpt=new Gt({deallocator:null});function dpt(t,e,r){r.length=0;const i=e.length-3;I9(fl,e,i);const s=fi(t,fl);s<=0&&(r.push(fl[0]),r.push(fl[1]),r.push(fl[2]));let n=0,o=s;for(;n<i;n+=3){I9(Dv,e,n);const a=fi(t,Dv);o*a<0&&(Gr(fl,Dv,fl,a/(a-o)),ml(r,fl)),a<=0&&ml(r,Dv),o=a,re(fl,Dv)}o*s<0&&(I9(Dv,e,i),Gr(fl,Dv,fl,s/(s-o)),ml(r,fl))}function I9(t,e,r){return se(t,e.data[r],e.data[r+1],e.data[r+2])}function ml(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function ppt(t,e,r,i){Gf(Yae,t.quaternion),bn(Nc,e,t.center),mc(Nc,Nc,Yae);const s=8*((Nc[0]<-t.halfSize[0]?-1:Nc[0]>t.halfSize[0]?1:0)+3*(Nc[1]<-t.halfSize[1]?-1:Nc[1]>t.halfSize[1]?1:0)+9*(Nc[2]<-t.halfSize[2]?-1:Nc[2]>t.halfSize[2]?1:0)+13),n=Xae[s];if(n===0)return n;tF(zI,t.quaternion),fZ(zI,zI,t.halfSize);const o=(a,l)=>{const c=Xae[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),cc(a,a,zI),le(a,t.center,a)};return r.length=0,ml(r,o($9,0)),ml(r,o(Jae,1)),ml(r,o(Nc,2)),ml(r,o(Qae,3)),i(r),n===1||(r.length=0,ml(r,$9),ml(r,Qae),ml(r,o(Nc,4)),ml(r,o(Kae,5)),i(r),n===2||(r.length=0,ml(r,$9),ml(r,Kae),ml(r,o(Nc,6)),ml(r,Jae),i(r))),n}const Xae=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),kEe=4;function fpt(t,e){let r=0;for(let i=0;i<kEe;i++){const s=v1(t,e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const zI=Fi(),Yae=Mh(),Nc=A(),$9=A(),Jae=A(),Qae=A(),Kae=A();let mpt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?cpt(e,this._objects.visibleObjects):null}};function gpt(t){const e=Hi().vec3f(E.POSITION);return t.normals&&e.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Ps.Default?e.vec2f(E.UV0):t.textureCoordinates===Ps.Atlas&&(e.vec2f(E.UV0),e.vec4u16(E.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(E.COLOR,{glNormalized:!0}),e}let ypt=class{constructor(){this.externalColor=Yt(),this.externalColorMixMode=Us.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},_pt=class extends cs{constructor(e,r){super(e,"int",Qr.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var $f;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})($f||($f={}));const BY=429496.7296;function BEe(t,e){zO(t/BY*.5+.5,e)}function vpt(t,e){switch(e.componentData){case $f.Varying:return bpt(t,e);case $f.Uniform:return wpt(t);case $f.COUNT:return;default:e.componentData}}function bpt(t,e){const{vertex:r,fragment:i}=t;r.include(Tc),r.uniforms.add(new ph("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(E.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===L.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(RTe),r.constants.add("elevationScale","float",2*BY),r.constants.add("stride","float",oe("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(b`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(b`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?b`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:b`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(b`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?b`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function wpt(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new v4("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new _pt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(b`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(b`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var lh;function xpt(t,e){const r=t.vertex;switch(r.code.add(b`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case lh.None:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) {}`);break;case lh.Opaque:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case lh.Transparent:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(lh||(lh={}));var Lf;function x4t(t){return t&&Yf(t)?Lf.Mars:t&&Jf(t)?Lf.Moon:Lf.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Lf||(Lf={}));var Yc;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Yc||(Yc={}));let cr=class extends ha{constructor(){super(...arguments),this.output=L.Color,this.textureCoordinateType=Ps.None,this.componentData=$f.Uniform,this.cullFace=gi.Back,this.vertexDiscardMode=lh.None,this.doubleSidedMode=Ki.WindingOrder,this.alphaDiscardMode=Xr.Opaque,this.integratedMeshMode=Yc.None,this.transparencyPassType=st.NONE,this.ellipsoidMode=Lf.Earth,this.pbrMode=rt.Disabled,this.normalType=Or.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};u([F({count:L.COUNT})],cr.prototype,"output",void 0),u([F({count:Ps.COUNT})],cr.prototype,"textureCoordinateType",void 0),u([F({count:$f.COUNT})],cr.prototype,"componentData",void 0),u([F({count:gi.COUNT})],cr.prototype,"cullFace",void 0),u([F({count:lh.COUNT})],cr.prototype,"vertexDiscardMode",void 0),u([F({count:Ki.COUNT})],cr.prototype,"doubleSidedMode",void 0),u([F({count:Xr.COUNT})],cr.prototype,"alphaDiscardMode",void 0),u([F({count:Yc.COUNT})],cr.prototype,"integratedMeshMode",void 0),u([F({count:st.COUNT})],cr.prototype,"transparencyPassType",void 0),u([F({count:Lf.COUNT})],cr.prototype,"ellipsoidMode",void 0),u([F({count:rt.COUNT})],cr.prototype,"pbrMode",void 0),u([F({count:Or.COUNT})],cr.prototype,"normalType",void 0),u([F()],cr.prototype,"spherical",void 0),u([F()],cr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],cr.prototype,"hasVertexColors",void 0),u([F()],cr.prototype,"hasNormals",void 0),u([F()],cr.prototype,"hasSlicePlane",void 0),u([F()],cr.prototype,"hasBaseColorTexture",void 0),u([F()],cr.prototype,"receiveAmbientOcclusion",void 0),u([F()],cr.prototype,"receiveShadows",void 0),u([F()],cr.prototype,"blendingEnabled",void 0),u([F()],cr.prototype,"hasScreenSpaceReflections",void 0),u([F()],cr.prototype,"hasPolygonOffset",void 0),u([F()],cr.prototype,"hasMetallicRoughnessTexture",void 0),u([F()],cr.prototype,"hasEmissionTexture",void 0),u([F()],cr.prototype,"hasOcclusionTexture",void 0),u([F()],cr.prototype,"hasNormalTexture",void 0),u([F()],cr.prototype,"hasOccludees",void 0),u([F()],cr.prototype,"hasMultipassTerrain",void 0),u([F()],cr.prototype,"cullAboveGround",void 0),u([F()],cr.prototype,"hasCloudsReflections",void 0),u([F()],cr.prototype,"snowCover",void 0),u([F()],cr.prototype,"objectAndLayerIdColor",void 0),u([F({constValue:Qr.Draw})],cr.prototype,"pbrTextureBindType",void 0),u([F({constValue:!0})],cr.prototype,"hasSliceHighlight",void 0),u([F({constValue:!1})],cr.prototype,"hasSliceInVertexProgram",void 0),u([F({constValue:!1})],cr.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!1})],cr.prototype,"hasVertexTangents",void 0),u([F({constValue:!0})],cr.prototype,"supportsTextureAtlas",void 0),u([F({constValue:!1})],cr.prototype,"highStepCount",void 0),u([F({constValue:!1})],cr.prototype,"instancedDoublePrecision",void 0),u([F({constValue:!0})],cr.prototype,"useFillLights",void 0),u([F({constValue:!1})],cr.prototype,"objectAndLayerIdColorInstanced",void 0);function ele(t,e){t.include(Lw,e),t.fragment.include(WO);const r=t.fragment;r.uniforms.add(new v4("baseColor",i=>i.baseColor)),r.uniforms.add(new Ab("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(b`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(b`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(b`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function tle(t,e){const r=t.fragment;switch(e.doubleSidedMode){case Ki.None:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Ki.View:t.include(_2,e),r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Ki.WindingOrder:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Ki.COUNT:}switch(e.normalType){case Or.Attribute:case Or.Compressed:t.include(GF,e),r.code.add(b`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Or.ScreenDerivative:t.include(_2,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Or.Ground:e.spherical?(t.include(_2,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(b`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(b`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Or.COUNT:}}function Tpt(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===L.Color||e.alphaDiscardMode!==Xr.Opaque)){t.include(oZ,e);const i=e.textureCoordinateType===Ps.Atlas;r.uniforms.add(new ph("baseColorTexture",s=>s.texture)),i?(t.include(E_e),r.code.add(b`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(b`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(b`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Spt(t){const e=new wr;e.include(_2,t),e.include(GF,t),e.include(Lw,t),e.include(Of,t),e.include(iE,t),e.include(vpt,t),e.include(Met,t),e.include(rXe,t),e.include(Tpt,t),e.include(xpt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==rt.Normal&&t.pbrMode!==rt.Schematic||(e.include(lZ,t),t.hasNormalTexture&&e.include($Te,t));const s=t.output===L.Shadow||t.output===L.ShadowHighlight||t.output===L.ShadowExcludeHighlight;s&&t.componentData===$f.Varying?r.code.add(b`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(b`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===Yc.ColorOverlay||t.integratedMeshMode===Yc.ColorOverlayWithWater,o=n&&t.output===L.Color&&t.pbrMode===rt.WaterOnIntegratedMesh;return n&&(e.include(ow,t),e.include(But,t),t.spherical?r.code.add(b`
      const float invEllipsoidRadius = ${b.float(1/(t.ellipsoidMode===Lf.Earth?sr.radius:t.ellipsoidMode===Lf.Mars?Tf.radius:Mg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(b`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(b`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===L.ObjectAndLayerIdColor?b`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${b.float(ho)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===L.ObjectAndLayerIdColor?b`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?b`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?b`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===L.Alpha&&(i.include(fu),e.include(mu,t),e.include(ele,t),n&&i.uniforms.add(new Je("ovColorTex",(a,l)=>PG(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===L.Color&&(i.include(fu),e.include(mu,t),e.include(ele,t),e.include(tle,t),e.include(ow,t),t.receiveShadows?(e.include(jF,t),i.code.add(b`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(b`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new Je("ovColorTex",(a,l)=>PG(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===rt.Normal||t.pbrMode===rt.Schematic?(tm(i),i.code.add(b`
        ${t.pbrMode===rt.Normal?b`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(b`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(b`vec3 shadingNormal = normalVertex;`),i.code.add(b`${t.spherical?b`vec3 normalGround = normalize(positionWorld());`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(b`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?b`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(b`float shadow = evaluateShadow();`):t.spherical?(dE(i),i.code.add(b`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(b`float shadow = 0.0;`),o&&i.uniforms.add(new Je("ovNormalTex",(a,l)=>GY(l))),t.snowCover&&i.code.add(b`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(b`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?b`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(b`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===L.Depth||s)&&(e.include(Bg,t),i.code.add(b`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===L.Normal&&(e.include(tle,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===Or.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===L.ObjectAndLayerIdColor&&e.fragment.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===L.Highlight&&(e.include(ty,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function GY(t){return t.overlays.length===0?null:t.overlays[$i.INNER].getValidTexture(ss.Water)}const Ept=Object.freeze(Object.defineProperty({__proto__:null,build:Spt,getOverlayNormalTexture:GY},Symbol.toStringTag,{value:"Module"}));let GEe=class jEe extends Pr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Le.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Cr(e.rctx,jEe.shader.get().build(this.configuration),HEe)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==Yc.None,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:r.output!==L.Color&&r.output!==L.Alpha||!r.blendingEnabled?null:s?ou:ry(e),culling:eF(r.cullFace),depthTest:{func:q_(e)},depthWrite:s||n?Al:null,colorWrite:jt,stencilWrite:i||r.hasOccludees?Hf:null,stencilTest:i?oKe(Tl.IntegratedMeshMaskExcluded):r.hasOccludees?W_:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:PF})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};GEe.shader=new Er(Ept,()=>ae(()=>import("./ComponentShader.glsl-3e11917a.js"),[]));const HEe=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.COLOR,2],[E.UV0,3],[E.UVREGION,4],[E.COMPONENTINDEX,5]]);let Cpt=class extends ei{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},jY=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function rs(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function rle(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let a6=class{constructor(e){this._low=A(),this._high=A(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){re(this._low,re(ile,e));const r=bn(ile,e,this._low);re(this._high,r)}get(e){return le(e,this._low,this._high)}getLowScaled(e){return ie(e,this._low,1)}};const ile=ns();let In=class extends Cpt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Ft(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Da(qF),this.emissiveFactor=Ae(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new kL,this.componentParameters=new JA,this.textureAlphaCutoff=XN,this.alphaDiscardMode=Xr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Lf.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new cr;const i=new a6(e.position),s=LTe(e.rotationScale);Rw(s,s),this.transformNormalGlobalFromModel=iye(Ch(s,s)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Bi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===ac.Material&&i.transparencyPassType!=null?i.transparencyPassType:st.NONE,n.hasMultipassTerrain=r.identifier===ac.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===ac.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Ki.View:Ki.None,n.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Pa.Transparent||o===Pa.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Opt(i)?GY(i)?Yc.ColorOverlayWithWater:Yc.ColorOverlay:Yc.NoOverlay:Yc.None,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(n.pbrMode=n.integratedMeshMode===Yc.ColorOverlayWithWater?rt.WaterOnIntegratedMesh:this.usePBR?a?rt.Schematic:rt.Normal:rt.Disabled,n.normalType=n.integratedMeshMode===Yc.None?n.hasNormals?Or.Compressed:Or.ScreenDerivative:Or.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===ac.ShadowMap)n.output=L.Shadow,n.vertexDiscardMode=lh.None;else if(r.identifier===ac.Highlight)n.output=L.Highlight,n.vertexDiscardMode=lh.None;else{switch(this._computeWhichMaterialPass()===Pa.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?lh.Opaque:lh.Transparent:n.vertexDiscardMode=lh.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case L.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case L.Alpha:n.hasOccludees=i.hasOccludees;break;case L.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(GEe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Pa.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Pa.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Pa.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Pa.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),Apt(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==_n.None;h&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),h&&e.highlightShadowMap.submitDraw(this,s,l,o)),h&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Pa.IntegratedMesh:this.objectOpacity<1?Pa.Transparent:this.componentParameters.opaqueOverride===_n.All?Pa.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Xr.Blend||this.alphaDiscardMode===Xr.MaskBlend?Pa.Transparent:this.componentParameters.transparent===_n.None?Pa.Opaque:this.componentParameters.transparent===_n.All?Pa.Transparent:Pa.OpaqueAndTransparent}};var Pa,_n;u([rs({vectorOps:wpe})],In.prototype,"baseColor",void 0),u([rs()],In.prototype,"usePBR",void 0),u([rs()],In.prototype,"hasParametersFromSource",void 0),u([rs({vectorOps:PQ})],In.prototype,"mrrFactors",void 0),u([rs({vectorOps:PQ})],In.prototype,"emissiveFactor",void 0),u([rs({dispose:!0})],In.prototype,"baseColorTexture",void 0),u([rs({dispose:!0})],In.prototype,"metallicRoughnessTexture",void 0),u([rs({dispose:!0})],In.prototype,"emissionTexture",void 0),u([rs({dispose:!0})],In.prototype,"occlusionTexture",void 0),u([rs({dispose:!0})],In.prototype,"normalTexture",void 0),u([rs()],In.prototype,"objectOpacity",void 0),u([rle()],In.prototype,"commonMaterialParameters",void 0),u([rle()],In.prototype,"componentParameters",void 0),u([rs()],In.prototype,"textureAlphaCutoff",void 0),u([rs()],In.prototype,"alphaDiscardMode",void 0),u([rs()],In.prototype,"isIntegratedMesh",void 0),u([rs()],In.prototype,"polygonOffsetEnabled",void 0),u([rs()],In.prototype,"ellipsoidMode",void 0),u([rs()],In.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Pa||(Pa={}));let kL=class extends jY{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=gi.Back,this.hasSlicePlane=!0}};u([rs()],kL.prototype,"doubleSided",void 0),u([rs()],kL.prototype,"cullFace",void 0),u([rs()],kL.prototype,"hasSlicePlane",void 0);let JA=class extends jY{constructor(){super(...arguments),this.externalColor=Ft(1,1,1,1),this.externalColorMixMode=Us.Multiply,this.castShadows=_n.All}get transparent(){return this.externalColor[3]<1?_n.All:_n.None}get opaqueOverride(){return this.externalColorMixMode===Us.Replace&&this.externalColor[3]===1?_n.All:_n.None}get visible(){return this.externalColor[3]>0?_n.All:_n.None}get type(){return $f.Uniform}};u([rs({vectorOps:wpe})],JA.prototype,"externalColor",void 0),u([rs()],JA.prototype,"externalColorMixMode",void 0),u([rs()],JA.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(_n||(_n={}));let U3=class extends jY{constructor(){super(...arguments),this.texture=null,this.transparent=_n.None,this.opaqueOverride=_n.None,this.castShadows=_n.None}get type(){return $f.Varying}};function Apt(t){return t.overlays.length!==0&&t.overlays[$i.INNER].getValidTexture(ss.Highlight)!=null}function Opt(t){return t.overlays.length!==0&&t.overlays[$i.INNER].getColorTextureNoRasterImage()!=null}u([rs()],U3.prototype,"texture",void 0),u([rs()],U3.prototype,"transparent",void 0),u([rs()],U3.prototype,"opaqueOverride",void 0),u([rs()],U3.prototype,"castShadows",void 0);const S4=Hi().vec3f(E.POSITION).u16(E.COMPONENTINDEX).u16(E.U16PADDING),qEe=Hi().vec2u8(E.SIDENESS),Rpt=Sc(qEe),WEe=Hi().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u8(E.VARIANTOFFSET,{glNormalized:!0}).u8(E.VARIANTSTROKE).u8(E.VARIANTEXTENSION,{glNormalized:!0}).u8(E.U8PADDING,{glPadding:!0}).u16(E.U16PADDING,{glPadding:!0}),HG=WEe.clone().vec3f(E.NORMAL),qG=WEe.clone().vec3f(E.NORMALA).vec3f(E.NORMALB),ZEe=new Map([[E.POSITION0,0],[E.POSITION1,1],[E.COMPONENTINDEX,2],[E.VARIANTOFFSET,3],[E.VARIANTSTROKE,4],[E.VARIANTEXTENSION,5],[E.NORMAL,6],[E.NORMALA,6],[E.NORMALB,7],[E.SIDENESS,8]]);function sle(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(w,T)=>{w<T?s[w+1]++:n[T+1]++};for(let w=0;w<i;w++){const T=t[3*w],x=t[3*w+1],S=t[3*w+2];o(T,x),o(x,S),o(S,T)}let a=0,l=0;for(let w=0;w<r;w++){const T=s[w+1],x=n[w+1];s[w+1]=a,n[w+1]=l,a+=T,l+=x}const c=new Uint32Array(6*i),h=s[r],d=(w,T,x)=>{if(w<T){const S=s[w+1]++;c[2*S]=T,c[2*S+1]=x}else{const S=n[T+1]++;c[2*h+2*S]=w,c[2*h+2*S+1]=x}};for(let w=0;w<i;w++){const T=t[3*w],x=t[3*w+1],S=t[3*w+2];d(T,x,w),d(x,S,w),d(S,T,w)}const f=(w,T)=>{const x=2*w,S=T-w;for(let O=1;O<S;O++){const C=c[x+2*O],P=c[x+2*O+1];let $=O-1;for(;$>=0&&c[x+2*$]>C;$--)c[x+2*$+2]=c[x+2*$],c[x+2*$+3]=c[x+2*$+1];c[x+2*$+2]=C,c[x+2*$+3]=P}};for(let w=0;w<r;w++)f(s[w],s[w+1]),f(h+n[w],h+n[w+1]);const m=new Int32Array(3*i),y=(w,T)=>w===t[3*T]?0:w===t[3*T+1]?1:w===t[3*T+2]?2:-1,_=(w,T)=>{const x=y(w,T);m[3*T+x]=-1},v=(w,T,x,S)=>{const O=y(w,T);m[3*T+O]=S;const C=y(x,S);m[3*S+C]=T};for(let w=0;w<r;w++){let T=s[w];const x=s[w+1];let S=n[w];const O=n[w+1];for(;T<x&&S<O;){const C=c[2*T],P=c[2*h+2*S];C===P?(v(w,c[2*T+1],P,c[2*h+2*S+1]),T++,S++):C<P?(_(w,c[2*T+1]),T++):(_(P,c[2*h+2*S+1]),S++)}for(;T<x;)_(w,c[2*T+1]),T++;for(;S<O;)_(c[2*h+2*S],c[2*h+2*S+1]),S++}return m}let XEe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?Mpt:Ppt}write(e,r,i){const s=this._edgeHashFunction(i);BI.seed=s;const n=BI.getIntRange(0,255),o=BI.getIntRange(0,this.settings.variants-1),a=.7,l=BI.getFloat(),c=255*(.5*Ipt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const HY=new Float32Array(6),E4=new Uint32Array(HY.buffer),n_=new Uint32Array(1);function Ppt(t){const e=HY;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],n_[0]=5381;for(let r=0;r<E4.length;r++)n_[0]=31*n_[0]+E4[r];return n_[0]}function Mpt(t){const e=HY;e[0]=Fx(t.position0[0]),e[1]=Fx(t.position0[1]),e[2]=Fx(t.position0[2]),e[3]=Fx(t.position1[0]),e[4]=Fx(t.position1[1]),e[5]=Fx(t.position1[2]),n_[0]=5381;for(let r=0;r<E4.length;r++)n_[0]=31*n_[0]+E4[r];return n_[0]}const nle=1e4;function Fx(t){return Math.round(t*nle)/nle}function Ipt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let C4=class{constructor(){this._commonWriter=new XEe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return HG.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),le(kI,i.faceNormal0,i.faceNormal1),ge(kI,kI),e.normal.setVec(r,kI)}trim(e,r){return this._commonWriter.trim(e,r)}};C4.Layout=HG,C4.glLayout=Sc(HG,1);let A4=class{constructor(){this._commonWriter=new XEe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return qG.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};A4.Layout=qG,A4.glLayout=Sc(qG,1);const kI=A(),BI=new oA,b1=-1;var O4;function $pt(t,e,r,i=Vpt){const s=t.vertices.position,n=t.vertices.componentIndex,o=Ut(i.anglePlanar),a=Ut(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=WG.edge,d=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,_=Upt(t),v=Fpt(t),w=v.length/4,T=e.allocate(w);let x=0;const S=w,O=r.allocate(S);let C=0,P=0,$=0;const V=WOe(0,w),z=new Float32Array(w);z.forEach((j,Y,M)=>{s.getVec(v[4*Y],d),s.getVec(v[4*Y+1],f),M[Y]=mi(d,f)}),V.sort((j,Y)=>z[Y]-z[j]);const B=new Array,k=new Array;for(let j=0;j<w;j++){const Y=V[j],M=z[Y],D=v[4*Y],N=v[4*Y+1],G=v[4*Y+2],X=v[4*Y+3],J=X===b1;if(s.getVec(D,d),s.getVec(N,f),J)se(m,_[3*G],_[3*G+1],_[3*G+2]),re(y,m),h.componentIndex=n.get(D),h.cosAngle=me(m,y);else{if(se(m,_[3*G],_[3*G+1],_[3*G+2]),se(y,_[3*X],_[3*X+1],_[3*X+2]),h.componentIndex=n.get(D),h.cosAngle=me(m,y),Dpt(h,c))continue;h.cosAngle<-.9999&&re(y,m)}P+=M,$++,J||Lpt(h,l)?(e.write(T,x++,h),B.push(M)):Npt(h,o)&&(r.write(O,C++,h),k.push(M))}const Z=new Float32Array(B.reverse()),W=new Float32Array(k.reverse());return{regular:{instancesData:e.trim(T,x),lodInfo:{lengths:Z}},silhouette:{instancesData:r.trim(O,C),lodInfo:{lengths:W}},averageEdgeLength:P/$}}function Lpt(t,e){return t.cosAngle<e}function Dpt(t,e){return t.cosAngle>e}function Npt(t,e){const r=Sn(t.cosAngle),i=WG.fwd,s=WG.ortho;return Gg(i,t.position1,t.position0),r*(me(ot(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function Fpt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],d=r[3*a],f=r[3*a+1],m=r[3*a+2];s+=l===b1||d<f?1:0,s+=c===b1||f<m?1:0,s+=h===b1||m<d?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],d=r[3*a],f=r[3*a+1],m=r[3*a+2];(l===b1||d<f)&&(n[o++]=d,n[o++]=f,n[o++]=a,n[o++]=l),(c===b1||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===b1||m<d)&&(n[o++]=m,n[o++]=d,n[o++]=a,n[o++]=h)}return n}function Upt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=L9.v0,n=L9.v1,o=L9.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],h=i[3*l+1],d=i[3*l+2];r.getVec(c,s),r.getVec(h,n),r.getVec(d,o),he(n,n,s),he(o,o,s),ot(s,n,o),ge(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(O4||(O4={}));const WG={edge:{position0:A(),position1:A(),faceNormal0:A(),faceNormal1:A(),componentIndex:0,cosAngle:0},ortho:A(),fwd:A()},L9={v0:A(),v1:A(),v2:A()},Vpt={anglePlanar:4,angleSignificantEdge:35};function zpt(t){const e=kpt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return ole.updateSettings(t.writerSettings),ale.updateSettings(t.writerSettings),$pt(e,ole,ale)}function kpt(t,e,r,i){if(e){const o=sle(r,i,t.count);return new Bpt(r,i,o,t)}const s=eG(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=sle(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:S4.createView(s.buffer)}}let Bpt=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const ole=new C4,ale=new A4,D4t=Hi().vec3f(E.POSITION0).vec3f(E.POSITION1),Gpt=Hi().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u16(E.U16PADDING,{glPadding:!0});let jpt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},Hpt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new vr;i.samplingMode=At.NEAREST,i.wrapMode=Dt.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new Ct(this._rctx,i),this._data=new ca(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(e,r,i){const s=e*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new ca(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const YEe=65536;let qpt=class{constructor(e,r=1){this.textureBuffer=new Hpt(e,r),this._indexManager=new jpt(YEe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},JEe=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>YEe)return null;const r=new qpt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const lle=Q.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let Wpt=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Gt,new Gt],this._renderSubmit=new mpt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=oe("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new JEe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){tt(this._objects[$2.Hidden].length===0&&this._objects[$2.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r==null||r.destroy()}createObject(e){const r=new F3;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=Zae(e.obb),r.components=new Xdt(this._componentBufferManager,Pf(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new rpt(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=fo(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new ypt,c=o.textureBuffer,h=new Uint8Array(4),d=new Uint32Array(h.buffer);let f=0,m=0,y=0,_=n.verticalOffsets,v=1/0,w=-1/0,T=!1,x=!1,S=0;for(let O=0;O<n.count;O++){r(O,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Us.Replace&&l.externalColor[3]===1),y+=+l.castShadows,OTe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[O],0,h[0],h[1],h[2],h[3]),T||(T=O>0&&S!==d[0]),S=d[0],x||(x=l.elevationOffset!==0),x&&_==null&&(_=new Array(O).fill(0)),_!=null&&(_[O]=l.elevationOffset),v=Math.min(v,l.elevationOffset),w=Math.max(w,l.elevationOffset),BEe(l.elevationOffset,h),c.setData(a[O],1,h[0],h[1],h[2],h[3]);const C=l.objectAndLayerIdColor;C!=null&&c.setData(a[O],2,C[0],C[1],C[2],C[3]),l.pickable!==VEe(n.pickability,O)&&(n.pickability=Jdt(n.pickability,n.count,O,l.pickable))}n.verticalOffsets=x?_:null,i.offsetObb=x?qdt(i.obb,v,w,this._viewingMode,i.offsetObb!=null?i.offsetObb:Zae(i.obb)):null,T||x||this._hasObjectAndLayerId?(s.componentParameters=new U3,s.componentParameters.castShadows=D9(y,n.count),s.componentParameters.transparent=D9(f,n.count),s.componentParameters.opaqueOverride=D9(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new JA,s.componentParameters.castShadows=l.castShadows?_n.All:_n.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===Le.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=Eje(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,s,n,o){const a=e;n!=null&&(n.localOrigin=a.transform.position);const l=Rw(cle,a.transform.rotationScale);bn(GI,r,a.transform.position),bn(jI,i,a.transform.position),cc(GI,GI,l),cc(jI,jI,l);const c=Ch(cle,l);return a.intersectionGeometry.intersect(GI,jI,s,c,n,a.components.verticalOffsets,o)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(e,n.transform,{center:n.obb.center,radius:Hdt(n.obb)},a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:Gpt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=S4.createBuffer(a.length/3);eP(c.position.typedBuffer,a,c.position.typedBufferStride,3),bxe(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,d=this._computeVisibilityIndices(o,n,l,h);return{origin:Is(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=ep(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],d=i[c];for(let f=h;f<d;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void lle.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else lle.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[$2.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Lr.createVertex(i,Tr.STATIC_DRAW,s.vertices.data),a=lc(s.indices,_=>Lr.createIndex(i,Tr.STATIC_DRAW,_)),l=Sc(gpt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],w=r.offsets[_+1],T=r.materialDataIndices[_];if(s.indices!=null)for(let x=v;x<w;x++)c[s.indices[x]]=T;else for(let x=v;x<w;x++)c[x]=T}const h=Lr.createVertex(i,Tr.STATIC_DRAW,c.buffer),d=new In(e.transform,e.toMapSpace),f=new Sh(i,HEe,{data:l,componentIndices:Zpt},{data:o,componentIndices:h},a),m=new opt(f,Et.TRIANGLES,n,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+h.byteLength+(a!=null?a.byteLength:0)};return new npt(d,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}};const Zpt=Sc(Hi().u16(E.COMPONENTINDEX));function D9(t,e){return t===e?_n.All:t===0?_n.None:_n.Some}const cle=Sl(),GI=A(),jI=A();let QEe=class extends ei{constructor(){super(...arguments),this.scale=Ue()}};function Xpt(t){const e=new wr;e.attributes.add(E.POSITION,"vec2"),e.varyings.add("uv0","vec2"),e.varyings.add("uv1","vec2"),e.vertex.uniforms.add(new Sr("scale",i=>i.scale)),e.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),e.fragment.uniforms.add(new Je("tex",i=>i.texture),new Je("depthTexture",i=>i.depthTexture),new Sr("scale",i=>i.scale),new Sr("clampUV",i=>Ypt(i)));const r=t.haze;return e.fragment.code.add(b`
    void main() {
      ${r?b`vec4`:b`float`} depthSample = texture(depthTexture, uv0) ${r?"":b`.r`};
      if (depthSample ${r?b`== vec4(0)`:b`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),e}function Ypt(t){if(!t.texture)return ule;const e=nr(ule,t.texture.descriptor.width,t.texture.descriptor.height),r=JW(e,e,t.scale),i=K0e(r,r);return i_e(i,t.scale,i)}const ule=Ue(),Jpt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:QEe,build:Xpt},Symbol.toStringTag,{value:"Module"}));let KEe=class eCe extends Pr{initializeProgram(e){return new Cr(e.rctx,eCe.shader.get().build(this.configuration),br)}initializePipeline(){return this.configuration.haze?Ot({blending:bo(be.ONE,be.ZERO,be.ONE_MINUS_SRC_COLOR,be.ONE),depthTest:{func:Kr.ALWAYS},colorWrite:jt}):Ot({blending:wc(be.SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Kr.ALWAYS},colorWrite:jt})}};KEe.shader=new Er(Jpt,()=>ae(()=>import("./AtmosphereCompositing.glsl-4d762b29.js"),[]));let tCe=class extends ei{constructor(){super(...arguments),this.opacity=1}};function Qpt(t){const e=new wr;return e.include(Ih),e.fragment.uniforms.add(new Je("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Oe("opacity",r=>r.opacity)),e.fragment.code.add(b`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const Kpt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:tCe,build:Qpt},Symbol.toStringTag,{value:"Module"}));var ia;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(ia||(ia={}));let ZG=class extends ha{constructor(){super(...arguments),this.alphaMode=ia.None,this.hasOpacityFactor=!1}};u([F({count:ia.COUNT})],ZG.prototype,"alphaMode",void 0),u([F()],ZG.prototype,"hasOpacityFactor",void 0);let rCe=class iCe extends Pr{initializeProgram(e){return new Cr(e.rctx,iCe.shader.get().build(this.configuration),br)}initializePipeline(){switch(this.configuration.alphaMode){case ia.None:return Ot({colorWrite:jt});case ia.Alpha:return Ot({blending:bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt});case ia.PremultipliedAlpha:case ia.COUNT:return Ot({blending:wc(be.ONE,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt})}}};rCe.shader=new Er(Kpt,()=>ae(()=>import("./Compositing.glsl-6d62c690.js"),[]));let sCe=class extends ei{};function eft(){const t=new wr;return t.include(Ih),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.code.add(b`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const tft=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:sCe,build:eft},Symbol.toStringTag,{value:"Module"}));let nCe=class oCe extends Pr{initializeProgram(e){return new Cr(e.rctx,oCe.shader.get().build(),br)}initializePipeline(){return Ot({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};nCe.shader=new Er(tft,()=>ae(()=>import("./HUDCompositing.glsl-57d27c5a.js"),[]));let aCe=class extends ei{};function rft(){const t=new wr;return t.include(Ih),t.fragment.uniforms.add(new Je("colorTexture",e=>e.colorTexture),new Je("alphaTexture",e=>e.alphaTexture),new Je("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(b`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const ift=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:aCe,build:rft},Symbol.toStringTag,{value:"Module"}));let lCe=class cCe extends Pr{initializeProgram(e){return new Cr(e.rctx,cCe.shader.get().build(),br)}initializePipeline(){return Ot({blending:bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt})}};lCe.shader=new Er(ift,()=>ae(()=>import("./OITCompositing.glsl-37356bfc.js"),[]));let uCe=class extends ei{constructor(){super(...arguments),this.overlayIndex=$i.INNER,this.opacity=1}};function sft(){const t=new wr;return t.include(Ih),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.uniforms.add(new YR("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Oe("opacity",e=>e.opacity)),t.fragment.code.add(b`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const nft=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:uCe,build:sft},Symbol.toStringTag,{value:"Module"}));let hCe=class dCe extends Pr{initializeProgram(e){return new Cr(e.rctx,dCe.shader.get().build(),br)}initializePipeline(){return Ot({blending:wc(be.ONE,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt})}};hCe.shader=new Er(nft,()=>ae(()=>import("./OverlayCompositing.glsl-9776b77b.js"),[]));let oft=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new ZG,this._atmosphereConfiguration=new _N,this._passParameters=new tCe,this._atmosphereParameters=new QEe,this._oitParameters=new aCe,this._hudParameters=new sCe,this._overlayParameters=new uCe}destroy(){this._vao=Fe(this._vao)}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(lCe);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Et.TRIANGLE_STRIP,0,Do(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(nCe);i.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(Et.TRIANGLE_STRIP,0,Do(n,"geometry")),s.release()}compositeOverlay(e,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(hCe);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Et.TRIANGLE_STRIP,0,Do(a,"geometry")),o.release()}compositeAtmosphere(e,r,i,s,n){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTexture=i,this._atmosphereParameters.scale=s,this._atmosphereConfiguration.haze=n;const a=this._techniqueRepository.acquire(KEe,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Et.TRIANGLE_STRIP,0,Do(l,"geometry")),a.release()}composite(e,r,i=ia.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(rCe,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Et.TRIANGLE_STRIP,0,Do(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=Ol(this._rctx)),this._vao}};const aft=1e4,XG=100,lft=500,cft=500,uft=.1;function hft(t,e,r){return dX(e,t)*(r[1]-r[0])+r[0]}function dft(t,e,r){let i=0;if(!e.some(n=>(i+=n.numGeometries,i>=aft)))return bft.compute(t,e);const s=tP();return r.forAll(n=>{n.visible&&IS(s,pft(t,n))}),s}function pft(t,e){if(!e.visible)return;const r=tP(),i=e.getSpatialQueryAccelerator();return i!=null?fft(r,t,i):mft(r,t,e.objects),r}function fft(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<lft)eR(Yu,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,Bd.DepthOrder.FRONT_TO_BACK,Yu,(l,c)=>{YG(t,e,l),Yu.far=t.near,c.setRange(Yu)},n,o),eR(Yu,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,Bd.DepthOrder.BACK_TO_FRONT,Yu,(l,c)=>{YG(t,e,l),Yu.near=t.far,c.setRange(Yu)},n,o);else{const l=Math.max(Math.min(a,cft),Math.ceil(a*uft)),c=r.findClosest(s,Bd.DepthOrder.FRONT_TO_BACK,n,o,l),h=r.findClosest(s,Bd.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(hle(t,e,c.boundingVolumeWorldSpace.bounds),hle(t,e,h.boundingVolumeWorldSpace.bounds))}}function mft(t,e,r){Ux.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&Ux.add(i)}),Ux.empty||(Ux.sort(e),eR(Yu,e.near,Math.min(t.near,e.far)),Ux.forEachInDepthRange(Yu,Bd.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&YG(t,e,i)}),eR(Yu,Math.max(t.far,e.near),e.far),Ux.forEachInDepthRange(Yu,Bd.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function YG(t,e,r){if(!r.visible||!t_(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=vft;r.geometries.forEach(n=>{ni(s,i,n.shaderTransformation);const o=nS(s);pCe(t,e,n.boundingInfo,s,o)})}function pCe(t,e,r,i,s){if(r==null)return;$e(La,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*(La[0]-n[0])+o[1]*(La[1]-n[1])+o[2]*(La[2]-n[2]);if(La[3]=r.radius*s,!(a-La[3]>t.near&&a+La[3]<t.far)&&t_(e.frustum,La))if(r.radius>XG&&r.getChildren())for(const l of r.getChildren())pCe(t,e,l,i,s);else JG.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function hle(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let gft=class{constructor(){this._items=new Gt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===Bd.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}}},yft=class{constructor(){this._view=ve(),this._viewProj=ve(),this._frustum=IO(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),$s(this._view,e.viewMatrix),ni(this._viewProj,e.projectionMatrix,this._view),xN(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const y=m.boundingSphere,_=s*y[0]+n*y[1]+o*y[2]+a,v=_-y[3],w=_+y[3];this._geometries.push(m),this._near.push(-w),this._far.push(-v)}));const l=new apt;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,d=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[d++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const s=e.center;$e(La,s,r);const n=nS(r),o=La[0],a=La[1],l=La[2],c=e.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=d+c;if(!(-(d-c)<2||-f>=i.near))if(-f>this._looseRange.near)i.near=-f;else{if(c>XG){const m=e.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,r,i);return}}JG.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let s=e.radius;const n=e.center;$e(La,n,r);const o=nS(r),a=La[0],l=La[1],c=La[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=i.far))if(-d<this._looseRange.far)i.far=-d;else{if(s>XG){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,r,i);return}}JG.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},_ft=class{constructor(){this._modelViewProj=ve(),this._clipPosition=[Yt(),Yt(),Yt(),Yt(),Yt(),Yt(),Yt(),Yt()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;ni(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*d+o[8]*f+o[12],c[1]=o[1]*h+o[5]*d+o[9]*f+o[13],c[2]=o[2]*h+o[6]*d+o[10]*f+o[14],c[3]=o[3]*h+o[7]*d+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[N9[l][0]],h=this._clipPosition[N9[l][1]],d=this._clipPosition[N9[l][2]],f=this._clipTriangle(c,h,d);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const _=f[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void tt(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),l5(Yt(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const N9=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],La=_s(),vft=ve(),Yu=tP(),Ux=new gft,bft=new yft,JG=new _ft;let wft=class{},xft=class extends ei{constructor(){super(...arguments),this.textures=new wft}};function Tft(){const t=new wr;return t.attributes.add(E.POSITION,"vec2"),t.vertex.uniforms.add(new ir("drawPosition",(e,r)=>Sft(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(b`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Je("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Je("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Je("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Rf("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Rf("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(b`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function Sft(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;hf(t.magnifier.position,dle);const n=e.camera.screenToRender(dle,Eft),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return wi(Cft,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const dle=Yi(),Eft=yme(),Cft=Yt();async function Aft(t){const e=ae(()=>import("./mask-svg-023bbc42.js"),[]),r=ae(()=>import("./overlay-svg-d62383f3.js"),[]),i=kg((await e).default,{signal:t}),s=kg((await r).default,{signal:t}),n={mask:await i,overlay:await s};return Qt(t),n}let bT=class extends xe{constructor(){super(...arguments),this._handles=new Mi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new xft,this.events=new Ls,this.attributeLocations=new Map([[E.POSITION,0]]),this._tmpScreenPoint=Yi(),this._tmpRenderPoint=yme()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(ue(()=>lc(this._magnifier,i=>i.version),r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),hf(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,h=r.camera.fullHeight,d=.5*a,f=.5*a;l[0]=_e(l[0],d,c-d-1),l[1]=_e(l[1],f,h-f-1);const m=Math.floor(l[0]-d),y=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Et.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:kS(async s=>{const n=r==null||i==null?Aft(s):null,o=r!=null?kg(r,{signal:s}):n.then(l=>l.mask),a=i!=null?kg(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:Ol(e,rZ,this.attributeLocations,0,1),pipelineState:Ot({blending:wc(be.ONE,be.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:jt})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new vr;i.internalFormat=St.RGBA,i.wrapMode=Dt.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!Tde(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new Ct(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=St.ALPHA,i.preMultiplyAlpha=!1;const n=new Ct(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=St.RGBA,i.flipped=!1,{input:new Ct(e,i),mask:n,overlay:s,size:r}}_createProgram(e){return new Cr(e,Tft(),this.attributeLocations)}};u([p()],bT.prototype,"_imageSources",void 0),u([p()],bT.prototype,"_imageLoadTask",void 0),u([p({readOnly:!0})],bT.prototype,"updating",null),bT=u([R("esri/views/3d/webgl-engine/lib/MagnifierHelper")],bT);let Oft=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new ca(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){if(!(e&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Ft(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return Q.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let s=i.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new ca(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||Q.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):Q.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||Q.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&o&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var tR;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(tR||(tR={}));let zy=class{constructor(e,r,i=tR.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Gt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===st.NONE||(s.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],h=c.geometry;s.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,f=d.length;if(c.indexType!==0){const m=BL.get(c.indexType);for(let y=0;y<f;y+=2){const _=d[y],v=d[y+1];s.drawElements(h.primitiveType,v,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const y=d[m],_=d[m+1];s.drawArrays(h.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===tR.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const BL=new Map;BL.set(Ke.UNSIGNED_BYTE,1),BL.set(Ke.UNSIGNED_SHORT,2),BL.set(Ke.UNSIGNED_INT,4);let Rft=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new Vut,this._shadowPassParameters=new zut,this._highlightPassParameters=new kut,this._systems=new Set,this._passes={materialOpaque:new zy(e,r),materialTransparent:new zy(e,r,tR.BackToFront),materialIntegratedMesh:new zy(e,r),shadowMap:new zy(e,r),highlight:new zy(e,r),highlightIntegratedMesh:new zy(e,r),highlightShadowMap:new zy(e,r),defaultShadowMap:new zy(e,r)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(r,i)=>r.prepare(i,e.bindParameters)))}render(e,r){this._invoke(e,(i,s)=>i.dispatch(s,e.bindParameters,r))}_invoke(e,r){switch(e.bindParameters.slot){case ce.OPAQUE_MATERIAL:switch(e.output){case L.Color:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case L.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case L.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case L.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case L.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case ce.TRANSPARENT_MATERIAL:switch(e.output){case L.Color:case L.Alpha:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case ce.INTEGRATED_MESH:switch(e.output){case L.Color:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case L.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[ce.OPAQUE_MATERIAL,ce.TRANSPARENT_MATERIAL,ce.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(e);s!=null&&IS(r,s,r)}),r}_configure(e){const r=e.output===L.Shadow||e.output===L.ShadowHighlight||e.output===L.ShadowExcludeHighlight?this._shadowPassParameters:e.output===L.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,s=i.viewInverseTransposeMatrix;se(F9,s[3],s[7],s[11]),U9.set(F9),re(r.transformWorldFromViewTH,U9.high),re(r.transformWorldFromViewTL,U9.low),re(r.slicePlaneLocalOrigin,F9),Eh(r.transformViewFromCameraRelativeRS,i.viewMatrix),$s(r.transformProjFromView,i.projectionMatrix),r.identifier===ac.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===ce.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===ce.INTEGRATED_MESH,Ch(ple,r.transformViewFromCameraRelativeRS),Rw(r.transformNormalViewFromGlobal,ple))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const F9=A(),ple=Fi(),U9=new a6;let Pft=class{constructor(){this._step=gle,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,oe("disable-feature:high-quality-idle"))this._dilation=1;else{const s=r?performance.now()-this._firstIdleTime:0;if(s>=fle+Ift)return this._step=1/0,void(this._dilation=1);this._dilation=s>=fle?$ft:1}const i=_e(e/Mft,gle,Dft);this._step===1/0?this._step=i:this._step=this._step*mle+i*(1-mle)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const Mft=.5,fle=12e4,Ift=1e4,$ft=10,mle=.9,Lft=30,gle=1e3/1,Dft=1e3/Lft,Nft=8.6,Fft=.4;function Uft(){const t=new wr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(E.UV0,"vec2"),e.uniforms.add(new Je("coverageTex",n=>n.coverageTexture)),i.add(b`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Je("tex",n=>n.blurColorTexture),new Je("origin",n=>n.highlightColorTexture),new ir("uColor",n=>n.color),new ir("haloColor",n=>n.haloColor),new ir("opacities",n=>wi(Vft,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",Nft),r.constants.add("blurSize","float",Fft),s.add(b`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const Vft=Yt(),zft=Object.freeze(Object.defineProperty({__proto__:null,build:Uft},Symbol.toStringTag,{value:"Module"}));let fCe=class mCe extends Pr{initializeProgram(e){return new Cr(e.rctx,mCe.shader.get().build(),br)}initializePipeline(){return Ot({blending:bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt})}};fCe.shader=new Er(zft,()=>ae(()=>import("./HighlightApply.glsl-8a414194.js"),[]));let gCe=class extends ei{constructor(){super(...arguments),this.blurSize=Ue()}};function kft(){const t=new wr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),t.attributes.add(E.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Je("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new ZX("blurSize",n=>n.blurSize)),i.add(b`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new ph("tex",n=>n.blurInputTexture)),s.add(b`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const Bft=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:gCe,build:kft},Symbol.toStringTag,{value:"Module"}));let yCe=class _Ce extends Pr{initializeProgram(e){return new Cr(e.rctx,_Ce.shader.get().build(),br)}initializePipeline(){return Ot({colorWrite:jt})}};yCe.shader=new Er(Bft,()=>ae(()=>import("./HighlightBlur.glsl-52c7ad46.js"),[]));let vCe=class extends ei{constructor(){super(...arguments),this.invFramebufferDim=Ue()}};function Gft(){const t=new wr,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),i.add(b`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new ph("tex",n=>n.inputTexture)),r.uniforms.add(new ZX("invFramebufferDim",n=>n.invFramebufferDim)),s.add(b`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const jft=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:vCe,build:Gft},Symbol.toStringTag,{value:"Module"}));let bCe=class wCe extends Pr{initializeProgram(e){return new Cr(e.rctx,wCe.shader.get().build(),br)}initializePipeline(){return Ot({colorWrite:jt})}};bCe.shader=new Er(jft,()=>ae(()=>import("./HighlightDownsample.glsl-9364eaab.js"),[]));let yle=class extends ei{constructor(){super(...arguments),this.color=Wf(1,0,1,1),this.haloColor=Wf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Ft(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const Hft=32;let qft=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Yt(),this._passParameters=new yle,this._downsampleDrawParameters=new vCe,this._blurDrawParameters=new gCe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Ol(this._rctx);const e=new vr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._blur0Fbo=new on(this._rctx,e),this._blur1Fbo=new on(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire(yCe),this._downsampleTechnique=this._techniqueRep.acquire(bCe),this._applyTechnique=this._techniqueRep.acquire(fCe)}dispose(){if(this._blurTechnique=Bi(this._blurTechnique),this._downsampleTechnique=Bi(this._downsampleTechnique),this._applyTechnique=Bi(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=Fe(this._blur0Fbo),this._blur1Fbo=Fe(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new yle,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=e.camera;ch(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let d=null;this._gridUpdateResources(r,Hft),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,d=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(d),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(xi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,nr(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Do(d,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(xi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,nr(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Do(d,"geometry")),h.bindFramebuffer(i),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,Do(d,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h=new vr(Math.ceil(c.width/2),Math.ceil(c.height/2));h.pixelFormat=St.RGB,h.dataType=Vs.UNSIGNED_SHORT_5_6_5,h.wrapMode=Dt.CLAMP_TO_EDGE,s.coverageMipmap[l+1]=new on(i,h)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,d=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let _=0;for(let v=0;v<l;v++)for(let w=0;w<c;w++)y[_]=(w-.5)*d*2-1,y[_+1]=(v-.5)*h*2-1,y[_+2]=w*d,y[_+3]=v*h,y[_+4]=(w+.5)*d*2-1,y[_+5]=(v-.5)*h*2-1,y[_+6]=w*d,y[_+7]=v*h,y[_+8]=(w-.5)*d*2-1,y[_+9]=(v+.5)*h*2-1,y[_+10]=w*d,y[_+11]=v*h,y[_+12]=(w-.5)*d*2-1,y[_+13]=(v+.5)*h*2-1,y[_+14]=w*d,y[_+15]=v*h,y[_+16]=(w+.5)*d*2-1,y[_+17]=(v-.5)*h*2-1,y[_+18]=w*d,y[_+19]=v*h,y[_+20]=(w+.5)*d*2-1,y[_+21]=(v+.5)*h*2-1,y[_+22]=w*d,y[_+23]=v*h,_+=f*m;s.vao&&s.vao.dispose(),s.vao=new up(i,br,{geometry:PR},{geometry:Lr.createVertex(i,Tr.STATIC_DRAW,y)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,nr(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(Et.TRIANGLE_STRIP,0,Do(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const Wft={dataType:Vs.UNSIGNED_BYTE,internalFormat:St.RGBA},Zft={};let Xft=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._fbos.forEach((s,n)=>{s.colorTexture!==i&&s.depthStencilAttachment!==i||(s.detachColorTexture(),s.detachDepthStencilTexture(),s.dispose(),this._fbos.delete(n))}),i.dispose(),e.delete(r))}_getDepthTexture(e,r,i){let s=this._depthTextures.get(e.id);if(!s||s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=null),!s){const n=new vr(r,i);n.pixelFormat=St.DEPTH_STENCIL,n.dataType=Vs.UNSIGNED_INT_24_8,n.samplingMode=At.NEAREST,n.wrapMode=Dt.CLAMP_TO_EDGE,s=new Ct(this._rctx,n),this._depthTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,r,i){let s=this._colorTextures.get(e.id);if(s&&(s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=DS())),!s){const n=new vr(r,i);n.internalFormat=e.internalFormat,n.dataType=e.dataType,n.samplingMode=e.samplingMode!=null?e.samplingMode:At.LINEAR,n.wrapMode=Dt.CLAMP_TO_EDGE,s=new Ct(this._rctx,n),this._colorTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:pc(),...Zft,...e}}registerColorTarget(e={}){return{id:pc(),...Wft,...e}}getFramebuffer(e,r,i,s){const n=this._getKey(i,s);let o=this._fbos.get(n);const a=this.getColorTexture(i,e,r),l=s?this._getDepthTexture(s,e,r):void 0;return o?((o.width!==e||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new on(this._rctx,a,l),this._fbos.set(n,o),o)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),e+=s.gpuMemoryUsage)};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),e}},Yft=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new Xft(e);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=i.registerColorTarget({name:"colorFloatTarget",dataType:Vs.HALF_FLOAT,internalFormat:Xe.RGBA16F,samplingMode:At.NEAREST}),this.alphaFloatTarget=i.registerColorTarget({name:"alphaFloatTarget",dataType:Vs.HALF_FLOAT,internalFormat:Xe.R16F,samplingMode:At.NEAREST}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:At.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:Xe.RGBA4,dataType:Vs.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:Xe.RGBA4,dataType:Vs.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const r=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,ob(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(xi.COLOR_BUFFER_BIT|xi.DEPTH_BUFFER_BIT|xi.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,ia.None)}renderTmpAndCompositeToMain(e,r,i,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,Jft),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(e,r,i,s){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,s,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,Qft)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let s,n;switch(r){case st.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case st.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case st.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0];break;case st.NONE:case st.COUNT:return}i?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ia.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ia.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(xi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=xi.COLOR_BUFFER_BIT}i&&(o|=xi.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=xi.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,s,n,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const Jft=[0,0,0,0],Qft=[0,1,0,1];let V3=class extends xe{constructor(e){super({}),this._context=e,this._renderPlugins=new Gt,this._slots=[];for(let r=0;r<ce.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r,i){const s=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),Dr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(gu(n))return n.then(s);s(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}prepareSlots(e){for(const r of e)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(i=>{i.canRender&&(_le(i)&&i.prepareTechnique(this._context.renderContext),vle(i)&&i.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(_le(i)){const s=i.prepareTechnique(this._context.renderContext);return s!=null&&(r.push(s),!0)}if(vle(i)){const s=i.prepareTechniques(this._context.renderContext);return s!=null&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(e){const r=Kft;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(e);s&&IS(r,s,r)}}),r}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[ce.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Li.None)}};function _le(t){return"prepareTechnique"in t}function vle(t){return"prepareTechniques"in t}u([p()],V3.prototype,"_renderPlugins",void 0),u([p({readOnly:!0})],V3.prototype,"updating",null),V3=u([R("esri.views.3d.webgl-engine.lib.RenderPluginManager")],V3);const Kft={near:0,far:0};let xCe=class extends HX{};const l6=255,emt=1/l6;function tmt(t){const e=new wr,r=e.fragment;return r.include(Tc),r.include(fu),e.include(HF),e.include(Ih),e.include(jF,t),r.uniforms.add(new Je("depthMap",i=>i.linearDepthTexture),new Ni("inverseViewMatrix",(i,s)=>xn(ble,Cl(ble,s.camera.viewMatrix,s.camera.center))),new Sr("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",emt),r.code.add(b`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const ble=ve(),rmt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:xCe,ShadowCastMaxSamples:l6,build:tmt},Symbol.toStringTag,{value:"Module"}));var uw;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(uw||(uw={}));let QG=class extends ha{constructor(){super(...arguments),this.visualization=uw.Gradient,this.bandsEnabled=!1}};u([F({count:uw.COUNT})],QG.prototype,"visualization",void 0),u([F()],QG.prototype,"bandsEnabled",void 0);let TCe=class extends ei{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=OR(imt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const imt=Ft(.01,0,.25,1);function smt(t){const e=new wr,r=e.fragment;r.include(Tc),r.include(fu),e.include(HF),e.include(Ih);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",l6),r.uniforms.add(new Je("shadowCastMap",a=>a.shadowCastMap),new Oe("sampleScale",a=>a.sampleScale),new Oe("opacityFromElevation",a=>a.opacityFromElevation),new ir("uColor",a=>a.color));const n=i===uw.Gradient,o=i===uw.Threshold;return n&&s?r.uniforms.add(new Oe("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Oe("threshold",a=>a.threshold)),r.code.add(b`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?b`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?b`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?b`* strength`:""});
      }
    `),e}const nmt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:TCe,build:smt},Symbol.toStringTag,{value:"Module"}));let SCe=class ECe extends Pr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,ECe.shader.get().build(this.configuration),br)}initializePipeline(){return Ot({blending:ou,colorWrite:jt,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};SCe.shader=new Er(nmt,()=>ae(()=>import("./ShadowCastVisualize.glsl-caa3bc64.js"),[]));const omt=4e4,amt=5e4,CCe=1/512;let GL=class extends xe{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new TCe(this._data),this._techniqueConfig=new QG,this._enabled=!1,this._vao=Ol(r),this._techniqueConfig.visualization=uw.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Fe(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(SCe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,Do(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>CCe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;d2(e,r)||(ch(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([p()],GL.prototype,"opacityFromElevation",null),GL=u([R("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],GL);let qY=class extends ha{constructor(){super(...arguments),this.receiveShadows=!0}};u([F()],qY.prototype,"receiveShadows",void 0);let ACe=class OCe extends Pr{constructor(e){super(e,new qY,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,OCe.shader.get().build(this.configuration),br)}initializePipeline(){return Ot({blending:bo(be.ONE,be.ONE,be.ONE,be.ONE),colorWrite:jt,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};ACe.shader=new Er(rmt,()=>ae(()=>import("./ShadowCastAccumulate.glsl-0c4278b2.js"),[]));let hl=class extends xe{constructor(e,r,i,s,n,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new xCe,this._cachedLightDirections=[],this._depthRange=jG,this._previewing=!1,this._handles=new Mi,this._cameraForcedForScreenshot=!1,this._bindParameters=new iF(new GX(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Ol(e),this._accumulationRenderer=new GL(r,e,this,o);const a=this._stage.view.resourceController.scheduler;this._handles.add([a.registerTask(pt.SHADOW_ACCUMULATOR,this),ue(()=>i.renderView,l=>{this._handles.remove(wle),l!=null&&this._handles.add(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),wle)},As),ue(()=>this._previewing,()=>this._requestRenderIfEnabled(),jr)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=Fe(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Fe(this._fbo),this._vao=Fe(this._vao),this._accumulationTechniqueCached=Bi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new ACe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==jG&&this._opacityFromElevation>CCe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(Og(r,e,m_))return;const i=Math.min(l6,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=re(r[s]??A(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(lmt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,St.RGBA,Vs.UNSIGNED_BYTE,xle),xle[0]/this._progress)}_enable(){this._progress=0;const e=new vr;e.wrapMode=Dt.CLAMP_TO_EDGE,this._fbo=new on(this._rctx,e)}_disable(){this._fbo=Fe(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(xi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Do(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*cmt%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-fO(omt,amt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([p()],hl.prototype,"_progress",void 0),u([p()],hl.prototype,"_sampleCount",void 0),u([p()],hl.prototype,"_fbo",void 0),u([p()],hl.prototype,"_depthRange",void 0),u([p()],hl.prototype,"_previewing",void 0),u([p()],hl.prototype,"_accumulationRenderer",void 0),u([p()],hl.prototype,"_isRefining",null),u([p()],hl.prototype,"_isActive",null),u([p()],hl.prototype,"canAccumulate",null),u([p()],hl.prototype,"_isDoneAccumulating",null),u([p()],hl.prototype,"_opacityFromElevation",null),u([p()],hl.prototype,"running",null),hl=u([R("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],hl);const lmt=6,wle="renderView",cmt=104729,xle=new Uint8Array(4),Tle={highlightedThreshold:.99999,selfShadowThreshold:.025};function umt(t){const e=new wr;e.include(sw,t);const r=e.fragment;return r.include(Tc),r.include(fu),e.include(HF),e.include(Ih),r.uniforms.add(new Je("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(OS.Default)),new Je("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(OS.Highlight)),new Je("depthMap",(i,s)=>s.linearDepthTexture),new Je("highlightMap",(i,s)=>s.highlightColorTexture),new ir("uColor",i=>i.shadowColor),new Sr("nearFar",(i,s)=>s.camera.nearFar),new Oe("opacity",i=>i.shadowOpacity),new Oe("occludedOpacity",i=>i.occludedShadowOpacity),new Oe("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new zt("lightingMainDirectionView",(i,s)=>ge(Ele,$e(Ele,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Sr("texelSize",(i,s)=>s.linearDepthTexture!=null?nr(hmt,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):np),new Ni("inverseViewMatrix",(i,s)=>xn(Sle,Cl(Sle,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",Hbe).add("highlightedThreshold","float",Tle.highlightedThreshold).add("selfShadowThreshold","float",Tle.selfShadowThreshold),r.code.add(b`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(b`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Sle=ve(),Ele=A(),hmt=Ue(),dmt=Object.freeze(Object.defineProperty({__proto__:null,build:umt},Symbol.toStringTag,{value:"Module"}));let pmt=class extends HX{constructor(){super(...arguments),this.shadowColor=Ft(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},RCe=class PCe extends Pr{constructor(e){super(e,new qY,()=>this.destroy())}initializeProgram(e){return new Cr(e.rctx,PCe.shader.get().build(this.configuration),br)}initializePipeline(){return Ot({blending:bo(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:jt,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};RCe.shader=new Er(dmt,()=>ae(()=>import("./ShadowHighlight.glsl-57639295.js"),[]));const fmt=.001953125,mmt=4e4,gmt=5e4;let ymt=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new pmt,this._drawParameters=new NKe,this._vao=Ol(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new RCe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Do(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.memoryEstimate)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-fO(mmt,gmt,e.relativeElevation);const i=this._viewingMode===Le.Global?ge(Cle,e.center):se(Cle,0,0,1),s=me(i,r);this._passParameters.dayNightTerminator=fO(0,1,_e(30*s,0,1))}dispose(){this._vao=Fe(this._vao),this._techniqueCached=Bi(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=fmt}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const Cle=A(),Ale=qg();let _mt=class{constructor(){this._plane=qg()}get isEnabled(){return!Bye(this.plane,Ale)}get plane(){return this._plane}set plane(e){Cw(e||Ale,this._plane)}},vmt=class extends ei{};function rR(t){t.uniforms.add(new ir("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,s=r.height;return wi(bmt,1/i,1/s,i,s)}))}const bmt=Yt(),Vx={maxSearchSteps:8,maxDistanceAreaTex:16};function wmt(){const t=new wr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),rR(i),i.code.add(b`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.int(Vx.maxSearchSteps)} );
      }
    `),s.uniforms.add(new Je("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new Je("areaTexture",n=>n.areaTexture)),s.uniforms.add(new Je("searchTexture",n=>n.searchTexture)),rR(s),s.code.add(b`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Vx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Vx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Vx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Vx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.int(Vx.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const xmt=Object.freeze(Object.defineProperty({__proto__:null,build:wmt},Symbol.toStringTag,{value:"Module"}));let MCe=class ICe extends Pr{initializeProgram(e){return new Cr(e.rctx,ICe.shader.get().build(),br)}initializePipeline(){return Ot({colorWrite:jt})}};MCe.shader=new Er(xmt,()=>ae(()=>import("./BlendWeights.glsl-d3a16336.js"),[]));function Tmt(){const t=new wr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),rR(i),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new Je("blendWeightsTexture",n=>n.blend.colorTexture),new Je("colorTexture",n=>n.colorTexture)),rR(s),s.code.add(b`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const Smt=Object.freeze(Object.defineProperty({__proto__:null,build:Tmt},Symbol.toStringTag,{value:"Module"}));let $Ce=class LCe extends Pr{initializeProgram(e){return new Cr(e.rctx,LCe.shader.get().build(),br)}initializePipeline(){return Ot({colorWrite:jt})}};$Ce.shader=new Er(Smt,()=>ae(()=>import("./Blur.glsl-061907c1.js"),[]));const Ole={threshold:.05,localConstrastAdaption:2};function Emt(){const t=new wr,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),rR(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new Je("colorTexture",n=>n.colorTexture)),s.code.add(b`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.float(Ole.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${b.float(Ole.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const Cmt=Object.freeze(Object.defineProperty({__proto__:null,build:Emt},Symbol.toStringTag,{value:"Module"}));let DCe=class NCe extends Pr{initializeProgram(e){return new Cr(e.rctx,NCe.shader.get().build(),br)}initializePipeline(){return Ot({colorWrite:jt})}};DCe.shader=new Er(Cmt,()=>ae(()=>import("./EdgeDetect.glsl-26cb435f.js"),[]));let z3=class extends xe{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new vmt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=lu(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const r=this._abortController.signal;return ae(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return Qt(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,At.LINEAR,St.RGB),this._loadTextureFromBase64(e.searchTexure,At.NEAREST,St.LUMINANCE)]).then(([i,s])=>{vn(r)?(i.dispose(),s.dispose(),Qt(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=s)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const s=new ha;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(DCe,s,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(MCe,s,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire($Ce,s,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=mke(this._rctx);const r=new vr(4,4);r.pixelFormat=St.RG,r.internalFormat=Xe.RG8,r.wrapMode=Dt.CLAMP_TO_EDGE,this._passParameters.edges=new on(this._rctx,r);const i=new vr(4,4);return i.pixelFormat=St.RGBA,i.wrapMode=Dt.CLAMP_TO_EDGE,this._passParameters.blend=new on(this._rctx,i),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=Fe(this._vao),this._passParameters.areaTexture=Fe(this._passParameters.areaTexture),this._passParameters.searchTexture=Fe(this._passParameters.searchTexture),this._passParameters.blend=Fe(this._passParameters.blend),this._passParameters.edges=Fe(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(r==null)return;r.colorTexture=e;const i=this._rctx,s=i.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,n,o),r.edges.resize(n,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(xi.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3),r.blend.resize(n,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(xi.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3),i.bindFramebuffer(s),i.setClearColor(0,1,0,1),i.clear(xi.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return kg(e).then(s=>{const n=new vr;return n.pixelFormat=i,n.wrapMode=Dt.CLAMP_TO_EDGE,n.width=s.width,n.height=s.height,n.samplingMode=r,new Ct(this._rctx,n,s)})}};u([p()],z3.prototype,"_abortController",void 0),u([p({readOnly:!0})],z3.prototype,"updating",null),z3=u([R("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],z3);function Amt(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function Omt(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let Rmt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new Pmt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{$s(r.viewMatrix,e),Omt(r.origin.vec3,r.viewMatrix)})}},Pmt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=ve()}},Mmt=class extends nve{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=Fi()}},Imt=class extends ove{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Fi(),this.slicePlaneLocalOrigin=A(),this.transformNormalGlobalFromModel=Fi()}};function $mt(t){const e=b`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const Lmt=ur(.5,-4e-4);function Dmt(t,e){const r=t.vertex;r.include($mt),r.constants.add("depthBias","vec2",Lmt),r.uniforms.add(new Sr("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new Ni("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new $h("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new Ni("transformProjFromView",i=>i.transformProjFromView)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(b`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Nmt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(b`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(b`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Fmt(t,e){const r=t.vertex;e.silhouette?(r.code.add(b`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Umt(t,e){const r=t.vertex;r.include(Tc),r.uniforms.add(new Oe("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(b`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new ph("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(E.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*BY),r.code.add(b`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new MO("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(E.NORMALA,"vec3"),t.attributes.add(E.NORMALB,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(E.NORMAL,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(b`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(SN,e),r.include(SN,e),r.uniforms.add(new $h("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new MO("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new nu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new nu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new zt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new zt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(b`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?b`normalize(transformWorldFromModelTL + rotatedModelPosition);`:b`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Ni("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(b`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Vmt(t){return t.mode===rn.SKETCH||t.mode===rn.MIXED}var rn,Q1;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(rn||(rn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Q1||(Q1={}));function WY(t,e){const r=t.vertex;switch(t.attributes.add(E.SIDENESS,"vec2"),e.mode===rn.MIXED?r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case rn.MIXED:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case rn.SKETCH:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case rn.SOLID:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case rn.COUNT:break;default:e.mode}}function zmt(t,e){const r=t.vertex;switch(t.include(WY,e),e.mode){case rn.SOLID:r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case rn.SKETCH:r.uniforms.add(new Ab("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case rn.MIXED:r.uniforms.add(new Ab("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function kmt(t,e){t.include(WY,e);const{vertex:r,fragment:i}=t;switch(Vmt(e)&&(r.uniforms.add(new ph("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new Ab("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new Ab("strokeVariants",s=>s.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new ph("strokesTexture",s=>s.strokesTexture.texture),new Ab("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(b`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Tc),i.code.add(b`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case rn.SOLID:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(b`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case rn.SKETCH:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(b`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case rn.MIXED:t.varyings.add("vType","float"),r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(b`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Bmt(t){const e=new wr,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new Rle("model"),new Rle("localView")),e.include(Dmt,t),e.include(Umt,t),e.include(zmt,t),e.include(WY,t),e.include(kmt,t),e.include(ms,t),e.include(Fmt,t),e.include(Nmt,t),e.include(mu,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new Sr("pixelToNDC",(s,n)=>nr(Gmt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new ir("viewport",(s,n)=>n.camera.fullViewport),new Oe("pixelRatio",(s,n)=>n.camera.pixelRatio)),e.attributes.add(E.POSITION0,"vec3"),e.attributes.add(E.POSITION1,"vec3"),e.attributes.add(E.VARIANTOFFSET,"float"),e.attributes.add(E.VARIANTSTROKE,"float"),e.attributes.add(E.VARIANTEXTENSION,"float"),r.code.add(b`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?b`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:b`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===rn.SKETCH?b`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===rn.MIXED?b`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(b`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Gmt=Ue();let Rle=class extends cs{constructor(e){super(e,"mat4")}};const jmt=Object.freeze(Object.defineProperty({__proto__:null,build:Bmt},Symbol.toStringTag,{value:"Module"}));let FCe=class UCe extends Pr{initializeProgram(e){return new Cr(e.rctx,UCe.shader.get().build(this.configuration),ZEe)}initializePipeline(e){return e.blendMinMax?Ot({blending:bo(be.ONE,be.ONE,be.ZERO,be.ONE,kf.ADD,e.blendMinMax.MAX),depthTest:{func:Kr.LEQUAL},colorWrite:jt}):Ot({depthTest:{func:Kr.LEQUAL},depthWrite:Al,colorWrite:jt})}};FCe.shader=new Er(jmt,()=>ae(()=>import("./EdgeShader.glsl-c04ce257.js"),[]));let Kp=class extends No{constructor(){super(...arguments),this.mode=rn.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([F({count:rn.COUNT})],Kp.prototype,"mode",void 0),u([F()],Kp.prototype,"hasSlicePlane",void 0),u([F()],Kp.prototype,"silhouette",void 0),u([F()],Kp.prototype,"legacy",void 0),u([F()],Kp.prototype,"antialiasing",void 0),u([F()],Kp.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],Kp.prototype,"hasMultipassTerrain",void 0),u([F()],Kp.prototype,"cullAboveGround",void 0),u([F()],Kp.prototype,"spherical",void 0);const Hmt=8,V9=128,qmt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},Wmt={solid:rn.SOLID,sketch:rn.SKETCH,uber:rn.MIXED};let z9=class VCe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new Kp,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Wt.TRANSPARENT]:{[Wt.TRANSPARENT]:new Gt,[Wt.OPAQUE]:new Gt},[Wt.OPAQUE]:{[Wt.TRANSPARENT]:new Gt,[Wt.OPAQUE]:new Gt}},this._renderablesDirty=!1,this._drawParameters=new Imt,this._settings={...qmt,...i},this.key=VCe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:oi.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Wmt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=Bi(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){if(this._renderablesDirty&&this._sortRenderables(),r!==Wt.INVISIBLE){const i=this._sortedRenderables[r];i[Wt.TRANSPARENT].forAll(e),i[Wt.OPAQUE].forAll(e)}}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(FCe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(Et.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new a6(r.transform.position),o=Ch(Ple,Rw(Ple,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Wt.TRANSPARENT][Wt.TRANSPARENT].clear(),this._sortedRenderables[Wt.TRANSPARENT][Wt.OPAQUE].clear(),this._sortedRenderables[Wt.OPAQUE][Wt.TRANSPARENT].clear(),this._sortedRenderables[Wt.OPAQUE][Wt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==Wt.INVISIBLE&&r.edgeTransparency!==Wt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Wt.TRANSPARENT][Wt.TRANSPARENT].sort(e),this._sortedRenderables[Wt.TRANSPARENT][Wt.OPAQUE].sort(e),this._sortedRenderables[Wt.OPAQUE][Wt.TRANSPARENT].sort(e),this._sortedRenderables[Wt.OPAQUE][Wt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const Ple=Sl();function O5t(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new qBe(t.layout)}}function HI(t){return new xve(t.layout).createView(t.buffer)}let Zmt=class extends ISe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return zpt(e);const s=await this.invoke(new k9(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new k9(e),r);return HI(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new k9(e),r);return HI(i)}_unpackOutput(e){return{regular:{instancesData:HI(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:HI(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},k9=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=ep(e.indices)?e.indices:e.indices.buffer,this.indicesType=ep(e.indices)?"Array":Z4(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function Xmt(t){const r=bC.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=bC.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=bC.strokes.length;let d=(c-1)*h*l;for(const{distance:y,pressure:_}of bC.strokes){let v=y,w=_,T=d;for(let x=0;x<c;x++){x!==0&&(v=Mle(v,iR.DISTANCE),w=Mle(w,iR.PRESSURE));for(let S=0;S<bC.resolution;S++){const O=.5+(v?v[S%v.length]/a:0),C=w?w[S%w.length]:1;zO(O,s,T),zO(C,s,T+n),T+=4}T-=l*(h+1)}d+=l}const f=new vr;f.width=f.height=r;const m=new Ct(t,f,s);return new Jmt(r,a,o,h,m)}function Mle(t,e){if(!t)return null;const r=t.length/2,i=Ymt*r,s=new Array(r);let n=0;const o=e===iR.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*Ile):Math.min(i,l*Ile)}return s}var iR;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(iR||(iR={}));const Ymt=.1,Ile=.5;let Jmt=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=Fe(this.texture)}};const bC={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function $le(t){let e=null;for(const r of t){const i=r.type;if(Qmt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function Lle(t){let e=Wt.INVISIBLE;for(const{material:r}of t)if(zCe(r)){if(r.color[3]*r.opacity<1)return Wt.TRANSPARENT;e=Wt.OPAQUE}return e}function Dle(t){let e=Wt.INVISIBLE;for(const{material:r}of t)if(zCe(r)){switch(r.objectTransparency){case Wt.TRANSPARENT:case Wt.INVISIBLE:return Wt.TRANSPARENT;case Wt.OPAQUE:if(r.opacity<1)return Wt.TRANSPARENT}e=Wt.OPAQUE}return e}function zCe(t){return t.size*t.color[3]*t.opacity>0}function Qmt(t){return t.size*t.color[3]>0}function Nle(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let dd=class extends xe{constructor(e){super(e),this._updatingHandles=new Ef,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=A(),this._localOrigins=new Rmt(new kX(e.renderSR))}initialize(){this._worker=new Zmt(this.schedule),this._componentColorManager=new JEe(this.rctx,3);const e=qEe.createBuffer(4);for(let r=0;r<4;r++)e.sideness.set(r,0,r===0||r===3?0:1),e.sideness.set(r,1,r===0||r===1?0:1);this._verticesBufferObject=Lr.createVertex(this.rctx,Tr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=Fe(this._strokesTexture),this._componentColorManager=Pe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Fe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",sgt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,r,i,s,n,o,a,l){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let c;const h=new Ule(new Promise(f=>c=f),i.center,i.radius);this._perObjectData.set(e,h);const d=await this._updatingHandles.addPromise(this._addComponentGeometry(r,h,s,n,o,a,l));return this.setNeedsRender(),c(),d}async addOrUpdateObject3D(e,r,i,s){if(this.destroyed)return void Q.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(e);let o;(n==null?void 0:n.renderables.length)>0&&this._perObjectDataEvictionCache.add(n);const a=e.boundingVolumeWorldSpace.bounds,l=new Ule(new Promise(h=>o=h),a,mg(a));this._perObjectData.set(e,l);const c=new Array;if(i.mergeGeometries&&e.geometries.length>1&&Kmt(e))c.push(this._addObjectMergedGeometries(e,l,r,i,s));else for(let h=0;h<e.geometries.length;h++){const d=e.geometries[h];d.material.supportsEdges&&c.push(this._addGeometry(e,l,d,r[0],i,s))}await this._updatingHandles.addPromise(Promise.all(c)),this._perObjectDataEvictionCache.delete(l),this._discardObjectEntry(n),this.setNeedsRender(),o()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(r=>this._removeRenderable(r)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(i==null)return;const s=r instanceof Array?n=>r[n]:()=>r;i.renderables.forEach(n=>{const o=n.components.meta.length;for(let a=0;a<o;a++){const l=s(a),c=n.components.meta[a],h=c.index;c.material.opacity=l,n.components.buffer.textureBuffer.setDataElement(h,1,3,255*l)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const r=await this._getObjectEntry(e);return r!=null?r.renderables.reduce((i,s)=>i+s.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,r,i,s){const n=e instanceof iy,o=!!i.hasSlicePlane,a=$le(r),l=z9.getKey(a,o,n),c=await this._updatingHandles.addPromise(this._getObjectEntry(e));c!=null&&(c.renderables.forEach(h=>{if(l!==h.rendererKey){const d=this._renderers.get(h.rendererKey),f=this._acquireRenderer(a,o,n);d.removeRenderable(h),--d.refCount,h.rendererKey=l,f.addRenderable(h)}for(let d=0;d<r.length;d++)h.components.meta[d].material=r[d];s&&this._updateComponentBuffer(h.components),this._updateTransparency(h)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(s=>{const n=s.components.meta;for(let o=0;o<n.length;o++)s.components.meta[o].verticalOffset=(r==null?void 0:r[o])??0;this._updateComponentBuffer(s.components)}),this.setNeedsRender())}async updateObjectVisibility(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(s=>s.visible=r),this.setNeedsRender())}removeObject(e){const r=this._perObjectData.get(e);r&&(this._perObjectData.delete(e),this._discardObjectEntry(r))}async _getObjectEntry(e){const r=this._perObjectData.get(e);if(!r)throw new Error("no object");return await r.loaded,r.loaded==null?null:r}render(e,r){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,s=A(),n=new a6;let o=0,a=0;if(this._renderers.forEach(c=>{if(c.refCount===0)this._renderers.delete(c.key),c.dispose();else{let h=!0,d=!0;c.forEachRenderable(f=>{f.visible&&(o+=f.statistics.averageEdgeLength,a++,h&&f.regular&&(c.updateTechnique(e,!1),h=!1),d&&f.silhouette&&(c.updateTechnique(e,!0),d=!1))},r)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const l=new Mmt(40*o/a,r);se(s,i[3],i[7],i[11]),n.set(s),re(l.transformWorldFromViewTH,n.high),re(l.transformWorldFromViewTL,n.low),Eh(l.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Ch(Ble,l.transformViewFromCameraRelativeRS),Rw(l.transformNormalViewFromGlobal,Ble),l.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(c=>{this._renderRegularEdges(c,e,l),this._renderSilhouetteEdges(c,e,l)})}_updateTransparency(e){const r=Lle(e.components.meta),i=Dle(e.components.meta);r===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=r,e.objectTransparency=i,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,r,i){e.getCombinedShaderTransformation(r,i);const s=r.localOrigin!=null?this._localOrigins.register(r.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,i[12],i[13],i[14]));return r.localOrigin=s.origin,Amt(s.origin.vec3,i),s}_updateComponentBuffer(e){const{meta:r,buffer:i}=e,s=new Uint8Array(4);for(let n=0;n<r.length;n++){const o=r[n].material,a=r[n].index,l=_e(Math.round(o.size*Hmt),0,255),c=_e(o.extensionLength,-V9,255-V9)+V9,h=o.type==="solid"?O4.SOLID:O4.SKETCH,d=255*o.opacity,f=o.color,m=255*f[0],y=255*f[1],_=255*f[2],v=255*f[3];i.textureBuffer.setData(a,0,m,y,_,v),i.textureBuffer.setData(a,1,l,c,h,d),BEe(r[n].verticalOffset,s),i.textureBuffer.setData(a,2,s[0],s[1],s[2],s[3])}}_createComponentBuffers(e){if(this._componentColorManager==null)return null;const r=new Array,i=this._componentColorManager.getBuffer(e.length);for(let n=0;n<e.length;n++){const o=e[n],a=i.acquireIndex();r.push({index:a,verticalOffset:0,material:o})}const s=new egt(i,r);return this._updateComponentBuffer(s),s}_extractEdges(e,r,i,s,n,o=n.length){return this._worker.process({data:r,indices:n,indicesLength:o,writerSettings:e,skipDeduplicate:i},this._workerAbort.signal,s)}_createRenderable(e,r,i,s,n){const o=h=>this._verticesBufferObject!=null?new tgt(new up(this.rctx,ZEe,{vertices:Rpt,instances:h===Q1.REGULAR?C4.glLayout:A4.glLayout},{vertices:this._verticesBufferObject,instances:Lr.createVertex(this.rctx,Tr.STATIC_DRAW,h===Q1.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),h===Q1.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,a=e.regular.lodInfo.lengths.length>0?o(Q1.REGULAR):null,l=e.silhouette.lodInfo.lengths.length>0?o(Q1.SILHOUETTE):null,c=((a==null?void 0:a.vao.memoryEstimate)??0)+((l==null?void 0:l.vao.memoryEstimate)??0);return new igt(a,l,{gpuMemoryUsage:c,externalMemoryUsage:n,averageEdgeLength:e.averageEdgeLength},i,Lle(r.meta),Dle(r.meta),r,s)}async _addGeometry(e,r,i,s,n,o){const a=i.vertexAttributes.get(E.POSITION),l=i.indices.get(E.POSITION),c=ve(),h=this._computeModelTransformWithLocalOrigin(e,i,c),d=new kle(a,l,c,h);return this._addPositionData(r,d,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,r,i,s,n,o=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([s]);if(a==null||i<=0)return;const l=this._acquireRenderer(s.type,!!n.hasSlicePlane,!0),{modelTransform:c,origin:h}=r,d=r.indices,f=r.position,m=f.data.length/f.size,y=S4.createBuffer(m);for(let w=0;w<m;w++)y.position.set(w,0,f.data[w*f.size]),y.position.set(w,1,f.data[w*f.size+1]),y.position.set(w,2,f.data[w*f.size+2]);Nle(a.meta,[0,y.componentIndex.count],y.componentIndex);const _=await this._updatingHandles.addPromise(this._extractEdges(l.writerSettings,y,!1,o,d,i));if(e.loaded==null)return;const v=this._createRenderable(_,a,new rgt(c,h),l.key,!1);e.renderables.push(v),l.addRenderable(v),this._gpuMemoryUsage+=v.statistics.gpuMemoryUsage}async _addComponentGeometry(e,r,i,s,n,o,a){if(r.loaded==null)return 0;const l=this._createComponentBuffers(o);if(l==null)return 0;const c=$le(o),h=this._acquireRenderer(c,a.hasSlicePlane||!1,!1),d=S4.createBuffer(i.length/3);eP(d.position.typedBuffer,i,d.position.typedBufferStride,3),Nle(l.meta,n,d.componentIndex,s);const f=!0,m=h.writerSettings,y=await this._updatingHandles.addPromise(this._extractEdges(m,d,f,!1,s));if(r.loaded==null)return 0;const _=this._createRenderable(y,l,e,h.key,!0);return r.renderables.push(_),h.addRenderable(_),_.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,r,i,s,n){const o=new Map;let a=0,l=null,c=0;for(let T=0;T<e.geometries.length;T++){const x=e.geometries[T];if(!x.material.supportsEdges)continue;!l&&x.localOrigin&&(l=x);const S=x.vertexAttributes.get(E.POSITION);c+=S.data.length/S.size,a+=x.edgeIndicesLength}const h=c>=65536?Uint32Array:Uint16Array,d=a?new h(a):null,f=[];let m=0;for(let T=0;T<e.geometries.length;T++){const x=e.geometries[T];if(!x.material.supportsEdges)continue;const S=x.vertexAttributes.get(E.POSITION),O=x.indices.get(E.POSITION);let C=o.get(S.data);if(C==null){C=f.length/3;for(let P=0;P<S.data.length;P+=S.size)f.push(S.data[P]),f.push(S.data[P+1]),f.push(S.data[P+2]);o.set(S.data,C)}if(O)for(let P=0;P<x.edgeIndicesLength;P++)d[m++]=C+O[P]}const y=l||e.geometries[0],_=ve(),v=this._computeModelTransformWithLocalOrigin(e,y,_);for(let T=0;T<e.geometries.length;T++)e.geometries[T].localOrigin=v.origin;const w=new kle({data:f,size:3},d,_,v);await this._updatingHandles.addPromise(this._addPositionData(r,w,d.length,i[0],s,n))}_acquireRenderer(e,r,i){const s=z9.getKey(e,r,i);let n=this._renderers.get(s);return this._strokesTexture==null&&(this._strokesTexture=Xmt(this.rctx)),n||(n=new z9(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:r,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===Le.Global}),this._renderers.set(s,n)),++n.refCount,n}_removeRenderable(e){Fle(e.regular),Fle(e.silhouette);const r=this._renderers.get(e.rendererKey);if(r){r.removeRenderable(e),--r.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const r=e.camera.eye,i=e.camera.viewForward,s=A(),n=o=>{bn(s,o.center,r);const a=me(s,i),l=o.radius,c=a<-l?1/0:a<l?0:a-l;o.renderables.forEach(h=>h.distanceToCamera=c)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(e,r,i){const s=e.bindRegularEdges(i,r),n=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!Vle(a)||!a.visible)return;const l=qI(a.regular.lod.lengths,a.distanceToCamera,o);e.renderRegularEdges(s,a,i,r,l)},n)}_renderSilhouetteEdges(e,r,i){const s=e.bindSilhouetteEdges(i,r),n=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!zle(a)||!a.visible)return;const l=qI(a.silhouette.lod.lengths,a.distanceToCamera,o);e.renderSilhouetteEdges(s,a,i,r,l)},n)}get test(){return{hasRenderedPrimitives:e=>{let r=!1;const i=e.perScreenPixelRatio,s=(n,o)=>n.forEachRenderable(a=>{a.visible&&!r&&(Vle(a)&&(r=qI(a.regular.lod.lengths,a.distanceToCamera,i)>0),!r&&zle(a)&&(r=qI(a.silhouette.lod.lengths,a.distanceToCamera,i)>0))},o);return this._renderers.forEach(n=>{r||(s(n,Wt.OPAQUE),s(n,Wt.TRANSPARENT))}),r}}}};function Fle(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function Kmt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!Og(e,s.transformation))return!1}else e=s.transformation;if(r||s.localOrigin==null){if(r&&r.localOrigin!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}u([p({constructOnly:!0})],dd.prototype,"rctx",void 0),u([p({constructOnly:!0})],dd.prototype,"renderSR",void 0),u([p({constructOnly:!0})],dd.prototype,"viewingMode",void 0),u([p({constructOnly:!0})],dd.prototype,"techniqueRepository",void 0),u([p({constructOnly:!0})],dd.prototype,"setNeedsRender",void 0),u([p({constructOnly:!0})],dd.prototype,"schedule",void 0),u([p({readOnly:!0})],dd.prototype,"_updatingHandles",void 0),u([p({readOnly:!0})],dd.prototype,"updating",null),dd=u([R("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],dd);let Ule=class{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}},egt=class{constructor(e,r){this.buffer=e,this.meta=r}},tgt=class{constructor(e,r){this.vao=e,this.lod=r}},rgt=class{constructor(e,r){this.modelMatrix=e,this.origin=r}},igt=class{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function Vle(t){return t.regular!=null}function zle(t){return t.silhouette!=null}function qI(t,e,r){const i=e*r,s=she(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}let kle=class{constructor(e,r,i,s){this.position=e,this.indices=r,this.modelTransform=i,this.origin=s}};const Ble=Fi(),sgt=()=>Promise.reject();function pp(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let Gle=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},zm=!1;function ngt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&pp(t)?new Gle(()=>t.createQuery(),i=>{t.deleteQuery(i),zm=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{zm||(zm=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),zm=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new Gle(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),zm=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{zm||(zm=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),zm=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function ogt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new agt(r,e)}let agt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){zm||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var bi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(bi||(bi={}));const jle="Total";let lgt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new cg(jle),this._cpuTimeSamplers=new Map(Object.values(bi).map(r=>[r,new cg(r)])),this._enableGPUTimer=0,this._totalGPUTime=new cg("GPU"),this._gpuTimeSamplers=new Map(Object.values(bi).map(r=>[r,new cg(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(bi),jle];this._gpuTimerPool=ogt(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:VH(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Fe(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(bi.FINISH);this._gpuTimeSamplers.get(bi.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},Bl=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(e=null,r=!oe("disable-feature:high-quality-idle")){this._renderStateFeatures=$te(r,e),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(e,r=this._state){var i;return((i=this._renderStateFeatures)==null?void 0:i.get(r,e))??!1}setFeatureEnabled(e,r,i){var s;(s=this._renderStateFeatures)==null||s.set(r,e,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Gs.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Gs.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Gs.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,r,i,s,n,o,a,l){super({}),this._stage=e,this._materialRepository=r,this._techniqueRepository=s,this._rctx=n,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._materialRenderers=new Gt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=c=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new _mt,this._state=$r.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=fn.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Pft,this._handles=new Mi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(e.view.qualityProfile),this._smaaPass=new z3(this._rctx,s),l(),this._offscreen=new Yft(this._rctx,this._compositingHelper),this.performanceInfo=new lgt(this._rctx),this._shadowMap=new GX(this._rctx,e.viewingMode),this._ssaoHelper=new yTe(e.view,s,this._rctx,l),this._highlight=new qft(s,this._rctx),this._shadowHighlight=new ymt(this._rctx,e.viewingMode),this._shadowAccumulator=new hl(this._rctx,s,e,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,d)=>{c.shadowMap.start(c.camera,h,d,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(L.Shadow,c.shadowMap),c.camera.setGLViewport(this._rctx),this._prepare(c.camera,c.contentCamera)},l),this._renderContext=new gKe(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new V3({renderContext:this._renderContext,techniqueRepository:s,textureRepository:i,materialRepository:this._materialRepository,requestRender:l,controller:e}),this.renderPassManager=new Rft(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ue(()=>this._stage.view.state.camera,()=>l(),As),ue(()=>oi.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Wt.TRANSPARENT):()=>{},l()},zr),ue(()=>this._ssaoEnabled||this.isFeatureEnabled(Gs.SSAO),c=>this._ssaoHelper.enabled=c,As)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Di(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=Fe(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Pe(this._edgeView),this.renderPassManager.destroy(),Ove.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const e=this._stage.view.resourceController;this._edgeView=new dd({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:cgt(e)}),this._handles.add(ue(()=>lc(this._edgeView,r=>r.updating),()=>this._requestRender(),jr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return wW(this._bindParameters.ssr.reprojectionMatrix,nn)}set _reprojectionMatrix(e){DH(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var s,n;const{_shadowMap:r,_bindParameters:i}=this;if(((s=e.qualitySettings)==null?void 0:s.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),((n=e.qualitySettings)==null?void 0:n.ambientOcclusion)!==void 0&&this._ssaoEnabled!==e.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=e.qualitySettings.ambientOcclusion,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const o=e.environment.lighting.type!=="virtual";i.enableFillLights!==o&&(i.enableFillLights=o,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,r){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:s,updates:n}=e;if(i.length===0&&s.length===0&&n.length===0)return;const o=Kxe(e);let a=!1;o.forEach((l,c)=>{if(r.done)return;let h=this._materialRenderers.find(d=>d.material===c);h==null&&l.adds.length>0&&(h=new uTe(this._rctx,this._materialRepository,c),this._materialRenderers.push(h)),h&&(h.modify(l),h.isEmpty&&(a=!0)),l.removes.forEach(d=>e.removes.removeUnordered(d)),l.adds.forEach(d=>e.adds.removeUnordered(d)),l.updates.forEach(d=>e.updates.removeUnordered(d)),r.madeProgress()}),a&&this._materialRenderers.filterInPlace(l=>!l.isEmpty||(l.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(l=>l.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(l=>l.hasOccludees),this._hasWater=this._materialRenderers.some(l=>l.hasWater),this._hasHUDElements=this._materialRenderers.some(l=>l.requiresSlot(ce.LINE_CALLOUTS_HUD_DEPTH,L.Color)||l.requiresSlot(ce.HUD_MATERIAL,L.Color)||l.requiresSlot(ce.LABEL_MATERIAL,L.Color)),this._requestRender()}updateAnimation(e){const r=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Di(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,r,i,s,n){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=i;this._state=l,this._renderOverlay(n),this.performanceInfo.advance(bi.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=st.NONE,this._bindParameters.alignPixelEnabled=c;const h=this._offscreen;h.setupRenderTarget(this.hasReflections);const d=qg(this._sliceHelper.plane);s===Xb.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),o.setGLViewport(this._rctx),this._prepare(o,a),this._renderPlugins.prepareRender(),this.performanceInfo.advance(bi.PREPARE);const f=this._computeDepthRange(o);this._renderShadowMap(e,o,this._bindParameters.lighting.mainLight.direction,f),this.performanceInfo.advance(bi.SHADOW_MAP),h.initializeFrame(o),this._ensureBindParameters(o,a);const m=this._terrainRenderingEnabled&&(this._terrainTransparency===fn.Semitransparent||this._terrainTransparency===fn.TransparentWithDraped),y=this._highQualityTransparency&&m,_=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(y,_),this._renderLinearDepth(),this.performanceInfo.advance(bi.LINEAR_DEPTH),this._accumulateShadows(f,o,a),this.performanceInfo.advance(bi.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(bi.NORMALS),this._ensureBindParametersSSR(n),this._renderSSAO(n),this.performanceInfo.advance(bi.SSAO),this._renderContext.output=L.Color,h.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(bi.OPAQUE),this._renderTerrainLinearDepth(y),this._setMultipassTerrain(y),this._renderEdges(Wt.OPAQUE),this.performanceInfo.advance(bi.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(ce.VOXEL),this.performanceInfo.advance(bi.VOXEL),this._renderHiddenTransparentEdges(),_&&(this._oitEnabled?this._renderOITPass(a2.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(bi.TRANSPARENT),this._renderGeometryLinearDepth(y);const v=this._renderHUDVisibility(y);y||this._renderInternalSlot(ce.LINE_CALLOUTS),this.performanceInfo.advance(bi.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(r),this.performanceInfo.advance(bi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Wt.TRANSPARENT,y),this.performanceInfo.advance(bi.TRANSPARENT_EDGES),this._renderTransparentTerrain(),m&&v&&(y?this._renderLineCallouts(Yl.Occluded):h.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Yl.Occluded,h.framebuffer),this.performanceInfo.advance(bi.HUD_OCCLUDED)),this.performanceInfo.advance(bi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),m&&(h.compositeTransparentTerrainOntoMain(this._bindParameters),y&&(this._renderEdges(Wt.OPAQUE),this.performanceInfo.advance(bi.OPAQUE_EDGES),_&&(this._oitEnabled?this._renderOITPass(a2.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(bi.TRANSPARENT),this._renderEdges(Wt.TRANSPARENT),this.performanceInfo.advance(bi.TRANSPARENT_EDGES))),y&&this._renderLineCallouts(Yl.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),h.renderToTargets(()=>{this._renderInternalSlot(ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(ce.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(ce.LASERLINES)},h.currentColorTarget,h.mainDepth),this.performanceInfo.advance(bi.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&h.renderTmpAndCompositeToMain(()=>this._renderSlot(ce.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ia.PremultipliedAlpha),this.performanceInfo.advance(bi.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(bi.OCCLUDED);const w=s===Xb.ON&&this._magnifierHelper.enabled,T=w&&e==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(T);const x=this._offscreen.colorTexture;this._renderAntiAliasing(x)||x==null||this._compositingHelper.composite(this._bindParameters,x,ia.None),this.performanceInfo.advance(bi.ANTIALIASING),this._renderHUD(Yl.NotOccluded,T),this.performanceInfo.advance(bi.HUD),this._renderHighlights(T,this._bindParameters),this.performanceInfo.advance(bi.HIGHLIGHTS),w&&this._magnifierHelper.render(this._rctx,this._bindParameters),T!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,ia.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=d,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(e,r){this._renderContext.output=L.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(e),this._prepareSlots(ce.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._prepareInternalSlots(this._materialRenderers,ce.LINE_CALLOUTS),r&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(ce.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,ce.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(e){if(e!=null&&oe("enable-feature:objectAndLayerId-rendering")){const r=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(L.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Yl.NotOccluded,this._renderInternalSlot(ce.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=r}}finish(e){this._hasAnimations||this._animationTimestep.clear();const r=this.performanceInfo.gpuSamplingEnabled,i=e===fs.BACKGROUND;if(i||r){const s=i?this.performanceInfo.elapsedTime:0,n=r?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,i)}}readDepthPixels(e,r,i){const s=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const n=xi.COLOR_BUFFER_BIT|xi.DEPTH_BUFFER_BIT|xi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(n),this._renderGeometryAndTransparentTerrainPass(L.Depth)}s.readPixels(r[0],r[1],r[2],r[3],St.RGBA,Vs.UNSIGNED_BYTE,i)}readHUDVisibility(e,r,i,s,n){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,r,i,s,St.RGBA,Vs.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_prepareSlots(...e){this._renderPlugins.prepareSlots(e)}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,r=!1){const i=this._edgeView;i!=null&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,ia.Alpha,r)}_renderShadowMap(e,r,i,s){const n=this._shadowMap;n.enabled&&(n.start(r,i,s,this.isFeatureEnabled(Gs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(r,i),this._needsShadowHighlight?(this._renderShadowCascades(L.ShadowHighlight,this._shadowMap,o=>n.takeCascadeSnapshotTo(o,OS.Highlight)),n.clear(),this._renderShadowCascades(L.ShadowExcludeHighlight,this._shadowMap,o=>{n.takeCascadeSnapshotTo(o,OS.Default),this._renderGeometryAndTransparentTerrainPass(L.ShadowHighlight)})):this._renderShadowCascades(L.Shadow),n.finish(e),r.setGLViewport(this._rctx))}_renderShadowCascades(e,r=this._shadowMap,i=s=>{}){for(const s of r.cascades)s.camera.setGLViewport(this._rctx),this._prepare(s.camera,s.camera),this._renderGeometryAndTransparentTerrainPass(e),i(s)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(L.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const r=this._renderContext.output;this._renderContext.output=L.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const r=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(L.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(L.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return jG;const r=dft(e,this._materialRenderers,this._stage.layers);return IS(r,this.renderPlugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._prepareSlots(ce.TRANSPARENT_TERRAIN),this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._prepareSlots(ce.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(ce.INTEGRATED_MESH,ce.OPAQUE_TERRAIN,ce.OPAQUE_MATERIAL,ce.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,ce.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(ce.INTEGRATED_MESH),this._renderSlot(ce.OPAQUE_TERRAIN),this._renderInternalSlot(ce.OPAQUE_MATERIAL),this._renderSlot(ce.OPAQUE_MATERIAL),this._renderSlot(ce.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(ce.TRANSPARENT_MATERIAL),this._renderSlot(ce.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(ce.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let r=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,r=this._renderInternalSlot(ce.OCCLUSION_PIXELS)},e),r}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Yl.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(ce.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(ce.LINE_CALLOUTS)}_renderHUD(e,r){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(a2.HUD,e),this._rctx.bindFramebuffer(r),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,ia.PremultipliedAlpha)):e===Yl.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(Yl.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._prepareInternalSlots(this._materialRenderers,ce.LINE_CALLOUTS_HUD_DEPTH,ce.HUD_MATERIAL,ce.LABEL_MATERIAL),this._renderInternalSlot(ce.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(ce.HUD_MATERIAL),this._renderInternalSlot(ce.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,r){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,s=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(L.Highlight),this._rctx.clearSafe(xi.DEPTH_BUFFER_BIT),this._renderHUDElements(Yl.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=s.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(r,e),i.render(this._bindParameters,s,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,r,i){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,r,i)}_prepareTransparencySlots(){this._renderContext.output=L.Alpha,this._bindParameters.transparencyPassType=st.Alpha,this._prepareInternalSlots(this._materialRenderers,ce.TRANSPARENT_MATERIAL),this._prepareSlots(ce.TRANSPARENT_MATERIAL),this._renderContext.output=L.Color,this._bindParameters.transparencyPassType=st.Color,this._prepareInternalSlots(this._materialRenderers,ce.TRANSPARENT_MATERIAL),this._prepareSlots(ce.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=st.FrontFace,this._prepareInternalSlots(this._materialRenderers,ce.TRANSPARENT_MATERIAL),this._prepareSlots(ce.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=st.NONE}_renderOITPass(e,r=Yl.Both){const i=e===a2.HUD,s=i?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),n=a=>{this._bindParameters.transparencyPassType=a,this._offscreen.renderOITPass(s,a,i)},o=this._renderContext.output;this._renderContext.output=L.Alpha,n(st.Alpha),this._renderContext.output=L.Color,n(st.Color),n(st.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,i),this._bindParameters.transparencyPassType=st.NONE,this._renderContext.output=o,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let e=0;Ic.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&o.material.renderOccluded===Li.OccludeAndTransparentStencil&&(e|=o.material.renderOccluded,Ic.push(o))});const r=this._offscreen,i=(o,a,l,c,h)=>{e&a&&(r.renderToTargets(l,r.tmpColor,r.mainDepth,[0,0,0,0],c,h),r.compositeOccludedOntoMain(this._bindParameters,o))};Ic.length!==0&&(this._prepareInternalSlots(Ic,ce.OCCLUDER_MATERIAL,ce.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(ce.OCCLUDER_MATERIAL,Ic),i(.5,Li.OccludeAndTransparentStencil,()=>this._renderInternalSlot(ce.TRANSPARENT_OCCLUDER_MATERIAL,Ic),!1,!1)),Ic.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&(o.material.renderOccluded===Li.OccludeAndTransparent||o.material.renderOccluded===Li.Transparent||o.material.renderOccluded===Li.Opaque)&&(e|=o.material.renderOccluded,Ic.push(o))});const s=this._renderPlugins.renderOccludedFlags;if(e|=s,!e)return;const n=o=>{this._renderContext.renderOccludedMask=o,this._prepareInternalSlots(Ic,ce.OPAQUE_MATERIAL,ce.TRANSPARENT_MATERIAL,ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),s>Li.Occlude&&this._renderSlot(ce.OCCLUDED_TERRAIN),this._renderInternalSlot(ce.OPAQUE_MATERIAL,Ic),this._renderInternalSlot(ce.TRANSPARENT_MATERIAL,Ic),this._renderInternalSlot(ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Ic),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=L.Color,i(.5,Li.OccludeAndTransparent,()=>n(Li.OccludeAndTransparent),!0,Tl.OutlineVisualElementMask),i(.5,Li.Transparent,()=>n(Li.Transparent),!0,Tl.OutlineVisualElementMask),i(1,Li.Opaque,()=>n(Li.Opaque),!0,Tl.OutlineVisualElementMask),Ic.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&e!=null)return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,r){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(ce.TRANSPARENT_MATERIAL,L.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=r}_ensureBindParameters(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=nn:(xn(qle,this._bindParameters.camera.viewMatrix),xn(Hle,this._bindParameters.camera.projectionMatrix),ni(zx,qle,Hle),ni(zx,this._renderContext.lastFrameCamera.viewMatrix,zx),ni(zx,this._renderContext.lastFrameCamera.projectionMatrix,zx),this._reprojectionMatrix=zx),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const r=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=r>0?Math.min(r,e-this._ssrEnableTime)/r:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=nn,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(e,...r){for(const i of r)this._bindParameters.slot=i,e.forAll(s=>{s.material.shouldRender(this._renderContext)&&s.prepareTechnique(this._renderContext)})}_renderInternalSlot(e,r=this._materialRenderers){let i=!1;return this._bindParameters.slot=e,r.forAll(s=>{if(s.material.shouldRender(this._renderContext)){const n=s.prepareTechnique(this._renderContext);n!=null&&(s.render(this._renderContext,n),i=!0)}}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=S_e(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,r,i,s,n;return{offscreen:((e=this._offscreen)==null?void 0:e.gpuMemoryUsage)??0,highlights:(((r=this._highlight)==null?void 0:r.gpuMemoryUsage)??0)+(((i=this._shadowHighlight)==null?void 0:i.gpuMemoryUsage)??0),shadows:((s=this._shadowMap)==null?void 0:s.gpuMemoryUsage)??0,ssao:((n=this._ssaoHelper)==null?void 0:n.gpuMemoryUsage)??0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=$te()},getFramebufferTexture:r=>{switch(r){case M0.Color:return e._offscreen.colorTexture;case M0.LinearDepth:return e._offscreen.linearDepthTexture;case M0.Normals:return e._offscreen.normalTexture;case M0.ShadowMap:return e._shadowMap.depthTexture;case M0.HudVisibility:return e._offscreen.hudVisibilityTexture;case M0.Highlight:return e._offscreen.highlightTexture}}}}};var a2,M0;u([p()],Bl.prototype,"_renderPlugins",void 0),u([p()],Bl.prototype,"_shadowAccumulator",void 0),u([p()],Bl.prototype,"_state",void 0),u([p()],Bl.prototype,"_renderStateFeatures",void 0),u([p()],Bl.prototype,"_antialiasingEnabled",void 0),u([p({readOnly:!0})],Bl.prototype,"_antialiasing",null),u([p()],Bl.prototype,"_ssaoEnabled",void 0),u([p()],Bl.prototype,"_smaaPass",void 0),u([p({autoDestroy:!0})],Bl.prototype,"_edgeView",void 0),u([p()],Bl.prototype,"updating",null),u([p()],Bl.prototype,"isCameraFinal",null),Bl=u([R("esri.views.3d.webgl-engine.lib.Renderer")],Bl),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(a2||(a2={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(M0||(M0={}));const Ic=new Gt,Hle=ve(),qle=ve(),zx=ve();function cgt(t){return e=>t.immediate.schedule(e)}let kCe=class BCe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=BCe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Lr.createIndex(this._rctx,Tr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,wt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Et.POINTS,1,Ke.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},Wle=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:be.ONE,dstRGB:be.ZERO,srcAlpha:be.ONE,dstAlpha:be.ZERO},this.blendEquation={mode:kf.ADD,modeAlpha:kf.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=kd.BACK,this.frontFace=hS.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Kr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:kd.FRONT_AND_BACK,func:Kr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:kd.FRONT_AND_BACK,fail:gs.KEEP,zFail:gs.KEEP,zPass:gs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},ugt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${i}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const hgt={RECORD_ALLOCATIONS:!1};let dgt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new ugt(hgt.RECORD_ALLOCATIONS);this._current.length<wn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<wn.COUNT;++r){const i=this._current[r];i>0&&(e+=`${wn[r]}: ${i}
`)}}return e+=this._allocations.information,e}},pgt=class{constructor(e,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),pp(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const fgt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Zle,GCe={exports:{}};(Zle=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(GCe.exports=Zle);const mgt=FR(GCe.exports);var Xle,KG={exports:{}};KG.exports,Xle=KG,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Xle.exports=e)}();const Yle=FR(KG.exports);var jCe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(jCe);const ggt=FR(jCe.exports);var Jh=999,Jle=9999,B9=0,G9=1,Qle=2,Kle=3,ece=4,WI=5,ygt=6,_gt=7,vgt=8,tce=9,bgt=10,rce=11,wgt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function xgt(){var t,e,r,i=0,s=0,n=Jh,o=[],a=[],l=1,c=0,h=0,d=!1,f=!1,m="";return function(k){return a=[],k!==null?_(k.replace?k.replace(/\r\n/g,`
`):k):v()};function y(k){k.length&&a.push({type:wgt[n],data:k,position:h,line:l,column:c})}function _(k){var Z;for(i=0,r=(m+=k).length;t=m[i],i<r;){switch(Z=i,n){case B9:i=O();break;case G9:i=S();break;case Qle:i=x();break;case Kle:i=C();break;case ece:i=V();break;case rce:i=$();break;case WI:i=z();break;case Jle:i=B();break;case tce:i=T();break;case Jh:i=w()}Z!==i&&(m[Z]===`
`?(c=0,++l):++c)}return s+=i,m=m.slice(i),a}function v(k){return o.length&&y(o.join("")),n=bgt,y("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+i-1,n=B9,e=t,i+1):e==="/"&&t==="/"?(h=s+i-1,n=G9,e=t,i+1):t==="#"?(n=Qle,h=s+i,i):/\s/.test(t)?(n=tce,h=s+i,i):(d=/\d/.test(t),f=/[^\w_]/.test(t),h=s+i,n=d?ece:f?Kle:Jle,i)}function T(){return/[^\s]/g.test(t)?(y(o.join("")),n=Jh,i):(o.push(t),e=t,i+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(y(o.join("")),n=Jh,i)}function S(){return x()}function O(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),n=Jh,i+1):(o.push(t),e=t,i+1)}function C(){if(e==="."&&/\d/.test(t))return n=WI,i;if(e==="/"&&t==="*")return n=B9,i;if(e==="/"&&t==="/")return n=G9,i;if(t==="."&&o.length){for(;P(o););return n=WI,i}if(t===";"||t===")"||t==="("){if(o.length)for(;P(o););return y(t),n=Jh,i+1}var k=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||k){for(;P(o););return n=Jh,i}return o.push(t),e=t,i+1}function P(k){for(var Z,W,j=0;;){if(Z=Yle.indexOf(k.slice(0,k.length+j).join("")),W=Yle[Z],Z===-1){if(j--+k.length>0)continue;W=k.slice(0,1).join("")}return y(W),h+=W.length,(o=o.slice(W.length)).length}}function $(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),n=Jh,i):(o.push(t),e=t,i+1)}function V(){return t==="."||/[eE]/.test(t)?(o.push(t),n=WI,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=rce,o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=Jh,i):(o.push(t),e=t,i+1)}function z(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=Jh,i):(o.push(t),e=t,i+1)}function B(){if(/[^\d\w_]/.test(t)){var k=o.join("");return n=mgt.indexOf(k)>-1?vgt:ggt.indexOf(k)>-1?_gt:ygt,y(o.join("")),n=Jh,i}return o.push(t),e=t,i+1}}function Tgt(t){var e=xgt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function Sgt(t){return Tgt(t)}function Egt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const j9=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Cgt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function Agt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function k3(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,k3(t,e,i+"_"+e[i],i);return r}function HCe(t,e,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const d=l[h];if(d.type==="operator"&&d.data===";")return h}return null}function s(l){let c=-1,h=0,d=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++h:/\#endif\s*.*/.test(m.data)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(d=Math.max(d,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=i(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,y)}c<d&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function Ogt(t,e,r,i="lowp"){HCe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Rgt(t,e,r,i,s="lowp"){HCe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Pgt(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function ice(t,e){if(t.startsWith("#version 300"))return t;const r=Sgt(t);if(Cgt(r,"100","300 es")==="300 es")return t;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===Xc.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Xc.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Xc.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=k3(r,n,"fragColor"),Ogt(r,i,"vec4")),l.data=i),e===Xc.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Pgt(r,a+1),h=k3(r,n,"fragData");Rgt(r,h,"vec4",c,"mediump"),l.data=h}else e===Xc.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=k3(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(fgt.includes(l.data)){if(e===Xc.VERTEX_SHADER&&Agt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=k3(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&j9.includes(c[1].trim())){const f=r[a+1];r.splice(a,f&&f.type==="whitespace"?2:1)}const h=l.data.match(/\#ifdef\s+(.*)/);h&&h[1]&&j9.includes(h[1].trim())&&(l.data="#if 1");const d=l.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&j9.includes(d[1].trim())&&(l.data="#if 0")}}return Mgt(t,Egt(r))}function Mgt(t,e){return e}const Igt=4294967295;let $gt=class{constructor(e,r,i,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===ar.WEBGL2&&(r=ice(r,Xc.VERTEX_SHADER),i=ice(i,Xc.FRAGMENT_SHADER)),this._vShader=sce(this._context,Xc.VERTEX_SHADER,r),this._fShader=sce(this._context,Xc.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(wn.Shader,this),wB()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),wB()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===ar.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<Igt&&l.uniformBlockBinding(a,d,h)}}this._glName=a,this._context.instanceCounter.increment(wn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(wn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(wn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){Lp(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Lp(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Lp(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Lp(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){Lp(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){Lp(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3.set(e,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){Lp(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){Lp(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){Lp(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){Lp(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function sce(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),wB()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Xc.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(Lgt(r))),s}function Lgt(t){let e=2;return t.replaceAll(`
`,()=>`
`+Dgt(e++)+":")}function Dgt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Lp(t,e,r){const i=t.get(e);return i?DH(i,r):(t.set(e,Array.from(r)),!0)}let Ngt=class{constructor(e){this._rctx=e,this._store=new nE}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(n!=null)return n.ref(),n;const o=new $gt(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},rP=class{constructor(){this._result=!1}dispose(){this._program=Fe(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Fgt=class extends rP{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===ar.WEBGL2&&oe("mac")&&oe("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new vr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const s=new on(r,i),n=Lr.createIndex(this._rctx,Tr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(n,wt.ELEMENT_ARRAY_BUFFER),r.drawElements(Et.POINTS,1,Ke.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(Et.TRIANGLES,0,258);const o=new Uint8Array(4);return s.readPixels(0,0,1,1,St.RGBA,Vs.UNSIGNED_BYTE,o),s.dispose(),n.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${b.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${b.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=kCe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},Ugt=class extends rP{constructor(e){super(),this._rctx=e,this._program=nce(this._rctx,!1),this._obfuscated=nce(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Fe(this._obfuscated)}_test(e){if(oe("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new vr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const s=new on(r,i),n=Lr.createVertex(r,Tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Sh(r,new Map([["position",0]]),{geometry:[new mo("position",2,Ke.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Ae(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ae(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);c7(a,c,3);const h=new Float32Array(6);c7(l,h,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,St.RGBA,Vs.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=dX(d);return Math.abs(f-m)}};function nce(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let Vgt=class extends rP{constructor(e){var s,n,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===ar.WEBGL1)return void(this._result=!(!((s=e.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new vr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.dataType=Vs.FLOAT,i.internalFormat=Xe.RGBA32F,i.samplingMode=At.NEAREST;const s=new on(r,i),n=Lr.createVertex(r,Tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Sh(r,new Map([["a_pos",0]]),{geometry:[new mo("a_pos",2,Ke.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:h,height:d}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const f=Ot({blending:Jbe});r.setPipelineState(f),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const m=r.gl.getError();return r.setViewport(l,c,h,d),r.bindFramebuffer(a),o.dispose(),s.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},zgt=class extends rP{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new vr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const s=new on(r,i),n=new Uint8Array(4),o=Lr.createVertex(r,Tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Sh(r,new Map([["a_position",0]]),{geometry:[new mo("a_position",2,Ke.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Ct(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(e);const{x:h,y:d,width:f,height:m}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(Et.TRIANGLE_STRIP,0,4),r.setViewport(h,d,f,m),s.readPixels(0,0,1,1,St.RGBA,Vs.UNSIGNED_BYTE,n),a.dispose(),s.dispose();const y=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return y&&Q.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),y}};new mo("a_pos",2,Ke.BYTE,0,2);new mo("a_pos",2,Ke.BYTE,0,4),new mo("a_tex",2,Ke.BYTE,2,4);const kgt={geometry:[new mo("a_pos",2,Ke.UNSIGNED_SHORT,0,4)]};let Bgt=class extends rP{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new vr(1);i.wrapMode=Dt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const s=new on(r,i),n=Lr.createVertex(r,Tr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Sh(r,new Map([["a_pos",0]]),kgt,{geometry:n}),a=new vr;a.samplingMode=At.LINEAR,a.wrapMode=Dt.CLAMP_TO_EDGE;const l=new Ct(r,a,B3);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:h,y:d,width:f,height:m}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(xi.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return s.readPixels(0,0,1,1,St.RGBA,Vs.UNSIGNED_BYTE,y),o.dispose(),s.dispose(),l.dispose(),r.setViewport(h,d,f,m),r.bindFramebuffer(c),y[0]!==255}};const B3=new Image;B3.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",B3.width=5,B3.height=5,B3.decode();let Ggt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Vgt(e),this.svgPremultipliesAlpha=new Bgt(e),this.doublePrecisionRequiresObfuscation=new Ugt(e),this.ignoresSamplerPrecision=new zgt(e),this.drawArraysRequiresIndicesTypeReset=new Fgt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function jgt(t,e){if(e.disjointTimerQuery)return null;if(pp(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Hgt(t){if(pp(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function qgt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Wgt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function Zgt(t,e){if(pp(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function Xgt(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Ygt(t,e){if(pp(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function Jgt(t,e){if(pp(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function oce(t,e,r,i,s){if(i&&pp(t))return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function Qgt(t,e){if(!pp(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function Kgt(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function eyt(t,e){if(pp(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let tyt=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=jgt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Hgt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=eyt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=qgt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Wgt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Xgt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=ngt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=Ygt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=Jgt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=Zgt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=oce(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=Kgt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Qgt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=oce(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},ryt=class{constructor(e,r){this.gl=e,this.instanceCounter=new dgt,this.programCache=new Ngt(this),this._state=new Wle,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=pp(e)?ar.WEBGL2:ar.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===ar.WEBGL1?null:this.gl}configure(e){this._capabilities=new tyt(this.gl,e),this._parameters=new pgt(this.gl,this._capabilities,e),Ct.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Wle,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new ike({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),Fe(this._driverTest),this._driverTest=new Ggt(this)}dispose(){Fe(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),this.type===ar.WEBGL2&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Wu()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,s){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,r,i,s),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,r,i,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,s){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(e,r,i,s),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,s){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(e,r,i,s),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(e,r,i,s),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=kd.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,r,i,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===kd.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=kd.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,r,i,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(vU+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&xi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&xi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&xi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(Wu()&&(this._numOfDrawCalls++,this._numOfTriangles+=ace(e,i)),this.gl.drawArrays(e,r,i),Wu()){const s=qee(this);s&&console.error("drawArrays:",s)}}drawElements(e,r,i,s){if(Wu()&&(this._numOfDrawCalls++,this._numOfTriangles+=ace(e,r)),this.gl.drawElements(e,r,i,s),Wu()){const n=qee(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:r,type:i,offset:s},d=(a==null?void 0:a.size)??0,f=s+r,m=d<f?`. Buffer is too small. Attempted to draw index ${f} of ${d}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){Wu()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Wu()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===r&&n.width===i&&n.height===s||(n.x=e,n.y=r,n.width=i,n.height=s,this.gl.viewport(e,r,i,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return e==null||e.glName==null?(s!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,s):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(lo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(lo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const s=r===lo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),s?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,s=0,n=e.width,o=e.height,a=0,l=0,c=r.width,h=r.height,d=xi.COLOR_BUFFER_BIT,f=At.NEAREST){this.bindFramebufferSeparate(e,lo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,lo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,h,d,f)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Fl(this.gl,e,r,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Fl(this.gl,e,r,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Fl(this.gl,e,r,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Fl(this.gl,e,r,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Fl(this.gl,e,r,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Fl(this.gl,e,r,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Fl(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return s==null&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(e,r,i){const s=this._getBufferBinding(e,r);s!=null&&(s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0))}bindBufferRange(e,r,i,s,n){const o=this._getBufferBinding(e,r);if(o!=null&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(e,r,i,s){r!=null?(Wu()&&(s??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(wt.UNIFORM_BUFFER,e,r.buffer,i,s):this.bindBufferBase(wt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(wt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(wt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Fl(this.gl,null,e,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Fl(this.gl,null,e,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Fl(this.gl,null,e,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Fl(this.gl,null,e,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Fl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Fl(this.gl,null,e,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Fl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(bB.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(wn.Sync,i),r.flush();do await sO(e),s=r.clientWaitSync(i,0,0);while(s===yN.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(wn.Sync,i),r.deleteSync(i),s===yN.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=lo.FRAMEBUFFER){return e===lo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),this.type===ar.WEBGL2&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(be.ONE,be.ZERO),this.setBlendEquation(kf.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(kd.BACK),this.setFrontFace(hS.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Kr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Kr.ALWAYS,0,0),this.setStencilOp(gs.KEEP,gs.KEEP,gs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var n,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)r.disableVertexAttribArray(l);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(wt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(wt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(wt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(c!=null){const{buffer:h,offset:d,size:f}=c;h!==null?d===0&&f===0?i.bindBufferBase(wt.UNIFORM_BUFFER,l,h.glName):i.bindBufferRange(wt.UNIFORM_BUFFER,l,h.glName,d,f):i.bindBufferBase(wt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(wt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(wt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(wt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(wt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(lo.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(lo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(Bc.COLOR_ATTACHMENT0)),i.bindFramebuffer(lo.DRAW_FRAMEBUFFER,((n=this._state.drawFramebuffer)==null?void 0:n.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(lo.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}r.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){r.activeTexture(vU+l),r.bindTexture(os.TEXTURE_2D,null),r.bindTexture(os.TEXTURE_CUBE_MAP,null),this.type===ar.WEBGL2&&(r.bindTexture(os.TEXTURE_3D,null),r.bindTexture(os.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];c!=null&&r.bindTexture(c.descriptor.target,c.glName)}r.activeTexture(vU+this._state.activeTexture);const s=this._state.viewport;r.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===ar.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function Fl(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function ace(t,e){switch(t){case Et.POINTS:return 2*e;case Et.TRIANGLES:return e/3;case Et.TRIANGLE_STRIP:case Et.TRIANGLE_FAN:return e-2;default:return 0}}let iyt=class extends ryt{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}bindTechnique(e,r,i,s){return this.useProgram(e.program),e.bindPipelineState(this,i==null?void 0:i.slot,!!s),e.program.bindPass(r,i),e.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new kCe(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}},wT=class extends xe{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Ls,this._frameTask=e.view.resourceController.scheduler.registerTask(pt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(as.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(YX,new JX)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",fs.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return tt(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new syt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),r.glTexture!=null?(this._updateGLTexture(s,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,ys(l)||Q.getLogger(this).error(l),null);return gu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",fs.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([p()],wT.prototype,"_loadingCount",void 0),u([p()],wT.prototype,"_frameTask",void 0),u([p()],wT.prototype,"updating",null),wT=u([R("esri.views.3d.webgl-engine.lib.TextureRepository")],wT);let syt=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(Q.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function nyt(t,e){return new Nxe(r=>rKe(r,t),r=>r,e)}let G3=class extends xe{constructor(){super(...arguments),this._passParameters=new oyt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=Fe(this._passParameters.waveNormal),this._passParameters.wavePertubation=Fe(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return gg.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return gg.LOADED;const r=new vr;return r.samplingMode=At.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.maxAnisotropy=8,++this._loading,kg(Br("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Ct(e,{...r,width:i.width,height:i.height},i)).catch(i=>Q.getLogger(this).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,kg(Br("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Ct(e,{...r,width:i.width,height:i.height},i)).catch(i=>Q.getLogger(this).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),gg.LOADING}};u([p()],G3.prototype,"_loading",void 0),u([p({type:Boolean,readOnly:!0})],G3.prototype,"updating",null),G3=u([R("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],G3);let oyt=class extends ei{};const lce=2048,ayt=1.5,lyt=8;function cyt(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=ZY(t,e.padding),a=gyt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=myt(t,a),h=vyt(r),d=Syt[h];return{format:h,quality:_e(i??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function uyt(t,e){const r=cyt(t,e),i=r.area,s=r.width/i.width,n=ZY(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),d=Math.floor(c*s+a),f=t&&t.layers?t.layers:[],m=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:d,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function H9(t,e,r){const{ctx:i,canvas:s}=qCe(t,r),n=i.getImageData(0,0,t.width,t.height),o=dyt(s,e);return WCe(s),{dataUrl:o,data:n}}function q9(t,e){const{ctx:r,canvas:i}=qCe(t,e),s=r.getImageData(0,0,t.width,t.height);return WCe(i),s}function qCe(t,e){const r=hyt();e.premultipliedAlpha&&wyt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&byt(i),{ctx:i,canvas:r}}function WCe(t){t.width=0,t.height=0}function hyt(){return W9==null&&(W9=document.createElement("canvas")),W9}let W9=null;function dyt(t,e){const r=xyt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function pyt(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:d}=e,f=n/c,m=o/h,y=Math.ceil(f/2),_=Math.ceil(m/2),v=t.width;for(let w=0;w<h;w++)for(let T=0;T<c;T++){const x=4*(T+(a?h-w-1:w)*c);let S=0,O=0,C=0,P=0,$=0,V=0;const z=(w+.5)*m;for(let B=Math.floor(w*m);B<(w+1)*m;B++){const k=Math.abs(z-(B+.5))/_,Z=(T+.5)*f,W=k*k;for(let j=Math.floor(T*f);j<(T+1)*f;j++){const Y=Math.abs(Z-(j+.5))/y,M=Math.sqrt(W+Y*Y);if(M>=1)continue;let D=2*M*M*M-3*M*M+1;const N=4*(i+j+(s+B)*v);V+=D*l[N+3],O+=D,!r&&l[N+3]<255&&(D=D*l[N+3]/255),C+=D*l[N],P+=D*l[N+1],$+=D*l[N+2],S+=D}}d[x]=C/S,d[x+1]=P/S,d[x+2]=$/S,d[x+3]=V/O}return e}function fyt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=ZY(t,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,d=s-c,f=Math.min(lyt,Math.min((lce-l)/h,(lce-c)/d));return f<ayt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(d*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:s}}}function myt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function gyt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return yyt(_yt(r,t),e)}function yyt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function _yt(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function ZY(t,e){return!e||t&&t.ignorePadding?Eyt:e}function vyt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Tyt}}function byt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function wyt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i]=e[i]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const xyt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},cce=98,Tyt="png",Syt={png:100,jpg:cce,jpeg:cce},Eyt={top:0,right:0,bottom:0,left:0};let Cyt=class{constructor(e,r){this.parameters=e,this.frameHasDecorations=r}},Ayt=class{constructor(e,r,i,s){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(fs.BACKGROUND);const r=yo();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=j8(i,s,a);this._rctx.gl.readPixels(0,0,i,s,St.RGBA,Ke.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=j8(n.width,n.height,a);return pyt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=j8(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,St.RGBA,Ke.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){let s=null;const n=e.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};ob(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&e.frameHasDecorations,c=o.width!==n.fullWidth||o.height!==n.fullHeight,h=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,d=c||l||h||r.objectAndLayerIdColor,f=r.objectAndLayerIdColor?new on(this._rctx,new vr(o.width,o.height),new wN(Bs.DEPTH_STENCIL,o.width,o.height)):null;if(d){const v=n.clone();if(r.ignorePadding){const O=OR(v.padding);for(let C=0;C<4;C++)O[C]=Math.round(O[C]/v.pixelRatio*r.pixelRatio);v.padding=O}v.fullWidth=o.width,v.fullHeight=o.height,v.pixelRatio=r.pixelRatio;const w=n.fovX-v.fovX,T=n.fovY-v.fovY;w<0&&w<T?v.fovX=n.fovX:T<0&&T<w&&(v.fovY=n.fovY);const x={camera:v,contentCamera:v,mode:$r.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),a=!0,s=new on(this._rctx,new vr(o.width,o.height),new wN(Bs.DEPTH_STENCIL,o.width,o.height));const S=r.disableDecorations?Xb.OFF:Xb.ON;this._renderFunctions.renderScene(s,f,x,S,i),this._disposeOffscreenBuffers()}const m=()=>{this._rctx.bindFramebuffer(null),Fe(s)},y=this._readbackScreenshot(r,m);m();let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),Fe(f)};this._rctx.bindFramebuffer(f),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null),v()}if(d&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return a&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},$n=class extends xe{constructor(e){super({}),this.events=new Ls,this.waterTextureRepository=new G3,this._magnifierHelper=new bT,this.objectAndLayerIdRenderHelper=oe("enable-feature:objectAndLayerId-rendering")?new Oft:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([ue(()=>{var s;return(s=this.waterTextureRepository)==null?void 0:s.updating},()=>this.requestRender(),zr),ue(()=>e.view.qualityProfile,s=>{var n;return(n=this.renderer)==null?void 0:n.updateRenderFeature(s)},As),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextureRepository=qQe(this._rctx,r),this.markerTextureRepository=nyt(this._rctx,r),this._shaderTechniqueRepository=new Pxe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new wT(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",s=>this.requestRender(s))),this._materialRepository=new Mxe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new oft(this._rctx,this._shaderTechniqueRepository),this.renderer=new Bl(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,s=>this.requestRender(s));const i={renderScene:(s,n,o,a,l)=>this.renderer.render(s,n,o,a,l),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n)=>e.options.screenshot.renderOverlay(s,n)};this._screenshotManager=new Ayt(this._rctx,i,s=>this.events.emit("force-camera-for-screenshot",s),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Di(this._frameTask),this._shaderTechniqueRepository=Pe(this._shaderTechniqueRepository)}requestRender(e=fs.UPDATE){this._needsRender=!0,e===fs.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,s,n,o=n){const a=s.constrainWindowSize(r,i,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const d=hft(4*h,l,s.nearFar);c>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(c=d)}if(e!=null){const h=e.pickDepth(r*s.pixelRatio,i*s.pixelRatio,s);h!=null&&c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){NSe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,s=fs.BACKGROUND,n=!1;const o={preRender:({time:a})=>{i=this.updating,s=this._needsUpdate?fs.UPDATE:fs.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new xbe(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(fs.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,Xb.ON,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(fs.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new Cyt(r,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(r.mode===$r.IDLE?s:fs.UPDATE),n=!1)}};this._frameTask=k2(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},s=oke("3d",this._canvas,i);s!=null?(this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&Q.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&oe("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):Q.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>r.view.resourceController.memoryController.newCache(n,o);return new iyt(e,i,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new Wpt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([p({type:Boolean,readOnly:!0})],$n.prototype,"updating",null),u([p({autoDestroy:!0})],$n.prototype,"_rctx",void 0),u([p({autoDestroy:!0})],$n.prototype,"_container",void 0),u([p({autoDestroy:!0})],$n.prototype,"_canvas",void 0),u([p({autoDestroy:!0})],$n.prototype,"stippleTextureRepository",void 0),u([p({autoDestroy:!0})],$n.prototype,"markerTextureRepository",void 0),u([p({autoDestroy:!0})],$n.prototype,"waterTextureRepository",void 0),u([p({autoDestroy:!0})],$n.prototype,"_magnifierHelper",void 0),u([p({readOnly:!0})],$n.prototype,"objectAndLayerIdRenderHelper",void 0),u([p({autoDestroy:!0})],$n.prototype,"_textureRepository",void 0),u([p({autoDestroy:!0})],$n.prototype,"_compositingHelper",void 0),u([p({autoDestroy:!0,readOnly:!0})],$n.prototype,"renderer",void 0),u([p({autoDestroy:!0})],$n.prototype,"_screenshotManager",void 0),u([p()],$n.prototype,"componentObjectCollection",null),u([p({autoDestroy:!0})],$n.prototype,"_componentObjectCollection",void 0),u([p()],$n.prototype,"_needsUpdate",void 0),u([p()],$n.prototype,"_needsWaterReflectionUpdate",void 0),$n=u([R("esri.views.3d.webgl-engine.parts.RenderView")],$n);let Fc=class extends xe{constructor(e){super(e),this._model=new VL,this._layers=new Gt,this._asyncChangeSet=new sG,this._syncChangeSet=new sG,this._layerSyncSet=new Set}initialize(){this._set("renderView",new $n(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(pt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),e4(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),e4(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}async load(e,r){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>i.glTexture==null).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===d_.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?Va:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Va),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==d_.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===d_.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Va),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Va),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Va))}addRenderPlugin(e,r,i){const s=this.renderer.renderPlugins.add(e,r,i),n=()=>{qne(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(gu(s))return s.then(n);n()}removeRenderPlugin(e){this.destroyed||(qne(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};Fc.DebugSettings={endFrameContentValidation:!1},u([p({constructOnly:!0})],Fc.prototype,"view",void 0),u([p({constructOnly:!0})],Fc.prototype,"options",void 0),u([p({readOnly:!0})],Fc.prototype,"viewingMode",null),u([p({constructOnly:!0})],Fc.prototype,"container",void 0),u([p({readOnly:!0})],Fc.prototype,"updating",null),u([p({constructOnly:!0})],Fc.prototype,"_model",void 0),u([p({autoDestroy:!0})],Fc.prototype,"renderView",void 0),u([p({readOnly:!0})],Fc.prototype,"renderer",null),u([p({readOnly:!0})],Fc.prototype,"running",null),Fc=u([R("esri.views.3d.webgl-engine.Stage")],Fc);let pFt=class extends fF{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function ZCe(t){return hp(t)&&t.intersector===Gi.PCL&&!!t.target}let mFt=class extends Hve{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},yFt=class extends fF{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function c6(t){return hp(t)&&t.intersector===Gi.I3S&&!!t.target}function XCe(t){return hp(t)&&t.intersector===Gi.VOXEL&&!!t.target}function uce(t,e){var r,i;return mF(t)||gF(t)?sR((r=t.target)==null?void 0:r.object,e):TKe(t)?(i=e.map)==null?void 0:i.ground:ZCe(t)||c6(t)||Qxe(t)||XCe(t)?sR(t.target,e):null}function vFt(t,e){const r=ej(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function ej(t,e){var r;if(t==null)return null;if(mF(t)||gF(t))return hce((r=t.target)==null?void 0:r.object,e);if(ZCe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(XCe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return Qxe(t)||gY(t)?hce(t.target,e):c6(t)?Oyt(t.target,e):null}function hce(t,e){if(t==null||t.graphicUid==null)return null;const r=sR(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function Oyt(t,e){const r=sR(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?Pyt(i.getGraphicFromIntersectorTarget(t)):null}function Ryt(t,e){const r=sR(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function Pyt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function sR(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function bFt(t,e){if(mF(t)||gF(t))return mg(t.target.object.boundingVolumeWorldSpace.bounds);if(gY(t)){vge(ZI,t.transformation);const r=Math.max(ZI[0],ZI[1],ZI[2]);return t.target.baseBoundingSphere.radius*r}return c6(t)?lc(Ryt(t.target,e),r=>.5*Cme(r)):null}function wFt(t){return!mF(t)&&!gF(t)&&(gY(t)?t.target.numLodLevels>1:!!c6(t))}const ZI=A();async function Myt(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+Iyt),s=r.results.findIndex(n=>(n.distance??0)>i);return s!==-1&&(r.results=r.results.slice(0,s)),r}const Iyt=.05;function xFt(t){return t&&typeof t.highlight=="function"}function $yt(t){return t&&typeof t.maskOccludee=="function"}function TFt(t,e,r){return t==null||t>r&&(e===0||t<e)}function SFt(t,e){return t!=null&&t>0||e!=null&&e>0}function EFt(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let Z9,X9;function Lyt(t){const e=b_e(t);for(;e.length>1;){const r=dce(e.shift());if(r.available)return r}return dce(e.shift())}function dce(t){switch(t){case ar.WEBGL1:return Dyt();case ar.WEBGL2:return Nyt()}}function Dyt(){return Z9||(Z9=Vyt()),Z9}function Nyt(){return X9||(X9=zyt()),X9}let YCe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},Fyt=class extends YCe{constructor(){super(...arguments),this.type=ar.WEBGL1}},Uyt=class extends YCe{constructor(){super(...arguments),this.type=ar.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function JCe(t,e){if(t===ar.WEBGL1&&typeof WebGLRenderingContext>"u"||t===ar.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=xB(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=xB(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===ar.WEBGL1){const n=i.getParameter(i.VERSION),o=n==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}function Vyt(){const t=new Fyt,e=JCe(ar.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function zyt(){const t=new Uyt,e=JCe(ar.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function kyt(t){const e=Lyt(t);if(!e.available)return new U("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new U("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new U("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new U("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===ar.WEBGL1){if(!e.supportsElementIndexUint)return new U("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new U("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new U("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Byt(t){return t&&"nodeType"in t}function Gyt(t){return t&&typeof t.render=="function"}const pce={component:"esri-component"};let w1=class extends xe{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(pce.component),r&&r.classList.remove(pce.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||Byt(e)?(this._set("widget",null),P5(e)):(Gyt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([p({dependsOn:[]})],w1.prototype,"id",null),u([p()],w1.prototype,"node",null),u([yr("node")],w1.prototype,"castNode",null),u([p({readOnly:!0})],w1.prototype,"widget",void 0),w1=u([R("esri.views.ui.Component")],w1);const jL=w1,QCe="calcite-mode-";function jyt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function Hyt(){return jyt().startsWith("dark")}function qyt(){return`${QCe}${Hyt()?"dark":"light"}`}function Wyt(t){Zyt(t),t.classList.add(qyt())}function Zyt(t){Array.from(t.classList).forEach(e=>{e.startsWith(QCe)&&t.classList.remove(e)})}const Xyt={left:0,top:0,bottom:0,right:0},KCe={bottom:30,top:15,right:15,left:15},Sm="esri-ui",Ul={ui:Sm,corner:`${Sm}-corner`,innerContainer:`${Sm}-inner-container`,manualContainer:`${Sm}-manual-container`,cornerContainer:`${Sm}-corner-container`,topLeft:`${Sm}-top-left`,topRight:`${Sm}-top-right`,bottomLeft:`${Sm}-bottom-left`,bottomRight:`${Sm}-bottom-right`};function Yyt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function XI(t){return t===0?"0":`${t}px`}function Y9(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function J9(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let ef=class extends Ls.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Wd(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&J9(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&J9(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ue(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,zr),ue(()=>this.padding,this._applyUIPadding,zr),ue(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},zr),Yde(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(Ul.ui),Wyt(e),this._attachContainers(e)),r&&(r.classList.remove(Ul.ui),J9(r,{top:"",bottom:"",left:"",right:""}),age(r)),this._set("container",e))}get height(){var n;const e=((n=this.view)==null?void 0:n.height)??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:s}=r;return Math.max(e-i-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...KCe,...e}}get width(){var n;const e=((n=this.view)==null?void 0:n.width)??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:s}=r;return Math.max(e-i-s,0)}add(e,r){let i,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,r));const o=Y9(e);o&&({index:i,position:r,component:e,key:s}=o),r&&typeof r=="object"&&({index:i,key:s,position:r,internal:n}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,s,n)}remove(e,r){var s;if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,r));const i=this._find(e);if(i){if(this._componentMap.has(e)&&((s=this._componentMap.get(e))==null?void 0:s.key)!==r)return;const n=this._components.indexOf(i),o=i.node.parentNode;return o==null||o.removeChild(i.node),this._componentMap.delete(e),this._components.splice(n,1)[0]}}empty(e,r={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,r);return}const i=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(n=>{var o;return n==null?!1:!(((o=this._componentMap.get(n))==null?void 0:o.internal)??!1)||r.removeInternal});for(const n of s)this.remove(n)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const s=Y9(e)||Y9(r);if(s&&(i=s.index,r=s.position,e=s.component||e),r&&!this._isValidPosition(r))return;const n=this.remove(e);n&&this.add(n,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e,r={includeInternal:!1}){return e?Array.isArray(e)?e.map(i=>this._getComponentsAtPosition(i,r)).flat():this._getComponentsAtPosition(e,r):this._components.filter(i=>{var s;return r.includeInternal||!((s=this._componentMap.get(i))!=null&&s.internal)}).map(({widget:i,node:s})=>i??s)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,s,n){e instanceof jL||(e=new jL({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof jL?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??Xyt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Ul.innerContainer,Ul.cornerContainer);const r=document.createElement("div");r.classList.add(Ul.innerContainer,Ul.manualContainer);const i=document.createElement("div");i.classList.add(Ul.topLeft,Ul.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(Ul.topRight,Ul.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Ul.bottomLeft,Ul.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Ul.bottomRight,Ul.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=l9e();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:i,"top-trailing":a?i:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:s}=e,n=this._positionNameToContainerLookup[r],o=s!=null&&s>-1;if(Yyt(i.widget)&&i.widget.startup(),!o)return void n.appendChild(i.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?wK(i.node,n.firstChild):n.appendChild(i.node));s>=a.length?n.appendChild(i.node):wK(i.node,a[s])}_toPixelPosition(e){return{top:XI(e.top),left:XI(e.left),right:XI(e.right),bottom:XI(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e,r){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(fw).filter(s=>{var n;return r.includeInternal||!((n=this._componentMap.get(s))!=null&&n.internal)}).map(({widget:s,node:n})=>s??n)}};u([p()],ef.prototype,"_locale",void 0),u([p()],ef.prototype,"container",null),u([p()],ef.prototype,"height",null),u([p({value:KCe})],ef.prototype,"padding",null),u([yr("padding")],ef.prototype,"castPadding",null),u([p()],ef.prototype,"view",void 0),u([p()],ef.prototype,"width",null),ef=u([R("esri.views.ui.UI")],ef);const Jyt=ef,Qyt="randomUUID"in crypto;function u6(){if(Qyt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function MFt(){return`{${u6()}}`}const Kyt={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},e0t={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},t0t=t=>({...e0t,...t}),r0t=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},i0t=(t,e)=>t.find(e),fce=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i!=null&&i.children?i0t(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},s0t=t=>{let e;const r={...Kyt,...t},i=t0t(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var w;let _;i.eventHandlerInterceptor=(T,x,S,O)=>function(C){let P;s("domEvent",C);const $=r0t(C.currentTarget,_.domNode),V=$.some(B=>{var k;return customElements.get((k=B==null?void 0:B.tagName)==null?void 0:k.toLowerCase())});if(C.eventPhase===Event.CAPTURING_PHASE||!V)$.reverse(),P=fce(_.getLastRender(),$);else{const B=C.composedPath(),k=B.slice(B.indexOf(C.currentTarget),B.indexOf(_.domNode)).filter(Z=>Z.getRootNode()===Z.ownerDocument).reverse();P=fce(_.getLastRender(),k,!0)}let z;return P&&(z=r.handleInterceptedEvent(e,P,this,C)),s("domEventProcessed",C),z},(w=r.postProcessProjectionOptions)==null||w.call(r,i);const v=y();_=f(m,v,i),l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(d=r.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(e_.append,f,m)},insertBefore:(f,m)=>{h(e_.insertBefore,f,m)},merge:(f,m)=>{h(e_.merge,f,m)},replace:(f,m)=>{h(e_.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},xT={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let TT,e3e,h6,t3e=!1,R4=!1,XY=!1,Wc=!1,mce=null,tj=!1;const n0t=t=>{const e=new URL(t,Go.$resourcesUrl$);return e.origin!==nP.location.origin?e.href:e.pathname},o0t=t=>Go.$resourcesUrl$=t,hw=(t,e="")=>()=>{},gce="http://www.w3.org/1999/xlink",yce={},a0t="http://www.w3.org/2000/svg",l0t="http://www.w3.org/1999/xhtml",c0t=t=>t!=null,YY=t=>(t=typeof t,t==="object"||t==="function");function u0t(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const r3e=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let f=0;f<d.length;f++)i=d[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!YY(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?P4(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(f=>d[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,p0t);const h=P4(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=s,h.$name$=n,h},P4=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},h0t={},d0t=t=>t&&t.$tag$===h0t,p0t={forEach:(t,e)=>t.map(_ce).forEach(e),map:(t,e)=>t.map(_ce).map(e).map(f0t)},_ce=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),f0t=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),r3e(t.vtag,r,...t.vchildren||[])}const e=P4(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},m0t=t=>B0t.map(e=>e(t)).find(e=>!!e),g0t=(t,e)=>t!=null&&!YY(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,y0t=t=>t,IFt=(t,e,r)=>{const i=y0t(t);return{emit:s=>_0t(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},_0t=(t,e,r)=>{const i=Go.ce(e,r);return t.dispatchEvent(i),i},vce=new WeakMap,v0t=(t,e,r)=>{let i=I4.get(t);H0t&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,I4.set(t,i)},b0t=(t,e,r,i)=>{var s;let n=i3e(e,r);const o=I4.get(n);if(t=t.nodeType===11?t:Kd,o)if(typeof o=="string"){t=t.head||t;let a=vce.get(t),l;if(a||vce.set(t,a=new Set),!a.has(n)){{l=Kd.createElement("style"),l.innerHTML=o;const c=(s=Go.$nonce$)!==null&&s!==void 0?s:u0t(Kd);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(n)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return n},w0t=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=hw("attachStyles",e.$tagName$),n=b0t(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},i3e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),bce=(t,e,r,i,s,n)=>{if(r!==i){let o=Sce(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=wce(r),h=wce(i);l.remove(...c.filter(d=>d&&!h.includes(d))),l.add(...h.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Sce(nP,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&Go.rel(t,e,r,!1),i&&Go.ael(t,e,i,!1);else{const l=YY(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const h=i??"";e==="list"?o=!1:(r==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(gce,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(gce,e,i):t.setAttribute(e,i))}}},x0t=/\s/,wce=t=>t?t.split(x0t):[],s3e=(t,e,r,i)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||yce,o=e.$attrs$||yce;for(i in n)i in o||bce(s,i,n[i],void 0,r,e.$flags$);for(i in o)bce(s,i,n[i],o[i],r,e.$flags$)},M4=(t,e,r,i)=>{const s=e.$children$[r];let n=0,o,a,l;if(t3e||(XY=!0,s.$tag$==="slot"&&(TT&&i.classList.add(TT+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Kd.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Kd.createTextNode("");else{if(Wc||(Wc=s.$tag$==="svg"),o=s.$elm$=Kd.createElementNS(Wc?a0t:l0t,s.$flags$&2?"slot-fb":s.$tag$),Wc&&s.$tag$==="foreignObject"&&(Wc=!1),s3e(null,s,Wc),c0t(TT)&&o["s-si"]!==TT&&o.classList.add(o["s-si"]=TT),s.$children$)for(n=0;n<s.$children$.length;++n)a=M4(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?Wc=!1:o.tagName==="foreignObject"&&(Wc=!0)}return o["s-hn"]=h6,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=e3e,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===s.$tag$&&t.$elm$&&nR(t.$elm$,!1)),o},nR=(t,e)=>{Go.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==h6&&s["s-ol"]&&(a3e(s).insertBefore(s,JY(s)),s["s-ol"].remove(),s["s-ol"]=void 0,XY=!0),e&&nR(s,e)}Go.$flags$&=-2},n3e=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===h6&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=M4(null,r,s,t),a&&(i[s].$elm$=a,o.insertBefore(a,JY(e))))},o3e=(t,e,r,i,s)=>{for(;e<=r;++e)(i=t[e])&&(s=i.$elm$,u3e(i),R4=!0,s["s-ol"]?s["s-ol"].remove():nR(s,!0),s.remove())},T0t=(t,e,r,i)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],d=i.length-1,f=i[0],m=i[d],y,_;for(;s<=l&&n<=d;)if(c==null)c=e[++s];else if(h==null)h=e[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--d];else if(YI(c,f))ST(c,f),c=e[++s],f=i[++n];else if(YI(h,m))ST(h,m),h=e[--l],m=i[--d];else if(YI(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&nR(c.$elm$.parentNode,!1),ST(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++s],m=i[--d];else if(YI(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&nR(h.$elm$.parentNode,!1),ST(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?y=M4(e&&e[n],r,o,t):(ST(_,f),e[o]=void 0,y=_.$elm$),f=i[++n]):(y=M4(e&&e[n],r,n,t),f=i[++n]),y&&a3e(c.$elm$).insertBefore(y,JY(c.$elm$))}s>l?n3e(t,i[d+1]==null?null:i[d+1].$elm$,r,i,n,d):n>d&&o3e(e,s,l)},YI=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,JY=t=>t&&t["s-ol"]||t,a3e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,ST=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(Wc=n==="svg"?!0:n==="foreignObject"?!1:Wc,n==="slot"||s3e(t,e,Wc),i!==null&&s!==null?T0t(r,i,e,s):s!==null?(t.$text$!==null&&(r.textContent=""),n3e(r,null,e,s,0,s.length-1)):i!==null&&o3e(i,0,i.length-1),Wc&&n==="svg"&&(Wc=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},l3e=t=>{const e=t.childNodes;let r,i,s,n,o,a;for(i=0,s=e.length;i<s;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){r.hidden=!0;break}}l3e(r)}},Ld=[],c3e=t=>{let e,r,i,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(xce(r,s)?(n=Ld.find(h=>h.$nodeToRelocate$===r),R4=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=e:Ld.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&Ld.map(h=>{xce(h.$nodeToRelocate$,r["s-sn"])&&(n=Ld.find(d=>d.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Ld.some(h=>h.$nodeToRelocate$===r)||Ld.push({$nodeToRelocate$:r}));e.nodeType===1&&c3e(e)}},xce=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",u3e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(u3e)},S0t=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,s=t.$vnode$||P4(null,null),n=d0t(e)?e:r3e(null,null,e);h6=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,TT=r["s-sc"],e3e=r["s-cr"],t3e=(i.$flags$&1)!==0,R4=!1,ST(s,n);{if(Go.$flags$|=1,XY){c3e(n.$elm$);let o,a,l,c,h,d,f=0;for(;f<Ld.length;f++)o=Ld[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Kd.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Ld.length;f++)if(o=Ld[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){h=d;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}R4&&l3e(n.$elm$),Go.$flags$&=-2,Ld.length=0}},E0t=(t,e)=>{},QY=(t,e)=>(t.$flags$|=16,E0t(t,t.$ancestorComponent$),Z0t(()=>C0t(t,e))),C0t=(t,e)=>{const r=t.$hostElement$,i=hw("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;let n;return e?n=L2(s,"componentWillLoad"):n=L2(s,"componentWillUpdate"),n=Tce(n,()=>L2(s,"componentWillRender")),i(),Tce(n,()=>A0t(t,s,e))},A0t=async(t,e,r)=>{const i=t.$hostElement$,s=hw("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&w0t(t);const n=hw("render",t.$cmpMeta$.$tagName$);O0t(t,e,i),n(),s(),R0t(t)},O0t=(t,e,r)=>{try{mce=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(xT.hasRenderFn||xT.reflect)&&(xT.vdomRender||xT.reflect)&&(xT.hydrateServerSide||S0t(t,e))}catch(a){sP(a,t.$hostElement$)}return mce=null,null},R0t=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=hw("postUpdate",e),s=r;t.$ancestorComponent$,L2(s,"componentDidRender"),t.$flags$&64?(L2(s,"componentDidUpdate"),i()):(t.$flags$|=64,L2(s,"componentDidLoad"),i())},$Ft=t=>{{const e=iP(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&QY(e,!1),r}},L2=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){sP(i)}},Tce=(t,e)=>t&&t.then?t.then(e):e(),P0t=(t,e)=>iP(t).$instanceValues$.get(e),M0t=(t,e,r,i)=>{const s=iP(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=g0t(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const d=i.$watchers$[e];d&&d.map(f=>{try{l[f](r,o,e)}catch(m){sP(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;QY(s,!1)}}}},I0t=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),s=t.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return P0t(this,n)},set(a){M0t(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Go.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},$0t=async(t,e,r,i,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=m0t(t)]);const a=i3e(r,e.$modeName$);if(!I4.has(a)){const l=hw("registerStyles",r.$tagName$);v0t(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>QY(e,!0))()},L0t=t=>{},D0t=t=>{if(!(Go.$flags$&1)){const e=iP(t),r=e.$cmpMeta$,i=hw("connectedCallback",r.$tagName$);e.$flags$&1?(h3e(t,e,r.$listeners$),L0t(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&N0t(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),$0t(t,e,r)),i()}},N0t=t=>{const e=t["s-cr"]=Kd.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},F0t=t=>{if(!(Go.$flags$&1)){const e=iP(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},LFt=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){k0t(this,r)},connectedCallback(){D0t(this),i&&i.call(this)},disconnectedCallback(){F0t(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,I0t(t,r)},DFt=(t,e)=>e,h3e=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=V0t(t,s),l=U0t(e,o),c=z0t(s);Go.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Go.rel(a,n,l,c))})},U0t=(t,e)=>r=>{try{xT.lazyLoad||t.$hostElement$[e](r)}catch(i){sP(i)}},V0t=(t,e)=>e&4?Kd:e&8?nP:e&16?Kd.body:t,z0t=t=>G0t?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,d3e=new WeakMap,iP=t=>d3e.get(t),k0t=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return h3e(t,r,e.$listeners$),d3e.set(t,r)},Sce=(t,e)=>e in t,sP=(t,e)=>(0,console.error)(t,e),I4=new Map,B0t=[],nP=typeof window<"u"?window:{},Kd=nP.document||{head:{}},NFt=nP.HTMLElement||class{},Go={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},G0t=(()=>{let t=!1;try{Kd.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),j0t=t=>Promise.resolve(t),H0t=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Ece=[],p3e=[],q0t=(t,e)=>r=>{t.push(r),tj||(tj=!0,e&&Go.$flags$&4?W0t(rj):Go.raf(rj))},Cce=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){sP(r)}t.length=0},rj=()=>{Cce(Ece),Cce(p3e),(tj=Ece.length>0)&&Go.raf(rj)},W0t=t=>j0t().then(t),Z0t=q0t(p3e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */const f3e="calcite-mode-auto",m3e="calcite-mode-dark",X0t="calcite-mode-light",FFt={autoMode:f3e,darkMode:m3e,lightMode:X0t,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var g3e=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],$4=g3e.join(","),y3e=typeof Element>"u",dw=y3e?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,L4=!y3e&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},D4=function t(e,r){var i;r===void 0&&(r=!0);var s=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),n=s===""||s==="true",o=n||r&&e&&t(e.parentNode);return o},Y0t=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},_3e=function(e,r,i){if(D4(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll($4));return r&&dw.call(e,$4)&&s.unshift(e),s=s.filter(i),s},v3e=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!D4(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=dw.call(o,$4);h&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var d=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!D4(d,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(d&&f){var m=t(d===!0?o.children:d.children,!0,i);i.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},b3e=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Y0t(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},J0t=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},w3e=function(e){return e.tagName==="INPUT"},Q0t=function(e){return w3e(e)&&e.type==="hidden"},K0t=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},e_t=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},t_t=function(e){if(!e.name)return!0;var r=e.form||L4(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=e_t(s,e.form);return!n||n===e},r_t=function(e){return w3e(e)&&e.type==="radio"},i_t=function(e){return r_t(e)&&!t_t(e)},s_t=function(e){var r,i=e&&L4(e),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,d;i=L4(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(d=h.ownerDocument)!==null&&d!==void 0&&d.contains(s))}}return n},Ace=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},n_t=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=dw.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(dw.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=L4(e);if(l&&!l.shadowRoot&&s(l)===!0)return Ace(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(s_t(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return Ace(e);return!1},o_t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return dw.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},N4=function(e,r){return!(r.disabled||D4(r)||Q0t(r)||n_t(r,e)||K0t(r)||o_t(r))},ij=function(e,r){return!(i_t(r)||b3e(r)<0||!N4(e,r))},a_t=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},l_t=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=b3e(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(J0t).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},c_t=function(e,r){r=r||{};var i;return r.getShadowRoot?i=v3e([e],r.includeContainer,{filter:ij.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:a_t}):i=_3e(e,r.includeContainer,ij.bind(null,r)),l_t(i)},UFt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=v3e([e],r.includeContainer,{filter:N4.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=_3e(e,r.includeContainer,N4.bind(null,r)),i},VFt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return dw.call(e,$4)===!1?!1:ij(r,e)},u_t=g3e.concat("iframe").join(","),zFt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return dw.call(e,u_t)===!1?!1:N4(r,e)};const h_t={getShadowRoot:!0};function kFt(t){const e="dir",r=`[${e}]`,i=d_t(t,r);return i?i.getAttribute(e):"ltr"}function KY(t){return t.getRootNode()}function BFt(t){const e=KY(t);return"host"in e?e:null}function x3e(t){return t.host||null}function GFt(t,{selector:e,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=KY(s),o=r?"getElementById"in n?n.getElementById(r):null:e?n.querySelector(e):null,a=x3e(n);return o||(a?i(a):null)}return i(t)}function d_t(t,e){function r(i){return i?i.closest(e)||r(x3e(KY(i))):null}return r(t)}function p_t(t,e){return T3e(t,e)}function T3e(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return T3e(i instanceof ShadowRoot?i.host:i,e)}function jFt(t,e){return!!p_t(e,r=>r===t?!0:void 0)}function f_t(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function HFt(t){if(t)return f_t(t)?t.setFocus():t.focus()}function qFt(t){t&&(c_t(t,h_t)[0]||t).focus()}const oR=":not([slot])";function WFt(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:oR;return r!=null&&r.all?m_t(t,i,r):g_t(t,i,r)}function S3e(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function m_t(t,e,r){let i=e===oR?S3e(t,oR):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===t),i=r!=null&&r.matches?i.filter(n=>n==null?void 0:n.matches(r.matches)):i;const s=r==null?void 0:r.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function g_t(t,e,r){let i=e===oR?S3e(t,oR)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const s=r==null?void 0:r.selector;return s?i==null?void 0:i.querySelector(s):i}function ZFt(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function XFt(t){return(!!t).toString()}function YFt(t){return!!y_t(t).length}function y_t(t){return t.target.assignedElements({flatten:!0})}function JFt(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */function Oce(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(m3e)||t.contains(f3e)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function __t(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?Oce():document.addEventListener("DOMContentLoaded",()=>Oce(),{once:!0}))}const v_t=__t;v_t();let E3e;function b_t(){try{n0t(".")}catch{o0t(Jc(Br(E3e)))}}function QFt(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return Promise.all(e)}E3e="components/assets";const C3e=Symbol("widget"),w_t=Symbol("widget-test-data"),x_t=[],T_t={},F4=new WeakMap;function A3e(t,e){let r=e.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=A3e(t,r[s]);else r=x_t;const i=e.vnodeSelector;if(eJ(i)){const s=e.properties||T_t,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:S_t,afterUpdate:E_t,afterRemoved:O3e,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function S_t(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,F4.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i._internalHandles.add(ja(()=>O3e(t)))}function E_t(t,e,r,{widgetProperties:i}){var n;const s=F4.get(t);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,t))}function O3e(t){var r;const e=F4.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),F4.delete(t))}function eJ(t){return typeof t=="function"&&t[C3e]}const Rce=new Set;function C_t(t){Rce.add(t),t.finally(()=>Rce.delete(t))}var R3e;const A_t="esri.widgets.Widget";let O_t=0;const R_t={widgetIcon:"esri-icon-checkbox-unchecked"};function P3e(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?P3e(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const P_t=s0t({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e==null?void 0:e(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),h=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,h,l);const d=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),d()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(c0e(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let Q9=!1,Ln=class extends t5(Ls.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new Mi,this._projector=P_t,this._readyForTrueRender=!1,this.iconClass=R_t.widgetIcon,this.icon=null,this.key=this,this._loadLocale=GH(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await Zf(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{if(this.destroyed)return;let c=await Qde(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=P3e(K(c),this.uiStrings)),this[l]=c}));if(this.destroyed)return;for(const a of o)a.error&&Q.getLogger(this).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),b_t();const i="esri-widget-uid-"+u6(),s=this.render.bind(this);this._trackingTarget=new Q4(()=>this.scheduleRender());const n=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;const o=s();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;l||(a.key=i),this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return(h=o.children)==null||h.forEach(d=>{if(eJ(d.vnodeSelector))return;let{properties:f}=d;f||(d.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),A3e(this,o)};this.render=()=>{if(Q9)return n();let o=t9e(this)??null;if(o)return o;this._trackingTarget.clear(),Q9=!0;try{o=Rg(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{Q9=!1}return o&&r9e(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),C_t(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(jJ)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Pe(this._trackingTarget),Pe(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,uU(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return P5(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+O_t++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(R3e=C3e,w_t)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(uU(this),this._projector.scheduleRender())}classes(...e){return a9e.apply(this,e)}renderNow(){uU(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this._internalHandles.add(ue(()=>this.viewModel,(i,s)=>{s&&this._internalHandles.remove("delegated-events"),i&&Y4(i)&&this._internalHandles.add(this._delegatedEventNames.map(n=>pR(i,n,o=>{this.emit(n,o)})),"delegated-events")},zr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(jJ),this.scheduleRender()};this._internalHandles.add([Yde(e),ue(()=>this.uiStrings,e),xh(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};Ln[R3e]=!0,u([p()],Ln.prototype,"_readyForTrueRender",void 0),u([p({value:null})],Ln.prototype,"container",null),u([yr("container")],Ln.prototype,"castContainer",null),u([p()],Ln.prototype,"iconClass",void 0),u([p()],Ln.prototype,"icon",void 0),u([p()],Ln.prototype,"id",null),u([p()],Ln.prototype,"label",null),u([p()],Ln.prototype,"renderable",null),u([p()],Ln.prototype,"uiStrings",void 0),u([p()],Ln.prototype,"viewModel",void 0),u([p({value:!0})],Ln.prototype,"visible",null),u([p()],Ln.prototype,"key",void 0),u([p()],Ln.prototype,"children",void 0),u([p()],Ln.prototype,"afterCreate",void 0),u([p()],Ln.prototype,"afterUpdate",void 0),u([p()],Ln.prototype,"afterRemoved",void 0),Ln=u([R(A_t)],Ln);const oP=Ln;function Pce(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function M_t(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function JI(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function I_t(t){return t.type==="bing-maps"}const ky=[];let ET=class extends xO{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Mt,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>ue(()=>{var s;return[i.suspended,(s=i.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),e&&e.removed&&e.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([Ga(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),xh(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t==null?void 0:t.allLayerViews;ky.length=0,t&&e?(e.forEach(r=>{var n;if(r.suspended||!((n=r.layer)!=null&&n.attributionVisible))return;const i=r.layer;if(Pce(i,"user"))return void JI(ky,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const o=this._fetchedAttributionData.get(r);return void(o?JI(ky,r,this._getDynamicAttribution(o,t,i)):Pce(i)&&JI(ky,r,i.copyright))}return void this._fetchAttributionData(r)}const s=i.get("portalItem.accessInformation");JI(ky,r,s||i.copyright)}),M_t(this.items,ky)&&(this.items.removeAll(),this.items.addMany(ky)),ky.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await uu(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const r=e.ok?this._createContributionIndex(e.value,I_t(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)}this._updateAttributionItems()}_createContributionIndex(t,e){const r=t.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),h=a.zoomMax-(e&&a.zoomMax?1:0),d=new _r({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ge.WGS84}),f={extent:uA(d),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)i[m]??(i[m]=[]),i[m].push(f)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(t,e,r){var c;const{extent:i,scale:s}=e;let n=((c=r.tileInfo)==null?void 0:c.scaleToZoom(s))??0;if(n=Math.min(t.maxKey??0,Math.round(n)),!i||n==null||n<=-1)return"";const o=t[n],a=mw(i.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(h=>{const d=h.id,f=!l.has(d)&&a&&h.extent&&vq(h.extent,a);return f&&l.add(d),f}).sort((h,d)=>d.score-h.score||h.objectId-d.objectId).map(h=>h.attribution).join(", "):""}};u([p({readOnly:!0,type:Mt})],ET.prototype,"items",void 0),u([p({readOnly:!0})],ET.prototype,"state",null),u([p()],ET.prototype,"view",void 0),ET=u([R("esri.widgets.Attribution.AttributionViewModel")],ET);const M3e=ET;function d6(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:L_t(t[e])}}}function $_t(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function L_t(t){return function(e,...r){$_t(e)?d9e(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function p6(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var D_t=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},I3e=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?I3e(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=D_t(s)),e.push(s))}},N_t=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return I3e(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function za(t,e,...r){return typeof t!="function"||eJ(t)?N_t(t,e,...r):t(e,...r)}const kx="esri-attribution",By={base:`${kx} esri-widget`,poweredBy:`${kx}__powered-by`,sources:`${kx}__sources`,open:`${kx}--open`,sourcesOpen:`${kx}__sources--open`,link:`${kx}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Oa=class extends oP{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=By.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new M3e}initialize(){this.addHandles(Ga(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[By.open]:this._isOpen};return za("div",{bind:this,class:this.classes(By.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return za("div",{class:By.poweredBy},"Powered by"," ",za("a",{class:By.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:s}=this,n={[By.sourcesOpen]:e,[By.interactive]:r};return za("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(By.sources,n),innerHTML:s,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([p()],Oa.prototype,"_isOpen",void 0),u([p()],Oa.prototype,"_isInteractive",null),u([p()],Oa.prototype,"_attributionTextOverflowed",void 0),u([p()],Oa.prototype,"_prevSourceNodeHeight",void 0),u([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Oa.prototype,"attributionText",null),u([p()],Oa.prototype,"iconClass",void 0),u([p()],Oa.prototype,"icon",void 0),u([p()],Oa.prototype,"itemDelimiter",void 0),u([p()],Oa.prototype,"label",null),u([p(),p6("esri/widgets/Attribution/t9n/Attribution")],Oa.prototype,"messages",void 0),u([p()],Oa.prototype,"view",null),u([p({type:M3e})],Oa.prototype,"viewModel",void 0),u([d6()],Oa.prototype,"_toggleState",null),Oa=u([R("esri.widgets.Attribution")],Oa);const F_t=Oa,U_t=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return B4(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([p()],e.prototype,"goToOverride",void 0),u([p()],e.prototype,"view",void 0),e=u([R("esri.widgets.support.GoTo")],e),e},V_t="esri.widgets.CompassViewModel";let x1=class extends U_t(xe){constructor(e){super(e),this._handles=new Mi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ue(()=>this.view,this._updateRotationWatcher,zr))}destroy(){Di(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var r;if(!this.get("view.ready"))return;const e={};((r=this.view)==null?void 0:r.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ue(()=>e==null?void 0:e.rotation,this._updateForRotation,zr):ue(()=>e==null?void 0:e.camera,this._updateForCamera,zr))}};u([p({readOnly:!0})],x1.prototype,"canShowNorth",null),u([p()],x1.prototype,"orientation",void 0),u([p({readOnly:!0})],x1.prototype,"state",null),u([p()],x1.prototype,"view",void 0),x1=u([R(V_t)],x1);const $3e=x1,Gy={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let pd=class extends oP{constructor(e,r){super(e,r),this.iconClass=Gy.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new $3e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",s=(r==="rotation"?"rotation":"compass")=="compass",n=i?-1:0,o={[Gy.disabled]:i,[Gy.interactive]:!i},a={[Gy.northIcon]:s,[Gy.rotationIcon]:!s},{messages:l}=this;return za("div",{bind:this,class:this.classes(Gy.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},za("span",{"aria-hidden":"true",class:this.classes(Gy.icon,a),styles:this._toRotationTransform(e)}),za("span",{class:Gy.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([p()],pd.prototype,"goToOverride",null),u([p()],pd.prototype,"iconClass",void 0),u([p()],pd.prototype,"icon",void 0),u([p()],pd.prototype,"label",null),u([p(),p6("esri/widgets/Compass/t9n/Compass")],pd.prototype,"messages",void 0),u([p()],pd.prototype,"view",null),u([p({type:$3e})],pd.prototype,"viewModel",void 0),u([d6()],pd.prototype,"_reset",null),pd=u([R("esri.widgets.Compass")],pd);const z_t=pd,Bx="esri-navigation-toggle",Ou={base:`${Bx} esri-widget`,button:`${Bx}__button esri-widget--button`,activeButton:`${Bx}__button--active`,panButton:`${Bx}__button--pan`,rotateButton:`${Bx}__button--rotate`,isLayoutHorizontal:`${Bx}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let CT=class extends xe{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(xh(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([p({readOnly:!0})],CT.prototype,"state",null),u([p()],CT.prototype,"navigationMode",void 0),u([p()],CT.prototype,"view",void 0),CT=u([R("esri.widgets.NavigationToggleViewModel")],CT);const L3e=CT;let fd=class extends oP{constructor(e,r){super(e,r),this.iconClass=Ou.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new L3e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[Ou.disabled]:e,[Ou.isLayoutHorizontal]:this.layout==="horizontal"},s={[Ou.activeButton]:r},n={[Ou.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return za("div",{bind:this,class:this.classes(Ou.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},za("div",{class:this.classes(Ou.button,Ou.panButton,s)},za("span",{class:Ou.panIcon})),za("div",{class:this.classes(Ou.button,Ou.rotateButton,n)},za("span",{class:Ou.rotationIcon})))}_toggle(){this.toggle()}};u([p()],fd.prototype,"iconClass",void 0),u([p()],fd.prototype,"icon",void 0),u([p()],fd.prototype,"label",null),u([p({value:"vertical"})],fd.prototype,"layout",null),u([p(),p6("esri/widgets/NavigationToggle/t9n/NavigationToggle")],fd.prototype,"messages",void 0),u([p()],fd.prototype,"view",null),u([p({type:L3e})],fd.prototype,"viewModel",void 0),u([d6()],fd.prototype,"_toggle",null),fd=u([R("esri.widgets.NavigationToggle")],fd);const k_t=fd,wC={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let km=class extends oP{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,r={[wC.disabled]:!this.enabled,[wC.interactive]:this.enabled};return za("div",{bind:this,class:this.classes(wC.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},za("span",{"aria-hidden":"true",role:"presentation",class:this.classes(wC.icon,this.iconClass??"")}),za("span",{class:wC.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([p()],km.prototype,"action",void 0),u([p()],km.prototype,"enabled",void 0),u([p()],km.prototype,"iconClass",void 0),u([p()],km.prototype,"icon",void 0),u([p()],km.prototype,"title",void 0),u([d6()],km.prototype,"_triggerAction",null),km=u([R("esri.widgets.IconButton")],km);const Mce=km;let AT=class extends xe{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};u([p({readOnly:!0})],AT.prototype,"canZoomIn",null),u([p({readOnly:!0})],AT.prototype,"canZoomOut",null),u([p()],AT.prototype,"view",void 0),AT=u([R("esri.widgets.Zoom.ZoomConditions2D")],AT);const B_t=AT;let OT=class extends xe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([p({readOnly:!0})],OT.prototype,"canZoomIn",null),u([p({readOnly:!0})],OT.prototype,"canZoomOut",null),u([p()],OT.prototype,"view",void 0),OT=u([R("esri.widgets.Zoom.ZoomConditions3D")],OT);const G_t=OT;let m0=class extends xe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new B_t({view:e}):e.type==="3d"&&(this._zoomConditions=new G_t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():CV(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():CV(e.goTo({zoomFactor:.5}))}};u([p()],m0.prototype,"_zoomConditions",void 0),u([p()],m0.prototype,"canZoomIn",null),u([p()],m0.prototype,"canZoomOut",null),u([p({readOnly:!0})],m0.prototype,"state",null),u([p()],m0.prototype,"view",null),m0=u([R("esri.widgets.Zoom.ZoomViewModel")],m0);const D3e=m0,xC={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let tf=class extends oP{constructor(e,r){super(e,r),this.iconClass=xC.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new D3e}initialize(){this._zoomInButton=new Mce({action:this.zoomIn.bind(this),iconClass:xC.zoomInIcon}),this._zoomOutButton=new Mce({action:this.zoomOut.bind(this),iconClass:xC.zoomOutIcon})}destroy(){this._zoomInButton=Pe(this._zoomInButton),this._zoomOutButton=Pe(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[xC.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:s}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=s;const{zoomIn:n,zoomOut:o}=this.messages;return this._zoomInButton.title=n,this._zoomOutButton.title=o,za("div",{class:this.classes(xC.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([p()],tf.prototype,"iconClass",void 0),u([p()],tf.prototype,"icon",void 0),u([p()],tf.prototype,"label",null),u([p({value:"vertical"})],tf.prototype,"layout",null),u([p(),p6("esri/widgets/Zoom/t9n/Zoom")],tf.prototype,"messages",void 0),u([p()],tf.prototype,"view",null),u([p({type:D3e})],tf.prototype,"viewModel",void 0),tf=u([R("esri.widgets.Zoom")],tf);const j_t=tf;function H_t(t){return(t==null?void 0:t.view)!==void 0}let HL=class extends Jyt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const s=this._find(i),n=s==null?void 0:s.widget;H_t(n)&&(n.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([ue(()=>this.components,this._componentsWatcher,zr),ue(()=>this.view,this._updateViewAwareWidgets,zr)])}_add(e,r,i,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,s,n)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new jL({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new F_t({view:r});case"compass":return new z_t({view:r});case"navigation-toggle":return new k_t({view:r});case"zoom":return new j_t({view:r})}}};u([p()],HL.prototype,"components",void 0),HL=u([R("esri.views.ui.DefaultUI")],HL);const N3e=HL;let qL=class extends N3e{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([p()],qL.prototype,"components",void 0),qL=u([R("esri.views.ui.3d.DefaultUI3D")],qL);const F3e=qL;let Ze=class extends l8e(tVe(A9e(VVe))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Ug({slicePlane:Dye},this),this._resourceController=Olt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new B7({view:this}),this.labeler=new f1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new oS,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new H1,this.environmentManager=new od,this.floors=new Mt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new BVe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new jat,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new F3e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new vG,this.voxelWasm=null,this.voxelWasmPromise=null,WFe(),t&&t.environment||(this._defaults.environment=new lT,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===ii.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([Ga(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ue(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new XWe({view:this}),this.stateManager=new dn({view:this})}initialize(){this.groundView=new B9e({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Ga(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},zr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},zr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>NRe(e>0?1e3/Math.ceil(e):0),zr),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,As),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),As),this.addHandles(ue(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),jr))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Pe(this.sharedSymbolResources),this._set("labeler",Pe(this.labeler)),this._set("deconflictor",Pe(this.deconflictor)),this._resourceController=Pe(this._resourceController),this._set("stateManager",Pe(this.stateManager)),this._set("inputManager",Pe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Pe(this.environmentManager)),this.groundView=Pe(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof _r?this.spatialReference&&(t=QI(t,this.spatialReference),t==null)?(Q.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(Q.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?Q.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Le.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:QI(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Ge.WGS84,r=QI(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||Ge.WGS84;let e;const r=n=>{const o=QI(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const n=i.groundExtent;r(new _r({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof lT?t:t instanceof Y0e?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):lT.fromWebsceneEnvironment(t):qs(lT,t):new lT}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){ML.isValidProfile(t)&&(ML.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||ML.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");Cw(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?s8e(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?Tw.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||JO(a))return;++r,t+=a.updatingProgress}}else++r});for(const a of this._updatingObjects)a!=null&&a.updating&&(r+=.1,t+=.5*.1);for(const a of this._updatingObjectsWithProgress)a!=null&&a.updating&&(++r,t+=a.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.updating||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(t!=null)return fU(t);const e=this.spatialReference;return e?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?fU(this.defaultsFromMap.viewingMode):O7(e,Le.Global)?"global":"local":"global"}set viewingMode(t){this.ready?Q.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new ect(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return Q.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),s=See(t)?Tee(this,t):t,n=hf(s);r.enableDraped=r.include&&!r.include.has(N0)||r.exclude&&r.exclude.has(N0);const o=this.sceneIntersectionHelper,a=Oh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?go.ALL:go.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=ej(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return Q.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?yf(this.elevationProvider,t):null)??0;return vo(t,Gx,this.renderSpatialReference,e),this.state.camera.projectToScreen(Gx,K9),wh(K9[0],K9[1])}pixelSizeAt(t){return this.ready?t?(vo(t,Gx,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Gx)):0:(Q.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return Q.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=See(t)?Tee(this,t):t,i=Yi(r.x,r.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Oh(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=go.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=uce(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:hp(a)?a.distanceInRenderSpace:0,layer:c}};return oi.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:r}=await Myt(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new U("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return H9(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return q9(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[q9(r[0],this._pixelFormat()),q9(r[1],this._pixelFormat())]}_completeSettings(t){const e=uyt(t,this);return e.pixelRatio/=this.state.pixelRatio,fyt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!oe("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=H9(r[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[i,H9(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return Iee.importLayerView(t)}hasLayerViewModule(t){return Iee.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=kyt(this.type);const e=oe("safari");if(e&&e<9&&(t=new U("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw Q.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?Ree(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,Le.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Le.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,Le.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Le.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!O7(t,r)&&(e==null||!!AQ(e)||(!pA(e)||t6(e,t,r)!=null)&&(!CQ(e)||r!==Le.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,s=t.isWGS84;return AQ(e)&&(i||s)?!s||r===Le.Local||EY(e.tileInfo,e.fullExtent,t,Le.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:Ge.WebMercator,viewingMode:r}]:[{spatialReference:i?Ge.WGS84:Ge.WebMercator,viewingMode:r}]:pA(e)||CQ(e)||!i&&!s?pA(e)&&i&&r!==Le.Global?[{spatialReference:t,viewingMode:r},{spatialReference:Ge.WGS84,viewingMode:Le.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?Ge.WGS84:Ge.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?Q.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${fU(r)} viewing mode.`):t.isGeographic&&Q.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||Ge.WGS84;return js(t,this.renderSpatialReference,t,r)||(r=Ge.WGS84,js(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new ct(t,r),e}trackGraphicState(t){if(!t.graphic)return Q.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const s=n=>{var o;!i&&n!=null&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return V2(t.map(r=>this.highlight(r)));if(Mt.isCollection(t))return V2(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):ja()}maskOccludee(t){if(!t)return Q.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const s=n=>{!i&&n!=null&&$yt(n)&&(r=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await K2(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new U("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,QA.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,QA.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(Gx)?(e=this.computeMapPointFromVec3d(Gx,e),t.intersector===Gi.TERRAIN&&this.basemapTerrain&&(e.z=yf(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let s=0;s<t.length;s++){const n=t[s],o=uce(n,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=ej(n,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&s!==t.length-1&&(i=new Set),i!=null){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var s;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const n=i.objectIdField??o8e,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof hu)q_t(r,this._getGraphicFilterUid(t)),e===QA.INCLUDE&&(this.graphicsView!=null&&t.layer===this?TC(r,this.graphicsView.processor.layer.id):t.layer&&TC(r,t.layer.uid));else if(bV(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?TC(r,this.graphicsView.processor.layer.id):i===this.map.ground?TC(r,N0):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&TC(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new Cdt({view:this})),this._set("elevationProvider",new I3({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new pl({view:this})),this._set("featureTiles",new oo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Sw(h5(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>oi.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ae(()=>import("./FeatureTileTree3DDebugger-dd25fa05.js"),["assets/FeatureTileTree3DDebugger-dd25fa05.js","assets/TileTreeDebugger-2e4c7d48.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&oi.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||oi.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},As),this.updatingHandles.add(()=>this.clippingArea,t,As),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,As)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new ult(this.map,t));const e=this.state.isGlobal,r=i8e(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",flt.create(this.state.viewingMode,r)),e||this.addHandles(ue(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const s=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!AR(i,this.basemapTerrain.spatialReference,Ice,s)||(this.renderCoordsHelper.extent=Ice)},jr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(gS/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===ii.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(ue(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),jr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new Hat(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const r=P5(this.surface);this._stage=new Fc({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),zr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),zr),ue(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,As),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()}),pR(this._stage.renderView.canvas,"webglcontextlost",s=>this.fatalError=new U("webgl-context-lost",s.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:vG.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(gS/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Pe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new ict({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ae(()=>import("./GraphicsView3D-06b93969.js"),["assets/GraphicsView3D-06b93969.js","assets/GraphicsProcessor-9f742212.js","assets/Graphics3DObjectStates-ff930589.js","assets/optimizedFeatureQueryEngineAdapter-cbd41ac3.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-adb57b31.js","assets/quickselect-d68fa842.js"])).default;Qt(t),await K2(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=Ree(this.viewingMode);if(t===Le.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Ga(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(N0);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(N0);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=ae(()=>import("./VoxelWasmPerSceneView-23c2b99b.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function TC(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function q_t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function QI(t,e){return t!=null&&Uf(t.spatialReference,e)?Sw(t,e):null}var QA;Ze.type="3d",u([p()],Ze.prototype,"_userClippingArea",void 0),u([p()],Ze.prototype,"_resourceController",void 0),u([p()],Ze.prototype,"_stage",void 0),u([p({readOnly:!0})],Ze.prototype,"deconflictor",void 0),u([p({readOnly:!0})],Ze.prototype,"labeler",void 0),u([p(tN(oS,"analyses"))],Ze.prototype,"analyses",void 0),u([p({type:uS,readOnly:!0})],Ze.prototype,"animation",null),u([p({readOnly:!0})],Ze.prototype,"basemapTerrain",void 0),u([p({readOnly:!0})],Ze.prototype,"elevationProvider",void 0),u([p()],Ze.prototype,"camera",null),u([p({type:vh})],Ze.prototype,"contentCamera",null),u([p({readOnly:!0})],Ze.prototype,"canvas",void 0),u([p({type:ct})],Ze.prototype,"center",null),u([p({type:_r})],Ze.prototype,"clippingArea",null),u([p({type:H1})],Ze.prototype,"constraints",void 0),u([p({type:_r,readOnly:!0})],Ze.prototype,"renderDataExtent",null),u([p({type:_r,readOnly:!0})],Ze.prototype,"dataExtent",null),u([p({type:_r,readOnly:!0})],Ze.prototype,"_groundAndLayersExtent",null),u([p({value:null,type:lT})],Ze.prototype,"environment",null),u([yr("environment")],Ze.prototype,"castEnvironment",null),u([p({readOnly:!0})],Ze.prototype,"environmentManager",void 0),u([p({type:_r})],Ze.prototype,"extent",null),u([p()],Ze.prototype,"floors",void 0),u([p()],Ze.prototype,"screenCenter",null),u([p()],Ze.prototype,"frustum",null),u([p({type:Number,readOnly:!0})],Ze.prototype,"fullOpacity",void 0),u([p({readOnly:!0})],Ze.prototype,"graphicsView",void 0),u([p({readOnly:!0})],Ze.prototype,"analysisViewManager",void 0),u([p()],Ze.prototype,"groundView",void 0),u([p({type:Boolean})],Ze.prototype,"initialExtentRequired",null),u([p()],Ze.prototype,"_defaultsFromMapSettings",null),u([p()],Ze.prototype,"interacting",null),u([p()],Ze.prototype,"stationary",null),u([p()],Ze.prototype,"navigating",null),u([p()],Ze.prototype,"map",void 0),u([p({readOnly:!0})],Ze.prototype,"mapCoordsHelper",void 0),u([p()],Ze.prototype,"padding",null),u([p({type:pl,readOnly:!0})],Ze.prototype,"pointsOfInterest",void 0),u([p({type:oo,readOnly:!0})],Ze.prototype,"featureTiles",void 0),u([p()],Ze.prototype,"_featureTreeDebugger",void 0),u([p({type:Boolean})],Ze.prototype,"screenSizePerspectiveEnabled",void 0),u([p({constructOnly:!0})],Ze.prototype,"deactivatedWebGLExtensions",void 0),u([p({constructOnly:!0})],Ze.prototype,"debugWebGLExtensions",void 0),u([p({constructOnly:!0})],Ze.prototype,"renderCanvas",void 0),u([p({constructOnly:!0})],Ze.prototype,"state",void 0),u([p({readOnly:!0})],Ze.prototype,"inputManager",void 0),u([p({readOnly:!0})],Ze.prototype,"stateManager",void 0),u([p({type:["low","medium","high"]})],Ze.prototype,"qualityProfile",null),u([p({type:eoe,get(){let t=this._get("qualitySettings");return t||(t=new eoe,ML.apply(this.qualityProfile,t)),t}})],Ze.prototype,"qualitySettings",void 0),u([p()],Ze.prototype,"slicePlane",null),u([p({readOnly:!0})],Ze.prototype,"typeSpecificPreconditionsReady",null),u([p({readOnly:!0})],Ze.prototype,"renderCoordsHelper",void 0),u([p({readOnly:!0})],Ze.prototype,"sceneIntersectionHelper",void 0),u([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ze.prototype,"resolution",null),u([p({type:Number})],Ze.prototype,"scale",null),u([p()],Ze.prototype,"heightModelInfo",null),u([p()],Ze.prototype,"spatialReference",void 0),u([p({type:Boolean,constructOnly:!0})],Ze.prototype,"alphaCompositingEnabled",void 0),u([p({constructOnly:!0})],Ze.prototype,"preserveDrawingBufferEnabled",void 0),u([p({type:Boolean})],Ze.prototype,"supersampleScreenshotsEnabled",void 0),u([p({readOnly:!0})],Ze.prototype,"type",void 0),u([p(),yr(t=>t instanceof N3e?t:$b(F3e,t))],Ze.prototype,"ui",void 0),u([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],Ze.prototype,"updating",null),u([p()],Ze.prototype,"_updatingObjects",null),u([p()],Ze.prototype,"_updatingObjectsWithProgress",null),u([p({type:Number,readOnly:!0,dependsOn:["updating"]})],Ze.prototype,"updatingProgress",void 0),u([p({type:["global","local"]})],Ze.prototype,"viewingMode",null),u([p({type:sp})],Ze.prototype,"viewpoint",null),u([p({type:Number})],Ze.prototype,"zoom",null),u([p({type:vG})],Ze.prototype,"highlightOptions",void 0),Ze=u([R("esri.views.SceneView")],Ze),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(QA||(QA={}));const Gx=A(),K9=Yi(),Ice=kt(),W_t=Ze;var sj;let j3=sj=class extends de{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new sj({minValue:this.minValue,maxValue:this.maxValue})}};u([p({type:Number,json:{write:!0}})],j3.prototype,"minValue",void 0),u([p({type:Number,json:{write:!0}})],j3.prototype,"maxValue",void 0),j3=sj=u([R("esri.renderer.support.AuthoringInfoClassBreakInfo")],j3);var nj;let I0=nj=class extends de{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new nj({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:K(this.classBreakInfos)})}};u([p({type:String,json:{write:!0}})],I0.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],I0.prototype,"normalizationField",void 0),u([p({type:String,json:{write:!0}})],I0.prototype,"label",void 0),u([p({type:[j3],json:{write:!0}})],I0.prototype,"classBreakInfos",void 0),I0=nj=u([R("esri.renderers.support.AuthoringInfoFieldInfo")],I0);var oj;const KI=new Rr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),e$=new Rr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),$ce={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Lce=["high-to-low","above-and-below","centered-on","extremes"],Dce=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Nce=["seconds","minutes","hours","days","months","years"];let Gl=oj=class extends de{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new oj({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([p({types:$ce,json:{write:!0}})],Gl.prototype,"endTime",void 0),u([yr("endTime")],Gl.prototype,"castEndTime",null),u([p({type:String,json:{write:!0}})],Gl.prototype,"field",void 0),u([p({type:Number,json:{write:!0}})],Gl.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0}})],Gl.prototype,"minSliderValue",void 0),u([p({types:$ce,json:{write:!0}})],Gl.prototype,"startTime",void 0),u([yr("startTime")],Gl.prototype,"castStartTime",null),u([p({type:KI.apiValues,value:null,json:{type:KI.jsonValues,read:KI.read,write:KI.write}})],Gl.prototype,"style",null),u([p({type:Dce,value:null,json:{type:Dce,origins:{"web-scene":{type:Lce,write:{writer:(t,e)=>{Lce.includes(t)&&(e.theme=t)}}}},write:!0}})],Gl.prototype,"theme",null),u([p({type:e$.apiValues,json:{type:e$.jsonValues,read:e$.read,write:e$.write}})],Gl.prototype,"type",void 0),u([p({type:Nce,json:{type:Nce,write:!0}})],Gl.prototype,"units",void 0),Gl=oj=u([R("esri.renderers.support.AuthoringInfoVisualVariable")],Gl);const Z_t=Gl;let WL=class extends de{constructor(e){super(e),this.type=null}};u([p({readOnly:!0,json:{read:!1,write:!0}})],WL.prototype,"type",void 0),WL=u([R("esri.rest.support.ColorRamp")],WL);const tJ=WL;var aj;let T1=aj=class extends tJ{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new aj({fromColor:K(this.fromColor),toColor:K(this.toColor),algorithm:this.algorithm})}};u([et({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],T1.prototype,"algorithm",void 0),u([p({type:ke,json:{type:[Ji],write:!0}})],T1.prototype,"fromColor",void 0),u([p({type:ke,json:{type:[Ji],write:!0}})],T1.prototype,"toColor",void 0),u([p({type:["algorithmic"]})],T1.prototype,"type",void 0),T1=aj=u([R("esri.rest.support.AlgorithmicColorRamp")],T1);const rJ=T1;var lj;let H3=lj=class extends tJ{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new lj({colorRamps:K(this.colorRamps)})}};u([p({type:[rJ],json:{write:!0}})],H3.prototype,"colorRamps",void 0),u([p({type:["multipart"]})],H3.prototype,"type",void 0),H3=lj=u([R("esri.rest.support.MultipartColorRamp")],H3);const U3e=H3,X_t={key:"type",base:tJ,typeMap:{algorithmic:rJ,multipart:U3e}};function Y_t(t){return t&&t.type?t.type==="algorithmic"?rJ.fromJSON(t):t.type==="multipart"?U3e.fromJSON(t):null:null}var cj;const Nv=new Rr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),t$=new Rr({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Fce=new Rr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Uce=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],J_t=["high-to-low","above-and-below","above","below","90-10"],Q_t=["flow-line","wave-front"],K_t=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let ks=cj=class extends de{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?Y_t(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new cj({classificationMethod:this.classificationMethod,colorRamp:K(this.colorRamp),fadeRatio:K(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:K(this.field1),field2:K(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([p({type:Nv.apiValues,value:null,json:{type:Nv.jsonValues,read:Nv.read,write:Nv.write,origins:{"web-document":{default:"manual",type:Nv.jsonValues,read:Nv.read,write:Nv.write}}}})],ks.prototype,"classificationMethod",null),u([p({types:X_t,json:{write:!0}})],ks.prototype,"colorRamp",void 0),u([Se("colorRamp")],ks.prototype,"readColorRamp",null),u([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ks.prototype,"fadeRatio",void 0),u([p({type:[String],value:null,json:{write:!0}})],ks.prototype,"fields",null),u([p({type:I0,value:null,json:{write:!0}})],ks.prototype,"field1",null),u([p({type:I0,value:null,json:{write:!0}})],ks.prototype,"field2",null),u([p({type:Q_t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],ks.prototype,"flowTheme",null),u([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],ks.prototype,"focus",null),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],ks.prototype,"isAutoGenerated",void 0),u([p({type:Number,value:null,json:{type:Ji,write:!0}})],ks.prototype,"numClasses",null),u([p({type:Uce,json:{type:Uce,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],ks.prototype,"lengthUnit",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ks.prototype,"maxSliderValue",void 0),u([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ks.prototype,"minSliderValue",void 0),u([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ks.prototype,"statistics",null),u([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],ks.prototype,"standardDeviationInterval",null),u([p({type:t$.apiValues,value:null,json:{type:t$.jsonValues,read:t$.read,write:t$.write,origins:{"web-scene":{type:Fce.jsonValues,write:{writer:Fce.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],ks.prototype,"type",null),u([p({type:[Z_t],json:{write:!0}})],ks.prototype,"visualVariables",void 0),u([p({type:K_t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],ks.prototype,"univariateSymbolStyle",null),u([p({type:J_t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],ks.prototype,"univariateTheme",null),ks=cj=u([R("esri.renderers.support.AuthoringInfo")],ks);const iJ=ks,eV=new Rr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let q3=class extends de{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([p({type:iJ,json:{write:!0}})],q3.prototype,"authoringInfo",void 0),u([p({type:eV.apiValues,readOnly:!0,json:{type:eV.jsonValues,read:!1,write:{writer:eV.write,ignoreOrigin:!0}}})],q3.prototype,"type",void 0),q3=u([R("esri.renderers.Renderer")],q3);const sy=q3;function evt(t){var e,r;return((r=(e=t.match(tvt))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const tvt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var uj;let D2=uj=class extends de{constructor(){super(...arguments),this.title=null}clone(){return new uj({title:this.title})}};u([p({type:String,json:{write:!0}})],D2.prototype,"title",void 0),D2=uj=u([R("esri.renderers.support.LegendOptions")],D2);var hj;let ZL=hj=class extends D2{constructor(){super(...arguments),this.showLegend=null}clone(){return new hj({title:this.title,showLegend:this.showLegend})}};u([p({type:Boolean,json:{write:!0}})],ZL.prototype,"showLegend",void 0),ZL=hj=u([R("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],ZL);const V3e=ZL,tV=new Rr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let md=class extends de{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):fR(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([p()],md.prototype,"index",void 0),u([p({type:tV.apiValues,readOnly:!0,json:{read:tV.read,write:tV.write}})],md.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],md.prototype,"field",void 0),u([yr("field")],md.prototype,"castField",null),u([p({type:String,json:{write:!0}})],md.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],md.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],md.prototype,"arcadeRequired",null),u([p({type:V3e,json:{write:!0}})],md.prototype,"legendOptions",void 0),md=u([R("esri.renderers.visualVariables.VisualVariable")],md);const aP=md;var dj;let S1=dj=class extends de{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new dj({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([p({type:ke,json:{type:[Ji],write:!0}})],S1.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],S1.prototype,"label",void 0),u([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],S1.prototype,"value",void 0),u([De("value")],S1.prototype,"writeValue",null),S1=dj=u([R("esri.renderers.visualVariables.support.ColorStop")],S1);const rvt=S1;var pj;let E1=pj=class extends aP{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new pj({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],E1.prototype,"cache",null),u([p({type:["color"],json:{type:["colorInfo"]}})],E1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],E1.prototype,"normalizationField",void 0),u([p({type:[rvt],json:{write:!0}})],E1.prototype,"stops",null),E1=pj=u([R("esri.renderers.visualVariables.ColorVariable")],E1);const z3e=E1;var fj;let g0=fj=class extends de{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return H2(e.transparency)}writeOpacity(t,e,r){e[r]=c5(t)}clone(){return new fj({label:this.label,opacity:this.opacity,value:this.value})}};u([p({type:String,json:{write:!0}})],g0.prototype,"label",void 0),u([p({type:Number,json:{type:Ji,write:{target:"transparency"}}})],g0.prototype,"opacity",void 0),u([Se("opacity",["transparency"])],g0.prototype,"readOpacity",null),u([De("opacity")],g0.prototype,"writeOpacity",null),u([p({type:Number,json:{write:!0}})],g0.prototype,"value",void 0),g0=fj=u([R("esri.renderers.visualVariables.support.OpacityStop")],g0);const ivt=g0;var mj;let C1=mj=class extends aP{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new mj({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],C1.prototype,"cache",null),u([p({type:["opacity"],json:{type:["transparencyInfo"]}})],C1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],C1.prototype,"normalizationField",void 0),u([p({type:[ivt],json:{write:!0}})],C1.prototype,"stops",null),C1=mj=u([R("esri.renderers.visualVariables.OpacityVariable")],C1);const k3e=C1;var gj;let Bm=gj=class extends aP{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new U("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new gj({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([p({readOnly:!0})],Bm.prototype,"cache",null),u([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Bm.prototype,"axis",void 0),u([p({type:["rotation"],json:{type:["rotationInfo"]}})],Bm.prototype,"type",void 0),u([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Bm.prototype,"rotationType",void 0),u([p({type:String,json:{write:!0}})],Bm.prototype,"valueExpressionTitle",void 0),u([De("web-scene","valueExpressionTitle")],Bm.prototype,"writeValueExpressionTitleWebScene",null),Bm=gj=u([R("esri.renderers.visualVariables.RotationVariable")],Bm);const B3e=Bm;var yj;let RT=yj=class extends de{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new yj({label:this.label,size:this.size,value:this.value})}};u([p({type:String,json:{write:!0}})],RT.prototype,"label",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],RT.prototype,"size",void 0),u([p({type:Number,json:{write:!0}})],RT.prototype,"value",void 0),RT=yj=u([R("esri.renderers.visualVariables.support.SizeStop")],RT);const PT=RT;var _j;let XL=_j=class extends V3e{constructor(){super(...arguments),this.customValues=null}clone(){return new _j({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([p({type:[Number],json:{write:!0}})],XL.prototype,"customValues",void 0),XL=_j=u([R("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],XL);const svt=XL;var vj;const r$=new Rr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),bj=new Rr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Vce(t){if(t!=null)return typeof t=="string"||typeof t=="number"?Jr(t):t.type==="size"?s_(t)?t:(delete(t={...t}).type,new hi(t)):void 0}function zce(t,e,r){if(typeof t!="object")return t;const i=new hi;return i.read(t,r),i}let hi=vj=class extends aP{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&xxe.test(this.valueExpression)}}set expression(t){Q.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){s_(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),s_(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return wxe(this)}set maxDataValue(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Vce(t)}readMaxSize(t,e,r){return zce(t,e,r)}set minDataValue(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(Q.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Vce(t)}readMinSize(t,e,r){return zce(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(Q.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return hQe(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new U("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?bj.read(t):null}clone(){return new vj({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:s_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:s_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===co.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===co.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([p({readOnly:!0})],hi.prototype,"cache",null),u([p({type:r$.apiValues,json:{type:r$.jsonValues,origins:{"web-map":{read:!1}},read:r$.read,write:r$.write}})],hi.prototype,"axis",void 0),u([p({type:String,value:null,json:{read:!1}})],hi.prototype,"expression",null),u([p()],hi.prototype,"index",null),u([p({type:String,readOnly:!0})],hi.prototype,"inputValueType",null),u([p({type:svt,json:{write:!0}})],hi.prototype,"legendOptions",void 0),u([p({type:Number,value:null,json:{write:!0}})],hi.prototype,"maxDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],hi.prototype,"maxSize",null),u([yr("maxSize")],hi.prototype,"castMaxSize",null),u([Se("maxSize")],hi.prototype,"readMaxSize",null),u([p({type:Number,value:null,json:{write:!0}})],hi.prototype,"minDataValue",null),u([p({type:Number,value:null,json:{write:!0}})],hi.prototype,"minSize",null),u([yr("minSize")],hi.prototype,"castMinSize",null),u([Se("minSize")],hi.prototype,"readMinSize",null),u([p({type:String,json:{write:!0}})],hi.prototype,"normalizationField",void 0),u([p({readOnly:!0})],hi.prototype,"arcadeRequired",null),u([p({type:String})],hi.prototype,"scaleBy",void 0),u([p({type:[PT],value:null,json:{write:!0}})],hi.prototype,"stops",null),u([p({type:["outline"],json:{write:!0}})],hi.prototype,"target",void 0),u([p({type:String,readOnly:!0})],hi.prototype,"transformationType",null),u([p({type:["size"],json:{type:["sizeInfo"]}})],hi.prototype,"type",void 0),u([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],hi.prototype,"useSymbolValue",void 0),u([p({type:String,json:{write:!0}})],hi.prototype,"valueExpression",void 0),u([Se("valueExpression",["valueExpression","expression"])],hi.prototype,"readValueExpression",null),u([De("web-scene","valueExpression")],hi.prototype,"writeValueExpressionWebScene",null),u([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],hi.prototype,"valueRepresentation",void 0),u([p({type:bj.apiValues,json:{write:bj.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],hi.prototype,"valueUnit",void 0),u([Se("valueUnit")],hi.prototype,"readValueUnit",null),hi=vj=u([R("esri.renderers.visualVariables.SizeVariable")],hi);const f6=hi,nvt={color:z3e,size:f6,opacity:k3e,rotation:B3e},ovt=new Rr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),avt=/^\[([^\]]+)\]$/i;let YL=class extends xe{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let s=null;return s=r.target===i.target?0:r.target?1:-1,s});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:s,rotationType:n}=r,o=s&&s.match(avt),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=ovt.read(l.type),h=nvt[c];h||(Q.getLogger(this).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new yh("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const d=new h;return d.read(l,i),d})}writeVariables(e,r){const i=[];for(const s of e){const n=s.toJSON(r);n&&i.push(n)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([p()],YL.prototype,"visualVariables",null),YL=u([R("esri.renderers.visualVariables.VisualVariableFactory")],YL);const lvt=YL,cvt={base:aP,key:"type",typeMap:{opacity:k3e,color:z3e,rotation:B3e,size:f6}},fE=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new lvt}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&ru(r,i,n.field),n.normalizationField&&ru(r,i,n.normalizationField),n.valueExpression&&(uvt(n.valueExpression,r,i)||await El(r,i,n.valueExpression)))}};return u([p({types:[cvt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Se("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([De("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([R("esri.renderers.mixins.VisualVariablesMixin")],e),e};function uvt(t,e,r){const i=evt(t);return i!=null&&(ru(e,r,i),!0)}const mE={types:nge,json:{write:{writer:c4},origins:{"web-scene":{types:bK,write:{writer:c4},read:{reader:VS({types:bK})}}}}},G3e={types:{base:xc,key:"type",typeMap:{"simple-fill":_b.typeMap["simple-fill"],"picture-fill":_b.typeMap["picture-fill"],"polygon-3d":_b.typeMap["polygon-3d"]}},json:{write:{writer:c4},origins:{"web-scene":{type:ER,write:{writer:c4}}}}},JL={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var wj;let y0=wj=class extends de{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new wj({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([p({type:String,json:{write:!0}})],y0.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],y0.prototype,"label",void 0),u([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],y0.prototype,"minValue",void 0),u([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],y0.prototype,"maxValue",void 0),u([p(mE)],y0.prototype,"symbol",void 0),y0=wj=u([R("esri.renderers.support.ClassBreakInfo")],y0);const U4=y0;var xj;const j3e="log",QL="percent-of-total",KL="field",i$=new Rr({esriNormalizeByLog:j3e,esriNormalizeByPercentOfTotal:QL,esriNormalizeByField:KL}),hvt=qs(U4);let Dn=xj=class extends fE(sy){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(s=>{const n=new U4;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(t,e,r,i){const s=t.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[r]=s}castField(t){return t==null?t:typeof t=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):fR(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&KL||r&&QL||null,e&&r&&Q.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==KL&&t!==QL||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new U4({minValue:t,maxValue:e,symbol:oge(r)}):hvt(K(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return!this.valueExpression||e!=null&&e.arcade!=null||Q.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await v_()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void Q.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(e==null||e.arcade==null)){const s=await v_(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new xj({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:K(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:K(this.visualVariables),legendOptions:K(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),El(t,e,this.valueExpression)];ru(t,e,this.field),ru(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{},{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let s=parseFloat(r[e]);if(i){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===j3e)s=Math.log(s)*Math.LOG10E;else if(i!==QL||n==null||isNaN(n)){if(i===KL&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};u([p(G3e)],Dn.prototype,"backgroundFillSymbol",void 0),u([p({type:[U4]})],Dn.prototype,"classBreakInfos",void 0),u([Se("classBreakInfos")],Dn.prototype,"readClassBreakInfos",null),u([De("classBreakInfos")],Dn.prototype,"writeClassBreakInfos",null),u([p({type:String,json:{write:!0}})],Dn.prototype,"defaultLabel",void 0),u([p(mE)],Dn.prototype,"defaultSymbol",void 0),u([p({type:String,json:{write:!0}})],Dn.prototype,"field",void 0),u([yr("field")],Dn.prototype,"castField",null),u([p({type:Boolean})],Dn.prototype,"isMaxInclusive",void 0),u([p({type:D2,json:{write:!0}})],Dn.prototype,"legendOptions",void 0),u([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Dn.prototype,"minValue",null),u([p({type:String,json:{write:!0}})],Dn.prototype,"normalizationField",void 0),u([p({type:Number,cast:t=>Qu(t),json:{write:!0}})],Dn.prototype,"normalizationTotal",void 0),u([p({type:i$.apiValues,value:null,json:{type:i$.jsonValues,read:i$.read,write:i$.write}})],Dn.prototype,"normalizationType",null),u([et({classBreaks:"class-breaks"})],Dn.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Dn.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Dn.prototype,"valueExpressionTitle",void 0),Dn=xj=u([R("esri.renderers.ClassBreaksRenderer")],Dn);const H3e=Dn;function dvt(t){return t.type==="date"||t.type==="esriFieldTypeDate"||t.type==="date-only"||t.type==="esriFieldTypeDateOnly"||t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset"}function kce(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function Bce(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let sJ=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const s=i==null?void 0:i.name,n=jce(i==null?void 0:i.name);if(s&&n){const o=Gce(s);this._fieldsMap.set(s,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(n,i),r.push(o),dvt(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):Zq(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),kce(i)||Bce(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)kce(e)||Bce(e)||e.nullable||$De(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(Gce(e))??this._normalizedFieldsMap.get(jce(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function Gce(t){return t.trim().toLowerCase()}function jce(t){var e;return((e=mDe(t))==null?void 0:e.toLowerCase())??""}const Hce="esri.renderers.support.DictionaryLoader",pvt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let nJ=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new e2e(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(y){if(ys(y))return this._dictionaryPromise=null,null}const s=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),n={};if(this.fieldMap)for(const y of this._symbolFields){const _=this._getFieldName(this.fieldMap[y]);n[y]=_?s?e.attributes[_]:""+e.attributes[_]:""}let o=null;try{o=i==null?void 0:i(n,r)}catch{return null}if(!o||typeof o!="string")return null;const a=zH(o).toString(),l=this._symbolCache.get(a);if(l)return l.catch(()=>{this._symbolCache.pop(a)}),l;const c=o.split(";"),h=[],d=[];for(const y of c)if(y)if(y.includes("po:")){const _=y.substr(3).split("|");if(_.length===3){const v=_[0],w=_[1];let T=_[2];if(w==="DashTemplate")T=T.split(" ").map(x=>Number(x));else if(w==="Color"){const x=new ke(T).toRgba();T=[x[0],x[1],x[2],255*x[3]]}else T=Number(T);d.push({primitiveName:v,propertyName:w,value:T})}}else if(y.includes("|")){for(const _ of y.split("|"))if(this._itemNames.has(_)){h.push(_);break}}else this._itemNames.has(y)&&h.push(y);const f=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point",m=this._cimPartsToCIMSymbol(h,d,f,r);return this._symbolCache.put(a,m,1),m}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void Q.getLogger(Hce).error("no valid URL!");const r=Fr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:i}]=await Promise.all([r,v_()]);if(!i)throw this._dictionaryPromise=null,new U("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=i,l=o;let c=!1;n&&(this._dictionaryVersion=aw.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const h={};if(this.config){const m=this.config;for(const y in m)h[y]=m[y]}if(s.configuration)for(const m of s.configuration)h.hasOwnProperty(m.name)||(h[m.name]=m.value);const d=[];if(e!=null&&e.fields&&this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m],_=e.fields.filter(v=>v.name.toLowerCase()===(y==null?void 0:y.toLowerCase()));_.length>0&&d.push({..._[0],type:c?_[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new sJ(d));const f=dDe(l,e!=null?e.spatialReference:null,d,h).then(m=>{const y={scale:0};return(_,v)=>{if(m==null)return null;const w=m.repurposeFeature({geometry:null,attributes:_});return y.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:w,$view:y},m.services)}}).catch(m=>(Q.getLogger(Hce).error("Creating dictinoary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,r,i,s){const n=new Array(e.length);for(let l=0;l<e.length;l++)n[l]=this._getSymbolPart(e[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)q3e(l,a);return new XS({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(n=>n.data);const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),s=Fr(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(e),n}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const n of e){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=pvt),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}_getFieldName(e){if(this._fieldIndex!==null){const r=this._fieldIndex.get(e);return r?r.name:e}return e}};function q3e(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&fvt(s,e)}}function fvt(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":q3e(s,e);break;case"CIMTextSymbol":s.fieldMap=e}}}const _6t=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:nJ},Symbol.toStringTag,{value:"Module"}));var Tj;let gd=Tj=class extends fE(sy){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new nJ(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i!=null&&i.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new Tj({config:K(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:K(this.fieldMap),url:K(this.url),visualVariables:K(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await El(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([p({type:nJ})],gd.prototype,"_loader",null),u([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],gd.prototype,"config",void 0),u([p({type:Object,json:{write:!0}})],gd.prototype,"fieldMap",void 0),u([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],gd.prototype,"scaleExpression",void 0),u([De("scaleExpression")],gd.prototype,"writeData",null),u([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],gd.prototype,"scaleExpressionTitle",void 0),u([p({type:String,json:{write:!0}})],gd.prototype,"url",void 0),u([De("visualVariables")],gd.prototype,"writeVisualVariables",null),gd=Tj=u([R("esri.renderers.DictionaryRenderer")],gd);const mvt=gd;var Sj;let Gm=Sj=class extends de{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(Q.getLogger(this).error(".field: field must be a string value"),null):fR(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new Sj({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:ke,json:{type:[Number],write:!0}})],Gm.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],Gm.prototype,"field",void 0),u([yr("field")],Gm.prototype,"castField",null),u([p({type:String,json:{write:!0}})],Gm.prototype,"label",void 0),u([p({type:String,json:{write:!0}})],Gm.prototype,"valueExpression",void 0),u([p({type:String,json:{write:!0}})],Gm.prototype,"valueExpressionTitle",void 0),Gm=Sj=u([R("esri.renderers.support.AttributeColorInfo")],Gm);const W3e=Gm;var Ej;let eD=Ej=class extends de{constructor(){super(...arguments),this.unit=null}clone(){return new Ej({unit:this.unit})}};u([p({type:String,json:{write:!0}})],eD.prototype,"unit",void 0),eD=Ej=u([R("esri.renderers.support.DotDensityLegendOptions")],eD);const gvt=eD;var Cj;let jl=Cj=class extends fE(sy){constructor(t){super(t),this.attributes=null,this.backgroundColor=new ke([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Ph,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new ww({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,r)=>e+r.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Cj({attributes:K(this.attributes),backgroundColor:K(this.backgroundColor),dotBlendingEnabled:K(this.dotBlendingEnabled),dotShape:K(this.dotShape),dotSize:K(this.dotSize),dotValue:K(this.dotValue),legendOptions:K(this.legendOptions),outline:K(this.outline),referenceScale:K(this.referenceScale),visualVariables:K(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await El(t,e,r.valueExpression),r.field&&t.add(r.field)}};u([p({type:[W3e],json:{write:!0}})],jl.prototype,"attributes",void 0),u([p({type:ke,json:{write:!0}})],jl.prototype,"backgroundColor",void 0),u([p({type:Boolean,json:{write:!0}})],jl.prototype,"dotBlendingEnabled",void 0),u([p({type:String,json:{write:!1}})],jl.prototype,"dotShape",void 0),u([p({type:Number,json:{write:!0}})],jl.prototype,"dotSize",void 0),u([p({type:gvt,json:{write:!0}})],jl.prototype,"legendOptions",void 0),u([p({type:Ph,json:{default:null,write:!0}})],jl.prototype,"outline",void 0),u([p({type:Number,json:{write:!0}})],jl.prototype,"dotValue",void 0),u([p({type:Number,json:{write:!0}})],jl.prototype,"referenceScale",void 0),u([p({type:Number,json:{write:!0}})],jl.prototype,"seed",void 0),u([et({dotDensity:"dot-density"})],jl.prototype,"type",void 0),jl=Cj=u([R("esri.renderers.DotDensityRenderer")],jl);const yvt=jl;var Aj;let W3=Aj=class extends de{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new Aj({color:this.color,ratio:this.ratio})}};u([p({type:ke,json:{type:[Ji],default:null,write:!0}})],W3.prototype,"color",void 0),u([p({type:Number,json:{write:!0}})],W3.prototype,"ratio",void 0),W3=Aj=u([R("esri.renderers.support.HeatmapColorStop")],W3);const tD=W3;let MT=class extends ji(de){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([p({type:String,json:{write:!0}})],MT.prototype,"minLabel",void 0),u([p({type:String,json:{write:!0}})],MT.prototype,"maxLabel",void 0),u([p({type:String,json:{write:!0}})],MT.prototype,"title",void 0),MT=u([R("esri.renderers.support.HeatmapLegendOptions")],MT);const oJ=2.4;function _vt(t){return bh(t*oJ)}function vvt(t){return po(t)/oJ}function bvt(t,e,r,i){let{color:s,ratio:n}=e,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=_e((i-n)/(a-n),0,1);l5(t,s.toArray(),o.toArray(),l)}function b6t(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],s=t[0],n=1;const o=Yt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)i=s,s=t[n++];bvt(o,i,s,l),r.set(o,4*a)}return r}function w6t(t,e,r,i){const{radius:s,fieldOffset:n,field:o}=e,a=Math.round(po(s)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const d=xvt(o,n),f=new Set;for(const m of t){const y=m.getCursor();for(;y.next();){const _=y.getObjectId();if(f.has(_))continue;f.add(_);const v=y.readLegacyPointGeometry(),w=128;if(v.x<-w||v.x>=r+w||v.y<-w||v.y>i+w)continue;const T=+d(y),x=Math.max(0,Math.round(v.x)-a),S=Math.max(0,Math.round(v.y)-a),O=Math.min(i,Math.round(v.y)+a),C=Math.min(r,Math.round(v.x)+a);for(let P=S;P<O;P++)for(let $=x;$<C;$++){const V=P*r+$,z=wvt(v.x-$,v.y-P,a);c=l[V]+=z*T,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function wvt(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function x6t(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function xvt(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var Oj;const Z3e="esri.renderers.HeatmapRenderer",Tvt=Q.getLogger(Z3e);function qce(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let no=Oj=class extends sy{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new tD({ratio:0,color:new ke("rgba(255, 140, 0, 0)")}),new tD({ratio:.75,color:new ke("rgba(255, 140, 0, 1)")}),new tD({ratio:.9,color:new ke("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return qce(t)}get blurRadius(){return vvt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",_vt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(oJ**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||la(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,US(()=>{Nd(Tvt,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=qce(t),super.read(t,e)}getSymbol(){return new k_}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await ru(t,e,r),i&&typeof i=="string"&&await El(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new Oj({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:K(this.colorStops),field:this.field,legendOptions:K(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([p({type:iJ,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],no.prototype,"authoringInfo",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],no.prototype,"blurRadius",null),u([p({type:[tD],json:{write:!0}})],no.prototype,"colorStops",void 0),u([p({type:String,json:{write:!0}})],no.prototype,"field",void 0),u([p({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],no.prototype,"fieldOffset",void 0),u([p({type:MT,json:{write:!0}})],no.prototype,"legendOptions",void 0),u([p({type:Number,json:{write:!0}})],no.prototype,"maxDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],no.prototype,"maxPixelIntensity",null),u([p({type:Number,json:{write:!0}})],no.prototype,"minDensity",void 0),u([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],no.prototype,"minPixelIntensity",null),u([p({type:Number,cast:Jr,json:{write:!0}})],no.prototype,"radius",void 0),u([p({type:Number,range:{min:0},json:{default:0,write:!0}})],no.prototype,"referenceScale",void 0),u([et({heatmap:"heatmap"})],no.prototype,"type",void 0),u([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],no.prototype,"valueExpression",void 0),u([p({type:String})],no.prototype,"valueExpressionTitle",void 0),u([p({readOnly:!0})],no.prototype,"_pixelIntensityToDensity",null),no=Oj=u([R(Z3e)],no);const X3e=no;let K1=class extends ji(de){constructor(){super(...arguments),this.color=new ke([0,0,0,0]),this.label=null,this.threshold=0}};u([p({type:ke,json:{write:!0}})],K1.prototype,"color",void 0),u([p({type:String,json:{write:!0}})],K1.prototype,"label",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],K1.prototype,"threshold",void 0),K1=u([R("esri.renderers.support.OthersCategory")],K1);let rD=class extends ji(de){constructor(){super(...arguments),this.title=null}};u([p({type:String,json:{write:!0}})],rD.prototype,"title",void 0),rD=u([R("esri.renderers.support.PieChartLegendOptions")],rD);let Uc=class extends fE(ji(sy)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new ke([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new K1,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new k_({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(fw)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await El(e,r,i.valueExpression),i.field&&e.add(i.field)}};u([p({type:[W3e],json:{write:!0}})],Uc.prototype,"attributes",void 0),u([p({type:ww,json:{default:null,write:!0}})],Uc.prototype,"backgroundFillSymbol",void 0),u([p({type:ke,json:{write:!0}})],Uc.prototype,"defaultColor",void 0),u([p({type:String,json:{write:!0}})],Uc.prototype,"defaultLabel",void 0),u([p({type:Number,range:{min:0,max:1},json:{write:!0}})],Uc.prototype,"holePercentage",void 0),u([p({type:K1,json:{write:!0}})],Uc.prototype,"othersCategory",void 0),u([p({type:rD,json:{write:!0}})],Uc.prototype,"legendOptions",void 0),u([p({type:Ph,json:{default:null,write:!0}})],Uc.prototype,"outline",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],Uc.prototype,"size",void 0),u([et({pieChart:"pie-chart"})],Uc.prototype,"type",void 0),Uc=u([R("esri.renderers.PieChartRenderer")],Uc);const Svt=Uc;var Rj;let A1=Rj=class extends fE(sy){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new Rj({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:K(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([p({type:String,json:{write:!0}})],A1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],A1.prototype,"label",void 0),u([p(mE)],A1.prototype,"symbol",void 0),u([et({simple:"simple"})],A1.prototype,"type",void 0),A1=Rj=u([R("esri.renderers.SimpleRenderer")],A1);const m6=A1,Evt=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function Pj(t){return t instanceof xe}function Wce(t){return t instanceof Mt?Object.keys(t.items):Pj(t)?la(t).keys():t?Object.keys(t):[]}function s$(t,e){return t instanceof Mt?t.items[e]:t[e]}function Cvt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function KA(t){return t?t.declaredClass:null}function Y3e(t,e){var d;const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=Wce(t),s=Wce(e);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||Cvt(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(f=>!i.includes(f)),o=i.filter(f=>!s.includes(f)),a=i.filter(f=>s.includes(f)&&s$(t,f)!==s$(e,f)).concat(n,o).sort(),l=KA(t);if(l&&Evt.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=Pj(t)&&Pj(e);for(const f of a){const m=s$(t,f),y=s$(e,f);let _;if((h||typeof m!="function"&&typeof y!="function")&&m!==y&&(m!=null||y!=null)){if(r&&r[f]&&typeof r[f]=="function")_=(d=r[f])==null?void 0:d.call(r,m,y);else if(m instanceof Date&&y instanceof Date){if(m.getTime()===y.getTime())continue;_={type:"complete",oldValue:m,newValue:y}}else _=typeof m=="object"&&typeof y=="object"&&KA(m)===KA(y)?Y3e(m,y):{type:"complete",oldValue:m,newValue:y};_!=null&&(c!=null?c.diff[f]=_:c={type:"partial",diff:{[f]:_}})}}return c}function Avt(t,e){if(t==null)return!1;const r=e.split(".");let i=t;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function C6t(t,e){for(const r of e)if(Avt(t,r))return!0;return!1}function Ovt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&KA(t)!==KA(e)?{type:"complete",oldValue:t,newValue:e}:Y3e(t,e)}function n$(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!n$(r))return!1;for(const r of e.removed)if(!n$(r))return!1;for(const r of e.changed)if(!n$(r))return!1;return!0}case"partial":for(const e in t.diff)if(!n$(t.diff[e]))return!1;return!0}}let IT=class extends ji(de){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([p(JL)],IT.prototype,"value",void 0),u([p(JL)],IT.prototype,"value2",void 0),u([p(JL)],IT.prototype,"value3",void 0),IT=u([R("esri.renderers.support.UniqueValue")],IT);const N2=IT;let _0=class extends ji(de){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new N2({value:i})):r==="object"?e[0]instanceof N2?e:e.map(i=>new N2(i)):null}};u([p({type:String,json:{write:!0}})],_0.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],_0.prototype,"label",void 0),u([p(mE)],_0.prototype,"symbol",void 0),u([p({type:[N2],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new N2({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const s=[i.value,i.value2,i.value3].filter(fw).map(n=>n.toString());r.push(s)}e.values=r}}}})],_0.prototype,"values",void 0),u([yr("values")],_0.prototype,"castValues",null),_0=u([R("esri.renderers.support.UniqueValueClass")],_0);const J3e=_0;let Z3=class extends ji(de){constructor(e){super(e),this.heading=null,this.classes=null}};u([p({type:String,json:{write:!0}})],Z3.prototype,"heading",void 0),u([p({type:[J3e],json:{write:!0}})],Z3.prototype,"classes",void 0),Z3=u([R("esri.renderers.support.UniqueValueGroup")],Z3);const Mj=Z3;var Ij;let O1=Ij=class extends de{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new Ij({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([p({type:String,json:{write:!0}})],O1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],O1.prototype,"label",void 0),u([p(mE)],O1.prototype,"symbol",void 0),u([p(JL)],O1.prototype,"value",void 0),O1=Ij=u([R("esri.renderers.support.UniqueValueInfo")],O1);const eO=O1;var X3;const Q3e="esri.renderers.UniqueValueRenderer",jy=Q.getLogger(Q3e),Zce="uvInfos-watcher",Xce="uvGroups-watcher",Rvt=",",Pvt=qs(eO);function Mvt(t){const{field1:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!r);return[{classes:(n??[]).map(l=>{var w;const{symbol:c,label:h,value:d,description:f}=l,[m,y,_]=a?((w=d==null?void 0:d.toString())==null?void 0:w.split(s||""))||[]:[d],v=[];return(e||o)&&v.push(m),r&&v.push(y),i&&v.push(_),{symbol:c,label:h,values:[v],description:f}})}]}let xs=X3=class extends fE(sy){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=e.find(a=>a.value===r[n].value);o?Ovt(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<e.length;n++)r.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:fR(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new U("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):jy.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||qn.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=Lg(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=Dg(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?jy.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?jy.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var i;if(this.styleOrigin)return void jy.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?Pvt(t):new eO({value:t,symbol:oge(e)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void jy.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await v_()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void jy.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(r==null||r.arcade==null)){const s=await v_(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var i;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new X3({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:K(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:K(this.visualVariables),legendOptions:K(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:K(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=K(this.uniqueValueInfos),r=K(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(K(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),El(t,e,this.valueExpression)];ru(t,e,this.field),ru(t,e,this.field2),ru(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return dY(this.styleOrigin,{portal:this.portal}).then(t=>{var r;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const s=new xw({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new eO({value:i.name,symbol:s});e.push(n),this._valueInfoMap[i.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)!=null&&r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",Rvt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Zce);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(ue(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,s)=>{i!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,Zce)}}_watchUniqueValueGroups(){this.removeHandles(Xce);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(ue(()=>({classes:r.classes}),(i,s)=>{i!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(ue(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,Xce)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:d,values:f,description:m}=c;for(const y of f??[]){const{value:_,value2:v,value3:w}=y,T=[_];r&&T.push(v),i&&T.push(w);const x=a?T.join(s||""):T[0];t.push(new eO({symbol:h,label:d,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!i||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=n.map(c=>{var w;const{symbol:h,label:d,value:f,description:m}=c,[y,_,v]=o?((w=f==null?void 0:f.toString())==null?void 0:w.split(s||""))||[]:[f];return new J3e({symbol:h,label:d,description:m,values:[new N2({value:y,value2:_,value3:v})]})}),l=[new Mj({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{};let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(r[e]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new X3(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||qn.getDefault());const i=r.populateFromStyle();return i.catch(s=>{jy.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(t,e){const r=new X3(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(s=>{jy.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([p({readOnly:!0})],xs.prototype,"_cache",null),u([et({uniqueValue:"unique-value"})],xs.prototype,"type",void 0),u([p(G3e)],xs.prototype,"backgroundFillSymbol",void 0),u([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],xs.prototype,"field",null),u([yr("field")],xs.prototype,"castField",null),u([De("field")],xs.prototype,"writeField",null),u([p({type:String,value:null,json:{write:!0}})],xs.prototype,"field2",null),u([p({type:String,value:null,json:{write:!0}})],xs.prototype,"field3",null),u([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],xs.prototype,"orderByClassesEnabled",void 0),u([p({type:String,value:null,json:{write:!0}})],xs.prototype,"valueExpression",null),u([p({type:String,json:{write:!0}})],xs.prototype,"valueExpressionTitle",void 0),u([p({type:D2,json:{write:!0}})],xs.prototype,"legendOptions",void 0),u([p({type:String,json:{write:!0}})],xs.prototype,"defaultLabel",void 0),u([p(_he({...mE},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],xs.prototype,"defaultSymbol",null),u([p({type:String,value:null,json:{write:!0}})],xs.prototype,"fieldDelimiter",null),u([p({type:qn,readOnly:!0})],xs.prototype,"portal",void 0),u([Se("portal",["styleName"])],xs.prototype,"readPortal",null),u([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],xs.prototype,"styleOrigin",void 0),u([Se("styleOrigin",["styleName","styleUrl"])],xs.prototype,"readStyleOrigin",null),u([De("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],xs.prototype,"writeStyleOrigin",null),u([p({type:[Mj],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||Mvt(e)).map(i=>Mj.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],xs.prototype,"uniqueValueGroups",null),u([p({type:[eO],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],xs.prototype,"uniqueValueInfos",null),xs=X3=u([R(Q3e)],xs);const aJ=xs,g6={key:"type",base:sy,typeMap:{heatmap:X3e,simple:m6,"unique-value":aJ,"class-breaks":H3e,"dot-density":yvt,dictionary:mvt,"pie-chart":Svt},errorContext:"renderer"},K3e={key:"type",base:sy,typeMap:{simple:m6,"unique-value":aJ,"class-breaks":H3e,heatmap:X3e},errorContext:"renderer"};function P6t(t,e){return aR(t,null,e)}const Ivt=VS({types:g6});function aR(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new yh("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):Ivt(t,e,r):null}let $vt=class eAe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(SV),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new eAe,i=this._originStores[hr.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,K(s),hr.DEFAULTS)});for(let s=hr.SERVICE;s<SV;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||r.set(a,K(o),s)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=hr.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const n=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),n!==r}return!1}delete(e,r=hr.USER){const i=this._originStores[r];if(!i)return;const s=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],s=i&&i.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,r),n!==s}originOf(e){return this._propertyOriginMap.get(e)||hr.DEFAULTS}forEach(e){this._values.forEach(e)}};const tAe=t=>{let e=class extends t{constructor(...r){super(...r);const i=la(this),s=i.store,n=new $vt;i.store=n,cde(i,s,n)}read(r,i){hde(this,r,i)}getAtOrigin(r,i){const s=rV(this),n=lg(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return gD(this.originIdOf(r))}originIdOf(r){return rV(this).originOf(r)}revert(r,i){const s=rV(this),n=lg(i),o=la(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([R("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function rV(t){return la(t).store}let Yce=class extends tAe(xe){};Yce=u([R("esri.core.ReadOnlyMultiOriginJSONSupport")],Yce);const Lvt=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return iV(this).delete(r,lg(i))}write(r,i){return pde(this,r=r||{},i),r}setAtOrigin(r,i,s){la(this).setAtOrigin(r,i,lg(s))}removeOrigin(r){const i=iV(this),s=lg(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),hr.USER)}updateOrigin(r,i){const s=iV(this),n=lg(i),o=this.get(r);for(let a=n+1;a<SV;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return e=u([R("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function iV(t){return la(t).store}const lJ=t=>{let e=class extends Lvt(tAe(t)){constructor(...r){super(...r)}};return e=u([R("esri.core.MultiOriginJSONSupport")],e),e};let Jce=class extends lJ(xe){};Jce=u([R("esri.core.MultiOriginJSONSupport")],Jce);function Dvt(t){return"portalItem"in t}const rAe=t=>{let e=class extends t{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):Dvt(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([p({type:String})],e.prototype,"apiKey",null),e=u([R("esri.layers.mixins.APIKeyMixin")],e),e},iAe=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=Ow(this.url);if(r!=null&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",IVe(r,Q.getLogger(this)))}};return u([p()],e.prototype,"title",null),u([p({type:String})],e.prototype,"url",null),e=u([R("esri.layers.mixins.ArcGISService")],e),e},sAe=new Ls.EventEmitter;function $6t(t,e,r=!1){const i=yo();return r=e==null||r,sAe.emit("apply-edits",{serviceUrl:t,layerId:e,mayReceiveServiceEdits:r,result:i.promise}),i}const nAe="esri.layers.mixins.EditBusLayer",oAe=Symbol(nAe);function L6t(t){return t!=null&&typeof t=="object"&&oAe in t}const aAe=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([sAe.on("apply-edits",s=>{const{serviceUrl:n,layerId:o,mayReceiveServiceEdits:a,result:l}=s,c=n===this.url,h=o!=null&&this.layerId!=null&&o===this.layerId;if(!c||!h&&!a)return;const d=l.then(f=>{var y;if(h&&(f.addedFeatures.length||f.updatedFeatures.length||f.deletedFeatures.length||f.addedAttachments.length||f.updatedAttachments.length||f.deletedAttachments.length))return this.emit("edits",K(f)),f;const m=(y=f.editedFeatures)==null?void 0:y.find(({layerId:_})=>_===this.layerId);if(m){const{adds:_,updates:v,deletes:w}=m.editedFeatures,T={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:_?_.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],deletedFeatures:w?w.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],updatedFeatures:v?v.map(({current:{attributes:x}})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],editedFeatures:K(f.editedFeatures),exceededTransferLimit:!1};return this.emit("edits",T),T}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:K(f.editedFeatures),exceededTransferLimit:!1}});this.emit("apply-edits",{result:d})})])},()=>{})}};return e=oAe,r=u([R(nAe)],r),r},Qce={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},Kce={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},eue={ArcGISFeatureLayer:!0},Nvt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":Qce,"web-map/basemap":Kce,"web-map/tables":eue,"link-chart/operational-layers":{...Qce,LinkChartLayer:!0},"link-chart/basemap":Kce,"link-chart/tables":eue,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}};function Fvt(t){if(!t)return t;const{start:e,end:r}=t;return new em({start:e!=null?wb(e,-e.getTimezoneOffset(),"minutes"):e,end:r!=null?wb(r,-r.getTimezoneOffset(),"minutes"):r})}function Uvt(t){if(!t)return t;const{start:e,end:r}=t;return new em({start:e!=null?wb(e,e.getTimezoneOffset(),"minutes"):e,end:r!=null?wb(r,r.getTimezoneOffset(),"minutes"):r})}var $j;let Y3=$j=class extends de{constructor(t){super(t)}async collectRequiredFields(t,e){return El(t,e,this.expression)}clone(){return new $j({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([p({type:String,json:{write:!0}})],Y3.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],Y3.prototype,"title",void 0),Y3=$j=u([R("esri.layers.support.FeatureExpressionInfo")],Y3);const tue=Y3;var Lj;const o$=Wa()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),rue=new Rr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let jm=Lj=class extends de{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new Lj({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&zOe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([p({type:tue,json:{write:!0}})],jm.prototype,"featureExpressionInfo",void 0),u([Se("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],jm.prototype,"readFeatureExpressionInfo",null),u([De("featureExpressionInfo",{featureExpressionInfo:{type:tue},"featureExpression.value":{type:[0]}})],jm.prototype,"writeFeatureExpressionInfo",null),u([p({type:o$.apiValues,nonNullable:!0,json:{type:o$.jsonValues,read:o$.read,write:{writer:o$.write,isRequired:!0}}})],jm.prototype,"mode",null),u([p({type:Number,json:{write:!0}})],jm.prototype,"offset",void 0),u([p({type:QYe,json:{type:String,read:rue.read,write:rue.write}})],jm.prototype,"unit",null),jm=Lj=u([R("esri.layers.support.ElevationInfo")],jm);const lAe=jm,cAe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},y6={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},_6={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},uAe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:w_}}},hAe={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},dAe={value:null,type:lAe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function D6t(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const pAe={write:!0,read:!0},Dj={type:Number,json:{origins:{"web-document":pAe,"portal-item":{write:!0}}}},Vvt={...Dj,json:{...Dj.json,origins:{"web-document":{...pAe,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?H2(e.layerDefinition.drawingInfo.transparency):void 0:H2(e.drawingInfo.transparency)}}},N6t={type:em,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;t&&(s=Uvt(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;e&&(n=n.offset(-e.value,e.unit)),t&&(n=Fvt(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},F6t={type:_r,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=_r.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=Ge.fromJSON(e.spatialReference)),r}}}},read:!1}},fAe={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},zvt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},kvt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},mAe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},gAe=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&HPe(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),BPe(this,r,s=>super.read(r,s),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=Nvt[l];let h=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=i.messages)==null||o.push(new U("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof U&&l.name==="web-document-write:property-required").length;return f_(s==null?void 0:s.url)?((a=i==null?void 0:i.messages)==null||a.push(new U("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([p(mAe)],e.prototype,"listMode",void 0),u([De("listMode")],e.prototype,"writeListMode",null),u([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([De("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([p(Dj)],e.prototype,"opacity",void 0),u([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([De("title"),De(["web-scene"],"title")],e.prototype,"writeTitle",null),u([p({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([R("esri.layers.mixins.OperationalLayer")],e),e};async function Bvt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return RC(t);const r=Ge.WGS84;return await Lge(e,r),Sw(t,r)}function U6t(t,e){if(!yAe(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function yAe(t,e){var r;return!!((r=t.typeKeywords)!=null&&r.includes(e))}function V6t(t){return yAe(t,Gvt.HOSTED_SERVICE)}function z6t(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function k6t(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return Bvt(r)}const Gvt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service"};function iue(t){var l;const{portal:e,isOrgItem:r,itemControl:i}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!r&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const _Ae=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Pe(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new fb({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const{load:s}=await ae(()=>import("./layersLoader-50532ff0.js"),["assets/layersLoader-50532ff0.js","assets/fetchService-cf0ed1b3.js","assets/jsonContext-cef0facd.js"]);return Qt(i),await s({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw ys(s)||Q.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Io(i),!0)))}async _setUserPrivileges(r,i){if(!Yr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Io(s)}}async _fetchUserPrivileges(r,i){let s=this.portalItem;if(!r||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(i);const n=r===s.id;if(n&&s.portal.user)return iue(s);let o,a;if(n)o=s.portal.url;else try{o=await rpe(this.url,i)}catch(d){Io(d)}if(!o||!_Me(o,s.portal.url))return this._fetchFallbackUserPrivileges(i);try{const d=i!=null?i.signal:null;a=await(xr==null?void 0:xr.getCredential(`${o}/sharing`,{prompt:!1,signal:d}))}catch(d){Io(d)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new fb({id:r,portal:{url:o}}),await s.load(i)),s.portal.user)return iue(s)}catch(d){Io(d)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(s){Io(s)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?xr==null?void 0:xr.findCredential(this.url):null;if(!i)return!0;const s=a$.credential===i?a$.user:await this._fetchEditingUser(r);return a$.credential=i,a$.user=s,s==null||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var h,d;const i=(d=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:d.user;if(i)return i;const s=xr.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=qn.getDefault();if(o&&o.loaded&&Hd(o.restUrl)===Hd(n))return o.user;const a=`${n}/community/self`,l=r!=null?r.signal:null,c=await uu(Fr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?wq.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||qn.getDefault());return s&&n&&!vde(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new U("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([p({type:fb})],e.prototype,"portalItem",null),u([Se("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([De("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([p({clonable:!1})],e.prototype,"resourceReferences",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([R("esri.layers.mixins.PortalLayer")],e),e},a$={credential:null,user:null},cJ=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&jvt(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([R("esri.layers.mixins.ScaleRangeLayer")],e),e};function jvt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function vAe(t){return t&&"getAtOrigin"in t&&"originOf"in t}function sue(t){t&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:r,newOrigin:i})=>{vAe(e)&&i&&e.originOf(r)!==i&&e.updateOrigin(r,i)})}async function Hvt(t,e,r,i,s,n){let o=null;if(r!=null){const c=`${t}/nodepages/`,h=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await Fr(h,{query:{f:"json",token:i},responseType:"json",signal:n})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(d){s!=null&&s.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,d),o=d}}if(!e)return null;const a=`${t}/nodes/`,l=a+(e&&e.split("/").pop());try{return{type:"node",rootNode:(await Fr(l,{query:{f:"json",token:i},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new U("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}let qvt=null;function Wvt(){return qvt}async function Zvt(t,e={},r){await t.load(r);const i=_c(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:r==null?void 0:r.signal},c=await t.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:d,resource:f})=>({created:new Date(h),size:d,resource:t.resourceFromPath(f)}))}}async function Xvt(t,e,r,i){if(!t.hasPath())throw new U(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const s=t.portalItem;await s.load(i);const n=_c(s.userItemUrl,e==="add"?"addResources":"updateResources"),[o,a]=bAe(t.path),l=await wAe(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),i!=null&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),i!=null&&i.access&&c.append("access",i.access),await s.portal.request(n,{method:"post",body:c,signal:i==null?void 0:i.signal}),t}async function Yvt(t,e,r){if(!e.hasPath())throw new U("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(r);const i=_c(t.userItemUrl,"removeResources");await t.portal.request(i,{method:"post",query:{resource:e.path},signal:r==null?void 0:r.signal}),e.portalItem=null}async function Jvt(t,e){await t.load(e);const r=_c(t.userItemUrl,"removeResources");return t.portal.request(r,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function bAe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function uJ(t){const[e,r]=Qvt(t),[i,s]=bAe(e);return[i,s,r]}function Qvt(t){const e=cq(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function wAe(t){return t instanceof Blob?t:(await Fr(t.url,{responseType:"blob"})).data}function Kvt(t,e){if(!t.hasPath())return null;const[r,,i]=uJ(t.path);return t.portalItem.resourceFromPath(_c(r,e+i))}function xAe(t,e){if(!t.hasPath())return null;const[r,,i]=uJ(t.path);return t.portalItem.resourceFromPath(_c(r,e+i))}const J3=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:Xvt,contentToBlob:wAe,fetchResources:Zvt,getSiblingOfSameType:Kvt,getSiblingOfSameTypeI:xAe,removeAllResources:Jvt,removeResource:Yvt,splitPrefixFileNameAndExtension:uJ},Symbol.toStringTag,{value:"Module"}));async function nue(t,e,r){if(!e||!e.resources)return;const i=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),t.paths.push(c)});for(const c of e.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:d,finish:f,error:m}=c,y=xAe(h,u6());t.paths.push(y.path),o.push(oue({resource:y,content:d,compress:c.compress,finish:f,error:m},r))}else t.paths.push(c.resource.path),o.push(e1t(c,r)),n.add(c.resource.path);for(const c of e.resources.toAdd)o.push(oue(c,r)),t.paths.push(c.resource.path);if(i.forEach(c=>{if(e.portalItem){const h=e.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}}),o.length===0)return;const a=await Zf(o);Qt(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new U("save:resources","Failed to save one or more resources",{errors:l})}async function oue(t,e){var s,n;const r={...e??{},compress:t.compress},i=await uu(t.resource.portalItem.addResource(t.resource,t.content,r));if(i.ok!==!0)throw(s=t.error)==null||s.call(t,i.error),i.error;(n=t.finish)==null||n.call(t,t.resource)}async function e1t(t,e){var i,s;const r=await uu(t.resource.update(t.content,e));if(r.ok!==!0)throw(i=t.error)==null||i.call(t,r.error),r.error;(s=t.finish)==null||s.call(t,t.resource)}const TAe="esri.layers.mixins.SceneService",jx=Q.getLogger(TAe),t1t=t=>{let e=class extends t{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=GH(async(r,i,s)=>{switch(r){case $S.SAVE:return this._save(i);case $S.SAVE_AS:return this._saveAs(s,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return Ge.fromJSON(r.spatialReference);{const i=r.store,s=i.indexCRS||i.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new Ge(n):null}}readFullExtent(r,i,s){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return _r.fromJSON(a,s)}const n=i.store,o=this._readSpatialReference(i);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<sV)?null:new _r({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},s=r.split(".");return s.length>=2&&(i.major=parseInt(s[0],10),i.minor=parseInt(s[1],10)),i}readVersion(r,i){const s=i.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return D0e(this.url,i.name);let n=i.name;if(!n&&this.url){const o=Ow(this.url);o!=null&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),J5(n)}set url(r){const i=N0e({layer:this,url:r,nonStandardUrlAllowed:!1,logger:jx});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){F0e(this,r,"layers",i,n)}get parsedUrl(){const r=this._get("url"),i=_o(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=Hvt(this.parsedUrl.path,this.rootNode,r,this.apiKey,jx,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){var i,s,n;if((r==null?void 0:r.type)==="page"){const o=r.rootIndex%r.pageSize,a=(s=(i=r.rootPage)==null?void 0:i.nodes)==null?void 0:s[o];if(a==null||a.obb==null||a.obb.center==null||a.obb.halfSize==null)throw new U("sceneservice:invalid-node-page","Invalid node page.");if(a.obb.center[0]<sV||this.fullExtent==null||this.fullExtent.hasZ)return;const l=a.obb.halfSize,c=a.obb.center[2],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-h,this.fullExtent.zmax=c+h}else if((r==null?void 0:r.type)==="node"){const o=(n=r.rootNode)==null?void 0:n.mbs;if(!Array.isArray(o)||o.length!==4||o[0]<sV)return;const a=o[2],l=o[3],{fullExtent:c}=this;c&&(c.zmin=a-l,c.zmax=a+l)}}async _fetchService(r){if(this.url==null)throw new U("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await Fr(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){var o;const i=await Fr(((o=this.parsedUrl)==null?void 0:o.path)??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=i.data;this.read(n,this._getServiceContext()),this.validateLayer(n)}async _fetchVoxelServiceLayer(r){var s;const i=(await Fr(((s=this.parsedUrl)==null?void 0:s.path)+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,this._getServiceContext()),this.validateLayer(i)}_getServiceContext(){var r;return{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,s){r.typeKeywords||(r.typeKeywords=[]);const n=i.getTypeKeywords();for(const o of n)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===tO.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){var c;const s={...aue,...i};let n=fb.from(r);n||(jx.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new U("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||qn.getDefault();await this._ensureLoadBeforeSave(),n.type=l$,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,tO.newItem),await o.signIn(),await((c=o.user)==null?void 0:c.addItem({item:n,folder:s&&s.folder,data:l})),await nue(this.resourceReferences,a,null),this.portalItem=n,sue(a),a.portalItem=n,n}async _save(r){const i={...aue,...r};if(!this.portalItem)throw jx.error("_save(): requires the .portalItem property to be set"),new U("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(this.portalItem.type!==l$)throw jx.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+l$),new U("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${l$}"`);await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&_o(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||qn.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(n,s,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,tO.existingItem),await this.portalItem.update({data:n}),await nue(this.resourceReferences,s,null),sue(s),this.portalItem}async _validateAgainstJSONSchema(r,i,s){var c,h;let n=((c=i.messages)==null?void 0:c.filter(d=>d.type==="error").map(d=>new U(d.name,d.message,d.details)))??[];(h=s==null?void 0:s.validationOptions)!=null&&h.ignoreUnsupported&&(n=n.filter(d=>d.name!=="layer:unsupported"&&d.name!=="symbol:unsupported"&&d.name!=="symbol-layer:unsupported"&&d.name!=="property:unsupported"&&d.name!=="url:unsupported"&&d.name!=="scenemodification:unsupported"));const o=s==null?void 0:s.validationOptions,a=o==null?void 0:o.enabled,l=Wvt();if(a&&l){const d=(await l()).validate(r,s.portalItemLayerType);if(d.length>0){const f=`Layer item did not validate:
${d.join(`
`)}`;if(jx.error(`_validateAgainstJSONSchema(): ${f}`),o.failPolicy==="throw"){const m=d.map(y=>new U("sceneservice:schema-validation",y)).concat(n);throw new U("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:m})}}}if(n.length>0)throw new U("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([p(fAe)],e.prototype,"id",void 0),u([p({type:Ge})],e.prototype,"spatialReference",void 0),u([Se("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null),u([p({type:_r})],e.prototype,"fullExtent",void 0),u([Se("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null),u([p({readOnly:!0,type:Tw})],e.prototype,"heightModelInfo",void 0),u([p({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0),u([p({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0),u([p({readOnly:!0})],e.prototype,"version",void 0),u([Se("version",["store.version"])],e.prototype,"readVersion",null),u([p({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),u([p({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0),u([p({type:String})],e.prototype,"title",void 0),u([Se("portal-item","title")],e.prototype,"readTitlePortalItem",null),u([Se("service","title",["name"])],e.prototype,"readTitleService",null),u([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0),u([p(uAe)],e.prototype,"url",null),u([De("url")],e.prototype,"writeUrl",null),u([p()],e.prototype,"parsedUrl",null),u([p({readOnly:!0})],e.prototype,"store",void 0),u([p({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],e.prototype,"rootNode",void 0),e=u([R(TAe)],e),e},sV=-1e38;var tO;(function(t){t[t.existingItem=0]="existingItem",t[t.newItem=1]="newItem"})(tO||(tO={}));const l$="Scene Service",aue={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var $S;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})($S||($S={}));const r1t={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};let Cg=class extends de{constructor(){super(...arguments),this.type=null}};u([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Cg.prototype,"type",void 0),Cg=u([R("esri.layers.support.FeatureReduction")],Cg);var Nj;let iD=Nj=class extends Cg{constructor(t){super(t),this.type="selection"}clone(){return new Nj}};u([p({type:["selection"]})],iD.prototype,"type",void 0),iD=Nj=u([R("esri.layers.support.FeatureReductionSelection")],iD);const Fj=iD;async function i1t(t,e){const{WhereClause:r}=await ae(()=>import("./WhereClause-47630fa1.js").then(i=>i.W),["assets/WhereClause-47630fa1.js","assets/executionError-c92d3b85.js"]);return r.create(t,e)}function s1t(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}var Uj;let R1=Uj=class extends de{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new Uj({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([p({type:String,json:{write:!0}})],R1.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],R1.prototype,"name",void 0),u([p({type:["boolean","date","number","string"],json:{write:!0}})],R1.prototype,"returnType",void 0),u([p({type:String,json:{write:!0}})],R1.prototype,"title",void 0),R1=Uj=u([R("esri.form.ExpressionInfo")],R1);const n1t=R1;let P1=class extends de{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([p({type:String,json:{write:!0}})],P1.prototype,"description",void 0),u([p({type:String,json:{write:!0}})],P1.prototype,"label",void 0),u([p()],P1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],P1.prototype,"visibilityExpression",void 0),P1=u([R("esri.form.elements.Element")],P1);const LS=P1;var Vj;let sD=Vj=class extends de{constructor(t){super(t),this.type=null}clone(){return new Vj({type:this.type})}};u([p({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],sD.prototype,"type",void 0),sD=Vj=u([R("esri.form.elements.inputs.AttachmentInput")],sD);const o1t=sD;var zj;let M1=zj=class extends LS{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new zj({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([p({type:String,json:{write:!0}})],M1.prototype,"attachmentKeyword",void 0),u([p({type:Boolean,json:{write:!0}})],M1.prototype,"editable",void 0),u([p({type:o1t,json:{read:{source:"inputType"},write:{target:"inputType"}}})],M1.prototype,"input",void 0),u([p({type:["attachment"],json:{read:!1,write:!0}})],M1.prototype,"type",void 0),M1=zj=u([R("esri.form.elements.AttachmentElement")],M1);const lue=M1;let nD=class extends de{constructor(e){super(e),this.type=null}};u([p()],nD.prototype,"type",void 0),nD=u([R("esri.form.elements.inputs.Input")],nD);const gE=nD;let Q3=class extends gE{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([p({type:Number,json:{write:!0}})],Q3.prototype,"maxLength",void 0),u([p({type:Number,json:{write:!0}})],Q3.prototype,"minLength",void 0),Q3=u([R("esri.form.elements.inputs.TextInput")],Q3);const hJ=Q3;var kj;let oD=kj=class extends hJ{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new kj({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],oD.prototype,"type",void 0),oD=kj=u([R("esri.form.elements.inputs.BarcodeScannerInput")],oD);const a1t=oD;var Bj;let $T=Bj=class extends gE{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new Bj({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([p({type:String,json:{write:!0}})],$T.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],$T.prototype,"showNoValueOption",void 0),u([p({type:["combo-box"],json:{read:!1,write:!0}})],$T.prototype,"type",void 0),$T=Bj=u([R("esri.form.elements.inputs.ComboBoxInput")],$T);const l1t=$T;var Gj;function cue(t){return t!=null?new Date(t):null}function uue(t){return t?t.getTime():null}let yd=Gj=class extends gE{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return cue(e.max)}writeMax(t,e){e.max=uue(t)}readMin(t,e){return cue(e.min)}writeMin(t,e){e.min=uue(t)}clone(){return new Gj({includeTime:this.includeTime,max:this.max,min:this.min})}};u([p({type:Boolean,json:{write:!0}})],yd.prototype,"includeTime",void 0),u([p({type:Date,json:{type:Number,write:!0}})],yd.prototype,"max",void 0),u([Se("max")],yd.prototype,"readMax",null),u([De("max")],yd.prototype,"writeMax",null),u([p({type:Date,json:{type:Number,write:!0}})],yd.prototype,"min",void 0),u([Se("min")],yd.prototype,"readMin",null),u([De("min")],yd.prototype,"writeMin",null),u([p({type:["datetime-picker"],json:{read:!1,write:!0}})],yd.prototype,"type",void 0),yd=Gj=u([R("esri.form.elements.inputs.DateTimePickerInput")],yd);const c1t=yd;var jj;let LT=jj=class extends gE{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new jj({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([p({type:String,json:{write:!0}})],LT.prototype,"noValueOptionLabel",void 0),u([p({type:Boolean,json:{write:!0}})],LT.prototype,"showNoValueOption",void 0),u([p({type:["radio-buttons"],json:{read:!1,write:!0}})],LT.prototype,"type",void 0),LT=jj=u([R("esri.form.elements.inputs.RadioButtonsInput")],LT);const u1t=LT;var Hj;let DT=Hj=class extends gE{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Hj({offValue:this.offValue,onValue:this.onValue})}};u([p({type:[String,Number],json:{write:!0}})],DT.prototype,"offValue",void 0),u([p({type:[String,Number],json:{write:!0}})],DT.prototype,"onValue",void 0),u([p({type:["switch"],json:{read:!1,write:!0}})],DT.prototype,"type",void 0),DT=Hj=u([R("esri.form.elements.inputs.SwitchInput")],DT);const h1t=DT;var qj;let aD=qj=class extends hJ{constructor(t){super(t),this.type="text-area"}clone(){return new qj({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-area"],json:{read:!1,write:!0}})],aD.prototype,"type",void 0),aD=qj=u([R("esri.form.elements.inputs.TextAreaInput")],aD);const d1t=aD;var Wj;let lD=Wj=class extends hJ{constructor(t){super(t),this.type="text-box"}clone(){return new Wj({maxLength:this.maxLength,minLength:this.minLength})}};u([p({type:["text-box"],json:{read:!1,write:!0}})],lD.prototype,"type",void 0),lD=Wj=u([R("esri.form.elements.inputs.TextBoxInput")],lD);const p1t=lD,f1t={base:gE,key:"type",typeMap:{"barcode-scanner":a1t,"combo-box":l1t,"datetime-picker":c1t,"radio-buttons":u1t,switch:h1t,"text-area":d1t,"text-box":p1t}};var Zj;const SAe="esri.form.elements.FieldElement",hue=Q.getLogger(SAe);let ku=Zj=class extends LS{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return Nd(hue,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){Nd(hue,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new Zj({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([p({types:wwe,json:{read:{reader:_X},write:!0}})],ku.prototype,"domain",void 0),u([p({type:Boolean,json:{write:!0}})],ku.prototype,"editable",null),u([p({type:String,json:{write:!0}})],ku.prototype,"editableExpression",void 0),u([p({type:String,json:{write:!0}})],ku.prototype,"fieldName",void 0),u([p({type:String,json:{write:!0}})],ku.prototype,"hint",void 0),u([p({types:f1t,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ku.prototype,"input",void 0),u([p({type:String,json:{write:!0}})],ku.prototype,"requiredExpression",void 0),u([p({type:String,json:{read:!1,write:!0}})],ku.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],ku.prototype,"valueExpression",void 0),ku=Zj=u([R(SAe)],ku);const due=ku;var Xj;let Hm=Xj=class extends LS{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Xj({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:K(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([p({type:Number,json:{write:!0}})],Hm.prototype,"displayCount",void 0),u([p({type:["list"],json:{write:!0}})],Hm.prototype,"displayType",void 0),u([p({type:String,json:{write:!0}})],Hm.prototype,"editableExpression",void 0),u([p({type:[oW],json:{write:!0}})],Hm.prototype,"orderByFields",void 0),u([p({type:Number,json:{write:!0}})],Hm.prototype,"relationshipId",void 0),u([p({type:["relationship"],json:{read:!1,write:!0}})],Hm.prototype,"type",void 0),Hm=Xj=u([R("esri.form.elements.RelationshipElement")],Hm);const pue=Hm;function EAe(t){return{typesWithGroup:{base:LS,key:"type",typeMap:{attachment:lue,field:due,group:t,relationship:pue}},typesWithoutGroup:{base:LS,key:"type",typeMap:{attachment:lue,field:due,relationship:pue}}}}function CAe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function AAe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>s.toJSON())}function OAe(t,e,r=!0){return t?t.map(i=>tp(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var Yj;let nf=Yj=class extends LS{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return OAe(t,nV,!1)}readElements(t,e){return CAe(e.formElements,nV,!1)}writeElements(t,e){e.formElements=AAe(t,nV,!1)}clone(){return new Yj({description:this.description,elements:K(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([p({json:{write:!0}})],nf.prototype,"elements",void 0),u([yr("elements")],nf.prototype,"castElements",null),u([Se("elements",["formElements"])],nf.prototype,"readElements",null),u([De("elements")],nf.prototype,"writeElements",null),u([p({type:["collapsed","expanded"],json:{write:!0}})],nf.prototype,"initialState",void 0),u([p({type:String,json:{read:!1,write:!0}})],nf.prototype,"type",void 0),nf=Yj=u([R("esri.form.elements.GroupElement")],nf);const nV=EAe(nf),m1t=nf;var Jj;const oV=EAe(m1t);let _d=Jj=class extends de{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return OAe(t,oV)}readElements(t,e){return CAe(e.formElements,oV)}writeElements(t,e){e.formElements=AAe(t,oV)}clone(){return new Jj({description:this.description,expressionInfos:K(this.expressionInfos),elements:K(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([p({type:String,json:{write:!0}})],_d.prototype,"description",void 0),u([p({json:{write:!0}})],_d.prototype,"elements",void 0),u([yr("elements")],_d.prototype,"castElements",null),u([Se("elements",["formElements"])],_d.prototype,"readElements",null),u([De("elements")],_d.prototype,"writeElements",null),u([p({type:[n1t],json:{write:!0}})],_d.prototype,"expressionInfos",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],_d.prototype,"preserveFieldValuesWhenHidden",void 0),u([p({type:String,json:{write:!0}})],_d.prototype,"title",void 0),_d=Jj=u([R("esri.form.FormTemplate")],_d);const g1t=_d;function fue(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const s of i)s.length>2&&(s[2]*=r)}function y1t(t,e,r){if(!t&&!e||!r)return;const i=pO(r);mue(t,r,i),mue(e,r,i)}function mue(t,e,r){if(t)for(const i of t)_1t(i.geometry,e,r)}function _1t(t,e,r){if(t==null||!t.spatialReference||Tn(t.spatialReference,e))return;const i=pO(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)fue(t,t.rings,i);else if("paths"in t)fue(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=i)}}function gue(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=Rge(r.geometryType,e,t.outSpatialReference);if(i!=null)for(const s of r.features)i(s.geometry)}var Qj;const Kj=new Rr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Ao=Qj=class extends de{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){const r=Ge.fromJSON(e.spatialReference),i=[];for(let s=0;s<t.length;s++){const n=t[s],o=hu.fromJSON(n),a=n.geometry&&n.geometry.spatialReference;o.geometry==null||a||(o.geometry.spatialReference=r);const l=n.aggregateGeometries,c=o.aggregateGeometries;if(l&&c!=null)for(const h in c){const d=c[h],f=l[h],m=f==null?void 0:f.spatialReference;d==null||m||(d.spatialReference=r)}i.push(o)}return i}writeGeometryType(t,e,r,i){if(t)return void Kj.write(t,e,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&n.geometry!=null)return void Kj.write(n.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=g_(t);return i&&!r&&e.spatialReference&&(i.spatialReference=Ge.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&i.geometry!=null&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new Qj(this.cloneProperties())}cloneProperties(){return K({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const s=t&&t[r];i.geometry=s&&s.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,s]}=t,n=c=>Math.round((c-i)/e),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){var f,m;const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=y=>y*n+i,l=y=>s-y*o;let c=null,h=null;if(this.hasZ&&((f=r==null?void 0:r.scale)==null?void 0:f[2])!=null){const{translate:[,,y],scale:[,,_]}=r;c=v=>v*_+y}if(this.hasM&&((m=r==null?void 0:r.scale)==null?void 0:m[3])!=null){const{translate:[,,,y],scale:[,,,_]}=r;h=v=>v==null?v:v*_+y}const d=this._getHydrationFunction(t,a,l,c,h);for(const{geometry:y}of e)y!=null&&d&&d(y);return this.transform=null,this}_quantizePoints(t,e,r){let i,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=r(l[1]);c===i&&h===s||(n.push([c-i,h-s]),i=c,s=h)}else i=e(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const s=m2(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,r);c&&n.push(c)}return n.length>0?(m2(i)?i.rings=n:i.paths=n,i):null}:t==="multipoint"?i=>{const s=this._quantizePoints(i.points,e,r);return s&&s.length>0?(i.points=s,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r,i,s){return t==="point"?n=>{n.x=e(n.x),n.y=r(n.y),i&&(n.z=i(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=m2(n)?n.rings:n.paths;let a,l;for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const y=d[f];f>0?(a+=y[0],l+=y[1]):(a=y[0],l=y[1]),y[0]=e(a),y[1]=r(l)}}if(i&&s)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const y=d[f];y[2]=i(y[2]),y[3]=s(y[3])}}else if(i)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const y=d[f];y[2]=i(y[2])}}else if(s)for(let c=0,h=o.length;c<h;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const y=d[f];y[2]=s(y[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=r(n.ymin),n.xmax=e(n.xmax),n.ymax=r(n.ymax),i&&n.zmax!=null&&n.zmin!=null&&(n.zmax=i(n.zmax),n.zmin=i(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,h=o.length;c<h;c++){const d=o[c];c>0?(a+=d[0],l+=d[1]):(a=d[0],l=d[1]),d[0]=e(a),d[1]=r(l)}if(i&&s)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=i(d[2]),d[3]=s(d[3])}else if(i)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=i(d[2])}else if(s)for(let c=0,h=o.length;c<h;c++){const d=o[c];d[2]=s(d[2])}}:null}};u([p({type:String,json:{write:!0}})],Ao.prototype,"displayFieldName",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ao.prototype,"exceededTransferLimit",void 0),u([p({type:[hu],json:{write:!0}})],Ao.prototype,"features",void 0),u([Se("features")],Ao.prototype,"readFeatures",null),u([p({type:[$F],json:{write:!0}})],Ao.prototype,"fields",void 0),u([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:Kj.read}}})],Ao.prototype,"geometryType",void 0),u([De("geometryType")],Ao.prototype,"writeGeometryType",null),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ao.prototype,"hasM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ao.prototype,"hasZ",void 0),u([p({types:gw,json:{write:!0}})],Ao.prototype,"queryGeometry",void 0),u([Se("queryGeometry")],Ao.prototype,"readQueryGeometry",null),u([p({type:Ge,json:{write:!0}})],Ao.prototype,"spatialReference",void 0),u([De("spatialReference")],Ao.prototype,"writeSpatialReference",null),u([p({json:{write:!0}})],Ao.prototype,"transform",void 0),Ao=Qj=u([R("esri.rest.support.FeatureSet")],Ao),Ao.prototype.toJSON.isDefaultToJSON=!0;const RAe=Ao;let v1t=0;const PAe="esri.layers.graphics.sources.MemorySource",aV=Q.getLogger(PAe);let eg=class extends Pg.LoadableMixin(t5(M5(Mt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var r;const e=(r=this.layer)==null?void 0:r.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);gue(e,this.layer.spatialReference,i);const s=RAe.fromJSON(i);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new U("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return gue(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:_r.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new U("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[r]!=null?h.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const d=o(h);d!=null&&s.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const d=o(h);d!=null&&a.set(d,h)}}y1t(i?i.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:n,deletes:s});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const i=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||i.push(s.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const s=e.get(i.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new U("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const n=this;return{features:i,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=r.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){var e,r;return((e=this.layer)==null?void 0:e.geometryType)??((r=this.sourceJSON)==null?void 0:r.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),s=(v1t++).toString();return i?{uid:s,geometry:i.toJSON(),attributes:r}:{uid:s,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return r==null?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?Zd.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await pge("MemorySourceWorker",{strategy:oe("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:s,hasM:n,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{aV.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:r&&r.map(m=>m.toJSON()),geometryType:zQ.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},d=await this._connection.invoke("load",h,{signal:e});for(const m of d.warnings)aV.warn(m.message,{layer:this.layer,warning:m});d.featureErrors.length&&aV.warn(`Encountered ${d.featureErrors.length} validation errors while loading features`,d.featureErrors);const f=d.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=zQ.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(d.assignedObjectIds)}};u([YH({Type:hu,ensureType:qs(hu)})],eg.prototype,"itemType",void 0),u([p()],eg.prototype,"type",void 0),u([p({constructOnly:!0})],eg.prototype,"layer",void 0),u([p({readOnly:!0})],eg.prototype,"_workerGeometryType",null),u([p()],eg.prototype,"sourceJSON",void 0),eg=u([R(PAe)],eg);const yue={read:{reader:oY},write:{allowNull:!0,writer:aY}},MAe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([p({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([p({json:{read:!1,write:!1,origins:{"web-map":yue,"portal-item":yue}}})],e.prototype,"effect",void 0),e=u([R("esri.layers.mixins.BlendLayer")],e),e},b1t=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([p({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([R("esri.layers.mixins.CustomParametersMixin")],e),e};var eH;let NT=eH=class extends de{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new eH({mapLayerId:t,gdbVersion:e})}};u([et({mapLayer:"map-layer"})],NT.prototype,"type",void 0),u([p({type:Ji,json:{write:!0}})],NT.prototype,"mapLayerId",void 0),u([p({type:String,json:{write:!0}})],NT.prototype,"gdbVersion",void 0),NT=eH=u([R("esri.layers.support.source.MapLayerSource")],NT);var tH;let qm=tH=class extends de{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:s};return new tH(n)}};u([et({queryTable:"query-table"})],qm.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],qm.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],qm.prototype,"query",void 0),u([p({type:String,json:{write:!0}})],qm.prototype,"oidFields",void 0),u([p({type:Ge,json:{write:!0}})],qm.prototype,"spatialReference",void 0),u([et(Xpe)],qm.prototype,"geometryType",void 0),qm=tH=u([R("esri.layers.support.source.QueryTableDataSource")],qm);var rH;let FT=rH=class extends de{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new rH({workspaceId:t,dataSourceName:e})}};u([et({raster:"raster"})],FT.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],FT.prototype,"dataSourceName",void 0),u([p({type:String,json:{write:!0}})],FT.prototype,"workspaceId",void 0),FT=rH=u([R("esri.layers.support.source.RasterDataSource")],FT);var iH;let I1=iH=class extends de{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new iH({workspaceId:t,gdbVersion:e,dataSourceName:r})}};u([et({table:"table"})],I1.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],I1.prototype,"workspaceId",void 0),u([p({type:String,json:{write:!0}})],I1.prototype,"gdbVersion",void 0),u([p({type:String,json:{write:!0}})],I1.prototype,"dataSourceName",void 0),I1=iH=u([R("esri.layers.support.source.TableDataSource")],I1);var sH,nH;const w1t=Wa()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Vc=sH=class extends de{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return _ue()(t,e,r)}castLeftTableSource(t){return tp(oH(),t)}readRightTableSource(t,e,r){return _ue()(t,e,r)}castRightTableSource(t){return tp(oH(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:s};return new sH(n)}};u([et({joinTable:"join-table"})],Vc.prototype,"type",void 0),u([p({type:String,json:{write:!0}})],Vc.prototype,"leftTableKey",void 0),u([p({type:String,json:{write:!0}})],Vc.prototype,"rightTableKey",void 0),u([p({json:{write:!0}})],Vc.prototype,"leftTableSource",void 0),u([Se("leftTableSource")],Vc.prototype,"readLeftTableSource",null),u([yr("leftTableSource")],Vc.prototype,"castLeftTableSource",null),u([p({json:{write:!0}})],Vc.prototype,"rightTableSource",void 0),u([Se("rightTableSource")],Vc.prototype,"readRightTableSource",null),u([yr("rightTableSource")],Vc.prototype,"castRightTableSource",null),u([et(w1t)],Vc.prototype,"joinType",void 0),Vc=sH=u([R("esri.layers.support.source.JoinTableDataSource")],Vc);let lV=null;function _ue(){return lV||(lV=VS({types:oH()})),lV}let cV=null;function oH(){return cV||(cV={key:"type",base:null,typeMap:{"data-layer":Rd,"map-layer":NT}}),cV}const x1t={key:"type",base:null,typeMap:{"join-table":Vc,"query-table":qm,raster:FT,table:I1}};let Rd=nH=class extends de{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new nH({fields:t,dataSource:e})}};u([et({dataLayer:"data-layer"})],Rd.prototype,"type",void 0),u([p({type:[$F],json:{write:!0}})],Rd.prototype,"fields",void 0),u([p({types:x1t,json:{write:!0}})],Rd.prototype,"dataSource",void 0),Rd=nH=u([R("esri.layers.support.source.DataLayerSource")],Rd),Rd.from=qs(Rd);let $1=class extends ji(de){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],$1.prototype,"onFields",void 0),u([p({type:String,json:{write:!0}})],$1.prototype,"operator",void 0),u([p({type:String,json:{write:!0}})],$1.prototype,"searchTerm",void 0),u([p({type:String,json:{write:!0}})],$1.prototype,"searchType",void 0),$1=u([R("esri.rest.support.FullTextSearch")],$1);const T1t=$1;var aH;const vue=new Rr({upperLeft:"upper-left",lowerLeft:"lower-left"});let L1=aH=class extends de{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new aH(K({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([p({type:_r,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],L1.prototype,"extent",void 0),u([p({type:["view","edit"],json:{write:!0}})],L1.prototype,"mode",void 0),u([p({type:String,json:{read:vue.read,write:vue.write}})],L1.prototype,"originPosition",void 0),u([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],L1.prototype,"tolerance",void 0),L1=aH=u([R("esri.rest.support.QuantizationParameters")],L1);const S1t=L1;var lH;const bue=new Rr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let vd=lH=class extends de{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=K(t))}clone(){return new lH({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:K(this.statisticParameters)})}};u([p({type:Number,json:{write:!0}})],vd.prototype,"maxPointCount",void 0),u([p({type:Number,json:{write:!0}})],vd.prototype,"maxRecordCount",void 0),u([p({type:Number,json:{write:!0}})],vd.prototype,"maxVertexCount",void 0),u([p({type:String,json:{write:!0}})],vd.prototype,"onStatisticField",void 0),u([p({type:String,json:{write:!0}})],vd.prototype,"outStatisticFieldName",void 0),u([p({type:String,json:{read:{source:"statisticType",reader:bue.read},write:{target:"statisticType",writer:bue.write}}})],vd.prototype,"statisticType",void 0),u([p({type:Object})],vd.prototype,"statisticParameters",void 0),u([De("statisticParameters")],vd.prototype,"writeStatisticParameters",null),vd=lH=u([R("esri.rest.support.StatisticDefinition")],vd);const E1t=vd;var F2;const C1t=new Rr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),A1t=new Rr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let It=F2=class extends de{static from(t){return $b(F2,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const s=t[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new F2(K({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};It.MAX_MAX_RECORD_COUNT_FACTOR=5,u([p({json:{write:!0}})],It.prototype,"aggregateIds",void 0),u([p({type:Boolean,json:{write:!0}})],It.prototype,"cacheHint",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"compactGeometryEnabled",void 0),u([p({json:{write:!0}})],It.prototype,"datumTransformation",void 0),u([yr("datumTransformation")],It.prototype,"castDatumTransformation",null),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"defaultSpatialReferenceEnabled",void 0),u([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],It.prototype,"distance",void 0),u([p({type:Rd,json:{write:!0}})],It.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"formatOf3DObjects",void 0),u([p({type:[T1t],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],It.prototype,"fullText",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"gdbVersion",void 0),u([p({types:gw,json:{read:g_,write:!0}})],It.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],It.prototype,"geometryPrecision",void 0),u([p({type:[String],json:{write:!0}})],It.prototype,"groupByFieldsForStatistics",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"having",void 0),u([p({type:Date})],It.prototype,"historicMoment",void 0),u([De("historicMoment")],It.prototype,"writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],It.prototype,"maxAllowableOffset",void 0),u([p({type:Number,cast:t=>t<1?1:t>F2.MAX_MAX_RECORD_COUNT_FACTOR?F2.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],It.prototype,"maxRecordCountFactor",void 0),u([p({type:["xyFootprint"],json:{write:!0}})],It.prototype,"multipatchOption",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],It.prototype,"num",void 0),u([p({json:{write:!0}})],It.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],It.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],It.prototype,"outFields",void 0),u([p({type:Ge,json:{name:"outSR",write:!0}})],It.prototype,"outSpatialReference",void 0),u([p({type:[E1t],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],It.prototype,"outStatistics",void 0),u([p({json:{write:!0}})],It.prototype,"parameterValues",void 0),u([De("parameterValues")],It.prototype,"writeParameterValues",null),u([p({type:ct,json:{write:!0}})],It.prototype,"pixelSize",void 0),u([p({type:S1t,json:{write:!0}})],It.prototype,"quantizationParameters",void 0),u([p({type:[Object],json:{write:!0}})],It.prototype,"rangeValues",void 0),u([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],It.prototype,"relationParameter",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"resultType",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnCentroid",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnDistinctValues",void 0),u([p({type:Boolean,json:{default:!0,write:!0}})],It.prototype,"returnExceededLimitFeatures",void 0),u([p({type:Boolean,json:{write:!0}})],It.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnQueryGeometry",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],It.prototype,"returnZ",void 0),u([p({type:Ge,json:{write:!0}})],It.prototype,"sourceSpatialReference",void 0),u([et(C1t,{ignoreUnknown:!1,name:"spatialRel"})],It.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],It.prototype,"start",void 0),u([De("start"),De("num")],It.prototype,"writeStart",null),u([p({type:String,json:{write:!0}})],It.prototype,"sqlFormat",void 0),u([p({type:String,json:{write:!0}})],It.prototype,"text",void 0),u([p({type:em,json:{write:!0}})],It.prototype,"timeExtent",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],It.prototype,"timeReferenceUnknownClient",void 0),u([et(A1t,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],It.prototype,"units",void 0),u([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],It.prototype,"where",void 0),u([De("where")],It.prototype,"writeWhere",null),It=F2=u([R("esri.rest.support.Query")],It);const Z_=It;var cH;const uV=new Rr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),hV=new Rr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let rf=cH=class extends de{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Z_({geometry:K(r),objectIds:K(n),spatialRelationship:i,timeExtent:K(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new cH({geometry:K(e),objectIds:K(s),spatialRelationship:r,timeExtent:K(i),where:t,units:n,distance:o})}};u([p({type:String,json:{write:!0}})],rf.prototype,"where",void 0),u([p({types:gw,json:{write:!0}})],rf.prototype,"geometry",void 0),u([p({type:uV.apiValues,json:{name:"spatialRel",read:{reader:uV.read},write:{allowNull:!1,writer:uV.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],rf.prototype,"spatialRelationship",void 0),u([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],rf.prototype,"distance",void 0),u([p({type:[Number],json:{write:!0}})],rf.prototype,"objectIds",void 0),u([p({type:hV.apiValues,json:{read:hV.read,write:{writer:hV.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],rf.prototype,"units",void 0),u([p({type:em,json:{write:!0}})],rf.prototype,"timeExtent",void 0),rf=cH=u([R("esri.layers.support.FeatureFilter")],rf);const O1t=rf;var uH;const wue={read:{reader:oY},write:{writer:aY,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},xue={read:{reader:oY},write:{writer:aY,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Tue={name:"showExcludedLabels",default:!0};let D1=uH=class extends de{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var i,s;const r=super.write(t,e);if(e!=null&&e.origin){if(r.filter){const n=Object.keys(r.filter);if(n.length>1||n[0]!=="where")return(i=e.messages)==null||i.push(new U("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return(s=e.messages)==null||s.push(new U("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new uH({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([p({type:O1t,json:{write:{allowNull:!0,writer(t,e,r,i){const s=t==null?void 0:t.write({},i);s&&Object.keys(s).length!==0?Ha(r,s,e):Ha(r,null,e)}}}})],D1.prototype,"filter",void 0),u([p({json:{write:!0,origins:{"web-map":wue,"portal-item":wue}}})],D1.prototype,"includedEffect",void 0),u([p({json:{write:!0,origins:{"web-map":xue,"portal-item":xue}}})],D1.prototype,"excludedEffect",void 0),u([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Tue,"portal-item":Tue}}})],D1.prototype,"excludedLabelsVisible",void 0),D1=uH=u([R("esri.layers.support.FeatureEffect")],D1);const R1t=D1,Sue={write:{allowNull:!0}},P1t=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([p({type:R1t,json:{origins:{"web-map":Sue,"portal-item":Sue}}})],e.prototype,"featureEffect",void 0),e=u([R("esri.layers.mixins.FeatureEffectLayer")],e),e};let Wm=class extends ji(de){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([p()],Wm.prototype,"creatorField",void 0),u([p()],Wm.prototype,"creationDateField",void 0),u([p()],Wm.prototype,"editorField",void 0),u([p()],Wm.prototype,"editDateField",void 0),u([p()],Wm.prototype,"realm",void 0),u([p({type:lS})],Wm.prototype,"dateFieldsTimeReference",void 0),Wm=u([R("esri.layers.support.EditFieldsInfo")],Wm);const M1t=Wm;let of=class extends ji(de){constructor(e){super(e)}};u([p({constructOnly:!0,json:{write:!0}})],of.prototype,"name",void 0),u([p({constructOnly:!0,json:{write:!0}})],of.prototype,"fields",void 0),u([p({constructOnly:!0,json:{write:!0}})],of.prototype,"isAscending",void 0),u([p({constructOnly:!0,json:{write:!0}})],of.prototype,"indexType",void 0),u([p({constructOnly:!0,json:{write:!0}})],of.prototype,"isUnique",void 0),u([p({constructOnly:!0,json:{write:!0}})],of.prototype,"description",void 0),of=u([R("esri.layers.support.FeatureIndex")],of);var hH;let Oo=hH=class extends de{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new hH(K({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([p({type:[String],json:{write:!0}})],Oo.prototype,"attachmentTypes",void 0),u([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Oo.prototype,"attachmentsWhere",void 0),u([p({type:Boolean,json:{write:!0}})],Oo.prototype,"cacheHint",void 0),u([p({type:[String],json:{write:!0}})],Oo.prototype,"keywords",void 0),u([p({type:[Number],json:{write:!0}})],Oo.prototype,"globalIds",void 0),u([p({json:{write:!0}})],Oo.prototype,"name",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Oo.prototype,"num",void 0),u([p({type:[Number],json:{write:!0}})],Oo.prototype,"objectIds",void 0),u([p({type:Boolean,json:{default:!1,write:!0}})],Oo.prototype,"returnMetadata",void 0),u([p({type:[Number],json:{write:!0}})],Oo.prototype,"size",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Oo.prototype,"start",void 0),u([De("start"),De("num")],Oo.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Oo.prototype,"where",void 0),Oo=hH=u([R("esri.rest.support.AttachmentQuery")],Oo),Oo.from=qs(Oo);const I1t=Oo;var dH;let Ns=dH=class extends de{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new dH(K({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([p({type:Boolean,json:{write:!0}})],Ns.prototype,"cacheHint",void 0),u([p({type:Rd,json:{write:!0}})],Ns.prototype,"dynamicDataSource",void 0),u([p({type:String,json:{write:!0}})],Ns.prototype,"gdbVersion",void 0),u([p({type:Number,json:{write:!0}})],Ns.prototype,"geometryPrecision",void 0),u([p({type:Date})],Ns.prototype,"historicMoment",void 0),u([De("historicMoment")],Ns.prototype,"_writeHistoricMoment",null),u([p({type:Number,json:{write:!0}})],Ns.prototype,"maxAllowableOffset",void 0),u([p({type:[Number],json:{write:!0}})],Ns.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],Ns.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],Ns.prototype,"outFields",void 0),u([p({type:Ge,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ns.prototype,"outSpatialReference",void 0),u([p({json:{write:!0}})],Ns.prototype,"relationshipId",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],Ns.prototype,"start",void 0),u([De("start"),De("num")],Ns.prototype,"writeStart",null),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ns.prototype,"num",void 0),u([p({json:{write:!0}})],Ns.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ns.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ns.prototype,"returnZ",void 0),u([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ns.prototype,"where",void 0),Ns=dH=u([R("esri.rest.support.RelationshipQuery")],Ns),Ns.from=qs(Ns);const dJ=Ns,Y6t=Object.freeze(Object.defineProperty({__proto__:null,default:dJ},Symbol.toStringTag,{value:"Module"})),pH=new Rr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function $1t(t,e,r,i){const s=await X_(t);if(await pJ(t,e,i),!s.addAttachment)throw new U(i,"Layer source does not support addAttachment capability");return s.addAttachment(e,r)}function pJ(t,e,r){const{attributes:i}=e,{objectIdField:s}=t;return t.get("capabilities.data.supportsAttachment")?e?i?s&&i[s]?Promise.resolve():Promise.reject(new U(r,`feature is missing the identifying attribute ${s}`)):Promise.reject(new U(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new U(r,"A feature is required to add/delete/update attachments")):Promise.reject(new U(r,"this layer doesn't support attachments"))}async function L1t(t,e,r,i,s){const n=await X_(t);if(await pJ(t,e,s),!n.updateAttachment)throw new U(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,r,i)}async function D1t(t,e,r){const{applyEdits:i}=await ae(()=>import("./editingSupport-39e328b9.js"),["assets/editingSupport-39e328b9.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js"]),s=await t.load();return i(s,s.source,e,r)}async function N1t(t,e,r){const{uploadAssets:i}=await ae(()=>import("./editingSupport-39e328b9.js"),["assets/editingSupport-39e328b9.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js"]),s=await t.load();return i(s,s.source,e,r)}async function F1t(t,e,r,i){const s=await X_(t);if(await pJ(t,e,i),!s.deleteAttachments)throw new U(i,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,r)}async function U1t(t,e,r){const i=(await t.load({signal:e==null?void 0:e.signal})).source;if(!i.fetchRecomputedExtents)throw new U(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function V1t(t,e,r,i){var m,y;e=I1t.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new U(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:d,where:f}=e;if(!((y=n==null?void 0:n.operations)!=null&&y.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||d||f))throw new U(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new U(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new U(i,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function z1t(t,e,r,i){const s=await X_(t);if(!s.queryObjectIds)throw new U(i,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Z_.from(e)??t.createQuery(),r)}async function k1t(t,e,r,i){const s=await X_(t);if(!s.queryFeatureCount)throw new U(i,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Z_.from(e)??t.createQuery(),r)}async function B1t(t,e,r,i){const s=await X_(t);if(!s.queryExtent)throw new U(i,"Layer source does not support queryExtent capability");return s.queryExtent(Z_.from(e)??t.createQuery(),r)}async function G1t(t,e,r,i){const s=await X_(t);if(!s.queryRelatedFeatures)throw new U(i,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(dJ.from(e),r)}async function j1t(t,e,r,i){const s=await X_(t);if(!s.queryRelatedFeaturesCount)throw new U(i,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(dJ.from(e),r)}async function H1t(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(i!=null&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await i1t(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function q1t(t){const e=new Z_,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function IAe(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function $Ae(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function W1t(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function X_(t){return(await t.load()).source}async function Z1t(t,e){if(!xr||xr.findCredential(t))return;let r;try{const i=await rpe(t,e);i&&(r=await xr.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=e!=null?e.signal:null;await xr.getCredential(t,{signal:i})}catch{}}async function X1t(t,e){var i;const r=(i=t.parsedUrl)==null?void 0:i.path;r&&Y1t(t)&&await Z1t(r,e)}function Y1t(t){const e=t.editFieldsInfo;return!(!(e!=null&&e.creatorField)&&!(e!=null&&e.editorField))||(t.userHasUpdateItemPrivileges?t.hasUpdateItemRestrictions:!!t.userHasFullEditingPrivileges&&t.hasFullEditingRestrictions)}function J1t(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const dV=VS({types:nge});function fJ(t,e){if(t.defaultSymbol)return t.types&&t.types.length?new aJ({defaultSymbol:dV(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:dV(r.symbol,r,e)}))}):new m6({symbol:dV(t.defaultSymbol,t,e)})}let UT=class extends ji(de){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],UT.prototype,"shapeAreaField",void 0),u([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],UT.prototype,"shapeLengthField",void 0),u([p({type:String,json:{read:t=>iIe.read(t)||sIe.read(t)}})],UT.prototype,"units",void 0),UT=u([R("esri.layers.support.GeometryFieldsInfo")],UT);const Q1t=UT;var fH;let VT=fH=class extends de{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Mt}clone(){return new fH({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([p({type:String,json:{write:!0}})],VT.prototype,"floorField",void 0),u([p({json:{read:!1,write:!1}})],VT.prototype,"viewAllMode",void 0),u([p({json:{read:!1,write:!1}})],VT.prototype,"viewAllLevelIds",void 0),VT=fH=u([R("esri.layers.support.LayerFloorInfo")],VT);const LAe=VT,Eue=new Rr({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Cue=new Rr({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Bu=class extends ji(de){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([p({json:{read:Eue.read,write:Eue.write}})],Bu.prototype,"cardinality",void 0),u([p({json:{read:!0,write:!0}})],Bu.prototype,"composite",void 0),u([p({json:{read:!0,write:!0}})],Bu.prototype,"id",void 0),u([p({json:{read:!0,write:!0}})],Bu.prototype,"keyField",void 0),u([p({json:{read:!0,write:!0}})],Bu.prototype,"keyFieldInRelationshipTable",void 0),u([p({json:{read:!0,write:!0}})],Bu.prototype,"name",void 0),u([p({json:{read:!0,write:!0}})],Bu.prototype,"relatedTableId",void 0),u([p({json:{read:!0,write:!0}})],Bu.prototype,"relationshipTableId",void 0),u([p({json:{read:Cue.read,write:Cue.write}})],Bu.prototype,"role",void 0),Bu=u([R("esri.layers.support.Relationship")],Bu);const K1t=Bu,ebt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function Vt(t,e,r){return!!DAe(t,e,r)}function c$(t,e,r){return DAe(t,e,r)}function DAe(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function tbt(t){var r;const e=(r=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function lP(t,e){var i;const r=(i=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:i.map(s=>s.toLowerCase());return!!(r!=null&&r.includes(e.toLowerCase()))}function NAe(t,e){return{analytics:rbt(t),attachment:ibt(t),data:sbt(t),metadata:nbt(t),operations:obt(t.capabilities,t,e),query:abt(t,e),queryRelated:lbt(t),queryTopFeatures:cbt(t),editing:ubt(t)}}function rbt(t){return{supportsCacheHint:lP(t.advancedQueryCapabilities,"queryAnalytics")}}function ibt(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:lP(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Vt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const s=ebt[i.name];s&&(r[s]=!!i.isEnabled)}),r}function sbt(t){return{isVersioned:Vt(t,"isDataVersioned",!1),supportsAttachment:Vt(t,"hasAttachments",!1),supportsM:Vt(t,"hasM",!1),supportsZ:Vt(t,"hasZ",!1)}}function nbt(t){return{supportsAdvancedFieldProperties:Vt(t,"supportsFieldDescriptionProperty",!1)}}function obt(t,e,r){const i=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=r?Ow(r):null,n=i.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const h=i.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Vt(e,"supportsCalculate",!1),supportsTruncate:Vt(e,"supportsTruncate",!1),supportsValidateSql:Vt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:Vt(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:Vt(d,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Vt(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Vt(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Vt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Vt(e,"supportsAsyncConvert3D",!1)}}function abt(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=oe("mapserver-pbf-version-support"),l=YW(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:Vt(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:Vt(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Vt(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:tbt(r),supportsCentroid:Vt(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Vt(r,"supportsQueryWithDistance",!1),supportsDistinct:Vt(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Vt(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Vt(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Vt(r,"supportsHavingClause",!1),supportsOrderBy:Vt(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Vt(r,"supportsPagination",!1),supportsQuantization:Vt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Vt(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Vt(t,"supportsReturningQueryGeometry",!1),supportsResultType:Vt(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Vt(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Vt(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Vt(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Vt(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Vt(i,"allowOthersToQuery",!0),supportsHistoricMoment:Vt(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:Vt(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Vt(r,"supportsQueryWithCacheHint",!1)||lP(r,"query"),supportsDefaultSpatialReference:Vt(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:Vt(r,"supportsFullTextSearch",!1),maxRecordCountFactor:c$(t,"maxRecordCountFactor",void 0),maxRecordCount:c$(t,"maxRecordCount",void 0),standardMaxRecordCount:c$(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:c$(t,"tileMaxRecordCount",void 0)}}function lbt(t){const e=t.advancedQueryCapabilities,r=Vt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Vt(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:lP(e,"queryRelated")}}function cbt(t){return{supportsCacheHint:lP(t.advancedQueryCapabilities,"queryTopFilter")}}function ubt(t){const e=t.ownershipBasedAccessControlForFeatures,r=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Vt(t,"allowGeometryUpdates",!0),supportsGlobalId:Vt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Vt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Vt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Vt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Vt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Vt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Vt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Vt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Vt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Vt(r,"supportsAsyncApplyEdits",!1)}}const hbt=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=Ge.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(Mt.ofType(of)),this.version=void 0}readCapabilitiesFromService(r,i){return NAe(i,this.url)}get effectiveCapabilities(){var o;const r=this.capabilities;if(!r)return null;const i=K(r),{operations:s,editing:n}=i;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),i)}get hasFullEditingRestrictions(){var n;const r=this.capabilities;if(!r||(n=this.sourceJSON)!=null&&n.isMultiServicesView)return!1;const{operations:i,editing:s}=r;return i.supportsEditing&&!(i.supportsAdd&&i.supportsDelete&&i.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){var n;const r=this.capabilities;if(!r)return!1;const{operations:i,editing:s}=r;return(n=this.sourceJSON)!=null&&n.isMultiServicesView?!i.supportsQuery:!(i.supportsAdd&&i.supportsDelete&&i.supportsEditing&&i.supportsQuery&&i.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readEditingInfo(r,i){const{editingInfo:s}=i;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return IAe(i)}readObjectIdFieldFromService(r,i){return $Ae(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=N0e({layer:this,url:r,nonStandardUrlAllowed:!0,logger:Q.getLogger(this)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){F0e(this,r,null,i,n)}readVersion(r,i){return W1t(i)}};return u([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Se("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([p({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([p({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),u([p({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),u([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([p({type:lS})],e.prototype,"dateFieldsTimeReference",void 0),u([p({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([p({readOnly:!0,type:M1t})],e.prototype,"editFieldsInfo",void 0),u([p({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Se("editingInfo")],e.prototype,"readEditingInfo",null),u([p((()=>{const r=K(dAe),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),u([p({type:LAe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([p({type:_r,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([p()],e.prototype,"gdbVersion",void 0),u([p({readOnly:!0,type:Q1t,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:pH.read}}}})],e.prototype,"geometryType",void 0),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([p({readOnly:!0,type:Tw})],e.prototype,"heightModelInfo",void 0),u([p({type:Date})],e.prototype,"historicMoment",void 0),u([p({readOnly:!0})],e.prototype,"isTable",void 0),u([Se("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([p(zvt)],e.prototype,"minScale",void 0),u([Se("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([p(kvt)],e.prototype,"maxScale",void 0),u([Se("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([p({type:String})],e.prototype,"globalIdField",void 0),u([Se("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([p({type:String})],e.prototype,"objectIdField",void 0),u([Se("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([p({type:lS})],e.prototype,"preferredTimeReference",void 0),u([p({type:[K1t],readOnly:!0})],e.prototype,"relationships",void 0),u([p()],e.prototype,"sourceJSON",void 0),u([p({type:Boolean})],e.prototype,"returnM",void 0),u([p({type:Boolean})],e.prototype,"returnZ",void 0),u([p({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Se("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([p({type:Ge,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([p({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([p({type:Mt.ofType(of),readOnly:!0})],e.prototype,"indexes",void 0),u([p(uAe)],e.prototype,"url",null),u([De("url")],e.prototype,"writeUrl",null),u([p({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Se("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([R("esri.layers.mixins.FeatureLayerBase")],e),e};let zT=class extends ji(de){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([p({type:String,json:{write:!0}})],zT.prototype,"expression",void 0),u([p({type:String,json:{write:!0}})],zT.prototype,"title",void 0),u([p({type:String,json:{write:!0}})],zT.prototype,"returnType",void 0),zT=u([R("esri.layers.support.ExpressionInfo")],zT);const mJ=zT;var mH;let Zm=mH=class extends de{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new mH({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:K(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([p({type:Boolean,json:{write:!0}})],Zm.prototype,"isAutoGenerated",void 0),u([p({type:String,json:{write:!0}})],Zm.prototype,"name",void 0),u([p({type:String,json:{write:!0}})],Zm.prototype,"alias",void 0),u([p({type:String,json:{write:!0}})],Zm.prototype,"onStatisticField",void 0),u([p({type:mJ,json:{write:!0}})],Zm.prototype,"onStatisticExpression",void 0),u([p({type:String,json:{write:!0}})],Zm.prototype,"statisticType",void 0),Zm=mH=u([R("esri.layers.support.AggregateField")],Zm);const pw=Zm;var gH;let v0=gH=class extends de{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?Z7(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=Z7(this.value)),t!=null&&(e[r]=t)}clone(){return new gH({expression:this.expression,title:this.title,value:this.value})}};u([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],v0.prototype,"expression",void 0),u([Se("expression",["expression","value"])],v0.prototype,"readExpression",null),u([De("expression")],v0.prototype,"writeExpression",null),u([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],v0.prototype,"title",void 0),u([p({json:{read:!1,write:!1}})],v0.prototype,"value",void 0),v0=gH=u([R("esri.layers.support.LabelExpressionInfo")],v0);const FAe=v0,UAe=[252,146,31,255],eUt=[153,153,153,255],dbt={type:"esriSMS",style:"esriSMSCircle",size:6,color:UAe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},pbt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:UAe},fbt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},mbt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},gbt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},ybt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},_bt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},tUt=k_.fromJSON(dbt),rUt=Ph.fromJSON(pbt),iUt=ww.fromJSON(fbt),vbt=JS.fromJSON(mbt);k_.fromJSON(gbt);Ph.fromJSON(ybt);ww.fromJSON(_bt);var yH;const u$=new Rr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function h$(t,e,r){return{enabled:!epe(r==null?void 0:r.layer)}}function VAe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function bbt(t){return(t==null?void 0:t.type)==="map-image"}function zAe(t){var e,r;return!!bbt(t)&&!!((r=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function wbt(t){return VAe(t)||zAe(t==null?void 0:t.layer)}let Xs=yH=class extends de{static evaluateWhere(t,e){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const s=r(e[i[0]],i[1],i[2]),n=i[3],o=r(e[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=vbt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=TYe(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=wX(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&VAe(i))t=new FAe({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(i);s.expression&&(e[r]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return LF(this)}getLabelExpressionArcade(){return SYe(this)}getLabelExpressionSingleField(){return EYe(this)}hash(){return JSON.stringify(this)}clone(){return new yH({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:K(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:K(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([p({type:String,json:{write:!0}})],Xs.prototype,"name",void 0),u([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:h$}}}}})],Xs.prototype,"allowOverrun",void 0),u([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:h$}}}}})],Xs.prototype,"deconflictionStrategy",void 0),u([p({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&zAe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],Xs.prototype,"labelExpression",void 0),u([Se("labelExpression")],Xs.prototype,"readLabelExpression",null),u([De("labelExpression")],Xs.prototype,"writeLabelExpression",null),u([p({type:FAe,json:{write:{overridePolicy:(t,e,r)=>wbt(r)?{allowNull:!0}:{enabled:!1}}}})],Xs.prototype,"labelExpressionInfo",void 0),u([De("labelExpressionInfo")],Xs.prototype,"writeLabelExpressionInfo",null),u([p({type:u$.apiValues,json:{type:u$.jsonValues,read:u$.read,write:u$.write}})],Xs.prototype,"labelPlacement",void 0),u([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Xs.prototype,"labelPosition",void 0),u([p({type:Number})],Xs.prototype,"maxScale",void 0),u([De("maxScale")],Xs.prototype,"writeMaxScale",null),u([p({type:Number})],Xs.prototype,"minScale",void 0),u([De("minScale")],Xs.prototype,"writeMinScale",null),u([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:h$}}}}})],Xs.prototype,"repeatLabel",void 0),u([p({type:Number,cast:Jr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:h$}}}}})],Xs.prototype,"repeatLabelDistance",void 0),u([p({types:gFe,json:{origins:{"web-scene":{types:yFe,write:tne,default:null}},write:tne,default:null}})],Xs.prototype,"symbol",void 0),u([p({type:Boolean,json:{write:!0}})],Xs.prototype,"useCodedValues",void 0),u([p({type:String,json:{write:!0}})],Xs.prototype,"where",void 0),Xs=yH=u([R("esri.layers.support.LabelClass")],Xs);const cP=Xs;var _H;const xbt="esri.layers.support.FeatureReductionBinning";let dl=_H=class extends Cg{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Ha(r,i,e)}readRenderer(t,e,r){var s;const i=(s=e.drawingInfo)==null?void 0:s.renderer;return i?aR(i,e,r)??void 0:fJ(e,r)}clone(){return new _H({fields:K(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:K(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:K(this.popupTemplate),renderer:K(this.renderer)})}};u([et({binning:"binning"})],dl.prototype,"type",void 0),u([et({geohash:"geohash"})],dl.prototype,"binType",void 0),u([p({type:Number,range:{min:1,max:9},json:{write:!0}})],dl.prototype,"fixedBinLevel",void 0),u([p({type:[cP],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],dl.prototype,"labelingInfo",void 0),u([p(_6)],dl.prototype,"labelsVisible",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],dl.prototype,"maxScale",void 0),u([p(y6)],dl.prototype,"popupEnabled",void 0),u([p({type:ZS,json:{name:"popupInfo",write:!0}})],dl.prototype,"popupTemplate",void 0),u([p({type:[pw],json:{write:!0}})],dl.prototype,"fields",void 0),u([De("fields")],dl.prototype,"writeFields",null),u([p({types:g6,json:{write:{target:"drawingInfo.renderer"}}})],dl.prototype,"renderer",void 0),u([Se("renderer",["drawingInfo.renderer"])],dl.prototype,"readRenderer",null),dl=_H=u([R(xbt)],dl);const kAe=dl;var vH;const Tbt="esri.layers.support.FeatureReductionCluster";function Aue(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let Nn=vH=class extends de{constructor(t){super(t),this.type="cluster",this.clusterRadius=Jr("80px"),this.clusterMinSize=Jr("12px"),this.clusterMaxSize=Jr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){var s,n;const i=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated?null:i?Aue(i)?null:aR(i,e,r)??void 0:fJ(e,r)}readSymbol(t,e,r){var s,n;const i=(s=e.drawingInfo)==null?void 0:s.renderer;if((n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated)return null;if(i&&Aue(i)){const o=aR(i,e,r);return o==null?void 0:o.symbol}return null}writeSymbol(t,e,r,i){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new m6({symbol:t});e.drawingInfo={renderer:a.write({},i)}}}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Ha(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>pw.fromJSON(i))}clone(){return new vH({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:K(this.labelingInfo),labelsVisible:this.labelsVisible,fields:K(this.fields),maxScale:this.maxScale,renderer:K(this.renderer),symbol:K(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:K(this.popupTemplate)})}};u([p({type:["cluster"],readOnly:!0,json:{write:!0}})],Nn.prototype,"type",void 0),u([p({type:Number,cast:t=>t==="auto"?t:Jr(t),json:{write:!0}})],Nn.prototype,"clusterRadius",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],Nn.prototype,"clusterMinSize",void 0),u([p({type:Number,cast:Jr,json:{write:!0}})],Nn.prototype,"clusterMaxSize",void 0),u([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Nn.prototype,"maxScale",void 0),u([p(y6)],Nn.prototype,"popupEnabled",void 0),u([p({type:ZS,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Nn.prototype,"popupTemplate",void 0),u([p({types:g6,json:{write:{target:"drawingInfo.renderer"}}})],Nn.prototype,"renderer",void 0),u([Se("renderer",["drawingInfo.renderer"])],Nn.prototype,"readRenderer",null),u([p({types:fFe})],Nn.prototype,"symbol",void 0),u([Se("symbol",["drawingInfo.renderer"])],Nn.prototype,"readSymbol",null),u([De("symbol")],Nn.prototype,"writeSymbol",null),u([p({type:[cP],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Nn.prototype,"labelingInfo",void 0),u([p(_6)],Nn.prototype,"labelsVisible",void 0),u([p({type:[pw],json:{write:!0}})],Nn.prototype,"fields",void 0),u([De("fields")],Nn.prototype,"writeFields",null),u([Se("fields")],Nn.prototype,"readFields",null),Nn=vH=u([R(Tbt)],Nn);const BAe=Nn,Oue={key:"type",base:Cg,typeMap:{cluster:BAe,binning:kAe}},Sbt={types:{key:"type",base:Cg,typeMap:{selection:Fj,cluster:BAe,binning:kAe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Oue},"portal-item":{types:Oue},"web-scene":{types:{key:"type",base:Cg,typeMap:{selection:Fj}}}}}},Hx={Base64:0,Hex:1,String:2,Raw:3},U2=8,GAe=(1<<U2)-1;function o_(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function Ebt(t){const e=[];for(let r=0,i=t.length*U2;r<i;r+=U2)e[r>>5]|=(t.charCodeAt(r/U2)&GAe)<<r%32;return e}function Cbt(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=U2)e.push(String.fromCharCode(t[r>>5]>>>r%32&GAe));return e.join("")}function Abt(t){const e="0123456789abcdef",r=[];for(let i=0,s=4*t.length;i<s;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function Obt(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function Rbt(t,e){return t<<e|t>>>32-e}function v6(t,e,r,i,s,n){return o_(Rbt(o_(o_(e,t),o_(i,n)),s),r)}function _a(t,e,r,i,s,n,o){return v6(e&r|~e&i,t,e,s,n,o)}function va(t,e,r,i,s,n,o){return v6(e&i|r&~i,t,e,s,n,o)}function ba(t,e,r,i,s,n,o){return v6(e^r^i,t,e,s,n,o)}function wa(t,e,r,i,s,n,o){return v6(r^(e|~i),t,e,s,n,o)}function Pbt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=s,h=n;r=_a(r,i,s,n,t[o],7,-680876936),n=_a(n,r,i,s,t[o+1],12,-389564586),s=_a(s,n,r,i,t[o+2],17,606105819),i=_a(i,s,n,r,t[o+3],22,-1044525330),r=_a(r,i,s,n,t[o+4],7,-176418897),n=_a(n,r,i,s,t[o+5],12,1200080426),s=_a(s,n,r,i,t[o+6],17,-1473231341),i=_a(i,s,n,r,t[o+7],22,-45705983),r=_a(r,i,s,n,t[o+8],7,1770035416),n=_a(n,r,i,s,t[o+9],12,-1958414417),s=_a(s,n,r,i,t[o+10],17,-42063),i=_a(i,s,n,r,t[o+11],22,-1990404162),r=_a(r,i,s,n,t[o+12],7,1804603682),n=_a(n,r,i,s,t[o+13],12,-40341101),s=_a(s,n,r,i,t[o+14],17,-1502002290),i=_a(i,s,n,r,t[o+15],22,1236535329),r=va(r,i,s,n,t[o+1],5,-165796510),n=va(n,r,i,s,t[o+6],9,-1069501632),s=va(s,n,r,i,t[o+11],14,643717713),i=va(i,s,n,r,t[o],20,-373897302),r=va(r,i,s,n,t[o+5],5,-701558691),n=va(n,r,i,s,t[o+10],9,38016083),s=va(s,n,r,i,t[o+15],14,-660478335),i=va(i,s,n,r,t[o+4],20,-405537848),r=va(r,i,s,n,t[o+9],5,568446438),n=va(n,r,i,s,t[o+14],9,-1019803690),s=va(s,n,r,i,t[o+3],14,-187363961),i=va(i,s,n,r,t[o+8],20,1163531501),r=va(r,i,s,n,t[o+13],5,-1444681467),n=va(n,r,i,s,t[o+2],9,-51403784),s=va(s,n,r,i,t[o+7],14,1735328473),i=va(i,s,n,r,t[o+12],20,-1926607734),r=ba(r,i,s,n,t[o+5],4,-378558),n=ba(n,r,i,s,t[o+8],11,-2022574463),s=ba(s,n,r,i,t[o+11],16,1839030562),i=ba(i,s,n,r,t[o+14],23,-35309556),r=ba(r,i,s,n,t[o+1],4,-1530992060),n=ba(n,r,i,s,t[o+4],11,1272893353),s=ba(s,n,r,i,t[o+7],16,-155497632),i=ba(i,s,n,r,t[o+10],23,-1094730640),r=ba(r,i,s,n,t[o+13],4,681279174),n=ba(n,r,i,s,t[o],11,-358537222),s=ba(s,n,r,i,t[o+3],16,-722521979),i=ba(i,s,n,r,t[o+6],23,76029189),r=ba(r,i,s,n,t[o+9],4,-640364487),n=ba(n,r,i,s,t[o+12],11,-421815835),s=ba(s,n,r,i,t[o+15],16,530742520),i=ba(i,s,n,r,t[o+2],23,-995338651),r=wa(r,i,s,n,t[o],6,-198630844),n=wa(n,r,i,s,t[o+7],10,1126891415),s=wa(s,n,r,i,t[o+14],15,-1416354905),i=wa(i,s,n,r,t[o+5],21,-57434055),r=wa(r,i,s,n,t[o+12],6,1700485571),n=wa(n,r,i,s,t[o+3],10,-1894986606),s=wa(s,n,r,i,t[o+10],15,-1051523),i=wa(i,s,n,r,t[o+1],21,-2054922799),r=wa(r,i,s,n,t[o+8],6,1873313359),n=wa(n,r,i,s,t[o+15],10,-30611744),s=wa(s,n,r,i,t[o+6],15,-1560198380),i=wa(i,s,n,r,t[o+13],21,1309151649),r=wa(r,i,s,n,t[o+4],6,-145523070),n=wa(n,r,i,s,t[o+11],10,-1120210379),s=wa(s,n,r,i,t[o+2],15,718787259),i=wa(i,s,n,r,t[o+9],21,-343485551),r=o_(r,a),i=o_(i,l),s=o_(s,c),n=o_(n,h)}return[r,i,s,n]}function jAe(t,e=Hx.Hex){const r=e||Hx.Base64,i=Pbt(Ebt(t),t.length*U2);switch(r){case Hx.Raw:return i;case Hx.Hex:return Abt(i);case Hx.String:return Cbt(i);case Hx.Base64:return Obt(i)}}var bH;let K3=bH=class extends f6{writeLevels(t,e,r){for(const i in t){const s=this.levels[i];return void(e.stops=s)}}clone(){return new bH({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:s_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:s_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:K(this.levels)})}};u([p()],K3.prototype,"levels",void 0),u([De("levels")],K3.prototype,"writeLevels",null),K3=bH=u([R("esri.views.2d.engine.LevelDependentSizeVariable")],K3);const Mbt=Q.getLogger("esri.views.2d.layers.support.clusterUtils");oe.add("esri-cluster-arcade-enabled",!0);const Ibt=oe("esri-cluster-arcade-enabled"),$bt=(t,e,r,i,s)=>{const n=e.clone();if(!Fbt(n))return n;if(n.authoringInfo||(n.authoringInfo=new iJ),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=Lbt(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=Fv(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=SC(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=Fv(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=Fv(t,l.field,"avg","number"):l.valueExpression&&(l.field=SC(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),a==null&&!Dbt(o)&&s&&(o.push(Nbt(r,i)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=Fv(t,o.field,"sum","number"):o.valueExpression&&(o.field=SC(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=Fv(t,n.field,"mode","string"):n.valueExpression&&(n.field=SC(t,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=Fv(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=Fv(t,n.field,"avg","number"):n.valueExpression&&(n.field=SC(t,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},Lbt=t=>{for(const e of t)if(e.type==="size")return e;return null},Dbt=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},Nbt=(t,e)=>{const r=[new PT({value:0,size:0}),new PT({value:1})];if(e==null)return new f6({field:"cluster_count",stops:[...r,new PT({value:2,size:0})]});const i=Object.keys(e).reduce((s,n)=>({...s,[n]:[...r,new PT({value:Math.max(2,e[n].minValue),size:t.clusterMinSize}),new PT({value:Math.max(3,e[n].maxValue),size:t.clusterMaxSize})]}),{});return new K3({field:"cluster_count",levels:i})},Fbt=t=>{const e=r=>Mbt.error(new U("Unsupported-renderer",r,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!Ibt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function Ubt(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,s="field",n=e.toLowerCase()+",norm:"+s+","+i.toLowerCase();return"cluster_avg_"+jAe(n)}}}function SC(t,e,r,i){const s=jAe(e),n=r==="mode"?`cluster_type_${s}`:r==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new pw({name:n,isAutoGenerated:!0,onStatisticExpression:new mJ({expression:e,returnType:i}),statisticType:r})),n}function Fv(t,e,r,i,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=Ubt(r,e,s);return t.some(o=>o.name===n)||(r==="avg_norm"?t.push(new pw({name:n,isAutoGenerated:!0,onStatisticExpression:new mJ({expression:`$feature.${e} / $feature.${s}`,returnType:i}),statisticType:"avg"})):t.push(new pw({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),n}const Vbt=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){var a;if((r==null?void 0:r.type)!=="cluster")return r;const i=r.clone(),s=[new pw({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(i.fields??[]).filter(l=>!l.isAutoGenerated);if(r.renderer&&!((a=r.renderer.authoringInfo)!=null&&a.isAutoGenerated))return i.fields=[...s,...n],i;if(r.symbol)return i.fields=[...s,...n],i.renderer=null,i;if(!this.renderer)return r;const o=$bt(s,this.renderer,r,null,!1);return i.fields=[...s,...n],i.renderer=o,i}};return u([p(Sbt)],e.prototype,"featureReduction",null),e=u([R("esri.layers.mixins.FeatureReductionLayer")],e),e};var wH;const pV=new Rr({asc:"ascending",desc:"descending"});let kT=wH=class extends de{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new wH({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([p({type:String,json:{write:!0}})],kT.prototype,"field",void 0),u([p({type:String,json:{write:!0}})],kT.prototype,"valueExpression",void 0),u([p({type:pV.apiValues,json:{read:pV.read,write:pV.write}})],kT.prototype,"order",void 0),kT=wH=u([R("esri.layers.support.OrderByInfo")],kT);const HAe=kT;function zbt(t,e,r){if(!t)return null;const i=t.find(n=>!!n.field);if(!i)return null;const s=new HAe;return s.read(i,r),[s]}function kbt(t,e,r,i){const s=t.find(n=>!!n.field);s&&Ha(r,[s.toJSON()],e)}const Bbt=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([p({type:[HAe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:zbt},write:{target:"layerDefinition.orderBy",writer:kbt}}})],e.prototype,"orderBy",void 0),e=u([R("esri.layers.mixins.OrderedLayer")],e),e};let eA=class extends xe{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([p()],eA.prototype,"updating",void 0),u([p()],eA.prototype,"status",void 0),eA=u([R("esri.layers.support.PublishingInfo")],eA);const Gbt=eA,qAe="esri.layers.mixins.PublishableLayer",jbt=Symbol(qAe),Hbt=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const s=new Gbt;return this._checkPublishingStatus(s),s}_checkPublishingStatus(i){let o=0;const a=async c=>{let h;i.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=h,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=jbt,u([p({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=u([R(qAe)],r),r},WAe=Wa()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let tA=class extends ji(de){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return sVe(this.value,this.unit,"milliseconds")}};u([et(WAe,{nonNullable:!0})],tA.prototype,"unit",void 0),u([p({type:Number,json:{write:!0},nonNullable:!0})],tA.prototype,"value",void 0),tA=u([R("esri.TimeInterval")],tA);const V4=tA;function Rue(t,e){return V4.fromJSON({value:t,unit:e})}let Ra=class extends ji(de){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),s=new Date(r.timeExtent[1]);return new em({start:i,end:s})}writeFullTimeExtent(e,r){e&&e.start!=null&&e.end!=null?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?Rue(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?Rue(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=(e==null?void 0:e.toJSON().value)??null,r.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};u([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Ra.prototype,"cumulative",void 0),u([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Ra.prototype,"endField",void 0),u([p({type:em,json:{write:{enabled:!0,allowNull:!0}}})],Ra.prototype,"fullTimeExtent",void 0),u([Se("fullTimeExtent",["timeExtent"])],Ra.prototype,"readFullTimeExtent",null),u([De("fullTimeExtent")],Ra.prototype,"writeFullTimeExtent",null),u([p({type:Boolean,json:{write:!0}})],Ra.prototype,"hasLiveData",void 0),u([p({type:V4,json:{write:{enabled:!0,allowNull:!0}}})],Ra.prototype,"interval",void 0),u([Se("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Ra.prototype,"readInterval",null),u([De("interval")],Ra.prototype,"writeInterval",null),u([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Ra.prototype,"startField",void 0),u([p({type:lS,json:{write:{enabled:!0,allowNull:!0}}})],Ra.prototype,"timeReference",void 0),u([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Ra.prototype,"trackIdField",void 0),u([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Ra.prototype,"useTime",void 0),Ra=u([R("esri.layers.support.TimeInfo")],Ra);const ZAe=Ra,qbt=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=WAe.fromJSON(s.timeOffsetUnits);return n&&o?new V4({value:n,unit:o}):null}set timeInfo(r){efe(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([p({type:em,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([p({type:V4})],e.prototype,"timeOffset",void 0),u([Se("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([p({value:null,type:ZAe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([p({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([R("esri.layers.mixins.TemporalLayer")],e),e},Pue=new Rr({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let b0=class extends ji(de){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([p({json:{write:!0}})],b0.prototype,"name",void 0),u([p({json:{write:!0}})],b0.prototype,"description",void 0),u([p({json:{read:Pue.read,write:Pue.write}})],b0.prototype,"drawingTool",void 0),u([p({json:{write:!0}})],b0.prototype,"prototype",void 0),u([p({json:{write:!0}})],b0.prototype,"thumbnail",void 0),b0=u([R("esri.layers.support.FeatureTemplate")],b0);const gJ=b0;let Xm=class extends ji(de){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=_X(e[i]);return r}writeDomains(e,r){var s;const i={};for(const n of Object.keys(e))e[n]&&(i[n]=(s=e[n])==null?void 0:s.toJSON());r.domains=i}};u([p({json:{write:!0}})],Xm.prototype,"id",void 0),u([p({json:{write:!0}})],Xm.prototype,"name",void 0),u([p({json:{write:!0}})],Xm.prototype,"domains",void 0),u([Se("domains")],Xm.prototype,"readDomains",null),u([De("domains")],Xm.prototype,"writeDomains",null),u([p({type:[gJ],json:{write:!0}})],Xm.prototype,"templates",void 0),Xm=u([R("esri.layers.support.FeatureType")],Xm);const XAe=Xm;function YAe(){return{fields:{type:[$F],value:null},fieldsIndex:{readOnly:!0,get(){return new sJ(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const r of t)((e=this.fieldsIndex)==null?void 0:e.has(r))||Q.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:t});return m5(this.fieldsIndex,t)}}}}const fV=Q.getLogger("esri.layers.support.labelingInfo"),Wbt=/\[([^\[\]]+)\]/gi;function z4(t,e,r){return t?t.map(i=>{const s=new cP;if(s.read(i,r),s.labelExpression){const n=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replaceAll(Wbt,(o,a)=>`[${Zbt(a,n)}]`)}return s}):null}function Zbt(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const s=e[i].name;if(s.toLowerCase()===r)return s}return t}const Xbt={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function cUt(t,e){const r=K(t);return r.some(i=>Ybt(i,e))?[]:r}function Ybt(t,e){const r=t.labelPlacement,i=Xbt[e];if(!t.symbol)return fV.warn("No ILabelClass symbol specified."),!0;if(!i)return fV.error(new U("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const s=i[0];r&&fV.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${s}`),t.labelPlacement=s}return!1}const bd=[];function Jbt(t,e){if(YW(t.url??""))return!0;const{wkid:r}=e;for(const i of bd){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}bd.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),bd.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),bd.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),bd.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),bd.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),bd.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),bd.push([10.61,()=>new Set([102497])]),bd.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),bd.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),bd.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function JAe(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await uu(i.populateFromStyle());if(Qt(r),s.ok===!1){const n=s.error;e&&e.messages&&e.messages.push(new yh("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}var xH;let BT=xH=class extends de{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new xH({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([p({type:[String],json:{write:!0}})],BT.prototype,"groupByFields",void 0),u([p({type:Number,json:{write:!0}})],BT.prototype,"topCount",void 0),u([p({type:[String],json:{write:!0}})],BT.prototype,"orderByFields",void 0),BT=xH=u([R("esri.rest.support.TopFilter")],BT);const Qbt=BT;var TH;const Mue=new Rr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Iue=new Rr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let hs=TH=class extends de{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new TH(K({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([p({type:Boolean,json:{write:!0}})],hs.prototype,"cacheHint",void 0),u([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],hs.prototype,"distance",void 0),u([p({types:gw,json:{read:g_,write:!0}})],hs.prototype,"geometry",void 0),u([p({type:Number,json:{write:!0}})],hs.prototype,"geometryPrecision",void 0),u([p({type:Number,json:{write:!0}})],hs.prototype,"maxAllowableOffset",void 0),u([p({type:Number,json:{read:{source:"resultRecordCount"}}})],hs.prototype,"num",void 0),u([p({json:{write:!0}})],hs.prototype,"objectIds",void 0),u([p({type:[String],json:{write:!0}})],hs.prototype,"orderByFields",void 0),u([p({type:[String],json:{write:!0}})],hs.prototype,"outFields",void 0),u([p({type:Ge,json:{read:{source:"outSR"},write:{target:"outSR"}}})],hs.prototype,"outSpatialReference",void 0),u([p({type:String,json:{write:!0}})],hs.prototype,"resultType",void 0),u([p({json:{write:!0}})],hs.prototype,"returnGeometry",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],hs.prototype,"returnM",void 0),u([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],hs.prototype,"returnZ",void 0),u([p({type:Number,json:{read:{source:"resultOffset"}}})],hs.prototype,"start",void 0),u([De("start"),De("num")],hs.prototype,"writeStart",null),u([p({type:String,json:{read:{source:"spatialRel",reader:Mue.read},write:{target:"spatialRel",writer:Mue.write}}})],hs.prototype,"spatialRelationship",void 0),u([p({type:em,json:{write:!0}})],hs.prototype,"timeExtent",void 0),u([p({type:Qbt,json:{write:!0}})],hs.prototype,"topFilter",void 0),u([p({type:String,json:{read:Iue.read,write:{writer:Iue.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],hs.prototype,"units",void 0),u([p({type:String,json:{write:!0}})],hs.prototype,"where",void 0),hs=TH=u([R("esri.rest.support.TopFeaturesQuery")],hs),hs.from=qs(hs);const d$=hs;function QAe({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=rwt({editFieldsInfo:e,fields:r,objectIdField:i},n);if(!o.length)return null;const a=nwt({titleBase:s,fields:r,displayField:t}),l=swt();return new ZS({title:a,content:l,fieldInfos:o})}const Kbt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):MDe(t,e);function ewt(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(twt),t}function twt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:$ue(t)?-1:$ue(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function rwt(t,e){const r=e==null?void 0:e.visibleFieldNames;return ewt(t.fields??[],(e==null?void 0:e.ignoreFieldTypes)||owt).map(i=>new sW({fieldName:i.name,isEditable:PDe(i,t),label:i.alias,format:iwt(i),visible:Kbt(i,{...t,visibleFieldNames:r})}))}function iwt(t){switch(t.type){case"small-integer":case"integer":case"single":return new NC({digitSeparator:!0,places:0});case"double":return new NC({digitSeparator:!0,places:2});case"date":return new NC({dateFormat:"long-month-day-year"});default:return t.type==="string"&&XDe(t.name)?new NC({digitSeparator:!0,places:0}):null}}function swt(){return[new _O,new yO]}function nwt(t){const e=vDe(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function $ue(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const owt=["geometry","blob","raster","guid","xml"],nl="FeatureLayer",KAe="esri.layers.FeatureLayer",awt=Q.getLogger(KAe);function p$(t,e){return new U("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function Lue(t){return t&&t instanceof Mt}const mV=YAe();function gV(t,e,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let dt=class extends hbt(Vbt(P1t(Hbt(aAe(MAe(Bbt(qbt(cJ(Tct(iAe(gAe(_Ae(lJ(b1t(rAe(ji(f5))))))))))))))))){constructor(...e){super(...e),this._handles=new Mi,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Ge.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Pe(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){var s;const r=e!=null?e.signal:null;if((s=this.portalItem)!=null&&s.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(n=>this.initLayerProperties(n))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Io).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const n=await this._fetchFirstLayerId(r);n!=null&&(this.layerId=n)}if(!this.url&&!this._hasMemorySource())throw new U("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>X1t(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,NAe(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,s){this._writeEditingEnabled(e,r,!0,s)}get effectiveEditingEnabled(){return J1t(this)}readIsTable(e,r){return(r=(r==null?void 0:r.layerDefinition)??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,s){s!=null&&s.writeLayerSchema&&Ha(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return IAe(r.layerDefinition||r)}readObjectIdField(e,r){return $Ae(r.layerDefinition||r)}get parsedUrl(){const e=_o(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=_c(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=_c(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){HD(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){var n;r=r.layerDefinition||r;const s=(n=r.drawingInfo)==null?void 0:n.renderer;if(s){const o=aR(s,r,i)??void 0;return o||awt.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),o}return fJ(r,i)}set source(e){const r=this._get("source");r!==e&&(Lue(r)&&this._resetMemorySource(r),Lue(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof Mt?new eg({layer:this,items:e}):e:null}readSource(e,r){const i=RAe.fromJSON(r.featureSet);return new eg({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(e,r){const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e=e&&e.map(o=>gJ.fromJSON(o)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,r){var n;const i=((n=r.layerDefinition)==null?void 0:n.name)??r.name,s=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?D0e(this.url,i):i;let a=i;if(!a&&this.url){const l=Ow(this.url);l!=null&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),J5(a)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const s=r.fields.find(n=>n.name.toLowerCase()===i);s&&(i=s.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e&&e.map(o=>(o=XAe.fromJSON(o),this._fixTemplates(o.templates,s),this._fixTemplates(o.templates,n),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return $1t(this,e,r,nl)}async updateAttachment(e,r,i){return L1t(this,e,r,i,nl)}async applyEdits(e,r){return D1t(this,e,r)}async uploadAssets(e,r){return N1t(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return QAe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await Mhe(ae(()=>import("./FeatureLayerSource-1d78f23a.js"),["assets/FeatureLayerSource-1d78f23a.js","assets/MeshGeoreferencedRelativeVertexSpace-13b8f062.js","assets/External-fd46e735.js","assets/editingSupport-39e328b9.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js","assets/clientSideDefaults-68e78bf2.js","assets/QueryEngineCapabilities-42e44ded.js","assets/QueryTask-01336d81.js","assets/executeForIds-9284e152.js","assets/query-dae0ecc4.js","assets/pbfQueryUtils-1b958c5a.js","assets/pbf-261a804a.js","assets/executeQueryJSON-97b27b27.js","assets/executeQueryPBF-b0040ee7.js"]),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=q1t(this);e.dynamicDataSource=this.dynamicDataSource;const r=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=s1t(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return F1t(this,e,r,nl)}async fetchRecomputedExtents(e){return U1t(this,e,nl)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const s=e.attributes?e.attributes[r]:void 0;if(s==null)return null;let n=null;return i==null||i.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===s.toString()&&(n=o),!!n)}),n}getFieldDomain(e,r){const i=r==null?void 0:r.feature,s=this.getFeatureType(i);if(s){const n=s.domains&&s.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return V1t(this,e,r,nl)}async queryFeatures(e,r){const i=await this.load(),s=await i.source.queryFeatures(Z_.from(e)??i.createQuery(),r);if(s!=null&&s.features)for(const n of s.features)n.layer=n.sourceLayer=i;return s}async queryObjectIds(e,r){return z1t(this,e,r,nl)}async queryFeatureCount(e,r){return k1t(this,e,r,nl)}async queryExtent(e,r){return B1t(this,e,r,nl)}async queryRelatedFeatures(e,r){return G1t(this,e,r,nl)}async queryRelatedFeaturesCount(e,r){return j1t(this,e,r,nl)}async queryTopFeatures(e,r){var o;const{source:i,capabilities:s}=await this.load();if(!i.queryTopFeatures||!((o=s==null?void 0:s.query)!=null&&o.supportsTopFeaturesQuery))throw new U(nl,"Layer source does not support queryTopFeatures capability");const n=await i.queryTopFeatures(d$.from(e),r);if(n!=null&&n.features)for(const a of n.features)a.layer=a.sourceLayer=this;return n}async queryTopObjectIds(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopObjectIds||!(s!=null&&s.query.supportsTopFeaturesQuery))throw new U(nl,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(d$.from(e),r)}async queryTopFeaturesExtent(e,r){var n;const{source:i,capabilities:s}=await this.load();if(!i.queryTopExtents||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new U(nl,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(d$.from(e),r)}async queryTopFeatureCount(e,r){var n;const{source:i,capabilities:s}=await this.load();if(!i.queryTopCount||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new U(nl,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(d$.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const s=i.layers;s&&s.length===1&&(super.read(s[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:(r==null?void 0:r.origin)??void 0,writeLayerSchema:(r==null?void 0:r.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:s,messages:n}=r;if(this.dynamicDataSource)return n==null||n.push(p$(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&s!=="tables")return n==null||n.push(p$(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n==null||n.push(p$(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&s==="tables")return n==null||n.push(p$(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new U(nl,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var r;return!!this.loaded&&(((r=this.source)==null?void 0:r.type)==="memory"||Jbt(this,e))}async save(e){const{save:r}=await ae(()=>import("./featureLayerUtils-b6521be8.js"),["assets/featureLayerUtils-b6521be8.js","assets/fetchService-cf0ed1b3.js","assets/jsonContext-cef0facd.js"]);return r(this,e)}async saveAs(e,r){const{saveAs:i}=await ae(()=>import("./featureLayerUtils-b6521be8.js"),["assets/featureLayerUtils-b6521be8.js","assets/fetchService-cf0ed1b3.js","assets/jsonContext-cef0facd.js"]);return i(this,e,r)}_readEditingEnabled(e,r,i){var n;let s=(n=e.layerDefinition)==null?void 0:n.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,r&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,s){var n,o;if(!e){const a=(o=(n=this.capabilities)==null?void 0:n.operations)!=null&&o.supportsSync?"Query,Sync":"Query";Ha("layerDefinition.capabilities",a,r),i&&!(s!=null&&s.writeLayerSchema)&&(r.capabilities=a)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return Fr(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){var r;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),HD(this.renderer,this.fieldsIndex),efe(this.timeInfo,this.fieldsIndex),JAe(this,{origin:"service"})}async hasDataChanged(){return H1t(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var r,i;const e=((r=this.parsedUrl)==null?void 0:r.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(s=>s.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const s=i.prototype&&i.prototype.attributes;s&&r&&delete s[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new U("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new U("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Se("service","capabilities")],dt.prototype,"readCapabilities",null),u([p({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],dt.prototype,"charts",void 0),u([p({readOnly:!0})],dt.prototype,"createQueryVersion",null),u([p({json:{read:{source:"layerDefinition.copyrightText"}}})],dt.prototype,"copyright",void 0),u([p({json:{read:{source:"layerDefinition.displayField"}}})],dt.prototype,"displayField",void 0),u([p({types:_b,readOnly:!0})],dt.prototype,"defaultSymbol",void 0),u([p({type:Rd})],dt.prototype,"dynamicDataSource",void 0),u([p({type:Boolean})],dt.prototype,"editingEnabled",null),u([Se(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],dt.prototype,"readEditingEnabled",null),u([Se("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],dt.prototype,"readEditingEnabledFromWebMap",null),u([De(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],dt.prototype,"writeEditingEnabled",null),u([De("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],dt.prototype,"writeEditingEnabledToWebMap",null),u([p({readOnly:!0})],dt.prototype,"effectiveEditingEnabled",null),u([p({...mV.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:gV}}}}})],dt.prototype,"fields",void 0),u([p(mV.fieldsIndex)],dt.prototype,"fieldsIndex",void 0),u([p({type:g1t,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],dt.prototype,"formTemplate",void 0),u([p({json:{read:{source:"layerDefinition.extent"}}})],dt.prototype,"fullExtent",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:gV,writer(t,e,r){const i=t?pH.toJSON(t):null;i&&Ha(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:pH.read}}})],dt.prototype,"geometryType",void 0),u([p({json:{read:{source:"layerDefinition.hasM"}}})],dt.prototype,"hasM",void 0),u([p({json:{read:{source:"layerDefinition.hasZ"}}})],dt.prototype,"hasZ",void 0),u([p(fAe)],dt.prototype,"id",void 0),u([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],dt.prototype,"infoFor3D",void 0),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],dt.prototype,"isTable",void 0),u([Se("service","isTable",["type","geometryType"]),Se("isTable",["layerDefinition.type","layerDefinition.geometryType"])],dt.prototype,"readIsTable",null),u([De("web-map","isTable")],dt.prototype,"writeIsTable",null),u([p(_6)],dt.prototype,"labelsVisible",void 0),u([p({type:[cP],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:z4},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:z4},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],dt.prototype,"labelingInfo",void 0),u([p((()=>{const t=K(Vvt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){Ha(i,c5(e),r)}}},t})())],dt.prototype,"opacity",void 0),u([p(hAe)],dt.prototype,"legendEnabled",void 0),u([p({type:["show","hide"],json:(()=>{const t=K(mAe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],dt.prototype,"listMode",void 0),u([Se("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],dt.prototype,"readGlobalIdField",null),u([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:gV}}}}})],dt.prototype,"objectIdField",void 0),u([Se("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],dt.prototype,"readObjectIdField",null),u([p({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],dt.prototype,"operationalLayerType",void 0),u([p(mV.outFields)],dt.prototype,"outFields",void 0),u([p({readOnly:!0})],dt.prototype,"parsedUrl",null),u([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],dt.prototype,"path",void 0),u([p(y6)],dt.prototype,"popupEnabled",void 0),u([p({type:ZS,json:{name:"popupInfo",write:!0}})],dt.prototype,"popupTemplate",void 0),u([p({readOnly:!0})],dt.prototype,"defaultPopupTemplate",null),u([p({types:g6,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:K3e,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],dt.prototype,"renderer",null),u([Se("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Se("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],dt.prototype,"readRenderer",null),u([p((()=>{const t=K(cAe);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],dt.prototype,"screenSizePerspectiveEnabled",void 0),u([p({clonable:!1})],dt.prototype,"source",null),u([yr("source")],dt.prototype,"castSource",null),u([Se("portal-item","source",["featureSet"]),Se("web-map","source",["featureSet"])],dt.prototype,"readSource",null),u([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],dt.prototype,"spatialReference",void 0),u([p({type:Number})],dt.prototype,"subtypeCode",void 0),u([p({type:[gJ]})],dt.prototype,"templates",void 0),u([Se("templates",["editFieldsInfo","creatorField","editorField","templates"])],dt.prototype,"readTemplates",null),u([p({type:ZAe})],dt.prototype,"timeInfo",void 0),u([p()],dt.prototype,"title",void 0),u([Se("service","title",["name"]),Se("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],dt.prototype,"readTitle",null),u([Se("web-map","title",["layerDefinition.name","title"])],dt.prototype,"readTitleFromWebMap",null),u([p({type:String})],dt.prototype,"sublayerTitleMode",void 0),u([p({json:{read:!1}})],dt.prototype,"type",void 0),u([p({type:String})],dt.prototype,"typeIdField",void 0),u([Se("service","typeIdField"),Se("typeIdField",["layerDefinition.typeIdField"])],dt.prototype,"readTypeIdField",null),u([p({type:[XAe]})],dt.prototype,"types",void 0),u([Se("service","types",["types"]),Se("types",["layerDefinition.types"])],dt.prototype,"readTypes",null),u([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],dt.prototype,"visible",void 0),u([Se("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],dt.prototype,"readVisible",null),dt=u([R(KAe)],dt);const SH=dt,hUt=Object.freeze(Object.defineProperty({__proto__:null,default:SH},Symbol.toStringTag,{value:"Module"}));let lwt=class{constructor(e,r,i,s){var o;this._parsedUrl=e,this._portalItem=r,this._apiKey=i,this.signal=s,this._rootDocument=null;const n=(o=this._parsedUrl)==null?void 0:o.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this._urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();if(e==null)return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(e);return r==null?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();return e==null?null:this._findAndLoadRelatedPortalItem(e)}async _fetchRootDocument(){if(this._rootDocument!=null)return this._rootDocument;if(this._urlParts==null)return this._rootDocument={},{};const e={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},r=`${this._urlParts.root}/SceneServer`;try{const i=await Fr(r,e);this._rootDocument=i.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){var s;const e=(s=this._parsedUrl)==null?void 0:s.path,r=e?xr==null?void 0:xr.findServerInfo(e):null;if(r!=null&&r.owningSystemUrl)return r.owningSystemUrl;const i=e?e.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const n=(await Fr(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(n)return n}catch(n){Io(n)}return null}async _findAndLoadRelatedPortalItem(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return Io(r),null}}async _loadFeatureLayerFromPortalItem(e){await e.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(e.url??"");return new SH({url:r,portalItem:e}).load({signal:this.signal})}async _loadFromUrl(){var r;const e=await this._findMatchingAssociatedSublayerUrl(`${(r=this._urlParts)==null?void 0:r.root}/FeatureServer`);return new SH({url:e}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(e){var d;const r=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i=(d=this._urlParts)==null?void 0:d.layerId,s=this._fetchRootDocument(),n=f=>{const m={query:{f:"json"},responseType:"json",authMode:f,signal:this.signal};return Fr(r,m)},o=n("anonymous").catch(()=>n("no-prompt")),[a,l]=await Promise.all([o,s]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let f=0;f<Math.min(c.length,h.length);f++)if(c[f].id===i)return`${r}/${h[f].id}`}else if(i!=null&&i<h.length)return`${r}/${h[i].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const e=(await this._fetchRootDocument()).serviceItemId;if(!e)return null;const r=new fb({id:e,apiKey:this._apiKey}),i=await this._fetchServiceOwningPortalUrl();i!=null&&(r.portal=new qn({url:i}));try{return r.load({signal:this.signal})}catch(s){return Io(s),null}}},eb=class extends de{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([p({type:Number})],eb.prototype,"nodesPerPage",void 0),u([p({type:Number})],eb.prototype,"rootIndex",void 0),u([p({type:String})],eb.prototype,"lodSelectionMetricType",void 0),eb=u([R("esri.layer.support.I3SNodePageDefinition")],eb);let pg=class extends de{constructor(){super(...arguments),this.factor=1}};u([p({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],pg.prototype,"id",void 0),u([p({type:Number})],pg.prototype,"factor",void 0),pg=u([R("esri.layer.support.I3SMaterialTexture")],pg);let w0=class extends de{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([p({type:[Number]})],w0.prototype,"baseColorFactor",void 0),u([p({type:pg})],w0.prototype,"baseColorTexture",void 0),u([p({type:pg})],w0.prototype,"metallicRoughnessTexture",void 0),u([p({type:Number})],w0.prototype,"metallicFactor",void 0),u([p({type:Number})],w0.prototype,"roughnessFactor",void 0),w0=u([R("esri.layer.support.I3SMaterialPBRMetallicRoughness")],w0);let Gu=class extends de{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([et({opaque:"opaque",mask:"mask",blend:"blend"})],Gu.prototype,"alphaMode",void 0),u([p({type:Number})],Gu.prototype,"alphaCutoff",void 0),u([p({type:Boolean})],Gu.prototype,"doubleSided",void 0),u([et({none:"none",back:"back",front:"front"})],Gu.prototype,"cullFace",void 0),u([p({type:pg})],Gu.prototype,"normalTexture",void 0),u([p({type:pg})],Gu.prototype,"occlusionTexture",void 0),u([p({type:pg})],Gu.prototype,"emissiveTexture",void 0),u([p({type:[Number]})],Gu.prototype,"emissiveFactor",void 0),u([p({type:w0})],Gu.prototype,"pbrMetallicRoughness",void 0),Gu=u([R("esri.layer.support.I3SMaterialDefinition")],Gu);let rA=class extends de{};u([p({type:String,json:{read:{source:["name","index"],reader:(t,e)=>t??`${e.index}`}}})],rA.prototype,"name",void 0),u([et({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],rA.prototype,"format",void 0),rA=u([R("esri.layer.support.I3STextureFormat")],rA);let iA=class extends de{constructor(){super(...arguments),this.atlas=!1}};u([p({type:[rA]})],iA.prototype,"formats",void 0),u([p({type:Boolean})],iA.prototype,"atlas",void 0),iA=u([R("esri.layer.support.I3STextureSetDefinition")],iA);let Pd=class extends de{};u([et({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Pd.prototype,"type",void 0),u([p({type:Number})],Pd.prototype,"component",void 0),Pd=u([R("esri.layer.support.I3SGeometryAttribute")],Pd);let sA=class extends de{};u([et({draco:"draco"})],sA.prototype,"encoding",void 0),u([p({type:[String]})],sA.prototype,"attributes",void 0),sA=u([R("esri.layer.support.I3SGeometryCompressedAttributes")],sA);let Qh=class extends de{constructor(){super(...arguments),this.offset=0}};u([p({type:Number})],Qh.prototype,"offset",void 0),u([p({type:Pd})],Qh.prototype,"position",void 0),u([p({type:Pd})],Qh.prototype,"normal",void 0),u([p({type:Pd})],Qh.prototype,"uv0",void 0),u([p({type:Pd})],Qh.prototype,"color",void 0),u([p({type:Pd})],Qh.prototype,"uvRegion",void 0),u([p({type:Pd})],Qh.prototype,"featureId",void 0),u([p({type:Pd})],Qh.prototype,"faceRange",void 0),u([p({type:sA})],Qh.prototype,"compressedAttributes",void 0),Qh=u([R("esri.layer.support.I3SGeometryBuffer")],Qh);let nA=class extends de{};u([et({triangle:"triangle"})],nA.prototype,"topology",void 0),u([p()],nA.prototype,"geometryBuffers",void 0),nA=u([R("esri.layer.support.I3SGeometryDefinition")],nA);let x0=class extends de{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([p({type:String,json:{read:!0,write:!0}})],x0.prototype,"name",void 0),u([p({type:String,json:{read:!0,write:!0}})],x0.prototype,"field",void 0),u([p({type:[Number],json:{read:!0,write:!0}})],x0.prototype,"currentRangeExtent",void 0),u([p({type:[Number],json:{read:!0,write:!0}})],x0.prototype,"fullRangeExtent",void 0),u([p({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],x0.prototype,"type",void 0),x0=u([R("esri.layers.support.RangeInfo")],x0);function EH(t){return yJ[cwt(t)]||hwt}function cwt(t){return t instanceof Blob?t.type:uwt(t.url)}function uwt(t){const e=cq(t);return CH[e]||eOe}const yJ={},eOe="text/plain",hwt=yJ[eOe],CH={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in CH)yJ[CH[t]]=t;function dwt(t){const e=(t==null?void 0:t.origins)??[void 0];return(r,i)=>{const s=pwt(t,r,i);for(const n of e){const o=qH(r,n,i);for(const a in s)o[a]=s[a]}}}function pwt(t,e,r){if((t==null?void 0:t.type)==="resource")return fwt(t,e,r);switch((t==null?void 0:t.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:s}=tFe;return{read:i,write:s}}}}function fwt(t,e,r){const i=uR(e,r);return{type:String,read:(s,n,o)=>{const a=S5(s,n,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=Dg(s,a)):void(n[o]=s.write({},a));const l=_wt(s),c=Dg(l,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},Q2.NO),h=i.type!==String&&(!vAe(this)||a&&a.origin&&this.originIdOf(r)>lg(a.origin)),d={object:this,propertyName:r,value:s,targetUrl:c,dest:n,targetPropertyName:o,context:a,params:t};a&&a.portalItem&&c&&!fc(c)?h?mwt(d):gwt(d):a&&a.portalItem&&(c==null||Nme(c)!=null||f_(c)||h)?tOe(d):n[o]=c}}}}function tOe(t){const{targetUrl:e,params:r,value:i,context:s,dest:n,targetPropertyName:o}=t;if(!s.portalItem)return;const a=Fme(e),l=(a==null?void 0:a.filename)??u6(),c=(r==null?void 0:r.prefix)??(a==null?void 0:a.prefix),h=iOe(i,e,s),d=_c(c,l),f=`${d}.${EH(h)}`,m=s.portalItem.resourceFromPath(f);f_(e)&&s.resources&&s.resources.pendingOperations.push(ywt(e).then(_=>{m.path=`${d}.${EH(_)}`,n[o]=m.itemRelativeUrl}).catch(()=>{}));const y=(r==null?void 0:r.compress)??!1;s.resources&&rOe({...t,resource:m,content:h,compress:y,updates:s.resources.toAdd}),n[o]=m.itemRelativeUrl}function mwt(t){const{context:e,targetUrl:r,params:i,value:s,dest:n,targetPropertyName:o}=t;if(!e.portalItem)return;const a=e.portalItem.resourceFromPath(r),l=iOe(s,r,e),c=EH(l),h=cq(a.path),d=(i==null?void 0:i.compress)??!1;c===h?(e.resources&&rOe({...t,resource:a,content:l,compress:d,updates:e.resources.toUpdate}),n[o]=r):tOe(t)}function gwt({context:t,targetUrl:e,dest:r,targetPropertyName:i}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),r[i]=e)}function rOe({object:t,propertyName:e,updates:r,resource:i,content:s,compress:n}){r.push({resource:i,content:s,compress:n,finish:o=>{vwt(t,e,o)}})}function iOe(t,e,r){return typeof t=="string"?{url:e}:new Blob([JSON.stringify(t.toJSON(r))],{type:"application/json"})}async function ywt(t){const e=(await ae(()=>Promise.resolve().then(()=>Hde),void 0)).default,{data:r}=await e(t,{responseType:"blob"});return r}function _wt(t){return t==null?null:typeof t=="string"?t:t.url}function vwt(t,e,r){typeof t[e]=="string"?t[e]=r.url:t[e].url=r.url}var cD;let AH=cD=class extends zS(Mt.ofType(Zd)){constructor(t){super(t)}clone(){return new cD(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){var r;const e=(r=t==null?void 0:t.layer)==null?void 0:r.spatialReference;return e?this.toArray().map(i=>{if(!e.equals(i.spatialReference)){if(!Uf(i.spatialReference,e))return t&&t.messages&&t.messages.push(new yh("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const n=new Zd;Vge(i,n,e),i=n}const s=i.toJSON(t);return delete s.spatialReference,s}).filter(i=>i!=null):(t!=null&&t.messages&&t.messages.push(new yh("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(i=>i.toJSON(t)))}static fromJSON(t,e){const r=new cD;return t.forEach(i=>r.add(Zd.fromJSON(i,e))),r}};AH=cD=u([R("esri.layers.support.PolygonCollection")],AH);const uD=AH;var OH;let GT=OH=class extends de{constructor(t){super(t),this.spatialRelationship="disjoint",this.geometries=new uD,this._geometriesSource=null,this._handles=new Mi}initialize(){this._handles.add(Ga(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,jr))}destroy(){this._handles.destroy()}readGeometries(t,e,r){Array.isArray(t)?this.geometries=uD.fromJSON(t,r):this._geometriesSource={url:Lg(t,r),context:r}}async loadGeometries(t,e){if(this._geometriesSource==null)return;const{url:r,context:i}=this._geometriesSource,s=await Fr(r,{responseType:"json",signal:e==null?void 0:e.signal}),n=t.toJSON(),o=s.data.map(a=>({...a,spatialReference:n}));this.geometries=uD.fromJSON(o,i),this._geometriesSource=null}clone(){const t=new OH({geometries:K(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};u([p({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],GT.prototype,"spatialRelationship",void 0),u([p({type:uD,nonNullable:!0,json:{write:!0}}),dwt({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],GT.prototype,"geometries",void 0),u([Se(["web-scene","portal-item"],"geometries")],GT.prototype,"readGeometries",null),GT=OH=u([R("esri.layers.support.SceneFilter")],GT);const bwt=GT,Ss=!0,cb={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function _J(t,e,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,r+cb.identifierOffset,cb.identifierLength)),version:e.getUint16(r+cb.versionOffset,Ss),checksum:e.getUint32(r+cb.checksumOffset,Ss)}}const Hl={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function wwt(t,e){return{sizeLo:t.getUint32(e+Hl.sizeLo,Ss),sizeHi:t.getUint32(e+Hl.sizeHi,Ss),minX:t.getFloat64(e+Hl.minX,Ss),minY:t.getFloat64(e+Hl.minY,Ss),minZ:t.getFloat64(e+Hl.minZ,Ss),maxX:t.getFloat64(e+Hl.maxX,Ss),maxY:t.getFloat64(e+Hl.maxY,Ss),maxZ:t.getFloat64(e+Hl.maxZ,Ss),errorX:t.getFloat64(e+Hl.errorX,Ss),errorY:t.getFloat64(e+Hl.errorY,Ss),errorZ:t.getFloat64(e+Hl.errorZ,Ss),count:t.getUint32(e+Hl.count,Ss),reserved:t.getUint32(e+Hl.reserved,Ss)}}function SUt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=_J(t,e,r);if(r+=cb.byteCount,i!=="LEPCC     ")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=wwt(e,r);if(r+=Hl.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(r=f$(t,r,a),r=f$(t,r,l),r=f$(t,r,c),r=f$(t,r,h),r!==t.byteLength)throw new U("lepcc-decode-error","Bad length");let d=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let y=0;for(let _=0;_<l[m];_++){y+=c[d];const v=h[d];o[3*d]=Math.min(n.maxX,n.minX+2*n.errorX*y),o[3*d+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*d+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*v),d++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function f$(t,e,r){const i=[];e=RH(t,e,i);const s=[];for(let n=0;n<i.length;n++){s.length=0,e=RH(t,e,s);for(let o=0;o<s.length;o++)r.push(s[o]+i[n])}return e}function RH(t,e,r){const i=new DataView(t,e),s=i.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=i.getUint32(1,Ss),e+=5;else if(a===1)l=i.getUint16(1,Ss),e+=3;else{if(a!==2)throw new U("lepcc-decode-error","Bad count type");l=i.getUint8(1),e+=2}if(o)throw new U("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(t,e,c);let d=0,f=0,m=0;const y=-1>>>32-n;for(let _=0;_<l;_++){for(;f<n;)d|=h[m]<<f,f+=8,m+=1;r[_]=d&y,d>>>=n,f-=n,f+n>32&&(d|=h[m-1]>>8-f)}return e+m}const N1={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function xwt(t,e){return{sizeLo:t.getUint32(e+N1.sizeLo,Ss),sizeHi:t.getUint32(e+N1.sizeHi,Ss),count:t.getUint32(e+N1.count,Ss),colorMapCount:t.getUint16(e+N1.colorMapCount,Ss),lookupMethod:t.getUint8(e+N1.lookupMethod),compressionMethod:t.getUint8(e+N1.compressionMethod)}}function Twt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=_J(t,e,r);if(r+=cb.byteCount,i!=="ClusterRGB")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=xwt(e,r);if(r+=N1.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+r!==t.byteLength||n.colorMapCount>256)throw new U("lepcc-decode-error","Bad count");const o=new Uint8Array(t,r,3*n.colorMapCount),a=new Uint8Array(t,r+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+r!==t.byteLength||n.colorMapCount!==0)throw new U("lepcc-decode-error","Bad count");return new Uint8Array(t,r).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(r+3!==t.byteLength||n.colorMapCount!==1)throw new U("lepcc-decode-error","Bad count");const o=e.getUint8(r),a=e.getUint8(r+1),l=e.getUint8(r+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new U("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const F1={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function Swt(t,e){return{sizeLo:t.getUint32(e+F1.sizeLo,Ss),sizeHi:t.getUint32(e+F1.sizeHi,Ss),count:t.getUint32(e+F1.count,Ss),scaleFactor:t.getUint16(e+F1.scaleFactor,Ss),bitsPerPoint:t.getUint8(e+F1.bitsPerPoint),reserved:t.getUint8(e+F1.reserved)}}function Ewt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=_J(t,e,r);if(r+=cb.byteCount,i!=="Intensity ")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=Swt(e,r);if(r+=F1.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+r!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const a=new Uint8Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+r!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const a=new Uint16Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(RH(t,r,a)!==t.byteLength)throw new U("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const PH=Q.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Cwt(t,e,r){let i="",s=0;for(;s<r;){const n=t[e+s];if(n<128)i+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&t[e+s+1];i+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&t[e+s+1])<<6|63&t[e+s+2];i+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new U("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&t[e+s+1])<<12|(63&t[e+s+2])<<6|63&t[e+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);s+=4}}}return i}function sOe(t,e){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let s=0;s<e.length;s++){const n=e[s],o=n.valueType||n.type,a=Dwt[o];r.fields[n.property]=a(t,i),i+=b6[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function Awt(t,e,r){return nOe(t,e,r).map(i=>{const s=i?Date.parse(i):null;return s&&!Number.isNaN(s)?s:null})}function nOe(t,e,r){const i=[];let s,n,o=0;for(n=0;n<t;n+=1){if(s=e[n],s>0){if(i.push(Cwt(r,o,s-1)),r[o+s-1]!==0)throw new U("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=s}return i}function Due(t,e){return new b6[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function Owt(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}function Rwt(t,e,r){const i=e.header!=null?sOe(t,e.header):{byteOffset:0,byteCount:0,fields:{count:r}},s={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let n=i.byteCount;for(let o=0;o<e.ordering.length;o++){const a=e.ordering[o],l=K(e[a]);if(l.count=i.fields.count??0,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new U("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&l.timeEncoding!=="ECMA_ISO8601")throw new U("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!aOe(l.valueType))throw new U("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=hD(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount??0,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function oOe(t,e,r){if(e!==t&&PH.error(`Invalid ${r} buffer size
 expected: ${t}, actual: ${e})`),e<t)throw new U("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function Pwt(t){return{isDraco:!1,isLegacy:!1,color:t.color!=null,normal:t.normal!=null,uv0:t.uv0!=null,uvRegion:t.uvRegion!=null,featureIndex:t.faceRange!=null&&t.featureId!=null}}function EUt(t,e){const r=sOe(t,e&&e.header);let i=r.byteCount;const s={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},n=r.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of e.ordering){if(!e.vertexAttributes[c])continue;const h={...e.vertexAttributes[c],byteOffset:i,count:o},d=$wt[c]||"_"+c;s.vertexAttributes[d]=h,i+=hD(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(e.faces&&a){s.faces={};for(const c of e.ordering){if(!e.faces[c])continue;const h={...e.faces[c],byteOffset:i,count:a};s.faces[c]=h,i+=hD(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&l){s.featureAttributes={};for(const c of e.featureAttributeOrder){if(!e.featureAttributes[c])continue;const h={...e.featureAttributes[c],byteOffset:i,count:l};s.featureAttributes[c]=h,i+=(h.valueType==="UInt64"?8:hD(h.valueType))*h.valuesPerElement*l}}return oOe(i,t.byteLength,"geometry"),s.byteCount=i-s.byteOffset,s}function CUt(t,e){return!t||!t.compressedAttributes||t.compressedAttributes.encoding!=="draco"?t?Pwt(t):Mwt(e):Iwt(t.compressedAttributes.attributes)}function Mwt(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t.ordering)if(t.vertexAttributes[r])switch(r){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}function Iwt(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t)switch(r){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}const $wt={position:E.POSITION,normal:E.NORMAL,color:E.COLOR,uv0:E.UV0,region:E.UVREGION};function Lwt(t,e,r){if(t.encoding==="lepcc-rgb")return Twt(e);if(t.encoding==="lepcc-intensity")return Ewt(e);if(t.encoding!=null&&t.encoding!=="")throw new U("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(PH.warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),t.ordering[0]==="ObjectIds"&&t.hasOwnProperty("objectIds")&&(PH.warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const i=Rwt(e,t,r);oOe(i.byteOffset+i.byteCount,e.byteLength,"attribute");const s=i.entries.attributeValues||i.entries.objectIds;if(s){if(s.valueType==="String"){const n=i.entries.attributeByteCounts,o=Due(e,n),a=Owt(e,s);return s.timeEncoding?Awt(n.count,o,a):nOe(n.count,o,a)}return Due(e,s)}throw new U("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const b6={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},Dwt={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function aOe(t){return b6.hasOwnProperty(t)}function hD(t){return aOe(t)?b6[t].BYTES_PER_ELEMENT:0}function Nwt(t,e,r,i){const s=Fwt(t,e,r),n=ve();return xl(r,s,n,i),n}const lOe=1,Nue=5-lOe;function Fwt(t,e,r){const i=A(),s=t[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/Nue)*Nue+lOe);if(r.isGeographic){const l=n/Nr(r).radius*180/Math.PI,c=Math.round(t[1]/l),h=Math.max(-90,Math.min(90,c*l)),d=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(t[0]/d)*d;i[0]=f,i[1]=h}else{const l=Math.round(t[0]/n),c=Math.round(t[1]/n);i[0]=l*n,i[1]=c*n}const o=t[2]+e,a=Math.round(o/n);return i[2]=a*n,i}function cOe(t){return t?parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10):void 0}function AUt(t){var e;if(oe("disable-feature:i3s-draco")||!t)return!1;for(const r of t)for(const i of r.geometryBuffers)if(((e=i.compressedAttributes)==null?void 0:e.encoding)==="draco")return!0;return!1}function OUt(t,e,r,i){r.traverse(e,s=>{const n=s.mbs;return(n!=null&&Uwt(t,n))!==ub.OUTSIDE&&(i(s),!0)})}function RUt(t,e,r){let i=0,s=0;for(let n=0;n<e.length&&i<t.length;n++)t[i]===e[n]&&(r(n)&&(t[s]=t[i],s++),i++);t.length=s}function PUt(t,e,r){let i=0,s=0;for(;i<r.length;)she(t,r[i])>=0===e&&(r[s]=r[i],s++),i++;r.length=s}const EC=kt();function MUt(t,e){if(e.rotationScale[1]===0&&e.rotationScale[2]===0&&e.rotationScale[3]===0&&e.rotationScale[5]===0&&e.rotationScale[6]===0&&e.rotationScale[7]===0)return EC[0]=(t[0]-e.position[0])/e.rotationScale[0],EC[1]=(t[1]-e.position[1])/e.rotationScale[4],EC[2]=(t[2]-e.position[0])/e.rotationScale[0],EC[3]=(t[3]-e.position[1])/e.rotationScale[4],EC}var ub;function Uwt(t,e){const r=e[0],i=e[1],s=e[3],n=t[0]-r,o=r-t[2],a=t[1]-i,l=i-t[3],c=Math.max(n,o,0),h=Math.max(a,l,0),d=c*c+h*h;return d>s*s?ub.OUTSIDE:d>0?ub.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?ub.INSIDE:ub.INTERSECTS_CENTER_INSIDE}function Vwt(t,e,r){const i=[],s=r&&r.missingFields,n=r&&r.originalFields;for(const o of t){const a=o.toLowerCase();let l=!1;for(const c of e)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return i}async function IUt(t,e,r,i,s){if(e.length===0)return[];const n=t.attributeStorageInfo;if(t.associatedLayer!=null)try{return await kwt(t.associatedLayer,e,r,i)}catch(o){if(t.associatedLayer.loaded)throw o}if(n){const o=zwt(e,r,s);if(o==null)throw new U("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=t.parsedUrl.path;return(await Promise.all(o.map(l=>Bwt(a,n,l.node,l.indices,i).then(c=>{for(let h=0;h<l.graphics.length;h++){const d=l.graphics[h],f=c[h];if(d.attributes)for(const m in d.attributes)m in f||(f[m]=d.attributes[m]);d.attributes=f}return l.graphics})))).flat()}throw new U("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function zwt(t,e,r){const i=new Map,s=[],n=r();for(const o of t){const a=o.attributes[e];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let d=i.get(c.node);d||(d={node:c.node,indices:[],graphics:[]},s.push(d),i.set(c.node,d)),d.indices.push(h),d.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function kwt(t,e,r,i){e.sort((l,c)=>l.attributes[r]-c.attributes[r]);const s=e.map(l=>l.attributes[r]),n=[],o=Vwt(i,t.fields,{originalFields:n}),a=await uOe(t,s,o);for(let l=0;l<e.length;l++){const c=e[l],h=a[l],d={};if(c.attributes)for(const f in c.attributes)d[f]=c.attributes[f];for(let f=0;f<n.length;f++)d[n[f]]=h[o[f]];c.attributes=d}return e}function uOe(t,e,r){const i=t.capabilities.query.maxRecordCount;if(i!=null&&e.length>i){const n=HOe(e,i);return Promise.all(n.map(o=>uOe(t,o,r))).then(o=>o.flat())}const s=new Z_({objectIds:e,outFields:r,orderByFields:[t.objectIdField]});return t.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===e.length)return n.features.map(o=>o.attributes);throw new U("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function Bwt(t,e,r,i,s){return hOe(t,e,r.resources.attributes,i,s)}function hOe(t,e,r,i,s){const n=[];for(const o of e)if(o&&s.includes(o.name)){const a=`${t}/nodes/${r}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return Zf(n.map(o=>Fr(o.url,{responseType:"array-buffer"}).then(a=>Lwt(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of i){const c={};for(let h=0;h<o.length;h++){const d=o[h].value;d!=null&&(c[n[h].storageInfo.name]=Hwt(d,l))}a.push(c)}return a})}(function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",t[t.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",t[t.INSIDE=3]="INSIDE"})(ub||(ub={}));const Gwt=-32768,jwt=-(2**31);function Hwt(t,e){if(!t)return null;const r=t[e];return H4(t)?r===Gwt?null:r:W4(t)?r===jwt?null:r:r!=r?null:r}function qwt(t){const e=t.store,r=e.indexCRS||e.geographicCRS,i=r===void 0?e.indexWKT:void 0;if(i){if(!t.spatialReference)throw new U("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new U("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new Ge(cOe(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function Wwt(t){const e=t.store,r=e.vertexCRS||e.projectedCRS,i=r===void 0?e.vertexWKT:void 0;if(i){if(!t.spatialReference)throw new U("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new U("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new Ge(cOe(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function $Ut(t,e){return e==null?"@null":e===zf(e)?"@ECEF":t.equals(e)?"":e.wkid!=null?"@"+e.wkid:null}function MH(t,e,r){if(!Uf(t,e))throw new U("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!Zwt(t,e))throw new U("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function LUt(t,e,r){var i,s;if(((i=t.serviceUpdateTimeStamp)==null?void 0:i.lastUpdate)!==((s=e.serviceUpdateTimeStamp)==null?void 0:s.lastUpdate)||!r.isEmpty||lc(t.associatedLayer,n=>n.url)!==lc(e.associatedLayer,n=>n.url))throw new U("layerview:recycle-failed")}function Zwt(t,e){return t.equals(e)||t.isWGS84&&e.isWebMercator||t.isWebMercator&&e.isWGS84}function Xwt(t,e,r){const i=qwt(t),s=Wwt(t);MH(i,e,r),MH(s,e,r)}function Ywt(t){return(t.geometryType==null||t.geometryType==="triangles")&&(t.topology==null||t.topology==="PerAttributeArray")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function DUt(t){if(t.store==null||t.store.defaultGeometrySchema==null||!Ywt(t.store.defaultGeometrySchema))throw new U("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:t.parsedUrl.path})}function NUt(t,e){Xwt(t,e.spatialReference,e.viewingMode)}function Jwt(t){return t.geometryType!=null&&t.geometryType==="points"&&(t.topology==null||t.topology==="PerAttributeArray")&&(t.encoding==null||t.encoding===""||t.encoding==="lepcc-xyz")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function FUt(t){if(t.store==null||t.store.defaultGeometrySchema==null||!Jwt(t.store.defaultGeometrySchema))throw new U("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function UUt(t,e){MH(t.spatialReference,e.spatialReference,e.viewingMode)}function Qwt(t){return t.type==="simple"||t.type==="class-breaks"||t.type==="unique-value"}function Kwt(t){return t.type==="mesh-3d"}function VUt(t){if(t==null||!Qwt(t)||(t.type==="unique-value"||t.type==="class-breaks")&&t.defaultSymbol==null)return!0;const e=t.getSymbols();if(e.length===0)return!0;for(const r of e){if(!Kwt(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||i.material==null||i.material.color==null||i.material.colorMixMode!=="replace")return!0}return!1}const zUt=qwe({color:[0,0,0,0],opacity:0});class ext{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function kUt(t){const e=new ext;let r=!1,i=!1;for(const s of t.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(n!=null&&!r){const a=n.color,l=ATe(n.colorMixMode);e.material=a!=null?{color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:{color:[1,1,1],alpha:1,colorMixMode:Us.Multiply},e.castShadows=s.castShadows,r=!0}o==null||i||(e.edgeMaterial=Hwe(o,{}),i=!0)}return e.material||(e.material={color:[1,1,1],alpha:1,colorMixMode:Us.Multiply}),e}function BUt(t,e){return(0|t)+(0|e)|0}function txt(t,e,r,i,s=0){i===zf(i)?e.isGeographic?axt(t,r,e,s):oxt(t,r,e,s):e.isWGS84&&(i.isWebMercator||hO(i))?rxt(e,t,i,r,s):e.isWebMercator&&hO(i)?nxt(e,t,i,r,s):t===r?(r.center[2]+=s,ai(r.center,e,0,r.center,i,0,1)):(se(r.center,t.center[0],t.center[1],t.center[2]+s),ai(r.center,e,0,r.center,i,0,1),NR(r.quaternion,t.quaternion),re(r.halfSize,t.halfSize))}function rxt(t,e,r,i,s){re(k0,e.center),k0[2]+=s;const n=zf(r);ai(k0,t,0,k0,n,0,1),dOe(n,e,k0,r,i)}const dD=new Array(24),ixt=new Ve(dD,3,!0),Fue=A(),k0=A(),sxt=Fi();function nxt(t,e,r,i,s){re(k0,e.center),k0[2]+=s,dOe(t,e,k0,r,i)}function dOe(t,e,r,i,s){const n=tF(sxt,e.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)Fue[a]=e.halfSize[a]*(o&1<<a?-1:1);for(let a=0;a<3;++a){let l=r[a];for(let c=0;c<3;++c)l+=Fue[c]*n[3*c+a];dD[3*o+a]=l}}ai(dD,t,0,dD,i,0,8),FEe(ixt,s)}function oxt(t,e,r,i){UEe(t,IH),se(e.center,t.center[0],t.center[1],t.center[2]+i),xl(r,e.center,$c,zf(r)),se(e.center,$c[12],$c[13],$c[14]);const s=2*Math.sqrt(1+$c[0]+$c[5]+$c[10]);tg[0]=($c[6]-$c[9])/s,tg[1]=($c[8]-$c[2])/s,tg[2]=($c[1]-$c[4])/s,tg[3]=.25*s,pF(e.quaternion,tg,t.quaternion),Gf(tg,e.quaternion);let n=0,o=0,a=0;for(const l of IH)l[2]+=i,ai(l,r,0,l,zf(r),0,1),bn(Ar,l,e.center),mc(Ar,Ar,tg),n=Math.max(n,Math.abs(Ar[0])),o=Math.max(o,Math.abs(Ar[1])),a=Math.max(a,Math.abs(Ar[2]));se(e.halfSize,n,o,a)}function axt(t,e,r,i){const s=Nr(r),n=1+Math.max(0,i)/(s.radius+t.center[2]);se(e.center,t.center[0],t.center[1],t.center[2]+i),ai(e.center,r,0,e.center,zf(r),0,1),NR(e.quaternion,t.quaternion),Gf(tg,t.quaternion),se(Ar,0,0,1),mc(Ar,Ar,tg),se(Ar,t.halfSize[0]*Math.abs(Ar[0]),t.halfSize[1]*Math.abs(Ar[1]),t.halfSize[2]*Math.abs(Ar[2])),ie(Ar,Ar,s.inverseFlattening),le(e.halfSize,t.halfSize,Ar),ie(e.halfSize,e.halfSize,n)}function GUt(t,e,r,i,s,n){if(!n||n.length===0||e==null||!t.mbs)return null;const o=Nwt(t.mbs,s,r,e);xn(g$,o);let a=null;const l=()=>{if(!a)if(a=IH,vc(m$),t.serviceObb!=null){txt(t.serviceObb,r,Uue,e,s),UEe(Uue,a);for(const m of a)$e(m,m,g$),f2(m$,m)}else{const m=t.mbs;if(!m)return;const y=m[3];js(m,r,Ar,e),$e(Ar,Ar,g$),Ar[2]+=s;for(let _=0;_<8;++_){const v=1&_?y:-y,w=2&_?y:-y,T=4&_?y:-y,x=a[_];re(x,[Ar[0]+v,Ar[1]+w,Ar[2]+T]),f2(m$,x)}}};let c=1/0,h=-1/0;const d=m=>{if(m.type!=="replace")return;const y=m.geometry;if(!(y!=null&&y.hasZ))return;vc(yV);const _=y.spatialReference||i,v=y.rings.reduce((w,T)=>T.reduce((x,S)=>(js(S,_,Ar,e),$e(Ar,Ar,g$),f2(yV,Ar),Math.min(Ar[2],x)),w),1/0);l(),_R(m$,yV)&&(c=Math.min(c,v),h=Math.max(h,v))};if(n.forEach(m=>d(m)),c===1/0)return null;const f=(m,y,_)=>{$e(Ar,_,o),m[y]=Ar[0],m[y+1]=Ar[1],m[y+2]=Ar[2],y+=24,_[2]=c,$e(Ar,_,o),m[y]=Ar[0],m[y+1]=Ar[1],m[y+2]=Ar[2],y+=24,_[2]=h,$e(Ar,_,o),m[y]=Ar[0],m[y+1]=Ar[1],m[y+2]=Ar[2]};for(let m=0;m<8;++m)f(Vue.data,3*m,a[m]);return FEe(Vue)}function jUt(t){return t!=null&&t.halfSize[0]>=0}function HUt(t){return t[3]>=0}function qUt(t){t!=null&&(t.halfSize[0]=-1)}function WUt(t){t!=null&&(t[3]=-1)}const $c=ve(),tg=PEe(),IH=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],yV=kt(),m$=kt(),Uue=kY(),Ar=A(),Vue={data:new Array(72),size:3,exclusive:!0,stride:3},g$=ve();async function lxt(t,e=t.popupTemplate){var h,d;if(e==null)return[];const r=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:i}=e,{objectIdField:s,typeIdField:n,globalIdField:o,relationships:a}=t;if(r.includes("*"))return["*"];const l=i?await SDe(t):[],c=m5(t.fieldsIndex,[...r,...l]);return n&&c.push(n),c&&s&&((h=t.fieldsIndex)!=null&&h.has(s))&&!c.includes(s)&&c.push(s),c&&o&&((d=t.fieldsIndex)!=null&&d.has(o))&&!c.includes(o)&&c.push(o),a&&a.forEach(f=>{var y;const{keyField:m}=f;c&&m&&((y=t.fieldsIndex)!=null&&y.has(m))&&!c.includes(m)&&c.push(m)}),c}function pOe(t,e){return t.popupTemplate?t.popupTemplate:e!=null&&e.defaultPopupTemplateEnabled&&t.defaultPopupTemplate!=null?t.defaultPopupTemplate:null}function ZUt(t,e){return pOe(t,{defaultPopupTemplateEnabled:e})!=null}const cxt=["3DObject","Point"],zue=YAe();let $t=class extends aAe(t1t(iAe(gAe(_Ae(cJ(lJ(rAe(ji(f5))))))))){constructor(...t){super(...t),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new Mt,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}destroy(){this._set("renderer",null)}getField(t){return this.fieldsIndex.get(t)}getFieldDomain(t,e){var i,s,n;const r=(s=(i=this.getFeatureType(e==null?void 0:e.feature))==null?void 0:i.domains)==null?void 0:s[t];return r&&r.type!=="inherited"?r:((n=this.getField(t))==null?void 0:n.domain)??null}getFeatureType(t){return t&&this.associatedLayer?this.associatedLayer.getFeatureType(t):null}get types(){var t;return((t=this.associatedLayer)==null?void 0:t.types)??[]}get typeIdField(){var t;return((t=this.associatedLayer)==null?void 0:t.typeIdField)??null}get templates(){var t;return((t=this.associatedLayer)==null?void 0:t.templates)??null}get formTemplate(){var t;return((t=this.associatedLayer)==null?void 0:t.formTemplate)??null}get fieldsIndex(){return new sJ(this.fields)}readNodePages(t,e,r){return e.layerType==="Point"&&(t=e.pointNodePages),t==null||typeof t!="object"?null:eb.fromJSON(t,r)}set elevationInfo(t){this._set("elevationInfo",t),this.loaded&&this._validateElevationInfo()}get geometryType(){return uxt[this.profile]||"mesh"}set renderer(t){HD(t,this.fieldsIndex),this._set("renderer",t)}readCachedDrawingInfo(t){return t!=null&&typeof t=="object"||(t={}),t.color==null&&(t.color=!1),t}get capabilities(){var S,O;const t=((S=this.associatedLayer)==null?void 0:S.capabilities)??r1t,{query:e,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:s,supportsGeometryUpdate:n,supportsReturnServiceEditsInSourceSpatialReference:o},data:{supportsZ:a,supportsM:l,isVersioned:c,supportsAttachment:h},operations:{supportsEditing:d,supportsAdd:f,supportsUpdate:m,supportsDelete:y,supportsQuery:_,supportsQueryAttachments:v,supportsAsyncConvert3D:w}}=t,T=t.operations.supportsChangeTracking,x=!!((O=this.associatedLayer)!=null&&O.infoFor3D)&&Qse();return{query:e,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:o,supportsRollbackOnFailure:i,supportsGeometryUpdate:x&&n,supportsUploadWithItemId:s},data:{supportsAttachment:h,supportsZ:a,supportsM:l,isVersioned:c},operations:{supportsQuery:_,supportsQueryAttachments:v,supportsEditing:d&&T,supportsAdd:x&&f&&T,supportsDelete:x&&y&&T,supportsUpdate:m&&T,supportsAsyncConvert3D:w}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}get infoFor3D(){var t;return((t=this.associatedLayer)==null?void 0:t.infoFor3D)??null}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeOID"&&(t=r.name),!!t)),t||void 0}readGlobalIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(t=r.name),!!t)),t||void 0}get displayField(){var t;return((t=this.associatedLayer)==null?void 0:t.displayField)??null}readProfile(t,e){const r=e.store.profile;return r!=null&&kue[r]?kue[r]:(Q.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(t){const e=t!=null?t.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},t).catch(Io).then(()=>this._fetchService(e)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,e),this._setAssociatedFeatureLayer(e),this._loadFilterGeometries()])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>JAe(this,{origin:"service"},e)).then(()=>HD(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(t));return this.addResolvingPromise(r),Promise.resolve(this)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(t){Q.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:t}),this.filter=null}}createQuery(){const t=new Z_;return this.geometryType!=="mesh"&&(t.returnGeometry=!0,t.returnZ=!0),t.where=this.definitionExpression||"1=1",t.sqlFormat="standard",t.outFields=["*"],t}queryExtent(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(t||this.createQuery(),e))}queryFeatureCount(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(t||this.createQuery(),e))}queryFeatures(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(t||this.createQuery(),e)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=this,i.sourceLayer=this;return r})}async queryCachedAttributes(t,e){const r=_De(this.fieldsIndex,await lxt(this,pOe(this)));return hOe(this.parsedUrl.path,this.attributeStorageInfo??[],t,e,r)}async queryCachedFeature(t,e){const r=await this.queryCachedAttributes(t,[e]);if(!r||r.length===0)throw new U("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const i=new hu;return i.attributes=r[0],i.layer=this,i.sourceLayer=this,i}queryObjectIds(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(t||this.createQuery(),e))}queryAttachments(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(t,e))}getFieldUsageInfo(t){const e={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[t]||e:(Q.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),e)}createPopupTemplate(t){return QAe(this,t)}_getAssociatedLayerForQuery(){const t=this.associatedLayer;return t!=null&&t.loaded?Promise.resolve(t):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new U("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(t){throw new U("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:t})}return this.associatedLayer}hasCachedStatistics(t){return this.statisticsInfo!=null&&this.statisticsInfo.some(e=>e.name===t)}async queryCachedStatistics(t,e){if(await this.load(e),!this.statisticsInfo)throw new U("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const r=this.fieldsIndex.get(t);if(!r)throw new U("scenelayer:field-unexisting",`Field '${t}' does not exist on the layer`);for(const i of this.statisticsInfo)if(i.name===r.name){const s=_c(this.parsedUrl.path,i.href);return Fr(s,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e?e.signal:null}).then(n=>n.data)}throw new U("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(t,e){return this._debouncedSaveOperations($S.SAVE_AS,{...e,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},t)}async save(){const t={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations($S.SAVE,t)}async applyEdits(t,e){const{applyEdits:r}=await ae(()=>import("./editingSupport-39e328b9.js"),["assets/editingSupport-39e328b9.js","assets/normalizeUtils-983801c4.js","assets/normalizeUtilsCommon-ecf4c6e7.js"]);if(await this.load(),!this.associatedLayer)throw new U(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),r(this,this.associatedLayer.source,t,e)}async uploadAssets(t,e){if(await this.load(),this.associatedLayer==null)throw new U(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(t,e)}on(t,e){return super.on(t,e)}validateLayer(t){if(t.layerType&&!cxt.includes(t.layerType))throw new U("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:t.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new U("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new U("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function e(r,i){let s=!1,n=!1;if(r==null)s=!0,n=!0;else{const o=i&&i.isGeographic;switch(r){case"east-north-up":case"earth-centered":s=!0,n=o;break;case"vertex-reference-frame":s=!0,n=!o;break;default:s=!1}}if(!s)throw new U("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new U("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}e(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const t=[];if(this.profile==="points")t.push("Point");else{if(this.profile!=="mesh-pyramids")throw new U("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);t.push("3DObject")}return t}_populateFieldUsageInfo(){var t,e;if(this._fieldUsageInfo={},this.fields)for(const r of this.fields){const i=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(o=>o.name===r.name)),s=!!((e=(t=this.associatedLayer)==null?void 0:t.fields)!=null&&e.some(o=>o&&r.name===o.name)),n={supportsLabelingInfo:i,supportsRenderer:i,supportsPopupTemplate:i||s,supportsLayerQuery:s};this._fieldUsageInfo[r.name]=n}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride()}_applyAssociatedLayerFieldsOverrides(){var e;if(!((e=this.associatedLayer)!=null&&e.fields))return;let t=null;for(const r of this.associatedLayer.fields){const i=this.getField(r.name);i?(!i.domain&&r.domain&&(i.domain=r.domain.clone()),i.editable=r.editable,i.nullable=r.nullable,i.length=r.length):(t||(t=this.fields?this.fields.slice():[]),t.push(r.clone()))}t&&this._set("fields",t)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const t=["popupTemplate","popupEnabled"],e=la(this);for(let r=0;r<t.length;r++){const i=t[r],s=this.originIdOf(i),n=this.associatedLayer.originIdOf(i);s<n&&(n===hr.SERVICE||n===hr.PORTAL_ITEM)&&e.setAtOrigin(i,this.associatedLayer[i],n)}}_applyAssociatedLayerExtentOverride(){var i,s,n,o,a,l,c;const t=(s=(i=this.associatedLayer)==null?void 0:i.editingInfo)==null?void 0:s.lastEditDate,e=(n=this.associatedLayer)==null?void 0:n.serverGens,r=(o=this.associatedLayer)==null?void 0:o.getAtOrigin("fullExtent","service");!Qse()||((a=this.associatedLayer)==null?void 0:a.infoFor3D)==null||!r||!YW((l=this.associatedLayer)==null?void 0:l.url)||!t||((c=this.serviceUpdateTimeStamp)==null?void 0:c.lastUpdate)===t.getTime()||!this.serviceUpdateTimeStamp&&(e==null?void 0:e.minServerGen)===(e==null?void 0:e.serverGen)||la(this).setAtOrigin("fullExtent",r.clone(),hr.SERVICE)}async _setAssociatedFeatureLayer(t){if(!["mesh-pyramids","points"].includes(this.profile))return;const e=new lwt(this.parsedUrl,this.portalItem,this.apiKey,t);try{this.associatedLayer=await e.fetch()}catch(r){ys(r)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await K2(()=>this.popupEnabled&&this.popupTemplate!=null);const t=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?Q.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):Q.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){const t=this.elevationInfo;t&&(this.profile==="mesh-pyramids"&&t.mode==="relative-to-scene"&&Q.getLogger(this).warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),t.featureExpressionInfo&&t.featureExpressionInfo.expression!=="0"&&Q.getLogger(this).warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([p({types:{key:"type",base:Cg,typeMap:{selection:Fj}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],$t.prototype,"featureReduction",void 0),u([p({type:[x0],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],$t.prototype,"rangeInfos",void 0),u([p({json:{read:!1}})],$t.prototype,"associatedLayer",void 0),u([p({type:["show","hide"]})],$t.prototype,"listMode",void 0),u([p({type:["ArcGISSceneServiceLayer"]})],$t.prototype,"operationalLayerType",void 0),u([p({json:{read:!1},readOnly:!0})],$t.prototype,"type",void 0),u([p({...zue.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],$t.prototype,"fields",void 0),u([p()],$t.prototype,"types",null),u([p()],$t.prototype,"typeIdField",null),u([p()],$t.prototype,"templates",null),u([p()],$t.prototype,"formTemplate",null),u([p({readOnly:!0})],$t.prototype,"fieldsIndex",null),u([p({type:LAe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],$t.prototype,"floorInfo",void 0),u([p(zue.outFields)],$t.prototype,"outFields",void 0),u([p({type:eb,readOnly:!0,json:{read:!1}})],$t.prototype,"nodePages",void 0),u([Se("service","nodePages",["nodePages","pointNodePages"])],$t.prototype,"readNodePages",null),u([p({type:[Gu],readOnly:!0})],$t.prototype,"materialDefinitions",void 0),u([p({type:[iA],readOnly:!0})],$t.prototype,"textureSetDefinitions",void 0),u([p({type:[nA],readOnly:!0})],$t.prototype,"geometryDefinitions",void 0),u([p({readOnly:!0})],$t.prototype,"serviceUpdateTimeStamp",void 0),u([p({readOnly:!0})],$t.prototype,"attributeStorageInfo",void 0),u([p({readOnly:!0})],$t.prototype,"statisticsInfo",void 0),u([p({type:Mt.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],$t.prototype,"excludeObjectIds",void 0),u([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],$t.prototype,"definitionExpression",void 0),u([p({type:bwt,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],$t.prototype,"filter",void 0),u([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],$t.prototype,"path",void 0),u([p(dAe)],$t.prototype,"elevationInfo",null),u([p({type:String})],$t.prototype,"geometryType",null),u([p(_6)],$t.prototype,"labelsVisible",void 0),u([p({type:[cP],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:z4},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:z4},write:!0}})],$t.prototype,"labelingInfo",void 0),u([p(hAe)],$t.prototype,"legendEnabled",void 0),u([p({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(t,e){var i,s;if(typeof t=="number"&&t>=0&&t<=1)return t;const r=(s=(i=e.layerDefinition)==null?void 0:i.drawingInfo)==null?void 0:s.transparency;return r!==void 0?H2(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],$t.prototype,"opacity",void 0),u([p({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],$t.prototype,"priority",void 0),u([p({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],$t.prototype,"semantic",void 0),u([p({types:K3e,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],$t.prototype,"renderer",null),u([p({json:{read:!1}})],$t.prototype,"cachedDrawingInfo",void 0),u([Se("service","cachedDrawingInfo")],$t.prototype,"readCachedDrawingInfo",null),u([p({readOnly:!0,json:{read:!1}})],$t.prototype,"capabilities",null),u([p({type:Boolean,json:{read:!1}})],$t.prototype,"editingEnabled",null),u([p({readOnly:!0,json:{write:!1,read:!1}})],$t.prototype,"infoFor3D",null),u([p(y6)],$t.prototype,"popupEnabled",void 0),u([p({type:ZS,json:{name:"popupInfo",write:!0}})],$t.prototype,"popupTemplate",void 0),u([p({readOnly:!0,json:{read:!1}})],$t.prototype,"defaultPopupTemplate",null),u([p({type:String,json:{read:!1}})],$t.prototype,"objectIdField",void 0),u([Se("service","objectIdField",["objectIdField","fields"])],$t.prototype,"readObjectIdField",null),u([p({type:String,json:{read:!1}})],$t.prototype,"globalIdField",void 0),u([Se("service","globalIdField",["globalIdField","fields"])],$t.prototype,"readGlobalIdField",null),u([p({readOnly:!0,type:String,json:{read:!1}})],$t.prototype,"displayField",null),u([p({type:String,json:{read:!1}})],$t.prototype,"profile",void 0),u([Se("service","profile",["store.profile"])],$t.prototype,"readProfile",null),u([p({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],$t.prototype,"normalReferenceFrame",void 0),u([p(cAe)],$t.prototype,"screenSizePerspectiveEnabled",void 0),$t=u([R("esri.layers.SceneLayer")],$t);const kue={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},uxt={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},vJ=$t,XUt=Object.freeze(Object.defineProperty({__proto__:null,default:vJ},Symbol.toStringTag,{value:"Module"}));let Ym=class extends MAe(cJ(f5)){constructor(t){super(t),this.elevationInfo=null,this.graphics=new xb,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(t){return this.graphics.add(t),this}addMany(t){return this.graphics.addMany(t),this}removeAll(){return this.graphics.removeAll(),this}remove(t){this.graphics.remove(t)}removeMany(t){this.graphics.removeMany(t)}on(t,e){return super.on(t,e)}graphicChanged(t){this.emit("graphic-update",t)}};u([p({type:lAe})],Ym.prototype,"elevationInfo",void 0),u([p(tN(xb,"graphics"))],Ym.prototype,"graphics",void 0),u([p({type:["show","hide"]})],Ym.prototype,"listMode",void 0),u([p()],Ym.prototype,"screenSizePerspectiveEnabled",void 0),u([p({readOnly:!0})],Ym.prototype,"type",void 0),u([p({constructOnly:!0})],Ym.prototype,"internal",void 0),Ym=u([R("esri.layers.GraphicsLayer")],Ym);const hxt=Ym;var fOe={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},bJ={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},dxt=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],k4={CSS:{},springs:{}};function wf(t,e,r){return Math.min(Math.max(t,e),r)}function rO(t,e){return t.indexOf(e)>-1}function _V(t,e){return t.apply(null,e)}var Lt={arr:function(t){return Array.isArray(t)},obj:function(t){return rO(Object.prototype.toString.call(t),"Object")},pth:function(t){return Lt.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return t.nodeType||Lt.svg(t)},str:function(t){return typeof t=="string"},fnc:function(t){return typeof t=="function"},und:function(t){return typeof t>"u"},nil:function(t){return Lt.und(t)||t===null},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return Lt.hex(t)||Lt.rgb(t)||Lt.hsl(t)},key:function(t){return!fOe.hasOwnProperty(t)&&!bJ.hasOwnProperty(t)&&t!=="targets"&&t!=="keyframes"}};function mOe(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map(function(r){return parseFloat(r)}):[]}function gOe(t,e){var r=mOe(t),i=wf(Lt.und(r[0])?1:r[0],.1,100),s=wf(Lt.und(r[1])?100:r[1],.1,100),n=wf(Lt.und(r[2])?10:r[2],.1,100),o=wf(Lt.und(r[3])?0:r[3],.1,100),a=Math.sqrt(s/i),l=n/(2*Math.sqrt(s*i)),c=l<1?a*Math.sqrt(1-l*l):0,h=1,d=l<1?(l*a+-o)/c:-o+a;function f(y){var _=e?e*y/1e3:y;return l<1?_=Math.exp(-_*l*a)*(h*Math.cos(c*_)+d*Math.sin(c*_)):_=(h+d*_)*Math.exp(-_*a),y===0||y===1?y:1-_}function m(){var y=k4.springs[t];if(y)return y;for(var _=1/6,v=0,w=0;;)if(v+=_,f(v)===1){if(w++,w>=16)break}else w=0;var T=v*_*1e3;return k4.springs[t]=T,T}return e?f:m}function pxt(t){return t===void 0&&(t=10),function(e){return Math.ceil(wf(e,1e-6,1)*t)*(1/t)}}var fxt=function(){var t=11,e=1/(t-1);function r(h,d){return 1-3*d+3*h}function i(h,d){return 3*d-6*h}function s(h){return 3*h}function n(h,d,f){return((r(d,f)*h+i(d,f))*h+s(d))*h}function o(h,d,f){return 3*r(d,f)*h*h+2*i(d,f)*h+s(d)}function a(h,d,f,m,y){var _,v,w=0;do v=d+(f-d)/2,_=n(v,m,y)-h,_>0?f=v:d=v;while(Math.abs(_)>1e-7&&++w<10);return v}function l(h,d,f,m){for(var y=0;y<4;++y){var _=o(d,f,m);if(_===0)return d;var v=n(d,f,m)-h;d-=v/_}return d}function c(h,d,f,m){if(!(0<=h&&h<=1&&0<=f&&f<=1))return;var y=new Float32Array(t);if(h!==d||f!==m)for(var _=0;_<t;++_)y[_]=n(_*e,h,f);function v(w){for(var T=0,x=1,S=t-1;x!==S&&y[x]<=w;++x)T+=e;--x;var O=(w-y[x])/(y[x+1]-y[x]),C=T+O*e,P=o(C,h,f);return P>=.001?l(w,C,h,f):P===0?C:a(w,T,T+e,h,f)}return function(w){return h===d&&f===m||w===0||w===1?w:n(v(w),d,m)}}return c}(),yOe=function(){var t={linear:function(){return function(i){return i}}},e={Sine:function(){return function(i){return 1-Math.cos(i*Math.PI/2)}},Circ:function(){return function(i){return 1-Math.sqrt(1-i*i)}},Back:function(){return function(i){return i*i*(3*i-2)}},Bounce:function(){return function(i){for(var s,n=4;i<((s=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((s*3-2)/22-i,2)}},Elastic:function(i,s){i===void 0&&(i=1),s===void 0&&(s=.5);var n=wf(i,1,10),o=wf(s,.1,2);return function(a){return a===0||a===1?a:-n*Math.pow(2,10*(a-1))*Math.sin((a-1-o/(Math.PI*2)*Math.asin(1/n))*(Math.PI*2)/o)}}},r=["Quad","Cubic","Quart","Quint","Expo"];return r.forEach(function(i,s){e[i]=function(){return function(n){return Math.pow(n,s+2)}}}),Object.keys(e).forEach(function(i){var s=e[i];t["easeIn"+i]=s,t["easeOut"+i]=function(n,o){return function(a){return 1-s(n,o)(1-a)}},t["easeInOut"+i]=function(n,o){return function(a){return a<.5?s(n,o)(a*2)/2:1-s(n,o)(a*-2+2)/2}},t["easeOutIn"+i]=function(n,o){return function(a){return a<.5?(1-s(n,o)(1-a*2))/2:(s(n,o)(a*2-1)+1)/2}}}),t}();function wJ(t,e){if(Lt.fnc(t))return t;var r=t.split("(")[0],i=yOe[r],s=mOe(t);switch(r){case"spring":return gOe(t,e);case"cubicBezier":return _V(fxt,s);case"steps":return _V(pxt,s);default:return _V(i,s)}}function _Oe(t){try{var e=document.querySelectorAll(t);return e}catch{return}}function w6(t,e){for(var r=t.length,i=arguments.length>=2?arguments[1]:void 0,s=[],n=0;n<r;n++)if(n in t){var o=t[n];e.call(i,o,n,t)&&s.push(o)}return s}function x6(t){return t.reduce(function(e,r){return e.concat(Lt.arr(r)?x6(r):r)},[])}function Bue(t){return Lt.arr(t)?t:(Lt.str(t)&&(t=_Oe(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function xJ(t,e){return t.some(function(r){return r===e})}function TJ(t){var e={};for(var r in t)e[r]=t[r];return e}function $H(t,e){var r=TJ(t);for(var i in t)r[i]=e.hasOwnProperty(i)?e[i]:t[i];return r}function T6(t,e){var r=TJ(t);for(var i in e)r[i]=Lt.und(t[i])?e[i]:t[i];return r}function mxt(t){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t);return e?"rgba("+e[1]+",1)":t}function gxt(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,r=t.replace(e,function(a,l,c,h){return l+l+c+c+h+h}),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r),s=parseInt(i[1],16),n=parseInt(i[2],16),o=parseInt(i[3],16);return"rgba("+s+","+n+","+o+",1)"}function yxt(t){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),r=parseInt(e[1],10)/360,i=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100,n=e[4]||1;function o(f,m,y){return y<0&&(y+=1),y>1&&(y-=1),y<1/6?f+(m-f)*6*y:y<1/2?m:y<2/3?f+(m-f)*(2/3-y)*6:f}var a,l,c;if(i==0)a=l=c=s;else{var h=s<.5?s*(1+i):s+i-s*i,d=2*s-h;a=o(d,h,r+1/3),l=o(d,h,r),c=o(d,h,r-1/3)}return"rgba("+a*255+","+l*255+","+c*255+","+n+")"}function _xt(t){if(Lt.rgb(t))return mxt(t);if(Lt.hex(t))return gxt(t);if(Lt.hsl(t))return yxt(t)}function Ag(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function vxt(t){if(rO(t,"translate")||t==="perspective")return"px";if(rO(t,"rotate")||rO(t,"skew"))return"deg"}function LH(t,e){return Lt.fnc(t)?t(e.target,e.id,e.total):t}function xf(t,e){return t.getAttribute(e)}function SJ(t,e,r){var i=Ag(e);if(xJ([r,"deg","rad","turn"],i))return e;var s=k4.CSS[e+r];if(!Lt.und(s))return s;var n=100,o=document.createElement(t.tagName),a=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;a.appendChild(o),o.style.position="absolute",o.style.width=n+r;var l=n/o.offsetWidth;a.removeChild(o);var c=l*parseFloat(e);return k4.CSS[e+r]=c,c}function vOe(t,e,r){if(e in t.style){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),s=t.style[e]||getComputedStyle(t).getPropertyValue(i)||"0";return r?SJ(t,s,r):s}}function EJ(t,e){if(Lt.dom(t)&&!Lt.inp(t)&&(!Lt.nil(xf(t,e))||Lt.svg(t)&&t[e]))return"attribute";if(Lt.dom(t)&&xJ(dxt,e))return"transform";if(Lt.dom(t)&&e!=="transform"&&vOe(t,e))return"css";if(t[e]!=null)return"object"}function bOe(t){if(Lt.dom(t)){for(var e=t.style.transform||"",r=/(\w+)\(([^)]*)\)/g,i=new Map,s;s=r.exec(e);)i.set(s[1],s[2]);return i}}function bxt(t,e,r,i){var s=rO(e,"scale")?1:0+vxt(e),n=bOe(t).get(e)||s;return r&&(r.transforms.list.set(e,n),r.transforms.last=e),i?SJ(t,n,i):n}function CJ(t,e,r,i){switch(EJ(t,e)){case"transform":return bxt(t,e,i,r);case"css":return vOe(t,e,r);case"attribute":return xf(t,e);default:return t[e]||0}}function AJ(t,e){var r=/^(\*=|\+=|-=)/.exec(t);if(!r)return t;var i=Ag(t)||0,s=parseFloat(e),n=parseFloat(t.replace(r[0],""));switch(r[0][0]){case"+":return s+n+i;case"-":return s-n+i;case"*":return s*n+i}}function wOe(t,e){if(Lt.col(t))return _xt(t);if(/\s/g.test(t))return t;var r=Ag(t),i=r?t.substr(0,t.length-r.length):t;return e?i+e:i}function OJ(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function wxt(t){return Math.PI*2*xf(t,"r")}function xxt(t){return xf(t,"width")*2+xf(t,"height")*2}function Txt(t){return OJ({x:xf(t,"x1"),y:xf(t,"y1")},{x:xf(t,"x2"),y:xf(t,"y2")})}function xOe(t){for(var e=t.points,r=0,i,s=0;s<e.numberOfItems;s++){var n=e.getItem(s);s>0&&(r+=OJ(i,n)),i=n}return r}function Sxt(t){var e=t.points;return xOe(t)+OJ(e.getItem(e.numberOfItems-1),e.getItem(0))}function TOe(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return wxt(t);case"rect":return xxt(t);case"line":return Txt(t);case"polyline":return xOe(t);case"polygon":return Sxt(t)}}function Ext(t){var e=TOe(t);return t.setAttribute("stroke-dasharray",e),e}function Cxt(t){for(var e=t.parentNode;Lt.svg(e)&&Lt.svg(e.parentNode);)e=e.parentNode;return e}function SOe(t,e){var r=e||{},i=r.el||Cxt(t),s=i.getBoundingClientRect(),n=xf(i,"viewBox"),o=s.width,a=s.height,l=r.viewBox||(n?n.split(" "):[0,0,o,a]);return{el:i,viewBox:l,x:l[0]/1,y:l[1]/1,w:o,h:a,vW:l[2],vH:l[3]}}function Axt(t,e){var r=Lt.str(t)?_Oe(t)[0]:t,i=e||100;return function(s){return{property:s,el:r,svg:SOe(r),totalLength:TOe(r)*(i/100)}}}function Oxt(t,e,r){function i(h){h===void 0&&(h=0);var d=e+h>=1?e+h:0;return t.el.getPointAtLength(d)}var s=SOe(t.el,t.svg),n=i(),o=i(-1),a=i(1),l=r?1:s.w/s.vW,c=r?1:s.h/s.vH;switch(t.property){case"x":return(n.x-s.x)*l;case"y":return(n.y-s.y)*c;case"angle":return Math.atan2(a.y-o.y,a.x-o.x)*180/Math.PI}}function Gue(t,e){var r=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,i=wOe(Lt.pth(t)?t.totalLength:t,e)+"";return{original:i,numbers:i.match(r)?i.match(r).map(Number):[0],strings:Lt.str(t)||e?i.split(r):[]}}function RJ(t){var e=t?x6(Lt.arr(t)?t.map(Bue):Bue(t)):[];return w6(e,function(r,i,s){return s.indexOf(r)===i})}function EOe(t){var e=RJ(t);return e.map(function(r,i){return{target:r,id:i,total:e.length,transforms:{list:bOe(r)}}})}function Rxt(t,e){var r=TJ(e);if(/^spring/.test(r.easing)&&(r.duration=gOe(r.easing)),Lt.arr(t)){var i=t.length,s=i===2&&!Lt.obj(t[0]);s?t={value:t}:Lt.fnc(e.duration)||(r.duration=e.duration/i)}var n=Lt.arr(t)?t:[t];return n.map(function(o,a){var l=Lt.obj(o)&&!Lt.pth(o)?o:{value:o};return Lt.und(l.delay)&&(l.delay=a?0:e.delay),Lt.und(l.endDelay)&&(l.endDelay=a===n.length-1?e.endDelay:0),l}).map(function(o){return T6(o,r)})}function Pxt(t){for(var e=w6(x6(t.map(function(n){return Object.keys(n)})),function(n){return Lt.key(n)}).reduce(function(n,o){return n.indexOf(o)<0&&n.push(o),n},[]),r={},i=function(n){var o=e[n];r[o]=t.map(function(a){var l={};for(var c in a)Lt.key(c)?c==o&&(l.value=a[c]):l[c]=a[c];return l})},s=0;s<e.length;s++)i(s);return r}function Mxt(t,e){var r=[],i=e.keyframes;i&&(e=T6(Pxt(i),e));for(var s in e)Lt.key(s)&&r.push({name:s,tweens:Rxt(e[s],t)});return r}function Ixt(t,e){var r={};for(var i in t){var s=LH(t[i],e);Lt.arr(s)&&(s=s.map(function(n){return LH(n,e)}),s.length===1&&(s=s[0])),r[i]=s}return r.duration=parseFloat(r.duration),r.delay=parseFloat(r.delay),r}function $xt(t,e){var r;return t.tweens.map(function(i){var s=Ixt(i,e),n=s.value,o=Lt.arr(n)?n[1]:n,a=Ag(o),l=CJ(e.target,t.name,a,e),c=r?r.to.original:l,h=Lt.arr(n)?n[0]:c,d=Ag(h)||Ag(l),f=a||d;return Lt.und(o)&&(o=c),s.from=Gue(h,f),s.to=Gue(AJ(o,h),f),s.start=r?r.end:0,s.end=s.start+s.delay+s.duration+s.endDelay,s.easing=wJ(s.easing,s.duration),s.isPath=Lt.pth(n),s.isPathTargetInsideSVG=s.isPath&&Lt.svg(e.target),s.isColor=Lt.col(s.from.original),s.isColor&&(s.round=1),r=s,s})}var COe={css:function(t,e,r){return t.style[e]=r},attribute:function(t,e,r){return t.setAttribute(e,r)},object:function(t,e,r){return t[e]=r},transform:function(t,e,r,i,s){if(i.list.set(e,r),e===i.last||s){var n="";i.list.forEach(function(o,a){n+=a+"("+o+") "}),t.style.transform=n}}};function AOe(t,e){var r=EOe(t);r.forEach(function(i){for(var s in e){var n=LH(e[s],i),o=i.target,a=Ag(n),l=CJ(o,s,a,i),c=a||Ag(l),h=AJ(wOe(n,c),l),d=EJ(o,s);COe[d](o,s,h,i.transforms,!0)}})}function Lxt(t,e){var r=EJ(t.target,e.name);if(r){var i=$xt(e,t),s=i[i.length-1];return{type:r,property:e.name,animatable:t,tweens:i,duration:s.end,delay:i[0].delay,endDelay:s.endDelay}}}function Dxt(t,e){return w6(x6(t.map(function(r){return e.map(function(i){return Lxt(r,i)})})),function(r){return!Lt.und(r)})}function OOe(t,e){var r=t.length,i=function(n){return n.timelineOffset?n.timelineOffset:0},s={};return s.duration=r?Math.max.apply(Math,t.map(function(n){return i(n)+n.duration})):e.duration,s.delay=r?Math.min.apply(Math,t.map(function(n){return i(n)+n.delay})):e.delay,s.endDelay=r?s.duration-Math.max.apply(Math,t.map(function(n){return i(n)+n.duration-n.endDelay})):e.endDelay,s}var jue=0;function Nxt(t){var e=$H(fOe,t),r=$H(bJ,t),i=Mxt(r,t),s=EOe(t.targets),n=Dxt(s,i),o=OOe(n,r),a=jue;return jue++,T6(e,{id:a,children:[],animatables:s,animations:n,duration:o.duration,delay:o.delay,endDelay:o.endDelay})}var Dd=[],ROe=function(){var t;function e(){!t&&(!Hue()||!un.suspendWhenDocumentHidden)&&Dd.length>0&&(t=requestAnimationFrame(r))}function r(s){for(var n=Dd.length,o=0;o<n;){var a=Dd[o];a.paused?(Dd.splice(o,1),n--):(a.tick(s),o++)}t=o>0?requestAnimationFrame(r):void 0}function i(){un.suspendWhenDocumentHidden&&(Hue()?t=cancelAnimationFrame(t):(Dd.forEach(function(s){return s._onDocumentVisibility()}),ROe()))}return typeof document<"u"&&document.addEventListener("visibilitychange",i),e}();function Hue(){return!!document&&document.hidden}function un(t){t===void 0&&(t={});var e=0,r=0,i=0,s,n=0,o=null;function a(T){var x=window.Promise&&new Promise(function(S){return o=S});return T.finished=x,x}var l=Nxt(t);a(l);function c(){var T=l.direction;T!=="alternate"&&(l.direction=T!=="normal"?"normal":"reverse"),l.reversed=!l.reversed,s.forEach(function(x){return x.reversed=l.reversed})}function h(T){return l.reversed?l.duration-T:T}function d(){e=0,r=h(l.currentTime)*(1/un.speed)}function f(T,x){x&&x.seek(T-x.timelineOffset)}function m(T){if(l.reversePlayback)for(var S=n;S--;)f(T,s[S]);else for(var x=0;x<n;x++)f(T,s[x])}function y(T){for(var x=0,S=l.animations,O=S.length;x<O;){var C=S[x],P=C.animatable,$=C.tweens,V=$.length-1,z=$[V];V&&(z=w6($,function(ft){return T<ft.end})[0]||z);for(var B=wf(T-z.start-z.delay,0,z.duration)/z.duration,k=isNaN(B)?1:z.easing(B),Z=z.to.strings,W=z.round,j=[],Y=z.to.numbers.length,M=void 0,D=0;D<Y;D++){var N=void 0,G=z.to.numbers[D],X=z.from.numbers[D]||0;z.isPath?N=Oxt(z.value,k*G,z.isPathTargetInsideSVG):N=X+k*(G-X),W&&(z.isColor&&D>2||(N=Math.round(N*W)/W)),j.push(N)}var J=Z.length;if(!J)M=j[0];else{M=Z[0];for(var ee=0;ee<J;ee++){Z[ee];var ye=Z[ee+1],Me=j[ee];isNaN(Me)||(ye?M+=Me+ye:M+=Me+" ")}}COe[C.type](P.target,C.property,M,P.transforms),C.currentValue=M,x++}}function _(T){l[T]&&!l.passThrough&&l[T](l)}function v(){l.remaining&&l.remaining!==!0&&l.remaining--}function w(T){var x=l.duration,S=l.delay,O=x-l.endDelay,C=h(T);l.progress=wf(C/x*100,0,100),l.reversePlayback=C<l.currentTime,s&&m(C),!l.began&&l.currentTime>0&&(l.began=!0,_("begin")),!l.loopBegan&&l.currentTime>0&&(l.loopBegan=!0,_("loopBegin")),C<=S&&l.currentTime!==0&&y(0),(C>=O&&l.currentTime!==x||!x)&&y(x),C>S&&C<O?(l.changeBegan||(l.changeBegan=!0,l.changeCompleted=!1,_("changeBegin")),_("change"),y(C)):l.changeBegan&&(l.changeCompleted=!0,l.changeBegan=!1,_("changeComplete")),l.currentTime=wf(C,0,x),l.began&&_("update"),T>=x&&(r=0,v(),l.remaining?(e=i,_("loopComplete"),l.loopBegan=!1,l.direction==="alternate"&&c()):(l.paused=!0,l.completed||(l.completed=!0,_("loopComplete"),_("complete"),!l.passThrough&&"Promise"in window&&(o(),a(l)))))}return l.reset=function(){var T=l.direction;l.passThrough=!1,l.currentTime=0,l.progress=0,l.paused=!0,l.began=!1,l.loopBegan=!1,l.changeBegan=!1,l.completed=!1,l.changeCompleted=!1,l.reversePlayback=!1,l.reversed=T==="reverse",l.remaining=l.loop,s=l.children,n=s.length;for(var x=n;x--;)l.children[x].reset();(l.reversed&&l.loop!==!0||T==="alternate"&&l.loop===1)&&l.remaining++,y(l.reversed?l.duration:0)},l._onDocumentVisibility=d,l.set=function(T,x){return AOe(T,x),l},l.tick=function(T){i=T,e||(e=i),w((i+(r-e))*un.speed)},l.seek=function(T){w(h(T))},l.pause=function(){l.paused=!0,d()},l.play=function(){l.paused&&(l.completed&&l.reset(),l.paused=!1,Dd.push(l),d(),ROe())},l.reverse=function(){c(),l.completed=!l.reversed,d()},l.restart=function(){l.reset(),l.play()},l.remove=function(T){var x=RJ(T);POe(x,l)},l.reset(),l.autoplay&&l.play(),l}function que(t,e){for(var r=e.length;r--;)xJ(t,e[r].animatable.target)&&e.splice(r,1)}function POe(t,e){var r=e.animations,i=e.children;que(t,r);for(var s=i.length;s--;){var n=i[s],o=n.animations;que(t,o),!o.length&&!n.children.length&&i.splice(s,1)}!r.length&&!i.length&&e.pause()}function Fxt(t){for(var e=RJ(t),r=Dd.length;r--;){var i=Dd[r];POe(e,i)}}function Uxt(t,e){e===void 0&&(e={});var r=e.direction||"normal",i=e.easing?wJ(e.easing):null,s=e.grid,n=e.axis,o=e.from||0,a=o==="first",l=o==="center",c=o==="last",h=Lt.arr(t),d=parseFloat(h?t[0]:t),f=h?parseFloat(t[1]):0,m=Ag(h?t[1]:t)||0,y=e.start||0+(h?d:0),_=[],v=0;return function(w,T,x){if(a&&(o=0),l&&(o=(x-1)/2),c&&(o=x-1),!_.length){for(var S=0;S<x;S++){if(!s)_.push(Math.abs(o-S));else{var O=l?(s[0]-1)/2:o%s[0],C=l?(s[1]-1)/2:Math.floor(o/s[0]),P=S%s[0],$=Math.floor(S/s[0]),V=O-P,z=C-$,B=Math.sqrt(V*V+z*z);n==="x"&&(B=-V),n==="y"&&(B=-z),_.push(B)}v=Math.max.apply(Math,_)}i&&(_=_.map(function(Z){return i(Z/v)*v})),r==="reverse"&&(_=_.map(function(Z){return n?Z<0?Z*-1:-Z:Math.abs(v-Z)}))}var k=h?(f-d)/v:d;return y+k*(Math.round(_[T]*100)/100)+m}}function Vxt(t){t===void 0&&(t={});var e=un(t);return e.duration=0,e.add=function(r,i){var s=Dd.indexOf(e),n=e.children;s>-1&&Dd.splice(s,1);function o(f){f.passThrough=!0}for(var a=0;a<n.length;a++)o(n[a]);var l=T6(r,$H(bJ,t));l.targets=l.targets||t.targets;var c=e.duration;l.autoplay=!1,l.direction=e.direction,l.timelineOffset=Lt.und(i)?c:AJ(i,c),o(e),e.seek(l.timelineOffset);var h=un(l);o(h),n.push(h);var d=OOe(n,t);return e.delay=d.delay,e.endDelay=d.endDelay,e.duration=d.duration,e.seek(0),e.reset(),e.autoplay&&e.play(),e},e}un.version="3.2.1";un.speed=1;un.suspendWhenDocumentHidden=!0;un.running=Dd;un.remove=Fxt;un.get=CJ;un.set=AOe;un.convertPx=SJ;un.path=Axt;un.setDashoffset=Ext;un.stagger=Uxt;un.timeline=Vxt;un.easing=wJ;un.penner=yOe;un.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};const MOe={type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[240,240,240,.7]},edges:{type:"solid",color:[0,0,0,.6],size:.5}}]}},zxt=new vJ({url:"https://tiles.arcgis.com/tiles/uX5kr9HIx4qXytm9/arcgis/rest/services/Designated_3D_Buildings/SceneServer",renderer:MOe,popupEnabled:!1}),kxt=new vJ({url:"https://tiles.arcgis.com/tiles/uX5kr9HIx4qXytm9/arcgis/rest/services/NonDesignated_3D_Buildings/SceneServer",renderer:MOe,popupEnabled:!1}),IOe=new Qpe({basemap:{portalItem:{id:"75a08e8cd8b64dcfa6945bb7f624ccc5"}},ground:"world-elevation",layers:[zxt,kxt]});new W_t({map:IOe,zoom:13,viewingMode:"local",qualityProfile:"high",container:"viewDiv",camera:{position:{latitude:40.682252429650674,longitude:-73.92907468482736,z:8555.69067688151},tilt:46.88991231380563,heading:299.4493985836785}});const Bxt={latitude:40.735505,longitude:-74.02105},Gxt={latitude:40.699483,longitude:-74.02496},$Oe=new hxt({elevationInfo:{mode:"relative-to-ground"},opacity:.7});IOe.add($Oe);const hb=new hu({symbol:{type:"point-3d",symbolLayers:[{type:"object",resource:{href:"MerchantShip.glb"},height:50,heading:185,tilt:0,anchor:"bottom"}]},geometry:new ct({...Bxt,z:-6})});$Oe.add(hb);const Wue=hb.geometry,Zue=hb.symbol.symbolLayers.getItemAt(0),jxt=un.timeline({autoplay:!0,targets:[Wue,Zue],loop:!0,duration:14e4,update:function(){hb.geometry=Wue.clone(),hb.symbol=hb.symbol.clone(),hb.symbol.symbolLayers=[Zue]}}).add({...Gxt,easing:"linear"});jxt.play();export{bXe as $,uCe as A,sft as B,k_e as C,YN as D,Kke as E,Get as F,oet as G,het as H,GY as I,XX as J,yut as K,gut as L,i6 as M,_ut as N,t4 as O,iKe as P,Uft as Q,gCe as R,Lze as S,kft as T,vCe as U,Spt as V,Gft as W,xCe as X,Uet as Y,l6 as Z,XSe as _,U_e as a,Ff as a$,tmt as a0,umt as a1,wmt as a2,Tmt as a3,Emt as a4,BKe as a5,TCe as a6,smt as a7,Bmt as a8,Zrt as a9,Uct as aA,As as aB,kS as aC,lu as aD,vn as aE,ae as aF,UA as aG,GH as aH,ja as aI,Ga as aJ,h5 as aK,Wi as aL,V2 as aM,Jxt as aN,gu as aO,Hs as aP,E as aQ,Ve as aR,RS as aS,gn as aT,QX as aU,Iw as aV,Dt as aW,Tn as aX,Ti as aY,js as aZ,Ge as a_,Eit as aa,aot as ab,Aot as ac,wot as ad,Ef as ae,Mi as af,zr as ag,Pe as ah,u as ai,p as aj,Zd as ak,R as al,Gq as am,kQ as an,xe as ao,Uf as ap,U as aq,xh as ar,d_ as as,ade as at,Mt as au,ue as av,jr as aw,Lb as ax,tG as ay,hu as az,ave as b,lN as b$,ot as b0,ge as b1,se as b2,Q as b3,A as b4,mO as b5,xO as b6,Ovt as b7,ys as b8,PPt as b9,tw as bA,D_ as bB,Gt as bC,Yxt as bD,xV as bE,nhe as bF,FR as bG,L6t as bH,$6t as bI,yo as bJ,K as bK,m$e as bL,Db as bM,_Le as bN,vLe as bO,p5 as bP,m2 as bQ,fb as bR,yAe as bS,f2t as bT,JAe as bU,qn as bV,tCt as bW,_o as bX,ct as bY,yR as bZ,_r as b_,MPt as ba,f5 as bb,fYe as bc,Vg as bd,Z_ as be,zRt as bf,MIt as bg,LUt as bh,ZUt as bi,Qse as bj,pt as bk,qwt as bl,PUt as bm,O1t as bn,d$t as bo,p$e as bp,pOe as bq,_De as br,lxt as bs,ZDe as bt,ww as bu,ke as bv,Z0 as bw,bw as bx,JS as by,xt as bz,kBe as c,Sw as c$,Y2 as c0,X4 as c1,HMe as c2,Po as c3,qMe as c4,WMe as c5,ZMe as c6,_e as c7,RAe as c8,slt as c9,Fr as cA,ii as cB,b$ as cC,YYe as cD,ln as cE,SSt as cF,xPt as cG,kt as cH,vc as cI,s1t as cJ,N6t as cK,$pe as cL,x6e as cM,db as cN,Nb as cO,zq as cP,Vq as cQ,Ype as cR,kq as cS,F2t as cT,R2t as cU,EUt as cV,Due as cW,SUt as cX,Lwt as cY,N5 as cZ,TO as c_,oe as ca,Uo as cb,DVe as cc,K2 as cd,Qt as ce,iCt as cf,FDt as cg,EY as ch,M5 as ci,t5 as cj,Ls as ck,Za as cl,hr as cm,mw as cn,llt as co,yh as cp,eMe as cq,dwt as cr,De as cs,de as ct,Vge as cu,Cye as cv,ji as cw,Ae as cx,et as cy,Og as cz,P7e as d,mDe as d$,fw as d0,Ik as d1,Ts as d2,Mk as d3,Lk as d4,oN as d5,Ige as d6,g2t as d7,zO as d8,h$e as d9,sue as dA,xq as dB,U6t as dC,GOe as dD,SH as dE,Zf as dF,k6t as dG,z6t as dH,Gvt as dI,m2t as dJ,zpt as dK,kpt as dL,$pt as dM,O5t as dN,S4 as dO,D4t as dP,Gpt as dQ,DMe as dR,sJ as dS,oYe as dT,$De as dU,JJe as dV,QJe as dW,Bq as dX,_xe as dY,gPt as dZ,mPt as d_,as as da,Lxe as db,iy as dc,Ow as dd,MVe as de,HTt as df,iAe as dg,gAe as dh,_Ae as di,lJ as dj,Cct as dk,Bi as dl,Io as dm,Ect as dn,lO as dp,Se as dq,Tw as dr,uAe as ds,rL as dt,HJ as du,Wd as dv,rTt as dw,dbt as dx,pbt as dy,fbt as dz,z7e as e,Hxt as e$,Zq as e0,rSt as e1,iSt as e2,K2t as e3,tSt as e4,sa as e5,fLe as e6,yPt as e7,DJe as e8,PEe as e9,b1t as eA,lg as eB,cEt as eC,em as eD,mde as eE,Jbt as eF,lS as eG,Ji as eH,$F as eI,l_ as eJ,mb as eK,uz as eL,Ha as eM,hxt as eN,Md as eO,YW as eP,Jc as eQ,yr as eR,US as eS,LFt as eT,NFt as eU,$Ft as eV,r3e as eW,XFt as eX,h0t as eY,kFt as eZ,n0t as e_,CC as ea,ai as eb,Zr as ec,Gf as ed,mc as ee,ns as ef,aN as eg,Xf as eh,pAt as ei,e2e as ej,RP as ek,W5e as el,zS as em,MAe as en,Tct as eo,cJ as ep,uO as eq,Yr as er,fAe as es,hAe as et,xc as eu,Ph as ev,O5 as ew,k_ as ex,qbt as ey,rAe as ez,TJe as f,HRt as f$,IFt as f0,YFt as f1,s6e as f2,re as f3,$e as f4,ve as f5,Mhe as f6,AV as f7,Lge as f8,RIt as f9,zo as fA,Qi as fB,r5 as fC,oi as fD,oa as fE,Ig as fF,$i as fG,SFt as fH,lz as fI,D6t as fJ,Jce as fK,Pg as fL,Hvt as fM,QAe as fN,r1t as fO,hOe as fP,eb as fQ,Gu as fR,iA as fS,nA as fT,lAe as fU,K3e as fV,y6 as fW,ZS as fX,Rr as fY,YAe as fZ,$w as f_,Xpe as fa,iO as fb,U_ as fc,g_ as fd,nIe as fe,pge as ff,xr as fg,kTt as fh,s2t as fi,d$ as fj,gue as fk,_c as fl,lc as fm,w6t as fn,Vct as fo,yEt as fp,B4 as fq,$9e as fr,uu as fs,UQ as ft,Dr as fu,Vwt as fv,Qc as fw,rp as fx,Y3t as fy,_R as fz,vZ as g,efe as g$,jRt as g0,$_ as g1,dp as g2,qR as g3,v_ as g4,Rut as g5,Lyt as g6,Hq as g7,Qu as g8,BQ as g9,ARt as gA,pc as gB,tb as gC,mi as gD,le as gE,_s as gF,lUe as gG,Bd as gH,cp as gI,bb as gJ,JSt as gK,mUe as gL,Is as gM,Wxt as gN,xMe as gO,B2 as gP,aq as gQ,VOe as gR,Br as gS,IG as gT,$G as gU,S5 as gV,w_ as gW,Bbt as gX,Vbt as gY,P1t as gZ,HD as g_,$g as ga,gr as gb,vR as gc,ka as gd,oVe as ge,CR as gf,AS as gg,y1t as gh,sO as gi,uQ as gj,qTt as gk,MFt as gl,S2t as gm,Rd as gn,Rge as go,Cie as gp,ec as gq,LMe as gr,ERt as gs,po as gt,x6t as gu,wvt as gv,jT as gw,Vk as gx,PRt as gy,w2t as gz,DBe as h,FLt as h$,dAe as h0,_6 as h1,cP as h2,z4 as h3,Dj as h4,g6 as h5,cAe as h6,gJ as h7,XAe as h8,oDe as h9,gs as hA,Ye as hB,pi as hC,flt as hD,Le as hE,i8e as hF,U0 as hG,Gs as hH,Di as hI,go as hJ,LZ as hK,yFt as hL,ISe as hM,Lo as hN,Xwt as hO,AUt as hP,IUt as hQ,E2t as hR,FEe as hS,Cve as hT,MIe as hU,G2 as hV,$Rt as hW,j0 as hX,o8e as hY,she as hZ,Hwt as h_,nDe as ha,RLe as hb,RQ as hc,la as hd,t1t as he,Lg as hf,$S as hg,Gb as hh,wSt as hi,zQ as hj,u2 as hk,Df as hl,Hd as hm,aR as hn,fJ as ho,kvt as hp,zvt as hq,Vvt as hr,T2t as hs,dJ as ht,L as hu,ce as hv,Gi as hw,ar as hx,Kr as hy,kd as hz,Rxe as i,zf as i$,olt as i0,uA as i1,RC as i2,pO as i3,uPt as i4,wr as i5,gc as i6,wl as i7,b as i8,ms as i9,MF as iA,No as iB,jX as iC,RF as iD,hE as iE,OKe as iF,aZ as iG,cX as iH,j3t as iI,rw as iJ,VF as iK,Da as iL,vGe as iM,DU as iN,cAt as iO,uAt as iP,PN as iQ,Ate as iR,r6e as iS,xn as iT,Sge as iU,Mh as iV,Ba as iW,nn as iX,wW as iY,G3t as iZ,na as i_,mu as ia,Je as ib,Oe as ic,XN as id,rm as ie,st as ig,Er as ih,wc as ii,be as ij,F as ik,gi as il,Pr as im,Cr as io,br as ip,Ot as iq,ry as ir,eF as is,q_ as it,Al as iu,OF as iv,jt as iw,Hf as ix,F_ as iy,W_ as iz,cw as j,X1t as j$,xl as j0,ni as j1,A_ as j2,qIt as j3,jIt as j4,WIt as j5,I5 as j6,HIt as j7,pit as j8,git as j9,ESt as jA,qs as jB,iTt as jC,aw as jD,V6t as jE,NAe as jF,HH as jG,jb as jH,NT as jI,I1t as jJ,cUt as jK,LAe as jL,$b as jM,gD as jN,_X as jO,VS as jP,m6 as jQ,q1t as jR,g1t as jS,sy as jT,aJ as jU,H3e as jV,iUt as jW,rUt as jX,tUt as jY,hbt as jZ,aAe as j_,Fi as ja,fit as jb,mit as jc,KN as jd,Li as je,Ft as jf,ch as jg,he as jh,Sne as ji,i2 as jj,Q3t as jk,Ne as jl,$s as jm,zOe as jn,cu as jo,Qxt as jp,wTt as jq,Bhe as jr,zH as js,Jr as jt,bh as ju,Mge as jv,I6 as jw,yK as jx,V2t as jy,J2 as jz,Zut as k,Ah as k$,J1t as k0,D0e as k1,$1t as k2,L1t as k3,D1t as k4,F1t as k5,U1t as k6,V1t as k7,z1t as k8,k1t as k9,O2e as kA,wu as kB,BA as kC,Rb as kD,m2e as kE,bst as kF,dit as kG,oQe as kH,bxe as kI,b2t as kJ,lQe as kK,Yit as kL,jit as kM,Hit as kN,Qit as kO,Wit as kP,Zit as kQ,op as kR,qit as kS,ca as kT,Jit as kU,$R as kV,lF as kW,an as kX,aQe as kY,Xit as kZ,uF as k_,B1t as ka,G1t as kb,j1t as kc,H1t as kd,ZAe as ke,rCt as kf,HPe as kg,ZFt as kh,WFt as ki,Zmt as kj,L6e as kk,s5 as kl,Lq as km,U6 as kn,Nr as ko,RUt as kp,sr as kq,cc as kr,hW as ks,jFt as kt,d_t as ku,GFt as kv,JFt as kw,BFt as kx,nte as ky,C2e as kz,$Qe as l,TIt as l$,j_ as l0,A2 as l1,qa as l2,yx as l3,m5 as l4,Q4 as l5,Rg as l6,Q2t as l7,Y2t as l8,jJ as l9,Yi as lA,I as lB,XTt as lC,hR as lD,Hwe as lE,Us as lF,OR as lG,MH as lH,tTt as lI,gw as lJ,nlt as lK,ilt as lL,s8e as lM,NTt as lN,vPt as lO,_Pt as lP,nwe as lQ,TRt as lR,Lpe as lS,$ge as lT,yf as lU,FIt as lV,dG as lW,yTt as lX,jot as lY,nMe as lZ,uIt as l_,IRt as la,R1t as lb,Z2t as lc,X2t as ld,J2t as le,gO as lf,ru as lg,sSt as lh,Twe as li,SG as lj,GSt as lk,Ode as ll,HSt as lm,jSt as ln,ie as lo,pf as lp,PO as lq,Vo as lr,Gn as ls,hf as lt,mSt as lu,ZSt as lv,i1e as lw,Ew as lx,Oh as ly,N0 as lz,yht as m,sMe as m$,cIt as m0,aIt as m1,HT as m2,Qtt as m3,lIt as m4,HFt as m5,h_t as m6,zFt as m7,c_t as m8,UFt as m9,Yde as mA,y2t as mB,Qde as mC,Js as mD,Ut as mE,yme as mF,d5e as mG,t2t as mH,HV as mI,wh as mJ,Cd as mK,nr as mL,oc as mM,KW as mN,QW as mO,Gr as mP,iEt as mQ,vUe as mR,p6 as mS,oP as mT,za as mU,NSt as mV,dEt as mW,che as mX,tq as mY,BTt as mZ,pR as m_,VFt as ma,qFt as mb,DFt as mc,y_t as md,FFt as me,qg as mf,Fye as mg,DUe as mh,Yt as mi,TFt as mj,Qo as mk,CV as ml,fVe as mm,AO as mn,vo as mo,Bge as mp,HUe as mq,lEt as mr,ir as ms,ou as mt,Et as mu,Hi as mv,H_ as mw,G_ as mx,v2t as my,BIt as mz,QEe as n,wi as n$,i5 as n0,i2t as n1,ahe as n2,fc as n3,xde as n4,lq as n5,zTt as n6,sQ as n7,Ume as n8,sq as n9,me as nA,n4t as nB,a4t as nC,xSt as nD,z5e as nE,v1 as nF,i4t as nG,txt as nH,ON as nI,ei as nJ,CSt as nK,iRt as nL,ube as nM,Ni as nN,ZX as nO,Sr as nP,nu as nQ,iz as nR,Jb as nS,sF as nT,Tc as nU,ty as nV,mo as nW,Ke as nX,Ir as nY,Ee as nZ,aa as n_,Eh as na,ey as nb,Cte as nc,du as nd,lAt as ne,$Pt as nf,Ch as ng,pS as nh,Eke as ni,hZ as nj,G6e as nk,Rw as nl,dze as nm,eh as nn,Ue as no,ur as np,n5 as nq,k2t as nr,Dg as ns,f_ as nt,Nme as nu,Q2 as nv,GTt as nw,u6 as nx,EH as ny,VIe as nz,Xpt as o,rF as o$,Ame as o0,l4t as o1,c4t as o2,h4t as o3,uW as o4,ra as o5,rUe as o6,x5 as o7,Fe as o8,up as o9,uQe as oA,SRt as oB,Wpe as oC,DLe as oD,M2t as oE,NIe as oF,GIe as oG,yxe as oH,vq as oI,a2t as oJ,cTe as oK,JKe as oL,Va as oM,Wa as oN,D2 as oO,rvt as oP,_b as oQ,fu as oR,HF as oS,zt as oT,Cl as oU,Sc as oV,ha as oW,Ih as oX,eu as oY,QSt as oZ,RR as o_,Lr as oa,Tr as ob,pFt as oc,pVe as od,CLt as oe,FUt as of,UUt as og,gf as oh,AR as oi,Dpe as oj,_we as ok,x3 as ol,Iye as om,EFt as on,bN as oo,cA as op,a_ as oq,wPt as or,Eie as os,TPt as ot,z2t as ou,pPt as ov,fxe as ow,gxe as ox,dxe as oy,Mie as oz,tCe as p,PF as p$,bbe as p0,YSt as p1,mZe as p2,Ol as p3,uBe as p4,pu as p5,g3t as p6,f3t as p7,m3t as p8,eUe as p9,Pf as pA,cte as pB,f2 as pC,bo as pD,cn as pE,Pk as pF,KTt as pG,QTt as pH,lt as pI,xee as pJ,VH as pK,yYe as pL,FRt as pM,LW as pN,pSt as pO,KSt as pP,mN as pQ,Dge as pR,D2t as pS,wee as pT,Kf as pU,V5 as pV,EW as pW,Th as pX,ap as pY,vS as pZ,ho as p_,d2 as pa,ZZe as pb,SS as pc,uLe as pd,tu as pe,NYe as pf,d7 as pg,fX as ph,uGe as pi,q6e as pj,j6e as pk,ug as pl,NH as pm,eGe as pn,jTt as po,fo as pp,sEt as pq,Gge as pr,CS as ps,S_ as pt,hc as pu,$6e as pv,tEt as pw,rEt as px,Wb as py,ZV as pz,Qpt as q,VUt as q$,mbe as q0,Abe as q1,tt as q2,uX as q3,Ud as q4,TSt as q5,$W as q6,jse as q7,X3t as q8,OO as q9,Tye as qA,VUe as qB,Fg as qC,H5 as qD,dGe as qE,XSt as qF,hte as qG,J3t as qH,dR as qI,Cw as qJ,fi as qK,oEt as qL,k2 as qM,JFe as qN,Cf as qO,jAe as qP,Hx as qQ,E1t as qR,Pme as qS,phe as qT,XOe as qU,_2t as qV,Eje as qW,jUt as qX,HUt as qY,mFt as qZ,kY as q_,_me as qa,lwt as qb,F6t as qc,m_ as qd,eEt as qe,c6 as qf,uN as qg,TKe as qh,vFt as qi,NRt as qj,cS as qk,wFt as ql,bFt as qm,gR as qn,bn as qo,L2t as qp,bee as qq,qp as qr,SO as qs,NW as qt,tS as qu,fSt as qv,BHe as qw,FW as qx,yge as qy,eS as qz,eft as r,Xt as r$,DUt as r0,NUt as r1,$Ut as r2,yI as r3,Rbe as r4,gpt as r5,Nwt as r6,H6e as r7,o4t as r8,GUt as r9,WUt as rA,qUt as rB,sS as rC,gUe as rD,yg as rE,tY as rF,qF as rG,Xr as rH,x4t as rI,FTt as rJ,CUt as rK,BH as rL,gTt as rM,IO as rN,hO as rO,GRt as rP,q_e as rQ,qdt as rR,u4t as rS,t_ as rT,oUe as rU,Wwt as rV,Ree as rW,OUt as rX,FQ as rY,glt as rZ,e5 as r_,Fwt as ra,C6e as rb,Zae as rc,$2 as rd,H3t as re,iS as rf,D6e as rg,Ps as rh,ySe as ri,Uwt as rj,ub as rk,BUt as rl,YS as rm,kUt as rn,Wt as ro,Txe as rp,Sxe as rq,kRt as rr,zUt as rs,MUt as rt,STe as ru,v2e as rv,kde as rw,Eye as rx,EL as ry,p$t as rz,aCe as s,nEt as s$,HOe as s0,iwe as s1,swe as s2,n2t as s3,Zst as s4,sC as s5,C5 as s6,ER as s7,A5 as s8,TR as s9,Ms as sA,Pat as sB,hoe as sC,LG as sD,Yh as sE,w4 as sF,$Dt as sG,x4 as sH,ic as sI,sc as sJ,FG as sK,DG as sL,UG as sM,NG as sN,doe as sO,oye as sP,r_e as sQ,l5 as sR,MW as sS,kD as sT,aze as sU,Q0e as sV,Gg as sW,z5 as sX,TA as sY,G5 as sZ,Lye as s_,UAe as sa,O5e as sb,eUt as sc,uat as sd,$Je as se,MJe as sf,KRt as sg,QRt as sh,Ug as si,CPt as sj,Bn as sk,Fo as sl,ILt as sm,kX as sn,Bo as so,ETt as sp,Zc as sq,n$ as sr,DRt as ss,zk as st,RRt as su,iJe as sv,E5 as sw,xw as sx,hat as sy,xX as sz,sCe as t,Sl as t$,mze as t0,IVe as t1,hYe as t2,N2t as t3,eTt as t4,KDt as t5,$2t as t6,S1t as t7,LRt as t8,nc as t9,OIt as tA,Exe as tB,U4 as tC,ATt as tD,Nd as tE,U3e as tF,eO as tG,M$e as tH,pF as tI,UD as tJ,o5 as tK,sIe as tL,iIe as tM,r2t as tN,uPe as tO,EDt as tP,LDt as tQ,LTe as tR,Y1 as tS,poe as tT,SDt as tU,ADt as tV,X1 as tW,xDt as tX,_9 as tY,AL as tZ,Wf as t_,mTt as ta,evt as tb,Pet as tc,zc as td,vr as te,on as tf,Vs as tg,Ct as th,xi as ti,Do as tj,nX as tk,kf as tl,tRt as tm,At as tn,St as to,Xe as tp,b6t as tq,fPt as tr,fE as ts,iJ as tt,X_t as tu,Y_t as tv,f6 as tw,B3e as tx,AIt as ty,wQe as tz,rve as u,qLe as u$,Sh as u0,Ywe as u1,rh as u2,Zlt as u3,Xlt as u4,oA as u5,Avt as u6,hDe as u7,k5e as u8,SPt as u9,Wst as uA,pY as uB,D2e as uC,fY as uD,N2e as uE,kit as uF,mG as uG,gbt as uH,ybt as uI,_bt as uJ,mrt as uK,C2t as uL,Qoe as uM,Woe as uN,ILe as uO,Zoe as uP,uae as uQ,Xoe as uR,U2t as uS,tae as uT,_ae as uU,vae as uV,bae as uW,P2t as uX,Nq as uY,Ipe as uZ,A2t as u_,bPt as ua,OFe as ub,C6t as uc,Ok as ud,w8 as ue,x8 as uf,Zxt as ug,Xxt as uh,hPt as ui,i1t as uj,x_ as uk,P6t as ul,Rpe as um,vde as un,wEe as uo,Sht as up,_Ee as uq,Uht as ur,n1 as us,NY as ut,DY as uu,Poe as uv,wht as uw,Ioe as ux,jtt as uy,dY as uz,bke as v,JDe as v$,FLe as v0,O2t as v1,wae as v2,I2t as v3,ASt as v4,hIt as v5,xIt as v6,cae as v7,pae as v8,_It as v9,dIt as vA,qot as vB,Ztt as vC,qq as vD,b_ as vE,DC as vF,s5e as vG,i5e as vH,r5e as vI,XDe as vJ,NC as vK,p2t as vL,a5e as vM,QFt as vN,hEt as vO,l9e as vP,a9e as vQ,sW as vR,tD as vS,EIt as vT,j4 as vU,l5e as vV,Hyt as vW,PRe as vX,QD as vY,eN as vZ,_O as v_,yIt as va,Bot as vb,vIt as vc,bIt as vd,Ose as ve,Pse as vf,Rse as vg,mIt as vh,gIt as vi,Goe as vj,Loe as vk,Doe as vl,Noe as vm,rae as vn,Rae as vo,Iae as vp,joe as vq,Pae as vr,T5 as vs,QTe as vt,wIt as vu,qtt as vv,Wtt as vw,pIt as vx,fIt as vy,JTe as vz,F_e as w,sTt as w0,eSt as w1,m5e as w2,g5e as w3,ree as w4,PIt as w5,CIt as w6,aW as w7,U_t as w8,xFt as w9,hUt as wA,XUt as wB,pEt as wa,d6 as wb,e2t as wc,JTt as wd,YTt as we,a5 as wf,eKe as wg,Xat as wh,c_ as wi,Pwe as wj,i_e as wk,i3 as wl,p2 as wm,ez as wn,Xa as wo,z2 as wp,UH as wq,WEt as wr,Yrt as ws,iw as wt,qSt as wu,URt as wv,RPt as ww,h$t as wx,_6t as wy,Y6t as wz,Yke as x,EA as y,rft as z};
