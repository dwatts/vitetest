(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function u(t,e,r,i){var s,n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function gwt(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(h){try{c(i.next(h))}catch(p){o(p)}}function l(h){try{c(i.throw(h))}catch(p){o(p)}}function c(h){h.done?n(h.value):s(h.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}const LAe="modulepreload",DAe=function(t){return"/vitetest/"+t},nJ={},ae=function(e,r,i){if(!r||r.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=DAe(n),n in nJ)return;nJ[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const p=s[h];if(p.href===n&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":LAe,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((h,p)=>{c.addEventListener("load",h),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function NAe(t){return t&&t.release&&typeof t.release=="function"}function FAe(t){return t&&t.acquire&&typeof t.acquire=="function"}let No=class iV{constructor(e,r,i,s=1,n=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let r;if(iV.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):FAe(r)&&r.acquire(...e),r}release(e){e&&!iV.test.disabled&&(this._releaseFunction?this._releaseFunction(e):NAe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};No.test={disabled:!1};function UAe(t){t.length=0}let rc=class{constructor(e=50,r=50){this._pool=new No(Array,void 0,UAe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return u6.acquire()}static release(e){return u6.release(e)}static prune(){u6.prune()}};const u6=new rc(100);function _wt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function VAe(t,e){for(const r of t)if(r!=null&&e(r))return r}function sV(t){return t!=null&&typeof t[Symbol.iterator]=="function"}function oc(t,e){return t!=null?e(t):null}function Ql(t,e){return M4(t,e),t}function M4(t,e){if(t==null)throw new Error(e??"value is None")}function Pe(t){return t==null||t.destroy(),null}function Fe(t){return t==null||t.dispose(),null}function Li(t){return t==null||t.remove(),null}function ou(t){return t==null||t.abort(),null}function ki(t){return t==null||t.release(),null}function zAe(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function CS(t){return null}function vwt(t,e){const r=new Array;for(const i of t)r.push(i!=null?e(i):null);return r}function bwt(t,e){for(const r of t)oc(r,e)}function wwt(t){return t}let Pi=class nV{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(sV(e)){const i=this._getOrCreateGroup(r);for(const s of e)this._isHandle(s)&&i.push(s)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&sV(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof nV)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof nV?r.removeAll():r.remove()}};const Tue=Symbol("Accessor-beforeDestroy");function P2(t){return Ba(()=>t.forEach(e=>e!=null&&e.remove()))}function Ba(t){return{remove:()=>{t&&(t(),t=void 0)}}}function xwt(t){return Ba(t!=null?()=>t.destroy():void 0)}let J3=class Mv{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Mv._m}getInt(){return this._seed=(Mv._a*this._seed+Mv._c)%Mv._m,this._seed}getFloat(){return this.getInt()/(Mv._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/Mv._m*i}};J3._m=2147483647,J3._a=48271,J3._c=0;const $4=1.5,kAe=1/$4,BAe=.5;function I4(t,e){return e?t.filter((r,i,s)=>s.findIndex(e.bind(null,r))===i):t.filter((r,i,s)=>s.indexOf(r)===i)}function wg(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function _H(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function GAe(t,e,r){let i,s;return r?(i=e.filter(n=>!t.some(o=>r(o,n))),s=t.filter(n=>!e.some(o=>r(o,n)))):(i=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:i,removed:s}}function jAe(t){return t&&typeof t.length=="number"}function HAe(t,e){const r=t.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=e)i.push(t.slice(s,s+e));return i}const qAe=!!Array.prototype.fill;function Twt(t,e){if(qAe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function WAe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function Sue(t,e,r){const i=t.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return r?e>=t[i-1]?-1:o===e?s:s-1:o===e?s:-1}let Eue=class{constructor(){this.last=0}};const Cue=new Eue;function oV(t,e,r,i){i=i||Cue;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(t[o]===e)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(t[o]===e)return i.last=o,o;return-1}function XA(t,e,r,i){const s=r??t.length,n=oV(t,e,s,i);if(n!==-1)return t[n]=t[s-1],r==null&&t.pop(),e}const Nh=new Set;function XAe(t,e,r=t.length,i=e.length,s,n){if(i===0||r===0)return r;Nh.clear();for(let a=0;a<i;++a)Nh.add(e[a]);s=s||Cue;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(Nh.has(t[a])&&(n&&n.push(t[a]),Nh.delete(t[a]),t[a]=t[r-1],--r,--a,Nh.size===0||r===0))return Nh.clear(),r;for(let a=0;a<o;++a)if(Nh.has(t[a])&&(n&&n.push(t[a]),Nh.delete(t[a]),t[a]=t[r-1],--r,--a,Nh.size===0||r===0))return Nh.clear(),r;return Nh.clear(),r}function ZAe(t,e){let r=0;for(let i=0;i<t.length;++i){const s=t[i];e(s,i)&&(t[r]=s,r++)}t.length=r}function YAe(t){return t?(oJ.seed=t,()=>oJ.getFloat()):Math.random}function Ewt(t,e){const r=YAe(e);for(let i=t.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=t[i];t[i]=t[s],t[s]=n}return t}const oJ=new J3;function vH(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function Cwt(t,e){const r=new Map,i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e(n,s,t),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function nw(t,e){return t!=null}const JAe=[];let D0;function oe(t){return typeof D0[t]=="function"?D0[t]=D0[t](globalThis):D0[t]}var mue,gue,yue,_ue;D0=(mue=globalThis.dojoConfig)!=null&&mue.has||(gue=globalThis.esriConfig)!=null&&gue.has?{...(yue=globalThis.dojoConfig)==null?void 0:yue.has,...(_ue=globalThis.esriConfig)==null?void 0:_ue.has}:{},oe.add=(t,e,r,i)=>((i||D0[t]===void 0)&&(D0[t]=e),r&&oe(t)),oe.cache=D0,oe.add("esri-deprecation-warnings",!0),oe.add("esri-force-fullscreen-debug",!1),(()=>{var e;oe.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(oe.add("host-browser",t),oe.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),oe.add("dom",t),oe("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(oe.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),oe.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),oe.add("khtml",s.includes("Konqueror")?n:void 0),oe.add("edge",parseFloat(i.split("Edge/")[1])||void 0),oe.add("opr",parseFloat(i.split("OPR/")[1])||void 0),oe.add("webkit",!oe("wp")&&!oe("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),oe.add("chrome",!oe("edge")&&!oe("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),oe.add("android",!oe("wp")&&parseFloat(i.split("Android ")[1])||void 0),oe.add("safari",!s.includes("Safari")||oe("wp")||oe("chrome")||oe("android")||oe("edge")||oe("opr")?void 0:parseFloat(s.split("Version/")[1])),oe.add("mac",s.includes("Macintosh")),!oe("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));oe.add(o,l),oe.add("ios",l)}oe("webkit")||(!i.includes("Gecko")||oe("wp")||oe("khtml")||oe("edge")||oe.add("mozilla",n),oe("mozilla")&&oe.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&oe.add("esri-mobile",e),r&&oe.add("esri-iPhone",r),oe.add("esri-geolocation",!!navigator.geolocation)}oe.add("esri-wasm","WebAssembly"in globalThis),oe.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),oe.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),oe.add("esri-atomics","Atomics"in globalThis),oe.add("esri-workers","Worker"in globalThis),oe.add("web-feat:cache","caches"in globalThis),oe.add("esri-workers-arraybuffer-transfer",!oe("safari")||Number(oe("safari"))>=12),oe.add("workers-pool-size",8),oe.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),oe.add("featurelayer-simplify-payload-size-factors",[1,1,4]),oe.add("featurelayer-animation-enabled",!0),oe.add("featurelayer-snapshot-enabled",!0),oe.add("featurelayer-snapshot-point-min-threshold",8e4),oe.add("featurelayer-snapshot-point-max-threshold",4e5),oe.add("featurelayer-snapshot-point-coverage",.1),oe.add("featurelayer-advanced-symbols",!1),oe.add("featurelayer-pbf",!0),oe.add("featurelayer-pbf-statistics",!1),oe.add("feature-layers-workers",!0),oe.add("feature-polyline-generalization-factor",1),oe.add("mapview-transitions-duration",200),oe.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),oe.add("mapserver-pbf-version-support",10.81),oe.add("mapservice-popup-identify-max-tolerance",20),oe.add("heatmap-allow-raster-fallback",!1),oe.add("heatmap-force-raster",!1),oe("host-webworker")||oe("host-browser")&&(oe.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),oe.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{oe.add("esri-image-decode",!0,!0,!0)}).catch(()=>{oe.add("esri-image-decode",!1,!0,!0)})}return!1}),oe.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function yC(t){return t instanceof ArrayBuffer}function bH(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function N0(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function Aue(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function L4(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function D4(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function N4(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function F4(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function AS(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function OS(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function Jd(t){return!("buffer"in t)}function F0(t){return t!=null?Jd(t)?8*t.length+12:t.byteLength+Oue:0}const Oue=145,au=1024;function QAe(t){return OS(t)||AS(t)||N4(t)||L4(t)||bH(t)}function KAe(t){return OS(t)||AS(t)}function eOe(t){return OS(t)?179769e303:AS(t)?3402823e32:F4(t)?4294967295:D4(t)?65535:N0(t)||Aue(t)?255:N4(t)?2147483647:L4(t)?32767:bH(t)?127:256}function Rue(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&Rue(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function Q(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=$ue(t);if(e!=null)return e;if(sD(t))return t.clone();if(Pue(t))return t.map(Q);if(Mue(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=Q(t[i]);return r}function aV(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=$ue(t);if(e!=null)return e;if(Pue(t)){let r=!0;const i=t.map(s=>{const n=aV(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(sD(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!Mue(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const s=t[i],n=aV(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function sD(t){return typeof t.clone=="function"}function Pue(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Mue(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function aJ(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function $ue(t){if(bH(t)||N0(t)||Aue(t)||L4(t)||D4(t)||N4(t)||F4(t)||AS(t)||OS(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,Q(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(Q(r));return e}return null}function wH(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function Iue(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&wg(t,e):t instanceof Set?e instanceof Set&&rOe(t,e):t instanceof Map?e instanceof Map&&iOe(t,e):!!aJ(t)&&aJ(e)&&tOe(t,e))}function tOe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function rOe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function iOe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s!==i||s===void 0&&!e.has(r))return!1}return!0}function oa(t){return t.__accessor__??null}function sOe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function lI(t,e,r){return r?nD(t,e,{policy:r,path:""}):nD(t,e,null)}function nD(t,e,r){return e?Object.keys(e).reduce((i,s)=>{const n=s;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${s}`:s,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[n]))return i[n]=e[n],i;if(i[n]===void 0)return i[n]=Q(e[n]),i;let l=i[n],c=e[n];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[n]=l.concat():i[n]=[l]:i[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(h=>{l.includes(h)||l.push(h)}));else if(c&&typeof c=="object")if(r){const h=r.path;r.path=o,i[n]=nD(l,c,r),r.path=h}else i[n]=nD(l,c,null);else i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[n]=c);return i},t||{}):t}function Lue(t){return Array.isArray(t)?t:t.split(".")}function lJ(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function nOe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...lJ(r));return e}return lJ(t)}function Due(t,e,r,i){const s=nOe(e);if(s.length!==1){const n=s.map(o=>i(t,o,r));return P2(n)}return i(t,s[0],r)}function xH(t){let e=!1;return()=>{e||(e=!0,t())}}function Nue(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const i=oa(e);return sOe(i,r)?i.get(r):e[r]}function Fue(t,e,r){if(t==null)return t;const i=Nue(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:Fue(i,e,r+1)}function KO(t,e,r=0){return typeof e!="string"||e.includes(".")?Fue(t,Lue(e),r):Nue(e,t)}function oD(t,e){return KO(t,e)}function cJ(t,e){return KO(e,t)!==void 0}function eR(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=Q(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function tR(t,e){const r=eR(t);let i=r[e];return i||(i=r[e]={}),i}function oOe(t,e){return lI(t,e,lOe)}const aOe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function lOe(t){return aOe.test(t)?"replace":"merge"}function Uue(t,e,r=!1){return zue(t,e,r)}function rR(t,e){if(e!=null)return e[t]||Vue(t.split("."),!1,e)}function Ga(t,e,r){const i=t.split("."),s=i.pop(),n=Vue(i,!0,r);n&&s&&(n[s]=e)}function Vue(t,e,r){let i=r;for(const s of t){if(i==null)return;if(!(s in i)){if(!e)return;i[s]={}}i=i[s]}return i}function zue(t,e,r){return e?Object.keys(e).reduce((i,s)=>{let n=i[s],o=e[s];return n===o?i:n===void 0?(i[s]=Q(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=zue(n,o,r):i.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(i[s]=o),i)},t||{}):t}var vue;const Zr={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:(vue=globalThis.location)==null?void 0:vue.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Uue(Zr,globalThis.esriConfig,!0),delete Zr.has),!Zr.assetsPath){{const t="4.27";Zr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Zr.defaultAssetsPath=Zr.assetsPath}const cOe=/\{([^\}]+)\}/g;function uJ(t){return t??""}function U4(t,e){return t.replaceAll(cOe,typeof e=="object"?(r,i)=>uJ(rR(i,e)):(r,i)=>uJ(e(i)))}function Awt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function TH(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function Owt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function Rwt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const hJ={info:0,warn:1,error:2,none:3};let J=class ba{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,ba._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=ba.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=ba._loggers;return ba._loggers=e,r},set throttlingDisabled(e){ba._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,ba._loggers.get(e)||new ba({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!ba._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[e].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=ba._tickCounter)return;this._loggedMessages[e].set(s,ba._tickCounter),ba._scheduleTickCounterIncrement()}for(const s of Zr.log.interceptors)if(s(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const s=i[e];if(s!=null)return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=Zr.log.level||"warn";return hJ[this._parentWithMember("level",r)]<=hJ[e]}_argsToKey(...e){return TH(JSON.stringify(e,(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){ba._tickCounterScheduled||(ba._tickCounterScheduled=!0,Promise.resolve().then(()=>{ba._tickCounter++,ba._tickCounterScheduled=!1}))}};J._loggers=new Map,J._tickCounter=0,J._tickCounterScheduled=!1,J._throttlingDisabled=!1;var Km;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(Km||(Km={}));let uOe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){vH(this._observers,this._observer)}},kue=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return hOe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===e){i=!0;break}}return i||(r.push(e),s&&this._removeDestroyedObservers()),new uOe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&e[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;e[s]=e[s+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const hOe=Ba();var ur;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(ur||(ur={}));const lV=ur.USER+1;function rg(t){switch(t){case"defaults":return ur.DEFAULTS;case"service":return ur.SERVICE;case"portal-item":return ur.PORTAL_ITEM;case"web-scene":return ur.WEB_SCENE;case"web-map":return ur.WEB_MAP;case"link-chart":return ur.LINK_CHART;case"user":return ur.USER;default:return null}}function aD(t){switch(t){case ur.DEFAULTS:return"defaults";case ur.SERVICE:return"service";case ur.PORTAL_ITEM:return"portal-item";case ur.WEB_SCENE:return"web-scene";case ur.WEB_MAP:return"web-map";case ur.LINK_CHART:return"link-chart";case ur.USER:return"user"}return void 0}function dOe(t){return aD(t)}var Oi;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Oi||(Oi={}));const lD={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},_C=[];let Q3=lD;function Xt(t){Q3.onObservableAccessed(t)}let cI=!1,uI=!1;function xg(t,e,r){if(cI)return SH(t,e,r);Bue(t);const i=e.call(r);return Gue(),i}function pOe(t,e){return xg(lD,t,e)}function SH(t,e,r){const i=cI;cI=!0,Bue(t);let s=null;try{s=e.call(r)}catch(n){uI&&J.getLogger("esri.core.accessorSupport.tracking").error(n)}return Gue(),cI=i,s}function Bue(t){Q3=t,_C.push(t)}function Gue(){const t=_C.length;if(t>1){const e=_C.pop();Q3=_C[t-2],e.onTrackingEnd()}else if(t===1){const e=_C.pop();Q3=lD,e.onTrackingEnd()}else Q3=lD}function jue(t,e){const r=e.observerObject;if(r.flags&Oi.DepTrackingInitialized)return;const i=uI;uI=!1,r.flags&Oi.AutoTracked?SH(e,e.metadata.get,t):Hue(t,e),uI=i}const fOe=[];function Hue(t,e){const r=e.observerObject;r.flags&Oi.ExplicitlyTracking||(r.flags|=Oi.ExplicitlyTracking,SH(e,()=>{const i=e.metadata.dependsOn||fOe;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=Lue(s);for(let o=0,a=t;o<n.length&&a!=null&&typeof a=="object";++o)a=dJ(a,n[o],o!==n.length-1)}else dJ(t,s,!1)}),r.flags&=~Oi.ExplicitlyTracking)}function dJ(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=oa(t);if(s){const n=s.propertiesByName.get(i);n&&(Xt(n.observerObject),jue(t,n))}return r?t[i]:void 0}let pJ=class{constructor(e,r){this.propertyName=e,this.metadata=r,this.observerObject=new mOe,this._accessed=null,this._handles=null,this.observerObject.flags=Oi.Dirty|(r.nonNullable?Oi.NonNullable:0)|(r.hasOwnProperty("value")?Oi.HasDefaultValue:0)|(r.get===void 0?Oi.DepTrackingInitialized:0)|(r.dependsOn===void 0?Oi.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const r=this.observerObject;Xt(r);const i=e.store,s=this.propertyName,n=r.flags,o=i.get(s);if(n&Oi.Computing||~n&Oi.Dirty&&i.has(s))return o;r.flags|=Oi.Computing;const a=e.host;let l;n&Oi.AutoTracked?l=xg(this,this.metadata.get,a):(Hue(a,this),l=this.metadata.get.call(a)),i.set(s,l,ur.COMPUTED);const c=i.get(s);return c===o?r.flags&=~Oi.Dirty:pOe(this.commit,this),r.flags&=~Oi.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Oi.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let s=0;s<r.length;++s)i.push(r[s].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Oi.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},mOe=class extends kue{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Oi.Overriden&&(this.flags|=Oi.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&Oi.Dirty&&this.onCommitted(),super.destroy()}},gOe=class que{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new que;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,Q(i))}),r}get(e){return this._values.get(e)}originOf(){return ur.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function rP(t,e,r){return t!==void 0}function fJ(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&Oi.NonNullable)||(i.lifecycle,Km.INITIALIZING,!1))}function yOe(t){return t&&typeof t.destroy=="function"}J.getLogger("esri.core.accessorSupport.Properties");let _Oe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Km.INITIALIZING,this.store=new gOe,this._origin=ur.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new pJ(i,r[i]);this.propertiesByName.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=Km.CONSTRUCTING}constructed(){this.lifecycle=Km.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&yOe(i)&&(i.destroy(),~r.observerObject.flags&Oi.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==Km.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Xt(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.observerObject.flags&Oi.HasDefaultValue)return"defaults"}return aD(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(rP(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);rP(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const s=this.propertiesByName.get(r);if(!rP(s))return"";const n=new Set,o=xg({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n)l instanceof pJ&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const s=this.propertiesByName.get(e);if(rP(s))return this._setAtOrigin(s,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.observerObject.flags&Oi.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e),i=r==null?void 0:r.observerObject;i&&i.flags&Oi.Overriden&&(i.flags&=~Oi.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!fJ(i,e,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(h6.release(n),!o)return;r=a}i.observerObject.flags|=Oi.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!fJ(i,e,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(h6.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=rg(e)}getDefaultOrigin(){return aD(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==Km.INITIALIZING?this._origin:ur.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const s=this.store,n=e.propertyName;s.has(n,i)&&wH(r,s.get(n))&&~e.observerObject.flags&Oi.Overriden&&i===s.originOf(n)||(e.invalidate(),s.set(n,r,i),e.commit(),jue(this.host,e))}_cast(e,r){const i=h6.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},vOe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const h6=new No(vOe);function bOe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(rR(i,e)??"").toString())}let Wue=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&bOe(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},U=class Xue extends Wue{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return Q(r)}catch{return"[object]"}}))}}catch(e){throw J.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Xue(e.name,e.message,e.details)}};U.prototype.type="error";function cD(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))cD(t,i,e[i]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(s.length-1,1)[0];return void cD(oD(t,s),n,r)}const i=t.__accessor__;i!=null&&wOe(e,i),t[e]=r}}function wOe(t,e){if(oe("esri-unknown-property-errors")&&!xOe(t,e))throw new U("set:unknown-property",TOe(t,e))}function xOe(t,e){return e.metadatas[t]!=null}function TOe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let SOe;function EOe(){return SOe}let Zue=class extends No{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=CS(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const iP=[];function M2(t){iP.push(t),iP.length===1&&queueMicrotask(()=>{const e=iP.slice();iP.length=0;for(const r of e)r()})}let ig=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var cV;(function(t){const e=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)e(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,e(n,c,h,l),yield}}t.sort=i,t.iterableSort=s})(cV||(cV={}));const mJ=cV,COe=1.5,AOe=1.1;let Bt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Eue,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>gJ(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];e(s)&&r.push(s)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,gJ(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=oV(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(oV(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=XAe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){mJ.sort(this.data,0,this.length,e)}iterableSort(e){return mJ.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(e.call(r,s,i))return s}}filterInPlace(e,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)e.call(r,s[n],n,s)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=e.call(r,this.data[s],s,this.data);return i}reduce(e,r){let i=r;for(let s=0;s<this.length;++s)i=e(i,this.data[s],s,this.data);return i}has(e){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===e)return!0;return!1}};function gJ(t){t.data.length>COe*t.length&&(t.data.length=Math.floor(t.length*AOe))}function OOe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const iR=OOe(globalThis);function V4(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function sR(t,e,r){if(!V4(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const s of i)t.addEventListener(s,r);return{remove(){for(const s of i)t.removeEventListener(s,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function Yue(t,e,r){if(!V4(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=sR(t,e,s=>{i.remove(),r.call(t,s)});return{remove(){i.remove()}}}const ROe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function POe({key:t}){return ROe[t]||t}function Lr(t="Aborted"){return new U("AbortError",t)}function Jt(t,e="Aborted"){if(yn(t))throw Lr(e)}function z4(t){return t!=null?"aborted"in t?t:t.signal:t}function yn(t){const e=z4(t);return e!=null&&e.aborted}function Po(t){if(gs(t))throw t}function yJ(t){if(!gs(t))throw t}function sa(t,e){const r=z4(t);if(r!=null){if(!r.aborted)return Yue(r,"abort",()=>e());e()}}function EH(t,e){const r=z4(t);if(r!=null)return Jt(r),Yue(r,"abort",()=>e(Lr()))}function Jue(t,e){return z4(e)==null?t:new Promise((r,i)=>{let s=sa(e,()=>i(Lr()));const n=()=>s=Li(s);t.then(n,n),t.then(r,i)})}function gs(t){return(t==null?void 0:t.name)==="AbortError"}async function uV(t){try{return await t}catch(e){if(!gs(e))throw e;return}}async function zwt(t,e=J.getLogger("esri")){try{return await t}catch(r){gs(r)||e.error(r)}}async function Gf(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),s=await Gf(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,s)=>{const n=r[s];return n.status==="fulfilled"?{promise:i,value:n.value}:{promise:i,error:n.reason}}))}async function hV(t){return(await Gf(t)).filter(e=>!!e.value).map(e=>e.value)}function ZA(t,e=void 0,r){const i=new AbortController;return sa(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);sa(i,()=>{o&&(clearTimeout(o),n(Lr()))})})}function pu(t){return t&&typeof t.then=="function"}function dV(t){return pu(t)?t:Promise.resolve(t)}function CH(t,e=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(Lr()),n=mo();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||mo(),n=null,e>0){const f=new AbortController;r=dV(t(...l,f.signal));const m=r;ZA(e).then(()=>{r===m&&(n?f.abort():o=f)})}else r=1,r=dV(t(...l));const c=()=>{const f=i;i=s=r=o=null,f!=null&&a(...f)},h=r,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function mo(){let t,e;const r=new Promise((s,n)=>{t=s,e=n}),i=s=>{t(s)};return i.resolve=s=>t(s),i.reject=s=>e(s),i.timeout=(s,n)=>iR.setTimeout(()=>i.reject(n),s),i.promise=r,i}function kwt(t,e){return t.then(e,e)}async function _J(t){await Promise.resolve(),Jt(t)}function Bwt(t){return t}function Que(t){return 1e3*t}function AH(t){return .001*t}function MOe(){return performance.now()}let $Oe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},IOe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},pV=0,fV=0;const uE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},mV=["prepare","preRender","render","postRender","update","finish"],gV=[],Tb=new Bt;let LOe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const uD={frameTasks:Tb,willDispatch:!1,clearFrameTasks:DOe,dispatch:the,executeFrameTasks:FOe};function RS(t){const e=new IOe(t);return gV.push(e),uD.willDispatch||(uD.willDispatch=!0,M2(the)),e}function $2(t){const e=new $Oe(t);return Tb.push(e),hD==null&&(pV=performance.now(),hD=requestAnimationFrame(Kue)),new LOe(e)}let hD=null;function DOe(t=!1){Tb.forAll(e=>{e.removed=!0}),t&&ehe()}function NOe(t){fV=Math.max(0,t)}function Kue(){const t=performance.now();hD=null,hD=Tb.length>0?requestAnimationFrame(Kue):null,uD.executeFrameTasks(t)}function FOe(t){const e=t-pV;pV=t;const r=fV>0?fV:1e3/60,i=Math.max(0,e-r);uE.time=t,uE.frameDuration=r-i;for(let s=0;s<mV.length;s++){const n=performance.now(),o=mV[s];Tb.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(uE.elapsedFrameTime=performance.now()-t,uE.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,uE)))}),UOe[s].record(performance.now()-n)}ehe(),VOe.record(performance.now()-t)}const sP=new Bt;function ehe(){Tb.forAll(t=>{t.removed&&sP.push(t)}),Tb.removeUnorderedMany(sP.data,sP.length),sP.clear()}function the(){for(;gV.length;){const t=gV.shift();t.isActive&&t.callback()}uD.willDispatch=!1}function qwt(t=1,e){const r=mo(),i=()=>{yn(e)?r.reject(Lr()):t===0?r():(--t,M2(()=>i()))};return i(),r.promise}const UOe=mV.map(t=>new ig(t)),VOe=new ig("total");function hI(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let zOe=0;const kOe=0;function hc(){return++zOe}let k4=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new BOe(e),vJ.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;vJ.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)e.push(r[s].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},BOe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=GOe}};const vJ=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function GOe(){}let KT=!1;const dD=[];function rhe(t,e){let r=new k4(n),i=null,s=!1;function n(){if(!r||s)return;if(KT)return void nhe(n);const a=i;r.clear(),KT=!0,s=!0,i=xg(r,t),s=!1,KT=!1,e(i,a),ohe()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=xg(r,t),s=!1,{remove:o}}function ihe(t,e){let r=new k4(s),i=null;function s(){e(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=xg(r,t),i):null}return o(),{remove:n}}function she(t){let e=new k4(i),r=!1;function i(){e&&!r&&(KT?nhe(i):(e.clear(),KT=!0,r=!0,xg(e,t),r=!1,KT=!1,ohe()))}function s(){e&&(e.destroy(),e=null)}return r=!0,xg(e,t),r=!1,{remove:s}}function nhe(t){dD.includes(t)||dD.unshift(t)}function ohe(){for(;dD.length;)dD.pop()()}var K3;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(K3||(K3={}));let YA=class{constructor(){this.uid=hc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,s,n){return this.pool.acquire(K3.Untracked,e,r,i,s,n,wH)}static acquireTracked(e,r,i,s){return this.pool.acquire(K3.Tracked,e,r,i,null,null,s)}notify(e,r){this.type===K3.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,s,n,o,a){this.uid=hc(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=hc(),this.removed=!0}};YA.pool=new Zue(YA);const dI=new rc,lg=new Set;let pD;function fD(t){lg.delete(t),lg.add(t),pD||(pD=RS(qOe))}function jOe(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function HOe(t){for(const e of lg.values())e.target===t&&(e.removed=!0)}function qOe(){let t=10;for(;pD&&t--;){pD=null;const e=WOe(),r=dI.acquire();for(const i of e){const s=i.uid;jOe(i),s===i.uid&&i.removed&&r.push(i)}for(const i of lg)i.removed&&(r.push(i),lg.delete(i));for(const i of r)YA.pool.release(i);dI.release(r),dI.release(e),yV.forEach(i=>i())}}function WOe(){const t=dI.acquire();t.length=lg.size;let e=0;for(const r of lg)t[e]=r,++e;return lg.clear(),t}const yV=new Set;function ahe(t){return yV.add(t),{remove(){yV.delete(t)}}}function XOe(t,e,r){let i=Due(t,e,r,(s,n,o)=>{let a,l,c=ihe(()=>KO(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=YA.acquireUntracked(h,o,p,s,n),l=a.uid),fD(a))});return{remove:xH(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,fD(a)),a=null),i=c=null})}});return i}function ZOe(t,e,r){const i=Due(t,e,r,(s,n,o)=>{let a=!1;return rhe(()=>KO(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,wH(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function YOe(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?ZOe(t,e,r):XOe(t,e,r)}function JOe(t,e,r){let i,s,n=ihe(t,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=YA.acquireTracked(o,e,a,r),s=i.uid),fD(i))});return{remove:xH(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,fD(i)),i=null),n=null})}}function QOe(t,e,r){let i=!1;return rhe(t,(s,n)=>{i||(i=!0,r(n,s)||e(s,n),i=!1)})}function KOe(t,e,r=!1,i=Iue){return r?QOe(t,e,i):JOe(t,e,i)}function bJ(t){return hI(lg,e=>e.oldValue===t)}function $o(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function Ywt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function lhe(t,e,r){const i=t.get(e);if(i!==void 0)return i;const s=r();return t.set(e,s),s}const e2=J.getLogger("esri.core.accessorSupport.ensureTypes");function eRe(t){return t==null?t:new Date(t)}function tRe(t){return t==null?t:!!t}function nR(t){return t==null?t:t.toString()}function Zu(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function OH(t){return t==null?t:Math.round(parseFloat(t))}function che(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function mD(t,e){return e!=null&&t&&!(e instanceof t)}function uhe(t){return t&&"isCollection"in t}function wJ(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function rRe(t,e){if(!e||!e.constructor||!uhe(e.constructor))return _V(t,e)?e:new t(e);const r=wJ(t.prototype.itemType),i=wJ(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(_V(t,e),e):new t(e):e}function _V(t,e){return!!che(e)&&(e2.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+B4(t)+"'"),!0)}function Sb(t,e){return e==null?e:uhe(t)?rRe(t,e):mD(t,e)?_V(t,e)?e:new t(e):e}function B4(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const iRe=new WeakMap;function sRe(t){switch(t){case Number:return Zu;case Yi:return OH;case Boolean:return tRe;case String:return nR;case Date:return eRe;default:return lhe(iRe,t,()=>Sb.bind(null,t))}}function Hs(t,e){const r=sRe(t);return arguments.length===1?r:r(e)}function JA(t,e,r){return arguments.length===1?JA.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function nRe(t,e){return arguments.length===1?JA(r=>Hs(t,r)):JA(r=>Hs(t,r),e)}function hhe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>hhe(t,e-1,i)):t(r)}function gD(t,e,r){if(arguments.length===2)return n=>gD(t,e,n);if(!r)return r;r=hhe(t,e,r);let i=e,s=r;for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function oRe(t,e,r){return arguments.length===2?gD(i=>Hs(t,i),e):gD(i=>Hs(t,i),e,r)}function dhe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function vV(t,e){if(arguments.length===2)return vV(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!mD(a,p))?a:(h&&i.length?(n||(n=i.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),e2.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>B4(p)).join(", ")),e2.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):e2.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Qd(t,e){if(arguments.length===2)return Qd(t).call(null,e);const r={},i=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=Hs(c),i.push(B4(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!mD(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,h=r[c];if(!h)return e2.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!mD(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!che(l)){const p={};for(const f in l)f!==t.key&&(p[f]=l[f]);return h(p)}return h(l)}}let Yi=class{};const Qwt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function aRe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function phe(t){switch(t.type){case"native":return Hs(t.value);case"array":return JA(phe(t.value));case"one-of":return lRe(t);default:return null}}function lRe(t){let e=null;return(r,i)=>wV(r,t)?r:(e==null&&(e=bV(t)),e2.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function bV(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Yi:return"integer";case Date:return"date";default:return B4(t.value)}case"array":return`array of ${bV(t.value)}`;case"one-of":{const e=t.values.map(r=>bV(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function wV(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Yi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!wV(r,e.value));case"one-of":return e.values.some(r=>wV(t,r))}}function d(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),s=tR(e,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in t&&J.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=i.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=oD(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=oD(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){this._override(r,p)}:function(p){cD(this,l,p)})}const o=t.type,a=t.types;s.cast||(o?s.cast=cRe(o):a&&(Array.isArray(a)?s.cast=JA(Qd(a[0])):s.cast=Qd(a))),oOe(s,t),t.range&&(s.cast=uRe(s.cast,t.range))}}function RH(t,e,r){const i=tR(t,r);i.json||(i.json={});let s=i.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function cRe(t){let e=0,r=t;if(aRe(t))return phe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(dhe(i))return e===0?vV(i):gD(vV(i),e);if(e===1)return nRe(i);if(e>1)return oRe(i,e);const s=t;return s.from?s.from:Hs(s)}function uRe(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function hRe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const s=e[i];r[i].forEach(n=>{e[n]=s}),delete e[i]}}}let fh=class extends Wue{constructor(e,r,i){super(e,r,i)}};fh.prototype.type="warning";function fhe(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const xV=J.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function xJ(t,e,r){var i,s;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((s=e.read)==null?void 0:s.enabled)===!1||fRe(t)&&Ga("read.reader",PS(t),e))}function PS(t){var r,i;const e=t.ndimArray??0;if(e>1)return pRe(t);if(e===1)return TJ(t);if("type"in t&&ghe(t.type)){const s=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,n=TJ(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return PH(t)}function PH(t){return"type"in t?dRe(t.type):mRe(t.types)}function dRe(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void xV.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,i),n}:t.fromJSON}function mhe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(s=>mhe(t,s,r,i-1)):t(e,void 0,r)}function pRe(t){const e=PH(t),r=mhe.bind(null,e),i=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=r(s,o,i);let a=i,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function TJ(t){const e=PH(t);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(r,void 0,s);return n!==void 0?[n]:void 0}}function ghe(t){if(!fhe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?MH(e.Type):yhe(e.Type))}function fRe(t){return"types"in t?yhe(t.types):MH(t.type)}function MH(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||ghe(t))}function yhe(t){for(const e in t.typeMap)if(!MH(t.typeMap[e]))return!1;return!0}function mRe(t){let e=null;const r=t.errorContext??"type";return(i,s,n)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void xV.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=gRe(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const p=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&i&&n.messages.push(new fh(`${r}:unsupported`,p,{definition:i,context:n})),void xV.error(p)}const h=new c;return h.read(i,n),h}}function gRe(t){var r,i;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=eR(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){e[s]=n;continue}const c=l.target,h=typeof c=="string"?c:t.key,p={};l.writer(s,p,h),p[h]&&(e[p[h]]=n)}return e}function yRe(t){if(t.json||(t.json={}),EJ(t.json),CJ(t.json),SJ(t.json),t.json.origins)for(const e in t.json.origins)EJ(t.json.origins[e]),CJ(t.json.origins[e]),SJ(t.json.origins[e]);return!0}function SJ(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function EJ(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function CJ(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function AJ(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&fhe(t.type))?e.write.writer=bRe:r>1?e.write.writer=wRe(r):e.types?Array.isArray(e.types)?e.write.writer=vRe(e.types[0]):e.write.writer=_Re(e.types):e.write.writer=QA}function _Re(t){return(e,r,i,s)=>e?_he(e,t,s)?QA(e,r,i,s):void 0:QA(e,r,i,s)}function _he(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new U(`${i}:unsupported`,s,{definition:t,context:r})),J.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function vRe(t){return(e,r,i,s)=>!e||!Array.isArray(e)?QA(e,r,i,s):QA(e.filter(n=>_he(n,t,s)),r,i,s)}function QA(t,e,r,i){Ga(r,yD(t,i),e)}function yD(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?_D(t):t}function _D(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function bRe(t,e,r,i){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>yD(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[yD(t,i)],Ga(r,s,e)}function vhe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>vhe(i,e,r-1)):yD(t,e)}function wRe(t){return(e,r,i,s)=>{let n;if(e===null)n=null;else{n=vhe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Ga(i,n,r)}}function xRe(t,e){return $H(t,"any",e==null?void 0:e.origin)}function TV(t,e){return $H(t,"read",e==null?void 0:e.origin)}function bhe(t,e){return $H(t,"write",e==null?void 0:e.origin)}function $H(t,e,r){let i=t==null?void 0:t.json;if(i!=null&&i.origins&&r){let s;s=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],s&&(e==="any"||e in s)&&(i=s)}return i}function TRe(t){const e=SRe(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],s=i.types?ERe(i):e;xJ(s,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),AJ(s,i)}xJ(e,t.json,!0),AJ(e,t.json)}function SRe(t){return t.json.types?SV(t.json):t.type?whe(t):SV(t)}function ERe(t){return t.type?whe(t):SV(t)}function whe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!dhe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function SV(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function CRe(t){yRe(t)&&(hRe(t),TRe(t))}const d6=new Set,p6=new Set;function R(t){return e=>{e.prototype.declaredClass=t,ORe(e);const r=[],i=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!d6.has(s.initialize)&&(d6.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!p6.has(s.destroy)&&(p6.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);d6.clear(),p6.clear();class n extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[Tue];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<i.length;h++)i[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=eR(e.prototype),n.prototype.declaredClass=t,n}}function ARe(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Xt(i.observerObject);const s=r.store;return s.has(t)?s.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function ORe(t){const e=t.prototype,r=eR(e),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];CRe(n),i[s]={enumerable:!0,configurable:!0,get:ARe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===Km.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var xhe,The;function RRe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Uy=Symbol("Accessor-Handles"),EV=Symbol("Accessor-Initialized");let xe=class She{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}eR(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:e[a]}for(const a in r){const l=RRe(r[a]);d(l)(o.prototype,a)}return R(i)(o)}constructor(...e){if(this[xhe]=null,this[The]=!1,this.constructor===She)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new _Oe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e)),OJ.register(this,r.propertiesByName,this)}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[EV]=!0}initialize(){}[Tue](){this[Uy]=Pe(this[Uy])}destroy(){var e;this.destroyed||(OJ.unregister(this),HOe(this),this.__accessor__.destroy(),(e=EOe())==null||e.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[EV]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return oD(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return cD(this,e,r),this}watch(e,r,i){return YOe(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){if(this.destroyed){const s=Array.isArray(e)?e:[e];for(const n of s)n.remove();return}let i=this[Uy];i==null&&(i=this[Uy]=new Pi),i.add(e,r)}removeHandles(e){const r=this[Uy];r!=null&&r.remove(e)}removeAllHandles(){const e=this[Uy];e!=null&&e.removeAll()}hasHandles(e){const r=this[Uy];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};xhe=Uy,The=EV;const OJ=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()});let pI=class Ehe{constructor(){this._emitter=new Ehe.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return P2(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([R("esri.core.Evented")],s),s};let r=class extends xe{constructor(){super(...arguments),this._emitter=new pI.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([R("esri.core.Evented")],r),t.EventedAccessor=r})(pI||(pI={}));const Is=pI;var ri;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(ri||(ri={}));function IH(t){return(e,r)=>{e[r]=t}}let G4=class extends kue{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var Ym;let PRe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const fu=new No(PRe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),MRe=()=>{};function f6(t){return t?t instanceof M1?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function m6(t){if(t&&t.length)return t[0]}function $Re(t,e,r,i){const s=Math.min(t.length-r,e.length-i);let n=0;for(;n<s&&t[r+n]===e[i+n];)n++;return n}function Che(t,e,r,i){e&&e.forEach((s,n,o)=>{t.push(s),Che(t,r.call(i,s,n,o),r,i)})}const ry=new Set,iy=new Set,sy=new Set,g6=new Map;let IRe=0,M1=Ym=class extends Is.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Ym}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new G4,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:IRe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Ym?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Xt(this._observable),this._items}set items(t){this._emitBeforeChanges(ri.ADD)||(this._splice(0,this.length,f6(t)),this._emitAfterChanges(ri.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=MRe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(Xt(this._observable),this._emitBeforeChanges(ri.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(ri.ADD),this}addMany(t,e=this._items.length){if(Xt(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(ri.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,f6(t)),this._emitAfterChanges(ri.ADD),this}at(t){if(Xt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ri.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(ri.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Xt(this._observable),this._createNewInstance({items:this._items.map(Q)})}concat(...t){Xt(this._observable);const e=t.map(f6);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ri.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)t.call(e,r[s],s,r);this._emitAfterChanges(ri.REMOVE)}every(t,e){return Xt(this._observable),this._items.every(t,e)}filter(t,e){let r;return Xt(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Xt(this._observable),this._items.find(t,e)}findIndex(t,e){return Xt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Xt(this._observable);const r=[];return Che(r,this,t,e),new Ym(r)}forEach(t,e){return Xt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Xt(this._observable),this._items[t]}getNextIndex(t){Xt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Xt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Xt(this._observable),this._items.indexOf(t,e)}join(t=","){return Xt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Xt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Xt(this._observable);const r=this._items.map(t,e);return new Ym({items:r})}reorder(t,e=this.length-1){Xt(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(ri.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(ri.MOVE)}return t}}pop(){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ri.REMOVE))return;const t=m6(this._splice(this.length-1,1));return this._emitAfterChanges(ri.REMOVE),t}push(...t){return Xt(this._observable),this._emitBeforeChanges(ri.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(ri.ADD)),this.length}reduce(t,e){Xt(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Xt(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Xt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Xt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(ri.REMOVE))return;const e=m6(this._splice(t,1));return this._emitAfterChanges(ri.REMOVE),e}removeMany(t){if(Xt(this._observable),!t||!t.length||this._emitBeforeChanges(ri.REMOVE))return[];const e=t instanceof Ym?t.toArray():t,r=this._items,i=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=r.indexOf(o);if(a>-1){const l=1+$Re(e,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(ri.REMOVE),i}reverse(){if(Xt(this._observable),this._emitBeforeChanges(ri.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(ri.MOVE),this}shift(){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ri.REMOVE))return;const t=m6(this._splice(0,1));return this._emitAfterChanges(ri.REMOVE),t}slice(t=0,e=this.length){return Xt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Xt(this._observable),this._items.some(t,e)}sort(t){if(Xt(this._observable),!this.length||this._emitBeforeChanges(ri.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(ri.MOVE),this}splice(t,e,...r){Xt(this._observable);const i=(e?ri.REMOVE:0)|(r.length?ri.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(t,e,r)||[];return this._emitAfterChanges(i),s}toArray(){return Xt(this._observable),this._items.slice()}toJSON(){return Xt(this._observable),this.toArray()}toLocaleString(){return Xt(this._observable),this._items.toLocaleString()}toString(){return Xt(this._observable),this._items.toString()}unshift(...t){return Xt(this._observable),!t.length||this._emitBeforeChanges(ri.ADD)||(this._splice(0,0,t),this._emitAfterChanges(ri.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=RS(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=fu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,n),t+=1,l-=1,c-=1);fu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=fu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);fu.release(a)}}if(r&&r.length){if(s){const h=[];for(const p of r){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const h=fu.acquire();h.target=this,h.cancellable=!0;const p=fu.acquire();p.target=this,p.cancellable=!1;for(const f of r)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),p.reset(f),this.emit("after-add",p));fu.release(p),fu.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=fu.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,fu.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=fu.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),fu.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;ry.clear(),iy.clear(),sy.clear();for(const{added:l,removed:c}of r){if(l)if(sy.size===0&&iy.size===0)for(const h of l)ry.add(h);else for(const h of l)iy.has(h)?(sy.add(h),iy.delete(h)):sy.has(h)||ry.add(h);if(c)if(sy.size===0&&ry.size===0)for(const h of c)iy.add(h);else for(const h of c)ry.has(h)?ry.delete(h):(sy.delete(h),iy.add(h))}const i=rc.acquire();ry.forEach(l=>{i.push(l)});const s=rc.acquire();iy.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=rc.acquire();if(sy.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=e.listeners.length;for(let h=0;h<c;h++){const p=e.listeners[h];p.removed||p.callback.call(this,l)}}rc.release(i),rc.release(s),rc.release(a)}ry.clear(),iy.clear(),sy.clear()}};M1.ofType=t=>{if(!t)return Ym;if(g6.has(t))return g6.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const s=t.typeMap[i].prototype.declaredClass;e?e+=` | ${s}`:e=s}let r=class extends Ym{};return u([IH({Type:t,ensureType:typeof t=="function"?Hs(t):Qd(t)})],r.prototype,"itemType",void 0),r=u([R(`esri.core.Collection<${e}>`)],r),g6.set(t,r),r},u([d()],M1.prototype,"length",void 0),u([d()],M1.prototype,"items",null),M1=Ym=u([R("esri.core.Collection")],M1);const Mt=M1;function Eb(t,e,r=Mt){return e||(e=new r),e===t||(e.removeAll(),LRe(t)?e.addMany(t):t&&e.add(t)),e}function Ahe(t){return t}function LRe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const RJ=new Set;function DRe(t,e,r=!1){r&&RJ.has(e)||(r&&RJ.add(e),t.warn(` DEPRECATED - ${e}`))}function Id(t,e,r={}){if(oe("esri-deprecation-warnings")){const{moduleName:i}=r;vD(t,`Property: ${(i?i+"::":"")+e}`,r)}}function vD(t,e,r={}){if(oe("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=e;i&&(a+=`
	 Replacement: ${i}`),s&&(a+=`
	 Version: ${s}`),n&&(a+=`
	 See ${n} for more details.`),DRe(t,a,o)}}let NRe=class Ohe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new Ohe;return this._values.forEach((i,s)=>{e&&e.has(s)||r.set(s,Q(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??ur.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===ur.DEFAULTS){const s=this._values.get(e);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(e,new FRe(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===ur.DEFAULTS?e:ur.USER}},FRe=class{constructor(e,r){this.value=e,this.origin=r}};function Rhe(t,e,r){e.keys().forEach(s=>{r.set(s,e.get(s),ur.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(s=>{t.internalGet(s)&&r.set(s,t.internalGet(s),ur.DEFAULTS)})}function URe(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&cJ(i,r))return!0}else for(const s of i)if(s===e||s.includes(".")&&s.indexOf(e)===0&&cJ(s,r))return!0;return!1}function VRe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function zRe(t,e,r,i,s){let n=TV(e[r],s);VRe(n)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))n=TV(e[o],s),URe(n,r,i)&&(t[o]=!0)}function kRe(t,e,r,i){const s=r.metadatas,n=xRe(s[e],i),o=n==null?void 0:n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const Phe={origin:"service"};function Mhe(t,e,r=Phe){if(!e||typeof e!="object")return;const i=oa(t),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(e))zRe(n,s,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=TV(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?KO(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||kRe(t,o,i,r)}i.setDefaultOrigin("user")}function BRe(t,e,r,i=Phe){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function GRe(t,e,r,i,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,n,r,s),n}function $he(t,e,r,i,s,n){if(!i||!i.write)return!1;const o=t.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,n??void 0);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new U("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&n&&n.messages?n.messages.push(a):a&&!n&&J.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===ur.DEFAULTS)&&jRe(t,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<rg(n.origin))}function jRe(t,e,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,r??void 0);return wg(o,s)}return!1}return n===s}function HRe(t,e,r,i){const s=oa(t),n=s.metadatas,o=bhe(n[e],i);return!!o&&$he(t,s,e,o,r,i)}function Ihe(t,e,r){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return lI(e,t.toJSON(r));const i=oa(t),s=i.metadatas;for(const a in s){const l=bhe(s[a],r);if(!$he(t,i,a,l,void 0,r))continue;const c=t.get(a),h=GRe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(h).length>0&&(e=lI(e,h),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>lI(e,h,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:dOe(i.store.originOf(a)),newOrigin:r.origin}))}return e}const MS=t=>{let e=class extends t{constructor(...r){super(...r);const i=oa(this),s=i.store,n=new NRe;i.store=n,Rhe(i,s,n)}read(r,i){Mhe(this,r,i)}write(r,i){return Ihe(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return qRe.call(this,r,i)}};return e=u([R("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function qRe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let de=class extends MS(xe){};de=u([R("esri.core.JSONSupport")],de);var g0;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(g0||(g0={}));let WRe=class{constructor(){this._resolver=mo(),this._status=g0.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=g0.RESOLVED,this._cleanUp()},()=>{this._status=g0.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===g0.RESOLVED}isRejected(){return this._status===g0.REJECTED}isFulfilled(){return this._status!==g0.PENDING}abort(){this._resolver.reject(Lr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=mo(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==i||gs(s)||this._resolver.reject(s)}),e.resolve()}};const j4=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new WRe,this.addResolvingPromise(Promise.resolve())}destroy(){var r;(r=this._promiseProps)==null||r.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=u([R("esri.core.Promise")],e),e};let bD=class extends j4(xe){};bD=u([R("esri.core.Promise")],bD);const XRe="not-loaded",ZRe="loading",YRe="failed",PJ="loaded",Lhe=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=EH(n,l);this.destroyed&&l(new U("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===XRe){this._set("loadStatus",ZRe);const a=this._loadController=new AbortController;s({signal:a.signal}),sa(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",PJ),this._loadController=null},i=>{this._set("loadStatus",YRe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=ou(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===PJ}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new U("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return u([d({readOnly:!0})],e.prototype,"loaded",null),u([d({readOnly:!0})],e.prototype,"loadError",void 0),u([d({clonable:!1})],e.prototype,"loadStatus",void 0),u([d({type:[fh],readOnly:!0})],e.prototype,"loadWarnings",null),e=u([R("esri.core.Loadable")],e),e};let vC=class extends Lhe(bD){};vC=u([R("esri.core.Loadable")],vC),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=Lhe,t.isLoadable=e}(vC||(vC={}));const Tg=vC;function H4(t,e,r){return Gf(t.map((i,s)=>e.apply(r,[i,s])))}async function JRe(t,e,r){return(await Gf(t.map((i,s)=>e.apply(r,[i,s])))).map(i=>i.value)}function LH(t){return{ok:!0,value:t}}function DH(t){return{ok:!1,error:t}}function QRe(t){return t!=null&&t.ok===!0?t.value:null}function KRe(t){return t!=null&&t.ok===!1?t.error:null}async function lu(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return LH(await t)}catch(e){return DH(e)}}async function axt(t){try{return LH(await t)}catch(e){return Po(e),DH(e)}}function lxt(t){if(t.ok===!0)return t.value;throw t.error}function $S(t,e){return new Vy(t,e)}let Vy=class extends xe{get value(){return QRe(this._result)}get error(){return KRe(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=ou(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(s=>{this._result=LH(s),this._cleanup()},s=>{this._result=DH(s),this._cleanup()}),this._abortHandle=sa(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Li(this._abortHandle),this._abortController=null}};u([d()],Vy.prototype,"value",null),u([d()],Vy.prototype,"error",null),u([d()],Vy.prototype,"finished",null),u([d()],Vy.prototype,"promise",void 0),u([d()],Vy.prototype,"_result",void 0),Vy=u([R("esri.core.asyncUtils.ReactiveTask")],Vy);async function Dhe(t,e){return await t.load(),ePe(t,e)}async function ePe(t,e){const r=[],i=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?i(...o):Mt.isCollection(o)?o.forEach(a=>i(a)):Tg.isLoadable(o)&&r.push(o))};e(i);let s=null;if(await JRe(r,async n=>{const o=await lu(tPe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function tPe(t){return"loadAll"in t&&typeof t.loadAll=="function"}const rPe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,iPe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function MJ(t){const e=t==null?void 0:t.match(rPe);if(!e)return null;const[,r,i,s]=e;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=iPe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function sPe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function nPe(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}const oPe=J.getLogger("esri.core.urlUtils"),IS=Zr.request,$J="esri/config: esriConfig.request.proxyUrl is not set.",Nhe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Fhe=/^\s*http:/i,aPe=/^\s*https:/i,lPe=/^\s*file:/i,cPe=/:\d+$/,uPe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,hPe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),dPe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let t2=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(hPe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(dPe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const nP={},pPe=new t2(Zr.applicationUrl);let Da=pPe;const fPe=mPe();let NH=fPe;const FH=()=>Da,hxt=()=>NH;function mPe(){const t=Da.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Da.scheme}://${Da.host}${Da.port!=null?`:${Da.port}`:""}`}${e}`}function go(t){if(!t)return null;const e={path:null,query:null},r=new t2(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=UH(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function UH(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function IJ(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function KA(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=e&&e[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>IJ(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):IJ(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function gPe(t=!1){let e,r=IS.proxyUrl;if(typeof t=="string"){e=xPe(t);const i=q4(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw oPe.warn($J),new U("urlutils:proxy-not-set",$J);return e&&CV()&&(r=jH(r)),go(r)}function dxt(t){const e=q4(t);let r,i;if(e){const s=VH(e.proxyUrl);r=s.path,i=s.query?UH(s.query):null}if(r){const s=go(t);t=r+"?"+s.path;const n=KA({...i,...s.query});n&&(t=`${t}?${n}`)}return t}const hE={path:"",query:""};function VH(t){const e=t.indexOf("?");return e!==-1?(hE.path=t.slice(0,e),hE.query=t.slice(e+1)):(hE.path=t,hE.query=null),hE}function Uhe(t){return t=(t=xD(t=APe(t=VH(t).path),!0)).toLowerCase()}function yPe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Uhe(t.urlPrefix)},r=IS.proxyRules,i=e.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,e),s}function q4(t){const e=IS.proxyRules,r=Uhe(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function _Pe(t,e){if(!t||!e)return!1;t=wD(t),e=wD(e);const r=MJ(t),i=MJ(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&I2(t,e,!0)}function Vhe(t,e){return t=wD(t),e=wD(e),xD(t)===xD(e)}function wD(t){const e=(t=Bd(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function zhe(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=IS.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function I2(t,e,r=!1){if(!t||!e)return!1;const i=OV(t),s=OV(e);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function zH(t){if(typeof t=="string"){if(!dc(t))return!0;t=OV(t)}if(I2(t,Da))return!0;const e=IS.trustedServers||[];for(let r=0;r<e.length;r++){const i=vPe(e[r]);for(let s=0;s<i.length;s++)if(I2(t,i[s]))return!0}return!1}function vPe(t){return nP[t]||(GH(t)||Pf(t)?nP[t]=[new t2(Zc(t))]:nP[t]=[new t2(`http://${t}`),new t2(`https://${t}`)]),nP[t]}function Zc(t,e=NH,r){return Pf(t)?r&&r.preserveProtocolRelative?t:Da.scheme==="http"&&Da.authority===Gd(t).slice(2)?`http:${t}`:`https:${t}`:GH(t)?t:gc(t[0]==="/"?CPe(e):e,t)}function kH(t,e=NH,r){if(t==null||!dc(t))return t;const i=Bd(t),s=i.toLowerCase(),n=Bd(e).toLowerCase().replace(/\/+$/,""),o=r?Bd(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const h=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)t=`../${t}`;else t=`./${t}`;return t}function Bd(t){return t=PPe(t=RPe(t=OPe(t=Zc(t=t.trim()))))}function gc(...t){const e=t.filter(nw);if(!e||!e.length)return;const r=[];if(dc(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),SPe(e[0])&&(r[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function Gd(t,e=!1){if(t==null||a_(t)||jf(t))return null;let r=t.indexOf("://");if(r===-1&&Pf(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=xD(t,!0)),t}function dc(t){return Pf(t)||GH(t)}function a_(t){return t!=null&&t.slice(0,5)==="blob:"}function jf(t){return t!=null&&t.slice(0,5)==="data:"}function BH(t){const e=Cb(t);return e&&e.isBase64?nPe(e.data):null}function pxt(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const bPe=/^data:(.*?)(;base64)?,(.*)$/;function Cb(t){const e=t.match(bPe);if(!e)return null;const[,r,i,s]=e;return{mediaType:r,isBase64:!!i,data:s}}function khe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function fxt(t){const e=BH(t);if(!e)return null;const r=Cb(t);return new Blob([e],{type:r.mediaType})}function mxt(t,e){wPe(t,e)}function wPe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function Pf(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function GH(t){return t!=null&&Nhe.test(t)}function xPe(t){return t!=null&&aPe.test(t)||Da.scheme==="https"&&Pf(t)}function TPe(t){return t!=null&&Fhe.test(t)||Da.scheme==="http"&&Pf(t)}function SPe(t){return t!=null&&lPe.test(t)}function jH(t){return Pf(t)?`https:${t}`:t.replace(Fhe,"https:")}function EPe(){return Da.scheme==="http"}function CV(){return Da.scheme==="https"}function xD(t,e=!1){return Pf(t)?t.slice(2):(t=t.replace(Nhe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function CPe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function HH(t){let e=0;if(dc(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function gxt(t,e){if(!t)return"";const r=go(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const s=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(s,"")}function APe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function Bhe(t){return t.replace(/\/+$/,"")}function OPe(t){if(/^https?:\/\//i.test(t)){const e=VH(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function RPe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function PPe(t){const e=IS.httpsDomains;if(!TPe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),cPe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return EPe()&&i===Da.authority&&!uPe.test(t)||(CV()&&i===Da.authority||e&&e.some(s=>i===s||i.endsWith(`.${s}`))||CV()&&!q4(t))&&(t=jH(t)),t}function AV(t,e,r){if(!(e&&r&&t&&dc(t)))return t;const i=t.indexOf("//"),s=t.indexOf("/",i+2),n=t.indexOf(":",i+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function OV(t){return typeof t=="string"?new t2(Zc(t)):(t.scheme||(t.scheme=Da.scheme),t)}function Ghe(t){return MPe.test(t)}function jhe(t,e){const r=go(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function Hhe(t,e,r){const i=go(t),s=i.query||{};return s[e]=String(r),`${i.path}?${KA(s)}`}function y6(t,e){const r=go(t),i=r.query||{};for(const n in e)i[n]=e[n];const s=KA(i);return s?`${r.path}?${s}`:r.path}function qH(t){if(t==null)return null;const e=t.match(qhe);return e?e[2]:null}function LJ(t){if(t==null)return null;const e=t.match(qhe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function yxt(t){return typeof t=="string"?Cb(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(Cb(i.result)),i.onerror=s=>r(s)})}const qhe=/([^.]*)\.([^\/]*)$/,MPe=/(^data:image\/svg|\.svg$)/i;function De(t,e,r){let i,s;return e===void 0?(s=t,i=[void 0]):typeof e!="string"?(s=t,i=[void 0],r=e):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=RH(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let Or=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&Ga(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function Ha(){return function(t,e){return new Or(t,{ignoreUnknown:!0,...e})}}let WH=class{constructor(e,r,i,s){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const ir=new WH(6378137,1/298.257223563,3e5,.006694379990137799),_f=new WH(3396190,1/169.8944472236118,23e4),Sg=new WH(1737400,0,0);var ih;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(ih||(ih={}));let g;const $={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)$[g]=0;for(g=2056;g<=2065;g++)$[g]=0;for(g=2067;g<=2135;g++)$[g]=0;for(g=2137;g<=2154;g++)$[g]=0;for(g=2161;g<=2170;g++)$[g]=0;for(g=2172;g<=2193;g++)$[g]=0;for(g=2195;g<=2198;g++)$[g]=0;for(g=2200;g<=2203;g++)$[g]=0;for(g=2205;g<=2217;g++)$[g]=0;for(g=2222;g<=2224;g++)$[g]=1;for(g=2225;g<=2250;g++)$[g]=2;for(g=2251;g<=2253;g++)$[g]=1;for(g=2257;g<=2264;g++)$[g]=2;for(g=2274;g<=2279;g++)$[g]=2;for(g=2280;g<=2282;g++)$[g]=1;for(g=2283;g<=2289;g++)$[g]=2;for(g=2290;g<=2292;g++)$[g]=0;for(g=2308;g<=2313;g++)$[g]=0;for(g=2315;g<=2491;g++)$[g]=0;for(g=2494;g<=2866;g++)$[g]=0;for(g=2867;g<=2869;g++)$[g]=1;for(g=2870;g<=2888;g++)$[g]=2;for(g=2891;g<=2895;g++)$[g]=2;for(g=2896;g<=2898;g++)$[g]=1;for(g=2902;g<=2908;g++)$[g]=2;for(g=2915;g<=2920;g++)$[g]=2;for(g=2921;g<=2923;g++)$[g]=1;for(g=2924;g<=2930;g++)$[g]=2;for(g=2931;g<=2962;g++)$[g]=0;for(g=2964;g<=2968;g++)$[g]=2;for(g=2969;g<=2973;g++)$[g]=0;for(g=2975;g<=2991;g++)$[g]=0;for(g=2995;g<=3051;g++)$[g]=0;for(g=3054;g<=3079;g++)$[g]=0;for(g=3081;g<=3088;g++)$[g]=0;for(g=3092;g<=3101;g++)$[g]=0;for(g=3106;g<=3138;g++)$[g]=0;for(g=3146;g<=3151;g++)$[g]=0;for(g=3153;g<=3166;g++)$[g]=0;for(g=3168;g<=3172;g++)$[g]=0;for(g=3174;g<=3203;g++)$[g]=0;for(g=3294;g<=3358;g++)$[g]=0;for(g=3367;g<=3403;g++)$[g]=0;for(g=3408;g<=3416;g++)$[g]=0;for(g=3417;g<=3438;g++)$[g]=2;for(g=3441;g<=3446;g++)$[g]=2;for(g=3447;g<=3450;g++)$[g]=0;for(g=3451;g<=3459;g++)$[g]=2;for(g=3460;g<=3478;g++)$[g]=0;for(g=3554;g<=3559;g++)$[g]=0;for(g=3560;g<=3570;g++)$[g]=2;for(g=3571;g<=3581;g++)$[g]=0;for(g=3594;g<=3597;g++)$[g]=0;for(g=3601;g<=3604;g++)$[g]=0;for(g=3637;g<=3639;g++)$[g]=0;for(g=3665;g<=3667;g++)$[g]=0;for(g=3693;g<=3695;g++)$[g]=0;for(g=3701;g<=3727;g++)$[g]=0;for(g=3728;g<=3739;g++)$[g]=2;for(g=3740;g<=3751;g++)$[g]=0;for(g=3753;g<=3760;g++)$[g]=2;for(g=3761;g<=3773;g++)$[g]=0;for(g=3775;g<=3777;g++)$[g]=0;for(g=3779;g<=3781;g++)$[g]=0;for(g=3783;g<=3785;g++)$[g]=0;for(g=3788;g<=3791;g++)$[g]=0;for(g=3797;g<=3802;g++)$[g]=0;for(g=3814;g<=3816;g++)$[g]=0;for(g=3825;g<=3829;g++)$[g]=0;for(g=3832;g<=3841;g++)$[g]=0;for(g=3844;g<=3852;g++)$[g]=0;for(g=3873;g<=3885;g++)$[g]=0;for(g=3890;g<=3893;g++)$[g]=0;for(g=3907;g<=3912;g++)$[g]=0;for(g=3942;g<=3950;g++)$[g]=0;for(g=3968;g<=3970;g++)$[g]=0;for(g=3973;g<=3976;g++)$[g]=0;for(g=3986;g<=3989;g++)$[g]=0;for(g=3994;g<=3997;g++)$[g]=0;for(g=4048;g<=4051;g++)$[g]=0;for(g=4056;g<=4063;g++)$[g]=0;for(g=4093;g<=4096;g++)$[g]=0;for(g=4390;g<=4398;g++)$[g]=0;for(g=4399;g<=4413;g++)$[g]=2;for(g=4418;g<=4433;g++)$[g]=2;for(g=4455;g<=4457;g++)$[g]=2;for(g=4484;g<=4489;g++)$[g]=0;for(g=4491;g<=4554;g++)$[g]=0;for(g=4568;g<=4589;g++)$[g]=0;for(g=4652;g<=4656;g++)$[g]=0;for(g=4766;g<=4800;g++)$[g]=0;for(g=5014;g<=5016;g++)$[g]=0;for(g=5069;g<=5072;g++)$[g]=0;for(g=5105;g<=5130;g++)$[g]=0;for(g=5173;g<=5188;g++)$[g]=0;for(g=5253;g<=5259;g++)$[g]=0;for(g=5269;g<=5275;g++)$[g]=0;for(g=5292;g<=5311;g++)$[g]=0;for(g=5329;g<=5331;g++)$[g]=0;for(g=5343;g<=5349;g++)$[g]=0;for(g=5355;g<=5357;g++)$[g]=0;for(g=5387;g<=5389;g++)$[g]=0;for(g=5459;g<=5463;g++)$[g]=0;for(g=5479;g<=5482;g++)$[g]=0;for(g=5518;g<=5520;g++)$[g]=0;for(g=5530;g<=5539;g++)$[g]=0;for(g=5550;g<=5552;g++)$[g]=0;for(g=5562;g<=5583;g++)$[g]=0;for(g=5623;g<=5625;g++)$[g]=2;for(g=5631;g<=5639;g++)$[g]=0;for(g=5649;g<=5653;g++)$[g]=0;for(g=5663;g<=5680;g++)$[g]=0;for(g=5682;g<=5685;g++)$[g]=0;for(g=5875;g<=5877;g++)$[g]=0;for(g=5896;g<=5899;g++)$[g]=0;for(g=5921;g<=5940;g++)$[g]=0;for(g=6050;g<=6125;g++)$[g]=0;for(g=6244;g<=6275;g++)$[g]=0;for(g=6328;g<=6348;g++)$[g]=0;for(g=6350;g<=6356;g++)$[g]=0;for(g=6366;g<=6372;g++)$[g]=0;for(g=6381;g<=6387;g++)$[g]=0;for(g=6393;g<=6404;g++)$[g]=0;for(g=6480;g<=6483;g++)$[g]=0;for(g=6511;g<=6514;g++)$[g]=0;for(g=6579;g<=6581;g++)$[g]=0;for(g=6619;g<=6624;g++)$[g]=0;for(g=6625;g<=6627;g++)$[g]=2;for(g=6628;g<=6632;g++)$[g]=0;for(g=6634;g<=6637;g++)$[g]=0;for(g=6669;g<=6692;g++)$[g]=0;for(g=6707;g<=6709;g++)$[g]=0;for(g=6720;g<=6723;g++)$[g]=0;for(g=6732;g<=6738;g++)$[g]=0;for(g=6931;g<=6933;g++)$[g]=0;for(g=6956;g<=6959;g++)$[g]=0;for(g=7005;g<=7007;g++)$[g]=0;for(g=7057;g<=7070;g++)$[g]=2;for(g=7074;g<=7082;g++)$[g]=0;for(g=7109;g<=7118;g++)$[g]=0;for(g=7119;g<=7127;g++)$[g]=1;for(g=7374;g<=7376;g++)$[g]=0;for(g=7528;g<=7586;g++)$[g]=0;for(g=7587;g<=7645;g++)$[g]=2;for(g=7692;g<=7696;g++)$[g]=0;for(g=7755;g<=7787;g++)$[g]=0;for(g=7791;g<=7795;g++)$[g]=0;for(g=7799;g<=7801;g++)$[g]=0;for(g=7803;g<=7805;g++)$[g]=0;for(g=7825;g<=7831;g++)$[g]=0;for(g=7845;g<=7859;g++)$[g]=0;for(g=8013;g<=8032;g++)$[g]=0;for(g=8065;g<=8068;g++)$[g]=1;for(g=8518;g<=8529;g++)$[g]=2;for(g=8533;g<=8536;g++)$[g]=2;for(g=8538;g<=8540;g++)$[g]=2;for(g=8677;g<=8679;g++)$[g]=0;for(g=8836;g<=8840;g++)$[g]=0;for(g=8857;g<=8859;g++)$[g]=0;for(g=8908;g<=8910;g++)$[g]=0;for(g=9154;g<=9159;g++)$[g]=0;for(g=9205;g<=9218;g++)$[g]=0;for(g=9271;g<=9273;g++)$[g]=0;for(g=9295;g<=9297;g++)$[g]=0;for(g=9356;g<=9360;g++)$[g]=0;for(g=9404;g<=9407;g++)$[g]=0;for(g=9476;g<=9482;g++)$[g]=0;for(g=9487;g<=9494;g++)$[g]=0;for(g=9697;g<=9699;g++)$[g]=0;for(g=9821;g<=9865;g++)$[g]=0;for(g=20002;g<=20032;g++)$[g]=0;for(g=20047;g<=20049;g++)$[g]=0;for(g=20062;g<=20092;g++)$[g]=0;for(g=20135;g<=20138;g++)$[g]=0;for(g=20248;g<=20258;g++)$[g]=0;for(g=20348;g<=20358;g++)$[g]=0;for(g=20436;g<=20440;g++)$[g]=0;for(g=20822;g<=20824;g++)$[g]=0;for(g=20904;g<=20932;g++)$[g]=0;for(g=20934;g<=20936;g++)$[g]=0;for(g=21004;g<=21032;g++)$[g]=0;for(g=21035;g<=21037;g++)$[g]=0;for(g=21095;g<=21097;g++)$[g]=0;for(g=21148;g<=21150;g++)$[g]=0;for(g=21207;g<=21264;g++)$[g]=0;for(g=21307;g<=21364;g++)$[g]=0;for(g=21413;g<=21423;g++)$[g]=0;for(g=21453;g<=21463;g++)$[g]=0;for(g=21473;g<=21483;g++)$[g]=0;for(g=21780;g<=21782;g++)$[g]=0;for(g=21891;g<=21894;g++)$[g]=0;for(g=21896;g<=21899;g++)$[g]=0;for(g=22171;g<=22177;g++)$[g]=0;for(g=22181;g<=22187;g++)$[g]=0;for(g=22191;g<=22197;g++)$[g]=0;for(g=22207;g<=22222;g++)$[g]=0;for(g=22234;g<=22236;g++)$[g]=0;for(g=22243;g<=22250;g++)$[g]=0;for(g=22262;g<=22265;g++)$[g]=0;for(g=22307;g<=22322;g++)$[g]=0;for(g=22348;g<=22357;g++)$[g]=0;for(g=22407;g<=22422;g++)$[g]=0;for(g=22462;g<=22465;g++)$[g]=0;for(g=22521;g<=22525;g++)$[g]=0;for(g=22607;g<=22622;g++)$[g]=0;for(g=22641;g<=22646;g++)$[g]=0;for(g=22648;g<=22657;g++)$[g]=0;for(g=22707;g<=22722;g++)$[g]=0;for(g=22762;g<=22765;g++)$[g]=0;for(g=22991;g<=22994;g++)$[g]=0;for(g=23028;g<=23038;g++)$[g]=0;for(g=23830;g<=23853;g++)$[g]=0;for(g=23866;g<=23872;g++)$[g]=0;for(g=23877;g<=23884;g++)$[g]=0;for(g=23886;g<=23894;g++)$[g]=0;for(g=23946;g<=23948;g++)$[g]=0;for(g=24311;g<=24313;g++)$[g]=0;for(g=24342;g<=24347;g++)$[g]=0;for(g=24370;g<=24374;g++)$[g]=10;for(g=24375;g<=24381;g++)$[g]=0;for(g=24718;g<=24721;g++)$[g]=0;for(g=24817;g<=24821;g++)$[g]=0;for(g=24877;g<=24882;g++)$[g]=0;for(g=24891;g<=24893;g++)$[g]=0;for(g=25391;g<=25395;g++)$[g]=0;for(g=25828;g<=25838;g++)$[g]=0;for(g=26191;g<=26195;g++)$[g]=0;for(g=26391;g<=26393;g++)$[g]=0;for(g=26701;g<=26722;g++)$[g]=0;for(g=26729;g<=26799;g++)$[g]=2;for(g=26801;g<=26803;g++)$[g]=2;for(g=26811;g<=26813;g++)$[g]=2;for(g=26847;g<=26870;g++)$[g]=2;for(g=26891;g<=26899;g++)$[g]=0;for(g=26901;g<=26923;g++)$[g]=0;for(g=26929;g<=26946;g++)$[g]=0;for(g=26948;g<=26998;g++)$[g]=0;for(g=27037;g<=27040;g++)$[g]=0;for(g=27205;g<=27232;g++)$[g]=0;for(g=27258;g<=27260;g++)$[g]=0;for(g=27391;g<=27398;g++)$[g]=0;for(g=27561;g<=27564;g++)$[g]=0;for(g=27571;g<=27574;g++)$[g]=0;for(g=27581;g<=27584;g++)$[g]=0;for(g=27591;g<=27594;g++)$[g]=0;for(g=28191;g<=28193;g++)$[g]=0;for(g=28348;g<=28358;g++)$[g]=0;for(g=28402;g<=28432;g++)$[g]=0;for(g=28462;g<=28492;g++)$[g]=0;for(g=29118;g<=29122;g++)$[g]=0;for(g=29168;g<=29172;g++)$[g]=0;for(g=29177;g<=29185;g++)$[g]=0;for(g=29187;g<=29195;g++)$[g]=0;for(g=29900;g<=29903;g++)$[g]=0;for(g=30161;g<=30179;g++)$[g]=0;for(g=30491;g<=30494;g++)$[g]=0;for(g=30729;g<=30732;g++)$[g]=0;for(g=31251;g<=31259;g++)$[g]=0;for(g=31265;g<=31268;g++)$[g]=0;for(g=31275;g<=31279;g++)$[g]=0;for(g=31281;g<=31297;g++)$[g]=0;for(g=31461;g<=31469;g++)$[g]=0;for(g=31491;g<=31495;g++)$[g]=0;for(g=31917;g<=31922;g++)$[g]=0;for(g=31965;g<=32e3;g++)$[g]=0;for(g=32001;g<=32003;g++)$[g]=2;for(g=32005;g<=32031;g++)$[g]=2;for(g=32033;g<=32060;g++)$[g]=2;for(g=32064;g<=32067;g++)$[g]=2;for(g=32074;g<=32077;g++)$[g]=2;for(g=32081;g<=32086;g++)$[g]=0;for(g=32107;g<=32130;g++)$[g]=0;for(g=32133;g<=32159;g++)$[g]=0;for(g=32164;g<=32167;g++)$[g]=2;for(g=32180;g<=32199;g++)$[g]=0;for(g=32201;g<=32260;g++)$[g]=0;for(g=32301;g<=32360;g++)$[g]=0;for(g=32601;g<=32662;g++)$[g]=0;for(g=32664;g<=32667;g++)$[g]=2;for(g=32701;g<=32761;g++)$[g]=0;for(g=53001;g<=53004;g++)$[g]=0;for(g=53008;g<=53019;g++)$[g]=0;for(g=53021;g<=53032;g++)$[g]=0;for(g=53034;g<=53037;g++)$[g]=0;for(g=53042;g<=53046;g++)$[g]=0;for(g=53074;g<=53080;g++)$[g]=0;for(g=54001;g<=54004;g++)$[g]=0;for(g=54008;g<=54019;g++)$[g]=0;for(g=54021;g<=54032;g++)$[g]=0;for(g=54034;g<=54037;g++)$[g]=0;for(g=54042;g<=54046;g++)$[g]=0;for(g=54048;g<=54053;g++)$[g]=0;for(g=54074;g<=54080;g++)$[g]=0;for(g=54098;g<=54101;g++)$[g]=0;for(g=102001;g<=102040;g++)$[g]=0;for(g=102042;g<=102063;g++)$[g]=0;for(g=102065;g<=102067;g++)$[g]=0;for(g=102070;g<=102117;g++)$[g]=0;for(g=102122;g<=102216;g++)$[g]=0;for(g=102221;g<=102377;g++)$[g]=0;for(g=102382;g<=102388;g++)$[g]=0;for(g=102389;g<=102398;g++)$[g]=2;for(g=102399;g<=102444;g++)$[g]=0;for(g=102445;g<=102447;g++)$[g]=2;for(g=102448;g<=102458;g++)$[g]=0;for(g=102459;g<=102468;g++)$[g]=2;for(g=102469;g<=102499;g++)$[g]=0;for(g=102500;g<=102519;g++)$[g]=1;for(g=102520;g<=102524;g++)$[g]=0;for(g=102525;g<=102529;g++)$[g]=2;for(g=102530;g<=102588;g++)$[g]=0;for(g=102590;g<=102598;g++)$[g]=0;for(g=102601;g<=102603;g++)$[g]=0;for(g=102605;g<=102628;g++)$[g]=0;for(g=102629;g<=102646;g++)$[g]=2;for(g=102648;g<=102700;g++)$[g]=2;for(g=102701;g<=102703;g++)$[g]=0;for(g=102707;g<=102730;g++)$[g]=2;for(g=102733;g<=102758;g++)$[g]=2;for(g=102767;g<=102900;g++)$[g]=0;for(g=102901;g<=102933;g++)$[g]=2;for(g=102934;g<=102950;g++)$[g]=13;for(g=102951;g<=102955;g++)$[g]=0;for(g=102961;g<=102963;g++)$[g]=0;for(g=102965;g<=102969;g++)$[g]=0;for(g=102971;g<=102973;g++)$[g]=0;for(g=102975;g<=102989;g++)$[g]=0;for(g=102990;g<=102992;g++)$[g]=1;for(g=102997;g<=103002;g++)$[g]=0;for(g=103003;g<=103008;g++)$[g]=2;for(g=103009;g<=103011;g++)$[g]=0;for(g=103012;g<=103014;g++)$[g]=2;for(g=103019;g<=103021;g++)$[g]=0;for(g=103022;g<=103024;g++)$[g]=2;for(g=103029;g<=103031;g++)$[g]=0;for(g=103032;g<=103034;g++)$[g]=2;for(g=103065;g<=103068;g++)$[g]=0;for(g=103074;g<=103076;g++)$[g]=0;for(g=103077;g<=103079;g++)$[g]=1;for(g=103080;g<=103082;g++)$[g]=0;for(g=103083;g<=103085;g++)$[g]=2;for(g=103090;g<=103093;g++)$[g]=0;for(g=103097;g<=103099;g++)$[g]=0;for(g=103100;g<=103102;g++)$[g]=2;for(g=103107;g<=103109;g++)$[g]=0;for(g=103110;g<=103112;g++)$[g]=2;for(g=103113;g<=103116;g++)$[g]=0;for(g=103117;g<=103120;g++)$[g]=2;for(g=103153;g<=103157;g++)$[g]=0;for(g=103158;g<=103162;g++)$[g]=2;for(g=103163;g<=103165;g++)$[g]=0;for(g=103166;g<=103168;g++)$[g]=1;for(g=103169;g<=103171;g++)$[g]=2;for(g=103186;g<=103188;g++)$[g]=0;for(g=103189;g<=103191;g++)$[g]=2;for(g=103192;g<=103195;g++)$[g]=0;for(g=103196;g<=103199;g++)$[g]=2;for(g=103200;g<=103224;g++)$[g]=0;for(g=103225;g<=103227;g++)$[g]=1;for(g=103232;g<=103237;g++)$[g]=0;for(g=103238;g<=103243;g++)$[g]=2;for(g=103244;g<=103246;g++)$[g]=0;for(g=103247;g<=103249;g++)$[g]=2;for(g=103254;g<=103256;g++)$[g]=0;for(g=103257;g<=103259;g++)$[g]=2;for(g=103264;g<=103266;g++)$[g]=0;for(g=103267;g<=103269;g++)$[g]=2;for(g=103300;g<=103375;g++)$[g]=0;for(g=103381;g<=103383;g++)$[g]=0;for(g=103384;g<=103386;g++)$[g]=1;for(g=103387;g<=103389;g++)$[g]=0;for(g=103390;g<=103392;g++)$[g]=2;for(g=103397;g<=103399;g++)$[g]=0;for(g=103400;g<=103471;g++)$[g]=2;for(g=103476;g<=103478;g++)$[g]=0;for(g=103479;g<=103481;g++)$[g]=2;for(g=103486;g<=103488;g++)$[g]=0;for(g=103489;g<=103491;g++)$[g]=2;for(g=103492;g<=103495;g++)$[g]=0;for(g=103496;g<=103499;g++)$[g]=2;for(g=103528;g<=103543;g++)$[g]=0;for(g=103544;g<=103548;g++)$[g]=2;for(g=103549;g<=103551;g++)$[g]=0;for(g=103552;g<=103554;g++)$[g]=1;for(g=103555;g<=103557;g++)$[g]=2;for(g=103558;g<=103560;g++)$[g]=0;for(g=103571;g<=103573;g++)$[g]=0;for(g=103574;g<=103576;g++)$[g]=2;for(g=103577;g<=103580;g++)$[g]=0;for(g=103581;g<=103583;g++)$[g]=2;for(g=103595;g<=103694;g++)$[g]=0;for(g=103696;g<=103699;g++)$[g]=0;for(g=103700;g<=103793;g++)$[g]=2;for(g=103794;g<=103890;g++)$[g]=0;for(g=103891;g<=103896;g++)$[g]=2;for(g=103900;g<=103971;g++)$[g]=2;for(g=103972;g<=103977;g++)$[g]=0;for(g=112e3;g<=112101;g++)$[g]=0;const $Pe={102113:!0,102100:!0,3857:!0,3785:!0},IPe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},DJ='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',oP=[-20037508342788905e-9,20037508342788905e-9],aP=[-20037508342787e-6,20037508342787e-6],Whe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:oP,origin:aP,dx:1e-5},102100:{wkTemplate:DJ,valid:oP,origin:aP,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:oP,origin:aP,dx:1e-5},3857:{wkTemplate:DJ,valid:oP,origin:aP,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function wn(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||Ab(t)&&Ab(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function sb(t){return ra(t)&&t.wkid&&Whe[t.wkid]||null}function Xhe(t){return!!ra(t)&&(t.wkid?$[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function eO(t){return!(Hf(t)||qf(t))}function tO(t){return ra(t)&&t.wkid===4326}function Zhe(t){return ra(t)&&t.wkid===ih.CGCS2000}function Ab(t){return ra(t)&&t.wkid!=null&&$Pe[t.wkid]===!0}function rO(t){return ra(t)&&t.wkid===32662}function XH(t){return t===ih.GCSMARS2000||t===ih.GCSMARS2000_SPHERE}function Hf(t){return ra(t)&&t.wkid!=null&&XH(t.wkid)}function ZH(t){return t===ih.GCSMOON2000}function qf(t){return ra(t)&&t.wkid!=null&&ZH(t.wkid)}function LPe(t){return ra(t)&&t.wkid!=null&&IPe[t.wkid]===!0}function ra(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const DPe={wkid:4326,wkt:U4(Whe[4326].wkTemplate,{Central_Meridian:"0.0"})},NPe={wkid:102100,latestWkid:3857},FPe={wkid:32662};function YH(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Yhe=YH(ir),JH=YH(_f),QH=YH(Sg),Jhe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${ir.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Dr(t){return t!=null&&(Hf(t)||wn(t,JH))?_f:t!=null&&(qf(t)||wn(t,QH))?Sg:ir}function bxt(t){return XH(t)?_f:ZH(t)?Sg:ir}const KH=39.37,UPe=ir.radius*Math.PI/200,Qhe=/UNIT\[([^\]]+)\]\]$/i,nb=$,Khe=/UNIT\[([^\]]+)\]/i,VPe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),zPe=Ha()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),dp=t=>t*t,ny=t=>t*t*t,iO={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:dp(.001)},"square-centimeters":{inBaseUnits:dp(.01)},"square-decimeters":{inBaseUnits:dp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:dp(1e3)},"square-inches":{inBaseUnits:dp(.0254)},"square-feet":{inBaseUnits:dp(.3048)},"square-yards":{inBaseUnits:dp(.9144)},"square-miles":{inBaseUnits:dp(1609.344)},"square-us-feet":{inBaseUnits:dp(1200/3937)},acres:{inBaseUnits:.0015625*dp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*ny(.001)},"cubic-centimeters":{inBaseUnits:1e3*ny(.01)},"cubic-decimeters":{inBaseUnits:1e3*ny(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*ny(1e3)},"cubic-inches":{inBaseUnits:1e3*ny(.0254)},"cubic-feet":{inBaseUnits:1e3*ny(.3048)},"cubic-yards":{inBaseUnits:1e3*ny(.9144)},"cubic-miles":{inBaseUnits:1e3*ny(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},kPe=(()=>{const t={};for(const e in iO)for(const r in iO[e].units)t[r]=e;return t})();function BPe(t,e,r){return t*iO[r].units[e].inBaseUnits}function GPe(t,e,r){return t/iO[r].units[e].inBaseUnits}const jPe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function RV(t){const e=kPe[t];if(!e)throw new Error("unknown type");return e}function NJ(t,e=null){return e=e||RV(t),iO[e].baseUnit===t}function Oo(t,e,r){if(e===r)return t;const i=RV(e);if(i!==RV(r))throw new Error("incompatible units");const s=NJ(e,i)?t:BPe(t,e,i);return NJ(r,i)?s:GPe(s,r,i)}function wxt(t,e,r){switch(r){case"metric":return HPe(t,e);case"imperial":return WPe(t,e);default:return r}}function xxt(t,e,r){switch(r){case"metric":return qPe(t,e);case"imperial":return XPe(t,e);default:return r}}function HPe(t,e){const r=Oo(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function qPe(t,e){const r=Oo(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function WPe(t,e){const r=Oo(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function XPe(t,e){const r=Oo(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function Txt(t,e){const r=Oo(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function Sxt(t,e){const r=Oo(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function ZPe(t,e,r){return Oo(t,e,"meters")/(r*Math.PI/180)}function ede(t){return zPe.fromJSON(t.toLowerCase())||null}function sO(t){if(t!=null&&!eO(t))return 1;const e=qa(t);return e>1e5?1:e}function YPe(t){return qa(t)>=Dr(t).metersPerDegree?"meters":W4(t)}function qa(t,e=ir.metersPerDegree){return JPe(t,!0)??e}function JPe(t,e=!1){const r=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let s=null;if(r){if(XH(r))return _f.metersPerDegree;if(ZH(r))return Sg.metersPerDegree;s=nb.values[nb[r]],!s&&e&&VPe.has(r)&&(s=UPe)}else i&&(ide(i)?s=UJ(Qhe.exec(i),s):rde(i)&&(s=UJ(Khe.exec(i),s)));return s}function FJ(t){return t.isGeographic?1:qa(t)}function UJ(t,e){return t&&t[1]?tde(t[1]):e}function tde(t){return parseFloat(t.split(",")[1])}function W4(t){const e=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let i=null;if(e)i=nb.units[nb[e]];else if(r){const s=ide(r)?Qhe:rde(r)?Khe:null;if(s){const n=s.exec(r);n&&n[1]&&(i=KPe(n[1]))}}return i!=null?ede(i):null}function Ext(t){const e=W4(t);return e!=null&&jPe.includes(e)?e:null}function rde(t){return/^GEOCCS/i.test(t)}function ide(t){return/^PROJCS/i.test(t)}const QPe=1e-7;function KPe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!nb.units.includes(r)){const i=tde(t);r=null;const s=nb.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<QPe){r=nb.units[n];break}}return r}function Cxt(t){const e=W4(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const eMe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},tMe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},rMe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},iMe=Ha()(eMe),sMe=Ha()(tMe),Axt=Ha()(rMe);var $p;let _i=$p=class extends de{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return $p.WebMercator;if(t.wkid===4326)return $p.WGS84}const e=new $p;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return tO(this)}get isWebMercator(){return Ab(this)}get isGeographic(){return Xhe(this)}get isWrappable(){return LPe(this)}get metersPerUnit(){return qa(this)}get unit(){return W4(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===$p.WGS84)return $p.WGS84;if(this===$p.WebMercator)return $p.WebMercator;const t=new $p;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=Q(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||i?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):r?s.id===e&&s.referenceServiceName===r:s.id===e}return wn(this,t)}toJSON(t){return this.write(void 0,t)}};_i.GCS_NAD_1927=null,_i.WGS84=null,_i.WebMercator=null,_i.PlateCarree=null,u([d({readOnly:!0})],_i.prototype,"isWGS84",null),u([d({readOnly:!0})],_i.prototype,"isWebMercator",null),u([d({readOnly:!0})],_i.prototype,"isGeographic",null),u([d({readOnly:!0})],_i.prototype,"isWrappable",null),u([d({type:Yi,json:{write:!0}})],_i.prototype,"latestWkid",void 0),u([d({readOnly:!0})],_i.prototype,"metersPerUnit",null),u([d({readOnly:!0})],_i.prototype,"unit",null),u([d({type:Yi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],_i.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],_i.prototype,"wkt",void 0),u([De("wkt"),De("web-scene","wkt")],_i.prototype,"writeWkt",null),u([d({type:Yi,json:{write:!0}})],_i.prototype,"vcsWkid",void 0),u([d({type:Yi,json:{write:!0}})],_i.prototype,"latestVcsWkid",void 0),u([d()],_i.prototype,"imageCoordinateSystem",void 0),_i=$p=u([R("esri.geometry.SpatialReference")],_i),_i.prototype.toJSON.isDefaultToJSON=!0,_i.GCS_NAD_1927=new _i({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),_i.WGS84=new _i(DPe),_i.WebMercator=new _i(NPe),_i.PlateCarree=new _i(FPe),Object.freeze&&(Object.freeze(_i.GCS_NAD_1927),Object.freeze(_i.WGS84),Object.freeze(_i.WebMercator));const Ge=_i,sde="20230626",nde="b81703b48e0b92e492f4cc6b739af02a9af50038",nMe="4.27";let eq=nMe;eq="4.27.6";const oMe={async request(t,e){var a,l;const{default:r}=await ae(()=>Promise.resolve().then(()=>hde),void 0),i=t.options,s=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=zhe(t.url))!=null&&a.after)?s:"array-buffer";const n=await r(t.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let wr;function Oxt(t){wr=t}function Rxt(t){const e=wr==null?void 0:wr.findCredential(t);return e!=null&&e.token?Hhe(t,"token",e.token):t}oe("host-webworker");const aMe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function ode(t){const e=Gd(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!aMe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function ade(t,e,r=!1,i){return new Promise((s,n)=>{if(yn(i))return void n(VJ());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const h=t;c(),s(h)},l=()=>{if(!t)return;const h=t;c(),h.src="",n(VJ())};const c=()=>{oe("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),oe("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function VJ(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const lde="Timeout exceeded";function lMe(){return new Error(lde)}function Pxt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===lde}function cMe(t){Zr.request.crossOriginNoCorsDomains||(Zr.request.crossOriginNoCorsDomains={});const e=Zr.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[Gd(r)??""]=0:(e[Gd("http://"+r)??""]=0,e[Gd("https://"+r)??""]=0)}function uMe(t){const e=Zr.request.crossOriginNoCorsDomains;if(e){let r=Gd(t);if(r)return r=r.toLowerCase(),!I2(r,FH())&&e[r]<Date.now()-36e5}return!1}async function hMe(t){var s;const e=Zr.request.crossOriginNoCorsDomains,r=Gd(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=go(t);t=i.path,((s=i.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Nr(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=UH(e.query.toString().replaceAll("+"," ")));const r=jf(t),i=a_(t);i||r||(t=Bd(t));const s={url:t,requestOptions:{...e}};let n=zhe(t);if(n){const h=await vMe(n,s);if(h!=null)return{data:h,getHeader:tq,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(oe("host-webworker")||oe("host-node")))throw vf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw vf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw vf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await gMe(),TD)return TD.execute(t,e);const o=new AbortController;sa(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Td.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await wMe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let TD;const Td=Zr.request,cde="FormData"in globalThis,dMe=[499,498,403,401],pMe=["COM_0056","COM_0057","SB_0008"],fMe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],tq=()=>null,SD=Symbol();function mMe(t){const e=Gd(t);e&&!Nr._corsServers.includes(e)&&Nr._corsServers.push(e)}function zJ(t){const e=Gd(t);return!e||e.endsWith(".arcgis.com")||Nr._corsServers.includes(e)||zH(e)}function vf(t,e,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:tq,ssl:!1};if(e instanceof U)return e.details?(e.details=Q(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=n,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i==null?void 0:i.status,l=e.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=SD in e?e[SD]:e}return gs(e)?Lr():new U(t,s,n)}async function gMe(){oe("host-webworker")?TD||(TD=await ae(()=>import("./request-f0d45550.js"),[])):Nr._abortableFetch||(Nr._abortableFetch=globalThis.fetch.bind(globalThis))}async function PV(){wr||await ae(()=>import("./IdentityManager-de8ef342.js"),["assets/IdentityManager-de8ef342.js","assets/widget-60db6aca.js"])}async function yMe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,s=r.body;let n=null,o=null;if(cde&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in Nr._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Td.priority,redirect:"follow",signal:i},(n||o)&&(t.fetchOptions.body=n||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&Zr.apiKey&&ode(e)&&(r.query||(r.query={}),r.query.token=Zr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!ude(e)&&!yn(i)){let l;r.authMode==="immediate"?(await PV(),l=await wr.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await PV(),l=await wr.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):wr&&(l=wr.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function ude(t){return fMe.some(e=>e.test(t))}async function _Me(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},s=a_(e)||jf(e),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Td.timeout;let a=!1;if(!s){t.useSSL&&(e=jH(e)),r.cacheBust&&i.cache==="default"&&(e=Hhe(e,"request.preventCache",Date.now()));let f={...r.query};t.credentialToken&&(f.token=t.credentialToken);let m=KA(f);oe("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const y=e.length+1+m.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||y>Td.maxUrlLength;const v=r.useProxy||!!q4(e);if(v){const w=gPe(e);_=w.path,!a&&_.length+1+y>Td.maxUrlLength&&(a=!0),w.query&&(f={...w.query,...f})}if(i.method==="HEAD"&&(a||v)){if(a)throw y>Td.maxUrlLength?vf("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):vf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw vf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=y6(e,f):(i.body=KA(f),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=y6(e,f),v&&(t.useProxy=!0,e=`${_}?${e}`),f.token&&cde&&i.body instanceof FormData&&!sPe(e)&&i.body.set("token",f.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!I2(e,FH())){if(zH(e))t.withCredentials=!0;else if(wr){const w=wr.findServerInfo(e);w!=null&&w.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",uMe(e)&&await hMe(a?y6(e,f):e))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||bMe(r.headers)||!s&&!t.useProxy&&Td.proxyUrl&&!zJ(e)){if(l=await Nr._abortableFetch(e,i),t.useProxy||mMe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=kJ(c,"application/xml");break;case"document":c=kJ(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await BJ(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await BJ(e,t)}catch(f){if(f.name==="AbortError")throw p?lMe():Lr("Request canceled");if(!(!l&&f instanceof TypeError&&Td.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||zJ(e))throw f;t.redoRequest=!0,yPe({proxyUrl:Td.proxyUrl,urlPrefix:Gd(e)??""})}finally{h&&clearTimeout(h)}return[l,c]}async function vMe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(s){r=vf("request:interceptor",s,e)}if((i instanceof Error||i instanceof U)&&(r=vf("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function bMe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function kJ(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function wMe(t){var n,o;let e,r;await yMe(t);try{do[e,r]=await _Me(t);while(!await xMe(t,e,r))}catch(a){const l=vf("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!zH(i)){const a=Gd(i,!0);a&&Td.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&cMe(r.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&wr){const a=wr.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=wr.findCredential(l,s.userId);c&&wr._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getHeader:e?a=>e==null?void 0:e.headers.get(a):tq,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function xMe(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[SD]=r,s.details=r.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[SD]=r,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&dMe.includes(n)&&!ude(t.params.url)&&(n!==403||o&&!pMe.includes(o)&&(a==null||a===2&&t.credentialToken))){await PV();try{const h=await wr.getCredential(t.params.url,{error:vf("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=h,t.credentialToken=h.token,t.useSSL=t.useSSL||h.ssl,!1}catch(h){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=h}}if(s)throw s;return!0}function BJ(t,e,r=!1){const i=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Td.priority,s.src=t,ade(s,t,r,i)}Nr._abortableFetch=null,Nr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const hde=Object.freeze(Object.defineProperty({__proto__:null,default:Nr},Symbol.toStringTag,{value:"Module"}));function Se(t,e,r){let i,s;return e===void 0||Array.isArray(e)?(s=t,r=e,i=[void 0]):(s=e,i=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=RH(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Ip=class extends de{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ge.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof Ge)return e;if(e!=null){const i=new Ge;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};u([d()],Ip.prototype,"type",void 0),u([d({readOnly:!0})],Ip.prototype,"cache",null),u([d({readOnly:!0})],Ip.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ip.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ip.prototype,"hasZ",void 0),u([d({type:Ge,json:{write:!0},value:Ge.WGS84})],Ip.prototype,"spatialReference",void 0),u([Se("spatialReference")],Ip.prototype,"readSpatialReference",null),Ip=u([R("esri.geometry.Geometry")],Ip);const M_=Ip,TMe=Object.prototype.toString;function SMe(t){const e="__accessorMetadata__"in t?Hs(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return EMe.apply(this,r)}}function EMe(t,e,r,i){tR(t,e).cast=i}function CMe(t){return(e,r)=>{tR(e,t).cast=e[r]}}function gr(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&TMe.call(t[0])==="[object Function]"?SMe(t[0]):t.length===1&&typeof t[0]=="string"?CMe(t[0]):void 0}function AMe(t,e){const r=t.x-e.x,i=t.y-e.y,s=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+s*s)}const OMe=57.29577951308232,RMe=.017453292519943;function GJ(t){return t*OMe}function jJ(t){return t*RMe}function HJ(t){return t/ir.radius}function ED(t){return Math.PI/2-2*Math.atan(Math.exp(-t/ir.radius))}function MV(t){return t.wkid!=null||t.wkt!=null}const _6=[0,0];function CD(t,e,r,i,s){const n=t,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,_6,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,_6,i),[o.xmax,o.ymax]=e(n.xmax,n.ymax,_6,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(e(p[f][0],p[f][1],[0,0],i)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function e_(t,e){const r=t&&(MV(t)?t:t.spatialReference),i=e&&(MV(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!wn(i,r)||Ab(i)&&tO(r)||Ab(r)&&tO(i))}function ow(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(MV(e)?e:e.spatialReference);return e_(r,i)?wn(r,i)?Q(t):Ab(i)?CD(t,DT,Ge.WebMercator,!1,Q(t)):tO(i)?CD(t,eA,Ge.WGS84,!1,Q(t)):null:null}function DT(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=jJ(e);return r[0]=jJ(t)*ir.radius,r[1]=ir.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function eA(t,e,r=[0,0],i=!1){const s=GJ(t/ir.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=GJ(Math.PI/2-2*Math.atan(Math.exp(-e/ir.radius))),r}function tA(t,e=!1,r=Q(t)){return CD(t,DT,Ge.WebMercator,e,r)}function bC(t,e=!1,r=Q(t)){return CD(t,eA,Ge.WGS84,e,r)}var fI;const dE=[0,0];function qJ(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let sl=fI=class extends M_{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],r=n[2],i=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ge(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)J.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)J.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=DT(n.longitude,n.latitude,dE);t=a[0],e=a[1]}}}else qJ(r)?(s=r,r=null):qJ(i)&&(s=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?J.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&J.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return eA(e,r,dE)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",DT(r,t,dE)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return eA(t,e,dE)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",DT(t,e,dE)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new fI;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return fI.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:h}=t;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=DT(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=eA(l,c),h=n}return e===l&&r===c&&i===o&&s===a&&n.wkid===h.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=sb(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,s=2*i;let n;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s),this._set("x",e),this}distance(t){return AMe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],sl.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],sl.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],sl.prototype,"hasZ",null),u([d({type:Number})],sl.prototype,"latitude",null),u([d({type:Number})],sl.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),gr(t=>isNaN(t)?t:Zu(t))],sl.prototype,"x",void 0),u([De("x")],sl.prototype,"writeX",null),u([Se("x")],sl.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],sl.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],sl.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],sl.prototype,"m",void 0),sl=fI=u([R("esri.geometry.Point")],sl),sl.prototype.toJSON.isDefaultToJSON=!0;const pt=sl,v6=[0,0];function rq(t,e){return e!=null&&Ra(t,e.x,e.y,e.z)}function $xt(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!L2(t,r))return!1;return!0}function PMe(t,e){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Ra(t,r,i,s)&&Ra(t,r,o,s)&&Ra(t,n,o,s)&&Ra(t,n,i,s)&&Ra(t,r,i,a)&&Ra(t,r,o,a)&&Ra(t,n,o,a)&&Ra(t,n,i,a):Ra(t,r,i)&&Ra(t,r,o)&&Ra(t,n,o)&&Ra(t,n,i)}function L2(t,e){return Ra(t,e[0],e[1])}function MMe(t,e){return Ra(t,e[0],e[1],e[2])}function Ra(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function $Me(t,e){return v6[1]=e.y,v6[0]=e.x,IMe(t,v6)}function IMe(t,e){return dde(t.rings,e)}function dde(t,e){if(!t)return!1;if(LMe(t))return WJ(!1,t,e);let r=!1;for(let i=0,s=t.length;i<s;i++)r=WJ(r,t[i],e);return r}function LMe(t){return!Array.isArray(t[0][0])}function WJ(t,e,r){const[i,s]=r;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=e[a],[p,f]=e[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<i&&(n=!n)}return n}function DMe(t,e){return rq(t,e)}function NMe(t,e){const r=t.hasZ&&e.hasZ;let i,s,n;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function FMe(t,e){const{points:r,hasZ:i}=e,s=i?MMe:L2;for(const n of r)if(s(t,n))return!0;return!1}const Ob=[0,0],Rb=[0,0],Pb=[0,0],Mb=[0,0],UMe=[Ob,Rb,Pb,Mb],pde=[[Pb,Ob],[Ob,Rb],[Rb,Mb],[Mb,Pb]];function VMe(t,e){return zMe(t,e.rings)}function zMe(t,e){Ob[0]=t.xmin,Ob[1]=t.ymax,Rb[0]=t.xmax,Rb[1]=t.ymax,Pb[0]=t.xmin,Pb[1]=t.ymin,Mb[0]=t.xmax,Mb[1]=t.ymin;for(const r of UMe)if(dde(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(L2(t,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(L2(t,n)||fde(i,n,pde))return!0;i=n}}return!1}function kMe(t,e){Ob[0]=t.xmin,Ob[1]=t.ymax,Rb[0]=t.xmax,Rb[1]=t.ymax,Pb[0]=t.xmin,Pb[1]=t.ymin,Mb[0]=t.xmax,Mb[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(L2(t,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(L2(t,o)||fde(s,o,pde))return!0;s=o}}return!1}const wo=[0,0];function BMe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],h=t[a][l+1];if($V(n,o,c,h,wo)&&!(wo[0]===n[0]&&wo[1]===n[1]||wo[0]===c[0]&&wo[1]===c[1]||wo[0]===o[0]&&wo[1]===o[1]||wo[0]===h[0]&&wo[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],h=r[l+1];if($V(o,a,c,h,wo)&&!(wo[0]===o[0]&&wo[1]===o[1]||wo[0]===c[0]&&wo[1]===c[1]||wo[0]===a[0]&&wo[1]===a[1]||wo[0]===h[0]&&wo[1]===h[1]))return!0}}}return!1}function fde(t,e,r){for(let i=0;i<r.length;i++)if($V(t,e,r[i][0],r[i][1]))return!0;return!1}function $V(t,e,r,i,s){const[n,o]=t,[a,l]=e,[c,h]=r,[p,f]=i,m=p-c,y=n-c,_=a-n,v=f-h,w=o-h,T=l-o,x=v*_-m*T;if(x===0)return!1;const S=(m*w-v*y)/x,O=(_*w-T*y)/x;return S>=0&&S<=1&&O>=0&&O<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function GMe(t){switch(t){case"esriGeometryEnvelope":case"extent":return NMe;case"esriGeometryMultipoint":case"multipoint":return FMe;case"esriGeometryPoint":case"point":return DMe;case"esriGeometryPolygon":case"polygon":return VMe;case"esriGeometryPolyline":case"polyline":return kMe}}var Cu;function jMe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function oy(t,e,r){return e==null?r:r==null?e:t(e,r)}let Qn=Cu=class extends M_{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,s){return jMe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Ge.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:s??Ge.WGS84}}static fromBounds(t,e){return new Cu({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Cu({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new pt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Cu;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&e_(e,r)&&(t=e.isWebMercator?tA(t):bC(t,!0)),t.type==="point"?rq(this,t):t.type==="extent"&&PMe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&e_(e,r)&&(t=e.isWebMercator?tA(t):bC(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!wn(e,r)&&e_(e,r)&&(t=e.isWebMercator?tA(t):bC(t,!0)),GMe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=oy(Math.min,this.zmin,t.zmin),this.zmax=oy(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=oy(Math.min,this.mmin,t.mmin),this.mmax=oy(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=oy(Math.max,this.zmin,t.zmin),this.zmax=oy(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=oy(Math.max,this.mmin,t.mmin),this.mmax=oy(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=sb(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?bC(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new Ge(U4((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const s=r??sb(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;t=t||sb(o);const[p,f]=t.valid;h=this._normalizeX(this.xmin,t);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,t);const _=h.x,v=h.frameId,w=m===_&&a>0;if(a>2*f){const T=new Cu(l<c?m:_,s,f,n,o),x=new Cu(p,s,l<c?_:m,n,o),S=new Cu(0,s,f,n,o),O=new Cu(p,s,0,n,o),A=[],P=[];T.contains(S)&&A.push(y),T.contains(O)&&P.push(y),x.contains(S)&&A.push(v),x.contains(O)&&P.push(v);for(let I=y+1;I<v;I++)A.push(I),P.push(I);e.push({extent:T,frameIds:[y]},{extent:x,frameIds:[v]},{extent:S,frameIds:A},{extent:O,frameIds:P})}else m>_||w?e.push({extent:new Cu(m,s,f,n,o),frameIds:[y]},{extent:new Cu(p,s,_,n,o),frameIds:[v]}):e.push({extent:new Cu(m,s,_,n,o),frameIds:[y]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}_normalizeX(t,e){const[r,i]=e.valid,s=2*i;let n,o=0;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s,o=n):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s,o=-n),{x:t,frameId:o}}};u([d({readOnly:!0})],Qn.prototype,"cache",null),u([d({readOnly:!0})],Qn.prototype,"center",null),u([d({readOnly:!0})],Qn.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Qn.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Qn.prototype,"hasZ",null),u([d({readOnly:!0})],Qn.prototype,"height",null),u([d({readOnly:!0})],Qn.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Qn.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Qn.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Qn.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Qn.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Qn.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Qn.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Qn.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Qn.prototype,"zmax",void 0),Qn=Cu=u([R("esri.geometry.Extent")],Qn),Qn.prototype.toJSON.isDefaultToJSON=!0;const yr=Qn;let rA;var bue,wue;const HMe=((bue=globalThis.esriConfig)==null?void 0:bue.locale)??((wue=globalThis.dojoConfig)==null?void 0:wue.locale);function mde(){var t;return HMe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function jd(){return rA===void 0&&(rA=mde()),rA}const iA=[];function gde(t){return iA.push(t),{remove(){iA.splice(iA.indexOf(t),1)}}}const IV=[];function iq(t){return IV.push(t),{remove(){iA.splice(IV.indexOf(t),1)}}}function qMe(){const t=mde();rA!==t&&(rA=t,[...IV].forEach(e=>{e.call(null,t)}),[...iA].forEach(e=>{e.call(null,t)}))}var xue;(xue=globalThis.addEventListener)==null||xue.call(globalThis,"languagechange",qMe);let lP;function WMe(t){return lP&&!lP.destroyed||(lP=t()),lP}var LV;const XMe=new Or({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Au=LV=class extends xe{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new LV({categories:this.categories?Q(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=ow(this.extent,Ge.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>XMe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};u([d()],Au.prototype,"categories",void 0),u([d()],Au.prototype,"disableExtraQuery",void 0),u([d({type:yr})],Au.prototype,"extent",void 0),u([d()],Au.prototype,"filter",void 0),u([d()],Au.prototype,"num",void 0),u([d()],Au.prototype,"query",void 0),u([d()],Au.prototype,"sortField",void 0),u([d()],Au.prototype,"sortOrder",null),u([d()],Au.prototype,"start",void 0),Au=LV=u([R("esri.portal.PortalQueryParams")],Au);const af=Au;let $v=class extends xe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],$v.prototype,"nextQueryParams",void 0),u([d()],$v.prototype,"queryParams",void 0),u([d()],$v.prototype,"results",void 0),u([d()],$v.prototype,"total",void 0),$v=u([R("esri.portal.PortalQueryResult")],$v);const ZMe=$v;let bm=class extends de{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new U("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],bm.prototype,"created",void 0),u([d()],bm.prototype,"id",void 0),u([d()],bm.prototype,"portal",void 0),u([d()],bm.prototype,"title",void 0),u([d({readOnly:!0})],bm.prototype,"url",null),u([d()],bm.prototype,"username",void 0),bm=u([R("esri.portal.PortalFolder")],bm);const YMe=bm;let Kn=class extends de{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,r=this.thumbnail;return e&&r&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return Ql(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(s=>s.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return Ql(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new U("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=Hs(af,e);const s=Ql(this.portal);return parseFloat(s.currentVersion)>5?(i=i||new af,s.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new af,i.query="group:"+this.id+(i.query?" "+i.query:""),s.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=Ql(this.portal);return i.fetchSelf(i.authMode,!0,r).then(s=>{const n=s.contentCategorySetsGroupQuery;if(n){const o=new af;return o.disableExtraQuery=!0,o.num=1,o.query=n,i.queryGroups(o,r)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(s=>{if(s.total){const n=s.results[0],o=new af;return o.num=1,o.query=`typekeywords:"${e}"`,n.queryItems(o,r)}throw new U("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(s=>s.total?s.results[0].fetchData("json",r).then(n=>{const o=n&&n.categorySchema;return o&&o.length?o:[]}):[])}};u([d()],Kn.prototype,"access",void 0),u([d({type:Date})],Kn.prototype,"created",void 0),u([d()],Kn.prototype,"description",void 0),u([d()],Kn.prototype,"id",void 0),u([d()],Kn.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Kn.prototype,"modified",void 0),u([d()],Kn.prototype,"owner",void 0),u([d()],Kn.prototype,"portal",void 0),u([d()],Kn.prototype,"snippet",void 0),u([d()],Kn.prototype,"sortField",void 0),u([d()],Kn.prototype,"sortOrder",void 0),u([d()],Kn.prototype,"tags",void 0),u([d()],Kn.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Kn.prototype,"thumbnailUrl",null),u([d()],Kn.prototype,"title",void 0),u([d({readOnly:!0})],Kn.prototype,"url",null),Kn=u([R("esri.portal.PortalGroup")],Kn);const DV=Kn,JMe=Object.freeze(Object.defineProperty({__proto__:null,default:DV},Symbol.toStringTag,{value:"Module"}));var NV;let cs=NV=class extends de{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const s=YMe.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=DV.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),ae(()=>Promise.resolve().then(()=>yde),void 0).then(({default:s})=>{r=s;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:n})}).then(s=>{let n;return s&&s.items?(n=s.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(n.map(o=>o.load())).catch(o=>o).then(()=>({items:n,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new DV({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new U("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new U("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new NV;return e.sourceJSON=t,e.read(t),e}};u([d()],cs.prototype,"access",void 0),u([d({type:Date})],cs.prototype,"created",void 0),u([d()],cs.prototype,"culture",void 0),u([d()],cs.prototype,"description",void 0),u([d()],cs.prototype,"email",void 0),u([d()],cs.prototype,"favGroupId",void 0),u([d()],cs.prototype,"fullName",void 0),u([d({type:Date})],cs.prototype,"modified",void 0),u([d()],cs.prototype,"orgId",void 0),u([d()],cs.prototype,"portal",void 0),u([d()],cs.prototype,"preferredView",void 0),u([d()],cs.prototype,"privileges",void 0),u([d()],cs.prototype,"region",void 0),u([d()],cs.prototype,"role",void 0),u([d()],cs.prototype,"roleId",void 0),u([d()],cs.prototype,"sourceJSON",void 0),u([d()],cs.prototype,"thumbnail",void 0),u([d({readOnly:!0})],cs.prototype,"thumbnailUrl",null),u([d()],cs.prototype,"units",void 0),u([d({readOnly:!0})],cs.prototype,"userContentUrl",null),u([d({readOnly:!0})],cs.prototype,"url",null),u([d()],cs.prototype,"username",void 0),u([d()],cs.prototype,"userType",void 0),cs=NV=u([R("esri.portal.PortalUser")],cs);const sq=cs,QMe=Object.freeze(Object.defineProperty({__proto__:null,default:sq},Symbol.toStringTag,{value:"Module"}));var wm;let cP;const XJ={PortalGroup:()=>ae(()=>Promise.resolve().then(()=>JMe),void 0),PortalItem:()=>ae(()=>Promise.resolve().then(()=>yde),void 0),PortalUser:()=>ae(()=>Promise.resolve().then(()=>QMe),void 0)};let Me=wm=class extends MS(Tg){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Zr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){ZJ.unregister(this),this.defaultBasemap=Pe(this.defaultBasemap),this.defaultDevBasemap=Pe(this.defaultDevBasemap),this.defaultVectorBasemap=Pe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Li(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Zr.request.trustedServers.includes(e)||Zr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=sq.fromJSON(t),e.portal=this),e}load(t){const e=ae(()=>Promise.resolve().then(()=>E$e),void 0).then(({default:r})=>{Jt(t),cP=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(wr){const s=wr;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==wm.AUTH_MODE_AUTO||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",KMe(new WeakRef(this))),ZJ.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ae(()=>import("./ElevationLayer-3bf75386.js"),["assets/ElevationLayer-3bf75386.js","assets/ArcGISCachedService-5d75b0f4.js","assets/TileInfoTilemapCache-23f2ee40.js","assets/TilemapCache-db254c4f.js"])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):yn(t)?Promise.reject(Lr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new af;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const s of e)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(s=>s.results)}return yn(t)?Promise.reject(Lr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||jd();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||jd();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return WMe(()=>new wm)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",s={authMode:t,query:{culture:jd().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(i,s)}queryPortal(t,e,r,i){const s=Hs(af,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new ZMe({nextQueryParams:l,queryParams:s,total:a.total,results:wm._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Po(l),a)));return r&&XJ[r]?XJ[r]().then(({default:o})=>(Jt(i),n(o))):n()}signIn(){if(this.authMode===wm.AUTH_MODE_ANONYMOUS)return Promise.reject(new U("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return wr?wr.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const s=wm._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===wm.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return Nr(this._normalizeSSL(t),c).then(h=>h.data)}toJSON(){throw new U("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new wm({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new U("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new af;r.query=t||(Zr.apiKey&&ode(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const s=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(r,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new cP({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new af({query:r,disableExtraQuery:!0}),s=await this.queryGroups(i,e);if(!s.total)return[];const n=s.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new cP({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=cP.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let s=[];if(r){const n=i!=null?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Me.AUTH_MODE_ANONYMOUS="anonymous",Me.AUTH_MODE_AUTO="auto",Me.AUTH_MODE_IMMEDIATE="immediate",u([d()],Me.prototype,"access",void 0),u([d()],Me.prototype,"allSSL",void 0),u([d()],Me.prototype,"authMode",void 0),u([d()],Me.prototype,"authorizedCrossOriginDomains",void 0),u([Se("authorizedCrossOriginDomains")],Me.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],Me.prototype,"basemapGalleryGroupQuery",void 0),u([d({json:{name:"3DBasemapGalleryGroupQuery"}})],Me.prototype,"basemapGalleryGroupQuery3D",void 0),u([d()],Me.prototype,"bingKey",void 0),u([d()],Me.prototype,"canListApps",void 0),u([d()],Me.prototype,"canListData",void 0),u([d()],Me.prototype,"canListPreProvisionedItems",void 0),u([d()],Me.prototype,"canProvisionDirectPurchase",void 0),u([d()],Me.prototype,"canSearchPublic",void 0),u([d()],Me.prototype,"canShareBingPublic",void 0),u([d()],Me.prototype,"canSharePublic",void 0),u([d()],Me.prototype,"canSignInArcGIS",void 0),u([d()],Me.prototype,"canSignInIDP",void 0),u([d()],Me.prototype,"colorSetsGroupQuery",void 0),u([d()],Me.prototype,"commentsEnabled",void 0),u([d({type:Date})],Me.prototype,"created",void 0),u([d()],Me.prototype,"credential",void 0),u([d()],Me.prototype,"culture",void 0),u([d()],Me.prototype,"currentVersion",void 0),u([d()],Me.prototype,"customBaseUrl",void 0),u([d()],Me.prototype,"defaultBasemap",void 0),u([Se("defaultBasemap")],Me.prototype,"readDefaultBasemap",null),u([d()],Me.prototype,"defaultDevBasemap",void 0),u([Se("defaultDevBasemap")],Me.prototype,"readDefaultDevBasemap",null),u([d({type:yr})],Me.prototype,"defaultExtent",void 0),u([d()],Me.prototype,"defaultVectorBasemap",void 0),u([Se("defaultVectorBasemap")],Me.prototype,"readDefaultVectorBasemap",null),u([d()],Me.prototype,"description",void 0),u([d()],Me.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],Me.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],Me.prototype,"extraQuery",null),u([d()],Me.prototype,"featuredGroups",void 0),u([d()],Me.prototype,"featuredItemsGroupQuery",void 0),u([d()],Me.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],Me.prototype,"livingAtlasGroupQuery",void 0),u([d()],Me.prototype,"hasCategorySchema",void 0),u([d()],Me.prototype,"helpBase",void 0),u([d()],Me.prototype,"helperServices",void 0),u([d()],Me.prototype,"helpMap",void 0),u([d()],Me.prototype,"homePageFeaturedContent",void 0),u([d()],Me.prototype,"homePageFeaturedContentCount",void 0),u([d()],Me.prototype,"httpPort",void 0),u([d()],Me.prototype,"httpsPort",void 0),u([d()],Me.prototype,"id",void 0),u([d()],Me.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],Me.prototype,"isOrganization",null),u([d()],Me.prototype,"isPortal",void 0),u([d()],Me.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],Me.prototype,"itemPageUrl",null),u([d()],Me.prototype,"layerTemplatesGroupQuery",void 0),u([d()],Me.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],Me.prototype,"modified",void 0),u([d()],Me.prototype,"name",void 0),u([d()],Me.prototype,"portalHostname",void 0),u([d()],Me.prototype,"portalMode",void 0),u([d()],Me.prototype,"portalProperties",void 0),u([d()],Me.prototype,"region",void 0),u([d({readOnly:!0})],Me.prototype,"restUrl",null),u([d()],Me.prototype,"rotatorPanels",void 0),u([d()],Me.prototype,"showHomePageDescription",void 0),u([d()],Me.prototype,"sourceJSON",void 0),u([d()],Me.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],Me.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],Me.prototype,"stylesGroupQuery3d",void 0),u([d()],Me.prototype,"supportsHostedServices",void 0),u([d()],Me.prototype,"symbolSetsGroupQuery",void 0),u([d()],Me.prototype,"templatesGroupQuery",void 0),u([d()],Me.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Me.prototype,"thumbnailUrl",null),u([d()],Me.prototype,"units",void 0),u([d()],Me.prototype,"url",void 0),u([d()],Me.prototype,"urlKey",void 0),u([Se("urlKey")],Me.prototype,"readUrlKey",null),u([d()],Me.prototype,"user",void 0),u([Se("user")],Me.prototype,"readUser",null),u([d()],Me.prototype,"use3dBasemaps",void 0),u([d()],Me.prototype,"useStandardizedQuery",void 0),u([d()],Me.prototype,"useVectorBasemaps",void 0),u([d()],Me.prototype,"vectorBasemapGalleryGroupQuery",void 0),Me=wm=u([R("esri.portal.Portal")],Me);const jn=Me,ZJ=new FinalizationRegistry(t=>{t.remove()});function KMe(t){const e=wr;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}const e$e=J.getLogger("esri.assets");function t$e(t,e){return Nr(kr(t),e)}function kr(t){if(!Zr.assetsPath)throw e$e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new U("assets:path-not-set","config.assetsPath is not set");return gc(Zr.assetsPath,t)}let xm=class extends xe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&dc(e)?J.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new U("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResource:i}=await ae(()=>Promise.resolve().then(()=>B3),void 0);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&dc(e)&&(e=kH(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],xm.prototype,"portalItem",void 0),u([d({type:String,value:null})],xm.prototype,"path",null),u([gr("path")],xm.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],xm.prototype,"url",null),u([d({type:String,readOnly:!0})],xm.prototype,"cdnUrl",null),u([d({type:String,readOnly:!0})],xm.prototype,"itemRelativeUrl",null),xm=u([R("esri.portal.PortalItemResource")],xm);const r$e=xm;let wC=class extends xe{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],wC.prototype,"created",void 0),u([d()],wC.prototype,"rating",void 0),wC=u([R("esri.portal.PortalRating")],wC);const b6=wC;var Iv;const i$e=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),s$e=new Set(["KML","GeoJson","CSV"]);let nr=Iv=class extends MS(Tg){static from(t){return Sb(Iv,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(t){return t&&t.length?new yr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),h=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=t==="map service"||t==="wms"||t==="wmts"?n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):s=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="360 vr experience"?"360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",s?kr(r+s+i+".png"):null}get isLayer(){return this.type!=null&&i$e.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&wr&&!wr.findCredential(t)&&(t=wr._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=jn.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof b6&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new b6({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:Q(this.applicationProxies),avgRating:this.avgRating,categories:Q(this.categories),created:Q(this.created),culture:this.culture,description:this.description,extent:Q(this.extent),groupCategories:Q(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Q(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Q(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Q(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Iv({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await Ql(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return Ql(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await Ql(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new b6(e)):null}fetchRelatedItems(t,e){return Ql(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Iv)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return Ql(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>Ql(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new U("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await Ql(e).signIn();const{copyResources:i,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!i,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new Iv({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")jf(e)?i.query={data:e}:i.query={url:Zc(e)},r!=null&&(i.query.filename=r);else{const s=new FormData;r!=null?s.append("file",e,r):s.append("file",e),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new U("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await ae(()=>Promise.resolve().then(()=>B3),void 0);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await ae(()=>Promise.resolve().then(()=>B3),void 0);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await ae(()=>Promise.resolve().then(()=>B3),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new U("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ae(()=>Promise.resolve().then(()=>B3),void 0);return e(this,t)}resourceFromPath(t){return new r$e({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:Q(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Q(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Q(this.typeKeywords),url:this.url};return Rue(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Iv({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};u([d({type:["private","shared","org","public"]})],nr.prototype,"access",void 0),u([d()],nr.prototype,"accessInformation",void 0),u([d({type:String})],nr.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],nr.prototype,"applicationProxies",void 0),u([d()],nr.prototype,"avgRating",void 0),u([d()],nr.prototype,"categories",void 0),u([d({type:Date})],nr.prototype,"created",void 0),u([d()],nr.prototype,"culture",void 0),u([d()],nr.prototype,"description",void 0),u([d({readOnly:!0})],nr.prototype,"displayName",null),u([d({type:yr})],nr.prototype,"extent",void 0),u([Se("extent")],nr.prototype,"readExtent",null),u([d()],nr.prototype,"groupCategories",void 0),u([d({readOnly:!0})],nr.prototype,"iconUrl",null),u([d()],nr.prototype,"id",void 0),u([d({readOnly:!0})],nr.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],nr.prototype,"isOrgItem",void 0),u([d()],nr.prototype,"itemControl",void 0),u([d({readOnly:!0})],nr.prototype,"itemPageUrl",null),u([d({readOnly:!0})],nr.prototype,"itemUrl",null),u([d()],nr.prototype,"licenseInfo",void 0),u([d({type:Date})],nr.prototype,"modified",void 0),u([d()],nr.prototype,"name",void 0),u([d()],nr.prototype,"numComments",void 0),u([d()],nr.prototype,"numRatings",void 0),u([d()],nr.prototype,"numViews",void 0),u([d()],nr.prototype,"owner",void 0),u([d()],nr.prototype,"ownerFolder",void 0),u([d({type:jn})],nr.prototype,"portal",void 0),u([d()],nr.prototype,"screenshots",void 0),u([d()],nr.prototype,"size",void 0),u([d()],nr.prototype,"snippet",void 0),u([d()],nr.prototype,"sourceJSON",void 0),u([d({type:String})],nr.prototype,"sourceUrl",void 0),u([d({type:String})],nr.prototype,"spatialReference",void 0),u([d()],nr.prototype,"tags",void 0),u([d()],nr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],nr.prototype,"thumbnailUrl",null),u([d()],nr.prototype,"title",void 0),u([d()],nr.prototype,"type",void 0),u([d()],nr.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(t,e){var r;if(s$e.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],nr.prototype,"url",void 0),u([d({readOnly:!0})],nr.prototype,"userItemUrl",null),nr=Iv=u([R("esri.portal.PortalItem")],nr);const ob=nr,yde=Object.freeze(Object.defineProperty({__proto__:null,default:ob},Symbol.toStringTag,{value:"Module"})),YJ=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,n$e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function JJ(t){return t in n$e}const xC=[],r2=new Map;function QJ(t){for(const e of r2.keys())vde(t.pattern,e)&&r2.delete(e)}function o$e(t){return xC.includes(t)||(QJ(t),xC.unshift(t)),{remove(){const e=xC.indexOf(t);e>-1&&(xC.splice(e,1),QJ(t))}}}async function _de(t){const e=jd();r2.has(t)||r2.set(t,l$e(t,e));const r=r2.get(t);return r&&await c$e.add(r),r}function a$e(t){if(!YJ.test(t))return null;const e=YJ.exec(t);if(e===null)return null;const[,r,i]=e,s=r+(i?"-"+i.toUpperCase():"");return JJ(s)?s:JJ(r)?r:null}async function l$e(t,e){const r=[];for(const i of xC)if(vde(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(s){r.push(s)}throw r.length?new U("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new U("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function vde(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}iq(()=>{r2.clear()});const c$e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=mo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function u$e(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await _de("esri/t9n/basemaps");return r[t]||r[e]}const FV={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return kr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return kr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return kr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return kr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return kr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return kr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return kr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return kr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return kr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return kr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return kr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return kr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function Uxt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function sA(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function D2(t){return t!=null&&"type"in t&&t.type==="group"}const Vxt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function bde(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function KJ(t){return(t==null?void 0:t.type)==="voxel"}function eQ(t){return(t==null?void 0:t.type)==="imagery-tile"}function wde(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function nq(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function zxt(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function h$e(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function xde(t,e){const r=wr==null?void 0:wr.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${t.substring(0,i)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await Nr(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function d$e(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function p$e(t){return d$e(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function f$e(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function m$e(t){return!!f$e(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const g$e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),y$e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function _$e(t){return t.layerContainerType==="basemap"?g$e:t.layerContainerType==="operational-layers"?y$e:null}function v$e(t,e){if(e.restrictedWebMapWriting){const r=_$e(e);return r==null||r.has(t.type)&&!nq(t)}return!0}function b$e(t,e){if(e)if(nq(t)){const r=rR("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&tQ(t,i)}else t.type!=="group"&&tQ(t,e)}function tQ(t,e){"maxScale"in t&&(e.maxScale=_D(t.maxScale)??void 0),"minScale"in t&&(e.minScale=_D(t.minScale)??void 0)}function w$e(t,e){if(b$e(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=_D(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(nq(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function rQ(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new U("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(v$e(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&w$e(t,e=Q(e)),e}var mI;let x$e=0;const Tde="esri.Basemap";let Ou=mI=class extends MS(Tg){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+x$e++,this.baseLayers=new Mt,this.referenceLayers=new Mt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&J.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{J.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const e=this.referenceLayers.removeAll();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Eb(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=rQ(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=rQ(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);n!=null&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",Eb(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Dhe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>sD(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>sD(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new mI({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=Q(r);return i.url&&Pf(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&Pf(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;Jt(t);const i=[];if(e){const s=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const n=e.data.id;i.push(u$e(n).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=S$e[(i==null?void 0:i.origin)||""]??"web-map",{populateOperationalLayers:o}=await ae(()=>import("./layersCreator-6701be42.js"),["assets/layersCreator-6701be42.js","assets/lazyLayerLoader-d318df46.js","assets/portalLayers-50e69e42.js","assets/layersLoader-5c715f8c.js","assets/fetchService-ba68ee1b.js","assets/jsonContext-dbedaf34.js"]),a=[];if(Jt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const p=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(p)}await Gf(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),s=go(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:T$e[t.type||""]??"web-map",portal:t.portal||jn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||jn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=FV[t];if(!e)return null;if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),vD(J.getLogger(Tde),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return mI.fromJSON(e)}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Mt}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Ou.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Ou.prototype,"id",void 0),u([d({type:ob})],Ou.prototype,"portalItem",void 0),u([d()],Ou.prototype,"referenceLayers",null),u([d({readOnly:!0})],Ou.prototype,"resourceInfo",void 0),u([d({type:Ge})],Ou.prototype,"spatialReference",void 0),u([d()],Ou.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Ou.prototype,"title",void 0),u([De("title")],Ou.prototype,"writeTitle",null),Ou=mI=u([R(Tde)],Ou);const T$e={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},S$e={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},AD=Ou,E$e=Object.freeze(Object.defineProperty({__proto__:null,default:AD},Symbol.toStringTag,{value:"Module"})),OD={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Sde(t){return!!OD[t]||!!OD[t.toLowerCase()]}function oq(t){return OD[t]??OD[t.toLowerCase()]}function C$e(t){return[...oq(t)]}function w6(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function Ede(t,e,r,i=1){const s=(t%360+360)%360/360,n=r<=.5?r*(e+1):r+e-r*e,o=2*r-n;return[Math.round(255*w6(o,n,s+1/3)),Math.round(255*w6(o,n,s)),Math.round(255*w6(o,n,s-1/3)),i]}function A$e(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function C(){return[0,0,0]}function Ms(t){return[t[0],t[1],t[2]]}function Ae(t,e,r){return[t,e,r]}function Ia(t){const e=C(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function aq(t,e){return new Float64Array(t,e,3)}function Cde(){return C()}function Ade(){return Ae(1,1,1)}function Ode(){return Ae(1,0,0)}function Rde(){return Ae(0,1,0)}function lq(){return Ae(0,0,1)}const za=Cde(),sg=Ade(),Pde=Ode(),Mde=Rde(),cq=lq();Object.freeze(Object.defineProperty({__proto__:null,ONES:sg,UNIT_X:Pde,UNIT_Y:Mde,UNIT_Z:cq,ZEROS:za,clone:Ms,create:C,createView:aq,fromArray:Ia,fromValues:Ae,ones:Ade,unitX:Ode,unitY:Rde,unitZ:lq,zeros:Cde},Symbol.toStringTag,{value:"Module"}));let uq=1e-6;function Wa(){return uq}function O$e(t){uq=t}const oR=Math.random,R$e=Math.PI/180,P$e=180/Math.PI;function X4(t){return t*R$e}function M$e(t){return t*P$e}function $$e(t,e){return Math.abs(t-e)<=uq*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:oR,equals:$$e,getEpsilon:Wa,setEpsilon:O$e,toDegree:M$e,toRadian:X4},Symbol.toStringTag,{value:"Module"}));function Ee(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function re(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function le(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function he(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Z4(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function RD(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function I$e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function $de(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function PD(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function Ide(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function hq(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function L$e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function D$e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ie(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function X1(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function fi(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}function ho(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function ea(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function na(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function N$e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ge(t,e){const r=e[0],i=e[1],s=e[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function me(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ot(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];return t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o,t}function Br(t,e,r,i){const s=e[0],n=e[1],o=e[2];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t}function F$e(t,e,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return t[0]=e[0]*a+r[0]*l+i[0]*c+s[0]*h,t[1]=e[1]*a+r[1]*l+i[1]*c+s[1]*h,t[2]=e[2]*a+r[2]*l+i[2]*c+s[2]*h,t}function U$e(t,e,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return t[0]=e[0]*c+r[0]*h+i[0]*p+s[0]*f,t[1]=e[1]*c+r[1]*h+i[1]*p+s[1]*f,t[2]=e[2]*c+r[2]*h+i[2]*p+s[2]*f,t}function V$e(t,e){e=e||1;const r=oR,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=s*e,t}function $e(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12],t[1]=r[1]*i+r[5]*s+r[9]*n+r[13],t[2]=r[2]*i+r[6]*s+r[10]*n+r[14],t}function ac(t,e,r){const i=e[0],s=e[1],n=e[2];return t[0]=i*r[0]+s*r[3]+n*r[6],t[1]=i*r[1]+s*r[4]+n*r[7],t[2]=i*r[2]+s*r[5]+n*r[8],t}function pc(t,e,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let h=s*c-n*l,p=n*a-i*c,f=i*l-s*a,m=s*f-n*p,y=n*h-i*f,_=i*p-s*h;const v=2*o;return h*=v,p*=v,f*=v,m*=2,y*=2,_*=2,t[0]=a+h+m,t[1]=l+p+y,t[2]=c+f+_,t}function z$e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function k$e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function B$e(t,e,r,i){const s=[],n=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t}function Lde(t,e){re(uP,t),re(hP,e),ge(uP,uP),ge(hP,hP);const r=me(uP,hP);return r>1?0:r<-1?Math.PI:Math.acos(r)}const uP=C(),hP=C();function G$e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ia(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function l_(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=Wa();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Ng(t,e,r){const i=r[0]-e[0],s=r[1]-e[1],n=r[2]-e[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const _n=he,j$e=Z4,H$e=RD,aR=fi,Y4=ho,Zl=Ee,UV=ea,iQ=Object.freeze(Object.defineProperty({__proto__:null,abs:PD,add:le,angle:Lde,bezier:U$e,ceil:I$e,copy:re,cross:ot,direction:Ng,dist:aR,distance:fi,div:H$e,divide:RD,dot:me,equals:l_,exactEquals:ia,floor:$de,hermite:F$e,inverse:N$e,len:Zl,length:Ee,lerp:Br,max:L$e,min:hq,mul:j$e,multiply:Z4,negate:na,normalize:ge,random:V$e,rotateX:z$e,rotateY:k$e,rotateZ:B$e,round:D$e,scale:ie,scaleAndAdd:X1,set:se,sign:Ide,sqrDist:Y4,sqrLen:UV,squaredDistance:ho,squaredLength:ea,str:G$e,sub:_n,subtract:he,transformMat3:ac,transformMat4:$e,transformQuat:pc},Symbol.toStringTag,{value:"Module"}));function oh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function bi(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function dq(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Dde(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Nde(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Fde(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function q$e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function W$e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function X$e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Z$e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Y$e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function $b(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function J$e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function Ude(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function MD(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+s*s+n*n}function pq(t){const e=t[0],r=t[1],i=t[2],s=t[3];return Math.sqrt(e*e+r*r+i*i+s*s)}function fq(t){const e=t[0],r=t[1],i=t[2],s=t[3];return e*e+r*r+i*i+s*s}function Q$e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function K$e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Vde(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=s*o,t[3]=n*o),t}function zde(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function J4(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function eIe(t,e){const r=oR;let i,s,n,o,a,l;e=e||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function Qc(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3];return t[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,t[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,t[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,t[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,t}function tIe(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*n-l*s,p=c*s+l*i-o*n,f=c*n+o*s-a*i,m=-o*i-a*s-l*n;return t[0]=h*c+m*-o+p*-l-f*-a,t[1]=p*c+m*-a+f*-o-h*-l,t[2]=f*c+m*-l+h*-a-p*-o,t[3]=e[3],t}function rIe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function i2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function $D(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Wa();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const iIe=Dde,sIe=Nde,nIe=Fde,oIe=Ude,aIe=MD,lIe=pq,cIe=fq,kde=Object.freeze(Object.defineProperty({__proto__:null,add:dq,ceil:q$e,copy:oh,dist:oIe,distance:Ude,div:nIe,divide:Fde,dot:zde,equals:$D,exactEquals:i2,floor:W$e,inverse:K$e,len:lIe,length:pq,lerp:J4,max:Z$e,min:X$e,mul:sIe,multiply:Nde,negate:Q$e,normalize:Vde,random:eIe,round:Y$e,scale:$b,scaleAndAdd:J$e,set:bi,sqrDist:aIe,sqrLen:cIe,squaredDistance:MD,squaredLength:fq,str:rIe,sub:iIe,subtract:Dde,transformMat4:Qc,transformQuat:tIe},Symbol.toStringTag,{value:"Module"})),sQ=new Float32Array(1);function uIe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function ye(t,e,r){return Math.min(Math.max(t,e),r)}function Ib(t){return(t&t-1)==0}function kxt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Bxt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function xt(t,e,r){return t+(e-t)*r}function Ft(t){return t*Math.PI/180}function ja(t){return 180*t/Math.PI}function VV(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function xn(t){return Math.acos(ye(t,-1,1))}function mh(t){return Math.asin(ye(t,-1,1))}function s2(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const ID=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function zV(t){return ID.setFloat64(0,t),ID.getBigInt64(0)}function hIe(t){return ID.setBigInt64(0,t),ID.getFloat64(0)}const gI=BigInt("1000000"),dIe=Bde(1);function Bde(t){const e=zV(t=Math.abs(t)),r=hIe(e<=gI?gI:e-gI);return Math.abs(t-r)}function Gxt(t,e,r=dIe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&Bde(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=zV(t),s=zV(e);return i<0!=s<0?!1:!((i<s?s-i:i-s)>gI)}function pIe(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function fIe(t){return Gde(Math.max(-kV,Math.min(t,kV)))}function Gde(t){return sQ[0]=t,sQ[0]}function nO(t,e,r){const i=ye((r-t)/(e-t),0,1);return i*i*(3-2*i)}function nQ(t,e){const r=Ee(t),i=mh(t[2]/r),s=Math.atan2(t[1]/r,t[0]/r);return se(e,r,i,s),e}function jxt(t,e,r){return bi(t,e[0],e[1],e[2],e[3]*r)}function Hxt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(s2(e,1)&&s2(r,1)&&s2(i,1))}const kV=Gde(34028234663852886e22);function dP(t){return ye(OH(t),0,255)}function pP(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let yI=class qo{static blendColors(e,r,i,s=new qo){return s.r=Math.round(e.r+(r.r-e.r)*i),s.g=Math.round(e.g+(r.g-e.g)*i),s.b=Math.round(e.b+(r.b-e.b)*i),s.a=e.a+(r.a-e.a)*i,s._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),qo.fromArray(a,r)}return qo.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return qo.fromArray(Ede(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(e,r=new qo){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,s=(1<<i)-1;let n=+("0x"+e.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new qo){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=Sde(e)?oq(e):null;return i&&qo.fromArray(i,r)||qo.fromRgb(e,r)||qo.fromHex(e,r)}static fromJSON(e){return e&&new qo([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?qo.fromString(e,this):Array.isArray(e)?qo.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof qo||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=qo.AlphaMode.ALWAYS){const r=dP(this.r),i=dP(this.g),s=dP(this.b);return e===qo.AlphaMode.ALWAYS||this.a!==1?[r,i,s,dP(255*this.a)]:[r,i,s]}clone(){return new qo(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(pP(this.r,0,255)),this.g=Math.round(pP(this.g,0,255)),this.b=Math.round(pP(this.b,0,255)),this.a=pP(this.a,0,1),this}_set(e,r,i,s){this.r=e,this.g=r,this.b=i,this.a=s}};yI.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(yI||(yI={}));const ke=yI;function qxt(t){}function mIe(t){return()=>t}function et(t,e={}){const r=t instanceof Or?t:new Or(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),d(i)}var BV;let _I=BV=class extends de{constructor(t){super(t),this.type="none"}clone(){return new BV({type:this.type})}};u([et({none:"none",stayAbove:"stay-above"})],_I.prototype,"type",void 0),_I=BV=u([R("esri.ground.NavigationConstraint")],_I);function Q4(t){const e=OH(100*(1-t));return Math.max(0,Math.min(e,100))}function N2(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var GV;let Tm=GV=class extends MS(Tg){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Mt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&J.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{gs(t)||J.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Eb(t,this._get("layers")))}writeLayers(t,e,r,i){const s=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};mIe(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new U("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Dhe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await ae(()=>import("./ElevationQuery-57c53929.js"),[]);Jt(e);const i=new r,s=this.layers.filter(oQ).toArray();return i.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await ae(()=>import("./ElevationQuery-57c53929.js"),[]);Jt(e);const i=new r,s=this.layers.filter(oQ).toArray();return i.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:Q(this.surfaceColor),navigationConstraint:Q(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new GV({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return ae(()=>import("./layersCreator-6701be42.js"),["assets/layersCreator-6701be42.js","assets/lazyLayerLoader-d318df46.js","assets/portalLayers-50e69e42.js","assets/layersLoader-5c715f8c.js","assets/fetchService-ba68ee1b.js","assets/jsonContext-dbedaf34.js"]).then(({populateOperationalLayers:o})=>{Jt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return Gf(a)}).then(()=>{})}};function gIe(t){return t&&"createElevationSampler"in t}function oQ(t){return t.type==="elevation"||gIe(t)}u([d({json:{read:!1}})],Tm.prototype,"layers",null),u([De("layers")],Tm.prototype,"writeLayers",null),u([d({readOnly:!0})],Tm.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Yi,read:{reader:N2,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Q4(t)},target:"transparency"}}})],Tm.prototype,"opacity",void 0),u([d({type:ke,json:{type:[Yi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Tm.prototype,"surfaceColor",void 0),u([d({type:_I,json:{write:!0}})],Tm.prototype,"navigationConstraint",void 0),Tm=GV=u([R("esri.Ground")],Tm);const LD=Tm;let Fx=class extends Mt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(she(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new Mt(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(s=>!!s);for(const s of r)if(s){if(i(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};u([d()],Fx.prototype,"getCollections",void 0),u([d()],Fx.prototype,"getChildrenFunction",void 0),u([d()],Fx.prototype,"itemFilterFunction",void 0),Fx=u([R("esri.core.CollectionFlattener")],Fx);const oO=Fx,yIe=[["binary","application/octet-stream","bin",""]];function _Ie(t,e){return gq(wIe(t,e))}function vIe(t,e){return gq(xIe(t,e))}function Xxt(t,e){return jde(bIe(t,e))}function mq(t){return[...yIe,...t]}function bIe(t,e){return mq(e).find(r=>gq(r)===t)}function wIe(t,e){return mq(e).find(r=>jde(r)===t)}function xIe(t,e){const r=t.toLowerCase();return mq(e).find(i=>TIe(i).some(s=>r.endsWith(s)))}function gq(t){return t==null?void 0:t[0]}function jde(t){return t==null?void 0:t[1]}function TIe(t){return(t==null?void 0:t[2].split(","))??[]}function Zxt(t){var e;return(e=t.tables)==null?void 0:e.find(r=>r.role==="assetMaps")}function SIe(t){var e,r;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((r=(e=p$e(t))==null?void 0:e.operations)!=null&&r.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!m$e(t)||t.type==="scene"&&!EIe(t))}function EIe(t){const e=t.infoFor3D;if(!e)return!0;const{supportedFormats:r,queryFormats:i}=e,s=_Ie("model/gltf-binary",r)??vIe("glb",r);return s!=null&&i.includes(s)}const aQ=J.getLogger("esri.support.basemapUtils");function CIe(){return{}}function AIe(t){for(const e in t){const r=t[e];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete t[e]}}function OIe(t,e){let r;if(typeof t=="string"){if(!(t in FV)){const i=Object.entries(FV).filter(([s,n])=>Zr.apiKey&&!n.classic||!Zr.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return aQ.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=AD.fromId(t),e&&(e[t]=r))}else r=Hs(AD,t);return r!=null&&r.destroyed&&(aQ.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function Yxt(t,e){var r,i,s,n;return((i=(r=t.basemap)==null?void 0:r.referenceLayers)==null?void 0:i.some(o=>o.uid===e))||((n=(s=t.basemap)==null?void 0:s.baseLayers)==null?void 0:n.some(o=>o.uid===e))}function RIe(t){return new oO({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function x6(t){for(const e of t.values())e==null||e.destroy();t.clear()}const lQ={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function PIe(t){let e=null;if(typeof t=="string")if(t in lQ){const r=lQ[t];e=new LD({resourceInfo:{data:{layers:[r]}}})}else J.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Hs(LD,t);return e}function F2(t,e,r=!1){let{hasM:i,hasZ:s}=t;Array.isArray(e)?e.length!==4||i||s?e.length===3&&r&&!i?(s=!0,i=!1):e.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=i}var jV;function cQ(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function MIe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let zy=jV=class extends M_{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):MIe(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new yr,r=this.hasZ,i=this.hasM,s=r?3:2,n=t[0],o=cQ(Math.min),a=cQ(Math.max);let l,c,h,p,[f,m]=n,[y,_]=n;for(let v=0,w=t.length;v<w;v++){const T=t[v],[x,S]=T;if(f=o(f,x),m=o(m,S),y=a(y,x),_=a(_,S),r&&T.length>2){const O=T[2];l=o(l,O),h=a(h,O)}if(i&&T.length>s){const O=T[s];c=o(c,O),p=a(p,O)}}return e.xmin=f,e.ymin=m,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=h):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=Q(this.points)}addPoint(t){return F2(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:Q(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new jV(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new pt(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new pt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(F2(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};u([d({readOnly:!0})],zy.prototype,"cache",null),u([d()],zy.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],zy.prototype,"points",void 0),u([De("points")],zy.prototype,"writePoints",null),zy=jV=u([R("esri.geometry.Multipoint")],zy),zy.prototype.toJSON.isDefaultToJSON=!0;const lR=zy;function Jxt(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function $Ie(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function K4(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function Hde(t,e,r){const i=t[0]+r*(e[0]-t[0]),s=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,s,t[2]+r*(e[2]-t[2])]:[i,s]}function Qxt(t,e,r,i){const[s,n]=e,[o,a]=r[i],[l,c]=r[i+1],h=l-o,p=c-a,f=h*h+p*p,m=(s-o)*h+(n-a)*p,y=Math.min(1,Math.max(0,m/f));return t[0]=o+h*y,t[1]=a+p*y,t}function Kxt(t,e,r){let i,s,n,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,s=r.y;r.nextPoint();)n=r.x,o=r.y,s>e!=o>e&&t<(n-i)*(e-s)/(o-s)+i&&(a=!a),l=Math.min(l,IIe(t,e,i,s,n,o)),i=n,s=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function IIe(t,e,r,i,s,n){let o=r,a=i,l=s-o,c=n-a;if(l!==0||c!==0){const h=((t-o)*l+(e-a)*c)/(l*l+c*c);h>1?(o=s,a=n):h>0&&(o+=l*h,a+=c*h)}return l=t-o,c=e-a,l*l+c*c}function qde(t,e){return Hde(t,e,.5)}function Wde(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=K4(t[i],t[i+1]);return r}function Xde(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let s=0;s<r-1;++s){const n=K4(t[s],t[s+1]);if(e-i<n){const o=(e-i)/n;return Hde(t[s],t[s+1],o)}i+=n}return t[r-1]}function Zde(t,e,r){const i=t.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&e&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function LIe(t){const e=t.length;return e>2&&wg(t[0],t[e-1])}function eTt(t){if("rings"in t)for(const e of t.rings)LIe(e)||e.push(e[0].slice())}function tTt(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function Yde(t){if(!t||t.numPoints<3)return 0;let e,r,i=0;if(t.seekPathStart(),!t.nextPoint())return 0;e=t.x,r=t.y;const s=e,n=r;for(;t.nextPoint();)i+=(e-t.x)*(r+t.y),e=t.x,r=t.y;return i+=(e-s)*(r+n),-.5*i}function rTt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function DIe(t){return t?Jde(t.rings,t.hasZ??!1):null}function Jde(t,e){if(!t||!t.length)return null;const r=[],i=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=Qde(t[n],e,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=t[0]&&t[0].length?NIe(t[0],e):null;if(!n)return null;r[0]=n[0],r[1]=n[1],e&&n.length>2&&(r[2]=n[2])}return r}function Qde(t,e,r){let i=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,h=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],y=t[(f+1)%t.length],[_,v,w]=m,T=_-l,x=v-c,[S,O,A]=y,P=S-l,I=O-c,V=T*I-P*x;if(o+=V,i+=(T+P)*V,s+=(x+I)*V,e&&m.length>2&&y.length>2){const k=w-h,B=A-h,z=T*B-P*k;n+=(k+B)*z,a+=z}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(w<r[4]&&(r[4]=w),w>r[5]&&(r[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[i/(6*o)+l,s/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(p[3]=(r[4]+r[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function NIe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const h=t[l],p=t[l+1];if(h&&p){r[0]=h[0],r[1]=h[1],i[0]=p[0],i[1]=p[1],e&&h.length>2&&p.length>2&&(r[2]=h[2],i[2]=p[2]);const f=K4(r,i);if(f){s+=f;const m=qde(h,p);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function FIe(t){const{hasZ:e,numPaths:r}=t;if(r===0)return null;const i=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Qde($Ie(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(i[0]=s[0][0],i[1]=s[0][1],e&&(i[2]=s[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.numPoints?UIe(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function UIe(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,h=t.z;for(;t.nextPoint();){const p=t.x,f=t.y,m=t.z;r[0]=l,r[1]=c,i[0]=p,i[1]=f,e&&(r[2]=h,i[2]=m);const y=K4(r,i);if(y){s+=y;const _=qde(r,i);n+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=p,c=f,h=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.numPoints?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const VIe=1e-6;function iTt(t){let e=0;for(t.reset();t.nextPath();)e+=Yde(t);if(e<VIe){const s=FIe(t);return s?[s[0],s[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)kIe(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const zIe=1/3;function kIe(t,e,r){if(!t||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,s=r.y;r.nextPoint();let n,o=r.x-i,a=r.y-s,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-s,n=.5*zIe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const h=Yde(r),p=[i,s];return p[0]-=e[0],p[1]-=e[1],p[0]*=h,p[1]*=h,t[0]+=p[0],t[1]+=p[1],t}function zt(t=HIe){return[t[0],t[1],t[2],t[3]]}function sTt(t){return[t[0],t[1],t[2],t[3]]}function Eg(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function yq(t,e,r,i,s=zt()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Kde(t,e=zt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function e5(t,e){return new yr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function n2(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function t_(t,e,r){if(e!=null)if("length"in e)WV(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else Eg(r,t)}function T6(t,e,r=t){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function HV(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function Yc(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Kd(t){return t[1]>=t[3]?0:t[3]-t[1]}function epe(t){return Yc(t)*Kd(t)}function _q(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function tpe(t,e){return t5(t,e[0],e[1])}function uQ(t,e){const r=e[3],i=.5*(t[0]+t[2]),s=Math.abs(e[0]-i),n=.5*(t[2]-t[0]);if(s>r+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=r*r}function nTt(t,e,r){const i=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:h}=r,p=(v,w)=>(h-l)*v+(a-c)*w+(c*l-a*h)<0,f=p(i,o),m=p(n,o),y=p(n,s),_=p(i,s);return!(f===m&&m===y&&y===_&&_===f||a<i&&c<i||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function oTt(t,e){return t5(t,e.x,e.y)}function t5(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function BIe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function cR(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function hQ(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function qV(t,e,r){if(e==null)return Eg(r,t);const i=e[0],s=e[1],n=e[2],o=e[3];return r[0]=ye(t[0],i,n),r[1]=ye(t[1],s,o),r[2]=ye(t[2],i,n),r[3]=ye(t[3],s,o),r}function GIe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-r)-Yc(t)/2,0),n=Math.max(Math.abs(e[1]-i)-Kd(t)/2,0);return Math.sqrt(s*s+n*n)}function DD(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function yc(t){return t?Eg(t,XV):zt(XV)}function WV(t){return t!=null&&t.length===4}function jIe(t){return!(Yc(t)!==0&&isFinite(t[0])||Kd(t)!==0&&isFinite(t[1]))}function ab(t,e){return WV(t)&&WV(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const aTt=[-1/0,-1/0,1/0,1/0],XV=[1/0,1/0,-1/0,-1/0],HIe=[0,0,0,0];function rpe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function ipe(t){return t.points!==void 0}function spe(t){return t.x!==void 0&&t.y!==void 0}function npe(t){return t.paths!==void 0}function ope(t){return t.rings!==void 0}function ape(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const U0=ape(Math.min),V0=ape(Math.max);function lTt(t,e){return npe(e)?U2(t,e.paths,!1,!1):ope(e)?U2(t,e.rings,!1,!1):ipe(e)?vq(t,e.points,!1,!1,!1,!1):rpe(e)?lpe(t,e):(spe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function cTt(t){let e,r,i,s;for(t.reset(),e=i=1/0,r=s=-1/0;t.nextPath();){const n=qIe(t);e=Math.min(n[0],e),i=Math.min(n[1],i),r=Math.max(n[2],r),s=Math.max(n[3],s)}return zt([e,i,r,s])}function qIe(t){let e,r,i,s;for(e=i=1/0,r=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),s=Math.max(t.y,s);return zt([e,i,r,s])}function uTt(t,e){return npe(e)?U2(t,e.paths,!0,!1):ope(e)?U2(t,e.rings,!0,!1):ipe(e)?vq(t,e.points,!0,!1,!0,!1):rpe(e)?lpe(t,e,!0,!1,!0,!1):(spe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function U2(t,e,r,i){const s=r?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,h]=e[0][0],[p,f]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let _=0;_<y.length;_++){const v=y[_],[w,T]=v;if(c=U0(c,w),h=U0(h,T),p=V0(p,w),f=V0(f,T),r&&v.length>2){const x=v[2];n=U0(n,x),o=V0(o,x)}if(i&&v.length>s){const x=v[s];a=U0(n,x),l=V0(o,x)}}}return r?i?(t[0]=c,t[1]=h,t[2]=n,t[3]=a,t[4]=p,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=h,t[2]=n,t[3]=p,t[4]=f,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=h,t[2]=a,t[3]=p,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=h,t[2]=p,t[3]=f,t.length=4,t)}function lpe(t,e,r,i,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let h=e.zmin,p=e.zmax,f=e.mmin,m=e.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=h,t[3]=f,t[4]=a,t[5]=c,t[6]=p,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=h,t[3]=a,t[4]=c,t[5]=p,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function vq(t,e,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!e.length||!e[0].length)return null;let c,h,p,f,[m,y]=e[0],[_,v]=e[0];for(let w=0;w<e.length;w++){const T=e[w],[x,S]=T;if(m=U0(m,x),y=U0(y,S),_=V0(_,x),v=V0(v,S),l&&T.length>2){const O=T[2];c=U0(c,O),h=V0(h,O)}if(a&&T.length>o){const O=T[o];p=U0(c,O),f=V0(h,O)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,t[0]=m,t[1]=y,t[2]=c,t[3]=p,t[4]=_,t[5]=v,t[6]=h,t[7]=f,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=h,t)):n?(p=p||0,f=f||0,t[0]=m,t[1]=y,t[2]=p,t[3]=_,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=y,t[2]=_,t[3]=v,t)}function WIe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function XIe(t){return t.points!==void 0}function ZIe(t){return t.x!==void 0&&t.y!==void 0}function YIe(t){return t.paths!==void 0}function JIe(t){return t.rings!==void 0}const bq=[];function cpe(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function upe(t,e,r,i,s,n){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:s,zmax:n}}function hpe(t,e,r,i,s,n){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:s,mmax:n}}function dpe(t,e,r,i,s,n,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function wq(t,e=!1,r=!1){return e?r?dpe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):upe(t[0],t[1],t[2],t[3],t[4],t[5]):r?hpe(t[0],t[1],t[2],t[3],t[4],t[5]):cpe(t[0],t[1],t[2],t[3])}function hTt(t){return t?WIe(t)?t:ZIe(t)?KIe(t):JIe(t)?ppe(t):YIe(t)?fpe(t):XIe(t)?QIe(t):null:null}function QIe(t){const{hasZ:e,hasM:r,points:i}=t;return wq(vq(bq,i,e??!1,r??!1),e,r)}function KIe(t){const{x:e,y:r,z:i,m:s}=t,n=s!=null;return i!=null?n?dpe(e,r,i,s,e,r,i,s):upe(e,r,i,e,r,i):n?hpe(e,r,s,e,r,s):cpe(e,r,e,r)}function ppe(t){const{hasZ:e,hasM:r,rings:i}=t,s=U2(bq,i,e??!1,r??!1);return s?wq(s,e,r):null}function fpe(t){const{hasZ:e,hasM:r,paths:i}=t,s=U2(bq,i,e??!1,r??!1);return s?wq(s,e,r):null}var vI;function dQ(t){return!Array.isArray(t[0])}let Lp=vI=class extends M_{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,s=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new vI(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||Ge.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=DIe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new pt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=ppe(this);if(!e)return null;const r=new yr(e);return r.spatialReference=t,r}get isSelfIntersecting(){return BMe(this.rings)}writeRings(t,e){e.rings=Q(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(dQ(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new vI;return t.spatialReference=this.spatialReference,t.rings=Q(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!wg(n,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=ow(t,this.spatialReference);return $Me(this,e??t)}isClockwise(t){let e;return e=dQ(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,Zde(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new pt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new pt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new pt(r[0],r[1],r[2],r[3],this.spatialReference):new pt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(F2(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new pt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new pt(s,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(F2(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],Lp.prototype,"cache",null),u([d({readOnly:!0})],Lp.prototype,"centroid",null),u([d({readOnly:!0})],Lp.prototype,"extent",null),u([d({readOnly:!0})],Lp.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Lp.prototype,"rings",void 0),u([De("rings")],Lp.prototype,"writeRings",null),Lp=vI=u([R("esri.geometry.Polygon")],Lp),Lp.prototype.toJSON.isDefaultToJSON=!0;const Hd=Lp;var ZV;function eLe(t){return!Array.isArray(t[0])}let ky=ZV=class extends M_{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):s=t,s=s||[],e=e||Ge.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=fpe(this);if(!e)return null;const r=new yr(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=Q(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(eLe(t)){const i=[];for(let s=0,n=t.length;s<n;s++)i[s]=t[s].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new ZV;return t.spatialReference=this.spatialReference,t.paths=Q(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,s=this.hasM;return i&&!s?new pt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new pt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new pt(r[0],r[1],r[2],r[3],this.spatialReference):new pt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(F2(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(s=>new pt(s,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new pt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(F2(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};u([d({readOnly:!0})],ky.prototype,"cache",null),u([d({readOnly:!0})],ky.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],ky.prototype,"paths",void 0),u([De("paths")],ky.prototype,"writePaths",null),ky=ZV=u([R("esri.geometry.Polyline")],ky),ky.prototype.toJSON.isDefaultToJSON=!0;const r5=ky,mpe=Ha()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),pQ=Ha()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function gpe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function xq(t){return t.points!==void 0}function Tq(t){return t.x!==void 0&&t.y!==void 0}function Sq(t){return t.paths!==void 0}function o2(t){return t.rings!==void 0}function c_(t){return t==null?null:t instanceof M_?t:Tq(t)?pt.fromJSON(t):Sq(t)?r5.fromJSON(t):o2(t)?Hd.fromJSON(t):xq(t)?lR.fromJSON(t):gpe(t)?yr.fromJSON(t):null}function Eq(t){return t?Tq(t)?"esriGeometryPoint":Sq(t)?"esriGeometryPolyline":o2(t)?"esriGeometryPolygon":gpe(t)?"esriGeometryEnvelope":xq(t)?"esriGeometryMultipoint":null:null}const tLe={esriGeometryPoint:pt,esriGeometryPolyline:r5,esriGeometryPolygon:Hd,esriGeometryEnvelope:yr,esriGeometryMultipoint:lR};function rLe(t){return t&&tLe[t]||null}const aw={base:M_,key:"type",typeMap:{extent:yr,multipoint:lR,point:pt,polyline:r5,polygon:Hd}};Qd(aw);let ype=0;const Cq=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+ype++})}};return e=u([R("esri.core.Identifiable")],e),e},dTt=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:ype++})}};return e=u([R("esri.core.NumericIdentifiable")],e),e};let fQ=class extends Cq(class{}){};fQ=u([R("esri.core.Identifiable")],fQ);async function iLe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await ae(()=>import("./portalLayers-50e69e42.js"),["assets/portalLayers-50e69e42.js","assets/lazyLayerLoader-d318df46.js","assets/layersLoader-5c715f8c.js","assets/fetchService-ba68ee1b.js","assets/jsonContext-dbedaf34.js"]);try{return await r(e)}catch(i){const s=e&&e.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Zr.portalUrl;throw J.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let sLe=0,eo=class extends Is.EventedMixin(Cq(Tg)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new yr(-180,-90,180,90,Ge.WGS84),this.id=Date.now().toString(16)+"-layer-"+sLe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ge.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await ae(()=>import("./arcgisLayers-869c2db6.js"),["assets/arcgisLayers-869c2db6.js","assets/fetchService-ba68ee1b.js","assets/lazyLayerLoader-d318df46.js"])).fromUrl(r)}static fromPortalItem(e){return iLe(e)}initialize(){this.when().catch(e=>{gs(e)||J.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return go(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Nr(e,{query:{f:"json"},responseType:"json"})).data;throw new U("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],eo.prototype,"attributionDataUrl",void 0),u([d({type:yr})],eo.prototype,"fullExtent",void 0),u([d({readOnly:!0})],eo.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],eo.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],eo.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],eo.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],eo.prototype,"opacity",void 0),u([d({clonable:!1})],eo.prototype,"parent",void 0),u([d({readOnly:!0})],eo.prototype,"parsedUrl",null),u([d({type:Boolean})],eo.prototype,"popupEnabled",void 0),u([d({type:Boolean})],eo.prototype,"attributionVisible",void 0),u([d({type:Ge})],eo.prototype,"spatialReference",void 0),u([d({type:String})],eo.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],eo.prototype,"type",void 0),u([d()],eo.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],eo.prototype,"visible",void 0),eo=u([R("esri.layers.Layer")],eo);const Aq=eo;function YV(t,e,r){let i,s;if(t)for(let n=0,o=t.length;n<o;n++){if(i=t.at(n),(i==null?void 0:i[e])===r)return i;if((i==null?void 0:i.type)==="group"&&(s=YV(i.layers,e,r),s))return s}}const nLe=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new Mt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||J.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",Eb(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof Aq){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else pu(r)?r.then(n=>{this.destroyed||this.add(n,i)}):J.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return YV(this.layers,"id",r)}findLayerByUid(r){return YV(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([d()],e.prototype,"layers",null),e=u([R("esri.support.LayersMixin")],e),e};function JV(t,e,r){if(t)for(let i=0,s=t.length;i<s;i++){const n=t.at(i);if(n[e]===r)return n;if((n==null?void 0:n.type)==="group"){const o=JV(n.tables,e,r);if(o)return o}}}const oLe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new Mt,this.addHandles([this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&J.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",Eb(r,this._get("tables")))}findTableById(r){return JV(this.tables,"id",r)}findTableByUid(r){return JV(this.tables,"uid",r)}};return u([d()],e.prototype,"tables",null),e=u([R("esri.support.TablesMixin")],e),e};let Dp=class extends oLe(nLe(Is.EventedMixin(xe))){constructor(e){super(e),this.allLayers=new oO({getCollections:()=>{var r,i,s;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=RIe(this),this.basemap=null,this.editableLayers=new oO({getCollections:()=>[this.allLayers],itemFilterFunction:SIe}),this.ground=new LD,this._basemapCache=CIe()}destroy(){var e,r;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(r=this.basemap)==null||r.destroy(),AIe(this._basemapCache),this._basemapCache=null}castBasemap(e){return OIe(e,this._basemapCache)}castGround(e){return PIe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Dp.prototype,"allLayers",void 0),u([d({readOnly:!0})],Dp.prototype,"allTables",void 0),u([d({type:AD})],Dp.prototype,"basemap",void 0),u([gr("basemap")],Dp.prototype,"castBasemap",null),u([d({readOnly:!0})],Dp.prototype,"editableLayers",void 0),u([d({type:LD,nonNullable:!0})],Dp.prototype,"ground",void 0),u([gr("ground")],Dp.prototype,"castGround",null),Dp=u([R("esri.Map")],Dp);const _pe=Dp,Gi=t=>{let e=class extends t{clone(){var l;const r=Ql(oa(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const c in i){const h=i[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==ur.USER&&p!==ur.DEFAULTS&&p!==ur.WEB_MAP&&p!==ur.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:aV(m),m!=null&&y==null||(p===ur.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=oa(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,ur.DEFAULTS)}return a}};return e=u([R("esri.core.Clonable")],e),e};let mQ=class extends Gi(xe){};mQ=u([R("esri.core.Clonable")],mQ);let u_=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,s=0,n=!1){return(i-=s)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=e),i+s}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return ye(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,s=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(s)?i:s}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function Oq(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const aLe=Oq(new u_(0,2*Math.PI)),h_=Oq(new u_(-Math.PI,Math.PI)),Rq=Oq(new u_(0,360));let Sm=class extends Gi(de){constructor(...e){super(...e),this.position=new pt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return r!=null&&(n.heading=r),i!=null&&(n.tilt=i),s!=null&&(n.fov=s),n}return e}writePosition(e,r,i,s){const n=e.clone();n.x=Zu(e.x||0),n.y=Zu(e.y||0),n.z=e.hasZ?Zu(e.z||0):e.z,r[i]=n.write({},s)}readPosition(e,r){const i=new pt;return i.read(e,r),i.x=Zu(i.x||0),i.y=Zu(i.y||0),i.z=i.hasZ?Zu(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:pt,json:{write:{isRequired:!0}}})],Sm.prototype,"position",void 0),u([De("position")],Sm.prototype,"writePosition",null),u([Se("position")],Sm.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),gr(t=>Rq.normalize(Zu(t)))],Sm.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),gr(t=>ye(Zu(t),-180,180))],Sm.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Sm.prototype,"fov",void 0),Sm=u([R("esri.Camera")],Sm);const gh=Sm;var V2;function lLe(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return V2.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return V2.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(V2||(V2={}));const cLe=J.getLogger("esri.support.arcadeOnDemand");let S6;function d_(){return S6||(S6=(async()=>{const t=await ae(()=>import("./arcadeUtils-1f46f22e.js").then(e=>e.az),["assets/arcadeUtils-1f46f22e.js","assets/arcadeTimeUtils-5bca0f0f.js","assets/executionError-c92d3b85.js","assets/number-14ec09c6.js","assets/hash-6f442295.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),S6}const uLe=(t,e,r)=>Pq.create(t,e,r,null,["$feature"],[]),hLe=(t,e,r)=>Pq.create(t,e,r,null,["$feature","$view"],[]),dLe=(t,e,r,i)=>Pq.create(t,e,r,i,["$feature","$view"],[]);let Pq=class vpe{constructor(e,r,i,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await d_(),h=Ge.fromJSON(r);let p;try{p=a.parseScript(e,o)}catch(I){return cLe.error(new U("arcade-bad-expression","Failed to parse arcade script",{script:e,error:I})),null}const f=n.reduce((I,V)=>({...I,[V]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p),T=w&&a.enableAsyncSupport(),x={vars:f,spatialReference:h,useAsync:!!T};await Promise.all([_,v,T]);const S=new Set;await a.loadDependentModules(S,p,null,w,y);const O=new c;O.immutable=!1,O.setField("scale",0);const A=a.compileScript(p,x),P=(I,V)=>("$view"in I&&I.$view&&(O.setField("scale",typeof I.$view=="object"&&"scale"in I.$view?I.$view.scale:void 0),I.$view=O),m&&(I.$config=m),A({vars:I,spatialReference:h,services:V}));return new vpe(e,a,p,P,new l,i,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const pLe=/^([0-9_])/,fLe=/[^a-z0-9_\u0080-\uffff]+/gi;function mLe(t){return t==null?null:t.trim().replaceAll(fLe,"_").replace(pLe,"F$1")||null}const gLe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],yLe=["field","normalizationField"];function ND(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(gQ(gLe,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)gQ(yLe,i,e)}}function gQ(t,e,r){if(t)for(const i of t){const s=rR(i,e),n=s&&typeof s!="function"&&r.get(s);n&&Ga(i,n.name,e)}}function bpe(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),s=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const i=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const E6=new Set;function i5(t,e){return t&&e?(E6.clear(),aO(E6,t,e),Array.from(E6).sort()):[]}function aO(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of r)eu(t,e,s);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const s of r)s!=null&&t.add(s)}}function eu(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function _Le(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function Tl(t,e,r){var n;if(!r)return;const{arcadeUtils:i}=await d_(),s=i.extractFieldNames(r,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)eu(t,e,o)}async function wpe(t,e,r){if(r&&r!=="1=1"){const{WhereClause:i}=await ae(()=>import("./WhereClause-914ffa63.js").then(n=>n.W),["assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js"]),s=i.create(r,e);if(!s.isStandardized)throw new U("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});aO(t,e,s.fieldNames)}}function vLe({displayField:t,fields:e}){return t||(e&&e.length?C6(e,"name-or-title")||C6(e,"unique-identifier")||C6(e,"type-or-category")||bLe(e):null)}function bLe(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function C6(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function vTt(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function wLe(t,e,r){r.onStatisticExpression?Tl(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function bTt(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(xLe(t,e,s)),r.fields&&i.push(...r.fields.map(async n=>wLe(t,e.fieldsIndex,n))),await Promise.all(i)}async function xLe(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(n=>Tl(t,e.fieldsIndex,n.expression)));const s=r==null?void 0:r.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(Tl(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function wTt(t,e,r){e&&(e.timeInfo&&r!=null&&r.timeExtent&&aO(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&aO(t,e.fieldsIndex,[e.floorInfo.floorField]),r!=null&&r.where!=null&&await wpe(t,e.fieldsIndex,r.where))}async function xTt(t,e,r){e&&r&&await Promise.all(r.map(i=>TLe(t,e,i)))}async function TLe(t,e,r){e&&r&&(r.valueExpression?await Tl(t,e.fieldsIndex,r.valueExpression):r.field&&eu(t,e.fieldsIndex,r.field))}function SLe(t){return t?i5(t.fieldsIndex,xpe(t)):[]}function ELe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?i5(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const CLe=["oid","global-id","guid"],ALe=["oid","global-id"],OLe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function RLe(t){const e=new Set;Tpe(t).forEach(i=>e.add(i)),ELe(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function xpe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=e;return[r,i,s,n].filter(Boolean)}function Tpe(t){return xpe(t).map(e=>e.toLowerCase())}function PLe(t,e){var r;return t.editable&&!CLe.includes(t.type)&&!Tpe(e).includes(((r=t.name)==null?void 0:r.toLowerCase())??"")}function MLe(t,e){var i;const r=((i=t.name)==null?void 0:i.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&r===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&r===e.globalIdField.toLowerCase()||RLe(e).includes(r)||ALe.includes(t.type)||OLe.some(s=>s.test(r)))}async function TTt(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(s=>$Le(t,i,s)))}async function $Le(t,e,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await Tl(t,e,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{eu(t,e,o.slice(1,-1))})}await wpe(t,e,s)}function ILe(t){const e=t.defaultValue;return e!==void 0&&Cpe(t,e)?e:t.nullable?null:void 0}function Spe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function LLe(t){return t===null||Spe(t)}const Mq="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function DLe(t){return t===null||Mq(t)}function Epe(t){return t!=null&&typeof t=="string"}function NLe(t){return t===null||Epe(t)}function FLe(){return!0}function Cpe(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?DLe:Mq;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?LLe:Spe;break;case"string":case"esriFieldTypeString":r=t.nullable?NLe:Epe;break;default:r=FLe}return arguments.length===1?r:r(e)}const ULe=["integer","small-integer","single","double"],VLe=new Set([...ULe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),zLe=["date","date-only","time-only","timestamp-offset"],kLe=new Set([...zLe,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function $q(t){return t!=null&&VLe.has(t.type)}function STt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function ETt(t){return t!=null&&kLe.has(t.type)}var FD,UD;function CTt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function ATt(t,e){return t==null||t.nullable&&e===null?null:$q(t)&&!BLe(t.type,Number(e))?FD.OUT_OF_RANGE:Cpe(t,e)?t.domain?lLe(t.domain,e):null:UD.INVALID_TYPE}function BLe(t,e){const r=typeof t=="string"?Ape(t):t;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?Mq(e)&&e>=i&&e<=s:e>=i&&e<=s}function Ape(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return GLe;case"esriFieldTypeInteger":case"integer":return jLe;case"esriFieldTypeBigInteger":case"big-integer":return HLe;case"esriFieldTypeSingle":case"single":return qLe;case"esriFieldTypeDouble":case"double":return WLe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(FD||(FD={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(UD||(UD={}));const GLe={min:-32768,max:32767,isInteger:!0},jLe={min:-2147483648,max:2147483647,isInteger:!0},HLe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},qLe={min:-34e37,max:12e37,isInteger:!1},WLe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function OTt(t,e,r){switch(t){case V2.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case V2.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case UD.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case FD.OUT_OF_RANGE:{const{min:i,max:s}=Ape(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${s}`}}}function RTt(t,e){return!XLe(t,e,null)}function XLe(t,e,r){if(!e||!e.attributes||!t){if(r!=null)for(const n of t??[])r.add(n);return!0}const i=e.attributes;let s=!1;for(const n of t)if(!(n in i)){if(s=!0,r==null)break;r.add(n)}return s}function ZLe(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let bI=class extends de{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],bI.prototype,"type",void 0),bI=u([R("esri.popup.content.Content")],bI);const $_=bI;var QV;let Lv=QV=class extends $_{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new QV({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],Lv.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],Lv.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],Lv.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Lv.prototype,"type",void 0),Lv=QV=u([R("esri.popup.content.AttachmentsContent")],Lv);const lO=Lv;var KV;let Dv=KV=class extends $_{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new KV({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Q(this.outFields):null})}};u([d()],Dv.prototype,"creator",void 0),u([d()],Dv.prototype,"destroyer",void 0),u([d()],Dv.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],Dv.prototype,"type",void 0),Dv=KV=u([R("esri.popup.content.CustomContent")],Dv);const YLe=Dv;var ez;let Ux=ez=class extends de{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new ez({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],Ux.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],Ux.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Ux.prototype,"returnType",void 0),Ux=ez=u([R("esri.popup.ElementExpressionInfo")],Ux);const JLe=Ux;var tz;let TC=tz=class extends $_{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new tz({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};u([d({type:JLe,json:{write:!0}})],TC.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],TC.prototype,"type",void 0),TC=tz=u([R("esri.popup.content.ExpressionContent")],TC);const Iq=TC;class lw extends Error{}class QLe extends lw{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class KLe extends lw{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class eDe extends lw{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class SC extends lw{}class Ope extends lw{constructor(e){super(`Invalid unit ${e}`)}}class Yu extends lw{}class ay extends lw{constructor(){super("Zone is an abstract class")}}const qe="numeric",ep="short",tu="long",VD={year:qe,month:qe,day:qe},Rpe={year:qe,month:ep,day:qe},tDe={year:qe,month:ep,day:qe,weekday:ep},Ppe={year:qe,month:tu,day:qe},Mpe={year:qe,month:tu,day:qe,weekday:tu},$pe={hour:qe,minute:qe},Ipe={hour:qe,minute:qe,second:qe},Lpe={hour:qe,minute:qe,second:qe,timeZoneName:ep},Dpe={hour:qe,minute:qe,second:qe,timeZoneName:tu},Npe={hour:qe,minute:qe,hourCycle:"h23"},Fpe={hour:qe,minute:qe,second:qe,hourCycle:"h23"},Upe={hour:qe,minute:qe,second:qe,hourCycle:"h23",timeZoneName:ep},Vpe={hour:qe,minute:qe,second:qe,hourCycle:"h23",timeZoneName:tu},zpe={year:qe,month:qe,day:qe,hour:qe,minute:qe},kpe={year:qe,month:qe,day:qe,hour:qe,minute:qe,second:qe},Bpe={year:qe,month:ep,day:qe,hour:qe,minute:qe},Gpe={year:qe,month:ep,day:qe,hour:qe,minute:qe,second:qe},rDe={year:qe,month:ep,day:qe,weekday:ep,hour:qe,minute:qe},jpe={year:qe,month:tu,day:qe,hour:qe,minute:qe,timeZoneName:ep},Hpe={year:qe,month:tu,day:qe,hour:qe,minute:qe,second:qe,timeZoneName:ep},qpe={year:qe,month:tu,day:qe,weekday:tu,hour:qe,minute:qe,timeZoneName:tu},Wpe={year:qe,month:tu,day:qe,weekday:tu,hour:qe,minute:qe,second:qe,timeZoneName:tu};class uR{get type(){throw new ay}get name(){throw new ay}get ianaName(){return this.name}get isUniversal(){throw new ay}offsetName(e,r){throw new ay}formatOffset(e,r){throw new ay}offset(e){throw new ay}equals(e){throw new ay}get isValid(){throw new ay}}let A6=null;class s5 extends uR{static get instance(){return A6===null&&(A6=new s5),A6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return Zpe(e,r,i)}formatOffset(e,r){return oA(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let wI={};function iDe(t){return wI[t]||(wI[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),wI[t]}const sDe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function nDe(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,h]=i;return[o,s,n,a,l,c,h]}function oDe(t,e){const r=t.formatToParts(e),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=sDe[n];n==="era"?i[a]=o:ii(a)||(i[a]=parseInt(o,10))}return i}let fP={};class Cg extends uR{static create(e){return fP[e]||(fP[e]=new Cg(e)),fP[e]}static resetCache(){fP={},wI={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Cg.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return Zpe(e,r,i,this.name)}formatOffset(e,r){return oA(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=iDe(this.name);let[s,n,o,a,l,c,h]=i.formatToParts?oDe(i,r):nDe(i,r);a==="BC"&&(s=-Math.abs(s)+1);const f=Nq({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+r;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let yQ={};function aDe(t,e={}){const r=JSON.stringify([t,e]);let i=yQ[r];return i||(i=new Intl.ListFormat(t,e),yQ[r]=i),i}let rz={};function iz(t,e={}){const r=JSON.stringify([t,e]);let i=rz[r];return i||(i=new Intl.DateTimeFormat(t,e),rz[r]=i),i}let sz={};function lDe(t,e={}){const r=JSON.stringify([t,e]);let i=sz[r];return i||(i=new Intl.NumberFormat(t,e),sz[r]=i),i}let nz={};function cDe(t,e={}){const{base:r,...i}=e,s=JSON.stringify([t,i]);let n=nz[s];return n||(n=new Intl.RelativeTimeFormat(t,e),nz[s]=n),n}let EC=null;function uDe(){return EC||(EC=new Intl.DateTimeFormat().resolvedOptions().locale,EC)}function hDe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,s;try{i=iz(t).resolvedOptions(),s=t}catch{const l=t.substring(0,r);i=iz(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function dDe(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function pDe(t){const e=[];for(let r=1;r<=12;r++){const i=mr.utc(2016,r,1);e.push(t(i))}return e}function fDe(t){const e=[];for(let r=1;r<=7;r++){const i=mr.utc(2016,11,13+r);e.push(t(i))}return e}function mP(t,e,r,i,s){const n=t.listingMode(r);return n==="error"?null:n==="en"?i(e):s(e)}function mDe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class gDe{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=lDe(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):Dq(e,3);return Vn(r,this.padTo)}}}class yDe{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Cg.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=iz(r,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class _De{constructor(e,r,i){this.opts={style:"long",...i},!r&&Xpe()&&(this.rtf=cDe(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):DDe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class Ss{static fromOpts(e){return Ss.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,s=!1){const n=e||Fn.defaultLocale,o=n||(s?"en-US":uDe()),a=r||Fn.defaultNumberingSystem,l=i||Fn.defaultOutputCalendar;return new Ss(o,a,l,n)}static resetCache(){EC=null,rz={},sz={},nz={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return Ss.create(e,r,i)}constructor(e,r,i,s){const[n,o,a]=hDe(e);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=dDe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=mDe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Ss.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return mP(this,e,i,Qpe,()=>{const s=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=pDe(o=>this.extract(o,s,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1,i=!0){return mP(this,e,i,tfe,()=>{const s=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=fDe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][e]})}meridiems(e=!0){return mP(this,void 0,e,()=>rfe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[mr.utc(2016,11,13,9),mr.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return mP(this,e,r,ife,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[mr.utc(-40,1,1),mr.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[e]})}extract(e,r,i){const s=this.dtFormatter(e,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new gDe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new yDe(e,this.intl,r)}relFormatter(e={}){return new _De(this.intl,this.isEnglish(),e)}listFormatter(e={}){return aDe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let O6=null;class Va extends uR{static get utcInstance(){return O6===null&&(O6=new Va(0)),O6}static instance(e){return e===0?Va.utcInstance:new Va(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new Va(o5(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${oA(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${oA(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return oA(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class vDe extends uR{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function C0(t,e){if(ii(t)||t===null)return e;if(t instanceof uR)return t;if(bDe(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?s5.instance:r==="utc"||r==="gmt"?Va.utcInstance:Va.parseSpecifier(r)||Cg.create(t)}else return lb(t)?Va.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new vDe(t)}let _Q=()=>Date.now(),vQ="system",bQ=null,wQ=null,xQ=null,TQ=60,SQ;class Fn{static get now(){return _Q}static set now(e){_Q=e}static set defaultZone(e){vQ=e}static get defaultZone(){return C0(vQ,s5.instance)}static get defaultLocale(){return bQ}static set defaultLocale(e){bQ=e}static get defaultNumberingSystem(){return wQ}static set defaultNumberingSystem(e){wQ=e}static get defaultOutputCalendar(){return xQ}static set defaultOutputCalendar(e){xQ=e}static get twoDigitCutoffYear(){return TQ}static set twoDigitCutoffYear(e){TQ=e%100}static get throwOnInvalid(){return SQ}static set throwOnInvalid(e){SQ=e}static resetCaches(){Ss.resetCache(),Cg.resetCache()}}function ii(t){return typeof t>"u"}function lb(t){return typeof t=="number"}function n5(t){return typeof t=="number"&&t%1===0}function bDe(t){return typeof t=="string"}function wDe(t){return Object.prototype.toString.call(t)==="[object Date]"}function Xpe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function xDe(t){return Array.isArray(t)?t:[t]}function EQ(t,e,r){if(t.length!==0)return t.reduce((i,s)=>{const n=[e(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function TDe(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function z2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ng(t,e,r){return n5(t)&&t>=e&&t<=r}function SDe(t,e){return t-e*Math.floor(t/e)}function Vn(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function y0(t){if(!(ii(t)||t===null||t===""))return parseInt(t,10)}function Y_(t){if(!(ii(t)||t===null||t===""))return parseFloat(t)}function Lq(t){if(!(ii(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Dq(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function hR(t){return t%4===0&&(t%100!==0||t%400===0)}function nA(t){return hR(t)?366:365}function zD(t,e){const r=SDe(e-1,12)+1,i=t+(e-r)/12;return r===2?hR(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function Nq(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function kD(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function oz(t){return t>99?t:t>Fn.twoDigitCutoffYear?1900+t:2e3+t}function Zpe(t,e,r,i=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function o5(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function Ype(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Yu(`Invalid unit value ${t}`);return e}function BD(t,e){const r={};for(const i in t)if(z2(t,i)){const s=t[i];if(s==null)continue;r[e(i)]=Ype(s)}return r}function oA(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Vn(r,2)}:${Vn(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${Vn(r,2)}${Vn(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function a5(t){return TDe(t,["hour","minute","second","millisecond"])}const EDe=["January","February","March","April","May","June","July","August","September","October","November","December"],Jpe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],CDe=["J","F","M","A","M","J","J","A","S","O","N","D"];function Qpe(t){switch(t){case"narrow":return[...CDe];case"short":return[...Jpe];case"long":return[...EDe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Kpe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],efe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ADe=["M","T","W","T","F","S","S"];function tfe(t){switch(t){case"narrow":return[...ADe];case"short":return[...efe];case"long":return[...Kpe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const rfe=["AM","PM"],ODe=["Before Christ","Anno Domini"],RDe=["BC","AD"],PDe=["B","A"];function ife(t){switch(t){case"narrow":return[...PDe];case"short":return[...RDe];case"long":return[...ODe];default:return null}}function MDe(t){return rfe[t.hour<12?0:1]}function $De(t,e){return tfe(e)[t.weekday-1]}function IDe(t,e){return Qpe(e)[t.month-1]}function LDe(t,e){return ife(e)[t.year<0?0:1]}function DDe(t,e,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&n){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${s[t][0]}`;case-1:return p?"yesterday":`last ${s[t][0]}`;case 0:return p?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],h=i?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${h} ago`:`in ${a} ${h}`}function CQ(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const NDe={D:VD,DD:Rpe,DDD:Ppe,DDDD:Mpe,t:$pe,tt:Ipe,ttt:Lpe,tttt:Dpe,T:Npe,TT:Fpe,TTT:Upe,TTTT:Vpe,f:zpe,ff:Bpe,fff:jpe,ffff:qpe,F:kpe,FF:Gpe,FFF:Hpe,FFFF:Wpe};class Na{static create(e,r={}){return new Na(e,r)}static parseFormat(e){let r=null,i="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s||/^\s+$/.test(i),val:i}),n}static macroTokenToFormatOpts(e){return NDe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Vn(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>i?MDe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>i?IDe(e,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>i?$De(e,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=Na.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},p=m=>i?LDe(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return h(m)}};return CQ(Na.parseFormat(r),f)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},n=Na.parseFormat(r),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return CQ(n,s(a))}}class Ld{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const sfe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function LS(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function DS(...t){return e=>t.reduce(([r,i,s],n)=>{const[o,a,l]=n(e,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function NS(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const s=r.exec(t);if(s)return i(s)}return[null,null]}function nfe(...t){return(e,r)=>{const i={};let s;for(s=0;s<t.length;s++)i[t[s]]=y0(e[r+s]);return[i,null,r+s]}}const ofe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,FDe=`(?:${ofe.source}?(?:\\[(${sfe.source})\\])?)?`,Fq=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,afe=RegExp(`${Fq.source}${FDe}`),Uq=RegExp(`(?:T${afe.source})?`),UDe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,VDe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,zDe=/(\d{4})-?(\d{3})/,kDe=nfe("weekYear","weekNumber","weekDay"),BDe=nfe("year","ordinal"),GDe=/(\d{4})-(\d\d)-(\d\d)/,lfe=RegExp(`${Fq.source} ?(?:${ofe.source}|(${sfe.source}))?`),jDe=RegExp(`(?: ${lfe.source})?`);function a2(t,e,r){const i=t[e];return ii(i)?r:y0(i)}function HDe(t,e){return[{year:a2(t,e),month:a2(t,e+1,1),day:a2(t,e+2,1)},null,e+3]}function FS(t,e){return[{hours:a2(t,e,0),minutes:a2(t,e+1,0),seconds:a2(t,e+2,0),milliseconds:Lq(t[e+3])},null,e+4]}function dR(t,e){const r=!t[e]&&!t[e+1],i=o5(t[e+1],t[e+2]),s=r?null:Va.instance(i);return[{},s,e+3]}function pR(t,e){const r=t[e]?Cg.create(t[e]):null;return[{},r,e+1]}const qDe=RegExp(`^T?${Fq.source}$`),WDe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function XDe(t){const[e,r,i,s,n,o,a,l,c]=t,h=e[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(Y_(r)),months:f(Y_(i)),weeks:f(Y_(s)),days:f(Y_(n)),hours:f(Y_(o)),minutes:f(Y_(a)),seconds:f(Y_(l),l==="-0"),milliseconds:f(Lq(c),p)}]}const ZDe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Vq(t,e,r,i,s,n,o){const a={year:e.length===2?oz(y0(e)):y0(e),month:Jpe.indexOf(r)+1,day:y0(i),hour:y0(s),minute:y0(n)};return o&&(a.second=y0(o)),t&&(a.weekday=t.length>3?Kpe.indexOf(t)+1:efe.indexOf(t)+1),a}const YDe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function JDe(t){const[,e,r,i,s,n,o,a,l,c,h,p]=t,f=Vq(e,s,i,r,n,o,a);let m;return l?m=ZDe[l]:c?m=0:m=o5(h,p),[f,new Va(m)]}function QDe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const KDe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,eNe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,tNe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function AQ(t){const[,e,r,i,s,n,o,a]=t;return[Vq(e,s,i,r,n,o,a),Va.utcInstance]}function rNe(t){const[,e,r,i,s,n,o,a]=t;return[Vq(e,a,r,i,s,n,o),Va.utcInstance]}const iNe=LS(UDe,Uq),sNe=LS(VDe,Uq),nNe=LS(zDe,Uq),oNe=LS(afe),cfe=DS(HDe,FS,dR,pR),aNe=DS(kDe,FS,dR,pR),lNe=DS(BDe,FS,dR,pR),cNe=DS(FS,dR,pR);function uNe(t){return NS(t,[iNe,cfe],[sNe,aNe],[nNe,lNe],[oNe,cNe])}function hNe(t){return NS(QDe(t),[YDe,JDe])}function dNe(t){return NS(t,[KDe,AQ],[eNe,AQ],[tNe,rNe])}function pNe(t){return NS(t,[WDe,XDe])}const fNe=DS(FS);function mNe(t){return NS(t,[qDe,fNe])}const gNe=LS(GDe,jDe),yNe=LS(lfe),_Ne=DS(FS,dR,pR);function vNe(t){return NS(t,[gNe,cfe],[yNe,_Ne])}const bNe="Invalid Duration",ufe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},wNe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...ufe},mu=146097/400,Aw=146097/4800,xNe={years:{quarters:4,months:12,weeks:mu/7,days:mu,hours:mu*24,minutes:mu*24*60,seconds:mu*24*60*60,milliseconds:mu*24*60*60*1e3},quarters:{months:3,weeks:mu/28,days:mu/4,hours:mu*24/4,minutes:mu*24*60/4,seconds:mu*24*60*60/4,milliseconds:mu*24*60*60*1e3/4},months:{weeks:Aw/7,days:Aw,hours:Aw*24,minutes:Aw*24*60,seconds:Aw*24*60*60,milliseconds:Aw*24*60*60*1e3},...ufe},Nv=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],TNe=Nv.slice(0).reverse();function ly(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new hi(i)}function SNe(t){return t<0?Math.floor(t):Math.ceil(t)}function hfe(t,e,r,i,s){const n=t[s][r],o=e[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?SNe(o):Math.trunc(o);i[s]+=l,e[r]-=l*n}function ENe(t,e){TNe.reduce((r,i)=>ii(e[i])?r:(r&&hfe(t,e,r,e,i),i),null)}function CNe(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class hi{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?xNe:wNe;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||Ss.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return hi.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new Yu(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new hi({values:BD(e,hi.normalizeUnit),loc:Ss.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(lb(e))return hi.fromMillis(e);if(hi.isDuration(e))return e;if(typeof e=="object")return hi.fromObject(e);throw new Yu(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=pNe(e);return i?hi.fromObject(i,r):hi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=mNe(e);return i?hi.fromObject(i,r):hi.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new Yu("need to specify a reason the Duration is invalid");const i=e instanceof Ld?e:new Ld(e,r);if(Fn.throwOnInvalid)throw new eDe(i);return new hi({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new Ope(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Na.create(this.loc,i).formatDurationFromString(this,e):bNe}toHuman(e={}){const r=Nv.map(i=>{const s=this.values[i];return ii(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Dq(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return e.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=hi.fromDurationLike(e),i={};for(const s of Nv)(z2(r.values,s)||z2(this.values,s))&&(i[s]=r.get(s)+this.get(s));return ly(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=hi.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=Ype(e(this.values[i],i));return ly(this,{values:r},!0)}get(e){return this[hi.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...BD(e,hi.normalizeUnit)};return ly(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:s,conversionAccuracy:i};return ly(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return ENe(this.matrix,e),ly(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=CNe(this.normalize().shiftToAll().toObject());return ly(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>hi.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of Nv)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;lb(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)Nv.indexOf(c)>Nv.indexOf(o)&&hfe(this.matrix,s,c,r,o)}else lb(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return ly(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return ly(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of Nv)if(!r(this.values[i],e.values[i]))return!1;return!0}}const Ow="Invalid Interval";function ANe(t,e){return!t||!t.isValid?Zs.invalid("missing or invalid start"):!e||!e.isValid?Zs.invalid("missing or invalid end"):e<t?Zs.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Zs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new Yu("need to specify a reason the Interval is invalid");const i=e instanceof Ld?e:new Ld(e,r);if(Fn.throwOnInvalid)throw new KLe(i);return new Zs({invalid:i})}static fromDateTimes(e,r){const i=mE(e),s=mE(r),n=ANe(i,s);return n??new Zs({start:i,end:s})}static after(e,r){const i=hi.fromDurationLike(r),s=mE(e);return Zs.fromDateTimes(s,s.plus(i))}static before(e,r){const i=hi.fromDurationLike(r),s=mE(e);return Zs.fromDateTimes(s.minus(i),s)}static fromISO(e,r){const[i,s]=(e||"").split("/",2);if(i&&s){let n,o;try{n=mr.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=mr.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return Zs.fromDateTimes(n,a);if(o){const c=hi.fromISO(s,r);if(c.isValid)return Zs.after(n,c)}else if(l){const c=hi.fromISO(i,r);if(c.isValid)return Zs.before(a,c)}}return Zs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Zs.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(mE).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(Zs.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(e){const r=hi.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Zs.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Zs.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Zs.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(Zs.fromDateTimes(r,l.time)),r=null);return Zs.merge(s)}difference(...e){return Zs.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:Ow}toLocaleString(e=VD,r={}){return this.isValid?Na.create(this.s.loc.clone(r),e).formatInterval(this):Ow}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Ow}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Ow}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Ow}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:Ow}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):hi.invalid(this.invalidReason)}mapEndpoints(e){return Zs.fromDateTimes(e(this.s),e(this.e))}}class gP{static hasDST(e=Fn.defaultZone){const r=mr.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return Cg.isValidZone(e)}static normalizeZone(e){return C0(e,Fn.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ss.create(r,i,n)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ss.create(r,i,n)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Ss.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Ss.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Ss.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return Ss.create(r,null,"gregory").eras(e)}static features(){return{relative:Xpe()}}}function OQ(t,e){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(hi.fromMillis(i).as("days"))}function ONe(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=OQ(l,c);return(h-h%7)/7}],["days",OQ]],s={},n=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s)):t=a);return[t,s,a,o]}function RNe(t,e,r,i){let[s,n,o,a]=ONe(t,e,r);const l=e-s,c=r.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=hi.fromObject(n,i);return c.length>0?hi.fromMillis(l,i).shiftTo(...c).plus(h):h}const zq={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},RQ={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},PNe=zq.hanidec.replace(/[\[|\]]/g,"").split("");function MNe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(zq.hanidec)!==-1)e+=PNe.indexOf(t[r]);else for(const s in RQ){const[n,o]=RQ[s];i>=n&&i<=o&&(e+=i-n)}}return parseInt(e,10)}else return e}function Fh({numberingSystem:t},e=""){return new RegExp(`${zq[t||"latn"]}${e}`)}const $Ne="missing Intl.DateTimeFormat.formatToParts support";function Ci(t,e=r=>r){return{regex:t,deser:([r])=>e(MNe(r))}}const INe=String.fromCharCode(160),dfe=`[ ${INe}]`,pfe=new RegExp(dfe,"g");function LNe(t){return t.replace(/\./g,"\\.?").replace(pfe,dfe)}function PQ(t){return t.replace(/\./g,"").replace(pfe," ").toLowerCase()}function Uh(t,e){return t===null?null:{regex:RegExp(t.map(LNe).join("|")),deser:([r])=>t.findIndex(i=>PQ(r)===PQ(i))+e}}function MQ(t,e){return{regex:t,deser:([,r,i])=>o5(r,i),groups:e}}function yP(t){return{regex:t,deser:([e])=>e}}function DNe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function NNe(t,e){const r=Fh(e),i=Fh(e,"{2}"),s=Fh(e,"{3}"),n=Fh(e,"{4}"),o=Fh(e,"{6}"),a=Fh(e,"{1,2}"),l=Fh(e,"{1,3}"),c=Fh(e,"{1,6}"),h=Fh(e,"{1,9}"),p=Fh(e,"{2,4}"),f=Fh(e,"{4,6}"),m=v=>({regex:RegExp(DNe(v.val)),deser:([w])=>w,literal:!0}),_=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return Uh(e.eras("short",!1),0);case"GG":return Uh(e.eras("long",!1),0);case"y":return Ci(c);case"yy":return Ci(p,oz);case"yyyy":return Ci(n);case"yyyyy":return Ci(f);case"yyyyyy":return Ci(o);case"M":return Ci(a);case"MM":return Ci(i);case"MMM":return Uh(e.months("short",!0,!1),1);case"MMMM":return Uh(e.months("long",!0,!1),1);case"L":return Ci(a);case"LL":return Ci(i);case"LLL":return Uh(e.months("short",!1,!1),1);case"LLLL":return Uh(e.months("long",!1,!1),1);case"d":return Ci(a);case"dd":return Ci(i);case"o":return Ci(l);case"ooo":return Ci(s);case"HH":return Ci(i);case"H":return Ci(a);case"hh":return Ci(i);case"h":return Ci(a);case"mm":return Ci(i);case"m":return Ci(a);case"q":return Ci(a);case"qq":return Ci(i);case"s":return Ci(a);case"ss":return Ci(i);case"S":return Ci(l);case"SSS":return Ci(s);case"u":return yP(h);case"uu":return yP(a);case"uuu":return Ci(r);case"a":return Uh(e.meridiems(),0);case"kkkk":return Ci(n);case"kk":return Ci(p,oz);case"W":return Ci(a);case"WW":return Ci(i);case"E":case"c":return Ci(r);case"EEE":return Uh(e.weekdays("short",!1,!1),1);case"EEEE":return Uh(e.weekdays("long",!1,!1),1);case"ccc":return Uh(e.weekdays("short",!0,!1),1);case"cccc":return Uh(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return MQ(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return MQ(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return yP(/[a-z_+-/]{1,256}?/i);case" ":return yP(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:$Ne};return _.token=t,_}const FNe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function UNe(t,e){const{type:r,value:i}=t;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const s=e[r];let n=FNe[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function VNe(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function zNe(t,e,r){const i=t.match(e);if(i){const s={};let n=1;for(const o in r)if(z2(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function kNe(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return ii(t.z)||(r=Cg.create(t.z)),ii(t.Z)||(r||(r=new Va(t.Z)),i=t.Z),ii(t.q)||(t.M=(t.q-1)*3+1),ii(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),ii(t.u)||(t.S=Lq(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),r,i]}let R6=null;function BNe(){return R6||(R6=mr.fromMillis(1555555555555)),R6}function GNe(t,e){if(t.literal)return t;const r=Na.macroTokenToFormatOpts(t.val),i=gfe(r,e);return i==null||i.includes(void 0)?t:i}function ffe(t,e){return Array.prototype.concat(...t.map(r=>GNe(r,e)))}function mfe(t,e,r){const i=ffe(Na.parseFormat(r),t),s=i.map(o=>NNe(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:i,invalidReason:n.invalidReason};{const[o,a]=VNe(s),l=RegExp(o,"i"),[c,h]=zNe(e,l,a),[p,f,m]=h?kNe(h):[null,null,void 0];if(z2(h,"a")&&z2(h,"H"))throw new SC("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function jNe(t,e,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=mfe(t,e,r);return[i,s,n,o]}function gfe(t,e){return t?Na.create(e,t).formatDateTimeParts(BNe()).map(s=>UNe(s,t)):null}const yfe=[0,31,59,90,120,151,181,212,243,273,304,334],_fe=[0,31,60,91,121,152,182,213,244,274,305,335];function ah(t,e){return new Ld("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function vfe(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function bfe(t,e,r){return r+(hR(t)?_fe:yfe)[e-1]}function wfe(t,e){const r=hR(t)?_fe:yfe,i=r.findIndex(n=>n<e),s=e-r[i];return{month:i+1,day:s}}function az(t){const{year:e,month:r,day:i}=t,s=bfe(e,r,i),n=vfe(e,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=e-1,o=kD(a)):o>kD(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:n,...a5(t)}}function $Q(t){const{weekYear:e,weekNumber:r,weekday:i}=t,s=vfe(e,1,4),n=nA(e);let o=r*7+i-s-3,a;o<1?(a=e-1,o+=nA(a)):o>n?(a=e+1,o-=nA(e)):a=e;const{month:l,day:c}=wfe(a,o);return{year:a,month:l,day:c,...a5(t)}}function P6(t){const{year:e,month:r,day:i}=t,s=bfe(e,r,i);return{year:e,ordinal:s,...a5(t)}}function IQ(t){const{year:e,ordinal:r}=t,{month:i,day:s}=wfe(e,r);return{year:e,month:i,day:s,...a5(t)}}function HNe(t){const e=n5(t.weekYear),r=ng(t.weekNumber,1,kD(t.weekYear)),i=ng(t.weekday,1,7);return e?r?i?!1:ah("weekday",t.weekday):ah("week",t.week):ah("weekYear",t.weekYear)}function qNe(t){const e=n5(t.year),r=ng(t.ordinal,1,nA(t.year));return e?r?!1:ah("ordinal",t.ordinal):ah("year",t.year)}function xfe(t){const e=n5(t.year),r=ng(t.month,1,12),i=ng(t.day,1,zD(t.year,t.month));return e?r?i?!1:ah("day",t.day):ah("month",t.month):ah("year",t.year)}function Tfe(t){const{hour:e,minute:r,second:i,millisecond:s}=t,n=ng(e,0,23)||e===24&&r===0&&i===0&&s===0,o=ng(r,0,59),a=ng(i,0,59),l=ng(s,0,999);return n?o?a?l?!1:ah("millisecond",s):ah("second",i):ah("minute",r):ah("hour",e)}const M6="Invalid DateTime",LQ=864e13;function _P(t){return new Ld("unsupported zone",`the zone "${t.name}" is not supported`)}function $6(t){return t.weekData===null&&(t.weekData=az(t.c)),t.weekData}function pE(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new mr({...r,...e,old:r})}function Sfe(t,e,r){let i=t-e*60*1e3;const s=r.offset(i);if(e===s)return[i,e];i-=(s-e)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function DQ(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function xI(t,e,r){return Sfe(Nq(t),e,r)}function NQ(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:i,month:s,day:Math.min(t.c.day,zD(i,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=hi.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Nq(n);let[l,c]=Sfe(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function fE(t,e,r,i,s,n){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=mr.fromObject(t,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return mr.invalid(new Ld("unparsable",`the input "${s}" can't be parsed as ${i}`))}function vP(t,e,r=!0){return t.isValid?Na.create(Ss.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function I6(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Vn(t.c.year,r?6:4),e?(i+="-",i+=Vn(t.c.month),i+="-",i+=Vn(t.c.day)):(i+=Vn(t.c.month),i+=Vn(t.c.day)),i}function FQ(t,e,r,i,s,n){let o=Vn(t.c.hour);return e?(o+=":",o+=Vn(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=Vn(t.c.minute),(t.c.second!==0||!r)&&(o+=Vn(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Vn(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=Vn(Math.trunc(-t.o/60)),o+=":",o+=Vn(Math.trunc(-t.o%60))):(o+="+",o+=Vn(Math.trunc(t.o/60)),o+=":",o+=Vn(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const Efe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},WNe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},XNe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Cfe=["year","month","day","hour","minute","second","millisecond"],ZNe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],YNe=["year","ordinal","hour","minute","second","millisecond"];function UQ(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new Ope(t);return e}function VQ(t,e){const r=C0(e.zone,Fn.defaultZone),i=Ss.fromObject(e),s=Fn.now();let n,o;if(ii(t.year))n=s;else{for(const c of Cfe)ii(t[c])&&(t[c]=Efe[c]);const a=xfe(t)||Tfe(t);if(a)return mr.invalid(a);const l=r.offset(s);[n,o]=xI(t,l,r)}return new mr({ts:n,zone:r,loc:i,o})}function zQ(t,e,r){const i=ii(r.round)?!0:r.round,s=(o,a)=>(o=Dq(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,r.units[r.units.length-1])}function kQ(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class mr{constructor(e){const r=e.zone||Fn.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Ld("invalid input"):null)||(r.isValid?null:_P(r));this.ts=ii(e.ts)?Fn.now():e.ts;let s=null,n=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[s,n]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);s=DQ(this.ts,a),i=Number.isNaN(s.year)?new Ld("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=e.loc||Ss.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new mr({})}static local(){const[e,r]=kQ(arguments),[i,s,n,o,a,l,c]=r;return VQ({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=kQ(arguments),[i,s,n,o,a,l,c]=r;return e.zone=Va.utcInstance,VQ({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=wDe(e)?e.valueOf():NaN;if(Number.isNaN(i))return mr.invalid("invalid input");const s=C0(r.zone,Fn.defaultZone);return s.isValid?new mr({ts:i,zone:s,loc:Ss.fromObject(r)}):mr.invalid(_P(s))}static fromMillis(e,r={}){if(lb(e))return e<-LQ||e>LQ?mr.invalid("Timestamp out of range"):new mr({ts:e,zone:C0(r.zone,Fn.defaultZone),loc:Ss.fromObject(r)});throw new Yu(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(lb(e))return new mr({ts:e*1e3,zone:C0(r.zone,Fn.defaultZone),loc:Ss.fromObject(r)});throw new Yu("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=C0(r.zone,Fn.defaultZone);if(!i.isValid)return mr.invalid(_P(i));const s=Fn.now(),n=ii(r.specificOffset)?i.offset(s):r.specificOffset,o=BD(e,UQ),a=!ii(o.ordinal),l=!ii(o.year),c=!ii(o.month)||!ii(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Ss.fromObject(r);if((h||a)&&p)throw new SC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new SC("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,_,v=DQ(s,n);m?(y=ZNe,_=WNe,v=az(v)):a?(y=YNe,_=XNe,v=P6(v)):(y=Cfe,_=Efe);let w=!1;for(const I of y){const V=o[I];ii(V)?w?o[I]=_[I]:o[I]=v[I]:w=!0}const T=m?HNe(o):a?qNe(o):xfe(o),x=T||Tfe(o);if(x)return mr.invalid(x);const S=m?$Q(o):a?IQ(o):o,[O,A]=xI(S,n,i),P=new mr({ts:O,zone:i,o:A,loc:f});return o.weekday&&h&&e.weekday!==P.weekday?mr.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${P.toISO()}`):P}static fromISO(e,r={}){const[i,s]=uNe(e);return fE(i,s,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,s]=hNe(e);return fE(i,s,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,s]=dNe(e);return fE(i,s,r,"HTTP",r)}static fromFormat(e,r,i={}){if(ii(e)||ii(r))throw new Yu("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=Ss.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=jNe(o,e,r);return h?mr.invalid(h):fE(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return mr.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,s]=vNe(e);return fE(i,s,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new Yu("need to specify a reason the DateTime is invalid");const i=e instanceof Ld?e:new Ld(e,r);if(Fn.throwOnInvalid)throw new QLe(i);return new mr({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=gfe(e,Ss.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(e,r={}){return ffe(Na.parseFormat(e),Ss.fromObject(r)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?$6(this).weekYear:NaN}get weekNumber(){return this.isValid?$6(this).weekNumber:NaN}get weekday(){return this.isValid?$6(this).weekday:NaN}get ordinal(){return this.isValid?P6(this.c).ordinal:NaN}get monthShort(){return this.isValid?gP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?gP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?gP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?gP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return hR(this.year)}get daysInMonth(){return zD(this.year,this.month)}get daysInYear(){return this.isValid?nA(this.year):NaN}get weeksInWeekYear(){return this.isValid?kD(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:s}=Na.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(e=0,r={}){return this.setZone(Va.instance(e),r)}toLocal(){return this.setZone(Fn.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=C0(e,Fn.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(r||i){const n=e.offset(this.ts),o=this.toObject();[s]=xI(o,n,e)}return pE(this,{ts:s,zone:e})}else return mr.invalid(_P(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return pE(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=BD(e,UQ),i=!ii(r.weekYear)||!ii(r.weekNumber)||!ii(r.weekday),s=!ii(r.ordinal),n=!ii(r.year),o=!ii(r.month)||!ii(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new SC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new SC("Can't mix ordinal dates with month/day");let c;i?c=$Q({...az(this.c),...r}):ii(r.ordinal)?(c={...this.toObject(),...r},ii(r.day)&&(c.day=Math.min(zD(c.year,c.month),c.day))):c=IQ({...P6(this.c),...r});const[h,p]=xI(c,this.o,this.zone);return pE(this,{ts:h,o:p})}plus(e){if(!this.isValid)return this;const r=hi.fromDurationLike(e);return pE(this,NQ(this,r))}minus(e){if(!this.isValid)return this;const r=hi.fromDurationLike(e).negate();return pE(this,NQ(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=hi.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?Na.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):M6}toLocaleString(e=VD,r={}){return this.isValid?Na.create(this.loc.clone(r),e).formatDateTime(this):M6}toLocaleParts(e={}){return this.isValid?Na.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=I6(this,o);return a+="T",a+=FQ(this,o,r,i,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?I6(this,e==="extended"):null}toISOWeekDate(){return vP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+FQ(this,o==="extended",r,e,i,n):null}toRFC2822(){return vP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return vP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?I6(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||e)&&(i&&(s+=" "),r?s+="z":e&&(s+="ZZ")),vP(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():M6}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return hi.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=xDe(r).map(hi.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=RNe(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(mr.now(),e,r)}until(e){return this.isValid?Zs.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||mr.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),zQ(r,this.plus(i),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?zQ(e.base||mr.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(mr.isDateTime))throw new Yu("min requires all arguments be DateTimes");return EQ(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(mr.isDateTime))throw new Yu("max requires all arguments be DateTimes");return EQ(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=Ss.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return mfe(o,e,r)}static fromStringExplain(e,r,i={}){return mr.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return VD}static get DATE_MED(){return Rpe}static get DATE_MED_WITH_WEEKDAY(){return tDe}static get DATE_FULL(){return Ppe}static get DATE_HUGE(){return Mpe}static get TIME_SIMPLE(){return $pe}static get TIME_WITH_SECONDS(){return Ipe}static get TIME_WITH_SHORT_OFFSET(){return Lpe}static get TIME_WITH_LONG_OFFSET(){return Dpe}static get TIME_24_SIMPLE(){return Npe}static get TIME_24_WITH_SECONDS(){return Fpe}static get TIME_24_WITH_SHORT_OFFSET(){return Upe}static get TIME_24_WITH_LONG_OFFSET(){return Vpe}static get DATETIME_SHORT(){return zpe}static get DATETIME_SHORT_WITH_SECONDS(){return kpe}static get DATETIME_MED(){return Bpe}static get DATETIME_MED_WITH_SECONDS(){return Gpe}static get DATETIME_MED_WITH_WEEKDAY(){return rDe}static get DATETIME_FULL(){return jpe}static get DATETIME_FULL_WITH_SECONDS(){return Hpe}static get DATETIME_HUGE(){return qpe}static get DATETIME_HUGE_WITH_SECONDS(){return Wpe}}function mE(t){if(mr.isDateTime(t))return t;if(t&&t.valueOf&&lb(t.valueOf()))return mr.fromJSDate(t);if(t&&typeof t=="object")return mr.fromObject(t);throw new Yu(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const JNe={year:void 0,month:void 0,day:void 0,weekday:void 0},QNe={hour:void 0,minute:void 0,second:void 0},KNe={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},kq={timeZone:"Etc/UTC"},pp={year:"numeric",month:"numeric",day:"numeric"},gE={year:"numeric",month:"long",day:"numeric"},yE={year:"numeric",month:"short",day:"numeric"},_E={year:"numeric",month:"long",weekday:"long",day:"numeric"},Ru={hour:"numeric",minute:"numeric"},Vh={...Ru,second:"numeric"},US={"short-date":pp,"short-date-short-time":{...pp,...Ru},"short-date-short-time-24":{...pp,...Ru,hour12:!1},"short-date-long-time":{...pp,...Vh},"short-date-long-time-24":{...pp,...Vh,hour12:!1},"short-date-le":pp,"short-date-le-short-time":{...pp,...Ru},"short-date-le-short-time-24":{...pp,...Ru,hour12:!1},"short-date-le-long-time":{...pp,...Vh},"short-date-le-long-time-24":{...pp,...Vh,hour12:!1},"long-month-day-year":gE,"long-month-day-year-short-time":{...gE,...Ru},"long-month-day-year-short-time-24":{...gE,...Ru,hour12:!1},"long-month-day-year-long-time":{...gE,...Vh},"long-month-day-year-long-time-24":{...gE,...Vh,hour12:!1},"day-short-month-year":yE,"day-short-month-year-short-time":{...yE,...Ru},"day-short-month-year-short-time-24":{...yE,...Ru,hour12:!1},"day-short-month-year-long-time":{...yE,...Vh},"day-short-month-year-long-time-24":{...yE,...Vh,hour12:!1},"long-date":_E,"long-date-short-time":{..._E,...Ru},"long-date-short-time-24":{..._E,...Ru,hour12:!1},"long-date-long-time":{..._E,...Vh},"long-date-long-time-24":{..._E,...Vh,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Ru,"long-time":Vh},e4e=Ha()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),Afe={ar:"ar-u-nu-latn-ca-gregory"};let lz=new WeakMap,Ofe=US["short-date-short-time"];function t4e(t){const e=t||Ofe;let r=lz.get(e);if(!r){const i=jd(),s=Afe[i]||i;r=new Intl.DateTimeFormat(s,e),lz.set(e,r)}return r}function CC(t){return US[t]}function p_(t,e){return t4e(e).format(t)}function r4e(t,e=US["short-date"]){return p_(new Date(t),{...e,...kq,...QNe})}function i4e(t,e=US["short-time"]){return p_(new Date(`1970-01-01T${t}Z`),{...e,...kq,...JNe})}function s4e(t,e=US["short-date-short-time"]){const r=mr.fromISO(t,{setZone:!0}),i=jd(),s=Afe[i]??i;return r.toLocaleString({...KNe,...e},{locale:s})}iq(()=>{lz=new WeakMap,Ofe=US["short-date-short-time"]});const n4e={ar:"ar-u-nu-latn"};let TI=new WeakMap,Rfe={};function o4e(t){const e=t||Rfe;if(!TI.has(e)){const r=jd(),i=n4e[jd()]||r;TI.set(e,new Intl.NumberFormat(i,t))}return TI.get(e)}function a4e(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function k2(t,e){return Object.is(t,-0)&&(t=0),o4e(e).format(t)}iq(()=>{TI=new WeakMap,Rfe={}});let Vx=class extends Gi(de){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return k2(e,a4e(this))}formatDate(e,r=!1){return this.dateFormat?p_(e,{...CC(this.dateFormat),...r&&kq}):this.formatNumber(e)}formatDateOnly(e){const r=(this.dateFormat&&CC(this.dateFormat))??void 0;return r4e(e,r)}formatTimeOnly(e){const r=(this.dateFormat&&CC(this.dateFormat))??void 0;return i4e(e,r)}formatTimestamp(e){const r=(this.dateFormat&&CC(this.dateFormat))??void 0;return s4e(e,r)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,r,i){return e&&r&&i?e.trim().split(r).map(s=>this.formatNumber(Number(s))).join(i):e}};u([et(e4e)],Vx.prototype,"dateFormat",void 0),u([d({type:Boolean,json:{write:!0}})],Vx.prototype,"digitSeparator",void 0),u([d({type:Yi,json:{write:!0}})],Vx.prototype,"places",void 0),Vx=u([R("esri.popup.support.FieldInfoFormat")],Vx);const AC=Vx;var cz;let Jh=cz=class extends de{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new cz({fieldName:this.fieldName,format:this.format?Q(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Jh.prototype,"fieldName",void 0),u([d({type:AC,json:{write:!0}})],Jh.prototype,"format",void 0),u([d({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Jh.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],Jh.prototype,"label",void 0),u([et(new Or({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Jh.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Jh.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],Jh.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],Jh.prototype,"visible",void 0),Jh=cz=u([R("esri.popup.FieldInfo")],Jh);const Bq=Jh;var uz;let Em=uz=class extends $_{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new uz(Q({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Em.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Em.prototype,"description",void 0),u([d({type:[Bq]})],Em.prototype,"fieldInfos",void 0),u([De("fieldInfos")],Em.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Em.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Em.prototype,"type",void 0),Em=uz=u([R("esri.popup.content.FieldsContent")],Em);const cO=Em;let Fv=class extends de{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],Fv.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],Fv.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],Fv.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Fv.prototype,"type",void 0),Fv=u([R("esri.popup.content.mixins.MediaInfo")],Fv);const Gq=Fv;var hz;let zx=hz=class extends xe{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new hz({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],zx.prototype,"fieldName",void 0),u([d()],zx.prototype,"tooltip",void 0),u([d()],zx.prototype,"value",void 0),zx=hz=u([R("esri.popup.content.support.ChartMediaInfoValueSeries")],zx);const l4e=zx;var dz;let Uv=dz=class extends de{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new dz({fields:Q(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],Uv.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],Uv.prototype,"normalizeField",void 0),u([d({type:[l4e],json:{read:!1}})],Uv.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],Uv.prototype,"tooltipField",void 0),Uv=dz=u([R("esri.popup.content.support.ChartMediaInfoValue")],Uv);const c4e=Uv;let OC=class extends Gq{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],OC.prototype,"type",void 0),u([d({type:c4e,json:{write:!0}})],OC.prototype,"value",void 0),OC=u([R("esri.popup.content.mixins.ChartMediaInfo")],OC);const l5=OC,c5=Ha()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var pz;let SI=pz=class extends l5{constructor(t){super(t),this.type="bar-chart"}clone(){return new pz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:c5.write}})],SI.prototype,"type",void 0),SI=pz=u([R("esri.popup.content.BarChartMediaInfo")],SI);const Pfe=SI;var fz;let EI=fz=class extends l5{constructor(t){super(t),this.type="column-chart"}clone(){return new fz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:c5.write}})],EI.prototype,"type",void 0),EI=fz=u([R("esri.popup.content.ColumnChartMediaInfo")],EI);const Mfe=EI;var mz;let RC=mz=class extends de{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new mz({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],RC.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],RC.prototype,"sourceURL",void 0),RC=mz=u([R("esri.popup.content.support.ImageMediaInfoValue")],RC);const u4e=RC;var gz;let kx=gz=class extends Gq{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new gz({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],kx.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],kx.prototype,"type",void 0),u([d({type:u4e,json:{write:!0}})],kx.prototype,"value",void 0),kx=gz=u([R("esri.popup.content.ImageMediaInfo")],kx);const $fe=kx;var yz;let CI=yz=class extends l5{constructor(t){super(t),this.type="line-chart"}clone(){return new yz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:c5.write}})],CI.prototype,"type",void 0),CI=yz=u([R("esri.popup.content.LineChartMediaInfo")],CI);const Ife=CI;var _z;let AI=_z=class extends l5{constructor(t){super(t),this.type="pie-chart"}clone(){return new _z({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:c5.write}})],AI.prototype,"type",void 0),AI=_z=u([R("esri.popup.content.PieChartMediaInfo")],AI);const Lfe=AI,Dfe={base:Gq,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Pfe,"column-chart":Mfe,"line-chart":Ife,"pie-chart":Lfe,image:$fe}};var vz;let Qh=vz=class extends $_{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?$fe.fromJSON(e):e.type==="barchart"?Pfe.fromJSON(e):e.type==="columnchart"?Mfe.fromJSON(e):e.type==="linechart"?Ife.fromJSON(e):e.type==="piechart"?Lfe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new vz(Q({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],Qh.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],Qh.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Qh.prototype,"description",void 0),u([d({types:[Dfe]})],Qh.prototype,"mediaInfos",void 0),u([Se("mediaInfos")],Qh.prototype,"readMediaInfos",null),u([De("mediaInfos")],Qh.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],Qh.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Qh.prototype,"type",void 0),Qh=vz=u([R("esri.popup.content.MediaContent")],Qh);const GD=Qh;var bz;let PC=bz=class extends de{constructor(t){super(t),this.field=null,this.order=null}clone(){return new bz({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],PC.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],PC.prototype,"order",void 0),PC=bz=u([R("esri.popup.support.RelatedRecordsInfoFieldOrder")],PC);const jq=PC;let Np=class extends Gi($_){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],Np.prototype,"description",void 0),u([d({type:Number,json:{type:Yi,write:!0}})],Np.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Np.prototype,"displayType",void 0),u([d({type:[jq],json:{write:!0}})],Np.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:Yi,write:!0}})],Np.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],Np.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Np.prototype,"type",void 0),Np=u([R("esri.popup.content.RelationshipContent")],Np);const jD=Np;var wz;let MC=wz=class extends $_{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new wz({text:this.text})}};u([d({type:String,json:{write:!0}})],MC.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],MC.prototype,"type",void 0),MC=wz=u([R("esri.popup.content.TextContent")],MC);const HD=MC,h4e={base:null,key:"type",typeMap:{attachment:lO,media:GD,text:HD,expression:Iq,field:cO,relationship:jD}};var xz;let Vv=xz=class extends de{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new xz({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],Vv.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],Vv.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],Vv.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],Vv.prototype,"returnType",void 0),Vv=xz=u([R("esri.popup.ExpressionInfo")],Vv);const d4e=Vv;var Tz;let $C=Tz=class extends de{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Tz({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],$C.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],$C.prototype,"showNoDataRecords",void 0),$C=Tz=u([R("esri.popup.LayerOptions")],$C);const p4e=$C;var Sz;let IC=Sz=class extends de{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Sz({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Q(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],IC.prototype,"showRelatedRecords",void 0),u([d({type:[jq],json:{write:!0}})],IC.prototype,"orderByFields",void 0),IC=Sz=u([R("esri.popup.RelatedRecordsInfo")],IC);const f4e=IC;var Ez;let Pu=Ez=class extends Cq(xe){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Ez({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Pu.prototype,"active",void 0),u([d()],Pu.prototype,"className",void 0),u([d()],Pu.prototype,"disabled",void 0),u([d()],Pu.prototype,"icon",void 0),u([d()],Pu.prototype,"id",void 0),u([d()],Pu.prototype,"indicator",void 0),u([d()],Pu.prototype,"title",void 0),u([d()],Pu.prototype,"type",void 0),u([d()],Pu.prototype,"visible",void 0),Pu=Ez=u([R("esri.support.actions.ActionBase")],Pu);const Hq=Pu;var Cz;let OI=Cz=class extends Hq{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new Cz({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],OI.prototype,"image",void 0),OI=Cz=u([R("esri.support.Action.ActionButton")],OI);const m4e=OI;var Az;let LC=Az=class extends Hq{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new Az({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],LC.prototype,"image",void 0),u([d()],LC.prototype,"value",void 0),LC=Az=u([R("esri.support.Action.ActionToggle")],LC);const g4e=LC,y4e="esri.PopupTemplate",_4e=J.getLogger(y4e),vE="relationships/",BQ="expression/",v4e=Mt.ofType({key:"type",defaultKeyValue:"button",base:Hq,typeMap:{button:m4e,toggle:g4e}}),b4e={base:$_,key:"type",typeMap:{media:GD,custom:YLe,text:HD,attachments:lO,fields:cO,expression:Iq,relationship:jD}},w4e=["attachments","fields","media","text","expression","relationship"];let to=class extends Gi(de){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>Qd(b4e,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||pu(e)?e:(_4e.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,s){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(n=>w4e.includes(n.type)).map(n=>n&&n.toJSON(s)),r.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(r):n.type==="media"?this._writeMediaContent(n,r):n.type==="text"?this._writeTextContent(n,r):n.type==="relationship"&&this._writeRelationshipContent(n,r)})):r.description=e}writeFieldInfos(e,r,i,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var h;return(h=c.fieldInfos)==null?void 0:h.length});r.fieldInfos=e.filter(Boolean).map(c=>{const h=c.toJSON(s);return l&&(h.visible=!1),h})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,s){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),aO(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=Q(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(s=>{const n=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===s.fieldName.toLowerCase());n?n.visible=!0:r.fieldInfos.push(s)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var n,o;const i=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=Q(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const s={description:!1,mediaInfos:!1};return i.map(n=>n.type==="media"?(n.mediaInfos||!r||s.mediaInfos||(n.mediaInfos=r,s.mediaInfos=!0),GD.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),HD.fromJSON(n)):n.type==="attachments"?lO.fromJSON(n):n.type==="fields"?cO.fromJSON(n):n.type==="expression"?Iq.fromJSON(n):n.type==="relationship"?jD.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(vE)))return null;const s=r.replace(vE,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?jD.fromJSON({relationshipId:n,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:s}=e;return{field:`${vE}${r}/${s}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new HD({text:e})):n.push(new cO),Array.isArray(r)&&r.length&&n.push(GD.fromJSON({mediaInfos:r})),i&&n.push(lO.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:h}=n,p=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(h),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,s)=>[...i,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(s=>Tl(e,r,s.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(vE)&&!r.startsWith(BQ)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const s=/\{(\w+):.+\}/,n=i.filter(o=>!(o.indexOf(`{${vE}`)===0||o.indexOf(`{${BQ}`)===0)).map(o=>o.replace(s,"{$1}"));return n?n.map(o=>o.slice(1,-1)):[]}};u([d({type:v4e})],to.prototype,"actions",void 0),u([d()],to.prototype,"content",void 0),u([gr("content")],to.prototype,"castContent",null),u([Se("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],to.prototype,"readContent",null),u([De("content",{popupElements:{type:Mt.ofType(h4e)},showAttachments:{type:Boolean},mediaInfos:{type:Mt.ofType(Dfe)},description:{type:String},relatedRecordsInfo:{type:f4e}})],to.prototype,"writeContent",null),u([d({type:[d4e],json:{write:!0}})],to.prototype,"expressionInfos",void 0),u([d({type:[Bq]})],to.prototype,"fieldInfos",void 0),u([De("fieldInfos")],to.prototype,"writeFieldInfos",null),u([d({type:p4e})],to.prototype,"layerOptions",void 0),u([De("layerOptions")],to.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],to.prototype,"lastEditInfoEnabled",void 0),u([d()],to.prototype,"outFields",void 0),u([d()],to.prototype,"overwriteActions",void 0),u([d()],to.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],to.prototype,"title",void 0),u([De("title")],to.prototype,"writeTitle",null),to=u([R("esri.PopupTemplate")],to);const VS=to,GQ=new Or({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let x4e=0,Bx=class extends de{constructor(e){super(e),this.id="sym"+x4e++,this.type=null,this.color=new ke([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:GQ.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:GQ.write}}})],Bx.prototype,"type",void 0),u([d({type:ke,json:{write:{allowNull:!0}}})],Bx.prototype,"color",void 0),u([Se("color")],Bx.prototype,"readColor",null),Bx=u([R("esri.symbols.Symbol")],Bx);const bc=Bx;var Oz;let By=Oz=class extends bc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const s=i.map(n=>{const o=n.valueExpressionInfo;return Tl(t,e,o.expression)});await Promise.all(s)}}}clone(){return new Oz({data:Q(this.data)})}hash(){return TH(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],By.prototype,"color",void 0),u([d({json:{write:!0}})],By.prototype,"data",void 0),u([Se("data",["symbol"])],By.prototype,"readData",null),u([De("data",{})],By.prototype,"writeData",null),u([et({CIMSymbolReference:"cim"},{readOnly:!0})],By.prototype,"type",void 0),By=Oz=u([R("esri.symbols.CIMSymbol")],By);const zS=By;let Gx=class extends de{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],Gx.prototype,"enabled",void 0),u([De("enabled")],Gx.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],Gx.prototype,"type",void 0),Gx=u([R("esri.symbols.Symbol3DLayer")],Gx);const Wf=Gx,T4e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,S4e="screenUtils.toPt: input not recognized!",Nfe=96;function uo(t){return t?t/72*Nfe:0}function yh(t){return t?72*t/Nfe:0}function Yr(t){if(typeof t=="string"){const e=t.match(T4e);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=i==="px"?yh(r):r;return s?-n:n}return console.warn(S4e),null}return t}function _h(t=0,e=0){return{x:t,y:e}}function Zi(t=0,e=0){return[t,e]}function Ffe(t=0,e=0){return[t,e]}function Fo(t=0,e=0,r=0){return[t,e,r]}function UTt(t){return t}function VTt(t){return t}function zTt(t){return t}function lf(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function E4e(t,e){const r=e.transparency!=null?N2(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new ke([i[0]||0,i[1]||0,i[2]||0,r]):null}function C4e(t,e){e.color=t.toJSON().slice(0,3);const r=Q4(t.a);r!==0&&(e.transparency=r)}const Fg={type:ke,json:{type:[Yi],default:null,read:{source:["color","transparency"],reader:E4e},write:{target:{color:{type:[Yi]},transparency:{type:Yi}},writer:C4e}}},Mf={type:Number,cast:Yr,json:{write:!0}};let zv=class extends de{constructor(e){super(e),this.color=new ke([0,0,0,1]),this.extensionLength=0,this.size=yh(1)}clone(){}cloneProperties(){return{color:Q(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],zv.prototype,"type",void 0),u([d(Fg)],zv.prototype,"color",void 0),u([d({...Mf,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],zv.prototype,"extensionLength",void 0),u([d(Mf)],zv.prototype,"size",void 0),zv=u([R("esri.symbols.edges.Edges3D")],zv);const qq=zv;var Rz;let RI=Rz=class extends qq{constructor(t){super(t),this.type="sketch"}clone(){return new Rz(this.cloneProperties())}};u([et({sketch:"sketch"},{readOnly:!0})],RI.prototype,"type",void 0),RI=Rz=u([R("esri.symbols.edges.SketchEdges3D")],RI);const A4e=RI;var Pz;let PI=Pz=class extends qq{constructor(t){super(t),this.type="solid"}clone(){return new Pz(this.cloneProperties())}};u([et({solid:"solid"},{readOnly:!0})],PI.prototype,"type",void 0),PI=Pz=u([R("esri.symbols.support.SolidEdges3D")],PI);const O4e=PI,Ufe={types:{key:"type",base:qq,typeMap:{solid:O4e,sketch:A4e}},json:{write:!0}};var Mz;let ru=Mz=class extends de{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new Mz(t)}};u([d(Fg)],ru.prototype,"color",void 0),ru=Mz=u([R("esri.symbols.support.Symbol3DMaterial")],ru);var $z;let Gy=$z=class extends Wf{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new $z({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([et({Extrude:"extrude"},{readOnly:!0})],Gy.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Gy.prototype,"size",void 0),u([d({type:ru,json:{write:!0}})],Gy.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Gy.prototype,"castShadows",void 0),u([d(Ufe)],Gy.prototype,"edges",void 0),Gy=$z=u([R("esri.symbols.ExtrudeSymbol3DLayer")],Gy);const Vfe=Gy;let DC=class extends bc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([et({esriSLS:"simple-line"},{readOnly:!0})],DC.prototype,"type",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],DC.prototype,"width",void 0),DC=u([R("esri.symbols.LineSymbol")],DC);const R4e=DC,P4e=["begin","end","begin-end"],zfe=["arrow","circle","square","diamond","cross","x"];var Iz;let Fp=Iz=class extends de{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new Iz({color:Q(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Fp.prototype,"placement",void 0),u([et({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Fp.prototype,"type",void 0),u([d({type:zfe})],Fp.prototype,"style",void 0),u([De("style")],Fp.prototype,"writeStyle",null),u([d({type:ke,value:null,json:{write:{allowNull:!0}}})],Fp.prototype,"color",null),u([Se("color")],Fp.prototype,"readColor",null),u([De("color")],Fp.prototype,"writeColor",null),Fp=Iz=u([R("esri.symbols.LineSymbolMarker")],Fp);const M4e=Fp;var Lz;const L6=new Or({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Cm=Lz=class extends R4e{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=Yr(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Yr(n)),o}clone(){var t;return new Lz({color:Q(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};u([et({esriSLS:"simple-line"},{readOnly:!0})],Cm.prototype,"type",void 0),u([d({type:L6.apiValues,json:{read:L6.read,write:L6.write}})],Cm.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Cm.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Cm.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":M4e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Cm.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],Cm.prototype,"miterLimit",void 0),Cm=Lz=u([R("esri.symbols.SimpleLineSymbol")],Cm);const Oh=Cm;let NC=class extends bc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Oh}},json:{default:null,write:!0}})],NC.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],NC.prototype,"type",void 0),NC=u([R("esri.symbols.FillSymbol")],NC);const kfe=NC;let MI=class extends de{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],MI.prototype,"type",void 0),MI=u([R("esri.symbols.patterns.LinePattern3D")],MI);const Bfe=MI,$4e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var Dz;const I4e=Ha()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let FC=Dz=class extends Bfe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new Dz(t)}};u([d({type:["style"]})],FC.prototype,"type",void 0),u([et(I4e),d({type:$4e})],FC.prototype,"style",void 0),FC=Dz=u([R("esri.symbols.patterns.LineStylePattern3D")],FC);const Wq=FC;let $I=class extends de{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],$I.prototype,"type",void 0),$I=u([R("esri.symbols.patterns.Pattern3D")],$I);const Gfe=$I,L4e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var Nz;let UC=Nz=class extends Gfe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new Nz(t)}};u([d({type:["style"]})],UC.prototype,"type",void 0),u([d({type:L4e,json:{read:!0,write:!0}})],UC.prototype,"style",void 0),UC=Nz=u([R("esri.symbols.patterns.StylePattern3D")],UC);const jfe=UC,D4e={types:{key:"type",base:Gfe,typeMap:{style:jfe}},json:{write:!0}},Hfe={types:{key:"type",base:Bfe,typeMap:{style:Wq}},json:{write:!0}},aA=new ke("white");new ke("black");const N4e=new ke([255,255,255,0]);function F4e(t){return t.r===0&&t.g===0&&t.b===0}var Fz;let lA=Fz=class extends ru{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new Fz(t)}};u([et({multiply:"multiply",replace:"replace",tint:"tint"})],lA.prototype,"colorMixMode",void 0),lA=Fz=u([R("esri.symbols.support.Symbol3DFillMaterial")],lA);function an(t=Yfe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Lb(t,e,r,i,s,n,o=an()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function qTt(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new yr(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function B2(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function U4e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function $f(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Kc(t,e,r=0,i=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let h=0;h<i;h++)s=Math.min(s,e[r+3*h]),n=Math.min(n,e[r+3*h+1]),o=Math.min(o,e[r+3*h+2]),a=Math.max(a,e[r+3*h]),l=Math.max(l,e[r+3*h+1]),c=Math.max(c,e[r+3*h+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function D6(t,e,r){const i=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let h=0;h<i;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<i;h++){const p=e[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function V4e(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function cw(t){return t[0]>=t[3]?0:t[3]-t[0]}function uw(t){return t[1]>=t[4]?0:t[4]-t[1]}function I_(t){return t[2]>=t[5]?0:t[5]-t[2]}function qfe(t){const e=cw(t),r=I_(t),i=uw(t);return Math.sqrt(e*e+r*r+i*i)}function Dd(t,e=[0,0,0]){return e[0]=t[0]+cw(t)/2,e[1]=t[1]+uw(t)/2,e[2]=t[2]+I_(t)/2,e}function bP(t,e=[0,0,0]){return e[0]=cw(t),e[1]=uw(t),e[2]=I_(t),e}function Xq(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function WTt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function z4e(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Nd(t,e){return e==null||z4e(t,e)}function Wfe(t,e,r,i,s=t){return s[0]=t[0]+e,s[1]=t[1]+r,s[2]=t[2]+i,s[3]=t[3]+e,s[4]=t[4]+r,s[5]=t[5]+i,s}function XTt(t,e,r=t){const i=t[0]+cw(t)/2,s=t[1]+uw(t)/2,n=t[2]+I_(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=s+(t[1]-s)*e,r[2]=n+(t[2]-n)*e,r[3]=i+(t[3]-i)*e,r[4]=s+(t[4]-s)*e,r[5]=n+(t[5]-n)*e,r}function Xfe(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function Zfe(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function u5(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function xi(t){return t?u5(t,jQ):an(jQ)}function Zq(t,e){return e||(e=zt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function ZTt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function k4e(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function Uz(t){return t.length===6}function Yq(t){return cw(t)===0&&uw(t)===0&&I_(t)===0}function YTt(t,e,r){if(t==null||e==null)return t===e;if(!Uz(t)||!Uz(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function B4e(t,e,r,i,s,n){return Lb(t,e,r,i,s,n,G4e)}const JTt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],jQ=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Yfe=[0,0,0,0,0,0],G4e=an();function N6(t,{isPrimitive:e,width:r,depth:i,height:s}){const n=e?10:1;if(r==null&&s==null&&i==null)return[n*t[0],n*t[1],n*t[2]];const o=Ae(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const j4e=Lb(-.5,-.5,-.5,.5,.5,.5),H4e=Lb(-.5,-.5,0,.5,.5,1),q4e=Lb(-.5,-.5,0,.5,.5,.5);function W4e(t){switch(t){case"sphere":case"cube":case"diamond":return j4e;case"cylinder":case"cone":case"inverted-cone":return H4e;case"tetrahedron":return q4e;default:return}}const Jq=["butt","square","round"],X4e=[...Jq,"none"],Jfe=["miter","bevel","round"];var Vz;let kv=Vz=class extends de{constructor(t){super(t),this.color=new ke([0,0,0,1]),this.size=yh(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new Vz(t)}};u([d(Fg)],kv.prototype,"color",void 0),u([d(Mf)],kv.prototype,"size",void 0),u([d(Hfe)],kv.prototype,"pattern",void 0),u([d({type:Jq,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],kv.prototype,"patternCap",void 0),kv=Vz=u([R("esri.symbols.support.Symbol3DOutline")],kv);var II;let Am=II=class extends Wf{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new II(t)}static fromSimpleFillSymbol(t){var i,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new Wq({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((s=t.outline)==null?void 0:s.color)??aA).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(r.patternCap=t.outline.cap),new II({material:new lA({color:(t.color??N4e).clone()}),pattern:t.style&&t.style!=="solid"?new jfe({style:t.style}):null,outline:r})}};u([et({Fill:"fill"},{readOnly:!0})],Am.prototype,"type",void 0),u([d({type:lA,json:{write:!0}})],Am.prototype,"material",void 0),u([d(D4e)],Am.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Am.prototype,"castShadows",void 0),u([d({type:kv,json:{write:!0}})],Am.prototype,"outline",void 0),u([d(Ufe)],Am.prototype,"edges",void 0),Am=II=u([R("esri.symbols.FillSymbol3DLayer")],Am);const fR=Am,Z4e=["none","underline","line-through"],Y4e=["normal","italic","oblique"],J4e=["normal","lighter","bold","bolder"],Qfe={type:Number,cast:t=>{const e=Zu(t);return e===0?1:ye(e,.1,4)},nonNullable:!0},Q4e=["left","right","center"],K4e=["baseline","top","middle","bottom"],Kfe={type:Q4e,nonNullable:!0},eme={type:K4e,nonNullable:!0},QTt=8;var zz;let Om=zz=class extends de{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Yr(t)}clone(){return new zz({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:Z4e,json:{default:"none",write:!0}})],Om.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Om.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],Om.prototype,"size",void 0),u([gr("size")],Om.prototype,"castSize",null),u([d({type:Y4e,json:{default:"normal",write:!0}})],Om.prototype,"style",void 0),u([d({type:J4e,json:{default:"normal",write:!0}})],Om.prototype,"weight",void 0),Om=zz=u([R("esri.symbols.Font")],Om);const h5=Om;function Ag(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=Zc(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=kH(t,e.portalItem.itemUrl);i!=null&&e5e.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return kz(t,e&&e.portal)}function Og(t,e,r=G2.YES){if(t==null)return t;!dc(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=Zc(t);if(e){const s=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(s){const n=kz(s,e.portal),o=kz(i,e.portal);i=kH(o,n,n),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=sme(i,e==null?void 0:e.portal),dc(i)&&(i=Bd(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!dc(i)&&!jf(i)&&r===G2.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function d5(t,e,r){return Ag(t,r)}function f_(t,e,r,i){const s=Og(t,i);s!==void 0&&(e[r]=s)}const tme=/\/items\/([^\/]+)\/resources\/(.*)/,e5e=/^\.\/resources\//;function rme(t){const e=(t==null?void 0:t.match(tme))??null;return(e==null?void 0:e[1])??null}function ime(t){const e=(t==null?void 0:t.match(tme))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=LJ(r);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=LJ(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function sme(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?AV(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function kz(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=FH();return I2(i,`${i.scheme}://${r}`)?AV(t,e.portalHostname,r):AV(t,r,e.portalHostname)}var G2;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(G2||(G2={}));const t5e=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return G2},ensureMainOnlineDomain:sme,fromJSON:Ag,itemIdFromResourceUrl:rme,prefixAndFilenameFromResourceUrl:ime,read:d5,toJSON:Og,write:f_},Symbol.toStringTag,{value:"Module"}));var Bz;const r5e=Ha()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Bv=Bz=class extends de{constructor(t){super(t)}readHref(t,e,r){return t?Ag(t,r):e.dataURI}writeHref(t,e,r,i){t&&(jf(t)?e.dataURI=t:(e.href=Og(t,i),dc(e.href)&&(e.href=Bd(e.href))))}clone(){return new Bz({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Bv.prototype,"href",void 0),u([Se("href")],Bv.prototype,"readHref",null),u([De("href",{href:{type:String},dataURI:{type:String}})],Bv.prototype,"writeHref",null),u([et(r5e)],Bv.prototype,"primitive",void 0),Bv=Bz=u([R("esri.symbols.support.IconSymbol3DLayerResource")],Bv);const i5e="circle";var Gz;let NT=Gz=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new Gz({x:this.x,y:this.y})}};u([d({type:Number})],NT.prototype,"x",void 0),u([d({type:Number})],NT.prototype,"y",void 0),NT=Gz=u([R("esri.symbols.support.Symbol3DAnchorPosition2D")],NT);var jz;let VC=jz=class extends de{constructor(t){super(t),this.color=new ke([0,0,0,1]),this.size=yh(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new jz(t)}};u([d(Fg)],VC.prototype,"color",void 0),u([d(Mf)],VC.prototype,"size",void 0),VC=jz=u([R("esri.symbols.support.Symbol3DIconOutline")],VC);var jx;const nme="esri.symbols.IconSymbol3DLayer";let Up=jx=class extends Wf{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new jx({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||aA,r=HQ(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||aA).clone()}:null;return new jx({size:t.size,resource:{primitive:n5e(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||F4e(t.color)?aA:t.color,r=HQ(t);return new jx({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new jx({resource:{href:khe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function HQ(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=qQ(t.xoffset),s=qQ(t.yoffset);return(i||s)&&e&&r?{x:-i/e,y:s/r}:null}function qQ(t){return isFinite(t)?t:0}u([d({type:ru,json:{write:!0}})],Up.prototype,"material",void 0),u([d({type:Bv,json:{write:!0}})],Up.prototype,"resource",void 0),u([et({Icon:"icon"},{readOnly:!0})],Up.prototype,"type",void 0),u([d(Mf)],Up.prototype,"size",void 0),u([et({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],Up.prototype,"anchor",void 0),u([d({type:NT,json:{type:[Number],read:{reader:t=>new NT({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Up.prototype,"anchorPosition",void 0),u([d({type:VC,json:{write:!0}})],Up.prototype,"outline",void 0),Up=jx=u([R(nme)],Up);const s5e={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function n5e(t){return s5e[t]||(J.getLogger(nme).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const z0=Up;let Gv=class extends Gi(de){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Gv.prototype,"type",void 0),u([d({type:P4e,json:{default:"begin-end",write:!0}})],Gv.prototype,"placement",void 0),u([d({type:zfe,json:{default:"arrow",write:!0}})],Gv.prototype,"style",void 0),u([d({type:ke,json:{type:[Yi],default:null,write:!0}})],Gv.prototype,"color",void 0),Gv=u([R("esri.symbols.LineStyleMarker3D")],Gv);const Hz=Gv;var LI;let Vp=LI=class extends Wf{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=yh(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new LI(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??yh(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new Wq({style:t.style}):null,material:new ru({color:(t.color||aA).clone()}),marker:t.marker?new Hz({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new LI(e)}};u([d({type:ru,json:{write:!0}})],Vp.prototype,"material",void 0),u([et({Line:"line"},{readOnly:!0})],Vp.prototype,"type",void 0),u([d({type:Jfe,json:{write:!0,default:"miter"}})],Vp.prototype,"join",void 0),u([d({type:Jq,json:{write:!0,default:"butt"}})],Vp.prototype,"cap",void 0),u([d(Mf)],Vp.prototype,"size",void 0),u([d(Hfe)],Vp.prototype,"pattern",void 0),u([d({types:{key:"type",base:Hz,typeMap:{style:Hz}},json:{write:!0}})],Vp.prototype,"marker",void 0),Vp=LI=u([R("esri.symbols.LineSymbol3DLayer")],Vp);const mR=Vp;var qz;const o5e=Ha()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let zC=qz=class extends de{clone(){return new qz({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:d5,write:f_}})],zC.prototype,"href",void 0),u([et(o5e)],zC.prototype,"primitive",void 0),zC=qz=u([R("esri.symbols.support.ObjectSymbol3DLayerResource")],zC);const ome="sphere";var Wz;let $1=Wz=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Wz({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],$1.prototype,"x",void 0),u([d({type:Number})],$1.prototype,"y",void 0),u([d({type:Number})],$1.prototype,"z",void 0),$1=Wz=u([R("esri.symbols.support.Symbol3DAnchorPosition3D")],$1);var Xz;let wa=Xz=class extends Wf{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new Xz({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:ru,json:{write:!0}})],wa.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],wa.prototype,"castShadows",void 0),u([d({type:zC,json:{write:!0}})],wa.prototype,"resource",void 0),u([et({Object:"object"},{readOnly:!0})],wa.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"depth",void 0),u([et({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],wa.prototype,"anchor",void 0),u([d({type:$1,json:{type:[Number],read:{reader:t=>new $1({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],wa.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"roll",void 0),u([d({readOnly:!0})],wa.prototype,"isPrimitive",null),wa=Xz=u([R("esri.symbols.ObjectSymbol3DLayer")],wa);const Qq=wa;var Zz;let nl=Zz=class extends Wf{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new Zz({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:ru,json:{write:!0}})],nl.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],nl.prototype,"castShadows",void 0),u([et({Path:"path"},{readOnly:!0})],nl.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],nl.prototype,"profile",void 0),u([d({type:Jfe,json:{write:!0,default:"miter"}})],nl.prototype,"join",void 0),u([d({type:X4e,json:{write:!0,default:"butt"}})],nl.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],nl.prototype,"width",void 0),u([Se("width",["width","size","height"])],nl.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],nl.prototype,"height",void 0),u([Se("height",["height","size","width"])],nl.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],nl.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],nl.prototype,"profileRotation",void 0),nl=Zz=u([R("esri.symbols.PathSymbol3DLayer")],nl);const Kq=nl;var Yz;let FT=Yz=class extends de{constructor(){super(...arguments),this.color=new ke([0,0,0,1]),this.size=0}clone(){const t={color:Q(this.color),size:this.size};return new Yz(t)}};u([d(Fg)],FT.prototype,"color",void 0),u([d(Mf)],FT.prototype,"size",void 0),FT=Yz=u([R("esri.symbols.support.Symbol3DHalo")],FT);let cA=class extends Gi(de){constructor(e){super(e),this.color=null}};u([d(Fg)],cA.prototype,"color",void 0),cA=u([R("esri.symbols.support.Symbol3DTextBackground")],cA);var DI;let Fl=DI=class extends Wf{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const s={...i,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new DI({enabled:this.enabled,font:this.font&&Q(this.font),halo:this.halo&&Q(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Q(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new DI({font:t.font!=null?t.font.clone():new h5,halo:a5e(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new ru({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new cA({color:t.backgroundColor.clone()}):null})}};function a5e(t,e){return t&&e!=null&&e>0?new FT({color:Q(t),size:e}):null}u([d({type:h5,json:{write:!0}})],Fl.prototype,"font",null),u([De("font")],Fl.prototype,"writeFont",null),u([d({type:FT,json:{write:!0}})],Fl.prototype,"halo",void 0),u([d({...Kfe,json:{default:"center",write:!0}})],Fl.prototype,"horizontalAlignment",void 0),u([d({...Qfe,json:{default:1,write:!0}})],Fl.prototype,"lineHeight",void 0),u([d({type:ru,json:{write:!0}})],Fl.prototype,"material",void 0),u([d({type:cA,json:{write:!0}})],Fl.prototype,"background",void 0),u([d(Mf)],Fl.prototype,"size",null),u([d({type:String,json:{write:!0}})],Fl.prototype,"text",void 0),u([et({Text:"text"},{readOnly:!0})],Fl.prototype,"type",void 0),u([d({...eme,json:{default:"baseline",write:!0}})],Fl.prototype,"verticalAlignment",void 0),Fl=DI=u([R("esri.symbols.TextSymbol3DLayer")],Fl);const hw=Fl;var Jz;let jy=Jz=class extends Wf{constructor(t){super(t),this.color=Qz.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new Jz({color:Q(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:ke,nonNullable:!0,json:{type:[Yi],write:(t,e,r)=>e[r]=t.toArray(ke.AlphaMode.UNLESS_OPAQUE),default:()=>Qz.clone(),defaultEquals:t=>t.toCss(!0)===Qz.toCss(!0)}})],jy.prototype,"color",void 0),u([et({Water:"water"},{readOnly:!0})],jy.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],jy.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],jy.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],jy.prototype,"waveStrength",void 0),jy=Jz=u([R("esri.symbols.WaterSymbol3DLayer")],jy);const Qz=new ke([0,119,190]),ame=jy;var Kz;let jv=Kz=class extends xe{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new Kz({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],jv.prototype,"name",void 0),u([d({type:String})],jv.prototype,"styleUrl",void 0),u([d({type:String})],jv.prototype,"styleName",void 0),u([d({type:jn})],jv.prototype,"portal",void 0),jv=Kz=u([R("esri.symbols.support.StyleOrigin")],jv);const uO=jv;var ek;let cb=ek=class extends xe{constructor(){super(...arguments),this.url=""}clone(){return new ek({url:this.url})}};u([d({type:String})],cb.prototype,"url",void 0),cb=ek=u([R("esri.symbols.support.Thumbnail")],cb);const lme={icon:z0,object:Qq,line:mR,path:Kq,fill:fR,extrude:Vfe,text:hw,water:ame},l5e=Mt.ofType({base:Wf,key:"type",typeMap:lme,errorContext:"symbol-layer"});let zp=class extends bc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||Mt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&J.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Eb(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const s=Ag(e.styleUrl,i);return new uO({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new uO({portal:i&&i.portal||jn.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new fh("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,s){if(e.styleUrl&&e.name){let n=Og(e.styleUrl,s);dc(n)&&(n=Bd(n)),r.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&s&&s.portal&&!Vhe(e.portal.restUrl,s.portal.restUrl)?s&&s.messages&&s.messages.push(new fh("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Wf||e&&lme[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],zp.prototype,"color",null),u([d({type:l5e,nonNullable:!0,json:{write:!0}}),gr(Ahe)],zp.prototype,"symbolLayers",null),u([d({type:uO})],zp.prototype,"styleOrigin",void 0),u([Se("styleOrigin")],zp.prototype,"readStyleOrigin",null),u([De("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],zp.prototype,"writeStyleOrigin",null),u([d({type:cb,json:{read:!1}})],zp.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],zp.prototype,"type",void 0),zp=u([R("esri.symbols.Symbol3D")],zp);const kS=zp;let kC=class extends de{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],kC.prototype,"type",void 0),u([d({readOnly:!0})],kC.prototype,"visible",void 0),kC=u([R("esri.symbols.callouts.Callout3D")],kC);const cme=kC;var tk;let NI=tk=class extends de{constructor(){super(...arguments),this.color=new ke("white")}clone(){return new tk({color:Q(this.color)})}};u([d(Fg)],NI.prototype,"color",void 0),NI=tk=u([R("esri.symbols.callouts.LineCallout3DBorder")],NI);const ume=NI;Object.freeze(Object.defineProperty({__proto__:null,default:ume},Symbol.toStringTag,{value:"Module"}));var rk;let Hy=rk=class extends cme{constructor(t){super(t),this.type="line",this.color=new ke([0,0,0,1]),this.size=yh(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new rk({color:Q(this.color),size:this.size,border:Q(this.border)})}};u([et({line:"line"},{readOnly:!0})],Hy.prototype,"type",void 0),u([d(Fg)],Hy.prototype,"color",void 0),u([d(Mf)],Hy.prototype,"size",void 0),u([d({type:ume,json:{write:!0}})],Hy.prototype,"border",void 0),u([d({readOnly:!0})],Hy.prototype,"visible",null),Hy=rk=u([R("esri.symbols.callouts.LineCallout3D")],Hy);const c5e=Hy;function eW(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function hme(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!eW(t)}function tW(t){return t.type==="point-3d"||t.type==="label-3d"}function dme(t){return t.horizontalAlignment==="center"}const pme={types:{key:"type",base:cme,typeMap:{line:c5e}},json:{write:!0}};var ik;let Hx=ik=class extends de{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new ik({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Mf)],Hx.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],Hx.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],Hx.prototype,"maxWorldLength",void 0),Hx=ik=u([R("esri.symbols.support.Symbol3DVerticalOffset")],Hx);const fme=Hx;var FI;const mme=Mt.ofType({base:null,key:"type",typeMap:{text:hw}});let qy=FI=class extends kS{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new mme,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return hme(this)}hasVisibleVerticalOffset(){return eW(this)}clone(){return new FI({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail),callout:Q(this.callout),verticalOffset:Q(this.verticalOffset)})}static fromTextSymbol(t){return new FI({symbolLayers:[hw.fromTextSymbol(t)]})}};u([d({type:fme,json:{write:!0}})],qy.prototype,"verticalOffset",void 0),u([d(pme)],qy.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],qy.prototype,"styleOrigin",void 0),u([d({type:mme})],qy.prototype,"symbolLayers",void 0),u([et({LabelSymbol3D:"label-3d"},{readOnly:!0})],qy.prototype,"type",void 0),qy=FI=u([R("esri.symbols.LabelSymbol3D")],qy);const p5=qy;var UI;const gme=Mt.ofType({base:null,key:"type",typeMap:{line:mR,path:Kq}}),u5e=Mt.ofType({base:null,key:"type",typeMap:{line:mR,path:Kq}});let BC=UI=class extends kS{constructor(t){super(t),this.symbolLayers=new gme,this.type="line-3d"}clone(){return new UI({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleLineSymbol(t){return new UI({symbolLayers:[mR.fromSimpleLineSymbol(t)]})}};u([d({type:gme,json:{type:u5e}})],BC.prototype,"symbolLayers",void 0),u([et({LineSymbol3D:"line-3d"},{readOnly:!0})],BC.prototype,"type",void 0),BC=UI=u([R("esri.symbols.LineSymbol3D")],BC);const f5=BC;let Wy=class extends bc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Wy.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],Wy.prototype,"type",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Wy.prototype,"xoffset",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Wy.prototype,"yoffset",void 0),u([d({type:Number,cast:t=>t==="auto"?t:Yr(t),json:{write:!0}})],Wy.prototype,"size",void 0),Wy=u([R("esri.symbols.MarkerSymbol")],Wy);const yme=Wy;var VI;const _me=Mt.ofType({base:null,key:"type",typeMap:{fill:fR}});let GC=VI=class extends kS{constructor(t){super(t),this.symbolLayers=new _me,this.type="mesh-3d"}clone(){return new VI({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleFillSymbol(t){return new VI({symbolLayers:[fR.fromSimpleFillSymbol(t)]})}};u([d({type:_me})],GC.prototype,"symbolLayers",void 0),u([et({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],GC.prototype,"type",void 0),GC=VI=u([R("esri.symbols.MeshSymbol3D")],GC);const m5=GC;function h5e(t,e,r){return e.imageData?khe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):vme(e.url,r)}function vme(t,e){var r;return p5e(e)&&!dc(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?gc(e.layer.parsedUrl.path,"images",t):Ag(t,e)}function d5e(t,e,r,i){if(jf(t)){const s=Cb(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,r&&r.imageData===e.imageData&&r.url&&f_(r.url,e,"url",i)}else f_(t,e,"url",i)}const bme={json:{read:{source:["imageData","url"],reader:h5e},write:{writer(t,e,r,i){d5e(t,e,this.source,i)}}}},wme={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=vme(e.url,r)),i}}}};function p5e(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var sk;let Mu=sk=class extends kfe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),r!=null&&(s.width=Yr(r)),i!=null&&(s.height=Yr(i)),s}clone(){const t=new sk({color:Q(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",Q(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([et({esriPFS:"picture-fill"},{readOnly:!0})],Mu.prototype,"type",void 0),u([d(bme)],Mu.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Mu.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Mu.prototype,"yscale",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Mu.prototype,"width",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Mu.prototype,"height",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Mu.prototype,"xoffset",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Mu.prototype,"yoffset",void 0),u([d(wme)],Mu.prototype,"source",void 0),Mu=sk=u([R("esri.symbols.PictureFillSymbol")],Mu);const xme=Mu;var nk;let Kh=nk=class extends yme{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=Yr(e)),r!=null&&(i.height=Yr(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new nk({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",Q(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],Kh.prototype,"color",void 0),u([et({esriPMS:"picture-marker"},{readOnly:!0})],Kh.prototype,"type",void 0),u([d(bme)],Kh.prototype,"url",void 0),u([d(wme)],Kh.prototype,"source",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Kh.prototype,"height",void 0),u([Se("height",["height","size"])],Kh.prototype,"readHeight",null),u([d({type:Number,cast:Yr,json:{write:!0}})],Kh.prototype,"width",void 0),u([d({json:{write:!1}})],Kh.prototype,"size",void 0),Kh=nk=u([R("esri.symbols.PictureMarkerSymbol")],Kh);const g5=Kh;var Hv;const Tme=Mt.ofType({base:null,key:"type",typeMap:{icon:z0,object:Qq,text:hw}});let qv=Hv=class extends kS{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new Tme,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return hme(this)}hasVisibleVerticalOffset(){return eW(this)}clone(){return new Hv({verticalOffset:Q(this.verticalOffset),callout:Q(this.callout),styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Hv({symbolLayers:[z0.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new Hv({symbolLayers:[z0.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var i,s;if(((s=(i=t.data)==null?void 0:i.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new Hv(r!=null&&r.callout?{symbolLayers:[z0.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[z0.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new Hv({symbolLayers:[hw.fromTextSymbol(t)]})}};u([d({type:fme,json:{write:!0}})],qv.prototype,"verticalOffset",void 0),u([d(pme)],qv.prototype,"callout",void 0),u([d({type:Tme,json:{origins:{"web-scene":{write:!0}}}})],qv.prototype,"symbolLayers",void 0),u([et({PointSymbol3D:"point-3d"},{readOnly:!0})],qv.prototype,"type",void 0),qv=Hv=u([R("esri.symbols.PointSymbol3D")],qv);const k0=qv;var jC;const Sme=Mt.ofType({base:null,key:"type",typeMap:{extrude:Vfe,fill:fR,icon:z0,line:mR,object:Qq,text:hw,water:ame}});let HC=jC=class extends kS{constructor(t){super(t),this.symbolLayers=new Sme,this.type="polygon-3d"}clone(){return new jC({styleOrigin:Q(this.styleOrigin),symbolLayers:Q(this.symbolLayers),thumbnail:Q(this.thumbnail)})}static fromJSON(t){const e=new jC;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),i=e.symbolLayers.at(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new jC({symbolLayers:[fR.fromSimpleFillSymbol(t)]})}};u([d({type:Sme,json:{write:!0}})],HC.prototype,"symbolLayers",void 0),u([et({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],HC.prototype,"type",void 0),HC=jC=u([R("esri.symbols.PolygonSymbol3D")],HC);const gR=HC;var ok;const F6=new Or({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Wv=ok=class extends kfe{constructor(...t){super(...t),this.color=new ke([0,0,0,.25]),this.outline=new Oh,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new ok({color:Q(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],Wv.prototype,"color",void 0),u([d()],Wv.prototype,"outline",void 0),u([et({esriSFS:"simple-fill"},{readOnly:!0})],Wv.prototype,"type",void 0),u([d({type:F6.apiValues,json:{read:F6.read,write:F6.write}})],Wv.prototype,"style",void 0),Wv=ok=u([R("esri.symbols.SimpleFillSymbol")],Wv);const dw=Wv;var ak;const U6=new Or({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let kp=ak=class extends yme{constructor(...t){super(...t),this.color=new ke([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Oh}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=Yr(e)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new ak({angle:this.angle,color:Q(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};u([d()],kp.prototype,"color",void 0),u([De("color")],kp.prototype,"writeColor",null),u([et({esriSMS:"simple-marker"},{readOnly:!0})],kp.prototype,"type",void 0),u([d()],kp.prototype,"size",void 0),u([d({type:U6.apiValues,json:{read:U6.read,write:U6.write}})],kp.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],kp.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Oh}},json:{default:null,write:!0}})],kp.prototype,"outline",void 0),kp=ak=u([R("esri.symbols.SimpleMarkerSymbol")],kp);const L_=kp;var lk;let _s=lk=class extends bc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new h5,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return Yr(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new lk({angle:this.angle,backgroundColor:Q(this.backgroundColor),borderLineColor:Q(this.borderLineColor),borderLineSize:this.borderLineSize,color:Q(this.color),font:this.font&&this.font.clone(),haloColor:Q(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:ke,json:{write:!0}})],_s.prototype,"backgroundColor",void 0),u([d({type:ke,json:{write:!0}})],_s.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:Yr})],_s.prototype,"borderLineSize",void 0),u([d({type:h5,json:{write:!0}})],_s.prototype,"font",void 0),u([d({...Kfe,json:{write:!0}})],_s.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],_s.prototype,"kerning",void 0),u([d({type:ke,json:{write:!0}})],_s.prototype,"haloColor",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],_s.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],_s.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],_s.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],_s.prototype,"text",void 0),u([et({esriTS:"text"},{readOnly:!0})],_s.prototype,"type",void 0),u([d({...eme,json:{write:!0}})],_s.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],_s.prototype,"xoffset",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],_s.prototype,"yoffset",void 0),u([d({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],_s.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],_s.prototype,"width",void 0),u([d({type:Number})],_s.prototype,"lineWidth",void 0),u([De("lineWidth")],_s.prototype,"writeLineWidth",null),u([gr("lineWidth")],_s.prototype,"castLineWidth",null),u([d(Qfe)],_s.prototype,"lineHeight",void 0),u([De("lineHeight")],_s.prototype,"writeLineHeight",null),_s=lk=u([R("esri.symbols.TextSymbol")],_s);const BS=_s;var ck;let ed=ck=class extends bc{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:jn.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new ck({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await ae(()=>Promise.resolve().then(()=>Jit),void 0);Jt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{J.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};u([d({json:{write:!1}})],ed.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],ed.prototype,"styleName",void 0),u([d({type:jn,json:{write:!1}})],ed.prototype,"portal",void 0),u([d({type:String,json:{read:d5,write:f_}})],ed.prototype,"styleUrl",void 0),u([d({type:cb,json:{read:!1}})],ed.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],ed.prototype,"name",void 0),u([et({styleSymbolReference:"web-style"},{readOnly:!0})],ed.prototype,"type",void 0),u([d()],ed.prototype,"_fetchCacheKey",null),ed=ck=u([R("esri.symbols.WebStyleSymbol")],ed);const pw=ed;function y5(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Db(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const ub={base:bc,key:"type",typeMap:{"simple-fill":dw,"picture-fill":xme,"picture-marker":g5,"simple-line":Oh,"simple-marker":L_,text:BS,"label-3d":p5,"line-3d":f5,"mesh-3d":m5,"point-3d":k0,"polygon-3d":gR,"web-style":pw,cim:zS},errorContext:"symbol"},f5e={base:bc,key:"type",typeMap:{"picture-marker":g5,"simple-marker":L_,text:BS,"web-style":pw,cim:zS},errorContext:"symbol"},m5e=PS({types:ub}),Eme={base:bc,key:"type",typeMap:{"simple-fill":dw,"picture-fill":xme,"picture-marker":g5,"simple-line":Oh,"simple-marker":L_,text:BS,"line-3d":f5,"mesh-3d":m5,"point-3d":k0,"polygon-3d":gR,"web-style":pw,cim:zS},errorContext:"symbol"},g5e={base:bc,key:"type",typeMap:{text:BS,"label-3d":p5},errorContext:"symbol"},WQ={base:bc,key:"type",typeMap:{"line-3d":f5,"mesh-3d":m5,"point-3d":k0,"polygon-3d":gR,"web-style":pw,cim:zS},errorContext:"symbol"},y5e={base:bc,key:"type",typeMap:{"label-3d":p5},errorContext:"symbol"},Cme=Qd(ub);var uk;function _5e(t){if(!t)return null;const e={};for(const r in t){const i=c_(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function v5e(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let Ul=uk=class extends Gi(de){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:hc(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new uk({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:v5e(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(s.action=i),t==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:_5e}})],Ul.prototype,"aggregateGeometries",null),u([d({value:null})],Ul.prototype,"attributes",null),u([d({value:null,types:aw,json:{read:c_}})],Ul.prototype,"geometry",null),u([d({type:Boolean})],Ul.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],Ul.prototype,"layer",void 0),u([d({type:VS})],Ul.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],Ul.prototype,"sourceLayer",void 0),u([d({value:null,types:ub})],Ul.prototype,"symbol",null),u([d({type:Boolean,value:!0})],Ul.prototype,"visible",null),Ul=uk=u([R("esri.Graphic")],Ul),function(t){t.generateUID=hc}(Ul||(Ul={}));const vh=Ul;var hk;let Xy=hk=class extends de{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new hk({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function V6(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:V6}}}}})],Xy.prototype,"rotation",void 0),u([gr("rotation")],Xy.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:V6}}}}})],Xy.prototype,"scale",void 0),u([d({types:aw,json:{read:c_,write:!0,origins:{"web-scene":{read:c_,write:{overridePolicy:V6}}}}})],Xy.prototype,"targetGeometry",void 0),u([d({type:gh,json:{write:!0}})],Xy.prototype,"camera",void 0),Xy=hk=u([R("esri.Viewpoint")],Xy);const tp=Xy;function _5(t){return typeof t=="string"?document.getElementById(t):t??null}function Ame(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function XQ(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function ZQ(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function ue(t,e,r={}){return rW(t,e,r,Ome)}function bh(t,e,r={}){return rW(t,e,r,Rme)}function rW(t,e,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(Li(s),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(s=KOe(t,n,r.sync,r.equals),r.initial){const o=t();n(o,o)}return s}function ka(t,e,r,i={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=i.onListenerRemove)==null||h.call(i,s),s=null,n=null)}function l(h){i.once&&i.once&&Li(o),r(h)}const c=ue(t,(h,p)=>{var f;a(),V4(h)&&(s=h,n=sR(h,e,l),(f=i.onListenerAdd)==null||f.call(i,h))},{sync:i.sync,initial:!0});return o=Ba(()=>{c.remove(),a()}),o}function j2(t,e){return b5e(t,Rme,e)}function b5e(t,e,r){if(yn(r))return Promise.reject(Lr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let s=null;function n(){s=Li(s)}return new Promise((o,a)=>{s=P2([sa(r,()=>{n(),a(Lr())}),rW(t,l=>{n(),o(l)},{sync:!1,once:!0},e??Ome)])})}function Ome(t){return!0}function Rme(t){return!!t}const Gr={sync:!0},Vr={initial:!0},Cs={sync:!0,initial:!0};let dk=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new G4,this._items=new Set}get length(){return Xt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Xt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Xt(this._observable),yield*this._items}};const w5e={statsWorker:()=>ae(()=>import("./statsWorker-901dda49.js"),["assets/statsWorker-901dda49.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js"]),geometryEngineWorker:()=>ae(()=>import("./geometryEngineWorker-deaacda5.js"),["assets/geometryEngineWorker-deaacda5.js","assets/geometryEngineJSON-18c69b5c.js","assets/geometryEngineBase-91f379ee.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>ae(()=>import("./CSVSourceWorker-b5496f2e.js"),["assets/CSVSourceWorker-b5496f2e.js","assets/json-48e3ea08.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/number-14ec09c6.js","assets/clientSideDefaults-833bca59.js"]),EdgeProcessingWorker:()=>ae(()=>import("./EdgeProcessingWorker-fa3345a3.js"),[]),ElevationSamplerWorker:()=>ae(()=>import("./ElevationSamplerWorker-3def0c59.js"),["assets/ElevationSamplerWorker-3def0c59.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/georeference-0b768c20.js","assets/MeshGeoreferencedRelativeVertexSpace-2d15e21d.js","assets/MeshLocalVertexSpace-ff29e29f.js"]),FeatureServiceSnappingSourceWorker:()=>ae(()=>import("./FeatureServiceSnappingSourceWorker-a786e300.js"),["assets/FeatureServiceSnappingSourceWorker-a786e300.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/symbologySnappingCandidates-4a018619.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/query-dffe729f.js"]),GeoJSONSourceWorker:()=>ae(()=>import("./GeoJSONSourceWorker-711bafc7.js"),["assets/GeoJSONSourceWorker-711bafc7.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/geojson-260f683c.js","assets/clientSideDefaults-833bca59.js","assets/sourceUtils-f901366e.js"]),LercWorker:()=>ae(()=>import("./LercWorker-d31e3c9f.js"),[]),MemorySourceWorker:()=>ae(()=>import("./MemorySourceWorker-b547bedf.js"),["assets/MemorySourceWorker-b547bedf.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/clientSideDefaults-833bca59.js","assets/sourceUtils-f901366e.js"]),PBFDecoderWorker:()=>ae(()=>import("./PBFDecoderWorker-3ba71d56.js"),["assets/PBFDecoderWorker-3ba71d56.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js"]),Pipeline:()=>ae(()=>import("./Pipeline-e02c5284.js").then(t=>t.P),["assets/Pipeline-e02c5284.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/StreamFeatureManager-75a44ef7.js","assets/quickselect-94603516.js","assets/arcadeTimeUtils-5bca0f0f.js","assets/centroid-8e8cfa47.js","assets/ogcFeatureUtils-5a3691bb.js","assets/geojson-260f683c.js","assets/clientSideDefaults-833bca59.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/createConnection-dacb6930.js","assets/definitions-9264ac24.js","assets/TileInfoView-ca9693d5.js","assets/number-e491b09e.js","assets/geohashUtils-77d8429b.js"]),PointCloudWorker:()=>ae(()=>import("./PointCloudWorker-85fd6b46.js"),["assets/PointCloudWorker-85fd6b46.js","assets/PointCloudWorkerUtil-3d4fdff0.js","assets/PointCloudUniqueValueRenderer-335941d6.js"]),RasterWorker:()=>ae(()=>import("./RasterWorker-53210d71.js"),["assets/RasterWorker-53210d71.js","assets/dataUtils-b9d06f79.js","assets/colorUtils-c0f43caf.js","assets/utils-739fc63e.js","assets/rasterProjectionHelper-e118ec16.js"]),SceneLayerSnappingSourceWorker:()=>ae(()=>import("./SceneLayerSnappingSourceWorker-650eb93f.js"),[]),SceneLayerWorker:()=>ae(()=>import("./SceneLayerWorker-5fac4a39.js").then(t=>t.a),["assets/SceneLayerWorker-5fac4a39.js","assets/MeshGeoreferencedRelativeVertexSpace-2d15e21d.js","assets/MeshLocalVertexSpace-ff29e29f.js","assets/I3SNode-027eba91.js"]),WFSSourceWorker:()=>ae(()=>import("./WFSSourceWorker-188f5e87.js"),["assets/WFSSourceWorker-188f5e87.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/geojson-260f683c.js","assets/sourceUtils-f901366e.js","assets/wfsUtils-fde2263b.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>ae(()=>import("./WorkerTileHandler-d53205c5.js"),["assets/WorkerTileHandler-d53205c5.js","assets/TileClipper-ae6eca9e.js","assets/StyleRepository-87e1900f.js","assets/colorUtils-c0f43caf.js","assets/definitions-9264ac24.js","assets/Rect-98da58d6.js","assets/pbf-5cbd0354.js","assets/TurboLine-d6e39422.js","assets/BidiEngine-9a40f2f4.js"])};var Mo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Mo||(Mo={}));let x5e=0;function Pme(){return x5e++}function T5e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function hO(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function iW(t,e,r,i){if(e.type===Mo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Mo.INVOKE&&e.type!==Mo.RESPONSE)return void t.postMessage(e);let s;if(T5e(r)?(s=YQ(r.transferList),e.data=r.result):(s=YQ(i),e.data=r),s){if(oe("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Mo.INVOKE:throw o;case Mo.RESPONSE:return void iW(t,{type:Mo.RESPONSE,jobId:e.jobId,error:hO(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function dO(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function YQ(t){if(!t||!t.length)return null;if(oe("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!S5e(r));return e.length?e:null}function S5e(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}const{CLOSE:JQ,ABORT:QQ,INVOKE:KQ,RESPONSE:bE,OPEN_PORT:eK,ON:E5e}=Mo,C5e=2;let A5e=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Mo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},m_=class qx{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const s=new qx(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),qx.clients.set(s,i),r.port2}static loadWorker(e){const r=w5e[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new A5e(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:JQ}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const s=i==null?void 0:i.signal,n=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new U("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=Pme();return new Promise((a,l)=>{if(yn(s))return this._processWork(),void l(Lr());const c=sa(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Li(p.abortHandle),this._post({type:QQ,jobId:o}),l(Lr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,h),this._post({type:KQ,jobId:o,methodName:e,abortable:s!=null},r,n)})}on(e,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:Mo.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:Mo.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:eK,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=C5e)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:s,resolver:n}=e;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Li(e.abortHandle),e.reject(Lr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=dO(e);if(r)switch(r.type){case bE:this._onResponseMessage(r);break;case KQ:this._invokeQueue.push(r);break;case QQ:this._onAbortMessage(r);break;case JQ:this._onCloseMessage();break;case eK:this._onOpenPortMessage(r);break;case E5e:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&qx.clients.get(this)===e&&e.destroy(),qx.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const p=r.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:bE,jobId:i,error:hO(p)})}pu(l)?(a.set(i,{controller:o,promise:l}),l.then(p=>{a.has(i)&&(a.delete(i),this._post({type:bE,jobId:i},p))},p=>{a.has(i)&&(a.delete(i),gs(p)||this._post({type:bE,jobId:i,error:hO(p||{message:`Error encountered at method ${r}`})}))})):this._post({type:bE,jobId:i},l)}_onOpenPortMessage(e){new qx(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,n=>{r.postMessage(n)}),s=sR(e.port,"message",n=>{const o=dO(n);(o==null?void 0:o.type)===Mo.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),Li(o.abortHandle),i?o.reject(U.fromJSON(JSON.parse(i))):o.resolve(s)}_post(e,r,i){return iW(this._port,e,r,i)}};m_.kernelInfo={buildDate:sde,fullVersion:eq,revision:nde},m_.clients=new Map;let O5e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new dk}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,s)=>{let n=!0;const o=a=>{Jt(r.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];pu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new m_(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new m_(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Lr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,r,i){let s;Array.isArray(i)?(J.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=mo();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:s,resolver:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>P2(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const Mme=J.getLogger("esri.intl.substitute");function a2t(t,e,r={}){const{format:i={}}=r;return U4(t,s=>R5e(s,e,i))}function R5e(t,e,r){let i,s;const n=t.indexOf(":");if(n===-1?i=t.trim():(i=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!i)return"";const o=rR(i,e);if(o==null)return"";const a=(s?r==null?void 0:r[s]:null)??(r==null?void 0:r[i]);return a?P5e(o,a):s?M5e(o,s):sW(o)}function P5e(t,e){switch(e.type){case"date":return p_(t,e.intlOptions);case"number":return k2(t,e.intlOptions);default:return Mme.warn("missing format descriptor for key {key}"),sW(t)}}function M5e(t,e){switch(e.toLowerCase()){case"dateformat":return p_(t);case"numberformat":return k2(t);default:return Mme.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?p_(t):/^numberformat/i.test(e)?k2(t):sW(t)}}function sW(t){switch(typeof t){case"string":return t;case"number":return k2(t);case"boolean":return""+t;default:return t instanceof Date?p_(t):""}}async function $5e(t,e,r,i){const s=e.exec(r);if(!s)throw new U("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=a$e(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await tK(t(c))}catch(p){if(c===l)throw new U("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p});try{h=await tK(t(l))}catch(f){throw new U("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return h}async function tK(t){if(rK.fetchBundleAsset!=null)return rK.fetchBundleAsset(t);const e=await Nr(t,{responseType:"text"});return JSON.parse(e.data)}let I5e=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return $5e(this.getAssetUrl,this.matcher,e,r)}};function L5e(t){return new I5e(t)}const rK={};o$e(L5e({pattern:"esri/",location:kr}));const D5e={};function N5e(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=D5e.baseUrl),e}let F5e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},zI=class{constructor(){this._dispatcher=new F5e,this._workerPostMessage({type:Mo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){M2(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){M2(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=dO(e);if(r&&r.type===Mo.OPEN){const{modulePath:i,jobId:s}=r;let n=await m_.loadWorker(i);n||(n=await ae(()=>import(i),[]));const o=m_.connect(n);this._workerPostMessage({type:Mo.OPENED,jobId:s,data:o})}}};const pk=J.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:U5e}=Mo,V5e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let wP,xP;const iK="Failed to create Worker. Fallback to execute module in main thread";async function z5e(){if(!oe("esri-workers")||(oe("mozilla"),0))return sK(new zI);if(!wP&&!xP)try{const e=V5e.split('"{CONFIGURATION}"').join(`'${k5e()}'`);wP=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){xP=e||{}}let t;if(wP)try{t=new Worker(wP,{name:"esri-worker-"+B5e++})}catch{pk.warn(iK,xP),t=new zI}else pk.warn(iK,xP),t=new zI;return sK(t)}async function sK(t){return new Promise(e=>{function r(s){const n=dO(s);n&&n.type===U5e&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(s){s.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),pk.warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new zI).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function k5e(){let t;if(Zr.default!=null){const s={...Zr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(Zr));t.assetsPath=Zc(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Zc(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=jd(),t.has={"esri-csp-restrictions":oe("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":oe("esri-2d-update-debug"),"esri-2d-log-updating":oe("esri-2d-log-updating"),"featurelayer-pbf":oe("featurelayer-pbf"),"featurelayer-simplify-thresholds":oe("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":oe("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":oe("featurelayer-simplify-mobile-factor"),"esri-atomics":oe("esri-atomics"),"esri-shared-array-buffer":oe("esri-shared-array-buffer"),"esri-tiles-debug":oe("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":oe("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":oe("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":oe("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=Zc(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Zc(t.workers.workerPath):t.workers.workerPath=Zc(kr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Zr.workers.loaderConfig,r=N5e({baseUrl:e==null?void 0:e.baseUrl,locale:jd(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:sde,fullVersion:eq,revision:nde}})}let B5e=0;const{ABORT:nK,INVOKE:G5e,OPEN:j5e,OPENED:H5e,RESPONSE:wE}=Mo;let q5e=class $me{static async create(e){const r=await z5e();return new $me(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),J.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,s=Pme();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:EH(i,()=>{this._outJobs.delete(s),this._post({type:nK,jobId:s})})};this._outJobs.set(s,a),this._post({type:j5e,jobId:s,modulePath:e})})}_onMessage(e){const r=dO(e);if(r)switch(r.type){case H5e:this._onOpenedMessage(r);break;case wE:this._onResponseMessage(r);break;case nK:this._onAbortMessage(r);break;case G5e:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=oMe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:wE,jobId:i,error:hO(h)})}pu(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:wE,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),gs(h)||this._post({type:wE,jobId:i,error:hO(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:wE,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Li(s.abortHandle),s.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:s}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Li(n.abortHandle),i?n.reject(U.fromJSON(JSON.parse(i))):n.resolve(s))}_post(e,r,i){return iW(this.worker,e,r,i)}};const oK=oe("host-browser")?Math.min(navigator.hardwareConcurrency-1,oe("workers-pool-size")):0;let Z1=oe("esri-mobile")?Math.min(oK,3):oK;Z1||(Z1=oe("safari")&&oe("mac")?7:2);let aK=0;const kI=[];function W5e(){Lme()}async function TP(t,e){const r=new O5e;return await r.open(t,e),r}async function Ime(t,e={}){if(typeof t!="string")throw new U("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(oe("host-webworker")&&!oe("esri-workers")&&(r="local"),r==="local"){let i=await m_.loadWorker(t);i||(i=await ae(()=>import(t),[])),Jt(e.signal);const s=e.client||i;return TP([m_.connect(i)],{...e,client:s})}if(await Lme(),Jt(e.signal),r==="dedicated"){const i=aK++%Z1;return TP([await kI[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,Z1);if(i<Z1){const s=new Array(i);for(let n=0;n<i;++n){const o=aK++%Z1;s[n]=kI[o].open(t,e)}return TP(s,e)}}return TP(kI.map(i=>i.open(t,e)),e)}let SP=null;async function Lme(){if(SP)return SP;new AbortController;const t=[];for(let e=0;e<Z1;e++){const r=q5e.create(e).then(i=>(kI[e]=i,i));t.push(r)}return SP=Promise.all(t),SP}let bf=class extends xe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Pi,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,ue)}addWhen(e,r,i={}){return this._installWatch(e,r,i,bh)}addOnCollectionChange(e,r,{initial:i=!1,final:s=!1}={}){const n=++this._handleId;return this._handles.add([ka(e,"after-changes",this._createSyncUpdatingCallback(),Gr),ka(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>r({added:[],removed:o.toArray()}):void 0})],n),Ba(()=>this._handles.remove(n))}addPromise(e){if(e==null)return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(EP)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},s){const n=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,r,i);return this._handles.add(o,n),Ba(()=>this._handles.remove(n))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),s=ue(e,i,{sync:!0,equals:()=>!1});return this._handles.add(s,r),s}_createSyncUpdatingCallback(){return()=>{this._handles.remove(EP),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(RS(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(EP))}),EP)}}};u([d({readOnly:!0})],bf.prototype,"updating",void 0),bf=u([R("esri.core.support.WatchUpdatingTracking")],bf);const EP=-42,v5=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new Pi,this._updatingHandles=new bf}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return u([d({readOnly:!0})],e.prototype,"handles",null),u([d({readOnly:!0})],e.prototype,"updatingHandles",null),e=u([R("esri.core.HandleOwner")],e),e};let pO=class extends v5(xe){};pO=u([R("esri.core.HandleOwner")],pO);let uA=class extends v5(Mt){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Mt.ofType(this.itemType.Type))(e):new Mt(e)}};function fk(t,e){return{type:t,cast:Ahe,set(r){const i=Eb(r,this._get(e),t);i.owner=this,this._set(e,i)}}}u([d()],uA.prototype,"owner",null),uA=u([R("esri.core.support.OwningCollection")],uA);var qC;const qD=Ha()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Dme=qD.jsonValues.slice();XA(Dme,"orthometric");const hA=Ha()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let td=qC=class extends de{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return qD.write(t,e,r)}readHeightModel(t,e,r){return qD.read(t)||(r&&r.messages&&r.messages.push(X5e(t,{context:r})),null)}readHeightUnit(t,e,r){return hA.read(t)||(r&&r.messages&&r.messages.push(lK(t,{context:r})),null)}readHeightUnitService(t,e,r){return ede(t)||hA.read(t)||(r&&r.messages&&r.messages.push(lK(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new qC({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=YPe(e);return new qC({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new qC;return e.read(t,{origin:"web-scene"}),e}};function lK(t,e){return new fh("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function X5e(t,e){return new fh("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}u([d({type:qD.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Dme,default:"ellipsoidal"}}}})],td.prototype,"heightModel",void 0),u([De("web-scene","heightModel")],td.prototype,"writeHeightModel",null),u([Se(["web-scene","service"],"heightModel")],td.prototype,"readHeightModel",null),u([d({type:hA.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:hA.jsonValues,write:hA.write}}}})],td.prototype,"heightUnit",void 0),u([Se("web-scene","heightUnit")],td.prototype,"readHeightUnit",null),u([Se("service","heightUnit")],td.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],td.prototype,"vertCRS",void 0),u([Se("service","vertCRS",["vertCRS","ellipsoid","geoid"])],td.prototype,"readVertCRS",null),td=qC=u([R("esri.geometry.HeightModelInfo")],td);const fw=td;function $s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Xf(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=h,t[10]=p,t[11]=f,t[12]=m,t[13]=y,t[14]=_,t[15]=v,t}function wh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _c(t,e){if(t===e){const r=e[1],i=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function GS(t,e){return bn(t,e)||wh(t),t}function bn(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,O=i*l-s*a,A=i*c-n*a,P=s*c-n*l,I=h*_-p*y,V=h*v-f*y,k=h*w-m*y,B=p*v-f*_,z=p*w-m*_,Z=f*w-m*v;let W=T*Z-x*z+S*B+O*k-A*V+P*I;return W?(W=1/W,t[0]=(a*Z-l*z+c*B)*W,t[1]=(s*z-i*Z-n*B)*W,t[2]=(_*P-v*A+w*O)*W,t[3]=(f*A-p*P-m*O)*W,t[4]=(l*k-o*Z-c*V)*W,t[5]=(r*Z-s*k+n*V)*W,t[6]=(v*S-y*P-w*x)*W,t[7]=(h*P-f*S+m*x)*W,t[8]=(o*z-a*k+c*I)*W,t[9]=(i*k-r*z-n*I)*W,t[10]=(y*A-_*S+w*T)*W,t[11]=(p*S-h*A-m*T)*W,t[12]=(a*V-o*B-l*I)*W,t[13]=(r*B-i*V+s*I)*W,t[14]=(_*x-y*O-v*T)*W,t[15]=(h*O-p*x+f*T)*W,t):null}function Z5e(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15];return t[0]=a*(f*w-m*v)-p*(l*w-c*v)+_*(l*m-c*f),t[1]=-(i*(f*w-m*v)-p*(s*w-n*v)+_*(s*m-n*f)),t[2]=i*(l*w-c*v)-a*(s*w-n*v)+_*(s*c-n*l),t[3]=-(i*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),t[4]=-(o*(f*w-m*v)-h*(l*w-c*v)+y*(l*m-c*f)),t[5]=r*(f*w-m*v)-h*(s*w-n*v)+y*(s*m-n*f),t[6]=-(r*(l*w-c*v)-o*(s*w-n*v)+y*(s*c-n*l)),t[7]=r*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),t[8]=o*(p*w-m*_)-h*(a*w-c*_)+y*(a*m-c*p),t[9]=-(r*(p*w-m*_)-h*(i*w-n*_)+y*(i*m-n*p)),t[10]=r*(a*w-c*_)-o*(i*w-n*_)+y*(i*c-n*a),t[11]=-(r*(a*m-c*p)-o*(i*m-n*p)+h*(i*c-n*a)),t[12]=-(o*(p*v-f*_)-h*(a*v-l*_)+y*(a*f-l*p)),t[13]=r*(p*v-f*_)-h*(i*v-s*_)+y*(i*f-s*p),t[14]=-(r*(a*v-l*_)-o*(i*v-s*_)+y*(i*l-s*a)),t[15]=r*(a*f-l*p)-o*(i*f-s*p)+h*(i*l-s*a),t}function Y5e(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],m=t[12],y=t[13],_=t[14],v=t[15];return(e*o-r*n)*(p*v-f*_)-(e*a-i*n)*(h*v-f*y)+(e*l-s*n)*(h*_-p*y)+(r*a-i*o)*(c*v-f*m)-(r*l-s*o)*(c*_-p*m)+(i*l-s*a)*(c*y-h*m)}function si(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=e[9],m=e[10],y=e[11],_=e[12],v=e[13],w=e[14],T=e[15];let x=r[0],S=r[1],O=r[2],A=r[3];return t[0]=x*i+S*a+O*p+A*_,t[1]=x*s+S*l+O*f+A*v,t[2]=x*n+S*c+O*m+A*w,t[3]=x*o+S*h+O*y+A*T,x=r[4],S=r[5],O=r[6],A=r[7],t[4]=x*i+S*a+O*p+A*_,t[5]=x*s+S*l+O*f+A*v,t[6]=x*n+S*c+O*m+A*w,t[7]=x*o+S*h+O*y+A*T,x=r[8],S=r[9],O=r[10],A=r[11],t[8]=x*i+S*a+O*p+A*_,t[9]=x*s+S*l+O*f+A*v,t[10]=x*n+S*c+O*m+A*w,t[11]=x*o+S*h+O*y+A*T,x=r[12],S=r[13],O=r[14],A=r[15],t[12]=x*i+S*a+O*p+A*_,t[13]=x*s+S*l+O*f+A*v,t[14]=x*n+S*c+O*m+A*w,t[15]=x*o+S*h+O*y+A*T,t}function Sl(t,e,r){const i=r[0],s=r[1],n=r[2];if(e===t)t[12]=e[0]*i+e[4]*s+e[8]*n+e[12],t[13]=e[1]*i+e[5]*s+e[9]*n+e[13],t[14]=e[2]*i+e[6]*s+e[10]*n+e[14],t[15]=e[3]*i+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],m=e[7],y=e[8],_=e[9],v=e[10],w=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=h,t[5]=p,t[6]=f,t[7]=m,t[8]=y,t[9]=_,t[10]=v,t[11]=w,t[12]=o*i+h*s+y*n+e[12],t[13]=a*i+p*s+_*n+e[13],t[14]=l*i+f*s+v*n+e[14],t[15]=c*i+m*s+w*n+e[15]}return t}function b5(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function lc(t,e,r,i){let s,n,o,a,l,c,h,p,f,m,y,_,v,w,T,x,S,O,A,P,I,V,k,B,z=i[0],Z=i[1],W=i[2],H=Math.sqrt(z*z+Z*Z+W*W);return H<Wa()?null:(H=1/H,z*=H,Z*=H,W*=H,s=Math.sin(r),n=Math.cos(r),o=1-n,a=e[0],l=e[1],c=e[2],h=e[3],p=e[4],f=e[5],m=e[6],y=e[7],_=e[8],v=e[9],w=e[10],T=e[11],x=z*z*o+n,S=Z*z*o+W*s,O=W*z*o-Z*s,A=z*Z*o-W*s,P=Z*Z*o+n,I=W*Z*o+z*s,V=z*W*o+Z*s,k=Z*W*o-z*s,B=W*W*o+n,t[0]=a*x+p*S+_*O,t[1]=l*x+f*S+v*O,t[2]=c*x+m*S+w*O,t[3]=h*x+y*S+T*O,t[4]=a*A+p*P+_*I,t[5]=l*A+f*P+v*I,t[6]=c*A+m*P+w*I,t[7]=h*A+y*P+T*I,t[8]=a*V+p*k+_*B,t[9]=l*V+f*k+v*B,t[10]=c*V+m*k+w*B,t[11]=h*V+y*k+T*B,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function H2(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*i,t[5]=o*s+h*i,t[6]=a*s+p*i,t[7]=l*s+f*i,t[8]=c*s-n*i,t[9]=h*s-o*i,t[10]=p*s-a*i,t[11]=f*s-l*i,t}function w5(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],p=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*i,t[1]=o*s-h*i,t[2]=a*s-p*i,t[3]=l*s-f*i,t[8]=n*i+c*s,t[9]=o*i+h*s,t[10]=a*i+p*s,t[11]=l*i+f*s,t}function q2(t,e,r){const i=Math.sin(r),s=Math.cos(r),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],p=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*i,t[1]=o*s+h*i,t[2]=a*s+p*i,t[3]=l*s+f*i,t[4]=c*s-n*i,t[5]=h*s-o*i,t[6]=p*s-a*i,t[7]=f*s-l*i,t}function yR(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function J5e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cu(t,e,r){if(e===0)return wh(t);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Wa()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*i,t[2]=l*o*n-a*i,t[3]=0,t[4]=o*a*n-l*i,t[5]=a*a*n+s,t[6]=l*a*n+o*i,t[7]=0,t[8]=o*l*n+a*i,t[9]=a*l*n-o*i,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Nme(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Q5e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Fme(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ume(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=i+i,l=s+s,c=n+n,h=i*a,p=i*l,f=i*c,m=s*l,y=s*c,_=n*c,v=o*a,w=o*l,T=o*c;return t[0]=1-(m+_),t[1]=p+T,t[2]=f-w,t[3]=0,t[4]=p-T,t[5]=1-(h+_),t[6]=y+v,t[7]=0,t[8]=f+w,t[9]=y-v,t[10]=1-(h+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function K5e(t,e){const r=eFe,i=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=i*i+s*s+n*n+o*o;return p>0?(r[0]=2*(a*o+h*i+l*n-c*s)/p,r[1]=2*(l*o+h*s+c*i-a*n)/p,r[2]=2*(c*o+h*n+a*s-l*i)/p):(r[0]=2*(a*o+h*i+l*n-c*s),r[1]=2*(l*o+h*s+c*i-a*n),r[2]=2*(c*o+h*n+a*s-l*i)),Ume(t,e,r),t}const eFe=C();function mk(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Vme(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(r*r+i*i+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+h*h),t}function tFe(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function rFe(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,_=n*h,v=o*h,w=a*l,T=a*c,x=a*h,S=i[0],O=i[1],A=i[2];return t[0]=(1-(y+v))*S,t[1]=(f+x)*S,t[2]=(m-T)*S,t[3]=0,t[4]=(f-x)*O,t[5]=(1-(p+v))*O,t[6]=(_+w)*O,t[7]=0,t[8]=(m+T)*A,t[9]=(_-w)*A,t[10]=(1-(p+y))*A,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function iFe(t,e,r,i,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,_=o*h,v=o*p,w=a*p,T=l*c,x=l*h,S=l*p,O=i[0],A=i[1],P=i[2],I=s[0],V=s[1],k=s[2],B=(1-(_+w))*O,z=(m+S)*O,Z=(y-x)*O,W=(m-S)*A,H=(1-(f+w))*A,Y=(v+T)*A,M=(y+x)*P,D=(v-T)*P,N=(1-(f+_))*P;return t[0]=B,t[1]=z,t[2]=Z,t[3]=0,t[4]=W,t[5]=H,t[6]=Y,t[7]=0,t[8]=M,t[9]=D,t[10]=N,t[11]=0,t[12]=r[0]+I-(B*I+W*V+M*k),t[13]=r[1]+V-(z*I+H*V+D*k),t[14]=r[2]+k-(Z*I+Y*V+N*k),t[15]=1,t}function sFe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-p-y,t[1]=h+w,t[2]=f-v,t[3]=0,t[4]=h-w,t[5]=1-c-y,t[6]=m+_,t[7]=0,t[8]=f+v,t[9]=m-_,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zme(t,e,r,i,s,n,o){const a=1/(r-e),l=1/(s-i),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+i)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function nFe(t,e,r,i,s){const n=1/Math.tan(e/2);let o;return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(i-s),t[10]=(s+i)*o,t[14]=2*s*i*o):(t[10]=-1,t[14]=-2*i),t}function oFe(t,e,r,i){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function kme(t,e,r,i,s,n,o){const a=1/(e-r),l=1/(i-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(s+i)*l,t[14]=(o+n)*c,t[15]=1,t}function x5(t,e,r,i){const s=e[0],n=e[1],o=e[2];let a=s-r[0],l=n-r[1],c=o-r[2];const h=Wa();if(Math.abs(a)<h&&Math.abs(l)<h&&Math.abs(c)<h)return void wh(t);let p=1/Math.sqrt(a*a+l*l+c*c);a*=p,l*=p,c*=p;const f=i[0],m=i[1],y=i[2];let _=m*c-y*l,v=y*a-f*c,w=f*l-m*a;p=Math.sqrt(_*_+v*v+w*w),p?(p=1/p,_*=p,v*=p,w*=p):(_=0,v=0,w=0);let T=l*w-c*v,x=c*_-a*w,S=a*v-l*_;p=Math.sqrt(T*T+x*x+S*S),p?(p=1/p,T*=p,x*=p,S*=p):(T=0,x=0,S=0),t[0]=_,t[1]=T,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=w,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*s+v*n+w*o),t[13]=-(T*s+x*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function Bme(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let h=s-r[0],p=n-r[1],f=o-r[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,_=c*h-a*f,v=a*p-l*h;return m=y*y+_*_+v*v,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,v*=m),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=p*v-f*_,t[5]=f*y-h*v,t[6]=h*_-p*y,t[7]=0,t[8]=h,t[9]=p,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function aFe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function lFe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function cFe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Gme(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function uFe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function hFe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function jme(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function nW(t,e){if(t===e)return!0;const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],v=t[14],w=t[15],T=e[0],x=e[1],S=e[2],O=e[3],A=e[4],P=e[5],I=e[6],V=e[7],k=e[8],B=e[9],z=e[10],Z=e[11],W=e[12],H=e[13],Y=e[14],M=e[15],D=Wa();return Math.abs(r-T)<=D*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-x)<=D*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-S)<=D*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-O)<=D*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(o-A)<=D*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-P)<=D*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(l-I)<=D*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-V)<=D*Math.max(1,Math.abs(c),Math.abs(V))&&Math.abs(h-k)<=D*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(p-B)<=D*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(f-z)<=D*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(m-Z)<=D*Math.max(1,Math.abs(m),Math.abs(Z))&&Math.abs(y-W)<=D*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(_-H)<=D*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(v-Y)<=D*Math.max(1,Math.abs(v),Math.abs(Y))&&Math.abs(w-M)<=D*Math.max(1,Math.abs(w),Math.abs(M))}function oW(t){const e=Wa(),r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}function T5(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const dFe=si,pFe=Gme;Object.freeze(Object.defineProperty({__proto__:null,add:cFe,adjoint:Z5e,copy:$s,determinant:Y5e,equals:nW,exactEquals:jme,frob:lFe,fromQuat:sFe,fromQuat2:K5e,fromRotation:cu,fromRotationTranslation:Ume,fromRotationTranslationScale:rFe,fromRotationTranslationScaleOrigin:iFe,fromScaling:J5e,fromTranslation:yR,fromXRotation:Nme,fromYRotation:Q5e,fromZRotation:Fme,frustum:zme,getRotation:tFe,getScaling:Vme,getTranslation:mk,hasIdentityRotation:T5,identity:wh,invert:bn,invertOrIdentity:GS,isOrthoNormal:oW,lookAt:x5,mul:dFe,multiply:si,multiplyScalar:uFe,multiplyScalarAndAdd:hFe,ortho:kme,perspective:nFe,perspectiveFromFieldOfView:oFe,rotate:lc,rotateX:H2,rotateY:w5,rotateZ:q2,scale:b5,set:Xf,str:aFe,sub:pFe,subtract:Gme,targetTo:Bme,translate:Sl,transpose:_c},Symbol.toStringTag,{value:"Module"}));let z6,te=null;function Hme(){return!!te}function fFe(){return!!oe("esri-wasm")}function qme(){return z6||(z6=ae(()=>import("./pe-wasm-39d814a9.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>kr(`esri/geometry/support/${e}`)})).then(t=>{Xme(t)}),z6)}var gk,xs,yk;(function(t){function e(n,o,a){te.ensureCache.prepare();const l=I1(a),c=a===l,h=te.ensureFloat64(l),p=te._pe_geog_to_proj(te.getPointer(n),o,h);return p&&A0(a,o,h,c),p}function r(n,o,a,l){switch(l){case xs.PE_TRANSFORM_P_TO_G:return i(n,o,a);case xs.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){te.ensureCache.prepare();const c=I1(a),h=a===c,p=te.ensureFloat64(c),f=te._pe_proj_to_geog_center(te.getPointer(n),o,p,l);return f&&A0(a,o,p,h),f}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=s})(gk||(gk={})),function(t){function e(){t.PE_BUFFER_MAX=te.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=te.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=te.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=te.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=te.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=te.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=te.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=te.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=te.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=te.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=te.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=te.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=te.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=te.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=te.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=te.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=te.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=te.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=te.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=te.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=te.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=te.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=te.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=te.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=te.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=te.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=te.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=te.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=te.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=te.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(xs||(xs={})),function(t){const e={},r={},i=m=>{if(m){const y=m.getType();switch(y){case xs.PE_TYPE_GEOGCS:m=te.castObject(m,te.PeGeogcs);break;case xs.PE_TYPE_PROJCS:m=te.castObject(m,te.PeProjcs);break;case xs.PE_TYPE_GEOGTRAN:m=te.castObject(m,te.PeGeogtran);break;default:y&xs.PE_TYPE_UNIT&&(m=te.castObject(m,te.PeUnit))}}return m};function s(){te.PeFactory.prototype.initialize(null)}function n(m){return o(xs.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(y)))_=v[y];else{const w=te.PeFactory.prototype.factoryByType(m,y);te.compare(w,te.NULL)||(_=w,v[y]=_)}return _=i(_),_}function a(m,y){let _=null,v=r[m];if(v||(v={},r[m]=v),v.hasOwnProperty(y))_=v[y];else{const w=te.PeFactory.prototype.fromString(m,y);te.compare(w,te.NULL)||(_=w,v[y]=_)}return _=i(_),_}function l(m){return o(xs.PE_TYPE_GEOGCS,m)}function c(m){return o(xs.PE_TYPE_GEOGTRAN,m)}function h(m){return te.PeFactory.prototype.getCode(m)}function p(m){return o(xs.PE_TYPE_PROJCS,m)}function f(m){return o(xs.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=h,t.projcs=p,t.unit=f}(yk||(yk={}));let Wme=null;var WD,_k,vk,bk,XD,wk,ZD,YD,xk;function Xme(t){function e(n,o,a){n[o]=a(n[o])}te=t,xs.init(),WD.init(),XD.init(),ZD.init(),YD.init(),Wme=class extends te.PeGCSExtent{destroy(){te.destroy(this)}};const r=[te.PeDatum,te.PeGeogcs,te.PeGeogtran,te.PeObject,te.PeParameter,te.PePrimem,te.PeProjcs,te.PeSpheroid,te.PeUnit];for(const n of r)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(xs.PE_NAME_MAX))});for(const n of[te.PeGeogtran,te.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(xs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=te.getValue(l,"*");a[c]=h?te.wrapPointer(h,te.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(te.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return A0(a,o,n.call(this)),a}),e(te.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=te._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!te.compare(l,te.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=te.getPointer(l);for(let p=1;p<c;p++)a.push(te.wrapPointer(h+o*p,te.PeGTlistExtendedGTs))}}return a}});const i=te._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!te.compare(l,te.NULL)){a=[l];const c=l.getNump();if(c>1){const h=te.getPointer(l);for(let p=1;p<c;p++)a.push(te.wrapPointer(h+i*p,te.PeHorizon))}}return o.set(n,a),a};e(te.PeProjcs.prototype,"horizonGcsGenerate",s),e(te.PeProjcs.prototype,"horizonPcsGenerate",s),te.PeObject.prototype.toString=function(n=xs.PE_STR_OPTS_NONE){te.ensureCache.prepare();const o=te.getPointer(this),a=te.ensureInt8(new Array(xs.PE_BUFFER_MAX));return te.UTF8ToString(te._pe_object_to_string_ext(o,n,a))}}function rm(t){if(!t)return;const e=te.getClass(t);if(!e)return;const r=te.getCache(e);if(!r)return;const i=te.getPointer(t);i&&delete r[i]}function CP(t,e){const r=[],i=new Array(e);for(let s=0;s<t;s++)r.push(te.ensureInt8(i));return r}function I1(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function A0(t,e,r,i=!1){if(i)for(let s=0;s<2*e;s++)t[s]=te.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=te.getValue(r,"double"),t[n][1]=te.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=te.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=te._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let h=null;const p=new te.PeInteger(c);try{const f=te.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=te.getPointer(f);for(let y=1;y<c;y++)h.push(te.wrapPointer(m+e*y,te.PeGTlistExtendedEntry))}}finally{te.destroy(p)}return h}t.init=r,t.getGTlist=i})(WD||(WD={})),function(t){function e(r){if(r&&r.length){for(const i of r)rm(i),i.getEntries().forEach(s=>{rm(s);const n=s.getGeogtran();rm(n),n.getParameters().forEach(rm),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{rm(o);const a=o.getDatum();rm(a),rm(a.getSpheroid()),rm(o.getPrimem()),rm(o.getUnit())})});te.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(_k||(_k={})),function(t){function e(r,i,s,n,o){te.ensureCache.prepare();const a=I1(s),l=s===a,c=te.ensureFloat64(a);let h=0;n&&(h=te.ensureFloat64(n));const p=te._pe_geog_to_geog(te.getPointer(r),i,c,h,o);return p&&A0(s,i,c,l),p}t.geogToGeog=e}(vk||(vk={})),function(t){const e=(c,h,p,f,m,y)=>{let _,v;switch(te.ensureCache.prepare(),c){case"dd":_=te._pe_geog_to_dd,v=xs.PE_DD_MAX;break;case"ddm":_=te._pe_geog_to_ddm,v=xs.PE_DDM_MAX;break;case"dms":_=te._pe_geog_to_dms,v=xs.PE_DMS_MAX}let w=0;h&&(w=te.getPointer(h));const T=I1(f),x=te.ensureFloat64(T),S=CP(p,v),O=_(w,p,x,m,te.ensureInt32(S));if(O)for(let A=0;A<p;A++)y[A]=te.UTF8ToString(S[A]);return O},r=(c,h,p,f,m)=>{let y;switch(te.ensureCache.prepare(),c){case"dd":y=te._pe_dd_to_geog;break;case"ddm":y=te._pe_ddm_to_geog;break;case"dms":y=te._pe_dms_to_geog}let _=0;h&&(_=te.getPointer(h));const v=f.map(S=>te.ensureString(S)),w=te.ensureInt32(v),T=te.ensureFloat64(new Array(2*p)),x=y(_,p,w,T);return x&&A0(m,p,T),x};function i(c,h,p,f,m){return e("dms",c,h,p,f,m)}function s(c,h,p,f){return r("dms",c,h,p,f)}function n(c,h,p,f,m){return e("ddm",c,h,p,f,m)}function o(c,h,p,f){return r("ddm",c,h,p,f)}function a(c,h,p,f,m){return e("dd",c,h,p,f,m)}function l(c,h,p,f){return r("dd",c,h,p,f)}t.geogToDms=i,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(bk||(bk={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=te.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=te.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=te.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,h){te.ensureCache.prepare();let p=0;s&&(p=te.getPointer(s));const f=I1(o),m=te.ensureFloat64(f),y=CP(n,xs.PE_MGRS_MAX),_=te.ensureInt32(y),v=te._pe_geog_to_mgrs_extended(p,n,m,a,l,c,_);if(v)for(let w=0;w<n;w++)h[w]=te.UTF8ToString(y[w]);return v}function i(s,n,o,a,l){te.ensureCache.prepare();let c=0;s&&(c=te.getPointer(s));const h=o.map(y=>te.ensureString(y)),p=te.ensureInt32(h),f=te.ensureFloat64(new Array(2*n)),m=te._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&A0(l,n,f),m}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(XD||(XD={})),function(t){function e(i,s,n,o,a,l,c){te.ensureCache.prepare();let h=0;i&&(h=te.getPointer(i));const p=I1(n),f=te.ensureFloat64(p),m=CP(s,xs.PE_MGRS_MAX),y=te.ensureInt32(m),_=te._pe_geog_to_usng(h,s,f,o,a,l,y);if(_)for(let v=0;v<s;v++)c[v]=te.UTF8ToString(m[v]);return _}function r(i,s,n,o){te.ensureCache.prepare();let a=0;i&&(a=te.getPointer(i));const l=n.map(f=>te.ensureString(f)),c=te.ensureInt32(l),h=te.ensureFloat64(new Array(2*s)),p=te._pe_usng_to_geog(a,s,c,h);return p&&A0(o,s,h),p}t.geogToUsng=e,t.usngToGeog=r}(wk||(wk={})),function(t){function e(){t.PE_UTM_OPTS_NONE=te.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=te.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=te.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){te.ensureCache.prepare();let c=0;s&&(c=te.getPointer(s));const h=I1(o),p=te.ensureFloat64(h),f=CP(n,xs.PE_UTM_MAX),m=te.ensureInt32(f),y=te._pe_geog_to_utm(c,n,p,a,m);if(y)for(let _=0;_<n;_++)l[_]=te.UTF8ToString(f[_]);return y}function i(s,n,o,a,l){te.ensureCache.prepare();let c=0;s&&(c=te.getPointer(s));const h=o.map(y=>te.ensureString(y)),p=te.ensureInt32(h),f=te.ensureFloat64(new Array(2*n)),m=te._pe_utm_to_geog(c,n,p,a,f);return m&&A0(l,n,f),m}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(ZD||(ZD={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=te.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=te.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=te.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=te.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=te.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=r,t.generate=i}(YD||(YD={})),function(t){function e(){return te.PeVersion.prototype.version_string()}t.versionString=e}(xk||(xk={}));const mFe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return gk},get PeDefs(){return xs},get PeFactory(){return yk},get PeGCSExtent(){return Wme},get PeGTTransformations(){return vk},get PeGTlistExtended(){return WD},get PeGTlistExtendedEntry(){return _k},get PeNotationDms(){return bk},get PeNotationMgrs(){return XD},get PeNotationUsng(){return wk},get PeNotationUtm(){return ZD},get PePCSInfo(){return YD},get PeVersion(){return xk},_init:Xme,get _pe(){return te},isLoaded:Hme,isSupported:fFe,load:qme},Symbol.toStringTag,{value:"Module"})),f2t=Math.PI/180,m2t=/SPHEROID\[([^\]]+)]/i,cy=ir.radius,zh=ir.eccentricitySquared,gFe={a1:cy*zh,a2:cy*zh*cy*zh,a3:cy*zh*zh/2,a4:cy*zh*cy*zh*2.5,a5:cy*zh+cy*zh*zh/2,a6:1-zh},g2t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:ir.radius,f:ir.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Sg.radius,f:Sg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:_f.radius,f:_f.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:_f.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let AP=0,k6=class Tk{static fromGE(e){const r=new Tk;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=AP++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=AP++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=AP++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=AP++}getInverse(){const e=new Tk;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},JD=class WC{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new WC;let i="";for(const s of e.steps){const n=k6.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof k6?this.steps.push(r):this.steps.push(new k6({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new WC;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[WC.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[WC.cacheKey(e,r)];return s===void 0?null:s}};function Zme(t,e,r){if(e==null||r==null||r.vcsWkid||wn(e,r))return null;const i=sO(e)/sO(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>yFe(s,i);case"polyline":case"esriGeometryPolyline":return s=>vFe(s,i);case"polygon":case"esriGeometryPolygon":return s=>_Fe(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>bFe(s,i);case"extent":case"esriGeometryEnvelope":return s=>wFe(s,i);default:return null}}function yFe(t,e){t&&t.z!=null&&(t.z*=e)}function _Fe(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function vFe(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function bFe(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function wFe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let qd=null,g_=null,dA=null,BI={};const Yme=new G4;function S5(){return!!qd&&Hme()}function fO(t){return dA==null&&(dA=Promise.all([qme(),ae(()=>import("./geometryEngineBase-91f379ee.js"),[]).then(e=>e.g),ae(()=>import("./hydrated-7f3fca6d.js"),[])])),dA.then(([,e,{hydratedAdapter:r}])=>{Jt(t),g_=r,qd=e.default,qd._enableProjection(mFe),Yme.notify()})}function mw(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:Sk(g_,t,t[0].spatialReference,e,r,i):Sk(g_,[t],t.spatialReference,e,r,i)[0]}function Sk(t,e,r,i,s=null,n=null){if(r==null||i==null)return e;if(If(r,i,s))return e.map(o=>aW(o,r,i));if(s==null){const o=JD.cacheKey(r,i);BI[o]!==void 0?s=BI[o]:((s=Qme(r,i,void 0))==null&&(s=new JD),BI[o]=s)}if(qd==null||t==null)throw new E5;return n!=null?qd._project(t,e,r,i,s,n):qd._project(t,e,r,i,s)}function xFe(t,e){const r=Jme([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function Jme(t,e){if(!S5()){for(const r of t)if(r!=null&&!wn(r.spatialReference,e)&&ra(r.spatialReference)&&ra(e)&&!If(r.spatialReference,e))return Xt(Yme),{pending:fO(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:wn(r.spatialReference,e)?r:ra(r.spatialReference)&&ra(e)?Kme(r,e):null)}}function Qme(t,e,r=null){if(t==null||e==null)return null;if(qd==null||g_==null)throw new E5;const i=qd._getTransformation(g_,t,e,r,r==null?void 0:r.spatialReference);return i!==null?JD.fromGE(i):null}function TFe(t,e,r=null){if(qd==null||g_==null)throw new E5;const i=qd._getTransformationBySuitability(g_,t,e,r,r==null?void 0:r.spatialReference);if(i!==null){const s=[];for(const n of i)s.push(JD.fromGE(n));return s}return[]}class E5 extends U{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var q;function SFe(){qd=null,g_=null,dA=null,BI={}}(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(q||(q={}));const EFe={get loadPromise(){return dA}};function Kme(t,e){try{const r=mw(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=Zme(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof E5))throw r;return null}}function If(t,e,r){return!r&&(!!wn(t,e)||ra(t)&&ra(e)&&!!hW(t,e,pW))}async function ege(t,e,r,i){if(S5())return _J(i);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(!If(s,n,o))return fO(i)}else if(!If(t,e,r))return fO(i);return _J(i)}function CFe(t,e){switch(hW(t,e,pW)){case Ai:return"copy3";case G0:return"wgs84ToSphericalECEF";case Nb:return"wgs84ToWebMercator";case B0:return"wgs84ToPlateCarree";case H0:return"wgs84ToWGS84ECEF";case hb:return"webMercatorToWGS84";case dge:return"webMercatorToSphericalECEF";case pge:return"webMercatorToWGS84ECEF";case fge:return"webMercatorToPlateCarree";case q0:return"wgs84ECEFToWGS84";case _ge:return"wgs84ECEFToSphericalECEF";case vge:return"wgs84ECEFToWebMercator";case j0:return"sphericalECEFToWGS84";case gge:return"sphericalECEFToWebMercator";case Rk:return"sphericalMarsPCPFToMars2000";case Ok:return"sphericalMoonPCPFToMoon2000";case yge:return"sphericalECEFToWGS84ECEF";case Ak:return"mars2000ToSphericalPCPF";case Ck:return"moon2000ToSphericalPCPF";default:return null}}function aW(t,e,r){return t?"x"in t?rge(t,e,new pt,r,0):"xmin"in t?age(t,e,new yr,r,0):"rings"in t?oge(t,e,new Hd,r,0):"paths"in t?sge(t,e,new r5,r,0):"points"in t?ige(t,e,new lR,r,0):null:null}function tge(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&rge(t,t.spatialReference,e,r,i)!=null}function rge(t,e,r,i,s){Fr[0]=t.x,Fr[1]=t.y;const n=t.z;return Fr[2]=n!==void 0?n:s,oi(Fr,e,0,Fr,i,0,1)?(r.x=Fr[0],r.y=Fr[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=Fr[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function AFe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&ige(t,t.spatialReference,e,r,i)!=null}function ige(t,e,r,i,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!oi(h,e,0,h,i,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function OFe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&sge(t,t.spatialReference,e,r,i)!=null}function sge(t,e,r,i,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];return uge(n,o??!1,a??!1,e,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function RFe({hasZ:t,spatialReference:e,paths:r},i,s=0){const n=Lf(e,jS),o=lh[n][q.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(Fr,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const p=[0,0,s];o(a(h),0,p,0),c.push(p)}i.push(c)}return!0}function PFe({hasZ:t,spatialReference:e,rings:r},i,s=0){const n=Lf(e,jS),o=lh[n][q.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(Fr,l[0],l[1],s);for(const l of r){const c=[];for(const h of l){const p=[0,0,s];o(a(h),0,p,0),c.push(p)}i.push(c)}return!0}function nge(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&oge(t,t.spatialReference,e,r,i)!=null}function oge(t,e,r,i,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];return uge(n,o??!1,a??!1,e,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function MFe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&age(t,t.spatialReference,e,r,i)!=null}function age(t,e,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=t;return Ek(n,o,c?t.zmin:s,e,Fr,i)?(r.xmin=Fr[0],r.ymin=Fr[1],c&&(r.zmin=Fr[2]),Ek(a,l,c?t.zmax:s,e,Fr,i)?(r.xmax=Fr[0],r.ymax=Fr[1],c&&(r.zmax=Fr[2]),h&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function Rg(t,e,r){if(e==null||r==null)return null;const i=new pt({spatialReference:r});return oi(t,e,0,Fr,r,0,1)?(i.x=Fr[0],i.y=Fr[1],i.z=Fr[2],i):null}function lW(t,e,r){return oi(t,e,0,Fr,r.spatialReference,0,1)?(r.x=Fr[0],r.y=Fr[1],r.z=Fr[2],r):null}function yo(t,e,r,i=0){Fr[0]=t.x,Fr[1]=t.y;const s=t.z;return Fr[2]=s!==void 0?s:i,oi(Fr,t.spatialReference,0,e,r,0,1)}function Ek(t,e,r,i,s,n){return rs[0]=t,rs[1]=e,rs[2]=r,oi(rs,i,0,s,n,0,1)}function Gs(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(rs[0]=t[0],rs[1]=t[1],rs[2]=0,t=rs),oi(t,e,0,r,i,0,1))}function lge(t,e){Fr[0]=t.x,Fr[1]=t.y;const r=t.z;return Fr[2]=r!==void 0?r:0,cge(Fr,t.spatialReference,e)}function cge(t,e,r){return $Fe(t,e,r)}function $Fe(t,e,r){if(e==null)return!1;const i=Lf(e,jS),s=lh[i][q.WGS84_COMPARABLE_LON_LAT];return s!=null&&(s(t,0,rs,0),r!==rs&&(r[0]=rs[0],r[1]=rs[1],r.length>2&&(r[2]=rs[2])),!0)}function oi(t,e,r,i,s,n,o=1){const a=hW(e,s,pW);if(a==null)return!1;if(a===Ai){if(t===i&&r===n)return!0;const c=r+3*o;for(let h=r,p=n;h<c;h++,p++)i[p]=t[h];return!0}const l=r+3*o;for(let c=r,h=n;c<l;c+=3,h+=3)a(t,c,i,h);return!0}function IFe(t,e,r,i,s){re(Fr,t),le(OP,t,e),Gs(Fr,r,Fr,s),Gs(OP,r,OP,s),he(i,OP,Fr),ge(i,i)}function uge(t,e,r,i,s,n,o=0){const a=new Array;for(const c of t)for(const h of c)a.push(h[0],h[1],e?h[2]:o);if(!oi(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of t){const h=new Array;for(const p of c)e&&r?h.push([a[l++],a[l++],a[l++],p[3]]):e?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function LFe(t,e,r,i){if(e==null||i==null)return!1;const s=bge(e,i,BFe);if(s.projector===Ai)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(s.projector==null)return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===q.WEB_MERCATOR){const a=lh[n.spatialReferenceId][q.WGS84];return a!=null&&(a(t,0,wd,0),Nb(wd,0,r,0),r[3]=cK(wd[1],t[2],t[3],ir.radius),!0)}if(n.spatialReferenceId!==q.WGS84&&n.spatialReferenceId!==q.CGCS2000||o.spatialReferenceId!==q.PLATE_CARREE){s.projector(t,0,r,0);const a=n.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=lh[n.spatialReferenceId][q.SPHERICAL_ECEF],l=lh[q.SPHERICAL_ECEF][q.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=cK(t[1],t[2],t[3],ir.radius)),s.projector(t,0,r,0),r[3]=c}return!0}function cK(t,e,r,i){const s=i+e;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(Fd*t)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function _R(t,e,r,i){return t!=null&&(wn(e,i)?(Eg(r,t),!0):(rs[0]=t[0],rs[1]=t[1],rs[2]=0,!!oi(rs,e,0,rs,i,0,1)&&(r[0]=rs[0],r[1]=rs[1],rs[0]=t[2],rs[1]=t[3],rs[2]=0,!!oi(rs,e,0,rs,i,0,1)&&(r[2]=rs[0],r[3]=rs[1],!0))))}function DFe(t,e,r,i){if(e==null||i==null)return!1;const s=Lf(e,jS),n=Lf(i,wge);if(s===n&&s!==q.UNKNOWN||wn(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===q.SPHERICAL_ECEF){const o=Ee(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/ir.radius;if(n===q.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===q.WGS84||n===q.CGCS2000){const c=pA;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===q.PLATE_CARREE){if(n===q.WGS84||n===q.CGCS2000)return r[0]=pA,r[1]=pA,r[2]=1,!0;if(n===q.WEB_MERCATOR){const o=t[1]/ir.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function bl(t,e,r,i){if(t==null||i==null)return!1;const s=Lf(t,jS),n=Lf(i,wge);if(s===n&&!uK(n)&&(s!==q.UNKNOWN||wn(t,i)))return yR(r,e),!0;if(uK(n)){const o=lh[s][q.LON_LAT],a=lh[q.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,wd,0),a(wd,0,uy,0),cW(Fd*wd[0],Fd*wd[1],r),r[12]=uy[0],r[13]=uy[1],r[14]=uy[2],!0)}if((n===q.WEB_MERCATOR||n===q.PLATE_CARREE)&&(s===q.WGS84||s===q.CGCS2000&&n===q.PLATE_CARREE||s===q.SPHERICAL_ECEF||s===q.WEB_MERCATOR)){const o=lh[s][q.LON_LAT],a=lh[q.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,wd,0),a(wd,0,uy,0),s===q.SPHERICAL_ECEF?hge(Fd*wd[0],Fd*wd[1],r):wh(r),r[12]=uy[0],r[13]=uy[1],r[14]=uy[2],!0)}return!1}function uK(t){return t===q.SPHERICAL_ECEF||t===q.SPHERICAL_MARS_PCPF||t===q.SPHERICAL_MOON_PCPF}function cW(t,e,r){const i=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function hge(t,e,r){return cW(t,e,r),_c(r,r),r}function Lf(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=qa(t,1)),t.wkt===Yhe.wkt?e.spatialReferenceId=q.SPHERICAL_ECEF:tO(t)?e.spatialReferenceId=q.WGS84:Ab(t)?e.spatialReferenceId=q.WEB_MERCATOR:rO(t)?e.spatialReferenceId=q.PLATE_CARREE:t.wkt===Jhe.wkt?e.spatialReferenceId=q.WGS84_ECEF:t.wkid===ih.CGCS2000?e.spatialReferenceId=q.CGCS2000:t.wkt===JH.wkt?e.spatialReferenceId=q.SPHERICAL_MARS_PCPF:t.wkt===QH.wkt?e.spatialReferenceId=q.SPHERICAL_MOON_PCPF:Hf(t)?e.spatialReferenceId=q.GCSMARS2000:qf(t)?e.spatialReferenceId=q.GCSMOON2000:e.spatialReferenceId=q.UNKNOWN):q.UNKNOWN}function Ai(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function hb(t,e,r,i){r[i++]=W2*(t[e++]/ir.radius),r[i++]=W2*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/ir.radius))),r[i]=t[e]}function dge(t,e,r,i){hb(t,e,r,i),G0(r,i,r,i)}function pge(t,e,r,i){hb(t,e,r,i),H0(r,i,r,i)}function C5(t,e,r,i,s){const n=.4999999*Math.PI,o=ye(Fd*t[e+1],-n,n),a=Math.sin(o);r[i++]=Fd*t[e]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function Nb(t,e,r,i){C5(t,e,r,i,ir)}const hK=ir.radius*Math.PI/180,pA=180/(ir.radius*Math.PI);function B0(t,e,r,i){r[i]=t[e]*hK,r[i+1]=t[e+1]*hK,r[i+2]=t[e+2]}function Y1(t,e,r,i){r[i]=t[e]*pA,r[i+1]=t[e+1]*pA,r[i+2]=t[e+2]}function fge(t,e,r,i){hb(t,e,r,i),B0(r,i,r,i)}function NFe(t,e,r,i){q0(t,e,r,i),B0(r,i,r,i)}function FFe(t,e,r,i){j0(t,e,r,i),B0(r,i,r,i)}function UFe(t,e,r,i){Y1(t,e,r,i),G0(r,i,r,i)}function VFe(t,e,r,i){Y1(t,e,r,i),Nb(r,i,r,i)}function zFe(t,e,r,i){Y1(t,e,r,i),H0(r,i,r,i)}function y_(t){if(t==null)return!1;const e=Lf(t,jS);return!!lh[e][q.WGS84_COMPARABLE_LON_LAT]}function mge(t,e,r,i){const s=Math.cos(r);t[0]=Math.cos(e)*s*i,t[1]=Math.sin(e)*s*i,t[2]=Math.sin(r)*i}function uW(t,e,r,i,s){const n=s+t[e+2],o=Fd*t[e+1],a=Fd*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function Ck(t,e,r,i){uW(t,e,r,i,Sg.radius)}function Ak(t,e,r,i){uW(t,e,r,i,_f.radius)}function G0(t,e,r,i){uW(t,e,r,i,ir.radius)}function A5(t,e,r,i,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=mh(a/(l===0?1:l)),h=Math.atan2(o,n);r[i++]=W2*h,r[i++]=W2*c,r[i]=l-s}function Ok(t,e,r,i){A5(t,e,r,i,Sg.radius)}function Rk(t,e,r,i){A5(t,e,r,i,_f.radius)}function j0(t,e,r,i){A5(t,e,r,i,ir.radius)}function gge(t,e,r,i){j0(t,e,r,i),Nb(r,i,r,i)}function yge(t,e,r,i){j0(t,e,r,i),H0(r,i,r,i)}function kFe(t,e,r,i,s){const n=Fd*t[e],o=Fd*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(n),r[i++]=(h+a)*c*Math.sin(n),r[i++]=(h*(1-s.eccentricitySquared)+a)*l}function H0(t,e,r,i){kFe(t,e,r,i,ir)}function q0(t,e,r,i){const s=gFe,n=t[e],o=t[e+1],a=t[e+2];let l,c,h,p,f,m,y,_,v,w,T,x,S,O,A,P,I,V,k,B,z;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),B=Math.atan2(o,n),m=a*a/p,y=c/p,O=s.a2/f,A=s.a3-s.a4/f,y>.3?(_=l/f*(1+y*(s.a1+O+m*A)/f),k=Math.asin(_),w=_*_,v=Math.sqrt(1-w)):(v=h/f*(1-m*(s.a5-O-y*A)/f),k=Math.acos(v),w=1-v*v,_=Math.sqrt(w)),T=1-ir.eccentricitySquared*w,x=ir.radius/Math.sqrt(T),S=s.a6*x,O=h-x*v,A=l-S*_,I=v*O+_*A,P=v*A-_*O,V=P/(S/T+I),k+=V,z=I+P*V/2,a<0&&(k=-k),r[i++]=W2*B,r[i++]=W2*k,r[i]=z}function _ge(t,e,r,i){q0(t,e,r,i),G0(r,i,r,i)}function vge(t,e,r,i){q0(t,e,r,i),Nb(r,i,r,i)}const lh={[q.WGS84]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Ai,[q.WGS84_COMPARABLE_LON_LAT]:Ai,[q.SPHERICAL_ECEF]:G0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Nb,[q.PLATE_CARREE]:B0,[q.WGS84]:Ai,[q.WGS84_ECEF]:H0},[q.CGCS2000]:{[q.CGCS2000]:Ai,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Ai,[q.WGS84_COMPARABLE_LON_LAT]:Ai,[q.SPHERICAL_ECEF]:G0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:B0,[q.WGS84]:null,[q.WGS84_ECEF]:H0},[q.GCSMARS2000]:{[q.CGCS2000]:null,[q.GCSMARS2000]:Ai,[q.GCSMOON2000]:null,[q.LON_LAT]:Ai,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:Ak,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.GCSMOON2000]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:Ai,[q.LON_LAT]:Ai,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:Ck,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.WEB_MERCATOR]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:hb,[q.WGS84_COMPARABLE_LON_LAT]:hb,[q.SPHERICAL_ECEF]:dge,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Ai,[q.PLATE_CARREE]:fge,[q.WGS84]:hb,[q.WGS84_ECEF]:pge},[q.WGS84_ECEF]:{[q.CGCS2000]:q0,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:q0,[q.WGS84_COMPARABLE_LON_LAT]:q0,[q.SPHERICAL_ECEF]:_ge,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:vge,[q.PLATE_CARREE]:NFe,[q.WGS84]:q0,[q.WGS84_ECEF]:Ai},[q.SPHERICAL_ECEF]:{[q.CGCS2000]:j0,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:j0,[q.WGS84_COMPARABLE_LON_LAT]:j0,[q.SPHERICAL_ECEF]:Ai,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:gge,[q.PLATE_CARREE]:FFe,[q.WGS84]:j0,[q.WGS84_ECEF]:yge},[q.SPHERICAL_MARS_PCPF]:{[q.CGCS2000]:null,[q.GCSMARS2000]:Rk,[q.GCSMOON2000]:null,[q.LON_LAT]:Rk,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:Ai,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.SPHERICAL_MOON_PCPF]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:Ok,[q.LON_LAT]:Ok,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:Ai,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.UNKNOWN]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:null,[q.WGS84_COMPARABLE_LON_LAT]:null,[q.SPHERICAL_ECEF]:null,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:Ai,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:null,[q.WGS84]:null,[q.WGS84_ECEF]:null},[q.LON_LAT]:{[q.CGCS2000]:Ai,[q.GCSMARS2000]:Ai,[q.GCSMOON2000]:Ai,[q.LON_LAT]:Ai,[q.WGS84_COMPARABLE_LON_LAT]:Ai,[q.SPHERICAL_ECEF]:G0,[q.SPHERICAL_MARS_PCPF]:Ak,[q.SPHERICAL_MOON_PCPF]:Ck,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:Nb,[q.PLATE_CARREE]:B0,[q.WGS84]:Ai,[q.WGS84_ECEF]:H0},[q.WGS84_COMPARABLE_LON_LAT]:{[q.CGCS2000]:null,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Ai,[q.WGS84_COMPARABLE_LON_LAT]:Ai,[q.SPHERICAL_ECEF]:G0,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:null,[q.PLATE_CARREE]:B0,[q.WGS84]:Ai,[q.WGS84_ECEF]:H0},[q.PLATE_CARREE]:{[q.CGCS2000]:Y1,[q.GCSMARS2000]:null,[q.GCSMOON2000]:null,[q.LON_LAT]:Y1,[q.WGS84_COMPARABLE_LON_LAT]:Y1,[q.SPHERICAL_ECEF]:UFe,[q.SPHERICAL_MARS_PCPF]:null,[q.SPHERICAL_MOON_PCPF]:null,[q.UNKNOWN]:null,[q.WEB_MERCATOR]:VFe,[q.PLATE_CARREE]:Ai,[q.WGS84]:Y1,[q.WGS84_ECEF]:zFe}};function hW(t,e,r=dW()){return t==null||e==null?null:bge(t,e,r).projector}function bge(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=Lf(t,r.source),s=Lf(e,r.dest);return i===q.UNKNOWN&&s===q.UNKNOWN?wn(t,e)?r.projector=Ai:r.projector=null:r.projector=lh[i][s],r}function dW(){return{source:{spatialReference:null,spatialReferenceId:q.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:q.UNKNOWN,metersPerUnit:1},projector:Ai}}const jS={spatialReference:null,spatialReferenceId:q.UNKNOWN},wge={spatialReference:null,spatialReferenceId:q.UNKNOWN},pW=dW(),BFe=dW(),Fd=Ft(1),W2=ja(1),rs=C(),wd=C(),uy=C(),Fr=C(),OP=C(),y2t=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:y_,canProjectWithoutEngine:If,computeENUToSphericalPCPFLocalRotation:cW,computeSphericalPCPFToENULocalRotation:hge,computeTranslationToOriginAndRotation:bl,getProjectorName:CFe,getTransformation:Qme,getTransformations:TFe,initializeProjection:ege,isLoaded:S5,load:fO,localLinearScaleFactors:DFe,lonLatToSphericalPCPF:mge,lonLatToWebMercatorComparable:C5,project:mw,projectBoundingRect:_R,projectBoundingSphere:LFe,projectBuffer:oi,projectDirection:IFe,projectExtent:MFe,projectMany:Sk,projectMultipoint:AFe,projectOrLoad:xFe,projectOrLoadMany:Jme,projectPoint:tge,projectPointToVector:yo,projectPointToWGS84ComparableLonLat:lge,projectPolygon:nge,projectPolygonToWGS84ComparableLonLat:PFe,projectPolyline:OFe,projectPolylineToWGS84ComparableLonLat:RFe,projectVectorToDehydratedPoint:lW,projectVectorToPoint:Rg,projectVectorToVector:Gs,projectVectorToWGS84ComparableLonLat:cge,projectWithoutEngine:aW,projectXYZToVector:Ek,sphericalPCPFtoLonLatElevation:A5,test:EFe,tryProjectWithZConversion:Kme,unload:SFe},Symbol.toStringTag,{value:"Module"}));let Ug=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&M2(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*dK);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,dK));e++)this._items.push(this._allocator())}};const dK=1024;function ve(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function X2(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function fW(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_){return[t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_]}function xge(t,e){return new Float64Array(t,e,16)}const sn=ve();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:sn,clone:X2,create:ve,createView:xge,fromValues:fW},Symbol.toStringTag,{value:"Module"}));var cc;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(cc||(cc={}));var QD;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(QD||(QD={}));function Ni(){return[1,0,0,0,1,0,0,0,1]}function Tge(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function GFe(t,e,r,i,s,n,o,a,l){return[t,e,r,i,s,n,o,a,l]}function Sge(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Tge,create:Ni,createView:Sge,fromValues:GFe},Symbol.toStringTag,{value:"Module"}));function Rh(){return[0,0,0,1]}function jFe(t){return[t[0],t[1],t[2],t[3]]}function HFe(t,e,r,i){return[t,e,r,i]}function Ege(t,e){return new Float64Array(t,e,4)}const qFe=Rh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:qFe,clone:jFe,create:Rh,createView:Ege,fromValues:HFe},Symbol.toStringTag,{value:"Module"}));function Ue(){return[0,0]}function XC(t){return[t[0],t[1]]}function cr(t,e){return[t,e]}function Cge(t){const e=Ue(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Age(t,e){return new Float64Array(t,e,2)}function Oge(){return Ue()}function Rge(){return cr(1,1)}function Pge(){return cr(1,0)}function Mge(){return cr(0,1)}const rp=Oge(),WFe=Rge(),$ge=Pge(),XFe=Mge();Object.freeze(Object.defineProperty({__proto__:null,ONES:WFe,UNIT_X:$ge,UNIT_Y:XFe,ZEROS:rp,clone:XC,create:Ue,createView:Age,fromArray:Cge,fromValues:cr,ones:Rge,unitX:Pge,unitY:Mge,zeros:Oge},Symbol.toStringTag,{value:"Module"}));function Zt(){return[0,0,0,0]}function vR(t){return[t[0],t[1],t[2],t[3]]}function Nt(t,e,r,i){return[t,e,r,i]}function mW(t){const e=Zt(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Ige(t,e){return new Float64Array(t,e,4)}function Lge(){return Zt()}function Dge(){return Nt(1,1,1,1)}function Nge(){return Nt(1,0,0,0)}function Fge(){return Nt(0,1,0,0)}function Uge(){return Nt(0,0,1,0)}function Vge(){return Nt(0,0,0,1)}const wf=Lge(),sh=Dge(),ZFe=Nge(),YFe=Fge(),JFe=Uge(),QFe=Vge();Object.freeze(Object.defineProperty({__proto__:null,ONES:sh,UNIT_W:QFe,UNIT_X:ZFe,UNIT_Y:YFe,UNIT_Z:JFe,ZEROS:wf,clone:vR,create:Zt,createView:Ige,fromArray:mW,fromValues:Nt,ones:Dge,unitW:Vge,unitX:Nge,unitY:Fge,unitZ:Uge,zeros:Lge},Symbol.toStringTag,{value:"Module"}));let HS=class Xv{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&M2(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Rw){return new Xv(16,Age,e)}static createVec3f64(e=Rw){return new Xv(24,aq,e)}static createVec4f64(e=Rw){return new Xv(32,Ige,e)}static createMat3f64(e=Rw){return new Xv(72,Sge,e)}static createMat4f64(e=Rw){return new Xv(128,xge,e)}static createQuatf64(e=Rw){return new Xv(32,Ege,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Rw=4*QD.KILOBYTES,v2t=HS.createVec2f64(),Ne=HS.createVec3f64(),gW=HS.createVec4f64();HS.createMat3f64();const yW=HS.createMat4f64(),b2t=HS.createQuatf64();function op(t){return t?{origin:Ms(t.origin),vector:Ms(t.vector)}:{origin:C(),vector:C()}}function KFe(t,e){const r=t6e.get();return r.origin=t,r.vector=e,r}function w2t(t,e=op()){return e6e(t.origin,t.vector,e)}function e6e(t,e,r=op()){return re(r.origin,t),re(r.vector,e),r}function db(t,e,r=op()){return re(r.origin,t),he(r.vector,e,t),r}function _W(t,e){const r=he(Ne.get(),e,t.origin),i=me(t.vector,r),s=me(t.vector,t.vector),n=ye(i/s,0,1),o=he(Ne.get(),ie(Ne.get(),t.vector,n),r);return me(o,o)}function x2t(t,e,r){return Pk(t,e,0,1,r)}function T2t(t,e,r){return le(r,t.origin,ie(r,t.vector,e))}function Pk(t,e,r,i,s){const{vector:n,origin:o}=t,a=he(Ne.get(),e,o),l=me(n,a)/ea(n);return ie(s,n,ye(l,r,i)),le(s,s,t.origin)}function S2t(t,e){if(kge(t,KFe(e.origin,e.direction),!1,KD)){const{tA:r,pB:i,distance2:s}=KD;if(r>=0&&r<=1)return s;if(r<0)return ho(t.origin,i);if(r>1)return ho(le(Ne.get(),t.origin,t.vector),i)}return null}function zge(t,e,r){return!!kge(t,e,!0,KD)&&(re(r,KD.pA),!0)}function kge(t,e,r,i){const n=t.origin,o=le(Ne.get(),n,t.vector),a=e.origin,l=le(Ne.get(),a,e.vector),c=Ne.get(),h=Ne.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=Ne.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(v)<1e-6)return!1;let w=(f*m-y*_)/v,T=(f+m*w)/_;r&&(w=ye(w,0,1),T=ye(T,0,1));const x=Ne.get(),S=Ne.get();return x[0]=n[0]+w*p[0],x[1]=n[1]+w*p[1],x[2]=n[2]+w*p[2],S[0]=a[0]+T*h[0],S[1]=a[1]+T*h[1],S[2]=a[2]+T*h[2],i.tA=w,i.tB=T,i.pA=x,i.pB=S,i.distance2=ho(x,S),!0}const KD={tA:0,tB:0,pA:C(),pB:C(),distance2:0},t6e=new Ug(()=>op());function kn(t){return t?pK(Ms(t.origin),Ms(t.direction)):pK(C(),C())}function pK(t,e){return{origin:t,direction:e}}function E2t(t,e){return wg(t.origin,e.origin)&&wg(t.direction,e.direction)}function uu(t,e){const r=n6e.get();return r.origin=t,r.direction=e,r}function eN(t,e=kn()){return Bge(t.origin,t.direction,e)}function r6e(t,e,r=kn()){return re(r.origin,t),he(r.direction,e,t),r}function Bge(t,e,r=kn()){return re(r.origin,t),re(r.direction,e),r}function i6e(t,e){const r=ot(Ne.get(),ge(Ne.get(),t.direction),he(Ne.get(),e,t.origin));return me(r,r)}function s6e(t,e,r){const i=me(t.direction,he(r,e,t.origin));return le(r,t.origin,ie(r,t.direction,i)),r}const n6e=new Ug(()=>kn());function fA(t,e){return me(t,e)/Ee(t)}function O5(t,e){const r=me(t,e)/(Ee(t)*Ee(e));return-xn(r)}function Gge(t,e,r){ge(RP,t),ge(B6,e);const i=me(RP,B6),s=xn(i),n=ot(RP,RP,B6);return me(n,r)<0?2*Math.PI-s:s}const RP=C(),B6=C(),jge=ys();function ys(){return Zt()}function Z2(t,e=ys()){return oh(e,t)}function Hge(t,e){return Nt(t[0],t[1],t[2],e)}function o6e(t){return t}function a6e(t){t[0]=t[1]=t[2]=t[3]=0}function R5(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function cg(t){return t[3]}function l6e(t){return t}function qge(t,e,r,i){return Nt(t,e,r,i)}function c6e(t,e,r){return t!==r&&re(r,t),r[3]=t[3]+e,r}function u6e(t,e,r){return J.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:Z2(t,r)}function D_(t,e,r){if(e==null)return!1;const{origin:i,direction:s}=e,n=h6e;n[0]=i[0]-t[0],n[1]=i[1]-t[1],n[2]=i[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(r&&(r[0]=i[0]+s[0]*h,r[1]=i[1]+s[1]*h,r[2]=i[2]+s[2]*h),!0)}const h6e=C();function Mk(t,e){return D_(t,e,null)}function d6e(t,e,r){if(D_(t,e,r))return r;const i=qS(t,e,Ne.get());return le(r,e.origin,ie(Ne.get(),e.direction,fi(e.origin,i)/Ee(e.direction))),r}function qS(t,e,r){const i=Ne.get(),s=yW.get();ot(i,e.origin,e.direction);const n=cg(t);ot(r,i,e.origin),ie(r,r,1/Ee(r)*n);const o=Zge(t,e.origin),a=O5(e.origin,r);return cu(s,a+o,i),$e(r,r,s),r}function p6e(t,e,r){return D_(t,e,r)?r:(s6e(e,t,r),Wge(t,r,r))}function Wge(t,e,r){const i=he(Ne.get(),e,t),s=ie(Ne.get(),i,t[3]/Ee(i));return le(r,s,t)}function Xge(t,e){const r=he(Ne.get(),e,t),i=ea(r),s=t[3]*t[3];return Math.sqrt(Math.abs(i-s))}function Zge(t,e){const r=he(Ne.get(),e,t),i=Ee(r),s=cg(t),n=s+Math.abs(s-i);return xn(s/n)}const G6=C();function Yge(t,e,r,i){const s=he(G6,e,t);switch(r){case cc.X:{const n=nQ(s,G6)[2];return se(i,-Math.sin(n),Math.cos(n),0)}case cc.Y:{const n=nQ(s,G6),o=n[1],a=n[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case cc.Z:return ge(i,s);default:return}}function Jge(t,e){const r=he($k,e,t);return Ee(r)-t[3]}function f6e(t,e,r,i){const s=Jge(t,e),n=Yge(t,e,cc.Z,$k),o=ie($k,n,r-s);return le(i,e,o)}function m6e(t,e){const r=ho(t,e),i=cg(t);return r<=i*i}function g6e(t,e,r=ys()){const i=fi(t,e),s=t[3],n=e[3];return i+n<s?(oh(r,t),r):i+s<n?(oh(r,e),r):(Br(r,t,e,(i+n-s)/(2*i)),r[3]=(i+s+n)/2,r)}const $k=C(),P5=ys(),y6e=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:jge,altitudeAt:Jge,angleToSilhouette:Zge,axisAt:Yge,clear:a6e,closestPoint:p6e,closestPointOnSilhouette:qS,containsPoint:m6e,copy:Z2,create:ys,distanceToSilhouette:Xge,elevate:c6e,fromCenterAndRadius:Hge,fromRadius:R5,fromValues:qge,getCenter:l6e,getRadius:cg,intersectRay:D_,intersectRayClosestSilhouette:d6e,intersectsRay:Mk,projectPoint:Wge,setAltitudeAt:f6e,setExtent:u6e,tmpSphere:P5,union:g6e,wrap:o6e},Symbol.toStringTag,{value:"Module"}));function Y2(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function _6e(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,r,i,s),t}function C2t(t,e,r){r=r||t;const i=me(t,e);se(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),ge(r,r)}function A2t(t,e,r){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),ot(r,t,e),ge(e,e),ot(e,r,t),ge(r,r)}function PP(t,e,r,i,s,n){const o=t+(e-t)*s;return o+(r+(i-r)*s-o)*n}function v6e(t,e,r,i=C()){const s=Ee(t),n=Ee(e),o=me(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),h=l/n*Math.sin(r*a);return ie(J1,t,c),ie(Q1,e,h),le(i,J1,Q1)}return Br(i,t,e,r)}function O2t(t,e,r,i=C(),s=C()){const n=Ee(t),o=Ee(e),a=me(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),p=Math.sin((1-r)*l),f=(1-r)*n+r*o;{const m=f/c,y=m/o*h;ie(J1,t,m/n*p),ie(Q1,e,y),le(i,J1,Q1)}{const m=1/n*(-Math.cos((1-r)*l)*l*f+p*(-n+o));ie(J1,t,m);const y=1/o*(Math.cos(r*l)*l*f+h*(-n+o));ie(Q1,e,y),le(s,J1,Q1),ie(s,s,1/c)}return s}return Br(i,t,e,r),he(s,e,t),ge(s,s),s}function GI(t,e,r){t=ge(J1,t),e=ge(Q1,e);const i=xn(me(t,e));if(r){const s=ot(b6e,t,e);if(me(s,r)<0)return-i}return i}function jI(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const s=t[i-1][0],n=t[i][0],o=(n-r)/(n-s);return o*t[i-1][1]+(1-o)*t[i][1]}}function R2t(t,e,r,i){he(fK,e,t),he(mK,r,t),ot(i,fK,mK),ge(i,i),i[3]=-me(t,i)}const fK=C(),mK=C(),b6e=C(),J1=C(),Q1=C();function Mr(t=ZC){return[t[0],t[1],t[2],t[3]]}function w6e(t=ZC[0],e=ZC[1],r=ZC[2],i=ZC[3]){return vW(t,e,r,i,gW.get())}function M5(t,e){return vW(e[0],e[1],e[2],e[3],t)}function vW(t,e,r,i,s=Mr()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Qge(t,e,r){return re(r,t),r[3]=e,r}function bR(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Qo(t,e,r,i=Mr()){const s=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=h*y,i[1]=p*y,i[2]=f*y,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Kge(t,e,r,i,s){const n=t.length/3;if(n<3)return!1;se(xE,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;se(Pw,t[l],t[l+1],t[l+2]),o++,a=!ia(xE,Pw)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;se(L1,t[l],t[l+1],t[l+2]),o++,he(MP,xE,Pw),ge(MP,MP),he($P,Pw,L1),ge($P,$P),a=!ia(xE,L1)&&!ia(Pw,L1)&&Math.abs(me(MP,$P))<x6e}return a?(Qo(xE,Pw,L1,e),!0):(r!==0||i!==1||s!==2)&&Kge(t,e,0,1,2)}const x6e=.99619469809,xE=C(),Pw=C(),L1=C(),MP=C(),$P=C();function Ik(t,e,r){return e!==t&&M5(t,e),t[3]=-me(t,r),t}function Lk(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function mO(t,e,r,i){return ot(L1,e,t),bR(r,L1,i)}function P2t(t,e,r,i){return $5(t,e,he(Ne.get(),r,e),O6e,i)}function gw(t,e,r){return e!=null&&$5(t,e.origin,e.direction,R6e,r)}function T6e(t,e,r){return $5(t,e.origin,e.vector,xf.NONE,r)}function S6e(t,e,r){return $5(t,e.origin,e.vector,xf.CLAMP,r)}function eye(t,e){return pi(t,e)>=0}function E6e(t,e){const r=me(t,e.ray.direction),i=-pi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function C6e(t,e){const r=me(t,e.ray.direction),i=-pi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function A6e(t,e,r){const i=ie(Ne.get(),t,-t[3]),s=Dk(t,he(Ne.get(),e,i),Ne.get());return le(r,s,i),r}function Dk(t,e,r){const i=ie(Ne.get(),t,me(t,e));return he(r,e,i),r}function pi(t,e){return me(t,e)+t[3]}function $5(t,e,r,i,s){const n=me(t,r);if(n===0)return!1;let o=-(me(t,e)+t[3])/n;return i&xf.CLAMP&&(o=ye(o,0,1)),!(!(i&xf.INFINITE_MIN)&&o<0||!(i&xf.INFINITE_MAX)&&o>1)&&(le(s,e,ie(s,r,o)),!0)}function M2t(t){return t}const ZC=[0,0,1,0];var xf;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(xf||(xf={}));const O6e=xf.INFINITE_MIN|xf.INFINITE_MAX,R6e=xf.INFINITE_MAX,j6=J.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let P6e=class{constructor(){this.plane=Mr(),this.origin=C(),this.basis1=C(),this.basis2=C()}};const tye=P6e;function Vg(t=dye){return{plane:Mr(t.plane),origin:Ms(t.origin),basis1:Ms(t.basis1),basis2:Ms(t.basis2)}}function M6e(t,e,r){const i=G6e.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=w6e(0,0,0,0),I5(i),i}function yw(t,e=Vg()){return bW(t.origin,t.basis1,t.basis2,e)}function $6e(t,e){re(e.origin,t.origin),re(e.basis1,t.basis1),re(e.basis2,t.basis2),M5(e.plane,t.plane)}function bW(t,e,r,i=Vg()){return re(i.origin,t),re(i.basis1,e),re(i.basis2,r),I5(i),k6e(i,"fromValues()"),i}function I5(t){mO(t.basis2,t.basis1,t.origin,t.plane)}function rye(t,e,r){t!==r&&yw(t,r);const i=ie(Ne.get(),Pg(t),e);return le(r.origin,r.origin,i),r.plane[3]-=e,r}function I6e(t,e,r){return iye(e,r),rye(r,SW(t,t.origin),r),r}function iye(t,e=Vg()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return se(e.origin,t[0]+r,t[1]+i,0),se(e.basis1,r,0,0),se(e.basis2,0,i,0),vW(0,0,1,0,e.plane),e}function wW(t,e,r){return!!gw(t.plane,e,r)&&uye(t,r)}function L6e(t,e,r){if(wW(t,e,r))return r;const i=sye(t,e,Ne.get());return le(r,e.origin,ie(Ne.get(),e.direction,fi(e.origin,i)/Ee(e.direction))),r}function sye(t,e,r){const i=tN.get();hye(t,e,i,tN.get());let s=Number.POSITIVE_INFINITY;for(const n of CW){const o=EW(t,n,L5.get()),a=Ne.get();if(T6e(i,o,a)){const l=Ng(Ne.get(),e.origin,a),c=Math.abs(xn(me(e.direction,l)));c<s&&(s=c,re(r,a))}}return s===Number.POSITIVE_INFINITY?nye(t,e,r):r}function nye(t,e,r){if(wW(t,e,r))return r;const i=tN.get(),s=tN.get();hye(t,e,i,s);let n=Number.POSITIVE_INFINITY;for(const o of CW){const a=EW(t,o,L5.get()),l=Ne.get();if(S6e(i,a,l)){const c=i6e(e,l);if(!eye(s,l))continue;c<n&&(n=c,re(r,l))}}return xW(t,e.origin)<n&&oye(t,e.origin,r),r}function oye(t,e,r){const i=A6e(t.plane,e,Ne.get()),s=Pk(gK(t,t.basis1),i,-1,1,Ne.get()),n=Pk(gK(t,t.basis2),i,-1,1,Ne.get());return he(r,le(Ne.get(),s,n),t.origin),r}function aye(t,e,r){const{origin:i,basis1:s,basis2:n}=t,o=he(Ne.get(),e,i),a=fA(s,o),l=fA(n,o),c=fA(Pg(t),o);return se(r,a,l,c)}function xW(t,e){const r=aye(t,e,Ne.get()),{basis1:i,basis2:s}=t,n=Ee(i),o=Ee(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function D6e(t,e){return Math.sqrt(xW(t,e))}function N6e(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of CW){const s=EW(t,i,L5.get()),n=_W(s,e);n>r&&(r=n)}return Math.sqrt(r)}function TW(t,e){return eye(t.plane,e)&&uye(t,e)}function F6e(t,e,r,i){return z6e(t,r,i)}function SW(t,e){const r=-t.plane[3];return fA(Pg(t),e)-r}function U6e(t,e,r,i){const s=SW(t,e),n=ie(B6e,Pg(t),r-s);return le(i,e,n),i}function lye(t,e){return ia(t.basis1,e.basis1)&&ia(t.basis2,e.basis2)&&ia(t.origin,e.origin)}function cye(t,e,r){return t!==r&&yw(t,r),bn(Mw,e),_c(Mw,Mw),$e(r.basis1,t.basis1,Mw),$e(r.basis2,t.basis2,Mw),$e(r.plane,t.plane,Mw),$e(r.origin,t.origin,e),Ik(r.plane,r.plane,r.origin),r}function V6e(t,e,r,i){return t!==i&&yw(t,i),cu(H6,e,r),$e(i.basis1,t.basis1,H6),$e(i.basis2,t.basis2,H6),I5(i),i}function Pg(t){return t.plane}function z6e(t,e,r){switch(e){case cc.X:re(r,t.basis1),ge(r,r);break;case cc.Y:re(r,t.basis2),ge(r,r);break;case cc.Z:re(r,Pg(t))}return r}function uye(t,e){const r=he(Ne.get(),e,t.origin),i=ea(t.basis1),s=ea(t.basis2),n=me(t.basis1,r),o=me(t.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function gK(t,e){const r=L5.get();return re(r.origin,t.origin),re(r.vector,e),r}function EW(t,e,r){const{basis1:i,basis2:s,origin:n}=t,o=ie(Ne.get(),i,e.origin[0]),a=ie(Ne.get(),s,e.origin[1]);le(r.origin,o,a),le(r.origin,r.origin,n);const l=ie(Ne.get(),i,e.direction[0]),c=ie(Ne.get(),s,e.direction[1]);return ie(r.vector,le(l,l,c),2),r}function k6e(t,e){Math.abs(me(t.basis1,t.basis2)/(Ee(t.basis1)*Ee(t.basis2)))>1e-6&&j6.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(me(t.basis1,Pg(t)))>1e-6&&j6.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-me(Pg(t),t.origin)-t.plane[3])>1e-6&&j6.warn(e,"Plane offset is not consistent with plane origin")}function hye(t,e,r,i){const s=Pg(t);mO(s,e.direction,e.origin,r),mO(r,s,e.origin,i)}const dye={plane:Mr(),origin:Ae(0,0,0),basis1:Ae(1,0,0),basis2:Ae(0,1,0)},tN=new Ug(Mr),L5=new Ug(op),B6e=C(),G6e=new Ug(()=>Vg()),CW=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Mw=ve(),H6=ve(),j6e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:tye,UP:dye,altitudeAt:SW,axisAt:F6e,closestPoint:nye,closestPointOnSilhouette:sye,copy:yw,copyWithoutVerify:$6e,create:Vg,distance:D6e,distance2:xW,distanceToSilhouette:N6e,elevate:rye,equals:lye,extrusionContainsPoint:TW,fromAABoundingRect:iye,fromValues:bW,intersectRay:wW,intersectRayClosestSilhouette:L6e,normal:Pg,projectPoint:oye,projectPointLocal:aye,rotate:V6e,setAltitudeAt:U6e,setExtent:I6e,transform:cye,updateUnboundedPlane:I5,wrap:M6e},Symbol.toStringTag,{value:"Module"})),H6e=new Ge(Yhe),yK=new Ge(JH),_K=new Ge(QH),I2t=new Ge(Jhe);function Df(t){return t&&(Hf(t)||wn(t,yK))?yK:t&&(qf(t)||wn(t,_K))?_K:H6e}function q6e(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function W6e(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function X6e(t){return{operations:t,value:t.create()}}function pye(t,e,r=X6e(t)){return r.operations=t,t.copy(e,r.value),r}function Z6e(t){return pye(y6e,qge(0,0,0,Dr(t).radius))}const vK=2**50;function Y6e(){return pye(j6e,bW([0,0,0],[vK,0,0],[0,vK,0]))}function J6e(t,e,r){return t.operations.axisAt(t.value,e,cc.Z,r)}function Q6e(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function K6e(t,e,r){return t.operations.intersectRay(t.value,e,r)}function eUe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function tUe(t,e){return t.operations.altitudeAt(t.value,e)}function fye(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function rUe(t,e,r,i){return e!==i&&$s(i,e),se($w,i[12],i[13],i[14]),fye(t,$w,r,$w),i[12]=$w[0],i[13]=$w[1],i[14]=$w[2],i}function q6(t,e,r){return t.operations.elevate(t.value,e,r.value)}const $w=C();function bK(t,e,r,i,s){return s[0]=me(t,e),s[1]=me(t,r),s[2]=me(t,i),s}function Nk(t,e,r,i,s){re(r,t),re(IP,e),ge(IP,IP),ot(i,IP,r),ot(s,i,r)}function iUe(t,e){return t?Df(e):e.isGeographic?Ge.PlateCarree:e}const IP=C(),AW=96;function L2t(t,e){const r=e||t.extent,i=t.width,s=qa(r&&r.spatialReference);return r&&i?r.width/i*s*KH*AW:0}function sUe(t,e){return t/(qa(e)*KH*AW)}function nUe(t){return t/(KH*AW)}const oUe="OBJECTID";let J2=class extends uA{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(J.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};J2=u([R("esri.support.AnalysesCollection")],J2);const HI={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},W6={xsmall:544,small:768,medium:992,large:1200};function aUe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function X6(t,e){return e?HI[t].valueToClassName[e].split(" "):[]}const lUe=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new Pi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=W6}initialize(){this._breakpointsHandles.add(ue(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Vr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Pe(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=aUe(r);if(!i){const s=JSON.stringify(W6,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:W6,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=rc.acquire(),i=rc.acquire();let s,n=!1;for(s in HI){const o=this[s],a=HI[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,X6(s,o).forEach(l=>i.push(l)),X6(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),rc.release(r),rc.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in HI)X6(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([d()],e.prototype,"breakpoints",null),u([d()],e.prototype,"orientation",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),u([d()],e.prototype,"heightBreakpoint",void 0),e=u([R("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var cUe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},D1={exports:{}},qs={},gO={exports:{}},_w={};function mye(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function uUe(t,e,r){}function hUe(t,e,r){}var dUe=/javascript\s*\:/img;function pUe(t,e){return dUe.test(e)?"":e}_w.whiteList=mye();_w.getDefaultWhiteList=mye;_w.onAttr=uUe;_w.onIgnoreAttr=hUe;_w.safeAttrValue=pUe;var fUe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},TE=fUe;function mUe(t,e){t=TE.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,s=0,n=0,o="";function a(){if(!i){var h=TE.trim(t.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=TE.trim(h.slice(0,p)),m=TE.trim(h.slice(p+1));if(f){var y=e(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<r;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return TE.trim(o)}var gUe=mUe,LP=_w,yUe=gUe;function wK(t){return t==null}function _Ue(t){var e={};for(var r in t)e[r]=t[r];return e}function gye(t){t=_Ue(t||{}),t.whiteList=t.whiteList||LP.whiteList,t.onAttr=t.onAttr||LP.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||LP.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||LP.safeAttrValue,this.options=t}gye.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=yUe(t,function(l,c,h,p,f){var m=i[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var v=s(h,p,_);return wK(v)?h+":"+p:v}else{var v=n(h,p,_);if(!wK(v))return v}}});return a};var vUe=gye;(function(t,e){var r=_w,i=vUe;function s(o,a){var l=new i(a);return l.process(o)}e=t.exports=s,e.FilterCSS=i;for(var n in r)e[n]=r[n]})(gO,gO.exports);var OW={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,s;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,s=t.length;i<s;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},bUe=gO.exports.FilterCSS,wUe=gO.exports.getDefaultWhiteList,rN=OW;function yye(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var _ye=new bUe;function xUe(t,e,r){}function TUe(t,e,r){}function SUe(t,e,r){}function EUe(t,e,r){}function vye(t){return t.replace(AUe,"&lt;").replace(OUe,"&gt;")}function CUe(t,e,r,i){if(r=Eye(r),e==="href"||e==="src"){if(r=rN.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(DP.lastIndex=0,DP.test(r))return""}else if(e==="style"){if(xK.lastIndex=0,xK.test(r)||(TK.lastIndex=0,TK.test(r)&&(DP.lastIndex=0,DP.test(r))))return"";i!==!1&&(i=i||_ye,r=i.process(r))}return r=Cye(r),r}var AUe=/</g,OUe=/>/g,RUe=/"/g,PUe=/&quot;/g,MUe=/&#([a-zA-Z0-9]*);?/gim,$Ue=/&colon;?/gim,IUe=/&newline;?/gim,DP=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,xK=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,TK=/u\s*r\s*l\s*\(.*/gi;function bye(t){return t.replace(RUe,"&quot;")}function wye(t){return t.replace(PUe,'"')}function xye(t){return t.replace(MUe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function Tye(t){return t.replace($Ue,":").replace(IUe," ")}function Sye(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return rN.trim(e)}function Eye(t){return t=wye(t),t=xye(t),t=Tye(t),t=Sye(t),t}function Cye(t){return t=bye(t),t=vye(t),t}function LUe(){return""}function DUe(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:rN.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return rN.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function NUe(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var s=t.indexOf("-->",i);if(s===-1)break;r=s+3}return e}function FUe(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}qs.whiteList=yye();qs.getDefaultWhiteList=yye;qs.onTag=xUe;qs.onIgnoreTag=TUe;qs.onTagAttr=SUe;qs.onIgnoreTagAttr=EUe;qs.safeAttrValue=CUe;qs.escapeHtml=vye;qs.escapeQuote=bye;qs.unescapeQuote=wye;qs.escapeHtmlEntities=xye;qs.escapeDangerHtml5Entities=Tye;qs.clearNonPrintableCharacter=Sye;qs.friendlyAttrValue=Eye;qs.escapeAttrValue=Cye;qs.onIgnoreTagStripAll=LUe;qs.StripTagBody=DUe;qs.stripCommentTag=NUe;qs.stripBlankChar=FUe;qs.cssFilter=_ye;qs.getDefaultCSSWhiteList=wUe;var D5={},_0=OW;function UUe(t){var e=_0.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=_0.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function VUe(t){return t.slice(0,2)==="</"}function zUe(t,e,r){var i="",s=0,n=!1,o=!1,a=0,l=t.length,c="",h="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){i+=r(t.slice(s,a)),n=a,s=a;continue}if(p===">"){i+=r(t.slice(s,n)),h=t.slice(n,a+1),c=UUe(h),i+=e(n,i.length,c,h,VUe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=t.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<t.length&&(i+=r(t.substr(s))),i}var kUe=/[^a-zA-Z0-9\\_:.-]/gim;function BUe(t,e){var r=0,i=0,s=[],n=!1,o=t.length;function a(f,m){if(f=_0.trim(f),f=f.replace(kUe,"").toLowerCase(),!(f.length<1)){var y=e(f,m||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),h,p;if(n===!1&&c==="="){n=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:jUe(t,l+1);continue}if(n!==!1&&l===i){if(p=t.indexOf(c,l+1),p===-1)break;h=_0.trim(t.slice(i+1,p)),a(n,h),n=!1,l=p,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(p=GUe(t,l),p===-1){h=_0.trim(t.slice(r,l)),a(h),n=!1,r=l+1;continue}else{l=p-1;continue}else if(p=HUe(t,l-1),p===-1){h=_0.trim(t.slice(r,l)),h=SK(h),a(n,h),n=!1,r=l+1;continue}else continue}return r<t.length&&(n===!1?a(t.slice(r)):a(n,SK(_0.trim(t.slice(r))))),_0.trim(s.join(" "))}function GUe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function jUe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function HUe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function qUe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function SK(t){return qUe(t)?t.substr(1,t.length-2):t}D5.parseTag=zUe;D5.parseAttr=BUe;var WUe=gO.exports.FilterCSS,xd=qs,Aye=D5,XUe=Aye.parseTag,ZUe=Aye.parseAttr,qI=OW;function NP(t){return t==null}function YUe(t){var e=qI.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=qI.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=qI.trim(t.slice(0,-1))),{html:t,closing:r}}function JUe(t){var e={};for(var r in t)e[r]=t[r];return e}function QUe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function Oye(t){t=JUe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=xd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=QUe(t.whiteList||t.allowList):t.whiteList=xd.whiteList,t.onTag=t.onTag||xd.onTag,t.onTagAttr=t.onTagAttr||xd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||xd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||xd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||xd.safeAttrValue,t.escapeHtml=t.escapeHtml||xd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new WUe(t.css))}Oye.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=e.cssFilter;r.stripBlankChar&&(t=xd.stripBlankChar(t)),r.allowCommentTag||(t=xd.stripCommentTag(t));var p=!1;r.stripIgnoreTagBody&&(p=xd.StripTagBody(r.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=XUe(t,function(m,y,_,v,w){var T={sourcePosition:m,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(i,_)},x=s(_,v,T);if(!NP(x))return x;if(T.isWhite){if(T.isClosing)return"</"+_+">";var S=YUe(v),O=i[_],A=ZUe(S.html,function(P,I){var V=qI.indexOf(O,P)!==-1,k=o(_,P,I,V);return NP(k)?V?(I=l(_,P,I,h),I?P+'="'+I+'"':P):(k=a(_,P,I,V),NP(k)?void 0:k):k});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return x=n(_,v,T),NP(x)?c(v):x},c);return p&&(f=p.remove(f)),f};var KUe=Oye;(function(t,e){var r=qs,i=D5,s=KUe;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(D1,D1.exports);var e8e=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):D1.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!r?s=e:e&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new D1.exports.FilterXSS(s)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?D1.exports.escapeAttrValue(e):!n&&!s?D1.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,s):D1.exports.safeAttrValue(e,r,i,s)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(cUe(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],h=i.validate(c,r);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const N5=new Map;function Rye(){N5.clear()}function t8e(t){return N5.get(t)}function r8e(t,e){N5.set(t,e)}function Z6(t){N5.delete(t)}var Fb,Q2,i8e=function(t){if("WebkitTransition"in t.style)Fb="webkitTransitionEnd",Q2="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");Fb="transitionend",Q2="animationend"}},Pye=function(t){Fb||i8e(t)},s8e=function(t,e){return e===void 0&&(e=t+"-active"),function(r){Pye(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(Fb,s),r.removeEventListener(Q2,s),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(Fb,s),r.addEventListener(Q2,s),requestAnimationFrame(function(){r.classList.add(e)})}},n8e=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){Pye(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(Fb,n),r.removeEventListener(Q2,n),i())};r.classList.add(t),r.addEventListener(Fb,n),r.addEventListener(Q2,n),requestAnimationFrame(function(){r.classList.add(e)})}};const o8e=J.getLogger("esri.widgets.support.widgetUtils");function a8e(t){const e=rc.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const r=e.join(" ");return rc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{var s;Rye();for(const n of i)(s=t.get(n.target))==null||s(n)}),r=(i,s,n)=>(t.has(i)&&o8e.error("Already observing element",i),t.set(i,s),e.observe(i,n),Ba(()=>{e.unobserve(i),t.delete(i)}));return(i,s,n)=>{let o=null;return ue(()=>typeof i=="function"?i():i,a=>{o==null||o.remove(),a&&(o=r(a,s,n))},Cs)}})();function l8e(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function N2t(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function F2t(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function U2t(t,e){return(t==="enter"?s8e:n8e)(e)}const c8e=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],u8e=c8e.reduce((t,e)=>(t[e]=[],t),{}),h8e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Mye=new e8e({whiteList:u8e,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(h8e.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function d8e(t){return t==="Enter"||t===" "}const $ye="http://www.w3.org/",F5=`${$ye}2000/svg`,Iye=`${$ye}1999/xlink`;let EK=[],RW=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},PW=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Lye=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},p8e=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(PW(t[i],e))return i}return-1},Y6=(t,e,r,i)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(PW(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},f8e=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},Fk=[],Uk=!1,Dye=t=>{(t.children||[]).forEach(Dye),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},CK=()=>{Uk=!1,Fk.forEach(Dye),Fk.length=0},AK=t=>{Fk.push(t),Uk||(Uk=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(CK,{timeout:16}):setTimeout(CK,16))},OK=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),AK(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),AK(t))},m8e=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")Vk(t,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(Lye(m),r.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):r.namespace===F5?a==="href"?t.setAttributeNS(Iye,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=Mye.sanitize(l):Nye(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function Nye(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let iN,g8e=(t,e,r)=>{if(e)for(let i of e)UT(i,t,void 0,r)},Fye=(t,e,r)=>{g8e(t,e.children,r),e.text&&(t.textContent=e.text),m8e(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},UT=(t,e,r,i)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(s,r):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(i=RW(i,{namespace:F5})),i.namespace!==void 0?s=t.domNode=a.createElementNS(i.namespace,p):(s=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(s,r):s.parentNode!==e&&e.appendChild(s)),n=l+1}}Fye(s,t,i)}},Vk=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},y8e=(t,e,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],h=e[l];if(l==="class")h!==c&&(Vk(t,h,!1),Vk(t,c,!0));else if(l==="classes"){let p=t.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let _=f[y],v=!!c[_];v!==!!h[_]&&(s=!0,v?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],_=c[y];_!==h[y]&&(s=!0,_?(Lye(_),i.styleApplyer(t,y,_)):i.styleApplyer(t,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==h)&&(t[l]=c,t["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&i.eventHandlerInterceptor||(i.namespace===F5?l==="href"?t.setAttributeNS(Iye,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=Mye.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):Nye(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}return s},_8e=(t,e,r,i,s)=>{if(r===i)return!1;i=i||EK;let n,o=(r=r||EK).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?r[l]:void 0,f=i[c];if(p!==void 0&&PW(p,f))h=iN(p,f,s)||h,l++;else{let m=p8e(r,f,l+1);if(m>=0){for(n=l;n<m;n++)OK(r[n]),Y6(r,n,t,"removed");h=iN(r[m],f,s)||h,l=m+1}else UT(f,e,l<o?r[l].domNode:void 0,s),f8e(f),Y6(i,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)OK(r[n]),Y6(r,n,t,"removed");return h};iN=(t,e,r)=>{let i=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,s=!0,s}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=RW(r,{namespace:F5})),t.text!==e.text&&(n=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,n=_8e(e,i,t.children,e.children,r)||n,n=y8e(i,t.properties,e.properties,r)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),s};let SE=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,iN(i,r,e)},domNode:t.domNode});const v8e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let Wx=t=>RW(v8e,t),W0={create:(t,e)=>(e=Wx(e),UT(t,document.createElement("div"),void 0,e),SE(t,e)),append:(t,e,r)=>(r=Wx(r),UT(e,t,void 0,r),SE(e,r)),insertBefore:(t,e,r)=>(r=Wx(r),UT(e,t.parentNode,t,r),SE(e,r)),merge:(t,e,r)=>(r=Wx(r),e.domNode=t,Fye(t,e,r),SE(e,r)),replace:(t,e,r)=>(r=Wx(r),UT(e,t.parentNode,t,r),t.parentNode.removeChild(t),SE(e,r))},Uye,b8e=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};Uye=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let w8e=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?Uye(r.children,s=>s.domNode===i):void 0}),r},x8e=(t,e,r)=>{let i=function(s){r("domEvent",s);let n=e(),o=b8e(s.currentTarget,n.domNode);o.reverse();let a,l=w8e(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},RK=t=>{let e,r,i=Wx(t),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,_=()=>y;i.eventHandlerInterceptor=x8e(e,_,s),y=p(f,m(),i),a.push(y),l.push(m)},h=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(p,f)=>{c(W0.append,p,f)},insertBefore:(p,f)=>{c(W0.insertBefore,p,f)},merge:(p,f)=>{c(W0.merge,p,f)},replace:(p,f)=>{c(W0.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},Zy=class extends xe{constructor(){super(...arguments),this.items=new Mt,this._watchUpdatingTracking=new bf,this._callbacks=new Map,this._projector=RK(),this._hiddenProjector=RK()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const s=()=>i.render();this._callbacks.set(i,s),this._projector.append(this.surface,s)}for(const i of r.removed){const s=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(s.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);i.append(r,n),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(n);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),s=this.computeBoundingRect(r);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],Zy.prototype,"surface",void 0),u([d({readOnly:!0})],Zy.prototype,"items",void 0),u([d({readOnly:!0})],Zy.prototype,"needsRender",null),u([d({readOnly:!0})],Zy.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],Zy.prototype,"updating",null),Zy=u([R("esri.views.overlay.ViewOverlay")],Zy);const PK=Zy,J6=[0,0];function T8e(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return J6[0]=r.left+((e==null?void 0:e.pageXOffset)??0),J6[1]=r.top+((e==null?void 0:e.pageYOffset)??0),J6}function MK(t){t&&(Ame(t),t.parentNode&&t.parentNode.removeChild(t))}function S8e(t){const e=document.createElement("div");return t.appendChild(e),e}const EE=16,FP=750,E8e=512,C8e=2,A8e=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:EE,time:FP},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([ue(()=>this.cursor,i=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",i)}),ue(()=>this.navigating,i=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([ue(()=>this.ui,(r,i)=>this._handleUIChange(r,i),Vr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Pe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),s=_5(r);if(s||typeof r!="string"||J.getLogger(this).error("#container",`element with id '${r}' not found`),i===s)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(MK(this.root),this._set("root",null)),this.userContent&&(ZQ(this.userContent,i),MK(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",ZQ(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new PK;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(ue(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=$2({render:()=>{var h;return(h=this.overlay)==null?void 0:h.render()}}):this._overlayRenderTaskHandle=Li(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){var r;(r=this.surface)==null||r.blur()}focus(){var r;(r=this.surface)==null||r.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(ue(()=>this.root,s=>{r.container=s?S8e(s):null},Vr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=EE,r.time=FP,this.addHandles([(()=>{const i=()=>{r.freq=EE,r.time=FP};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),$2({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=EE,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?EE:Math.min(FP,n.freq*C8e),!s&&n.freq>=E8e&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&T8e(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],e.prototype,"container",null),u([d({readOnly:!0})],e.prototype,"focused",null),u([d({readOnly:!0})],e.prototype,"height",void 0),u([d({type:PK})],e.prototype,"overlay",void 0),u([d({readOnly:!0})],e.prototype,"position",void 0),u([d({readOnly:!0})],e.prototype,"resizing",void 0),u([d({readOnly:!0})],e.prototype,"root",void 0),u([d({value:null,readOnly:!0})],e.prototype,"size",null),u([d({readOnly:!0})],e.prototype,"surface",void 0),u([d({readOnly:!0})],e.prototype,"suspended",void 0),u([d()],e.prototype,"ui",void 0),u([d({readOnly:!0})],e.prototype,"userContent",void 0),u([d({readOnly:!0})],e.prototype,"width",void 0),u([d()],e.prototype,"widthBreakpoint",void 0),e=u([R("esri.views.DOMContainer")],e),e},MW=J.getLogger("esri.layers.support.ElevationSampler");let Vye=class{queryElevation(e){return zye(e.clone(),this)}on(){return $8e}projectIfRequired(e,r){return kye(e,r)}},O8e=class extends Vye{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const s=e.tile.extent;this.extent=e5(s,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=qa(r.spatialReference),o=r.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return t5(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return MW.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},B2t=class extends Vye{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?e.map(o=>new O8e(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=e5(zt(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return MW.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function zye(t,e){const r=kye(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":R8e(t,r,e);break;case"polyline":P8e(t,r,e);break;case"multipoint":M8e(t,r,e)}return t}function kye(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=ow(t,e);return i||MW.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function R8e(t,e,r){t.z=r.elevationAt(e.x,e.y)}function P8e(t,e,r){cf.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];cf.x=c[0],cf.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(cf.x,cf.y)}}t.hasZ=!0}function M8e(t,e,r){cf.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];cf.x=o[0],cf.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(cf.x,cf.y)}t.hasZ=!0}const cf=new pt,$8e={remove(){}};var zk;let Bp=zk=class extends de{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new zk({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Bp.prototype,"cols",void 0),u([d({type:Yi,json:{write:!0}})],Bp.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],Bp.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Bp.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],Bp.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Bp.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],Bp.prototype,"scale",void 0),Bp=zk=u([R("esri.layers.support.LOD")],Bp);const Rd=Bp;let I8e=class{constructor(e,r,i,s,n=void 0){this.id=e,this.level=r,this.row=i,this.col=s,this.extent=n}};var Yy;const $K=new Or({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Wo=Yy=class extends de{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:s=Ge.WebMercator,numLODs:n=24}=t;if(!ra(s)){const p=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];p.push(new Rd({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift(new Rd({level:m,scale:f,resolution:f})),f*=2}return new Yy({dpi:96,lods:p,origin:new pt(0,0,s),size:[i,i],spatialReference:s})}const o=sb(s),a=t.origin?new pt({x:t.origin.x,y:t.origin.y,spatialReference:s}):new pt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(qa(s)*39.37*l),h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p],m=f*c;h.push(new Rd({level:p,scale:f,resolution:m}))}else{let p=Xhe(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(n/e);h.push(new Rd({level:0,scale:p,resolution:p*c}));for(let m=1;m<f;m++){const y=p/2**e,_=y*c;h.push(new Rd({level:m,scale:y,resolution:_})),p=y}}return new Yy({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=sb(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return pt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],s=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(n=>{i.push(n.scale),e=n.scale>e?n.scale:e,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const s=e[i],n=e[i+1];if(s<=t)return i;if(n===t)return i+1;if(s>t&&n<t)return i+Math.log(s/t)/Math.log(s/n)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=r;else if(wn(e.spatialReference,this.spatialReference))n=e.x,o=e.y,i=r;else{const c=ow(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new I8e(null,0,0,0,zt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=Yy.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===Yy.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=zt()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return Yy.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*e;r.push(new Rd({level:n.level,scale:n.scale,resolution:o}))}return new Yy({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};u([d({type:Number,json:{write:!0}})],Wo.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Wo.prototype,"dpi",void 0),u([d({type:String,json:{read:$K.read,write:$K.write,origins:{"web-scene":{read:!1,write:!1}}}})],Wo.prototype,"format",void 0),u([d({readOnly:!0})],Wo.prototype,"isWrappable",null),u([d({type:pt,json:{write:!0}})],Wo.prototype,"origin",void 0),u([Se("origin")],Wo.prototype,"readOrigin",null),u([d({type:[Rd],value:null,json:{write:!0}})],Wo.prototype,"lods",null),u([d({readOnly:!0})],Wo.prototype,"scales",void 0),u([d({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Wo.prototype,"size",void 0),u([Se("size",["rows","cols"])],Wo.prototype,"readSize",null),u([De("size",{cols:{type:Yi},rows:{type:Yi}})],Wo.prototype,"writeSize",null),u([d({type:Ge,json:{write:!0}})],Wo.prototype,"spatialReference",void 0),Wo=Yy=u([R("esri.layers.support.TileInfo")],Wo),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Wo||(Wo={}));const WI=Wo,L8e=12;let ic=class ol{constructor(e){const r=ol.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=y_(this.spatialReference)||Hf(this.spatialReference)||qf(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new ol(this.toTileInfo())}toTileInfo(){return new WI({dpi:this.dpi,origin:new pt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Rd({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=HJ(e[0]),r[1]=ED(e[1]),r[2]=HJ(e[2]),r[3]=ED(e[3])):this._isGCS&&(r[0]=Ft(e[0]),r[1]=Ft(e[1]),r[2]=Ft(e[2]),r[3]=Ft(e[3]))}getExtentGeometry(e,r,i,s=new yr){return this.getExtent(e,r,i,fp),s.spatialReference=this.spatialReference,s.xmin=fp[0],s.ymin=fp[1],s.xmax=fp[2],s.ymax=fp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof ol)){if(ol.checkUnsupported(e))return!1;e=new ol(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!s2(e.origin[0],this.origin[0],s)||!s2(e.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*L8e,s2(i,e.levels[r].resolution,s))}rootTilesInExtent(e,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;ol.computeRowColExtent(e,n,this.origin,fp);let o=fp[1],a=fp[3],l=fp[0],c=fp[2];const h=c-l,p=a-o;if(h*p>i){const f=Math.floor(Math.sqrt(i));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return r!=null&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,r,i,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-e[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-e[1]-n)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!pIe(s.resolution,i/2**s.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?$W():e.lods.length<1?new U("tilingscheme:generic","Tiling scheme must have at least one level"):ol.isPowerOfTwo(e)?ol.hasGapInLevels(e)?new U("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):ol.tileSizeSupported(e)?ol.hasOriginPerLODs(e)?new U("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new U("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new U("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],s=e[3]-e[1],n=qa(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,h=new ol(new WI({size:[a,a],origin:new pt({x:e[0]-.5*(o-i),y:e[3]+.5*(o-s)}),lods:[new Rd({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const r=new ol(ol.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const s=256/r,n=new ol(new WI({size:[r,r],origin:new pt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Rd({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function $W(){return new U("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}ic.WebMercatorAuxiliarySphereTileInfo=new WI({size:[256,256],origin:new pt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ge.WebMercator}),spatialReference:Ge.WebMercator,lods:[new Rd({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),ic.WebMercatorAuxiliarySphere=ic.makeWebMercatorAuxiliarySphere(19);const fp=zt(),VT=64,YC=512,D8e=2.5,yO=fIe(kV/10),Bye=2,Gye=zt();ic.WebMercatorAuxiliarySphere.getExtent(0,0,0,Gye);const N8e=zt([-180,-90,180,90]),F8e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",U8e="Surface extent is too large for tile resolution at level 0.",V8e=3;let z8e=V8e;function kk(t){return t<4?3:z8e}let Jy=class extends Is.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=yO}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const r=e5(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??Ge.WGS84}elevationAt(e,r){var i;if(this.extent==null||!Ra(this.extent,e,r)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return J.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return zye(e.clone(),this)}};u([d({readOnly:!0})],Jy.prototype,"demResolution",void 0),u([d({readOnly:!0})],Jy.prototype,"extent",null),u([d({readOnly:!0})],Jy.prototype,"noDataValue",void 0),u([d()],Jy.prototype,"spatialReference",null),u([d({constructOnly:!0})],Jy.prototype,"view",void 0),Jy=u([R("esri.views.support.GroundViewElevationSampler")],Jy);const k8e=Jy;let Qy=class extends xe{constructor(e){super(e),this.view=null,this.layerViews=new Mt}initialize(){this.addHandles(bh(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new k8e({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>ue(()=>e.updating,()=>this._updateUpdating(),Gr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],Qy.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],Qy.prototype,"updating",null),u([d({constructOnly:!0})],Qy.prototype,"view",void 0),u([d({type:Mt,readOnly:!0})],Qy.prototype,"layerViews",void 0),u([d({readOnly:!0})],Qy.prototype,"suspended",null),Qy=u([R("esri.views.GroundView")],Qy);const B8e=Qy;let Mg=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const s=e[i],n=new Zue(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=ahe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)bJ(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const s of r.acquired)bJ(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}};const G8e=oe("mac")?"Meta":"Ctrl",U5={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)U5[t]=String.fromCharCode(t);for(let t=1;t<25;t++)U5[111+t]=`F${t}`;for(let t=65;t<91;t++)U5[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function j8e(t){if(t.key!==void 0)return POe(t);const e=U5[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function H8e(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let q8e=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const IK=J.getLogger("esri.views.input.InputHandler");let vo=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?IK.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof e=="string"?new q8e(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new W8e(n,i,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new X8e(e,{onEmit:(i,s,n,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,s,n,o)},onRemove:i=>{var s;delete this._outgoing[i.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):IK.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const s of r)if(s.match.matches(e)&&((i=s.callback)==null||i.call(s,e),e.shouldStopPropagation()))break}}},W8e=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},X8e=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},Z8e=class extends vo{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=e;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}},Y8e=class{constructor(e,r){this._observable=new G4,this._value=e,this._equalityFunction=r}get value(){return Xt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function _O(t,e=Iue){return new Y8e(t,e)}let J8e=class extends vo{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=_O(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},$u=class extends xe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=G8e,this._latestPointerType="mouse",this._propertiesPool=new Mg({latestPointerLocation:e9e},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=r_.INTERNAL){if(this._nameToGroup[e])return void J.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void J.getLogger(this).error("Can't register a group of zero handlers");const s={name:e,handlers:r.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,h,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,h)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var s;i.removed=!0,(s=i.uninstallCallback)==null||s.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):J.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const s=this._handlers[i];s.priorityIndex=i,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)H8e(a)||r.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==r||s.y!==i){const n=this._propertiesPool.get("latestPointerLocation");n.x=r,n.y=i,this._set("latestPointerLocation",n)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const n=r;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,s=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,s)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const s=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=r.native;n("Alt",!(!o||!o.altKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Z8e((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new J8e,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],r_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,r_.INTERNAL)}_setPointerCapture(e,r,i,s){const n=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,s){this._emitInputEvent(0,e,r,i,s)}_emitInputEvent(e,r,i,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new Q8e(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new dk,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:s,priorityIndex:n}=e.events.pop(),o=s.data&&s.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[n];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((i=(r=e.currentHandler).eventCallback)==null||i.call(r,s)),s.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new dk;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const s of r.handler.incomingEventMatches){if(i.eventType!==s.eventType)continue;const n=i.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===i.keyModifiers.length!=(n.length===s.keyModifiers.length))return i.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let s=0;for(;s<r.length&&this._compareHandlerPriority(i,r[s])>=0;)s++;r.splice(s,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],$u.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],$u.prototype,"eventSource",void 0),u([d({constructOnly:!0})],$u.prototype,"recognizers",void 0),u([d()],$u.prototype,"_latestPointerType",void 0),u([d()],$u.prototype,"latestPointerType",null),u([d()],$u.prototype,"multiTouchActive",null),u([d({readOnly:!0})],$u.prototype,"latestPointerLocation",void 0),u([d()],$u.prototype,"_paused",void 0),u([d({readOnly:!0})],$u.prototype,"updating",null),$u=u([R("esri.views.input.InputManager")],$u);let Q8e=class{constructor(e,r,i,s,n){this.type=e,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=v0.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=v0.STOPPED}shouldStopPropagation(){return(this._propagationState&v0.STOPPED)!=0}async(e){this._propagationState|=v0.PAUSED;const r=(i,s)=>{this._propagationState&=~v0.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&v0.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var v0;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(v0||(v0={}));const r_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let K8e=class{};const e9e=K8e;function mp(t){return t!=null&&"open"in t&&"declaredClass"in t}function LK(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const t9e=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([ue(()=>[this.ui,this.popup],([r,i],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&mp(l)&&(l.view=null,LK(l)&&a.remove(l,n))}r&&mp(i)&&(i.view=this,LK(i)&&r.add(i,{key:n,position:o,internal:!0}))},Vr),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!mp(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(mp(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),mp(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},r_.WIDGET)]),j2(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ae(()=>import("./Popup-e3d75d5e.js").then(r=>r.a0),["assets/Popup-e3d75d5e.js","assets/unitFormatUtils-161adcd1.js","assets/AttachmentInfo-b38f46a0.js","assets/widget-60db6aca.js","assets/executeQueryJSON-d18da025.js","assets/query-dffe729f.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js"])})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){mp(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void J.getLogger(this).error(new U("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),mp(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:hV([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!mp(this.popup))return this._popupSetupTask=$S(async i=>{const{default:s}=await ae(()=>import("./Popup-e3d75d5e.js").then(o=>o.a0),["assets/Popup-e3d75d5e.js","assets/unitFormatUtils-161adcd1.js","assets/AttachmentInfo-b38f46a0.js","assets/widget-60db6aca.js","assets/executeQueryJSON-d18da025.js","assets/query-dffe729f.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js"]);if(Jt(i),!this.popup||mp(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:s!=null?s.event:void 0,signal:s!=null?s.signal:void 0,defaultPopupTemplateEnabled:s!=null&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return u([d({cast(r){return!r||mp(r)||typeof r=="object"&&(r.open=i=>(vD(J.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(vD(J.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),u([d()],e.prototype,"popupEnabled",void 0),e=u([R("esri.views.PopupView")],e),e},DK={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},r9e={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function i9e(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function pb(t,e,r){const i=new Date(t.getTime());if(e&&r){const s=r9e[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=i9e(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+e*a)}return i}function NK(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function s9e(t,e,r){return t===0?0:t*DK[e]/DK[r]}var rd;let Vc=rd=class extends de{static get allTime(){return FK}static get empty(){return n9e}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(rd.allTime)}get isEmpty(){return this.equals(rd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new rd({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=t.start!=null?t.start.getTime():t.start,s=t.end!=null?t.end.getTime():t.end;return e===i&&r===s}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=oc(this.start,i=>NK(i,t)),r=oc(this.end,i=>{const s=NK(i,t);return i.getTime()===s.getTime()?s:pb(s,1,t)});return new rd({start:e,end:r})}intersection(t){var a,l,c,h;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return rd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((h=t.end)==null?void 0:h.getTime())??1/0;let n,o;if(i>=e&&i<=r?n=i:e>=i&&e<=s&&(n=e),r>=i&&r<=s?o=r:s>=e&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const p=new rd;return p.start=n===-1/0?null:new Date(n),p.end=o===1/0?null:new Date(o),p}return rd.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new rd,{start:i,end:s}=this;return i!=null&&(r.start=pb(i,t,e)),s!=null&&(r.end=pb(s,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return FK.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new rd({start:e,end:r})}};u([d({type:Date,json:{write:{allowNull:!0}}})],Vc.prototype,"end",void 0),u([Se("end")],Vc.prototype,"readEnd",null),u([De("end")],Vc.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],Vc.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],Vc.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],Vc.prototype,"start",void 0),u([Se("start")],Vc.prototype,"readStart",null),u([De("start")],Vc.prototype,"writeStart",null),Vc=rd=u([R("esri.TimeExtent")],Vc);const FK=new Vc,n9e=new Vc({start:void 0,end:void 0}),Zf=Vc;let mA=class extends uA{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([IH({Type:vh,ensureType:Hs(vh)})],mA.prototype,"itemType",void 0),mA=u([R("esri.support.GraphicsCollection")],mA);const UK=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function o9e(t,e="system"){if(!t||!UK.has(t.timeZone))return e;const r=UK.get(t.timeZone);return l9e(t.timeZone)||t.respectsDaylightSaving?r:a9e(r)}function a9e(t){const e=mr.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${Va.instance(-r).formatOffset(0,"narrow")}`}function l9e(t){return t.startsWith("UTC")}let Ky=class extends Gi(de){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:s}=r;return{timeZone:i,respectsDaylightSaving:s}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:o9e(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};u([d()],Ky.prototype,"legacy",void 0),u([Se("legacy",["timeZone"])],Ky.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],Ky.prototype,"timeZone",void 0),u([Se("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],Ky.prototype,"readTimeZone",null),u([De("timeZone")],Ky.prototype,"writeTimeZone",null),Ky=u([R("esri.time.TimeReference")],Ky);const K2=Ky;let e0=class extends xe{constructor(e){super(e),this.view=null,this.baseLayerViews=new Mt,this.referenceLayerViews=new Mt,this._loadingHandle=ue(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},Vr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};u([d({constructOnly:!0})],e0.prototype,"view",void 0),u([d({readOnly:!0})],e0.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],e0.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],e0.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],e0.prototype,"updating",null),e0=u([R("esri.views.BasemapView")],e0);function c9e(t){return"tryRecycleWith"in t}let u9e=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=mo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,sa(this._controller.signal,()=>{const s=new U("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!c9e(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Jt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>sa(this._controller.signal,()=>h(Lr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:e}),"prefetchResources"in r&&await((s=r.prefetchResources)==null?void 0:s.call(r,{signal:e})),d9e(r))a=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new U("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(r);Jt(e),a="default"in p?new p.default({layer:r,view:i}):new p({layer:r,view:i})}const c=()=>{l=Li(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=sa(e,c),Jt(e);try{await a.when()}catch(p){throw c(),p}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new U("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new U("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}},Iu=class extends xe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new bf,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const s of r)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=mo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(RS(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,s=[],n=this.view.ready,o=p=>{if(p!=null){for(const f of p)if(f){i.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&n?m.start():m||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const p of this._rootCollectionNames)o(this.get(p));for(const[p,f]of this._layerLayerViewInfoMap)if(!i.has(p)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(s);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[p,f]of this._recyclingInfoMap)i.has(p)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy());for(const p of s)this._createLayerView(p);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(h=r==null?void 0:r.basemap)==null?void 0:h.referenceLayers,r==null?void 0:r.layers].filter(p=>!!p);i.forEach(p=>"layers"in p&&a.push(p.layers)),this.addHandles(a.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([ka(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ue(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Cs)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),x6(this._recyclingInfoMap),x6(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Lr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||$o(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(x6(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new U("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=n,a.parent=i,r.at(s)!==a&&r.splice(s,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<r.length&&r.splice(s,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new u9e(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(gs(i)||i.name==="cancelled:layerview-create")||J.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],Iu.prototype,"_workPromise",void 0),u([d({readOnly:!0})],Iu.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],Iu.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],Iu.prototype,"_rootCollectionNames",null),u([d()],Iu.prototype,"layerViewImporter",void 0),u([d()],Iu.prototype,"supportsGround",void 0),u([d({readOnly:!0})],Iu.prototype,"updating",null),u([d({readOnly:!0})],Iu.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],Iu.prototype,"view",void 0),Iu=u([R("esri.views.LayerViewManager")],Iu);const h9e=Iu;function d9e(t){return"createLayerView"in t&&t.createLayerView!=null}let $c=class extends xe{constructor(e){super(e),this.factor=1.5,this.offset=_h(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],$c.prototype,"factor",void 0),u([d({nonNullable:!0})],$c.prototype,"offset",void 0),u([d()],$c.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],$c.prototype,"size",void 0),u([d()],$c.prototype,"maskUrl",void 0),u([d()],$c.prototype,"maskEnabled",void 0),u([d()],$c.prototype,"overlayUrl",void 0),u([d()],$c.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],$c.prototype,"version",null),u([d({type:Boolean})],$c.prototype,"visible",void 0),$c=u([R("esri.views.Magnifier")],$c);const jye=$c;let p9e=class{constructor(){this._tasks=new Array,this._running=_O(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.push(new VK(s,n,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((s,n)=>this._tasks.unshift(new VK(s,n,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const s=yn(r.signal);if(s&&!r.abortCallback)r.reject(Lr());else{const n=s?(i=r.abortCallback)==null?void 0:i.call(r,Lr()):r.callback(e);pu(n)?n.then(r.resolve,r.reject):r.resolve(n)}}catch(s){r.reject(s)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=Lr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},VK=class{constructor(e,r,i,s=void 0,n=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}},JC=class extends xe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],JC.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],JC.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),JC=u([R("esri.views.support.DebugFlags")],JC);const f9e=new JC;var $r;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})($r||($r={}));function m9e(){return new sN.Scheduler}var zo,dt;(function(t){t[t.YIELD=1]="YIELD"})(zo||(zo={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(dt||(dt={}));const sf=0,zK=new Map([[dt.RESOURCE_CONTROLLER_IMMEDIATE,sf],[dt.RESOURCE_CONTROLLER,4],[dt.SLIDE,sf],[dt.STREAM_DATA_LOADER,sf],[dt.ELEVATION_QUERY,sf],[dt.TERRAIN_SURFACE,1],[dt.SURFACE_GEOMETRY_UPDATES,1],[dt.LOD_RENDERER,2],[dt.GRAPHICS_CORE,2],[dt.I3S_CONTROLLER,2],[dt.POINT_CLOUD_LAYER,2],[dt.FEATURE_TILE_FETCHER,2],[dt.OVERLAY,4],[dt.STAGE,4],[dt.GRAPHICS_DECONFLICTOR,4],[dt.FILTER_VISIBILITY,4],[dt.SCALE_VISIBILITY,4],[dt.FRUSTUM_VISIBILITY,4],[dt.CLOUDS_GENERATOR,4],[dt.POINT_OF_INTEREST_FREQUENT,6],[dt.POINT_OF_INTEREST_INFREQUENT,30],[dt.LABELER,8],[dt.FEATURE_QUERY_ENGINE,8],[dt.FEATURE_TILE_TREE,16],[dt.FEATURE_TILE_TREE_ACTIVE,sf],[dt.ELEVATION_ALIGNMENT,12],[dt.TEXT_TEXTURE_ATLAS,12],[dt.TEXTURE_UNLOAD,12],[dt.LINE_OF_SIGHT_TOOL,16],[dt.LINE_OF_SIGHT_TOOL_INTERACTIVE,sf],[dt.SNAPPING,sf],[dt.SHADOW_ACCUMULATOR,30]]);function kK(t){return zK.has(t)?zK.get(t):typeof t=="number"?t:1}const BK=6.5,GK=1,g9e=30,jK=1e3/30,HK=100,qK=.9;var sN,J_;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=_O(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new ig("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=$r.INTERACTING,this._tasks=new Bt,this._runQueue=new Bt,this._load=0,this._idleStateCallbacks=new Bt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ue(()=>f9e.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Vr);for(const o of Object.keys(dt))this.performanceInfo.tasks.set(dt[o],new ig(dt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:BK,INTERACTING_BUDGET:jK,IDLE_BUDGET:HK,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Li(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=kK(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new ig(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===$r.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===$r.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==$r.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=BK,a=n.frameDuration,l=GK;switch(this.state){case $r.IDLE:o=0,a=Math.max(HK,n.frameDuration),l=g9e;break;case $r.INTERACTING:a=Math.max(jK,n.frameDuration);case $r.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==$r.IDLE&&a<GK&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case $r.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case $r.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return J_.SCHEDULED;let o=J_.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=J_.READY:o!==J_.READY&&(o=J_.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*qK+n*(1-qK)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===sf&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==sf&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===zo.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){J.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,dt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(dt))this._frameTaskTimes.set(dt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new p9e,this._handles=new Pi,this.schedulePriority=this._basePriority,this._task=_O(a??this._queue),this._handles.add(bh(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(Fa),this._scheduler.removeTask(this),this.schedule=eS.schedule,this.reschedule=eS.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=kK(n);this._basePriority!==sf&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=$r.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(sN||(sN={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(J_||(J_={}));const Fa=(()=>{const t=new sN.Budget;return t.enabled=!1,t})();let y9e=class{remove(){}processQueue(){}schedule(e,r,i){try{if(yn(r)){const s=Lr();return i?Promise.resolve(i(s)):Promise.reject(s)}return dV(e(Fa))}catch(s){return Promise.reject(s)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const eS=new y9e;let zT=class extends xe{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(dt.TEXTURE_UNLOAD))??eS}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(s=>this._releaseTextureRequest(s)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){var o,a;const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const l=new Hye(i);l.texture=r(),(o=this._stage)==null||o.add(l.texture),(a=this._stage)==null||a.loadImmediate(l.texture),this._textureRequests.set(s,l),n=l}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.onRemove&&e.onRemove(),e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};u([d()],zT.prototype,"_frameTask",void 0),u([d()],zT.prototype,"updating",null),zT=u([R("esri.views.3d.support.TextureCollection")],zT);let Hye=class{constructor(e){this.onRemove=e,this.referenceCount=0}};var WK;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(WK||(WK={}));const qye=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Wye={};function Xye(t){return!!Wye[t]}function _9e(t){for(const e of t)if(!Xye(e))return!1;return!0}qye.forEach(t=>{Wye[t]=!0});let v9e=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,s){const n=Array.isArray(e)?e:e.split(",");if(!_9e(n))return n.some(Xye)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s??r_.DEFAULT;const l=this._createUniqueGroupName(),c=new b9e(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},b9e=class extends vo{constructor(e,r,i,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:_h(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:h,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(_h(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:p}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:ja(r.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:s}=e.data,{cancelable:n,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=e;return{type:r,x:i,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:s,native:n,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:s}=e,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:s}=e.data,{cancelable:n,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var vO,XK,ZK;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(vO||(vO={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(XK||(XK={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(ZK||(ZK={}));function w9e(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return J.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function Bk(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(vO.USER)&&t.getEditableFlag(vO.MANAGER)}function Gp(t){return _h(t.x,t.y)}function _St(t){return Zi(t.x,t.y)}function Zye(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?_h(e.clientX-r.left,e.clientY-r.top):_h(0,0)}function YK(t,e){return e instanceof Event?Zye(t,e):Gp(e)}function JK(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let x9e=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":QK(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!KK(e))break;const s=Gp(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!KK(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=oc(s,({manipulator:h})=>h),o=oc(s,({tool:h})=>h);if(n==null||o==null)break;const a=Gp(e);a.x=ye(a.x,0,r.view.width),a.y=ye(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const s=Gp(e),n=this._intersect(s,e.pointerType,r.forEachTool);if(T9e(e)||r.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=Gp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const s=Gp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=Gp(e),n=this._intersect(s,e.pointerType,r.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:Gp(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=oc(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Gp(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return $o(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),e(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=VAe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let s=null;return i(n=>{if(n.manipulators==null||!Bk(n))return!1;const o=n.manipulators.intersect(e,r);return o!=null&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(_h(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!QK(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Gp(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,s){let n=this._intersect(e,i,s);const o=oc(this._hoveredManipulators.get(r),({manipulator:a})=>a);n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function QK(t){return t==="mouse"}function KK(t){return t.pointerType!=="mouse"||t.button===0}function T9e(t){return!!t.native.shiftKey}const eee="attached",Q6="tools",S9e=1e3;let id=class extends pO{constructor(e){super(e),this._clock=iR,this._manipulatorState=new x9e,this.tools=new Mt,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(qye,e=>{this._handleInputEvent(e)},r_.TOOL),...w9e(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void J.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const s=Bk(i);this.activeTool!=null&&s||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=Li(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,S9e)}attach(){var e;this.view.type==="3d"?(this._set("textures",new zT(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ue(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r))),Ba(()=>this._set("textures",Pe(this.textures)))],eee)):this.handles.add(ue(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(eee),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(s=>{!r&&s.visible&&s.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(Q6),this._forEachTool(e=>{if(e instanceof xe){const r=ue(()=>[e.cursor,e.visible,e.editable],()=>{Bk(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,Q6)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],Q6)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,vO.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){return{setClock:e=>this._clock=e}}};u([d({constructOnly:!0,nonNullable:!0})],id.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],id.prototype,"textures",void 0),u([d({value:null})],id.prototype,"activeTool",null),u([d({readOnly:!0,type:Mt})],id.prototype,"tools",void 0),u([d({readOnly:!0})],id.prototype,"cursor",void 0),u([d({readOnly:!0})],id.prototype,"updating",null),u([d()],id.prototype,"_interacting",void 0),u([d({readOnly:!0})],id.prototype,"interacting",null),id=u([R("esri.views.ToolViewManager")],id);let Xx=class extends xe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":E9e.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return C9e[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],Xx.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],Xx.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],Xx.prototype,"axisThreshold",null),Xx=u([R("esri.views.input.gamepad.GamepadInputDevice")],Xx);const E9e=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),C9e={standard:.15,spacemouse:.025,unknown:0},IW=Xx;let QC=class extends xe{constructor(...e){super(...e),this.devices=new Mt,this.enabledFocusMode="document"}};u([d({type:Mt.ofType(IW),readOnly:!0})],QC.prototype,"devices",void 0),u([d({type:["document","view","none"]})],QC.prototype,"enabledFocusMode",void 0),QC=u([R("esri.views.input.gamepad.GamepadSettings")],QC);const A9e=QC;let XI=class extends xe{constructor(){super(...arguments),this.gamepad=new A9e}};u([d({readOnly:!0})],XI.prototype,"gamepad",void 0),XI=u([R("esri.views.input.Input")],XI);const O9e=XI;let t0=class extends xe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],t0.prototype,"enabled",void 0),u([d({type:IW})],t0.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],t0.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],t0.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],t0.prototype,"velocityFactor",void 0),t0=u([R("esri.views.navigation.gamepad.GamepadSettings")],t0);const Yye=t0;let Zv=class extends xe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Yye,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],Zv.prototype,"browserTouchPanEnabled",void 0),u([d({type:Yye,nonNullable:!0})],Zv.prototype,"gamepad",void 0),u([d({type:Boolean})],Zv.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],Zv.prototype,"mouseWheelZoomEnabled",void 0),Zv=u([R("esri.views.navigation.Navigation")],Zv);const Jye=Zv,Qye={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Kye=Object.values(Qye),e0e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Kye.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),R9e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Kye.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),P9e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function CSt(t){return!!e0e.test(t)}function vw(t){if(t==null)return null;const e=go(t),r=e.path.match(e0e)||e.path.match(R9e);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:V5(a!==-1?s.slice(a+1):s),serverType:Qye[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function M9e(t){const e=go(t).path.match(P9e);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function V5(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function t0e(t,e){const r=[];if(t){const i=vw(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=V5(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function LW(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(s);return n&&o}function $9e(t,e){return t&&Bhe(jhe(t,e))}function r0e(t){let{url:e}=t;if(!e)return{url:e};e=jhe(e,t.logger);const r=go(e),i=vw(r.path);let s;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(s=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const n=M9e(r.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:Bhe(e),layerId:s}}function i0e(t,e,r,i,s){f_(e,i,"url",s),i.url&&t.layerId!=null&&(i.url=gc(i.url,r,t.layerId.toString()))}function ASt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return r&&(i||s||n)}function OSt(t,e,r){const i=s0e(t),s=e,n=I9e(i,s,r);if(i){const o=fw.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new U("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!L9e(t)||n===Yl.Unsupported)return new U("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case Yl.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new U("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case Yl.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new U("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case Yl.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new U("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new U("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function I9e(t,e,r){if(!tee(t)||!tee(e))return Yl.Unsupported;if(t==null||e==null)return Yl.Ok;if(!r&&t.heightUnit!==e.heightUnit)return Yl.Units;if(t.heightModel!==e.heightModel)return Yl.HeightModel;switch(t.heightModel){case"gravity-related-height":return Yl.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Yl.Ok:Yl.CRS;default:return Yl.Unsupported}}var Yl;function tee(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function L9e(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!a0e(t)}function s0e(t){var i;const e=t.url?vw(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&n0e(t)&&t.heightModelInfo?t.heightModelInfo:a0e(t)?fw.deriveUnitFromSR(N9e,t.spatialReference):null}function n0e(t){return"heightModelInfo"in t}function o0e(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function a0e(t){return o0e(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):l0e(t)}function D9e(t){return t.layers!=null||l0e(t)||o0e(t)||n0e(t)}function l0e(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Yl||(Yl={}));const N9e=new fw({heightModel:"gravity-related-height"});var Ie;function ree(t){return t==="global"?Ie.Global:Ie.Local}function K6(t){return t===Ie.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Ie||(Ie={}));let Gk,eU=null;async function F9e(t){eU||(eU=ae(()=>Promise.resolve().then(()=>cat),void 0).then(e=>Gk=e)),await eU,Jt(t)}async function c0e(t,e,r,i){if(!t)return null;const s=t.spatialReference;return S5()||If(s,e)?mw(t,e):Gk?Gk.projectGeometry(t,e,r,i):(await Promise.race([F9e(i),fO(i)]),c0e(t,e,r,i))}let Vi=class extends xe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=ou(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,s,n,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(i);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(D9e(o)){const a=s0e(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)i.push({extent:l,layer:s})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),s=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=ou(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:s.clone(),task:$S(async n=>{try{const o=await c0e(i.extent,s,"portalItem"in i.layer?i.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(yn(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],s=(n,o)=>n!=null?o!=null?n===o&&n:n:o;for(const n of e)for(const o of r){if(!n.spatialReference.equals(o.spatialReference))continue;const a=s(n.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:n.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==Ie.Local)&&(e=e.filter(({viewingMode:i})=>i!==Ie.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const s of r){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(n!=null){const o=n.constraints!=null?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new U9e;for(const s of e)if(this._collectCollection(s,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{gs(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};u([d()],Vi.prototype,"required",void 0),u([d({constructOnly:!0})],Vi.prototype,"map",void 0),u([d({constructOnly:!0})],Vi.prototype,"getSpatialReferenceSupport",void 0),u([d()],Vi.prototype,"defaultSpatialReference",void 0),u([d()],Vi.prototype,"userSpatialReference",void 0),u([d()],Vi.prototype,"sourcePreloadCount",void 0),u([d()],Vi.prototype,"priorityCollection",void 0),u([d()],Vi.prototype,"requiresExtentInSpatialReference",void 0),u([d()],Vi.prototype,"suspended",void 0),u([d({readOnly:!0})],Vi.prototype,"ready",null),u([d({readOnly:!0})],Vi.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],Vi.prototype,"spatialReference",null),u([d({readOnly:!0})],Vi.prototype,"extent",null),u([d({readOnly:!0})],Vi.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Vi.prototype,"vcsWkid",null),u([d({readOnly:!0})],Vi.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],Vi.prototype,"viewingMode",null),u([d({readOnly:!0})],Vi.prototype,"tileInfo",null),u([d({readOnly:!0})],Vi.prototype,"mapCollections",null),u([d({readOnly:!0})],Vi.prototype,"_allLayers",null),u([d({readOnly:!0})],Vi.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],Vi.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],Vi.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],Vi.prototype,"_extentCandidatesTask",null),u([d()],Vi.prototype,"_extentTask",null),u([d()],Vi.prototype,"_projectExtentTask",void 0),Vi=u([R("esri.views.support.DefaultsFromMap")],Vi);let U9e=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var KC;let Pt=KC=class extends v5(Is.EventedMixin(j4(xe))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new oO({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:z9e}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new mA,this.analyses=new J2,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Mt,this.magnifier=new jye,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new K2,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new O9e,this.navigation=new Jye,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new v9e(this),this.persistableViewModels=new Mt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(ue(()=>this.preconditionsReady,e=>{var r,i;e?(this._currentSpatialReference=this.spatialReference,KC.views.add(this)):(this._currentSpatialReference=null,KC.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Gr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,j2(()=>this.ready)))),this.basemapView=new e0({view:this}),this.layerViewManager=new h9e({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new id({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ue(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ue(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ue(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([ue(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const s=Ba(()=>t=ou(t));t=$S(async n=>{try{await ZA(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}J.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(KC.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Pe(this.graphics),this.analyses=Pe(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Pe(this.analysisViewManager),this.toolViewManager=Pe(this.toolViewManager),this.layerViewManager=Pe(this.layerViewManager),this.basemapView=Pe(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=Pe(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return J.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Vi({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Tg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(J.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Tg.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!wn(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new U("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&J.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(bh(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Pt.views=new Mt,u([d()],Pt.prototype,"_userSpatialReference",void 0),u([d()],Pt.prototype,"activeTool",null),u([d({readOnly:!0})],Pt.prototype,"allLayerViews",void 0),u([d()],Pt.prototype,"groundView",void 0),u([d()],Pt.prototype,"animation",null),u([d()],Pt.prototype,"basemapView",void 0),u([d()],Pt.prototype,"center",null),u([d({readOnly:!0})],Pt.prototype,"_defaultsFromMapSettings",null),u([d()],Pt.prototype,"defaultsFromMap",null),u([d()],Pt.prototype,"fatalError",void 0),u([d({type:yr})],Pt.prototype,"extent",null),u([d(fk(mA,"graphics"))],Pt.prototype,"graphics",void 0),u([d(fk(J2,"analyses"))],Pt.prototype,"analyses",void 0),u([d({readOnly:!0,type:fw})],Pt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Pt.prototype,"interacting",null),u([d({readOnly:!0})],Pt.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Pt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Pt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:Mt,readOnly:!0})],Pt.prototype,"layerViews",void 0),u([d()],Pt.prototype,"resolution",null),u([d({type:jye})],Pt.prototype,"magnifier",void 0),u([d({value:null,type:_pe})],Pt.prototype,"map",null),u([d()],Pt.prototype,"padding",void 0),u([d({readOnly:!0})],Pt.prototype,"ready",void 0),u([d({type:Ge})],Pt.prototype,"spatialReference",null),u([d()],Pt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Pt.prototype,"stationary",null),u([d({readOnly:!0})],Pt.prototype,"supportsGround",void 0),u([d({type:Zf})],Pt.prototype,"timeExtent",void 0),u([d({type:K2,nonNullable:!0})],Pt.prototype,"timeReference",void 0),u([d()],Pt.prototype,"tools",null),u([d()],Pt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Pt.prototype,"type",void 0),u([d({type:Number})],Pt.prototype,"scale",void 0),u([d({readOnly:!0})],Pt.prototype,"updating",void 0),u([d({readOnly:!0})],Pt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Pt.prototype,"initialExtent",null),u([d()],Pt.prototype,"cursor",null),u([d({readOnly:!0})],Pt.prototype,"input",void 0),u([d({type:Jye,nonNullable:!0})],Pt.prototype,"navigation",void 0),u([d()],Pt.prototype,"layerViewManager",void 0),u([d()],Pt.prototype,"analysisViewManager",void 0),u([d()],Pt.prototype,"width",void 0),u([d()],Pt.prototype,"height",void 0),u([d({readOnly:!0})],Pt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Pt.prototype,"size",null),u([d({readOnly:!0})],Pt.prototype,"suspended",void 0),u([d({readOnly:!0})],Pt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Pt.prototype,"persistableViewModels",void 0),u([d()],Pt.prototype,"_isValid",void 0),u([d()],Pt.prototype,"_readyCycleForced",void 0),u([d()],Pt.prototype,"_currentSpatialReference",void 0),Pt=KC=u([R("esri.views.View")],Pt);const V9e=Pt;function z9e(t){return t.layerViews}let r0=class extends bD{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=mo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new U("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=pu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};u([d({readOnly:!0})],r0.prototype,"done",null),u([d({readOnly:!0,type:String})],r0.prototype,"state",void 0),u([d()],r0.prototype,"target",void 0),r0=u([R("esri.views.ViewAnimation")],r0),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(r0||(r0={}));const tS=r0,CE=()=>ae(()=>import("./TileLayerView3D-78f052dc.js"),["assets/TileLayerView3D-78f052dc.js","assets/LayerView3D-357435c1.js","assets/TiledLayerView3D-6bf5d4f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/MapServiceLayerViewHelper-b93e046a.js","assets/floorFilterUtils-080a7cd2.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/sublayerUtils-50cf2d72.js","assets/drapedUtils-f1f29289.js"]),iee=()=>ae(()=>import("./ElevationLayerView3D-80531b27.js"),["assets/ElevationLayerView3D-80531b27.js","assets/LayerView3D-357435c1.js","assets/TiledLayerView3D-6bf5d4f4.js","assets/LayerView-0086d16f.js"]),see={"base-dynamic":()=>ae(()=>import("./BaseDynamicLayerView3D-09973aa3.js"),["assets/BaseDynamicLayerView3D-09973aa3.js","assets/DynamicLayerView3D-4c2ddde0.js","assets/LayerView3D-357435c1.js","assets/projectExtentUtils-2cab06fa.js","assets/ImageMaterial-9fd43956.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),"base-elevation":iee,"base-tile":CE,"bing-maps":CE,"building-scene":()=>ae(()=>import("./BuildingSceneLayerView3D-216c7288.js"),["assets/BuildingSceneLayerView3D-216c7288.js","assets/BuildingGroupSublayer-a2c7d9b0.js","assets/BuildingComponentSublayer-1508a862.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/I3SMeshView3D-8307d11f.js","assets/I3SOverrides-4911607f.js","assets/I3SNode-027eba91.js","assets/meshFeatureSet-199a8653.js","assets/MeshGeoreferencedRelativeVertexSpace-2d15e21d.js","assets/MeshLocalVertexSpace-ff29e29f.js","assets/georeference-0b768c20.js","assets/External-d2b9d83b.js","assets/FeatureLayerView3D-19c41144.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/SceneModification-bbf6005d.js","assets/SceneLayerWorker-5fac4a39.js","assets/I3SQueryFeatureStore-cbca67be.js","assets/DefinitionExpressionSceneLayerView-835bab9b.js"]),csv:()=>ae(()=>import("./CSVLayerView3D-5c567c26.js"),["assets/CSVLayerView3D-5c567c26.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),dimension:()=>ae(()=>import("./DimensionLayerView3D-91055fca.js"),["assets/DimensionLayerView3D-91055fca.js","assets/LayerView3D-357435c1.js","assets/LayerView-0086d16f.js"]),elevation:iee,feature:()=>ae(()=>import("./FeatureLayerView3D-19c41144.js"),["assets/FeatureLayerView3D-19c41144.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),geojson:()=>ae(()=>import("./GeoJSONLayerView3D-52f243ad.js"),["assets/GeoJSONLayerView3D-52f243ad.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),graphics:()=>ae(()=>import("./GraphicsLayerView3D-25a287aa.js"),["assets/GraphicsLayerView3D-25a287aa.js","assets/LayerView3D-357435c1.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/GraphicsProcessor-3fa24682.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView-0086d16f.js"]),group:()=>ae(()=>import("./GroupLayerView-266dade0.js"),["assets/GroupLayerView-266dade0.js","assets/LayerView-0086d16f.js"]),imagery:()=>ae(()=>import("./ImageryLayerView3D-b7fc2c12.js"),["assets/ImageryLayerView3D-b7fc2c12.js","assets/DynamicLayerView3D-4c2ddde0.js","assets/LayerView3D-357435c1.js","assets/projectExtentUtils-2cab06fa.js","assets/ImageMaterial-9fd43956.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),"integrated-mesh":()=>ae(()=>import("./IntegratedMeshLayerView3D-ffa6e695.js"),["assets/IntegratedMeshLayerView3D-ffa6e695.js","assets/I3SMeshView3D-8307d11f.js","assets/I3SOverrides-4911607f.js","assets/I3SNode-027eba91.js","assets/meshFeatureSet-199a8653.js","assets/MeshGeoreferencedRelativeVertexSpace-2d15e21d.js","assets/MeshLocalVertexSpace-ff29e29f.js","assets/georeference-0b768c20.js","assets/External-d2b9d83b.js","assets/FeatureLayerView3D-19c41144.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/SceneModification-bbf6005d.js","assets/SceneLayerWorker-5fac4a39.js"]),"line-of-sight":()=>ae(()=>import("./LineOfSightLayerView3D-4aa4c20e.js"),["assets/LineOfSightLayerView3D-4aa4c20e.js","assets/LayerView3D-357435c1.js","assets/LayerView-0086d16f.js"]),"map-image":()=>ae(()=>import("./MapImageLayerView3D-b1e88c5d.js"),["assets/MapImageLayerView3D-b1e88c5d.js","assets/DynamicLayerView3D-4c2ddde0.js","assets/LayerView3D-357435c1.js","assets/projectExtentUtils-2cab06fa.js","assets/ImageMaterial-9fd43956.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/ExportImageParameters-8c4ce039.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-50cf2d72.js","assets/MapServiceLayerViewHelper-b93e046a.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/drapedUtils-f1f29289.js"]),media:()=>ae(()=>import("./MediaLayerView3D-393d92ce.js"),["assets/MediaLayerView3D-393d92ce.js","assets/MediaElementView-0fb13aac.js","assets/normalizeUtilsSync-3f65d54e.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/LayerView3D-357435c1.js","assets/ImageMaterial-9fd43956.js","assets/LayerView-0086d16f.js"]),"ogc-feature":()=>ae(()=>import("./OGCFeatureLayerView3D-b53213c7.js"),["assets/OGCFeatureLayerView3D-b53213c7.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),"open-street-map":CE,"oriented-imagery":()=>ae(()=>import("./FeatureLayerView3D-19c41144.js"),["assets/FeatureLayerView3D-19c41144.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),"point-cloud":()=>ae(()=>import("./PointCloudLayerView3D-4b881971.js").then(t=>t.P),["assets/PointCloudLayerView3D-4b881971.js","assets/LayerView3D-357435c1.js","assets/PointCloudWorkerUtil-3d4fdff0.js","assets/PointCloudUniqueValueRenderer-335941d6.js","assets/PopupSceneLayerView-d3c42ecc.js","assets/LayerView-0086d16f.js"]),voxel:()=>ae(()=>import("./VoxelLayerView3D-f6833b98.js"),["assets/VoxelLayerView3D-f6833b98.js","assets/LayerView3D-357435c1.js","assets/PopupSceneLayerView-d3c42ecc.js","assets/LayerView-0086d16f.js"]),route:()=>ae(()=>import("./RouteLayerView3D-4d77b422.js"),["assets/RouteLayerView3D-4d77b422.js","assets/Stop-09214426.js","assets/LayerView3D-357435c1.js","assets/GraphicsProcessor-3fa24682.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/projectExtentUtils-2cab06fa.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ae(()=>import("./SceneLayerView3D-67d45a4e.js"),["assets/SceneLayerView3D-67d45a4e.js","assets/I3SOverrides-4911607f.js","assets/I3SNode-027eba91.js","assets/meshFeatureSet-199a8653.js","assets/MeshGeoreferencedRelativeVertexSpace-2d15e21d.js","assets/MeshLocalVertexSpace-ff29e29f.js","assets/georeference-0b768c20.js","assets/External-d2b9d83b.js","assets/FeatureLayerView3D-19c41144.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/I3SMeshView3D-8307d11f.js","assets/SceneModification-bbf6005d.js","assets/SceneLayerWorker-5fac4a39.js","assets/SceneLayerView-93b30b51.js","assets/DefinitionExpressionSceneLayerView-835bab9b.js","assets/I3SQueryFeatureStore-cbca67be.js","assets/PopupSceneLayerView-d3c42ecc.js"]):ae(()=>import("./SceneLayerGraphicsView3D-299cfff2.js"),["assets/SceneLayerGraphicsView3D-299cfff2.js","assets/I3SOverrides-4911607f.js","assets/I3SNode-027eba91.js","assets/meshFeatureSet-199a8653.js","assets/MeshGeoreferencedRelativeVertexSpace-2d15e21d.js","assets/MeshLocalVertexSpace-ff29e29f.js","assets/georeference-0b768c20.js","assets/External-d2b9d83b.js","assets/FeatureLayerView3D-19c41144.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/SceneLayerView-93b30b51.js","assets/DefinitionExpressionSceneLayerView-835bab9b.js","assets/PopupSceneLayerView-d3c42ecc.js"]),stream:()=>ae(()=>import("./StreamLayerView3D-151f213b.js"),["assets/StreamLayerView3D-151f213b.js","assets/StreamFeatureManager-75a44ef7.js","assets/createConnection-dacb6930.js","assets/query-dffe729f.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/LayerView-0086d16f.js"]),tile:CE,"imagery-tile":()=>ae(()=>import("./ImageryTileLayerView3D-548aee4b.js"),["assets/ImageryTileLayerView3D-548aee4b.js","assets/LayerView3D-357435c1.js","assets/TiledLayerView3D-6bf5d4f4.js","assets/rasterProjectionHelper-e118ec16.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/drapedUtils-f1f29289.js"]),"vector-tile":()=>ae(()=>import("./VectorTileLayerView3D-c79b5fb6.js"),["assets/VectorTileLayerView3D-c79b5fb6.js","assets/Rect-98da58d6.js","assets/pbf-5cbd0354.js","assets/rasterizingUtils-4885de94.js","assets/TileInfoView-ca9693d5.js","assets/definitions-9264ac24.js","assets/number-e491b09e.js","assets/GeometryUtils-0258f920.js","assets/StyleRepository-87e1900f.js","assets/colorUtils-c0f43caf.js","assets/TileClipper-ae6eca9e.js","assets/LayerView3D-357435c1.js","assets/TiledLayerView3D-6bf5d4f4.js","assets/LayerView-0086d16f.js"]),wcs:()=>ae(()=>import("./ImageryTileLayerView3D-548aee4b.js"),["assets/ImageryTileLayerView3D-548aee4b.js","assets/LayerView3D-357435c1.js","assets/TiledLayerView3D-6bf5d4f4.js","assets/rasterProjectionHelper-e118ec16.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/drapedUtils-f1f29289.js"]),"web-tile":CE,wfs:()=>ae(()=>import("./WFSLayerView3D-8a0f683b.js"),["assets/WFSLayerView3D-8a0f683b.js","assets/FeatureLayerViewBase3D-b0013a51.js","assets/FeatureLikeLayerView3D-309cc35b.js","assets/dehydratedFeatureComparison-8af36f04.js","assets/queryForSymbologySnapping-3151fb9e.js","assets/elevationInfoUtils-59ca4653.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-c9a04bbc.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-bbf63e79.js","assets/generateRendererUtils-2338da02.js","assets/FeatureStore-98253549.js","assets/BoundsStore-689e73da.js","assets/projectExtentUtils-2cab06fa.js","assets/LayerView3D-357435c1.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/EventedSet-988365f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),wms:()=>ae(()=>import("./WMSLayerView3D-c87af0b5.js"),["assets/WMSLayerView3D-c87af0b5.js","assets/DynamicLayerView3D-4c2ddde0.js","assets/LayerView3D-357435c1.js","assets/projectExtentUtils-2cab06fa.js","assets/ImageMaterial-9fd43956.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js","assets/ExportWMSImageParameters-7af038aa.js"]),wmts:()=>ae(()=>import("./WMTSLayerView3D-1af332ff.js"),["assets/WMTSLayerView3D-1af332ff.js","assets/LayerView3D-357435c1.js","assets/TiledLayerView3D-6bf5d4f4.js","assets/LayerView-0086d16f.js","assets/RefreshableLayerView-51230066.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function k9e(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new U(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const nee={hasLayerViewModule:t=>see[t.type]!=null,importLayerView:t=>{const e=see[t.type];if(e==null)throw k9e(t);return e(t)}},oee="analyses-owner-handles";var kT,N1;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(kT||(kT={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(N1||(N1={}));let Yv=class extends pO{constructor(e){super(e),this._allAnalysisViews=new Mt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=aee(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Lr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Lr()),this._attachedToViewResolver=aee()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===N1.REMOVED)throw new U("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),oee)}_disconnectOwners(){this.handles.remove(oee),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const r=e.on("after-add",s=>this._addAnalysis(s.item)),i=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{r.remove(),i.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:kT.PENDING,list:N1.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=$S(s=>this._createAnalysisViewPromise(i,s))}else r.state.list=N1.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=N1.REMOVED,this._scheduleUpdate()):J.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=RS(()=>this._update()))}_update(){this._scheduledUpdateHandle=Li(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===N1.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case kT.PENDING:e.createAnalysisViewTask=ou(e.createAnalysisViewTask);break;case kT.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Pe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,s=i.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(yn(r))throw this._creatingViewCount-=1,Lr("AnalysisView creation aborted");const o=new n.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(yn(r))throw this._creatingViewCount-=1,o.destroy(),Lr("AnalysisView creation aborted");return e.view=o,e.state.view=kT.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ae(()=>import("./AreaMeasurementAnalysisView3D-0e714a22.js").then(r=>r.A),["assets/AreaMeasurementAnalysisView3D-0e714a22.js","assets/UnitNormalizer-23a24cfa.js","assets/Segment-dbf6c56b.js","assets/unitFormatUtils-161adcd1.js","assets/LineVisualElement-afe70a06.js","assets/elevationInfoUtils-59ca4653.js","assets/geometryEngine-f5990c3e.js","assets/geometryEngineBase-91f379ee.js","assets/hydrated-7f3fca6d.js","assets/EditGeometryOperations-853201b0.js"]);case"dimension":return ae(()=>import("./DimensionAnalysisView3D-15dc9072.js").then(r=>r.D),["assets/DimensionAnalysisView3D-15dc9072.js","assets/LineVisualElement-afe70a06.js","assets/LengthDimension-a435c35a.js","assets/Segment-dbf6c56b.js","assets/unitFormatUtils-161adcd1.js","assets/elevationInfoUtils-59ca4653.js","assets/analysisViewUtils-52451b6a.js","assets/ImageMaterial-9fd43956.js","assets/Factory-d0cab8df.js","assets/RightAngleQuadVisualElement-49fb4258.js","assets/VisualElementResources-f3312af2.js","assets/PointVisualElement-2a053877.js","assets/EditGeometryOperations-853201b0.js","assets/dehydratedFeatureComparison-8af36f04.js"]);case"direct-line-measurement":return ae(()=>import("./DirectLineMeasurementAnalysisView3D-6f9f6220.js").then(r=>r.D),["assets/DirectLineMeasurementAnalysisView3D-6f9f6220.js","assets/UnitNormalizer-23a24cfa.js","assets/Segment-dbf6c56b.js","assets/unitFormatUtils-161adcd1.js","assets/LineVisualElement-afe70a06.js","assets/elevationInfoUtils-59ca4653.js","assets/geometryEngine-f5990c3e.js","assets/geometryEngineBase-91f379ee.js","assets/hydrated-7f3fca6d.js","assets/RightAngleQuadVisualElement-49fb4258.js","assets/VisualElementResources-f3312af2.js"]);case"line-of-sight":return ae(()=>import("./LineOfSightAnalysisView3D-9f5626cf.js"),["assets/LineOfSightAnalysisView3D-9f5626cf.js","assets/LineVisualElement-afe70a06.js","assets/LineOfSightAnalysisTarget-652fde34.js","assets/elevationInfoUtils-59ca4653.js","assets/analysisViewUtils-52451b6a.js","assets/ImageMaterial-9fd43956.js","assets/PointVisualElement-2a053877.js","assets/VisualElementResources-f3312af2.js"]);case"slice":return ae(()=>import("./SliceAnalysisView3D-bf0332b6.js").then(r=>r.S),["assets/SliceAnalysisView3D-bf0332b6.js","assets/LineVisualElement-afe70a06.js","assets/BuildingComponentSublayer-1508a862.js","assets/analysisViewUtils-52451b6a.js","assets/ImageMaterial-9fd43956.js","assets/Factory-d0cab8df.js"])}}};function aee(){const t=mo();return t.promise.catch(()=>{}),t}u([d()],Yv.prototype,"updating",null),u([d({constructOnly:!0})],Yv.prototype,"view",void 0),u([d()],Yv.prototype,"_allAnalysisViews",void 0),u([d()],Yv.prototype,"_creatingViewCount",void 0),Yv=u([R("esri.views.3d.analysis.AnalysisViewManager3D")],Yv);const B9e=Yv;let Rm=class extends xe{constructor(e){super(e),this.collision=new e3,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ie.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ie.Local?this._set("altitude",e):J.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ye(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return ye(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ie.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=tU)=>(i.min=Ro.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?jI([[4e3,Ro.max],[1e4,Ft(88)],[6e6,Ft(88)]]):()=>Ro.max;return(r,i=tU)=>(i.min=Ro.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?jI([[4e3,Ro.max],[5e4,Ft(88)],[6e6,Ft(88)],[2e7,Ro.min]]):jI([[3e5,Ro.max],[3e6,Ft(88)],[6e6,Ft(88)],[2e7,Ro.min]]);return(r,i=tU)=>(i.min=Ro.min,i.max=e(r),i)}};function G9e(t){return{min:-2e5,max:4*t.radius}}u([d()],Rm.prototype,"altitude",null),u([d({readOnly:!0})],Rm.prototype,"collision",void 0),u([d()],Rm.prototype,"distance",void 0),u([d({readOnly:!0})],Rm.prototype,"minimumPoiDistance",void 0),u([d()],Rm.prototype,"tilt",void 0),u([d({constructOnly:!0})],Rm.prototype,"mode",void 0),Rm=u([R("esri.views.3d.state.Constraints")],Rm);const lee=G9e(ir),Ro={min:Ft(.5),max:Ft(179.5)},tU={min:0,max:0};let e3=class extends xe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],e3.prototype,"enabled",void 0),u([d({type:Number})],e3.prototype,"elevationMargin",void 0),e3=u([R("esri.views.3d.state.Constraints.CollisionConstraint")],e3);let BT=class extends xe{constructor(){super(...arguments),this.min=lee.min,this.max=lee.max}};u([d({type:Number})],BT.prototype,"min",void 0),u([d({type:Number})],BT.prototype,"max",void 0),BT=u([R("esri.views.3d.constraints.AltitudeConstraint")],BT);let Hm=class extends xe{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};u([d({type:Number,value:1e-8})],Hm.prototype,"near",null),u([gr("near")],Hm.prototype,"castNear",null),u([d({type:Number,value:1e-8})],Hm.prototype,"far",null),u([gr("far")],Hm.prototype,"castFar",null),u([d({type:["auto","manual"]})],Hm.prototype,"mode",void 0),Hm=u([R("esri.views.3d.constraints.ClipDistanceConstraint")],Hm);const jk={min:ja(Ro.min),max:ja(Ro.max)};let F1=class extends xe{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ye(e,jk.min,jk.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],F1.prototype,"mode",void 0),u([d({type:Number,value:jk.max})],F1.prototype,"max",null),u([gr("max")],F1.prototype,"castMax",null),F1=u([R("esri.views.3d.constraints.TiltConstraint")],F1);let U1=class extends xe{constructor(){super(...arguments),this.tilt=new F1,this.altitude=new BT,this.clipDistance=new Hm}};u([d({type:F1})],U1.prototype,"tilt",void 0),u([d({type:BT})],U1.prototype,"altitude",void 0),u([d({type:Hm})],U1.prototype,"clipDistance",void 0),U1=u([R("esri.views.3d.constraints.Constraints")],U1);var Hk;let Lu=Hk=class extends de{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new Hk(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Lu.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Lu.prototype,"date",void 0),u([Se("date",["datetime"])],Lu.prototype,"readDate",null),u([De("date")],Lu.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Lu.prototype,"directShadowsEnabled",void 0),u([Se("directShadowsEnabled",["directShadows"])],Lu.prototype,"readDirectShadowsEnabled",null),u([De("directShadowsEnabled")],Lu.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Lu.prototype,"displayUTCOffset",void 0),u([De("displayUTCOffset")],Lu.prototype,"writeDisplayUTCOffset",null),Lu=Hk=u([R("esri.webscene.SunLighting")],Lu);const bO=Lu;var Zx;const u0e="esri.views.3d.environment.SunLighting",UP=J.getLogger(u0e);let jp=Zx=class extends Is.EventedMixin(bO){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return Id(UP,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Id(UP,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Id(UP,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Id(UP,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new Zx(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=Zx.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=Zx.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(VP.target=this,VP.timezoneOffset=s,this.emit("timezone-will-change",VP),VP.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new Zx({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],jp.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],jp.prototype,"ambientOcclusionEnabled",null),u([d({type:Boolean})],jp.prototype,"waterReflectionEnabled",null),u([d({type:Date})],jp.prototype,"defaultDate",null),u([d({type:Date})],jp.prototype,"date",null),jp=Zx=u([R(u0e)],jp),function(t){function e({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}t.calculateTimezoneOffset=e}(jp||(jp={}));const VP={target:null,timezoneOffset:0},i0=jp;var qk;let t3=qk=class extends de{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new qk(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],t3.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],t3.prototype,"directShadowsEnabled",void 0),t3=qk=u([R("esri.webscene.VirtualLighting")],t3);const z5=t3;var ZI;const h0e="esri.views.3d.environment.VirtualLighting",zP=J.getLogger(h0e);let Yx=ZI=class extends Is.EventedMixin(z5){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return Id(zP,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Id(zP,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Id(zP,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Id(zP,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new ZI({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new ZI(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],Yx.prototype,"ambientOcclusionEnabled",null),u([d({type:Boolean})],Yx.prototype,"waterReflectionEnabled",null),u([d({type:Boolean})],Yx.prototype,"cameraTrackingEnabled",void 0),Yx=ZI=u([R(h0e)],Yx);const r3=Yx,j9e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:i0,virtual:r3}};var Wk;let gA=Wk=class extends xe{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new Wk({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],gA.prototype,"quality",null),gA=Wk=u([R("esri.views.3d.environment.SceneViewAtmosphere")],gA);var Xk;let i3=Xk=class extends de{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new Xk({cloudCover:this.cloudCover})}};u([et({sunny:"sunny"})],i3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],i3.prototype,"cloudCover",void 0),i3=Xk=u([R("esri.views.3d.environment.SunnyWeather")],i3);const Zk=i3;var Yk;let s3=Yk=class extends de{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new Yk({cloudCover:this.cloudCover})}};u([et({cloudy:"cloudy"})],s3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],s3.prototype,"cloudCover",void 0),s3=Yk=u([R("esri.views.3d.environment.CloudyWeather")],s3);const H9e=s3;var Jk;let n3=Jk=class extends de{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new Jk({fogStrength:this.fogStrength})}};u([et({foggy:"foggy"})],n3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],n3.prototype,"fogStrength",void 0),n3=Jk=u([R("esri.views.3d.environment.FoggyWeather")],n3);const q9e=n3;var Qk;let Jx=Qk=class extends de{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Qk({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([et({rainy:"rainy"})],Jx.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Jx.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Jx.prototype,"precipitation",void 0),Jx=Qk=u([R("esri.views.3d.environment.RainyWeather")],Jx);const W9e=Jx;var Kk;let Jv=Kk=class extends de{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Kk({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([et({snowy:"snowy"})],Jv.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Jv.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Jv.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Jv.prototype,"snowCover",void 0),Jv=Kk=u([R("esri.views.3d.environment.SnowyWeather")],Jv);const X9e=Jv,d0e={key:"type",base:Zk,typeMap:{sunny:Zk,cloudy:H9e,rainy:W9e,snowy:X9e,foggy:q9e}},Z9e=Object.keys(d0e.typeMap);function Y9e(t,e){return!!Z9e.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const nf=1e4,J9e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:bO,virtual:z5}};let YI=class extends de{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],YI.prototype,"type",void 0),YI=u([R("esri.webscene.background.Background")],YI);const p0e=YI;var eB;const Q9e={...Fg,nonNullable:!0};let o3=eB=class extends p0e{constructor(t){super(t),this.type="color",this.color=new ke([0,0,0,1])}clone(){return new eB(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([et({color:"color"},{readOnly:!0})],o3.prototype,"type",void 0),u([d(Q9e)],o3.prototype,"color",void 0),o3=eB=u([R("esri.webscene.background.ColorBackground")],o3);const f0e=o3,cee={base:p0e,key:"type",typeMap:{color:f0e}};function K9e(t){return(e,r,i)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,i),n}}}const eVe={types:cee,json:{read:K9e(cee),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var tB;const m0e="esri.webscene.Environment",tVe=J.getLogger(m0e),uee=(t,e,r)=>({enabled:!r||!r.isPresentation});let s0=tB=class extends de{constructor(t){super(t),this.lighting=new bO,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Y9e(t==null?void 0:t.type,tVe)&&this._set("weather",t)}clone(){return new tB(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?z5.prototype.clone.call(this.lighting):bO.prototype.clone.call(this.lighting),background:Q(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:J9e,nonNullable:!0,json:{write:!0}})],s0.prototype,"lighting",void 0),u([d(eVe)],s0.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:uee}}})],s0.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:uee}}})],s0.prototype,"starsEnabled",void 0),u([d({types:d0e,nonNullable:!0,json:{write:!0},value:new Zk})],s0.prototype,"weather",null),s0=tB=u([R(m0e)],s0);const g0e=s0;var a3;let Qx=a3=class extends g0e{constructor(t){super(t),this.atmosphere=new gA,this.lighting=new i0,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new a3({...e,lighting:e.lighting?e.lighting.type==="virtual"?r3.fromWebsceneLighting(e.lighting):i0.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,r;return t?t instanceof i0||t instanceof r3?t:t instanceof bO?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new i0({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof z5?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new r3({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):Qd(j9e,t):new i0}clone(){return new a3({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Q(this.background)})}cloneWithWebsceneEnvironment(t){return new a3({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Q(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):i0.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):r3.fromWebsceneLighting(t.lighting);default:return t.lighting,i0.fromWebsceneLighting(t.lighting)}}};u([d({type:gA,json:{read:!1},nonNullable:!0})],Qx.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],Qx.prototype,"lighting",void 0),u([gr("lighting")],Qx.prototype,"castLighting",null),Qx=a3=u([R("esri.views.3d.environment.SceneViewEnvironment")],Qx);const Kx=Qx;var Zo;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Zo||(Zo={}));function ln(t,e){return t[0]=e[0],t[1]=e[1],t}function sr(t,e,r){return t[0]=e,t[1]=r,t}function Sd(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function uf(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function DW(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function y0e(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function rVe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function iVe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function sVe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function nVe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function oVe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function sc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function aVe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function Ub(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function nN(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function NW(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function _0e(t){const e=t[0],r=t[1];return e*e+r*r}function FW(t,e){return t[0]=-e[0],t[1]=-e[1],t}function v0e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function wO(t,e){const r=e[0],i=e[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Ys(t,e){return t[0]*e[0]+t[1]*e[1]}function lVe(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function Ju(t,e,r,i){const s=e[0],n=e[1];return t[0]=s+i*(r[0]-s),t[1]=n+i*(r[1]-n),t}function cVe(t,e){e=e||1;const r=2*oR()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function b0e(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s,t[1]=r[1]*i+r[3]*s,t}function Qv(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[2]*s+r[4],t[1]=r[1]*i+r[3]*s+r[5],t}function uVe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[3]*s+r[6],t[1]=r[1]*i+r[4]*s+r[7],t}function hVe(t,e,r){const i=e[0],s=e[1];return t[0]=r[0]*i+r[4]*s+r[12],t[1]=r[1]*i+r[5]*s+r[13],t}function dVe(t,e,r,i){const s=e[0]-r[0],n=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-n*o+r[0],t[1]=s*o+n*a+r[1],t}function pVe(t,e){const r=t[0],i=t[1],s=e[0],n=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function fVe(t){return"vec2("+t[0]+", "+t[1]+")"}function w0e(t,e){return t[0]===e[0]&&t[1]===e[1]}function x0e(t,e){const r=t[0],i=t[1],s=e[0],n=e[1],o=Wa();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function mVe(t,e,r,i,s){let n=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const gVe=NW,T0e=uf,yVe=DW,_Ve=y0e,S0e=Ub,vVe=nN,bVe=_0e;Object.freeze(Object.defineProperty({__proto__:null,add:Sd,angle:pVe,ceil:rVe,copy:ln,cross:lVe,dist:S0e,distance:Ub,div:_Ve,divide:y0e,dot:Ys,equals:x0e,exactEquals:w0e,floor:iVe,inverse:v0e,len:gVe,length:NW,lerp:Ju,max:nVe,min:sVe,mul:yVe,multiply:DW,negate:FW,normalize:wO,projectAndScale:mVe,random:cVe,rotate:dVe,round:oVe,scale:sc,scaleAndAdd:aVe,set:sr,sqrDist:vVe,sqrLen:bVe,squaredDistance:nN,squaredLength:_0e,str:fVe,sub:T0e,subtract:uf,transformMat2:b0e,transformMat2d:Qv,transformMat3:uVe,transformMat4:hVe},Symbol.toStringTag,{value:"Module"}));function UW(t){return ye((t-1e5)/(1e6-1e5),0,1)}const rB=1e4,wVe=.085,b0=1e5;let xVe=class{};const Kr=xVe;function b(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(b||(b={}));var E;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(E||(E={}));var Rs;function Tf(t,e){switch(e.textureCoordinateType){case Rs.Default:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Rs.Compressed:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(b`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Rs.Atlas:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(E.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(b`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Rs.None:return void t.vertex.code.add(b`void forwardTextureCoordinates() {}`);case Rs.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Rs||(Rs={}));function wc(t){t.code.add(b`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function hu(t){t.include(wc),t.code.add(b`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function k5(t){t.fragment.code.add(b`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Jr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Jr||(Jr={}));let ls=class{constructor(e,r,i,s,n=null){this.name=e,this.type=r,this.arraySize=n,this.bind={[Jr.Pass]:null,[Jr.Draw]:null},i!=null&&s!=null&&(this.bind[i]=s)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Vt=class extends ls{constructor(e,r){super(e,"vec3",Jr.Pass,(i,s,n)=>i.setUniform3fv(e,r(s,n)))}};function zg(t){t.uniforms.add(new Vt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function Yf(t){t.uniforms.add(new Vt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function oN(t){zg(t.fragment),Yf(t.fragment),t.fragment.code.add(b`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Tr=class extends ls{constructor(e,r){super(e,"vec2",Jr.Pass,(i,s,n)=>i.setUniform2fv(e,r(s,n)))}},rr=class extends ls{constructor(e,r){super(e,"vec4",Jr.Pass,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}},Oe=class extends ls{constructor(e,r){super(e,"float",Jr.Pass,(i,s,n)=>i.setUniform1f(e,r(s,n)))}},Di=class extends ls{constructor(e,r){super(e,"mat4",Jr.Pass,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};const pa=Zt();let TVe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function tt(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new TVe(`${e} at ${r}`)}}function Iw(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function hee(t,e,r,i){let s,n=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],h=(i[2]-t[2])/e[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function kP(t,e,r,i,s,n=Ue()){const o=(i[s]-r[s])*(e[0]-t[0])-(i[0]-r[0])*(e[s]-t[s]),a=(i[0]-r[0])*(t[s]-r[s])-(i[s]-r[s])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function dee(t,e,r,i,s){pa[0]=t[0],pa[1]=t[1],pa[2]=t[2],pa[3]=1,Qc(pa,pa,e),s.length>2&&(s[2]=-pa[2]),Qc(pa,pa,r),tt(pa[3]!==0),s[0]=pa[0]/pa[3],s[1]=pa[1]/pa[3],s[2]=pa[2]/pa[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function SVe(t,e){return Math.log(t)/Math.log(e)}function EVe(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function E0e(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const C0e=J.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let A0e=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){C0e.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==e[n]&&s.add(n);for(const n of Object.keys(e))i[n]!==e[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${e[n]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},br=class extends A0e{constructor(){super(...arguments),this.vertex=new pee,this.fragment=new pee,this.attributes=new OVe,this.varyings=new RVe,this.extensions=new iB,this.constants=new O0e}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?MVe:PVe,c=this.constants.generateSource().concat(n.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}},CVe=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new U(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else C0e.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},AVe=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},pee=class extends A0e{constructor(){super(...arguments),this.uniforms=new CVe,this.code=new AVe,this.constants=new O0e}get builder(){return this}},OVe=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},RVe=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&tt(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,s)=>r.push(e==="vertex"?`out ${i} ${s};`:`in ${i} ${s};`)),r}},iB=class sB{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?sB.ALLOWLIST_VERTEX:sB.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};iB.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],iB.ALLOWLIST_VERTEX=[];let O0e=class Ws{constructor(){this._entries=new Set}add(e,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=Ws._numberToFloatStr(i);break;case"int":s=Ws._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${Ws._numberToFloatStr(i[0])},                            ${Ws._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${Ws._numberToFloatStr(i[0])},                            ${Ws._numberToFloatStr(i[1])},                            ${Ws._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${Ws._numberToFloatStr(i[0])},                            ${Ws._numberToFloatStr(i[1])},                            ${Ws._numberToFloatStr(i[2])},                            ${Ws._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${Ws._numberToIntStr(i[0])},                             ${Ws._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${Ws._numberToIntStr(i[0])},                             ${Ws._numberToIntStr(i[1])},                             ${Ws._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${Ws._numberToIntStr(i[0])},                             ${Ws._numberToIntStr(i[1])},                             ${Ws._numberToIntStr(i[2])},                             ${Ws._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>Ws._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const PVe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,MVe=`precision highp float;
precision highp sampler2D;`;let Je=class extends ls{constructor(e,r){super(e,"sampler2D",Jr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};const yA=Ae(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),rU=3,iU=Ae(rU*parseFloat(65e-8.toFixed(6)),rU*parseFloat(1881e-9.toFixed(6)),rU*parseFloat(85e-9.toFixed(6))),$Ve=3996e-9,IVe=Ae(parseFloat(Number(yA[0]+iU[0]).toFixed(6)),parseFloat(Number(yA[1]+iU[1]).toFixed(6)),parseFloat(Number(yA[2]+iU[2]).toFixed(6)));function LVe(t){const e=new br;e.attributes.add(E.POSITION,"vec2"),e.include(Tf,{textureCoordinateType:Rs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new Di("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Di("inverseViewMatrix",(s,n)=>GS(DVe,n.camera.viewMatrix))),r.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Vt("backgroundColor",s=>s.backgroundColor),new Tr("radii",s=>s.radii),new Vt("cameraPosition",(s,n)=>n.camera.eye),new rr("heightParameters",s=>s.heightParameters),new Oe("innerFadeDistance",s=>s.innerFadeDistance),new Oe("altitudeFade",s=>s.altitudeFade),new Je("depthTexture",s=>s.depthTexture),new Oe("hazeStrength",s=>s.hazeStrength)),i.constants.add("betaRayleigh","vec3",yA),i.constants.add("betaCombined","vec3",IVe),i.constants.add("betaMie","float",$Ve),i.constants.add("scaleHeight","float",wVe*b0),zg(i),e.include(k5),t.haze&&(i.include(hu),i.uniforms.add(new Tr("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(b`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(b`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(b`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?b`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":b`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":b`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?b`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:b`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":b`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?b`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?b`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?b`cameraSpaceRay *= -textureBilinear(vuv0);`:b`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:b`${t.reduced?"":b`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?b`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:b`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":b`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const DVe=ve(),NVe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:yA,build:LVe},Symbol.toStringTag,{value:"Module"}));let Sr=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var wi,Et,be,Nf,wt,Ud,rS,Ke,Qr,ms,At,Lt,ns,St,Ze,Us,ks,xr,Wc,oo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(wi||(wi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Et||(Et={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(be||(be={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Nf||(Nf={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(wt||(wt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Ud||(Ud={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(rS||(rS={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Ke||(Ke={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Qr||(Qr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(ms||(ms={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(At||(At={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Lt||(Lt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(ns||(ns={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(St||(St={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Ze||(Ze={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Us||(Us={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(ks||(ks={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(xr||(xr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Wc||(Wc={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(oo||(oo={}));const sU=33984;var vn,zc;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(vn||(vn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(zc||(zc={}));const fee=33306;var hs,mee,gee,yee,aN,nB,_ee;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(hs||(hs={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(mee||(mee={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(gee||(gee={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(yee||(yee={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(aN||(aN={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(nB||(nB={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(_ee||(_ee={}));let Rr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Fe(this._program),this._pipeline=this._configuration=null}reload(e){Fe(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Et.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const vr=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.UV0,2],[E.COLOR,3],[E.COLORFEATUREATTRIBUTE,3],[E.SIZE,4],[E.TANGENT,4],[E.AUXPOS1,5],[E.SYMBOLCOLOR,5],[E.AUXPOS2,6],[E.FEATUREATTRIBUTE,6],[E.INSTANCEFEATUREATTRIBUTE,6],[E.INSTANCECOLOR,7],[E.OBJECTANDLAYERIDCOLOR,7],[E.INSTANCEOBJECTANDLAYERIDCOLOR,7],[E.MODEL,8],[E.MODELNORMAL,12],[E.MODELORIGINHI,11],[E.MODELORIGINLO,15]]),FVe=J.getLogger("esri.views.webgl.checkWebGLError");function UVe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const R0e=!!oe("enable-feature:webgl-debug");function ju(){return R0e}function oB(){return R0e}function O0(t){if(ju()){const e=t.getError();if(e){const r=UVe(t,e),i=new Error().stack;FVe.error(new U("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let Er=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Bt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(Jr.Pass,this),this.bindDraw=r.generateBind(Jr.Draw,this),this._fragmentUniforms=ju()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(r==null||r.glName==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var mi,Vb,ps,ug,wl,$g,iS,Xr,zb,hg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(mi||(mi={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(Vb||(Vb={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(ps||(ps={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(ug||(ug={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(wl||(wl={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}($g||($g={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(iS||(iS={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Xr||(Xr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(zb||(zb={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(hg||(hg={}));function vc(t,e,r=Nf.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function _o(t,e,r,i,s=Nf.ADD,n=Nf.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const VW={face:Ud.BACK,mode:rS.CCW},P0e={face:Ud.FRONT,mode:rS.CCW},B5=t=>t===mi.Back?VW:t===mi.Front?P0e:null,El={zNear:0,zFar:1},Gt={r:!0,g:!0,b:!0,a:!0};function VVe(t){return WVe.intern(t)}function zVe(t){return XVe.intern(t)}function kVe(t){return ZVe.intern(t)}function BVe(t){return YVe.intern(t)}function GVe(t){return JVe.intern(t)}function jVe(t){return QVe.intern(t)}function HVe(t){return KVe.intern(t)}function qVe(t){return eze.intern(t)}function Ot(t){return tze.intern(t)}let kg=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function Bg(t){return"["+t.join(",")+"]"}const WVe=new kg(M0e,t=>({__tag:"Blending",...t}));function M0e(t){return t?Bg([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const XVe=new kg($0e,t=>({__tag:"Culling",...t}));function $0e(t){return t?Bg([t.face,t.mode]):null}const ZVe=new kg(I0e,t=>({__tag:"PolygonOffset",...t}));function I0e(t){return t?Bg([t.factor,t.units]):null}const YVe=new kg(L0e,t=>({__tag:"DepthTest",...t}));function L0e(t){return t?Bg([t.func]):null}const JVe=new kg(D0e,t=>({__tag:"StencilTest",...t}));function D0e(t){return t?Bg([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const QVe=new kg(N0e,t=>({__tag:"DepthWrite",...t}));function N0e(t){return t?Bg([t.zNear,t.zFar]):null}const KVe=new kg(F0e,t=>({__tag:"ColorWrite",...t}));function F0e(t){return t?Bg([t.r,t.g,t.b,t.a]):null}const eze=new kg(U0e,t=>({__tag:"StencilWrite",...t}));function U0e(t){return t?Bg([t.mask]):null}const tze=new kg(rze,t=>({blending:VVe(t.blending),culling:zVe(t.culling),polygonOffset:kVe(t.polygonOffset),depthTest:BVe(t.depthTest),stencilTest:GVe(t.stencilTest),depthWrite:jVe(t.depthWrite),colorWrite:HVe(t.colorWrite),stencilWrite:qVe(t.stencilWrite)}));function rze(t){return t?Bg([M0e(t.blending),$0e(t.culling),I0e(t.polygonOffset),L0e(t.depthTest),D0e(t.stencilTest),N0e(t.depthWrite),F0e(t.colorWrite),U0e(t.stencilWrite)]):null}let ize=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,s){return(i||e!==r)&&(s(e),this._pipelineInvalid=!0),e}},sze=class extends Kr{constructor(){super(...arguments),this.heightParameters=Zt(),this.radii=Ue(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ue(),this.backgroundColor=C()}},l3=class V0e extends Rr{initializeProgram(e){return new Er(e.rctx,V0e.shader.get().build(this.configuration),vr)}initializePipeline(){return this.configuration.reduced?Ot({blending:vc(be.ONE,be.ZERO),depthTest:{func:Qr.ALWAYS},colorWrite:Gt}):this.configuration.haze?Ot({blending:_o(be.ONE,be.ZERO,be.ONE_MINUS_SRC_COLOR,be.ONE),colorWrite:Gt}):Ot({blending:vc(be.SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.LEQUAL},colorWrite:Gt})}};l3.shader=new Sr(NVe,()=>ae(()=>import("./ChapmanAtmosphere.glsl-527e78e4.js"),[]));let ca=class extends Kr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function F(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,r,{get(){return this[i]},set(h){if(this[i]!==h&&(this[i]=h,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+h<<l&c,typeof h!="number"&&typeof h!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof h)}})}}}let lN=class extends ca{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};u([F()],lN.prototype,"haze",void 0),u([F()],lN.prototype,"reduced",void 0);let po=class{constructor(e,r,i,s,n,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new po(E.POSITION,3,Ke.FLOAT,0,12);new po(E.POSITION,3,Ke.FLOAT,0,20),new po(E.UV0,2,Ke.FLOAT,12,20);new po(E.POSITION,3,Ke.FLOAT,0,32),new po(E.NORMAL,3,Ke.FLOAT,12,32),new po(E.UV0,2,Ke.FLOAT,24,32);new po(E.POSITION,3,Ke.FLOAT,0,16),new po(E.COLOR,4,Ke.UNSIGNED_BYTE,12,16);const zW=[new po(E.POSITION,2,Ke.FLOAT,0,8)],wR=[new po(E.POSITION,2,Ke.FLOAT,0,16),new po(E.UV0,2,Ke.FLOAT,8,16)];function vee(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Io(t,e){return t.vertexBuffers[e].byteLength/nze(t.layout[e])}function nze(t){return t[0].stride}function kW(t,e,r,i,s=0){const n=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function BW(t,e,r,i){const s=t.gl,n=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(wt.ARRAY_BUFFER)}function GW(t){switch(t){case St.ALPHA:case St.LUMINANCE:case St.RED:case St.RED_INTEGER:case Ze.R8:case Ze.R8I:case Ze.R8UI:case Ze.R8_SNORM:case ks.STENCIL_INDEX8:return 1;case St.LUMINANCE_ALPHA:case St.RG:case St.RG_INTEGER:case Ze.RGBA4:case Ze.R16F:case Ze.R16I:case Ze.R16UI:case Ze.RG8:case Ze.RG8I:case Ze.RG8UI:case Ze.RG8_SNORM:case Ze.RGB565:case Ze.RGB5_A1:case ks.DEPTH_COMPONENT16:return 2;case St.DEPTH_COMPONENT:case St.RGB:case St.RGB_INTEGER:case Ze.RGB8:case Ze.RGB8I:case Ze.RGB8UI:case Ze.RGB8_SNORM:case Ze.SRGB8:case ks.DEPTH_COMPONENT24:return 3;case St.DEPTH_STENCIL:case St.DEPTH24_STENCIL8:case St.RGBA:case St.RGBA_INTEGER:case Ze.RGBA8:case Ze.R32F:case Ze.R11F_G11F_B10F:case Ze.RG16F:case Ze.R32I:case Ze.R32UI:case Ze.RG16I:case Ze.RG16UI:case Ze.RGBA8I:case Ze.RGBA8UI:case Ze.RGBA8_SNORM:case Ze.SRGB8_ALPHA8:case Ze.RGB9_E5:case Ze.RGB10_A2UI:case Ze.RGB10_A2:case ks.DEPTH_STENCIL:case ks.DEPTH_COMPONENT32F:case ks.DEPTH24_STENCIL8:return 4;case ks.DEPTH32F_STENCIL8:return 5;case Ze.RGB16F:case Ze.RGB16I:case Ze.RGB16UI:return 6;case Ze.RG32F:case Ze.RG32I:case Ze.RG32UI:case Ze.RGBA16F:case Ze.RGBA16I:case Ze.RGBA16UI:return 8;case Ze.RGB32F:case Ze.RGB32I:case Ze.RGB32UI:return 12;case Ze.RGBA32F:case Ze.RGBA32I:case Ze.RGBA32UI:return 16;case hs.COMPRESSED_RGB_S3TC_DXT1_EXT:case hs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case hs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case hs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case hs.COMPRESSED_R11_EAC:case hs.COMPRESSED_SIGNED_R11_EAC:case hs.COMPRESSED_RGB8_ETC2:case hs.COMPRESSED_SRGB8_ETC2:case hs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case hs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case hs.COMPRESSED_RG11_EAC:case hs.COMPRESSED_SIGNED_RG11_EAC:case hs.COMPRESSED_RGBA8_ETC2_EAC:case hs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const Lw=J.getLogger("esri.views.webgl.VertexArrayObject");let xh=class{constructor(e,r,i,s,n=null){this._context=e,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,e.instanceCounter.increment(vn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*Oue}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const r in this._buffers)(e=this._buffers[r])==null||e.dispose(),delete this._buffers[r];this._indexBuffer=Fe(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&Lw.warn("Leaked WebGL VAO")}disposeVAOOnly(){var e,r;this._glName&&(((r=(e=this._context)==null?void 0:e.capabilities)==null?void 0:r.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(vn.VertexArrayObject,this),this._context=CS(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||Lw.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||Lw.error("Vertex buffer is uninitialized!");const a=r[n];a||Lw.error("Vertex element descriptor is empty!"),kW(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||Lw.error("Vertex buffer dictionary is empty!");for(const i in e){const s=e[i];s||Lw.error("Vertex buffer is uninitialized!");const n=r[i];BW(this._context,this._locations,s,n)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},ap=class extends xh{};var or;function aB(t,e,r={}){const i=e===or.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const s of i){const n=t.getContext(s,r);if(n)return n}return null}function oze(t,e,r={}){const i=z0e(t);for(const s of i){const n=aB(e,s,r);if(n)return n}return null}function z0e(t){if(t==="3d")return[or.WEBGL2];const e=oe("esri-force-webgl");return e===or.WEBGL1||e===or.WEBGL2?[e]:oe("mac")&&oe("chrome")?[or.WEBGL1,or.WEBGL2]:[or.WEBGL2,or.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(or||(or={}));const gp=J.getLogger("esri.views.webgl.BufferObject");let Ir=class eT{static createIndex(e,r,i){return new eT(e,wt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new eT(e,wt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==or.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new eT(e,wt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=xr.STREAM_READ,i){if(e.type!==or.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new eT(e,wt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(e,r=xr.STREAM_DRAW,i){if(e.type!==or.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new eT(e,wt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,s){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(vn.BufferObject,this),this._glName=this._context.gl.createBuffer(),O0(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER?this._indexType===Ke.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER||this.bufferType===wt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(vn.BufferObject,this),this._context=CS(this._context)):this._glName&&gp.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&gp.error("Buffer size needs to be positive!"),this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case Ke.UNSIGNED_SHORT:e*=2;break;case Ke.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(D4(e)&&(r/=2,this._indexType=Ke.UNSIGNED_SHORT),F4(e)&&(r/=4,this._indexType=Ke.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r!=null?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,e,this.usage),O0(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,s){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteLength)&&gp.error("offset is out of range!"),i>=s&&gp.error("end must be bigger than start!"),(r+(s-i))*e.BYTES_PER_ELEMENT>this.byteLength&&gp.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===or.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,s-i);else{const a=i===0&&s===e.length?e:e.subarray(i,s);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}O0(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,r=0,i,s){if(this._context.type!==or.WEBGL2)return void gp.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void gp.error("Problem getting subdata: offset and length were less than zero!");const n=aze(e)?e.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>e.byteLength)return void gp.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s??0)>this.byteLength&&gp.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,wt.COPY_READ_BUFFER),o.getBufferSubData(wt.COPY_READ_BUFFER,r,e,i,s),this._context.unbindBuffer(wt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,s){this._context.type===or.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,s)):gp.error("Get buffer subdata is supported in WebGL2 only!")}};function aze(t){return jAe(t)}var __;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(__||(__={}));let _r=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=ns.TEXTURE_2D,this.pixelFormat=St.RGBA,this.dataType=Us.UNSIGNED_BYTE,this.samplingMode=At.LINEAR,this.wrapMode=Lt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function lze(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*(t.hasMipmap?4/3:1)*GW(t.internalFormat)}let cze=class k0e extends _r{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case Ze.R16F:case Ze.R16I:case Ze.R16UI:case Ze.R32F:case Ze.R32I:case Ze.R32UI:case Ze.R8_SNORM:case Ze.R8:case Ze.R8I:case Ze.R8UI:this.pixelFormat=St.RED}}static validate(e,r){return new k0e(e,r)}};const bee=4;let Ct=class{constructor(e,r=null,i=null){if(this.type=__.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const s=cze.validate(e,r);if(!s)throw new U("Texture descriptor invalid");this._descriptor=s}if(this._descriptor.context.instanceCounter.increment(vn.Texture,this),this._descriptor.context.type!==or.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),Kv(this._descriptor.target)))throw new U("3D and array textures are not supported in WebGL1");this._descriptor.target===ns.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return fze.delete(this),lze(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(vn.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new U("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===ns.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=ns.TEXTURE_CUBE_MAP_POSITIVE_X;r<=ns.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._descriptor.context||!this._descriptor.context.gl)return;const i=this._descriptor.context.gl;O0(i),this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const s=this._descriptor,n=r??s.target,o=Kv(n);e===null&&(s.width=s.width||bee,s.height=s.height||bee,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),nU(this._descriptor.context,s),this._configurePixelStorage(),O0(i);const l=this._deriveInternalFormat();if(oU(e)){let c=e.width,h=e.height;const p=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,h=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,p),this._texImage(n,0,l,c,h,p,e),O0(i),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=c),s.height||(s.height=h),o&&!s.depth&&(s.depth=p)}else{const{width:c,height:h,depth:p}=s;if(c==null||h==null)throw new U("Width and height must be specified!");if(o&&p==null)throw new U("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,c,h,p),JI(e)){const f=e.levels,m=Tee(n,c,h,p),y=Math.min(m-1,f.length-1);this._descriptor.context.gl2!=null?i.texParameteri(s.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,y):s.hasMipmap=s.hasMipmap&&m===f.length;const _=l;if(!dze(_))throw new U("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,w,T,x)=>{const S=f[Math.min(v,f.length-1)];this._compressedTexImage(n,v,_,w,T,x,S)},y)}else this._texImage(n,0,l,c,h,p,e),O0(i),s.hasMipmap&&this.generateMipmap()}wee(i,this._descriptor),xee(i,this._descriptor),uze(this._descriptor.context,this._descriptor),O0(i),this._descriptor.context.bindTexture(a,Ct.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,h=this._descriptor,p=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,target:y,isImmutable:_}=h;if(_&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>h.width||n>h.height||r+s>h.width||i+n>h.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(oU(o)?c?c.texSubImage2D(y,e,r,i,s,n,f,m,o):l.texSubImage2D(y,e,r,i,f,m,o):JI(o)?l.compressedTexSubImage2D(y,e,r,i,s,n,p,o.levels[e]):l.texSubImage2D(y,e,r,i,s,n,f,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Ct.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new U("3D textures are not supported in WebGL1");const h=this._descriptor,p=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,isImmutable:y,target:_}=h;if(y&&!this._wasImmutablyAllocated)throw new U("Cannot update immutable texture before allocation!");Kv(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>h.width||o>h.height||a>h.depth||r+n>h.width||i+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),JI(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,r,i,s,n,o,a,p,l);else{const w=l;c.texSubImage3D(_,e,r,i,s,n,o,a,f,m,w)}this._descriptor.context.bindTexture(v,Ct.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new U("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,nU(this._descriptor.context,e)}e.samplingMode===At.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=At.LINEAR_MIPMAP_NEAREST):e.samplingMode===At.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=At.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Ct.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,nU(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(wee(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(xee(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===or.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===St.DEPTH_STENCIL&&(this._descriptor.internalFormat=St.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Us.FLOAT:switch(this._descriptor.pixelFormat){case St.RGBA:return this._descriptor.internalFormat=Ze.RGBA32F;case St.RGB:return this._descriptor.internalFormat=Ze.RGB32F;default:throw new U("Unable to derive format")}case Us.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case St.RGBA:return this._descriptor.internalFormat=Ze.RGBA8;case St.RGB:return this._descriptor.internalFormat=Ze.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===St.DEPTH_STENCIL?St.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,r,i,s,n,o){const a=this._descriptor.context.gl2;if(a==null)throw new U("Immutable textures are not supported in WebGL1");if(!hze(r))throw new U("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Tee(e,s,n,o):1;if(Kv(e)){if(o==null)throw new U("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,s,n,o)}else a.texStorage2D(e,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl,c=Kv(e),{isImmutable:h,pixelFormat:p,dataType:f}=this._descriptor,m=this._descriptor.context.type===or.WEBGL2,y=m?l:null;if(m||!oU(a))if(h){if(a!=null){const _=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,r,0,0,0,s,n,o,p,f,_)}else l.texSubImage2D(e,r,0,0,s,n,p,f,_)}}else{const _=a;if(c){if(o==null)throw new U("Missing depth dimension for 3D texture upload");y.texImage3D(e,r,i,s,n,o,0,p,f,_)}else l.texImage2D(e,r,i,s,n,0,p,f,_)}else l.texImage2D(e,0,i,p,f,a)}_compressedTexImage(e,r,i,s,n,o,a){const l=this._descriptor.context.gl;let c=null;const h=Kv(e),p=this._descriptor.isImmutable;if(h){if(this._descriptor.context.type!==or.WEBGL2)throw new U("3D textures are not supported in WebGL1");c=l}if(p){if(a!=null)if(h){if(o==null)throw new U("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,s,n,i,a)}else if(h){if(o==null)throw new U("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,n,o,0,a)}else l.compressedTexImage2D(e,r,i,s,n,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===ns.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new U("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function nU(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===or.WEBGL2;r||!e.isImmutable&&!Kv(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&Ib(e.width)&&e.height!=null&&Ib(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Lt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Lt.CLAMP_TO_EDGE&&e.wrapMode.t===Lt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function wee(t,e){let r=e.samplingMode,i=e.samplingMode;r===At.LINEAR_MIPMAP_NEAREST||r===At.LINEAR_MIPMAP_LINEAR?(r=At.LINEAR,e.hasMipmap||(i=At.LINEAR)):r!==At.NEAREST_MIPMAP_NEAREST&&r!==At.NEAREST_MIPMAP_LINEAR||(r=At.NEAREST,e.hasMipmap||(i=At.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function xee(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function uze(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function hze(t){return t in Ze}function dze(t){return t in hs}function JI(t){return t!=null&&"type"in t&&t.type==="compressed"}function pze(t){return t!=null&&"byteLength"in t}function oU(t){return t!=null&&!JI(t)&&!pze(t)}function Kv(t){return t===ns.TEXTURE_3D||t===ns.TEXTURE_2D_ARRAY}function Tee(t,e,r,i=1){let s=Math.max(e,r);return t===ns.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}Ct.TEXTURE_UNIT_FOR_UPDATES=0;const fze=new Map;function Cl(t,e=zW,r=vr,i=-1,s=1){let n=null;return e===wR?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new ap(t,r,{geometry:e},{geometry:Ir.createVertex(t,xr.STATIC_DRAW,n)})}function mze(t,e=zW,r=vr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new ap(t,r,{geometry:e},{geometry:Ir.createVertex(t,xr.STATIC_DRAW,i)})}const B0e=4;function G0e(t,e=B0e){const r=new _r;return r.samplingMode=At.NEAREST,r.width=r.height=e,new Ct(t,r)}function gze(t,e,r=B0e){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n]=255*e[0],i[n+1]=255*e[1],i[n+2]=255*e[2],i[n+3]=255*e[3];const s=new _r;return s.samplingMode=At.NEAREST,s.width=s.height=r,new Ct(t,s,i)}function j0e(t){const e=new _r;return e.samplingMode=At.NEAREST,e.width=e.height=1,new Ct(t,e,new Uint8Array([255,255,255,255]))}let See=class{constructor(e,r){this._view=e,this.type=Zo.Realistic,this._handles=new Pi,this._passParameters=new sze,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=ir.radius,this._fadeHaze=0,this._tmpScale=Ue(),this._updateRadius(ir.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ue(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateRootTileElevationBounds():null}),ue(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateVisibleElevationBounds():null})]);const s=new lN;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(l3,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(l3,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(l3,s),s.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(l3,s),this._vao=Cl(i,wR)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(e,r,i,s,n){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=o.background.color;se(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(s)o.renderDepthDetached(()=>this._renderCommon(l,e));else{const c=e.rctx.getViewport(),h=Ee(e.bindParameters.camera.eye)-ir.radius;let p;if(h<b0){const y=Math.min(1,Math.max(0,h/b0));p=n?xt(.4,.5,y):xt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(h-b0)/(15*b0)));p=n?xt(.5,1,y):xt(.3,.6,y)}const f=Math.floor(p*e.bindParameters.camera.fullViewport[2]),m=Math.floor(p*e.bindParameters.camera.fullViewport[3]);e.rctx.setViewport(0,0,f,m),o.renderToTargets(()=>this._renderCommon(l,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(c.x,c.y,c.width,c.height),sr(this._tmpScale,f/e.bindParameters.camera.fullViewport[2],m/e.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(e.bindParameters,n,i,this._tmpScale)}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(Et.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=ir.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(ir.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,sr(this._passParameters.radii,e,e+b0),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-rB)*rB)}_update(e){if(!e)return;const r=ea(e.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=ye((i-this._passParameters.radii[0])/b0,0,1);bi(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=UW(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=xt(xt(.6,1,nO(9500,10500,i-ir.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function H0e(t){t.fragment.code.add(b`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function jW(t,e){switch(t.include(Tf,e),e.textureCoordinateType){case Rs.Default:case Rs.Compressed:return void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Rs.Atlas:return t.include(H0e),void t.fragment.code.add(b`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Rs.None:case Rs.COUNT:return}}let iu=class extends ls{constructor(e,r){super(e,"vec3",Jr.Draw,(i,s,n,o)=>i.setUniform3fv(e,r(s,n,o)))}},uh=class extends ls{constructor(e,r){super(e,"sampler2D",Jr.Draw,(i,s,n)=>i.bindTexture(e,r(s,n)))}},N_=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return ug.LOADED}},HW=class extends N_{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=ki(this._texture),this._textureNormal=ki(this._textureNormal),this._textureEmissive=ki(this._textureEmissive),this._textureOcclusion=ki(this._textureOcclusion),this._textureMetallicRoughness=ki(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?ug.LOADED:ug.LOADING}get textureBindParameters(){return new q0e(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=ki(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(pu(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return ki(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}},q0e=class extends Kr{constructor(e=null,r=null,i=null,s=null,n=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}};var rt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(rt||(rt={}));function qW(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===rt.Normal&&i&&t.include(jW,e),e.pbrMode!==rt.Schematic)if(e.pbrMode!==rt.Disabled){if(e.pbrMode===rt.Normal){r.code.add(b`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(s===Jr.Pass?new Je("texMetallicRoughness",n=>n.textureMetallicRoughness):new uh("texMetallicRoughness",n=>n.textureMetallicRoughness)),r.code.add(b`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(s===Jr.Pass?new Je("texEmission",n=>n.textureEmissive):new uh("texEmission",n=>n.textureEmissive)),r.code.add(b`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(s===Jr.Pass?new Je("texOcclusion",n=>n.textureOcclusion):new uh("texOcclusion",n=>n.textureOcclusion)),r.code.add(b`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(b`float getBakedOcclusion() { return 1.0; }`),s===Jr.Pass?r.uniforms.add(new Vt("emissionFactor",n=>n.emissiveFactor),new Vt("mrrFactors",n=>n.mrrFactors)):r.uniforms.add(new iu("emissionFactor",n=>n.emissiveFactor),new iu("mrrFactors",n=>n.mrrFactors)),r.code.add(b`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?b`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?b`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?b`applyEmission(${e.hasEmissiveTextureTransform?b`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?b`applyOcclusion(${e.hasOcclusionTextureTransform?b`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(b`float getBakedOcclusion() { return 1.0; }`);else r.code.add(b`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function WW(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Vt("lightingAmbientSH0",(s,n)=>se(Eee,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new rr("lightingAmbientSH_R",(s,n)=>bi(im,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new rr("lightingAmbientSH_G",(s,n)=>bi(im,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new rr("lightingAmbientSH_B",(s,n)=>bi(im,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new Vt("lightingAmbientSH0",(s,n)=>se(Eee,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new rr("lightingAmbientSH_R1",(s,n)=>bi(im,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new rr("lightingAmbientSH_G1",(s,n)=>bi(im,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new rr("lightingAmbientSH_B1",(s,n)=>bi(im,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new rr("lightingAmbientSH_R2",(s,n)=>bi(im,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new rr("lightingAmbientSH_G2",(s,n)=>bi(im,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new rr("lightingAmbientSH_B2",(s,n)=>bi(im,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),r.code.add(b`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==rt.Normal&&e.pbrMode!==rt.Schematic||r.code.add(b`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Eee=C(),im=Zt();function xR(t){t.vertex.code.add(b`const float PI = 3.141592653589793;`),t.fragment.code.add(b`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var As,kb;function yze(t){return(t==null?void 0:t.cubeMap)!=null}function XW(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(As||(As={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(kb||(kb={}));let _ze=class{constructor(){this.readChannels=kb.RG,this.renderingStage=As.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.isCameraPositionFinal=!0,this.parallax=new Cee,this.parallaxNew=new Cee,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:hn.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:Kl.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:v_.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===hn.FADE_OUT||this.fadeInOut.stage===hn.FADE_IN||this.fadeIn.stage===Kl.FADE_IN||this.fadeInOutHeight.stage!==v_.FINISHED||this.renderingStage===As.FADING_TEXTURE_CHANNELS}};var Kl,hn,v_;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(Kl||(Kl={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(hn||(hn={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(v_||(v_={}));let Cee=class{constructor(){this.anchorPointClouds=C(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=ve()}},Sf=class extends ls{constructor(e,r){super(e,"bool",Jr.Pass,(i,s,n)=>i.setUniform1b(e,r(s,n)))}},vze=class extends ls{constructor(e,r){super(e,"samplerCube",Jr.Pass,(i,s,n)=>i.bindTexture(e,r(s,n)))}};function W0e(t){const e=t.fragment;e.uniforms.add(new Di("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new Di("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Vt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Vt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Oe("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Oe("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Oe("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===hn.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Oe("crossFadeAnchorFactor",(r,i)=>ye(i.cloudsFade.crossFade.factor,0,1)),new vze("cubeMap",(r,i)=>{var s;return(s=i.cloudsFade.data)!=null&&s.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null}),new Sf("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new Sf("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===kb.RG),new Sf("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===As.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",ir.radius),e.code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(b`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),zg(e),Yf(e),e.code.add(b`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(b`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(b`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(b`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Jf(t){t.code.add(b`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function bze(){const t=new br;t.attributes.add(E.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Di("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Di("inverseViewMatrix",(i,s)=>GS(wze,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(Jf),r.include(wc),t.include(WW,{pbrMode:rt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(xR),t.include(k5),t.include(oN),t.include(W0e,{instancedDoublePrecision:!1}),r.uniforms.add(new Vt("cameraPosition",(i,s)=>s.camera.eye)),r.code.add(b`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const wze=ve(),xze=Object.freeze(Object.defineProperty({__proto__:null,build:bze},Symbol.toStringTag,{value:"Module"}));let X0e=class Z0e extends Rr{constructor(e){super(e,new ca,()=>this.destroy())}initializeProgram(e){return new Er(e.rctx,Z0e.shader.get().build(),vr)}initializePipeline(){return Ot({blending:_o(be.ONE,be.ZERO,be.SRC_ALPHA,be.ONE),depthTest:{func:Qr.LEQUAL},colorWrite:Gt})}};X0e.shader=new Sr(xze,()=>ae(()=>import("./CloudsComposition.glsl-c73d0cba.js"),[]));let e1=class extends xe{constructor(e){super(e),this._technique=new X0e(e),this._vao=Cl(e.rctx)}destroy(){this._technique=ki(this._technique),this._vao=Fe(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,Tze,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Et.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],e1.prototype,"rctx",void 0),u([d({constructOnly:!0})],e1.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],e1.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],e1.prototype,"requestRender",void 0),e1=u([R("esri.views.3d.environment.CloudsComposition")],e1);const Tze=new Kr;function Th(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Sze(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ZW(t,e,r,i,s,n,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function YW(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Sh(t,e){if(t===e){const r=e[1],i=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function bw(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=r*p+i*f+s*m;return y?(y=1/y,t[0]=p*y,t[1]=(-h*i+s*c)*y,t[2]=(a*i-s*o)*y,t[3]=f*y,t[4]=(h*r-s*l)*y,t[5]=(-a*r+s*n)*y,t[6]=m*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*n)*y,t):null}function Eze(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t[0]=o*h-a*c,t[1]=s*c-i*h,t[2]=i*a-s*o,t[3]=a*l-n*h,t[4]=r*h-s*l,t[5]=s*n-r*a,t[6]=n*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*n,t}function Cze(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function sS(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=r[0],m=r[1],y=r[2],_=r[3],v=r[4],w=r[5],T=r[6],x=r[7],S=r[8];return t[0]=f*i+m*o+y*c,t[1]=f*s+m*a+y*h,t[2]=f*n+m*l+y*p,t[3]=_*i+v*o+w*c,t[4]=_*s+v*a+w*h,t[5]=_*n+v*l+w*p,t[6]=T*i+x*o+S*c,t[7]=T*s+x*a+S*h,t[8]=T*n+x*l+S*p,t}function cN(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=r[0],m=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*i+m*o+c,t[7]=f*s+m*a+h,t[8]=f*n+m*l+p,t}function JW(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],p=e[8],f=Math.sin(r),m=Math.cos(r);return t[0]=m*i+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*i,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=h,t[8]=p,t}function QW(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function Aze(t,e,r){const i=r[0],s=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function Oze(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Rze(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Pze(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Mze(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function G5(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,y=s*l,_=n*o,v=n*a,w=n*l;return t[0]=1-p-y,t[3]=h-w,t[6]=f+v,t[1]=h+w,t[4]=1-c-y,t[7]=m-_,t[2]=f-v,t[5]=m+_,t[8]=1-c-p,t}function Y0e(t,e){const r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=r*p+i*f+s*m;if(!y)return null;const _=1/y;return t[0]=p*_,t[1]=(-h*i+s*c)*_,t[2]=(a*i-s*o)*_,t[3]=f*_,t[4]=(h*r-s*l)*_,t[5]=(-a*r+s*n)*_,t[6]=m*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*n)*_,t}function b_(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],v=e[14],w=e[15],T=r*a-i*o,x=r*l-s*o,S=r*c-n*o,O=i*l-s*a,A=i*c-n*a,P=s*c-n*l,I=h*_-p*y,V=h*v-f*y,k=h*w-m*y,B=p*v-f*_,z=p*w-m*_,Z=f*w-m*v;let W=T*Z-x*z+S*B+O*k-A*V+P*I;return W?(W=1/W,t[0]=(a*Z-l*z+c*B)*W,t[1]=(l*k-o*Z-c*V)*W,t[2]=(o*z-a*k+c*I)*W,t[3]=(s*z-i*Z-n*B)*W,t[4]=(r*Z-s*k+n*V)*W,t[5]=(i*k-r*z-n*I)*W,t[6]=(_*P-v*A+w*O)*W,t[7]=(v*S-y*P-w*x)*W,t[8]=(y*A-_*S+w*T)*W,t):null}function $ze(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ize(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Lze(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Dze(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function J0e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function Nze(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Fze(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function Uze(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Vze(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=e[0],f=e[1],m=e[2],y=e[3],_=e[4],v=e[5],w=e[6],T=e[7],x=e[8],S=Wa();return Math.abs(r-p)<=S*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-f)<=S*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-m)<=S*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=S*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-w)<=S*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-T)<=S*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-x)<=S*Math.max(1,Math.abs(h),Math.abs(x))}function KW(t){const e=Wa(),r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return Math.abs(1-(r*r+n*n+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+h*h))<=e}const zze=sS,kze=J0e;Object.freeze(Object.defineProperty({__proto__:null,add:Dze,adjoint:Eze,copy:Sze,determinant:Cze,equals:Vze,exactEquals:Uze,frob:Lze,fromMat2d:Mze,fromMat4:Th,fromQuat:G5,fromRotation:Rze,fromScaling:Pze,fromTranslation:Oze,identity:YW,invert:bw,isOrthoNormal:KW,mul:zze,multiply:sS,multiplyScalar:Nze,multiplyScalarAndAdd:Fze,normalFromMat4:b_,normalFromMat4Legacy:Y0e,projection:$ze,rotate:JW,scale:QW,scaleByVec2:Aze,set:ZW,str:Ize,sub:kze,subtract:J0e,translate:cN,transpose:Sh},Symbol.toStringTag,{value:"Module"}));function ss(){return new Float32Array(3)}function uN(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Wr(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function Q0e(t,e){return new Float32Array(t,e,3)}function eX(){return ss()}function K0e(){return Wr(1,1,1)}function e_e(){return Wr(1,0,0)}function t_e(){return Wr(0,1,0)}function r_e(){return Wr(0,0,1)}const Bze=eX(),Gze=K0e(),jze=e_e(),Hze=t_e(),qze=r_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Gze,UNIT_X:jze,UNIT_Y:Hze,UNIT_Z:qze,ZEROS:Bze,clone:uN,create:ss,createView:Q0e,fromValues:Wr,ones:K0e,unitX:e_e,unitY:t_e,unitZ:r_e,zeros:eX},Symbol.toStringTag,{value:"Module"}));var _l;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(_l||(_l={}));let QI=class extends ca{constructor(){super(...arguments),this.steps=_l.SIXTEEN,this.writeTextureChannels=kb.RG}};u([F({count:_l.COUNT})],QI.prototype,"steps",void 0),u([F({constValue:oe("esri-mobile")?1024:2048})],QI.prototype,"cubeMapSize",void 0),u([F()],QI.prototype,"writeTextureChannels",void 0);let c3=class{constructor(e,r,i,s,n,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Aee=new c3([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],_l.SIXTEEN),Xo={sunny:Aee,cloudy:new c3([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],_l.TWOHUNDRED,.6),rainy:new c3([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],_l.TWOHUNDRED,.4),snowy:new c3([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],_l.HUNDRED,.65),foggy:new c3([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],_l.SIXTEEN),default:Aee},Xu=oe("esri-mobile")?64:128,Wze=Xu/128,vd=Math.ceil(Math.sqrt(Xu)),i_=(Xu+2)*vd,Xze=1e5,aU=128,Zze=i_/1560;function Ph(t,e=!0){t.attributes.add(E.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(b`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?b`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let xO=class extends ls{constructor(e,r){super(e,"mat3",Jr.Draw,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}},i_e=class extends Kr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Xo.default.raymarchingSteps,this.weatherTile=Ue()}},s_e=class extends Kr{constructor(){super(...arguments),this.viewMatrix=Ni()}};function Yze(t){const e=new br;e.include(Ph,!1);const r=e.fragment;return r.uniforms.add(new Oe("cloudRadius",i=>i.cloudRadius),new Oe("power",i=>xt(35,120,i.absorption)),new Oe("sigmaE",i=>1+i.absorption),new Oe("density",i=>xt(0,.3,i.density)),new Oe("cloudSize",i=>xt(0,.02,Math.max(.01,1-i.cloudSize))),new Oe("detailSize",i=>xt(0,.2,Math.max(.01,1-i.detailSize))),new Oe("smoothness",i=>xt(0,.5,1-i.smoothness)),new Oe("cloudHeight",i=>xt(0,1500,i.cloudHeight)),new Oe("coverage",i=>i.coverage),new xO("view",i=>i.viewMatrix),new Je("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new Tr("cloudVariables",i=>sr(Jze,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(b`
    const int STEPS = ${t.steps===_l.SIXTEEN?b`16`:t.steps===_l.HUNDRED?b`100`:b`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(b`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${b.float(i_)};
      const float dataWidth = ${b.float(i_)};
      const float tileRows = ${b.float(vd)};
      const vec3 atlasDimensions = vec3(${b.float(Xu)}, ${b.float(Xu)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${b.float(Wze)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${b.float(Zze)} * p) / ${b.float(i_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(b`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(b`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(b`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(b`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(b`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const Jze=Ue(),Qze=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:s_e,CloudsPassParameters:i_e,build:Yze},Symbol.toStringTag,{value:"Module"}));let n_e=class o_e extends Rr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Er(e.rctx,o_e.shader.get().build(this.configuration),vr)}initializePipeline(){return Ot({blending:vc(be.CONSTANT_COLOR,be.ONE_MINUS_CONSTANT_COLOR,Nf.ADD,this.configuration.writeTextureChannels===kb.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Qr.LEQUAL},colorWrite:Gt})}};n_e.shader=new Sr(Qze,()=>ae(()=>import("./Clouds.glsl-45f2c083.js"),[]));var Jc;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Jc||(Jc={}));let lB=class extends ca{constructor(){super(...arguments),this.mode=Jc.Full}};u([F({count:Jc.COUNT})],lB.prototype,"mode",void 0);let a_e=class extends Kr{constructor(){super(...arguments),this.weatherTile=cr(0,0)}};function Kze(t){const e=new br;return e.include(Ph,!1),e.fragment.code.add(b`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Jc.Full&&e.fragment.code.add(b`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${b.float(vd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${b.float(8)});

      float worley0 = worley(p, ${b.float(2)} * 2.0);
      float worley1 = worley(p, ${b.float(2)} * 8.0);
      float worley2 = worley(p, ${b.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${b.float(2)});
      float worley1 = worley(p, ${b.float(2)} * 2.0);
      float worley2 = worley(p, ${b.float(2)} * 4.0);
      float worley3 = worley(p, ${b.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Tr("weatherTile",r=>r.weatherTile)),e.fragment.code.add(b`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${b.float(aU)});

      // Get global coordinates of p
      p += weatherTile * ${b.float(aU)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${b.float(Xze)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(b`void main() {`),t.mode===Jc.Full&&e.fragment.code.add(b`
        float padWidth = 1.0;
        float paddedSize = ${b.float(Xu)} + 2.0 * padWidth;
        float tileCount = ${b.float(vd)} * ${b.float(vd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${b.float(Xu)};
          }

          if (startPadY) {
            pixel.y += ${b.float(Xu)};
          }

          if (endPadX) {
            pixel.x -= ${b.float(Xu)};
          }

          if (endPadY) {
            pixel.y -= ${b.float(Xu)};
          }

          uv = vec2(pixel.xy / ${b.float(Xu)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${b.float(Xu)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${b.float(vd)} * ${b.float(vd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${b.float(vd)} * ${b.float(vd)});
        p = p_;
        p.z /= (${b.float(vd)} * ${b.float(vd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(b`
      vec2 mapUV = ${b.float(aU)} * (gl_FragCoord.xy / ${b.float(i_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Jc.Full?b`fragColor.ba = vec2(0.0, map);`:b`fragColor = vec4(map);`};
    }
  `),e}const eke=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:a_e,build:Kze},Symbol.toStringTag,{value:"Module"}));let cB=class l_e extends Rr{initializeProgram(e){return new Er(e.rctx,l_e.shader.get().build(this.configuration),vr)}initializePipeline(){return Ot({blending:this.configuration.mode===Jc.Full?vc(be.ONE,be.ZERO):_o(be.ZERO,be.ONE,be.ONE,be.ZERO),depthTest:{func:Qr.ALWAYS},colorWrite:Gt})}};cB.shader=new Sr(eke,()=>ae(()=>import("./NoiseTextureAtlas.glsl-3ffb41b2.js"),[]));let hN=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function tke(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*GW(t.internalFormat)}let rke=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=__.RenderBuffer,this._context.instanceCounter.increment(vn.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==or.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get gpuMemoryUsage(){return tke(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(vn.Renderbuffer,this),this._context=CS(this._context))}};const ike=J.getLogger("esri.views.webgl.FramebufferObject");let nn=class tT{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(vn.FramebufferObject,this);const s=KI(r)?r:new Ct(this._context,r);if(this._colorAttachments.set(zc.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(zc.COLOR_ATTACHMENT0),i!=null)if(nke(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=KI(i)?i:new Ct(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=ske(i)?i:new rke(this._context,i),o=n.descriptor;o.internalFormat===ks.STENCIL_INDEX8?this._stencilBuffer=n:this._depthBuffer=n,this._validateRenderBufferDescriptor(o)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(vn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(zc.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(zc.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(zc.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get gpuMemoryUsage(){var e;return[...this._colorAttachments].reduce((r,[i,s])=>r+s.gpuMemoryUsage,((e=this.depthStencilAttachment)==null?void 0:e.gpuMemoryUsage)??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&KI(r)?r:null}attachColorTexture(e,r=zc.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(s=this.detachColorTexture(r))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=zc.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}setColorTextureTarget(e,r=zc.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case __.Texture:return this._attachDepthStencilTexture(e);case __.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==St.DEPTH_STENCIL&&r.pixelFormat!==St.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Us.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,fee)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,fee)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){var i;if(e==null)return;const r=e.descriptor;if(r.internalFormat!==ks.DEPTH_STENCIL&&r.internalFormat!==ks.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const s=this._context.gl,n=this._getGLAttachmentPoint(r);s.framebufferRenderbuffer(oo.FRAMEBUFFER,n,s.RENDERBUFFER,e.glName)}(i=this._depthBuffer)==null||i.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(oo.FRAMEBUFFER,i,r.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,r,i,s,n,o,a){(e<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==ns.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+s>this.height||n+i>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(a,Ct.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(ns.TEXTURE_2D,0,n,o,e,r,i,s),c.bindTexture(h,Ct.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,s,n,o,a)}async readPixelsAsync(e,r,i,s,n,o,a){if(this._context.type!==or.WEBGL2)return ju()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,s,n,o,a);const l=this._context.gl,c=Ir.createPixelPack(this._context,xr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,s,n,o,0),this._context.unbindBuffer(wt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var s,n,o;if(this.width===e&&this.height===r)return;const i={width:e,height:r};K1(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(a=>a.resize(i.width,i.height)),(s=this._depthStencilTexture)==null||s.resize(i.width,i.height),this._initialized&&(K1(i,this._context.parameters.maxRenderbufferSize),(n=this._depthBuffer)==null||n.resize(i.width,i.height),(o=this._stencilBuffer)==null||o.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=oo.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(e,i),this._colorAttachments.forEach((n,o)=>this._framebufferTexture2D(n.glName,o,Oee(n),e));const s=this._depthBuffer||this._stencilBuffer;if(s){const n=this._getGLAttachmentPoint(s.descriptor);r.framebufferRenderbuffer(e,n,r.RENDERBUFFER,s.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Oee(this._depthStencilTexture),e);ju()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=zc.COLOR_ATTACHMENT0,i=ns.TEXTURE_2D,s=oo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(oo.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthBuffer=Fe(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(oo.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=Fe(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Fe(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==ns.TEXTURE_2D&&e.target!==ns.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),K1(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){K1(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case ks.DEPTH_COMPONENT16:case ks.DEPTH_COMPONENT24:case ks.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case ks.DEPTH24_STENCIL8:case ks.DEPTH32F_STENCIL8:case ks.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case ks.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(tT._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;tT._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else tT._MAX_COLOR_ATTACHMENTS=1}const r=e-zc.COLOR_ATTACHMENT0;r+1>tT._MAX_COLOR_ATTACHMENTS&&J.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${tT._MAX_COLOR_ATTACHMENTS} color attachments`)}};function KI(t){return t!=null&&"type"in t&&t.type===__.Texture}function ske(t){return t!=null&&"type"in t&&t.type===__.RenderBuffer}function nke(t){return KI(t)||t!=null&&"pixelFormat"in t}function K1(t,e){const r=Math.max(t.width,t.height);if(r>e){ike.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function Oee(t){return t.descriptor.target===ns.TEXTURE_CUBE_MAP?ns.TEXTURE_CUBE_MAP_POSITIVE_X:ns.TEXTURE_2D}nn._MAX_COLOR_ATTACHMENTS=-1;let u3=class extends xe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new a_e,this._frameBuffer=new nn(e.context.renderContext.rctx,new _r(i_)),this._vao=Cl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Jc.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(Jc.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(ln(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=ki(this._fullTechniqueCached),this._weatherMapTechniqueCached=ki(this._weatherMapTechniqueCached),this._frameBuffer=Fe(this._frameBuffer),this._vao=Fe(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new lB;e.mode=Jc.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(cB,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new lB;e.mode=Jc.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(cB,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===Jc.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,s=i.getViewport();i.setViewport(0,0,i_,i_),i.bindFramebuffer(this._frameBuffer);const n=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],u3.prototype,"context",void 0),u([d({readOnly:!0})],u3.prototype,"_techniqueRepository",null),u3=u([R("esri.views.3d.environment.NoiseTextureAtlas")],u3);function c_e(t){t.include(hu),t.uniforms.add(new Je("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new Tr("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(b`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let oke=class{constructor(){this.enabled=!1}};function du(t,e){e.hasMultipassTerrain&&(t.fragment.include(hu),t.fragment.uniforms.add(new Je("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Tr("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new Tr("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(b`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let ake=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function lke(t,e){const r=t.fragment;r.include(hu),r.uniforms.add(new Tr("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new Je("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new Di("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new Oe("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new Di("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(b`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let cke=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=ve()}};function j5(t){return t?{ray:kn(t.ray),c0:t.c0,c1:t.c1}:{ray:kn(),c0:0,c1:Number.MAX_VALUE}}function uke(t,e=j5()){return eN(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function hke(t,e,r=j5()){const i=Ee(t.vector);return Bge(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function VEt(t,e){return u_e(t,t.c0,e)}function zEt(t,e){return u_e(t,t.c1,e)}function u_e(t,e,r){return le(r,t.ray.origin,ie(r,t.ray.direction,e))}new Ug(()=>j5());function TO(t){return t?[Mr(t[0]),Mr(t[1]),Mr(t[2]),Mr(t[3]),Mr(t[4]),Mr(t[5])]:[Mr(),Mr(),Mr(),Mr(),Mr(),Mr()]}function h_e(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function dN(t,e){for(let r=0;r<WS;r++)M5(t[r],e[r])}function d_e(t,e,r,i=yke){const s=si(yW.get(),e,t);bn(s,s);for(let n=0;n<mke;++n){const o=Qc(gW.get(),gke[n],s);se(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}p_e(r,i)}function p_e(t,e){Qo(e[Ye.FAR_BOTTOM_LEFT],e[Ye.NEAR_BOTTOM_LEFT],e[Ye.NEAR_TOP_LEFT],t[di.LEFT]),Qo(e[Ye.NEAR_BOTTOM_RIGHT],e[Ye.FAR_BOTTOM_RIGHT],e[Ye.FAR_TOP_RIGHT],t[di.RIGHT]),Qo(e[Ye.FAR_BOTTOM_LEFT],e[Ye.FAR_BOTTOM_RIGHT],e[Ye.NEAR_BOTTOM_RIGHT],t[di.BOTTOM]),Qo(e[Ye.NEAR_TOP_LEFT],e[Ye.NEAR_TOP_RIGHT],e[Ye.FAR_TOP_RIGHT],t[di.TOP]),Qo(e[Ye.NEAR_BOTTOM_LEFT],e[Ye.NEAR_BOTTOM_RIGHT],e[Ye.NEAR_TOP_RIGHT],t[di.NEAR]),Qo(e[Ye.FAR_BOTTOM_RIGHT],e[Ye.FAR_BOTTOM_LEFT],e[Ye.FAR_TOP_LEFT],t[di.FAR])}function X0(t,e){for(let r=0;r<WS;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function dke(t,e){return m_e(t,uke(e,g_e.get()))}function kEt(t,e){for(let r=0;r<WS;r++){const i=t[r];if(!C6e(i,e))return!1}return!0}function pke(t,e,r){return m_e(t,hke(e,r,g_e.get()))}function f_e(t,e){for(let r=0;r<WS;r++)if(pi(t[r],e)>0)return!1;return!0}function m_e(t,e){for(let r=0;r<WS;r++)if(!E6e(t[r],e))return!1;return!0}var di,Ye;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(di||(di={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Ye||(Ye={}));const fke={bottom:[Ye.FAR_BOTTOM_RIGHT,Ye.NEAR_BOTTOM_RIGHT,Ye.NEAR_BOTTOM_LEFT,Ye.FAR_BOTTOM_LEFT],near:[Ye.NEAR_BOTTOM_LEFT,Ye.NEAR_BOTTOM_RIGHT,Ye.NEAR_TOP_RIGHT,Ye.NEAR_TOP_LEFT],far:[Ye.FAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_LEFT,Ye.FAR_TOP_LEFT,Ye.FAR_TOP_RIGHT],right:[Ye.NEAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_RIGHT,Ye.FAR_TOP_RIGHT,Ye.NEAR_TOP_RIGHT],left:[Ye.FAR_BOTTOM_LEFT,Ye.NEAR_BOTTOM_LEFT,Ye.NEAR_TOP_LEFT,Ye.FAR_TOP_LEFT],top:[Ye.FAR_TOP_LEFT,Ye.NEAR_TOP_LEFT,Ye.NEAR_TOP_RIGHT,Ye.FAR_TOP_RIGHT]},WS=6,mke=8,gke=[Nt(-1,-1,-1,1),Nt(1,-1,-1,1),Nt(1,1,-1,1),Nt(-1,1,-1,1),Nt(-1,-1,1,1),Nt(1,-1,1,1),Nt(1,1,1,1),Nt(-1,1,1,1)],g_e=new Ug(j5),yke=h_e();function _ke(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function vke(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function bke(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function wke(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var uB;let lt=uB=class extends xe{constructor(t={}){super(t),this._center=C(),this._up=C(),this._viewUp=C(),this._viewForward=C(),this._viewRight=C(),this._ray=kn(),this._viewport=Nt(0,0,1,1),this._padding=Nt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=cr(1,1e3),this._viewDirty=!0,this._viewMatrix=ve(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ve(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ve(),this._frustumDirty=!0,this._frustum=TO(),this._fullViewport=Zt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return he(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){$s(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=$b(Zt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&$D(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=$b(Zt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&$D(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[er.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[er.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[er.RIGHT]+this._padding[er.LEFT]}set fullWidth(t){this.width=t-(this._padding[er.RIGHT]+this._padding[er.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[er.TOP]+this._padding[er.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[er.TOP]+this._padding[er.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[er.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[er.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){i2(this._padding,t)||(this._viewport[0]+=t[er.LEFT]-this._padding[er.LEFT],this._viewport[1]+=t[er.BOTTOM]-this._padding[er.BOTTOM],this._viewport[2]-=t[er.RIGHT]+t[er.LEFT]-(this._padding[er.RIGHT]+this._padding[er.LEFT]),this._viewport[3]-=t[er.TOP]+t[er.BOTTOM]-(this._padding[er.TOP]+this._padding[er.BOTTOM]),oh(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(si(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=zme(ve(),-i*(1+2*this._padding[er.LEFT]/t),i*(1+2*this._padding[er.RIGHT]/t),-r*(1+2*this._padding[er.BOTTOM]/e),r*(1+2*this._padding[er.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&nW(n,s)?n:s}get inverseProjectionMatrix(){return bn(ve(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ve()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return bke(this._fov,this.width,this.height)}set fovX(t){this._fov=_ke(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return wke(this._fov,this.width,this.height)}set fovY(t){this._fov=vke(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return fi(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(bn(this._viewInverseTransposeMatrix,this.viewMatrix),_c(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){re(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,oh(this._viewport,t.viewport),this.notifyChange("_viewport"),oh(this._padding,t.padding),this.notifyChange("_padding"),ln(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||($s(this._viewMatrix,t.viewMatrix),re(this._viewRight,t.viewRight),re(this._viewUp,t.viewUp),re(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(dN(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:($s(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),oh(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new uB().copyFrom(this)}equals(t){return ia(this.eye,t.eye)&&ia(this.center,t.center)&&ia(this.up,t.up)&&i2(this._viewport,t.viewport)&&i2(this._padding,t.padding)&&w0e(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||MD(t.screenPadding,this.screenPadding)>=1||MD(this.screenViewport,t.screenViewport)>=1)return!1;_n(Bo,t.eye,t.center),_n(lU,this.eye,this.center);const e=me(Bo,lU),r=UV(Bo),i=UV(lU),s=5e-4;return e*e>=(1-1e-10)*r*i&&Y4(t.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(fA(this.viewForward,he(Bo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Zi()){return t[0]=(this.padding[er.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[er.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[er.LEFT]+this.width*e,t[1]=this.padding[er.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Kt&&re(Kt,t),Kt[3]=1,Qc(Kt,Kt,this.projectionMatrix);const r=Math.abs(Kt[3]);ie(Kt,Kt,1/r);const i=this.fullViewport;e[0]=xt(0,i[0]+i[2],.5+.5*Kt[0]),e[1]=xt(0,i[1]+i[3],.5+.5*Kt[1]),e[2]=.5*(Kt[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Kt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Kt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Kt[2]=(2*t[2]-1)*t[3],Kt[3]=t[3],this.inverseProjectionMatrix!=null&&(Qc(Kt,Kt,this.inverseProjectionMatrix),e[0]=Kt[0],e[1]=Kt[1],e[2]=Kt[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,cU),this.renderToScreen(cU,e),e}projectToRenderScreen(t,e){if(Kt[0]=t[0],Kt[1]=t[1],Kt[2]=t[2],Kt[3]=1,Qc(Kt,Kt,this.viewProjectionMatrix),Kt[3]===0)return null;ie(Kt,Kt,1/Math.abs(Kt[3]));const r=this.fullViewport;return"x"in e?(e.x=xt(0,r[0]+r[2],.5+.5*Kt[0]),e.y=xt(0,r[1]+r[3],.5+.5*Kt[1])):(e[0]=xt(0,r[0]+r[2],.5+.5*Kt[0]),e[1]=xt(0,r[1]+r[3],.5+.5*Kt[1]),e.length>2&&(e[2]=.5*(Kt[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,cU),e)}unprojectFromRenderScreen(t,e){if(si(BP,this.projectionMatrix,this.viewMatrix),!bn(BP,BP))return null;const r=this.fullViewport;return Kt[0]=2*(t[0]-r[0])/r[2]-1,Kt[1]=2*(t[1]-r[1])/r[3]-1,Kt[2]=2*t[2]-1,Kt[3]=1,Qc(Kt,Kt,BP),Kt[3]===0?null:(e[0]=Kt[0]/Kt[3],e[1]=Kt[1]/Kt[3],e[2]=Kt[2]/Kt[3],e)}constrainWindowSize(t,e,r,i){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(t){t===Ie.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){he(Bo,this.center,this.eye);const t=Ee(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(me(Bo,this.center))>.9999*Ee(Bo)*t||(ot(this._up,Bo,this.center),ot(this._up,this._up,Bo),ge(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Ng(Bo,this.eye,this.center),Math.abs(Bo[2])<=.9999&&(ie(Bo,Bo,Bo[2]),se(this._up,-Bo[0],-Bo[1],1-Bo[2]),ge(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ia(t,e)||(re(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):J.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(d_e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(x5(this._viewMatrix,this.eye,this.center,this.up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],lt.prototype,"_center",void 0),u([d()],lt.prototype,"_up",void 0),u([d()],lt.prototype,"_viewport",void 0),u([d()],lt.prototype,"_padding",void 0),u([d()],lt.prototype,"_fov",void 0),u([d()],lt.prototype,"_nearFar",void 0),u([d()],lt.prototype,"_pixelRatio",void 0),u([d()],lt.prototype,"pixelRatio",null),u([d()],lt.prototype,"eye",null),u([d()],lt.prototype,"center",null),u([d()],lt.prototype,"up",null),u([d({readOnly:!0})],lt.prototype,"nearFar",null),u([d()],lt.prototype,"near",null),u([d()],lt.prototype,"far",null),u([d()],lt.prototype,"viewport",null),u([d({readOnly:!0})],lt.prototype,"screenViewport",null),u([d({readOnly:!0})],lt.prototype,"screenPadding",null),u([d()],lt.prototype,"x",null),u([d()],lt.prototype,"y",null),u([d()],lt.prototype,"width",null),u([d()],lt.prototype,"height",null),u([d()],lt.prototype,"fullWidth",null),u([d()],lt.prototype,"fullHeight",null),u([d({readOnly:!0})],lt.prototype,"_aspect",null),u([d()],lt.prototype,"padding",null),u([d({readOnly:!0})],lt.prototype,"projectionMatrix",null),u([d({readOnly:!0})],lt.prototype,"inverseProjectionMatrix",null),u([d()],lt.prototype,"fov",null),u([d()],lt.prototype,"fovX",null),u([d()],lt.prototype,"fovY",null),lt=uB=u([R("esri.views.3d.webgl-engine.lib.Camera")],lt);const Kt=Zt(),BP=ve(),Bo=C(),lU=C(),cU=Fo();var er;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(er||(er={}));var ce;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(ce||(ce={}));var st;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(st||(st={}));let tX=class{constructor(e=C()){this.intensity=e}},y_e=class{constructor(e=C(),r=Ae(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},pN=class{constructor(e=C(),r=Ae(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}},__e=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function xke(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function uU(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function l2(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function v_e(t){return(t+1)*(t+1)}function Tke(t){return ye(Math.floor(Math.sqrt(t)-1),0,2)}function b_e(t,e,r){const i=t[0],s=t[1],n=t[2],o=r||[];return o.length=v_e(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function Ske(t,e){const r=v_e(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function Eke(t,e){const r=Tke(e.r.length);for(const i of t)na(hB,i.direction),b_e(hB,r,eg),xke(eg,eL),uU(eg,i.intensity[0],Dw),l2(e.r,Dw),uU(eg,i.intensity[1],Dw),l2(e.g,Dw),uU(eg,i.intensity[2],Dw),l2(e.b,Dw);return e}function Cke(t,e){b_e(hB,0,eg);for(const r of t)e.r[0]+=eg[0]*eL[0]*r.intensity[0]*4*Math.PI,e.g[0]+=eg[0]*eL[0]*r.intensity[1]*4*Math.PI,e.b[0]+=eg[0]*eL[0]*r.intensity[2]*4*Math.PI;return e}function Ake(t,e,r,i){Ske(e,i),se(r.intensity,0,0,0);let s=!1;const n=Oke,o=Rke,a=Pke;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof pN&&!s?(re(r.direction,l.direction),re(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof pN||l instanceof y_e?n.push(l):l instanceof tX?o.push(l):l instanceof __e&&a.push(l);Eke(n,i),Cke(o,i);for(const l of a)l2(i.r,l.r),l2(i.g,l.g),l2(i.b,l.b)}const Oke=[],Rke=[],Pke=[],eg=[0],Dw=[0],hB=C(),eL=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Ree=class{constructor(){this.color=C(),this.intensity=1}},Mke=class{constructor(){this.direction=C(),this.ambient=new Ree,this.diffuse=new Ree}};const w_e=.4;let hU=class{constructor(){this._shOrder=2,this._legacy=new Mke,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new __e,this._mainLight=new pN(C(),Ae(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Ake(e,this._shOrder,this._mainLight,this._sphericalHarmonics),re(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,ie(this._legacy.diffuse.color,this._mainLight.intensity,r),re(GP,this._legacy.diffuse.color),ie(GP,GP,w_e*this.globalFactor),le(this._legacy.ambient.color,this._legacy.ambient.color,GP)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),re(this._mainLight.direction,e.mainLight.direction),re(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(Br(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=xt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=xt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),re(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=xt(e.globalFactor,r.globalFactor,i),this.noonFactor=xt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=xt(e.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=xt(e.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=xt(e.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}};const GP=C();let H5=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=ce.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=st.NONE,this.alignPixelEnabled=!1,this._camera=new lt,this._inverseViewport=Ue(),this.oldLighting=new hU,this.newLighting=new hU,this._fadedLighting=new hU,this._lighting=this.newLighting,this.ssr=new cke,this.multipassTerrain=new ake,this.multipassGeometry=new oke,this.overlays=[],this.cloudsFade=new _ze}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},al=class extends xe{constructor(e){super(e),this._handles=new Pi,this._techniques=new Array,this._techniqueConfiguration=new QI,this._bindParameters=new H5(null,null,null),this._passParameters=new i_e,this._drawParameters=new s_e,this._weatherTile=Ue(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=xt(Xo.default.coverage[0],Xo.default.coverage[1],.5),this.density=xt(Xo.default.density[0],Xo.default.density[1],.5),this.absorption=xt(Xo.default.absorption[0],Xo.default.absorption[1],.5),this.cloudSize=xt(Xo.default.cloudSize[0],Xo.default.cloudSize[1],.5),this.detailSize=xt(Xo.default.detailSize[0],Xo.default.detailSize[1],.5),this.smoothness=xt(Xo.default.smoothness[0],Xo.default.smoothness[1],.5),this.cloudHeight=xt(Xo.default.cloudHeight[0],Xo.default.cloudHeight[1],.5),this.raymarchingSteps=Xo.default.raymarchingSteps,this._viewMatrix=ve(),this._dirty=!1,this.running=!1,this._vao=Cl(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===kb.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new n_e({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;sr(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),x0e(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Dr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(dt.CLOUDS_GENERATOR,this),ue(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Vr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>ki(e)),this._frameBufferCube=Fe(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Pe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case _l.SIXTEEN:return 1;case _l.HUNDRED:return 4;case _l.COUNT:case _l.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new u3({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new _r(e);r.target=ns.TEXTURE_CUBE_MAP,r.wrapMode=Lt.CLAMP_TO_EDGE,this._frameBufferCube=new nn(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Fe(this._frameBufferCube)}applyPreset(e,r){const i=e.median,s=n=>{const o=xt(n[0],n[1],i);return r<.5?xt(n[0],o,2*r):xt(o,n[1],2*(r-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),ln(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return zo.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=As.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,s=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const h=$ke[this._faceIndex],p=Ike[this._faceIndex];Bme(this._viewMatrix,Lke,h,p),Th(this._drawParameters.viewMatrix,this._viewMatrix);const f=ns.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=As.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),zo.YIELD}};u([d({constructOnly:!0})],al.prototype,"context",void 0),u([d({constructOnly:!0})],al.prototype,"view",void 0),u([d({constructOnly:!0})],al.prototype,"requestRender",void 0),u([d()],al.prototype,"coverage",void 0),u([d()],al.prototype,"density",void 0),u([d()],al.prototype,"absorption",void 0),u([d()],al.prototype,"cloudSize",void 0),u([d()],al.prototype,"detailSize",void 0),u([d()],al.prototype,"smoothness",void 0),u([d()],al.prototype,"cloudHeight",void 0),u([d()],al.prototype,"raymarchingSteps",void 0),u([d()],al.prototype,"running",void 0),al=u([R("esri.views.3d.environment.CloudsGenerator")],al);const $ke=[Wr(1,0,0),Wr(-1,0,0),Wr(0,1,0),Wr(0,-1,0),Wr(0,0,1)],Ike=[Wr(0,1,0),Wr(0,1,0),Wr(0,0,-1),Wr(0,0,1),Wr(0,1,0)],Lke=eX();let x_e=class extends Kr{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function Dke(){const t=new br;t.attributes.add(E.POSITION,"vec2"),t.include(Tf,{textureCoordinateType:Rs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Di("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Di("inverseViewMatrix",(i,s)=>GS(Nke,s.camera.viewMatrix))),e.code.add(b`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Oe("atmosphereC",i=>i.atmosphereC),new Vt("cameraPosition",(i,s)=>s.camera.eye),new Tr("nearFar",(i,s)=>s.camera.nearFar),new Je("depthTexture",i=>i.depthTexture),new Oe("fogStrength",i=>i.fogStrength),new Oe("fogAmount",i=>i.fogAmount),new Vt("fogColor",i=>i.fogColor)),t.include(k5),r.include(hu),r.code.add(b`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(b`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(b`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const Nke=ve(),Fke=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:x_e,build:Dke},Symbol.toStringTag,{value:"Module"}));let T_e=class S_e extends Rr{constructor(e){super(e,new ca,()=>this.destroy())}initializeProgram(e){return new Er(e.rctx,S_e.shader.get().build(),vr)}initializePipeline(){return Ot({blending:_o(be.SRC_ALPHA,be.ZERO,be.ONE_MINUS_SRC_ALPHA,be.ONE),colorWrite:Gt})}};T_e.shader=new Sr(Fke,()=>ae(()=>import("./Fog.glsl-ea70ebee.js"),[]));const Uke=.95,Vke=1;let t1=class extends xe{constructor(e){super(e),this._passParameters=new x_e;const r=e.context.renderContext.rctx;this._vao=Cl(r,wR),this._technique=new T_e(e);const i=Dr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+b0}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Et.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;ge(Pee,i.eye);const s=Math.max(0,me(Pee,e.bindParameters.lighting.mainLight.direction)),n=r.color;ie(Mee,n,.1),Br(this._passParameters.fogColor,Mee,n,s);const o=Ee(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-nO(Uke*nf,Vke*nf,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],t1.prototype,"context",void 0),u([d({constructOnly:!0})],t1.prototype,"view",void 0),u([d({constructOnly:!0})],t1.prototype,"rctx",void 0),u([d({constructOnly:!0})],t1.prototype,"viewingMode",void 0),t1=u([R("esri.views.3d.environment.Fog")],t1);let zke=class{constructor(){this.color=C(),this.strength=0,this.amount=0}};const Pee=C(),Mee=C();let Lo=class extends ca{};u([F({constValue:!0})],Lo.prototype,"hasSliceHighlight",void 0),u([F({constValue:!1})],Lo.prototype,"hasSliceInVertexProgram",void 0),u([F({constValue:!1})],Lo.prototype,"instancedDoublePrecision",void 0),u([F({constValue:!1})],Lo.prototype,"hasModelTransformation",void 0),u([F({constValue:Jr.Pass})],Lo.prototype,"pbrTextureBindType",void 0);var Ff;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Ff||(Ff={}));let rX=class extends Lo{constructor(){super(...arguments),this.geometry=Ff.Cone}};u([F({count:Ff.COUNT})],rX.prototype,"geometry",void 0);var L;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(L||(L={}));function TR(t){t.attributes.add(E.POSITION,"vec3"),t.vertex.code.add(b`vec3 positionModel() { return position; }`)}function fN({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(b`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(b`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Mh=class extends ls{constructor(e,r){super(e,"mat3",Jr.Pass,(i,s,n)=>i.setUniformMatrix3fv(e,r(s,n)))}};function c2(t,e){t.include(TR);const r=t.vertex;r.include(fN,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new Vt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Vt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Mh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Di("transformProjFromView",i=>i.transformProjFromView),new xO("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new iu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new iu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(b`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(b`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?b`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:b`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Vt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(b`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let E_e=class extends Kr{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=Ni(),this.transformProjFromView=ve()}},C_e=class extends Kr{constructor(){super(...arguments),this.transformWorldFromModelRS=Ni(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}};function w_(t){t.varyings.add("linearDepth","float")}function Bb(t){t.vertex.uniforms.add(new Tr("nearFar",(e,r)=>r.camera.nearFar))}function q5(t){t.vertex.code.add(b`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function XS(t,e){const{vertex:r}=t;switch(e.output){case L.Color:if(e.receiveShadows)return w_(t),void r.code.add(b`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:return t.include(c2,e),w_(t),Bb(t),q5(t),void r.code.add(b`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(b`void forwardLinearDepth() {}`)}function vl(t){q5(t),t.vertex.code.add(b`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(b`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let iX=class extends Kr{constructor(){super(...arguments),this.texV=Ue(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new A_e}},A_e=class{constructor(){this.center=C(),this.v1=C(),this.v2=C()}};function kke(t){const e=new br,{vertex:r,fragment:i}=e;if(zg(r),t.geometry===Ff.Underground)e.attributes.add(E.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new Vt("cameraPosition",(s,n)=>n.camera.eye),new Oe("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),r.code.add(b`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(b`void main() {
fragColor = color;
}`);else{e.include(vl,t),e.attributes.add(E.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===Ff.Cylinder;r.uniforms.add(new Di("proj",(a,l)=>l.camera.projectionMatrix),new Di("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Vt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Vt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Vt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Tr("texV",a=>a.texV)),r.uniforms.add(new Oe("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(b`
		void main(void) {
      ${s?b`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:b`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${b.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${b.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Je("tex",a=>a.texture)),s||i.uniforms.add(new Oe("altitudeFade",a=>a.altitudeFade)),i.code.add(b`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?b`fragColor = atmosphereColor;`:b`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const Bke=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:A_e,SimpleAtmospherePassParameters:iX,build:kke},Symbol.toStringTag,{value:"Module"}));let mN=class O_e extends Rr{initializeProgram(e){return new Er(e.rctx,O_e.shader.get().build(this.configuration),vr)}initializePipeline(){return this.configuration.geometry===Ff.Cylinder?Ot({blending:_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),culling:VW,depthTest:{func:Qr.LEQUAL},colorWrite:Gt}):Ot({blending:_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.LEQUAL},colorWrite:Gt})}};mN.shader=new Sr(Bke,()=>ae(()=>import("./SimpleAtmosphere.glsl-7eb5ae2a.js"),[]));const Gke=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function xc(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).filter(i=>{var n;const s=(n=t.fields.get(i))==null?void 0:n.optional;return!(s&&s.glPadding)}).map(i=>{const s=t.fields.get(i),n=s.constructor.ElementCount,o=jke(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new po(i,n,o,a,r,l,e)})}function jke(t){const e=Hke[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const Hke={u8:Ke.UNSIGNED_BYTE,u16:Ke.UNSIGNED_SHORT,u32:Ke.UNSIGNED_INT,i8:Ke.BYTE,i16:Ke.SHORT,i32:Ke.INT,f32:Ke.FLOAT};let sX=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};sX.ElementCount=9;let nX=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};nX.ElementCount=16;let Gg=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};Gg.ElementCount=1;let jg=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,sr(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};jg.ElementCount=2;let Hg=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,se(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=s}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Hg.ElementCount=3;let qg=class{constructor(e,r,i=0,s,n){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,s,this.stride,s+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,bi(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};qg.ElementCount=4;let W5=class R_e extends Gg{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}static fromTypedArray(e,r){return new R_e(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};W5.ElementType="f32";let F_=class dB extends jg{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(dB,e,r)}static fromTypedArray(e,r){return new dB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};F_.ElementType="f32";let on=class pB extends Hg{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(pB,e,r)}static fromTypedArray(e,r){return new pB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};on.ElementType="f32";let ip=class fB extends qg{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(fB,e,r)}static fromTypedArray(e,r){return new fB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ip.ElementType="f32";let x_=class mB extends sX{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(mB,e,r)}static fromTypedArray(e,r){return new mB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};x_.ElementType="f32";let oX=class gB extends sX{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(gB,e,r)}static fromTypedArray(e,r){return new gB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};oX.ElementType="f64";let aX=class yB extends nX{constructor(e,r=0,i,s){super(Float32Array,e,r,i,s),this.elementType="f32"}slice(e,r){return this.sliceBuffer(yB,e,r)}static fromTypedArray(e,r){return new yB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};aX.ElementType="f32";let SO=class _B extends nX{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(_B,e,r)}static fromTypedArray(e,r){return new _B(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};SO.ElementType="f64";let lX=class vB extends Gg{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(vB,e,r)}static fromTypedArray(e,r){return new vB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lX.ElementType="f64";let cX=class bB extends jg{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(bB,e,r)}static fromTypedArray(e,r){return new bB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cX.ElementType="f64";let Eh=class wB extends Hg{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(wB,e,r)}static fromTypedArray(e,r){return new wB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Eh.ElementType="f64";let X5=class xB extends qg{constructor(e,r=0,i,s){super(Float64Array,e,r,i,s),this.elementType="f64"}slice(e,r){return this.sliceBuffer(xB,e,r)}static fromTypedArray(e,r){return new xB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};X5.ElementType="f64";let nS=class TB extends Gg{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(TB,e,r)}static fromTypedArray(e,r){return new TB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nS.ElementType="u8";let Z5=class SB extends jg{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(SB,e,r)}static fromTypedArray(e,r){return new SB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Z5.ElementType="u8";let Y5=class EB extends Hg{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(EB,e,r)}static fromTypedArray(e,r){return new EB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Y5.ElementType="u8";let aa=class CB extends qg{constructor(e,r=0,i,s){super(Uint8Array,e,r,i,s),this.elementType="u8"}slice(e,r){return this.sliceBuffer(CB,e,r)}static fromTypedArray(e,r){return new CB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};aa.ElementType="u8";let J5=class AB extends Gg{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(AB,e,r)}static fromTypedArray(e,r){return new AB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};J5.ElementType="u16";let uX=class OB extends jg{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(OB,e,r)}static fromTypedArray(e,r){return new OB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uX.ElementType="u16";let Q5=class RB extends Hg{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(RB,e,r)}static fromTypedArray(e,r){return new RB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Q5.ElementType="u16";let SR=class PB extends qg{constructor(e,r=0,i,s){super(Uint16Array,e,r,i,s),this.elementType="u16"}slice(e,r){return this.sliceBuffer(PB,e,r)}static fromTypedArray(e,r){return new PB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};SR.ElementType="u16";let K5=class MB extends Gg{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(MB,e,r)}static fromTypedArray(e,r){return new MB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};K5.ElementType="u32";let hX=class $B extends jg{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer($B,e,r)}static fromTypedArray(e,r){return new $B(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hX.ElementType="u32";let P_e=class IB extends Hg{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(IB,e,r)}static fromTypedArray(e,r){return new IB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};P_e.ElementType="u32";let M_e=class LB extends qg{constructor(e,r=0,i,s){super(Uint32Array,e,r,i,s),this.elementType="u32"}slice(e,r){return this.sliceBuffer(LB,e,r)}static fromTypedArray(e,r){return new LB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};M_e.ElementType="u32";let dX=class DB extends Gg{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(DB,e,r)}static fromTypedArray(e,r){return new DB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dX.ElementType="i8";let eF=class NB extends jg{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(NB,e,r)}static fromTypedArray(e,r){return new NB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};eF.ElementType="i8";let $_e=class FB extends Hg{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(FB,e,r)}static fromTypedArray(e,r){return new FB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};$_e.ElementType="i8";let I_e=class UB extends qg{constructor(e,r=0,i,s){super(Int8Array,e,r,i,s),this.elementType="i8"}slice(e,r){return this.sliceBuffer(UB,e,r)}static fromTypedArray(e,r){return new UB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};I_e.ElementType="i8";let L_e=class VB extends Gg{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(VB,e,r)}static fromTypedArray(e,r){return new VB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};L_e.ElementType="i16";let ER=class zB extends jg{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(zB,e,r)}static fromTypedArray(e,r){return new zB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ER.ElementType="i16";let D_e=class kB extends Hg{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(kB,e,r)}static fromTypedArray(e,r){return new kB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};D_e.ElementType="i16";let N_e=class BB extends qg{constructor(e,r=0,i,s){super(Int16Array,e,r,i,s),this.elementType="i16"}slice(e,r){return this.sliceBuffer(BB,e,r)}static fromTypedArray(e,r){return new BB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};N_e.ElementType="i16";let F_e=class GB extends Gg{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(GB,e,r)}static fromTypedArray(e,r){return new GB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};F_e.ElementType="i32";let U_e=class jB extends jg{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(jB,e,r)}static fromTypedArray(e,r){return new jB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};U_e.ElementType="i32";let V_e=class HB extends Hg{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(HB,e,r)}static fromTypedArray(e,r){return new HB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};V_e.ElementType="i32";let z_e=class qB extends qg{constructor(e,r=0,i,s){super(Int32Array,e,r,i,s),this.elementType="i32"}slice(e,r){return this.sliceBuffer(qB,e,r)}static fromTypedArray(e,r){return new qB(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};z_e.ElementType="i32";function $ee(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Iee=class k_e{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const s=e.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new k_e(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}return this}},B_e=class G_e{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:Xke(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,F_,r),this}vec2f64(e,r){return this._appendField(e,cX,r),this}vec3f(e,r){return this._appendField(e,on,r),this}vec3f64(e,r){return this._appendField(e,Eh,r),this}vec4f(e,r){return this._appendField(e,ip,r),this}vec4f64(e,r){return this._appendField(e,X5,r),this}mat3f(e,r){return this._appendField(e,x_,r),this}mat3f64(e,r){return this._appendField(e,oX,r),this}mat4f(e,r){return this._appendField(e,aX,r),this}mat4f64(e,r){return this._appendField(e,SO,r),this}vec4u8(e,r){return this._appendField(e,aa,r),this}f32(e,r){return this._appendField(e,W5,r),this}f64(e,r){return this._appendField(e,lX,r),this}u8(e,r){return this._appendField(e,nS,r),this}u16(e,r){return this._appendField(e,J5,r),this}i8(e,r){return this._appendField(e,dX,r),this}vec2i8(e,r){return this._appendField(e,eF,r),this}vec2i16(e,r){return this._appendField(e,ER,r),this}vec2u8(e,r){return this._appendField(e,Z5,r),this}vec4u16(e,r){return this._appendField(e,SR,r),this}u32(e,r){return this._appendField(e,K5,r),this}_appendField(e,r,i){if(this._fields.has(e))return void tt(!1,`${e} already added to vertex buffer layout`);const s=r.ElementCount*$ee(r.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:r,offset:n,optional:i})}createBuffer(e){return new Iee(this,e)}createView(e){return new Iee(this,e)}clone(){const e=new G_e;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,$ee(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function ji(){return new B_e}let qke=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const s={...r,constructor:j_e(r.constructor)};this.fields.push([i,s])}),this.stride=e.stride}};const Wke=[W5,F_,on,ip,x_,aX,lX,cX,Eh,X5,oX,SO,nS,Z5,Y5,aa,J5,uX,Q5,SR,K5,hX,P_e,M_e,dX,eF,$_e,I_e,L_e,ER,D_e,N_e,F_e,U_e,V_e,z_e];function j_e(t){return`${t.ElementType}_${t.ElementCount}`}function Xke(t){return H_e.get(t)}const H_e=new Map;Wke.forEach(t=>H_e.set(j_e(t),t));function Uo(t,e=!1){return t<=au?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function q_e(t){return(Jd(t)?t.length:t.byteLength/8)<=au?Array.from(t):new Float64Array(t)}function hh(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function fCt(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function mCt(t){return Array.isArray(t)?new Float64Array(t):t}function Ji(t,e=!1){return t<=au?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function gCt(t){return Jd(t)?t.length<au?t:new Float32Array(t):t.length<au?Array.from(t):t}function Lee(t){return(Jd(t)?t.length:t.byteLength/8)<=au?Array.from(t):new Float32Array(t)}function gN(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Ef(t){return Jd(t)?t.length<au?t:Dee(t):t.length<au?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:Dee(t)}function Dee(t){let e=!0;for(const r of t){if(r>=65536)return Jd(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function yN(t){return t<=au?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function Zke(t){return t<=au?new Array(t):new Uint32Array(t)}let Nw=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const W_e=[0],dU=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function oS(t){if(t===1)return W_e;if(t<au)return Array.from(new Uint16Array(dU.buffer,0,t));if(t<dU.length)return new Uint16Array(dU.buffer,0,t);if(t>Nw.length){const e=Math.max(2*Nw.length,t);Nw=new Uint32Array(e);for(let r=0;r<Nw.length;r++)Nw[r]=r}return new Uint32Array(Nw.buffer,0,t)}let jP=new Uint8Array(65536);function ZS(t){if(t===1)return W_e;if(t<au)return new Array(t).fill(0);if(t>jP.length){const e=Math.max(2*jP.length,t);jP=new Uint8Array(e)}return new Uint8Array(jP.buffer,0,t)}let Ve=class{constructor(e,r,i=!1,s=r){this.data=e,this.size=r,this.exclusive=i,this.stride=s}};var WB;(function(t){function e(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=s,t.subtract=n})(WB||(WB={}));var os;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(os||(os={}));function Yke(t){if(t.length<au)return Array.from(t);if(Jd(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return D4(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let X_e=class Z_e{constructor(e,r,i,s){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,tt(e.length>=1),tt(i.length%this._numIndexPerPrimitive==0),tt(i.length>=e.length*this._numIndexPerPrimitive),tt(s.size===3||s.size===4);const{data:n,size:o}=s,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];Q_.clear(),Q_.push(l);const c=Ae(n[l],n[l+1],n[l+2]),h=Ms(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[y+_],Q_.push(l);let v=n[l];c[0]=Math.min(v,c[0]),h[0]=Math.max(v,h[0]),v=n[l+1],c[1]=Math.min(v,c[1]),h[1]=Math.max(v,h[1]),v=n[l+2],c[2]=Math.min(v,c[2]),h[2]=Math.max(v,h[2])}}this.bbMin=c,this.bbMax=h;const p=Br(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Q_.length;++m){l=Q_.at(m);const y=n[l]-p[0],_=n[l+1]-p[1],v=n[l+2]-p[2],w=y*y+_*_+v*v;if(w<=f)continue;const T=Math.sqrt(w),x=.5*(T-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const S=x/T;p[0]+=y*S,p[1]+=_*S,p[2]+=v*S}this.center=p,Q_.clear()}getChildren(){if(this._children||ho(this.bbMin,this.bbMax)<=1)return this._children;const e=Br(C(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],_=n[f+2];for(let v=1;v<this._numIndexPerPrimitive;++v){f=o*this.indices[p+v];const w=n[f],T=n[f+1],x=n[f+2];w<m&&(m=w),T<y&&(y=T),x<_&&(_=x)}m<e[0]&&(h|=1),y<e[1]&&(h|=2),_<e[2]&&(h|=4),i[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new Z_e(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Q_.prune()}};const Q_=new Bt({deallocator:null});let CR=class{constructor(){this.id=hc()}unload(){}};function Jke(t){return t?{p0:Ms(t.p0),p1:Ms(t.p1),p2:Ms(t.p2)}:{p0:C(),p1:C(),p2:C()}}function Nee(t,e,r){const i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-s*n)}function Qke(t,e,r){return he(pU,e,t),he(Fee,r,t),Ee(ot(pU,pU,Fee))/2}new Ug(op);new Ug(()=>Jke());const pU=C(),Fee=C();function Kke(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0),se(Hu,0,0,0);let n=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*i,c=e[a+1]*i,h=e[a+2]*i;se(Un,s[l],s[l+1],s[l+2]),se(tg,s[c],s[c+1],s[c+2]),se(HP,s[h],s[h+1],s[h+2]);const p=Qke(Un,tg,HP);p?(le(Un,Un,tg),le(Un,Un,HP),ie(Un,Un,1/3*p),le(r,r,Un),n+=p):(le(Hu,Hu,Un),le(Hu,Hu,tg),le(Hu,Hu,HP),o+=3)}return(o!==0||n!==0)&&(n!==0?(ie(r,r,1/n),!0):o!==0&&(ie(r,Hu,1/o),!0))}function eBe(t,e,r){if(!t||!e)return!1;const{size:i,data:s}=t;se(r,0,0,0);let n=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;n!==l&&(r[0]+=s[l],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&ie(r,r,1/o),o>0}function tBe(t,e,r,i){if(!t)return!1;se(i,0,0,0),se(Hu,0,0,0);let s=0,n=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(e?e[p]:p)*o,y=(e?e[f]:f)*o;Un[0]=a[m],Un[1]=a[m+1],Un[2]=a[m+2],tg[0]=a[y],tg[1]=a[y+1],tg[2]=a[y+2],ie(Un,le(Un,Un,tg),.5);const _=aR(Un,tg);_>0?(le(i,i,ie(Un,Un,_)),s+=_):s===0&&(le(Hu,Hu,Un),n++)}return s!==0?(ie(i,i,1/s),!0):n!==0&&(ie(i,Hu,1/n),!0)}const Un=C(),tg=C(),HP=C(),Hu=C();let _N=class{constructor(e){this.channel=e,this.id=hc()}};function XB(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function rBe(t,e){const r=t.length;for(let i=0;i<r;++i)GT[0]=t[i],e[i]=GT[0];return e}function iBe(t,e){const r=t.length;for(let i=0;i<r;++i)GT[0]=t[i],GT[1]=t[i]-GT[0],e[i]=GT[1];return e}const GT=new Float32Array(2);function ZB(t,e){return t==null&&(t=[]),t.push(e),t}function YB(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function sBe(t,e,r,i,s){qP[0]=t.get(e,0),qP[1]=t.get(e,1),qP[2]=t.get(e,2),XB(qP,K_,3),r.set(s,0,K_[0]),i.set(s,0,K_[1]),r.set(s,1,K_[2]),i.set(s,1,K_[3]),r.set(s,2,K_[4]),i.set(s,2,K_[5])}const qP=C(),K_=new Float32Array(6);let js=class Y_e extends CR{constructor(e,r,i=[],s=null,n=os.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=nBe(this._vertexAttributes),c=oS(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of i)c&&(this._indices.set(l,Ef(c)),l===E.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new Y_e(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:Yke(r.data)},this._vertexAttributes.set(e,r)),r}setAttributeData(e,r){const i=this._vertexAttributes.get(e);i&&this._vertexAttributes.set(e,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===os.Mesh?this._computeAttachmentOriginTriangles(e):this.type===os.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&$e(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return Kke(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(E.POSITION),i=this.indices.get(E.POSITION);return tBe(r,i,i&&oBe(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return eBe(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(E.POSITION),r=this.vertexAttributes.get(E.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===os.Mesh?3:1;tt(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const s=oS(e.length/i);return new X_e(s,i,e,r)}get transformation(){return this._transformation??sn}set transformation(e){this._transformation=e&&e!==sn?X2(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new _N($g.Highlight);return this.highlights=ZB(this.highlights,e),e}removeHighlight(e){this.highlights=YB(this.highlights,e)}};function nBe(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function oBe(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const Fw=WB,fU=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],aBe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],lBe=[0,0,1,0,1,1,0,1],cBe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],J_e=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)J_e[6*t+e]=t;const r1=new Array(36);for(let t=0;t<6;t++)r1[6*t]=0,r1[6*t+1]=1,r1[6*t+2]=2,r1[6*t+3]=2,r1[6*t+4]=3,r1[6*t+5]=0;function uBe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=fU[i][0]*e[0],r[3*i+1]=fU[i][1]*e[1],r[3*i+2]=fU[i][2]*e[2];return new js(t,[[E.POSITION,new Ve(r,3,!0)],[E.NORMAL,new Ve(aBe,3)],[E.UV0,new Ve(lBe,2)]],[[E.POSITION,cBe],[E.NORMAL,J_e],[E.UV0,r1]])}const mU=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],hBe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],dBe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],pBe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function fBe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=mU[i][0]*e[0],r[3*i+1]=mU[i][1]*e[1],r[3*i+2]=mU[i][2]*e[2];return new js(t,[[E.POSITION,new Ve(r,3,!0)],[E.NORMAL,new Ve(hBe,3)]],[[E.POSITION,dBe],[E.NORMAL,pBe]])}const tL=Wr(-.5,0,-.5),rL=Wr(.5,0,-.5),iL=Wr(0,0,.5),sL=Wr(0,.5,0),Uw=ss(),Vw=ss(),u2=ss(),h2=ss(),d2=ss();he(Uw,tL,sL),he(Vw,tL,rL),ot(u2,Uw,Vw),ge(u2,u2),he(Uw,rL,sL),he(Vw,rL,iL),ot(h2,Uw,Vw),ge(h2,h2),he(Uw,iL,sL),he(Vw,iL,tL),ot(d2,Uw,Vw),ge(d2,d2);const gU=[tL,rL,iL,sL],mBe=[0,-1,0,u2[0],u2[1],u2[2],h2[0],h2[1],h2[2],d2[0],d2[1],d2[2]],gBe=[0,1,2,3,1,0,3,2,1,3,0,2],yBe=[0,0,0,1,1,1,2,2,2,3,3,3];function _Be(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=gU[i][0]*e[0],r[3*i+1]=gU[i][1]*e[1],r[3*i+2]=gU[i][2]*e[2];return new js(t,[[E.POSITION,new Ve(r,3,!0)],[E.NORMAL,new Ve(mBe,3)]],[[E.POSITION,gBe],[E.NORMAL,yBe]])}function bCt(t,e,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),p=(c+1)*(h+1),f=Ji(3*p),m=Ji(3*p),y=Ji(2*p),_=[];let v=0;for(let S=0;S<=h;S++){const O=[],A=S/h,P=a+A*l,I=Math.cos(P);for(let V=0;V<=c;V++){const k=V/c,B=n+k*o,z=Math.cos(B)*I,Z=Math.sin(P),W=-Math.sin(B)*I;f[3*v]=z*e,f[3*v+1]=Z*e,f[3*v+2]=W*e,m[3*v]=z,m[3*v+1]=Z,m[3*v+2]=W,y[2*v]=k,y[2*v+1]=A,O.push(v),++v}_.push(O)}const w=new Array;for(let S=0;S<h;S++)for(let O=0;O<c;O++){const A=_[S][O],P=_[S][O+1],I=_[S+1][O+1],V=_[S+1][O];S===0?(w.push(A),w.push(I),w.push(V)):S===h-1?(w.push(A),w.push(P),w.push(I)):(w.push(A),w.push(P),w.push(I),w.push(I),w.push(V),w.push(A))}const T=[[E.POSITION,w],[E.NORMAL,w]],x=[[E.POSITION,new Ve(f,3,!0)],[E.NORMAL,new Ve(m,3,!0)]];return s.uv&&(x.push([E.UV0,new Ve(y,2,!0)]),T.push([E.UV0,w])),s.offset&&(T[0][0]=E.OFFSET,x[0][0]=E.OFFSET,T.push([E.POSITION,ZS(w.length)]),x.push([E.POSITION,new Ve(Float64Array.from(s.offset),3,!0)])),new js(t,x,T)}function vBe(t,e,r,i){const{vertexAttributes:s,indices:n}=Q_e(e,r,i);return new js(t,s,n)}function Q_e(t,e,r){const i=t;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=i*(1+Math.sqrt(5))/2;s=[-i,h,0,i,h,0,-i,-h,0,i,-h,0,0,-i,h,0,i,h,0,-i,-h,0,i,-h,h,0,-i,h,0,i,-h,0,-i,-h,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)Fw.scale(s,h,t/Fw.length(s,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const f=h.toString()+"."+p.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,Fw.add(s,3*h,s,3*p,s,m),Fw.scale(s,m,t/Fw.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<e;h++){const p=n.length,f=new Array(4*p);for(let m=0;m<p;m+=3){const y=n[m],_=n[m+1],v=n[m+2],w=a(y,_),T=a(_,v),x=a(v,y),S=4*m;f[S]=y,f[S+1]=w,f[S+2]=x,f[S+3]=_,f[S+4]=T,f[S+5]=w,f[S+6]=v,f[S+7]=x,f[S+8]=T,f[S+9]=w,f[S+10]=T,f[S+11]=x}n=f,o={}}const l=Lee(s);for(let h=0;h<l.length;h+=3)Fw.normalize(l,h);const c=[[E.POSITION,n],[E.NORMAL,n]];return{vertexAttributes:[[E.POSITION,new Ve(Lee(s),3,!0)],[E.NORMAL,new Ve(l,3,!0)]],indices:c}}function JB(t,e,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const p=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],f=s!=null&&s.length===2?s:[1,1],m=[[E.POSITION,new Ve(c,3,!0)],[E.NORMAL,new Ve(h,3,!0)],[E.UV0,new Ve(o,o.length)],[E.COLOR,new Ve(p,4,!0)],[E.SIZE,new Ve(f,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];m.push([E.AUXPOS1,new Ve(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];m.push([E.AUXPOS2,new Ve(y,4)])}return new js(t,m,null,null,os.Point,l)}const bBe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function wCt(t,e=bBe){const r=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)r[3*h+p]=e[h][p];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[E.POSITION,i],[E.NORMAL,n],[E.UV0,i],[E.COLOR,n]],c=[[E.POSITION,new Ve(r,3,!0)],[E.NORMAL,new Ve(s,3,!0)],[E.UV0,new Ve(o,2,!0)],[E.COLOR,new Ve(a,4,!0)]];return new js(t,c,l)}function Uee(t,e,r,i,s,n=!0,o=!0){let a=0;const l=r,c=e;let h=Wr(0,a,0),p=Wr(0,a+c,0),f=Wr(0,-1,0),m=Wr(0,1,0);s&&(a=c,p=Wr(0,0,0),h=Wr(0,a,0),f=Wr(0,1,0),m=Wr(0,-1,0));const y=[p,h],_=[f,m],v=i+2,w=Math.sqrt(c*c+l*l);if(s)for(let I=i-1;I>=0;I--){const V=I*(2*Math.PI/i),k=Wr(Math.cos(V)*l,a,Math.sin(V)*l);y.push(k);const B=Wr(c*Math.cos(V)/w,-l/w,c*Math.sin(V)/w);_.push(B)}else for(let I=0;I<i;I++){const V=I*(2*Math.PI/i),k=Wr(Math.cos(V)*l,a,Math.sin(V)*l);y.push(k);const B=Wr(c*Math.cos(V)/w,l/w,c*Math.sin(V)/w);_.push(B)}const T=new Array,x=new Array;if(n){for(let I=3;I<y.length;I++)T.push(1),T.push(I-1),T.push(I),x.push(0),x.push(0),x.push(0);T.push(y.length-1),T.push(2),T.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let I=3;I<y.length;I++)T.push(I),T.push(I-1),T.push(0),x.push(I),x.push(I-1),x.push(1);T.push(0),T.push(2),T.push(y.length-1),x.push(1),x.push(2),x.push(_.length-1)}const S=Ji(3*v);for(let I=0;I<v;I++)S[3*I]=y[I][0],S[3*I+1]=y[I][1],S[3*I+2]=y[I][2];const O=Ji(3*v);for(let I=0;I<v;I++)O[3*I]=_[I][0],O[3*I+1]=_[I][1],O[3*I+2]=_[I][2];const A=[[E.POSITION,T],[E.NORMAL,x]],P=[[E.POSITION,new Ve(S,3,!0)],[E.NORMAL,new Ve(O,3,!0)]];return new js(t,P,A)}function wBe(t,e,r,i,s,n,o){const a=s?uN(s):Wr(1,0,0),l=n?uN(n):Wr(0,0,0);o??(o=!0);const c=ss();ge(c,a);const h=ss();ie(h,c,Math.abs(e));const p=ss();ie(p,h,-.5),le(p,p,l);const f=Wr(0,1,0);Math.abs(1-me(c,f))<.2&&se(f,0,0,1);const m=ss();ot(m,c,f),ge(m,m),ot(f,m,c);const y=2*i+(o?2:0),_=i+(o?2:0),v=Ji(3*y),w=Ji(3*_),T=Ji(2*y),x=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(y-2)]=p[0],v[3*(y-2)+1]=p[1],v[3*(y-2)+2]=p[2],T[2*(y-2)]=0,T[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+h[0],v[3*(y-1)+1]=v[3*(y-2)+1]+h[1],v[3*(y-1)+2]=v[3*(y-2)+2]+h[2],T[2*(y-1)]=1,T[2*(y-1)+1]=1,w[3*(_-2)]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const O=(B,z,Z)=>{x[B]=z,S[B]=Z};let A=0;const P=ss(),I=ss();for(let B=0;B<i;B++){const z=B*(2*Math.PI/i);ie(P,f,Math.sin(z)),ie(I,m,Math.cos(z)),le(P,P,I),w[3*B]=P[0],w[3*B+1]=P[1],w[3*B+2]=P[2],ie(P,P,r),le(P,P,p),v[3*B]=P[0],v[3*B+1]=P[1],v[3*B+2]=P[2],T[2*B]=B/i,T[2*B+1]=0,v[3*(B+i)]=v[3*B]+h[0],v[3*(B+i)+1]=v[3*B+1]+h[1],v[3*(B+i)+2]=v[3*B+2]+h[2],T[2*(B+i)]=B/i,T[2*B+1]=1;const Z=(B+1)%i;O(A++,B,B),O(A++,B+i,B),O(A++,Z,Z),O(A++,Z,Z),O(A++,B+i,B),O(A++,Z+i,Z)}if(o){for(let B=0;B<i;B++){const z=(B+1)%i;O(A++,y-2,_-2),O(A++,B,_-2),O(A++,z,_-2)}for(let B=0;B<i;B++){const z=(B+1)%i;O(A++,B+i,_-1),O(A++,y-1,_-1),O(A++,z+i,_-1)}}const V=[[E.POSITION,x],[E.NORMAL,S],[E.UV0,x]],k=[[E.POSITION,new Ve(v,3,!0)],[E.NORMAL,new Ve(w,3,!0)],[E.UV0,new Ve(T,2,!0)]];return new js(t,k,V)}function xCt(t,e,r,i,s,n,o=Wr(0,0,0)){const a=e.length,l=Ji(r.length*a*3+(6*i.length||0)),c=Ji(r.length*a*3+(i?6:0)),h=new Array,p=new Array;let f=0,m=0;const y=ss(),_=ss(),v=ss(),w=ss(),T=ss(),x=ss(),S=ss(),O=C(),A=ss(),P=ss(),I=ss(),V=ss(),k=ss(),B=Mr();se(A,0,1,0),he(_,r[1],r[0]),ge(_,_),n?(le(O,r[0],o),ge(v,O)):se(v,0,0,1),vN(_,v,A,A,T,v,Vee),re(w,v),re(V,T);for(let N=0;N<i.length;N++)ie(x,T,i[N][0]),ie(O,v,i[N][2]),le(x,x,O),le(x,x,r[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let N=0;N<s.length;N++)h.push(s[N][0]>0?s[N][0]:-s[N][0]-1+i.length),h.push(s[N][1]>0?s[N][1]:-s[N][1]-1+i.length),h.push(s[N][2]>0?s[N][2]:-s[N][2]-1+i.length),p.push(0),p.push(0),p.push(0);let z=i.length;const Z=i.length-1;for(let N=0;N<r.length;N++){let G=!1;N>0&&(re(y,_),N<r.length-1?(he(_,r[N+1],r[N]),ge(_,_)):G=!0,le(P,y,_),ge(P,P),le(I,r[N-1],w),bR(r[N],P,B),gw(B,uu(I,y),O)?(he(O,O,r[N]),ge(v,O),ot(T,P,v),ge(T,T)):vN(P,w,V,A,T,v,Vee),re(w,v),re(V,T)),n&&(le(O,r[N],o),ge(k,O));for(let X=0;X<a;X++)if(ie(x,T,e[X][0]),ie(O,v,e[X][1]),le(x,x,O),ge(S,x),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],le(x,x,r[N]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!G){const K=(X+1)%a;h.push(z+X),h.push(z+a+X),h.push(z+K),h.push(z+K),h.push(z+a+X),h.push(z+a+K);for(let ee=0;ee<6;ee++){const _e=h.length-6;p.push(h[_e+ee]-Z)}}z+=a}const W=r[r.length-1];for(let N=0;N<i.length;N++)ie(x,T,i[N][0]),ie(O,v,i[N][1]),le(x,x,O),le(x,x,W),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const H=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const Y=z-a;for(let N=0;N<s.length;N++)h.push(s[N][0]>=0?z+s[N][0]:-s[N][0]-1+Y),h.push(s[N][2]>=0?z+s[N][2]:-s[N][2]-1+Y),h.push(s[N][1]>=0?z+s[N][1]:-s[N][1]-1+Y),p.push(H),p.push(H),p.push(H);const M=[[E.POSITION,h],[E.NORMAL,p]],D=[[E.POSITION,new Ve(l,3,!0)],[E.NORMAL,new Ve(c,3,!0)]];return new js(t,D,M)}function TCt(t,e,r,i){tt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),tt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),tt(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),tt(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=Uo(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let h=0;h<e.length;h++){for(let p=0;p<3;p++)s[o++]=e[h][p];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([E.POSITION,n]),c.push([E.POSITION,new Ve(s,3,!0)]),r){const h=Ji(3*r.length);let p=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)h[p++]=r[f][m];l.push([E.NORMAL,n]),c.push([E.NORMAL,new Ve(h,3,!0)])}return i&&(c.push([E.COLOR,new Ve(i,4)]),l.push([E.COLOR,oS(i.length/4)])),new js(t,c,l,null,os.Line)}function xBe(t,e=t){const r=t.vertexAttributes,i=r.get(E.POSITION).data,s=r.get(E.NORMAL).data;if(s){const n=e.getMutableAttribute(E.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=e.getMutableAttribute(E.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function yU(t,e,r,i,s){return!(Math.abs(me(e,t))>s)&&(ot(r,t,e),ge(r,r),ot(i,r,t),ge(i,i),!0)}function vN(t,e,r,i,s,n,o){return yU(t,e,s,n,o)||yU(t,r,s,n,o)||yU(t,i,s,n,o)}const Vee=.99619469809;let TBe=class{constructor(e,r){this.type=Zo.Local,this._configuration=new rX,this._passParameters=new iX,this._configuration.geometry=Ff.Cylinder,this._technique=r.techniqueRepository.acquire(mN,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=Io(this._vao,"geometry");const s=new _r;s.wrapMode=Lt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Ct(i,s,Gke)}destroy(){this._passParameters.texture=Fe(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);SBe(zee,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",zee),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Et.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=Q_e(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=kee.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new ap(e,vr,{geometry:xc(kee)},{geometry:Ir.createVertex(e,xr.STATIC_DRAW,o.buffer)})}};function SBe(t,e){$s(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const zee=ve(),kee=ji().vec3f(E.POSITION),EBe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),WP=128,Bee=-rB,Gee=0,_U=50,CBe=()=>1-511/512,ABe=jI([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let OBe=class{constructor(e,r){this.view=e,this.type=Zo.Mars,this._passParameters=new iX,this._vaoCount=0,this._texV1=1;const i=Dr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Bee)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Gee)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Gee/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=ue(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),Cs),this._vao=this._createRibbon(s),this._vaoCount=Io(this._vao,"geometry"),this._fadeVao=Cl(s),this._fadeVaoCount=Io(this._fadeVao,"geometry");const n=new _r;n.wrapMode=Lt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Ct(s,n,EBe);const o=new rX;o.geometry=Ff.Cone,this._coneTechnique=this._techniqueRepository.acquire(mN,o),o.geometry=Ff.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(mN,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Fe(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(Et.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(Et.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=C(),i=this._planetRadius,s=Ee(e.eye),n=s-i;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(_U,n),a=i+Bee;this._passParameters.innerScale=RBe(i+o,i,a)-1,this._passParameters.altitudeFade=UW(n),ie(r,e.eye,(i+_U)/s),jee(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=CBe(),h=ABe(n);let p=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>_U){jee(e.eye,e.center,e.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=ye((m-1.5)/(l-1.5),0,1);p=this._texV0+y*c*this._texVScale,f=this._texV0+xt(this._texV1,l*h,y)*this._texVScale}sr(this._passParameters.texV,p,f)}_createRibbon(e){const r=Ji(3+3*WP*3),i=new Uint32Array(3*WP*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<WP;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===WP-1?1:l+3,h=15*o;i[h]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const s=Hee.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new ap(e,vr,{geometry:xc(Hee)},{geometry:Ir.createVertex(e,xr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,r,i,s){return le(zw,s.center,s.v2),ie(XP,zw,this._outerRimFactor),x5(vU,r,zw,i),dee(zw,vU,e.projectionMatrix,e.viewport,zw),dee(XP,vU,e.projectionMatrix,e.viewport,XP),fi(zw,XP)/e.height}};function jee(t,e,r,i,s){const n=Ee(t),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return ie(s.center,t,a/n),ot(l,t,e),ea(l)<1&&ot(l,t,r),ie(l,l,o/Ee(l)),ot(c,l,t),ie(c,c,o/Ee(c)),o}const vU=ve(),zw=C(),XP=C();function RBe(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const Hee=ji().vec3f(E.POSITION);var Ig;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Ig||(Ig={}));let QB=class extends ca{constructor(){super(...arguments),this.type=Ig.Rain}};u([F({count:Ig.COUNT})],QB.prototype,"type",void 0);function PBe(t){const e=new br;return e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Vt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Vt("offset",(r,i)=>MBe(r,i))),e.vertex.uniforms.add(new Oe("width",r=>r.width)),e.vertex.uniforms.add(new Di("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new Di("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Oe("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(b`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Ig.Rain?b`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Oe("opacity",r=>r.opacity),new Vt("particleColor",(r,i)=>$Be(i,t))),e.fragment.code.add(b`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Ig.Rain?b`d = 0.35 * smoothstep(0.5, 0.0, d);`:b`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function MBe(t,e){const r=e.camera.eye,i=.5*t.width,s=1/t.width,n=$de(KB,se(KB,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return _n(n,r,ie(n,n,t.width))}function $Be(t,e){const r=e.type===Ig.Rain?LBe:IBe,i=ie(KB,r,DBe),s=t.camera.eye;ge(qee,s);const n=Math.max(0,me(qee,t.lighting.mainLight.direction));return Br(i,i,r,n)}const KB=C(),qee=C(),IBe=Ae(1,1,1),LBe=Ae(.85,.85,.85),DBe=.7,NBe=Object.freeze(Object.defineProperty({__proto__:null,build:PBe},Symbol.toStringTag,{value:"Module"}));let FBe=class extends Kr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},e7=class K_e extends Rr{initializeProgram(e){return new Er(e.rctx,K_e.shader.get().build(this.configuration),nL)}initializePipeline(){return Ot({blending:_o(be.ONE,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.LEQUAL},colorWrite:Gt})}};e7.shader=new Sr(NBe,()=>ae(()=>import("./Precipitation.glsl-5aa1f2cb.js"),[]));const nL=new Map([[E.POSITION,0],[E.INSTANCEFEATUREATTRIBUTE,1]]);let eve=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},UBe=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},i1=class extends xe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new FBe,this._animation=new eve,this._updatingTracking=new bf,this._passParameters.time=0,this._passParameters.radius=Dr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=ki(this._snowTechniqueCached),this._rainTechniqueCached=ki(this._rainTechniqueCached),this._vao=Fe(this._vao),this._instanceIdBuffer=Fe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new QB;e.type=Ig.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(e7,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new QB;e.type=Ig.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(e7,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){var l;const s=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?xt(0,o,2*r):xt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*AH(this._animation.time)%1e5;const a=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),kW(n,nL,this._instanceIdBuffer,Wee,0),(l=n.capabilities.instancing)==null||l.drawArraysInstanced(Et.TRIANGLES,0,3,this._numParticles*r),BW(n,nL,this._instanceIdBuffer,Wee)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Ir.createVertex(e,xr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new ap(e,nL,{geometry:xc(VBe)},{geometry:Ir.createVertex(e,xr.STATIC_DRAW,r)})}};u([d({constructOnly:!0})],i1.prototype,"context",void 0),u([d({constructOnly:!0})],i1.prototype,"view",void 0),u([d({readOnly:!0})],i1.prototype,"updating",null),u([d()],i1.prototype,"_updatingTracking",void 0),i1=u([R("esri.views.3d.environment.Precipitation")],i1);const VBe=ji().vec3f(E.POSITION),Wee=xc(ji().f32(E.INSTANCEFEATUREATTRIBUTE),1);function zBe(){const t=new br;return t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.COLOR,"vec4"),t.attributes.add(E.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Di("transform",(e,r)=>kBe(e,r)),new rr("viewport",(e,r)=>r.camera.fullViewport),new Oe("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(b`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(b`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function kBe(t,e){return $s(hy,e.camera.projectionMatrix),hy[10]=24e-8-1,hy[11]=-1,hy[14]=(24e-8-2)*e.camera.near,si(hy,hy,e.camera.viewMatrix),si(hy,hy,t.modelMatrix)}const hy=ve(),BBe=Object.freeze(Object.defineProperty({__proto__:null,build:zBe},Symbol.toStringTag,{value:"Module"}));let GBe=class extends Kr{constructor(){super(...arguments),this.modelMatrix=ve()}},tve=class rve extends Rr{constructor(e){super(e,new ca,()=>this.destroy())}initializeProgram(e){return new Er(e.rctx,rve.shader.get().build(),vr)}initializePipeline(){return Ot({blending:_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.LEQUAL},colorWrite:Gt})}};tve.shader=new Sr(BBe,()=>ae(()=>import("./Stars.glsl-02197493.js"),[]));let n0=class extends xe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new GBe,this._updatingTracking=new bf}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=ou(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=ki(this._technique),this._vao=Fe(this._vao),ev=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Et.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||ev==null)return;this._technique=new tve({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=ev.byteLength/Xee;const r=new Float32Array(ev,0,2*this._numPoints),i=new Uint8Array(ev,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Vr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),s=$s(this._renderParameter.modelMatrix,qBe);q2(s,s,-i*Math.PI),si(s,HBe,s),q2(s,s,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,s){const n=Zee.createBuffer(s),o=n.position,a=n.color,l=n.size;for(let c=0;c<s;c++){const h=r[2*c],p=r[2*c+1];o.set(c,0,-Math.cos(h)*Math.sin(p)),o.set(c,1,-Math.sin(h)*Math.sin(p)),o.set(c,2,-Math.cos(p));const f=this._unpackUint8Attributes(i[c]),m=this._hexToRGB(jBe[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new ap(e,vr,{geometry:xc(Zee)},{geometry:Ir.createVertex(e,xr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(ev!=null)return null;const e=$S(async r=>{const{data:i}=await t$e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),ev=i});return e.promise.catch(r=>{gs(r)||J.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new U("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/Xee;if(r%1!=0||r>5e4||r<5e3)throw new U("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],n0.prototype,"view",void 0),u([d({constructOnly:!0})],n0.prototype,"requestRender",void 0),u([d({readOnly:!0})],n0.prototype,"updating",null),u([d()],n0.prototype,"_loadDataTask",void 0),u([d()],n0.prototype,"_updatingTracking",void 0),n0=u([R("esri.views.3d.environment.Stars")],n0);const jBe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],HBe=fW(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),qBe=fW(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Xee=9,Zee=ji().vec3f(E.POSITION).vec4u8(E.COLOR).f32(E.SIZE);let ev=null;function WBe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function bN(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function pX(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Wa()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function tF(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*h+o*a+s*c-n*l,t[1]=s*h+o*l+n*a-i*c,t[2]=n*h+o*c+i*l-s*a,t[3]=o*h-i*a-s*l-n*c,t}function XBe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-i*a,t}function ZBe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-n*a,t[1]=s*l+o*a,t[2]=n*l+i*a,t[3]=o*l-s*a,t}function YBe(t,e,r){r*=.5;const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function JBe(t,e){const r=e[0],i=e[1],s=e[2];return t[0]=r,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),t}function oL(t,e,r,i){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,h,p,f,m=r[0],y=r[1],_=r[2],v=r[3];return c=s*m+n*y+o*_+a*v,c<0&&(c=-c,m=-m,y=-y,_=-_,v=-v),1-c>Wa()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-i)*l)/h,f=Math.sin(i*l)/h):(p=1-i,f=i),t[0]=p*s+f*m,t[1]=p*n+f*y,t[2]=p*o+f*_,t[3]=p*a+f*v,t}function QBe(t){const e=oR,r=e(),i=e(),s=e(),n=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function KBe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-s*a,t[3]=n*a,t}function Uf(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function ive(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+o]-e[3*o+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}function e7e(t,e,r,i){const s=.5*Math.PI/180;e*=s,r*=s,i*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return t[0]=n*l*h-o*a*c,t[1]=o*a*h+n*l*c,t[2]=o*l*c-n*a*h,t[3]=o*l*h+n*a*c,t}function t7e(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const AR=oh,r7e=bi,i7e=dq,s7e=tF,n7e=$b,o7e=zde,a7e=J4,sve=pq,l7e=sve,nve=fq,c7e=nve,fX=Vde,u7e=i2,h7e=$D;function d7e(t,e,r){const i=me(e,r);return i<-.999999?(ot(yp,p7e,e),Zl(yp)<1e-6&&ot(yp,f7e,e),ge(yp,yp),bN(t,yp,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ot(yp,e,r),t[0]=yp[0],t[1]=yp[1],t[2]=yp[2],t[3]=1+i,fX(t,t))}const yp=C(),p7e=Ae(1,0,0),f7e=Ae(0,1,0);function m7e(t,e,r,i,s,n){return oL(Yee,e,s,n),oL(Jee,r,i,n),oL(t,Yee,Jee,2*n*(1-n)),t}const Yee=Rh(),Jee=Rh();function g7e(t,e,r,i){const s=y7e;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],fX(t,ive(t,s))}const y7e=Ni();Object.freeze(Object.defineProperty({__proto__:null,add:i7e,calculateW:JBe,conjugate:Uf,copy:AR,dot:o7e,equals:h7e,exactEquals:u7e,fromEuler:e7e,fromMat3:ive,getAxisAngle:pX,identity:WBe,invert:KBe,len:l7e,length:sve,lerp:a7e,mul:s7e,multiply:tF,normalize:fX,random:QBe,rotateX:XBe,rotateY:ZBe,rotateZ:YBe,rotationTo:d7e,scale:n7e,set:r7e,setAxes:g7e,setAxisAngle:bN,slerp:oL,sqlerp:m7e,sqrLen:c7e,squaredLength:nve,str:t7e},Symbol.toStringTag,{value:"Module"}));function Wg(t=v7e){return[t[0],t[1],t[2],t[3]]}function bU(t,e,r=Wg()){return re(r,t),r[3]=e,r}function Qee(t,e,r=Wg()){return ot(r,t,e),ge(r,r),r[3]=-Lde(t,e),r}function Kee(t,e,r=Wg()){return bN(ZP,t,ete(t)),bN(tte,e,ete(e)),tF(ZP,tte,ZP),_7e(r,ja(pX(r,ZP)))}function ICt(t,e,r,i=Wg()){return bU(Pde,t,YP),bU(Mde,e,rte),bU(cq,r,ite),Kee(YP,rte,YP),Kee(YP,ite,i),i}function LCt(t){return t}function DCt(t){return t[3]}function ete(t){return Ft(t[3])}function _7e(t,e){return t[3]=e,t}const v7e=[0,0,1,0],ZP=Rh(),tte=Rh();Wg();const YP=Wg(),rte=Wg(),ite=Wg();function b7e(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===Kl.FINISHED&&(t.fadeIn.factor=0,re(i,hf),t.fadeIn.stage=Kl.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=hn.FINISHED),t.fadeIn.stage===Kl.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(XW(t.data)&&t.renderingStage!==As.RENDERING||t.renderingStage===As.FADING_TEXTURE_CHANNELS)&&(re(i,hf),t.fadeIn.stage=Kl.FADE_IN,t.startTime=e,t.renderingStage===As.FADING_TEXTURE_CHANNELS&&(t.renderingStage=As.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===Kl.FADE_IN?t.fadeIn.factor=r?ye((e-t.startTime)/(ove*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===Kl.FADE_IN&&(t.fadeIn.stage=Kl.FINISHED,t.fadeIn.factor=1)}function w7e(t,e,r){const{fadeInOut:i,crossFade:s}=t;i.stage===hn.FINISHED&&(t.startTime=e,i.factor=1,i.stage=hn.FADE_OUT),i.factor>0&&i.stage===hn.FADE_OUT?i.factor=r?1-ye((e-t.startTime)/(C7e*r),0,1):0:(i.factor<=0&&i.stage===hn.FADE_OUT&&(i.factor=0,re(t.parallax.anchorPointClouds,hf)),i.factor<=0&&i.stage===hn.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=hn.SWITCH,t.crossFade.enabled=!1,s.factor=1),i.stage===hn.SWITCH&&(XW(t.data)&&t.renderingStage!==As.RENDERING||t.renderingStage===As.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=hn.FADE_IN,re(t.parallax.anchorPointClouds,hf),t.crossFade.enabled=!1,s.factor=1,t.renderingStage===As.FADING_TEXTURE_CHANNELS&&(t.renderingStage=As.SWITCH_CHANNELS)),i.factor<1&&i.stage===hn.FADE_IN?i.factor=r?ye((e-t.startTime)/(ove*r),0,1):1:i.factor>=1&&i.stage===hn.FADE_IN&&(i.stage=hn.FINISHED,i.factor=1))}function x7e(t,e,r,i){const{crossFade:s}=t,n=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(re(t.parallaxNew.anchorPointClouds,hf),t.startTime=e,s.factor=0,t.crossFade.enabled=!0),s.factor<1&&t.crossFade.enabled?s.factor=r?ye((e-t.startTime)/(A7e*r),0,1):1:s.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,s.factor=1,re(n,t.parallaxNew.anchorPointClouds),t.renderingStage===As.FADING_TEXTURE_CHANNELS&&(t.renderingStage=As.SWITCH_CHANNELS))}function ste(t,e,r,i){const s=t.fadeInOutHeight,n=s.stage===v_.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-n)/(O7e*i);s.factor+=e?-o:o}else s.factor=e?0:1;t.startTimeHeightFade=r,s.factor=ye(s.factor,0,1),s.stage=v_.HEIGHT_FADE}function T7e(t,e,r,i,s){t.renderingStage===As.FINISHED_RENDERING&&(t.renderingStage=As.FADING_TEXTURE_CHANNELS);const n=Ee(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=n-ir.radius>nf?1:0),t.isCameraPositionFinal=l_(t.cameraPositionLastFrame,e.eye),ge(hf,e.eye),ie(hf,hf,ir.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&re(o.anchorPointClouds,hf);const a=Ee(he(E7e,o.anchorPointClouds,hf));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==Kl.FINISHED?b7e(t,i,s):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==hn.FINISHED?w7e(t,i,s):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===As.FADING_TEXTURE_CHANNELS?x7e(t,i,s,(r!==$r.IDLE||!XW(t.data))&&t.renderingStage!==As.FADING_TEXTURE_CHANNELS):l=!1;const c=n-ir.radius;if((c>1.7*nf||c<-nf)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>nf||c<-.35*nf)&&t.fadeInOutHeight.factor<1?ste(t,!1,i,s):c<nf&&c>-.35*nf&&t.fadeInOutHeight.factor>0?ste(t,!0,i,s):t.fadeInOutHeight.stage=v_.FINISHED,t.renderingStage===As.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=As.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-ir.radius*ir.radius,0))/n,Qee(nte,o.anchorPointClouds,kw),lc(o.transform,sn,kw[3],kw),l){const{parallaxNew:h}=t;Qee(nte,h.anchorPointClouds,kw),lc(h.transform,sn,kw[3],kw)}re(t.cameraPositionLastFrame,e.eye)}function S7e(t){return t.crossFade.enabled||t.fadeInOut.stage!==hn.FINISHED||t.fadeIn.stage!==Kl.FINISHED||t.fadeInOutHeight.stage!==v_.FINISHED||t.renderingStage!==As.FINISHED}const nte=Ae(0,0,1),kw=Wg(),hf=C(),E7e=C(),ove=1,C7e=.5,A7e=1.3,O7e=1;let YS=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const s=this._outer.get(e);s?s.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Bs;function ote(t=!oe("disable-feature:high-quality-idle"),e=null){const r=new YS;return t?(r.set($r.IDLE,Bs.Antialiasing,e!=="low"),r.set($r.IDLE,Bs.HighResolutionAtmosphere,e!=="low"),r.set($r.IDLE,Bs.HighQualityTransparency,!0),r.set($r.IDLE,Bs.SSAO,!0),r.set($r.IDLE,Bs.WaterReflection,!0),r.set($r.IDLE,Bs.PhysicalPixelRendering,!oe("esri-mobile"))):(r.set($r.ANIMATING,Bs.HighResolutionShadows,!0),r.set($r.INTERACTING,Bs.HighResolutionShadows,!0)),r.set($r.IDLE,Bs.HighResolutionShadows,!0),r.set($r.IDLE,Bs.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Bs||(Bs={}));var p2;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(p2||(p2={}));var h3;const R7e=[ce.POSTPROCESSING_ENVIRONMENT_OPAQUE,ce.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let xo=h3=class extends xe{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new wU,this._newWeatherParameters=new wU,this._fadedWeatherParameters=new wU,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(R7e,this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Zo.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===Zo.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Ee(this.view.state.camera.eye)-Dr(this.view.spatialReference).radius<=nf}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new n0({view:t,requestRender:()=>this._setNeedsRender()}):(Pe(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Pe(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Pe(t),new i1({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Pe(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Pe(t),new al({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Pe(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Dr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Pe(t),new e1({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Pe(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new t1({context:r,view:e,rctx:i,viewingMode:s})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([ue(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),Cs),ue(()=>this._stars,e),ue(()=>this._precipitation,e),ue(()=>this._clouds,()=>this._updateWeather(),Vr),ue(()=>this._fog,()=>this._updateFogHaze(),Vr),ue(()=>this.view.state.mode,()=>{this._setNeedsRender()},Gr),ue(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Cs)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Pe(this._atmosphere),this._set("_stars",Pe(this._stars)),this._set("_precipitation",Pe(this._precipitation)),this._set("_clouds",Pe(this._clouds)),this._set("_cloudsComposition",Pe(this._cloudsComposition)),this._set("_fog",Pe(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=yze(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(T7e(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===As.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){var e,r,i,s,n,o,a,l,c;if(t.output===L.Color)switch(t.bindParameters.slot){case ce.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,((e=this.view)==null?void 0:e.qualitySettings.highResolutionAtmosphere)||((s=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer)==null?void 0:s.isFeatureEnabled(Bs.HighResolutionAtmosphere))),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),S7e(t.bindParameters.cloudsFade)&&this._context!=null&&((n=t.bindParameters.cloudsFade.data)==null?void 0:n.cubeMap)!=null&&this._context.requestRender());break;case ce.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,((o=this.view)==null?void 0:o.qualitySettings.highResolutionAtmosphere)||((c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.isFeatureEnabled(Bs.HighResolutionAtmosphere))),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const h=this.view.environment.weather;h.type!=="rainy"&&h.type!=="snowy"||this._precipitation.render(t,h.precipitation,h.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(t),i===p2.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===Kl.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===hn.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(Xo[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=xt(3e-5,.005,t.weatherAdjustment**3),re(this._newWeatherParameters.fog.color,ate),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=xt(4e-6,2e-4,(t.effect??0)**3),re(this._newWeatherParameters.fog.color,P7e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=xt(4e-6,2e-4,(t.effect??0)**3),re(this._newWeatherParameters.fog.color,ate),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==Zo.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Pe(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Pe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case Zo.Realistic:return See;case Zo.Local:return TBe;case Zo.Mars:return OBe;default:case Zo.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||qf(this.view.spatialReference)?Zo.None:r===Ie.Local?Zo.Local:this._context!=null&&See.isSupported(this._context)&&eO(this.view.spatialReference)?Zo.Realistic:Hf(this.view.spatialReference)?Zo.Mars:Zo.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{lte=h3.prototype._getAtmosphereClass,h3.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{h3.prototype._getAtmosphereClass=lte}}}};u([d({constructOnly:!0})],xo.prototype,"view",void 0),u([d({readOnly:!0})],xo.prototype,"atmosphere",null),u([d({readOnly:!0})],xo.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],xo.prototype,"updating",null),u([d({readOnly:!0})],xo.prototype,"weatherVisible",null),u([d()],xo.prototype,"_context",void 0),u([d()],xo.prototype,"_atmosphere",void 0),u([d({readOnly:!0})],xo.prototype,"_stars",null),u([d({readOnly:!0})],xo.prototype,"_precipitation",null),u([d({readOnly:!0})],xo.prototype,"_clouds",null),u([d({readOnly:!0})],xo.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],xo.prototype,"_fog",null),u([d({readOnly:!0})],xo.prototype,"weatherEnabled",null),u([d({readOnly:!0})],xo.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],xo.prototype,"_weatherUpdateParameters",null),xo=h3=u([R("esri.views.3d.environment.EnvironmentRenderer")],xo);let wU=class{constructor(){this.fog=new zke,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,re(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=xt(e.fog.amount,r.fog.amount,i),this.hazeAmount=xt(e.hazeAmount,r.hazeAmount,i),this.fog.strength=xt(e.fog.strength,r.fog.strength,i),Br(this.fog.color,e.fog.color,r.fog.color,i)}};const P7e=Ae(.5,.5,.5),ate=Ae(1.5,1.5,1.5);let lte;function cte(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return M7e(t,e.longitude,e.latitude,r.longitude,r.latitude)}function M7e(t,e,r,i,s){const n=Ft(r),o=Ft(s),a=n-o,l=Ft(e)-Ft(i),c=Math.sin(a/2),h=Math.sin(l/2),p=2*mh(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*t;return Math.round(1e4*p)/1e4}function $7e(t,e,r){const i=e.spatialReference,s=Dr(i),n=new pt(e.x,t.y,i),o=new pt(r.x,t.y,i),a=new pt(t.x,e.y,i),l=new pt(t.x,r.y,i);return{lon:cte(s.radius,n,o),lat:cte(s.radius,a,l)}}function I7e(t,e,r){const i=e/r,s=Ft(t),n=Math.sin(i/2),o=Math.cos(s),a=2*mh(Math.sqrt(n*n/(o*o)));return ja(a)}function L7e(t,e){let r=t/15;return e||(r=Math.round(r)),r}function ute(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=L7e(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var UCt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function OR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hte,dte,pte,t7={exports:{}};t7.exports,hte=t7,dte=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(M){return M.valueOf()/l-.5+c}function m(M){return new Date((M+.5-c)*l)}function y(M){return f(M)-h}var _=23.4397*a;function v(M,D){return n(e(M)*r(_)-i(D)*e(_),r(M))}function w(M,D){return s(e(D)*r(_)+r(D)*e(_)*e(M))}function T(M,D,N){return n(e(M),r(M)*e(D)-i(N)*r(D))}function x(M,D,N){return s(e(D)*e(N)+r(D)*r(N)*r(M))}function S(M,D){return a*(280.16+360.9856235*M)-D}function O(M){return a*(357.5291+.98560028*M)}function A(M){return a*(1.9148*e(M)+.02*e(2*M)+3e-4*e(3*M))}function P(M,D){return M+D+102.9372*a+t}function I(M,D){var N=O(M),G=P(N,A(N));return D||(D={dec:0,ra:0}),D.dec=w(G,0),D.ra=v(G,0),D}var V={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(M,D,N,G){var X=a*-N,K=a*D,ee=y(M),_e=I(ee,p),Le=S(ee,X)-_e.ra;return G||(G={azimuth:0,altitude:0}),G.azimuth=T(Le,K,_e.dec),G.altitude=x(Le,K,_e.dec),G}},k=[[-.83,"sunrise","sunset"]];V.addTime=function(M,D,N){k.push([M,D,N])};var B=9e-4;function z(M,D){return Math.round(M-B-D/(2*t))}function Z(M,D,N){return B+(M+D)/(2*t)+N}function W(M,D,N){return h+M+.0053*e(D)-.0069*e(2*N)}function H(M,D,N){return o((e(M)-e(D)*e(N))/(r(D)*r(N)))}function Y(M){var D=a*(134.963+13.064993*M),N=a*(93.272+13.22935*M),G=a*(218.316+13.176396*M)+6.289*a*e(D),X=5.128*a*e(N),K=385001-20905*r(D);return{ra:v(G,X),dec:w(G,X),dist:K}}return V.getTimes=function(M,D,N){var G=a*-N,X=a*D,K=z(y(M),G),ee=Z(0,G,K),_e=O(ee),Le=A(_e),_t=P(_e,Le),Rt=w(_t,0),at=W(ee,_e,_t);function vt(ft){return W(Z(H(ft,X,Rt),G,K),_e,_t)}function ze(ft){var ct=(e(ft)-e(X)*e(Rt))/(r(X)*r(Rt));return ct<-1?V.PolarException.MIDNIGHT_SUN:ct>1?V.PolarException.POLAR_NIGHT:V.PolarException.NORMAL}var fe,Tt,bt,Ce,Be,je={solarNoon:m(at),nadir:m(at-.5),polarException:V.PolarException.NORMAL};for(fe=0,Tt=k.length;fe<Tt;fe+=1)Be=at-((Ce=vt((bt=k[fe])[0]*a))-at),je[bt[1]]=m(Be),je[bt[2]]=m(Ce);return je.polarException=ze(k[0][0]*a),je},V.getMoonPosition=function(M,D,N){var G=a*-N,X=a*D,K=y(M),ee=Y(K),_e=S(K,G)-ee.ra,Le=x(_e,X,ee.dec);return Le+=.017*a/i(Le+10.26*a/(Le+5.1*a)),{azimuth:T(_e,X,ee.dec),altitude:Le,distance:ee.dist}},V.getMoonFraction=function(M){var D=y(M),N=I(D),G=Y(D),X=149598e3,K=o(e(N.dec)*e(G.dec)+r(N.dec)*r(G.dec)*r(N.ra-G.ra)),ee=n(X*e(K),G.dist-X*r(K));return(1+r(ee))/2},V},(pte=dte())!==void 0&&(hte.exports=pte);const Gb=OR(t7.exports),La={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let JP=class{constructor(e,r){this.direct=e,this.ambient=r}};function D7e(t,e,r,i,s,n){se(n.ambient.color,1,1,1),n.ambient.intensity=La.global.ambient,se(n.direct.color,1,1,1),n.direct.intensity=La.global.direct;const o=e[2],a=ye((Math.abs(o)-La.local.altitude)/(La.global.altitude-La.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=Gb.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=B7e(t,l,i);else{const h=cve(i);c={direct:{intensity:La.local.directAtNoon*h.direct,color:Ae(1,1,1)},ambient:{intensity:La.local.ambientAtNoon*h.ambient,color:Ae(1,1,1)},timeOfDay:"early afternoon"}}Br(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=xt(c.ambient.intensity,n.ambient.intensity,a),Br(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=xt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=t!=null?k7e(t,l):1,t!=null?N7e(t,e,r,n.direct.directionToLightSource):ave(s,r,n.direct.directionToLightSource)}function ave(t,e,r){e===Ie.Global?ge(EU,t.eye):se(EU,0,0,1),ie(CU,t.viewForward,-1);const i=GI(CU,EU),s=Math.max(i-2*AU,0),n=.85*s/(s+1),o=Math.max(AU,i-AU-n);cu(Ste,-o,t.viewRight),$e(r,CU,Ste),le(r,r,ie(G7e,t.viewRight,j7e)),ge(r,r)}function N7e(t,e,r,i){const s=z7e,n=wh(V7e);if(r===Ie.Global)Gb.getPosition(t,0,0,s),se(i,0,0,-1),H2(n,n,-s.azimuth),w5(n,n,-s.altitude),$e(i,i,n);else{const o=La.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ye(c,0,1),c<1?(Gb.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(i,0,-1,0),q2(n,n,-s.azimuth),H2(n,n,-s.altitude),$e(i,i,n)}}function F7e(t,e){if(e===Ie.Global)return!0;const r=La.planarDirection;return Math.abs(t)<r.localAltitude}const U7e=Ae(.5773502691896258,-.5773502691896258,.5773502691896258);let lve=class{constructor(){this.ambient={color:Ae(1,1,1),intensity:.55},this.direct={color:Ae(1,1,1),intensity:.55,directionToLightSource:Ms(U7e)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const V7e=ve(),z7e={azimuth:0,altitude:0};function k7e(t,e){const r=t.valueOf();let i,s;e.polarException===Gb.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=i+432e6):e.polarException===Gb.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=i+(s-i)/2;return 1-ye(Math.abs(r-n)/432e5,0,1)}function cve(t){switch(t){case"disabled":case"sunny":case"cloudy":return new JP(1,1);case"rainy":return new JP(.4,1.2);case"snowy":return new JP(.5,1.3);case"foggy":return new JP(.2,1.6)}}function fte(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const xU=Ae(.01,.01,.01),r7=Ae(1,.6,.5),i7=Ae(1,.98,.98),mte=Ae(1,1,1),TU=Ae(.8,.8,1),s7=Ae(.8,.8,1),n7=Ae(.98,.98,1),gte=Ae(1,1,1),SU=cr(.01,La.local.ambientAtNight),o7=cr(La.local.directAtTwilight,La.local.ambientAtTwilight),a7=cr(.9*La.local.directAtNoon,La.local.ambientAtNoon),yte=cr(La.local.directAtNoon,La.local.ambientAtNoon),_te=a7,vte=i7,bte=n7,wte=o7,xte=r7,Tte=s7;function B7e(t,e,r){const i=t.valueOf();let s,n;e.polarException===Gb.PolarException.MIDNIGHT_SUN?(s=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===Gb.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,_=n+p/2,v=Ue(),w=C(),T=C();let x="";if(i<f||i>_)ln(v,SU),re(w,xU),re(T,TU),x="night";else if(i<m){const A=(i-f)/(m-f);Ju(v,SU,o7,A),Br(w,xU,r7,A),Br(T,TU,s7,A),x="sun rising"}else if(i<c){const A=(i-m)/(c-m);Ju(v,o7,a7,A),Br(w,r7,i7,A),Br(T,s7,n7,A),x="early morning"}else if(i<a){const A=(i-c)/(a-c);Ju(v,a7,yte,A),Br(w,i7,mte,A),Br(T,n7,gte,A),x="late morning"}else if(i<h){const A=(i-a)/(h-a);Ju(v,yte,_te,A),Br(w,mte,vte,A),Br(T,gte,bte,A),x="early afternoon"}else if(i<y){const A=(i-h)/(y-h);Ju(v,_te,wte,A),Br(w,vte,xte,A),Br(T,bte,Tte,A),x="late afternoon"}else if(i<_){const A=(i-y)/(_-y);Ju(v,wte,SU,A),Br(w,xte,xU,A),Br(T,Tte,TU,A),x="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(fte(w,S),fte(T,S));const O=cve(r);return{direct:{intensity:v[0]*O.direct,color:w},ambient:{intensity:v[1]*O.ambient,color:T},timeOfDay:x}}const Ste=ve(),EU=C(),CU=C(),G7e=C(),AU=.25,j7e=.2;let sd=class extends Is.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Pi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new pN,this._ambientLight=new tX,this._moonLight=new y_e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===Ie.Global&&eO(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new xo({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([ue(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Gr),ue(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Gr),ue(()=>e.stationary,()=>this._interactingStationaryHandler()),ue(()=>e.environment.lighting.directShadowsEnabled,r,Gr),ue(()=>e.qualitySettings.ambientOcclusion,r,Gr),ue(()=>e.qualitySettings.reflections,r,Gr),ue(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},r,Gr),ue(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Gr),ue(()=>e.environment.weather.type,()=>this._updateLighting(null,p2.Faded),Gr),ue(()=>this.weatherEnabled,()=>this._updateLighting(null,p2.Faded),Gr),ue(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Cs),ue(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Cs),ue(()=>e.state.camera,i,Cs),ue(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Pe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!y_(i)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=ute(this._referencePosWGS84Comparable,Ete);s!=null&&(r.autoUpdate(null,s),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=eO(this._view.spatialReference);if(i&&!y_(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=C()),i?lge(s,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=p2.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=s!=null?H7e:q7e,o=this.weatherVisible?i.environment.weather.type:"disabled";s!=null?D7e(e,s,i.state.viewingMode,o,i.state.camera,n):i.environment.lighting.type==="virtual"&&ave(i.state.camera,i.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;ie(a.intensity,l.color,l.intensity*Math.PI),re(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;ie(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;Br(h.intensity,X7e,Z7e,n.globalFactor);const p=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));ie(h.intensity,h.intensity,p),re(h.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,h],n.noonFactor,n.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=W7e;i.setTime((r||this._view.environment.lighting.date).getTime());const s=ute(e,Ete);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=i.getUTCHours()-(s.hours-n.hours),a=i.getUTCMinutes()-(s.minutes-n.minutes),l=i.getUTCSeconds()-(s.seconds-n.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||F7e(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),i=this._view.environment.background,s=i instanceof f0e?{type:"color",color:mW(ke.toUnitRGBA(i.color))}:{type:"color",color:Nt(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=ZA(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const n=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=ZA(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};u([d({type:Boolean,readOnly:!0})],sd.prototype,"updating",null),u([d()],sd.prototype,"disableQueries",void 0),u([d()],sd.prototype,"_disableWeather",void 0),u([d()],sd.prototype,"weatherEnabled",null),u([d()],sd.prototype,"weatherVisible",null),u([d()],sd.prototype,"referencePositionWGS84Comparable",null),u([d()],sd.prototype,"_renderer",void 0),u([d()],sd.prototype,"_referencePosWGS84Comparable",void 0),sd=u([R("esri.views.3d.environment.SceneViewEnvironmentManager")],sd);const H7e=new lve,q7e=new lve,W7e=new Date,Ete={hours:0,minutes:0,seconds:0},X7e=Ae(.22,.22,.33),Z7e=Ae(.22,.22,.22);var Ri;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ri||(Ri={}));var Yt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Yt||(Yt={}));var Gn;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Gn||(Gn={}));function EO(t,e){return(t&e)!=0}function wN(t,e,r,i,s,n){t!==0&&(r?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):i!=null?(n.min-=Math.max(0,(e-n.min)*(1-i)),n.max+=Math.max(0,(e-n.max)*(1-i))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const T_={selection:Ri.NONE,interactionType:Yt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Gn.TUMBLE};function uve(t,e,r,i){return e=e||t.viewForward,re(i,e),ie(i,i,Math.sign(me(e,r))),i}function Y7e(t,e,r,i){return tGe(t,e,r,K7e(i,e,r,!0))}function J7e(t,e,r,i){const s=me(r,he(t,i,e));return le(t,e,ie(t,r,s))}const Q7e={dir:C(),len:0,clip:Ue()};function K7e(t,e,r,i){const s=Q7e;return t?(r&&i&&(s.len=fi(e,r)),re(s.dir,t)):i?(s.len=fi(e,r),he(s.dir,r,e),ie(s.dir,s.dir,1/s.len)):(he(s.dir,r,e),ge(s.dir,s.dir)),s}function eGe(t,e,r){const i=me(t,r.dir),s=-pi(t,e);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function tGe(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!eGe(t[s],e,i))return!1;return!0}function rGe(t,e,r=T_){const i=mX(t,e,r);if(i===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+i,o=uve(e,r.interactionDirection,nGe(t,e,Math.sign(i),cGe),lGe),a=re(uGe,e.viewForward),l=s.intersectInfiniteManifold(uu(e.eye,o),n,OU);return e.eye=l??s.setAltitude(OU,n,e.eye),e.center=J7e(OU,e.eye,a,e.center),!0}function mX(t,e,r=T_){if(!iGe(t,r)||!t.state.constraints.altitude)return 0;const i=oGe(t.state.constraints.altitude,aGe);sGe(t,r,i);const s=t.renderCoordsHelper.getAltitude(e.eye),n=ye(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function iGe(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==Yt.TUMBLE||!EO(e.selection,Ri.TILT))}function sGe(t,e,r){const i=e.interactionType;if(i===Yt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Yt.TUMBLE||i===Yt.ZOOM,c=mX(t,o),h=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,wN(c,h,l,a,.05*h,r)}function nGe(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),ie(i,i,r),i}function oGe(t,e){return e.min=t.min,e.max=t.max,e}const aGe={min:0,max:0},lGe=C(),cGe=C(),uGe=C(),OU=C();function gX(t,e,r=T_){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;QP.min=0,QP.max=i,dGe(t,r,QP);const s=yX(t,e),n=QP.max-s;return n>=-1e-6?0:n}function hGe(t,e,r=T_){const i=gX(t,e,r);if(i===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=yX(t,e)+i,o=re(fGe,e.eye),a=uve(e,r.interactionDirection,pGe(e,s.renderLocation,yGe),gGe);if(!D_(Hge(s.renderLocation,n),uu(e.eye,a),KP))return!1;e.eye=KP;const l=he(mGe,e.eye,o);e.center=le(KP,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),h=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,KP);return h!=null&&(e.center=h),!0}function dGe(t,e,r){const i=e.interactionType;if(i===Yt.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Yt.ZOOM||i===Yt.PAN,c=gX(t,o),h=c===0?0:yX(t,o);r.min=s,r.max=n,wN(c,h,l,a,.05*h,r)}function yX(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?fi(e.eye,r.renderLocation):0}function pGe(t,e,r){return Ng(r,t.eye,e)}const QP={min:0,max:0},fGe=C(),mGe=C(),gGe=C(),yGe=C(),KP=C();var Bi,fo;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Bi||(Bi={}));let _Ge=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=fo.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(fo||(fo={}));let vGe=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},bGe=class extends vGe{constructor(e,r,i,s){super(e,r,i),this.center=s!=null?Ms(s):null}},hve=class{constructor(e){this.layerUid=e}},rF=class extends hve{constructor(e,r){super(e),this.graphicUid=r}};function lp(t){return t!=null&&t.dist!=null}function Cte(t){return(e,r,i)=>(Br(Ate,e,r,i),!TW(t,Ate))}function iF(t){return lp(t)&&t.intersector===Bi.OBJECT&&!!t.target}function sF(t){return lp(t)&&t.intersector===Bi.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const Ate=C();let wGe=class{constructor(){this._transform=ve(),this._transformInverse=new eM({value:this._transform},bn,ve),this._transformInverseTranspose=new eM(this._transformInverse,_c,ve),this._transformTranspose=new eM({value:this._transform},_c,ve),this._transformInverseRotation=new eM({value:this._transform},Y0e,Ni)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){$s(this._transform,e)}multiplyTransform(e){si(this._transform,this._transform,e)}set(e){$s(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},eM=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},xGe=class{constructor(e=0){this.offset=e,this.tmpVertex=C()}applyToVertex(e,r,i){const s=e+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=e+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let n=0;n<3;++n)dy[n]=e[0+n]+this.localOrigin[n],tM[n]=e[3+n]+this.localOrigin[n],AE[n]=dy[n];const r=this.applyToVertex(dy[0],dy[1],dy[2]);for(let n=0;n<3;++n)e[n]=r[n],e[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)AE[o]=n&1<<o?tM[o]:dy[o];i(AE)}let s=0;for(let n=0;n<3;++n)dy[n]*tM[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if(!(s&n)){for(let o=0;o<3;++o)AE[o]=s&1<<o?0:n&1<<o?dy[o]:tM[o];i(AE)}}for(let n=0;n<3;++n)e[n]-=this.localOrigin[n],e[n+3]-=this.localOrigin[n];return e}};const dy=C(),tM=C(),AE=C();let TGe=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=C(),this._mbs=ys(),this._obb={center:C(),halfSize:ss(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const s=e,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=e+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],s=e[2]+this.componentLocalOriginLength,n=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=s<0?this._totalOffset:0,e[3]+=n>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(r),Math.abs(n)),m=Math.max(Math.abs(i),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+y*y),v=this._totalOffset/_,w=this._totalOffset/p;return e[0]+=r*(r>0?v:w),e[1]+=i*(i>0?v:w),e[2]+=s*(s>0?v:w),e[3]+=n*(n<0?v:w),e[4]+=o*(o<0?v:w),e[5]+=a*(a<0?v:w),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,pc(this._obb.halfSize,e.halfSize,e.quaternion),le(this._obb.halfSize,this._obb.halfSize,e.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,he(this._obb.halfSize,this._obb.halfSize,e.center),Uf(Mte,e.quaternion),pc(this._obb.halfSize,this._obb.halfSize,Mte),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},SGe=class{constructor(e=0){this.offset=e,this.sphere=ys(),this.tmpVertex=C()}applyToVertex(e,r,i){const s=this.objectTransform.transform;let n=s[0]*e+s[4]*r+s[8]*i+s[12],o=s[1]*e+s[5]*r+s[9]*i+s[13],a=s[2]*e+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const Ote=new SGe;function l7(t){return t!=null?(Ote.offset=t,Ote):null}const Rte=new TGe;function EGe(t){return t!=null?(Rte.offset=t,Rte):null}const Pte=new xGe;function CGe(t){return t!=null?(Pte.offset=t,Pte):null}const R0="terrain",Mte=Rh(),aS=1e-5;let AGe=class{constructor(e){this.options=new _Ge,this._results=new OGe,this.transform=new wGe,this.tolerance=aS,this.verticalOffset=null,this._ray=kn(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=e??Ie.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(r6e(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&eN(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ie.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,le(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i??aS;const o=l7(this.verticalOffset);if(e&&e.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.shaderTransformation,s=l7(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),$e(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),$e(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,f,m,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,v=f?w=>{const T=new bGe(e,a,p,y);w.set(Bi.HUD,T,c,h,sn,m)}:w=>w.set(Bi.OBJECT,{object:e,geometryId:a,triangleNr:p},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==fo.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===fo.ALL)if(f){const w=new c7(this._ray);v(w),this._results.hud.all.push(w)}else{const w=new f2(this._ray);v(w),this._results.all.push(w)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function Ch(t){return new AGe(t)}let OGe=class{constructor(){this.min=new f2(kn()),this.max=new f2(kn()),this.hud={min:new c7(kn()),max:new c7(kn()),all:new Array},this.ground=new f2(kn()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},f2=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ie(rM,this.ray.direction,this.dist),Ee(rM)):null}getIntersectionPoint(e){return!!lp(this)&&(ie(rM,this.ray.direction,this.dist),le(e,this.ray.origin,rM),!0)}getTransformedNormal(e){return re(OE,this.normal),OE[3]=0,Qc(OE,OE,this.transformation),re(e,OE),ge(e,e)}constructor(e){this.intersector=Bi.OBJECT,this.normal=C(),this.transformation=ve(),this._ray=kn(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Bi.OBJECT,eN(e,this._ray)}set(e,r,i,s,n,o,a){this.intersector=e,this.dist=i,re(this.normal,s??cq),$s(this.transformation,n??sn),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){eN(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,re(this.normal,e.normal),$s(this.transformation,e.transformation)}},c7=class extends f2{constructor(){super(...arguments),this.intersector=Bi.HUD}};function _X(t){return new f2(t)}const rM=C(),OE=Zt();function dve(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,xN,i)!=null&&tpe(r,xN)}function nF(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function ww(t,e,r,i){const s=t.state.camera.clone();e&&r&&i&&(s.eye=e,s.center=r,s.up=i),RGe(t,s.ray,py)||re(py,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(ho(s.eye,py)<o){const a=n.collision.enabled;re(tv,s.viewForward),ie(tv,tv,o),a?s.eye=he(xN,py,tv):le(py,s.eye,tv);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(he(tv,py,s.eye),s.eye=l.setAltitude(xN,h,s.eye),le(py,s.eye,tv))}return s.center=py,s}function $te(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=nF(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,r,t.renderDataExtent,i,MGe),o=n*n;return ho(e,r)>o}function RGe(t,e,r){let i=Ite[t.viewingMode];i||(i=Ch(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,Ite[t.viewingMode]=i);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||$te(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||$te(t,e.origin,r))||!!s&&PGe(e,r,Dr(t.spatialReference).radius)}function PGe(t,e,r){const i=me(t.origin,t.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return ie(e,t.direction,s/Ee(t.direction)),le(e,e,t.origin),!0}const Ite={},xN=C(),py=C(),tv=C(),MGe={near:0,far:0};function JS(t,e,r=ch.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const s=nF(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Ee(e.eye);if(he(iM,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude($Ge,o,e.eye),r===ch.EYE_AND_CENTER)e.center=le(iM,e.eye,iM);else if(r===ch.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=ie(iM,e.center,l)}return!0}var ch;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(ch||(ch={}));const iM=C(),$Ge=C();function S_(t,e,r){t.worldUpAtPosition(e,Lte),he(RU,r,e);const i=Ee(RU);return i===0?0:xn(me(RU,Lte)/i)}const Lte=C(),RU=C();function pve(t,e,r=T_,i=!0){RE.eyeCenterDistance=0,RE.requiresTwoSteps=!1;const s=vX(t,e,r,void 0,RE);if(s===0)return!1;switch(cu(sM,-s,e.viewRight),r.tiltMode){case Gn.LOOK_AROUND:$e(fy,e.viewForward,sM),ie(fy,fy,RE.eyeCenterDistance),e.center=le(P0,e.eye,fy);break;case Gn.TUMBLE:he(fy,e.center,e.eye),$e(fy,fy,sM),e.eye=he(P0,e.center,fy);break;default:r.tiltMode}return e.up=$e(P0,e.up,sM),!RE.requiresTwoSteps||!i||pve(t,e,r,!1)}function vX(t,e,r=T_,i=T_,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,BGe);return kGe(t,r,o),i.interactionType===Yt.TUMBLE&&EO(i.selection,Ri.ALTITUDE)&&fve(t,i.interactionStartCamera,o),r.tiltMode===Gn.LOOK_AROUND||i.tiltMode===Gn.LOOK_AROUND?LGe(t,e,o,s):IGe(t,e,o)}function IGe(t,e,r){const i=S_(t.renderCoordsHelper,e.center,e.eye),s=i-ye(i,r.min,r.max);return CO(s)?s:0}function LGe(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return NGe(t,e,r,i);case"local":return DGe(t,e,r,i)}}function DGe(t,e,r,i){const s=S_(t.renderCoordsHelper,e.center,e.eye),n=ye(s,r.min,r.max),o=s-n;if(!CO(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function NGe(t,e,r,i){const s=FGe(t,e,GGe),n=ye(s.tiltAtCenter,r.min,r.max);if(!CO(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=UGe(s),a=VGe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=zGe(s,o)),i&&(i.eyeCenterDistance=u7(s,o)),a}function FGe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Dr(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,i,P0);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,n!=null?(r.eyeCenterDistance=fi(e.eye,n),r.tiltAtCenter=S_(t.renderCoordsHelper,n,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=S_(t.renderCoordsHelper,e.center,e.eye):(qS(R5(P5,s),e.ray,P0),r.eyeCenterDistance=fi(e.eye,P0),r.tiltAtCenter=xn(-me(e.viewForward,ge(P0,P0)))),r.radius=s,r.eyeRadius=Ee(e.eye),r.constraints=t.state.constraints,r}function CO(t){return Math.abs(t)>1e-9}function UGe(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let s=i,n=e.clampTilt(r,i);const o=u7(t,n);if(e.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&CO(n-s);){const l=(s+n)/2,c=u7(t,l);CO(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function u7(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-ye(e,0,Math.PI),i=mh(t.radius/t.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return n*t.eyeRadius}function VGe(t,e){const r=mh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=mh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function zGe(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function kGe(t,e,r){if(e.interactionType===Yt.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=e;if(!i)return;const{min:n,max:o}=r,a=vX(t,i,T_,e),l=a===0?0:S_(t.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,e.interactionType===Yt.TUMBLE?(EO(e.selection,Ri.ALTITUDE)&&fve(t,i,r),wN(a,l,!0,s,Dte,r)):wN(a,l,!1,s,Dte,r)}function fve(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const s=ea(e.center),n=Math.sqrt(s),o=e.distance,a=Dr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-xn(p),r.max)),r.max=Math.min(r.max,Math.PI-xn(h))}const fy=C(),sM=ve(),P0=C(),Dte=Ft(5),BGe={min:0,max:0},GGe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},RE={eyeCenterDistance:0,requiresTwoSteps:!1};function jGe(t){return t}const oF=t=>t*t,bX=t=>1-oF(1-t),HGe=t=>t<.5?oF(2*t)/2:(bX(2*(t-.5))+1)/2,wX=t=>t*t*t,mve=t=>1-wX(1-t),gve=t=>t<.5?wX(2*t)/2:(mve(2*(t-.5))+1)/2,xX=t=>t*t*t*t,yve=t=>1-xX(1-t),qGe=t=>t<.5?xX(2*t)/2:(yve(2*(t-.5))+1)/2,TX=t=>t*t*t*t*t,_ve=t=>1-TX(1-t),WGe=t=>t<.5?TX(2*t)/2:(_ve(2*(t-.5))+1)/2,SX=t=>1-Math.cos(t*Math.PI/2),vve=t=>1-SX(1-t),XGe=t=>t<.5?SX(2*t)/2:(vve(2*(t-.5))+1)/2,EX=t=>2**(10*(t-1)),RR=t=>1-EX(1-t),ZGe=t=>t<.5?EX(2*t)/2:(RR(2*(t-.5))+1)/2,CX=t=>-(Math.sqrt(1-t*t)-1),bve=t=>1-CX(1-t),YGe=t=>t<.5?CX(2*t)/2:(bve(2*(t-.5))+1)/2;function $h(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Ih(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const JGe=Ih($h(1),1),QGe=Ih($h(1),0),wve=Ih($h(1),.5),KGe=Ih($h(2),1),eje=Ih($h(2),0),tje=Ih($h(2),.5),rje=Ih($h(3),1),ije=Ih($h(3),0),sje=Ih($h(3),.5),nje=Ih($h(4),1),oje=Ih($h(4),0),aje=Ih($h(4),.5),lje={linear:jGe,"in-quad":oF,"out-quad":bX,"in-out-quad":HGe,"in-coast-quad":JGe,"out-coast-quad":QGe,"in-out-coast-quad":wve,"in-cubic":wX,"out-cubic":mve,"in-out-cubic":gve,"in-coast-cubic":KGe,"out-coast-cubic":eje,"in-out-coast-cubic":tje,"in-quart":xX,"out-quart":yve,"in-out-quart":qGe,"in-coast-quart":rje,"out-coast-quart":ije,"in-out-coast-quart":sje,"in-quint":TX,"out-quint":_ve,"in-out-quint":WGe,"in-coast-quint":nje,"out-coast-quint":oje,"in-out-coast-quint":aje,"in-sine":SX,"out-sine":vve,"in-out-sine":XGe,"in-expo":EX,"out-expo":RR,"in-out-expo":ZGe,"in-circ":CX,"out-circ":bve,"in-out-circ":YGe};function Os(t,e,r=dje,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<pje;a++){let l=0;for(const c of hje)if(EO(r.selection,c.type)){const h=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(s=!0,l+=h)}if(l===0)break}const n=EO(r.selection,Ri.COLLISION),o=cje(r.interactionType,t);return n&&JS(t,i,o)&&(s=!0),s&&i.computeUp(t.state.viewingMode),s}function cje(t,e){switch(t){case Yt.PAN:return ch.EYE_AND_CENTER;case Yt.ASCEND:return e.state.isGlobal?ch.EYE_AND_CENTER_SCALE:ch.EYE_AND_CENTER;default:return ch.EYE}}function Pd(t){const e=Math.min(1,t/150);return gve(e)}function uje(t,e,r){return vX(t,e,r)*e.distance}const hje=[{type:Ri.TILT,error:uje,apply:pve},{type:Ri.ALTITUDE,error:mX,apply:rGe},{type:Ri.DISTANCE,error:gX,apply:hGe}],dje={selection:Ri.ALL,interactionType:Yt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Gn.TUMBLE},pje=5,Tc=C(),Rl=C(),my=C(),Go=C(),rv=C(),fje=C(),Sc={upward:Ae(0,0,1),forward:Ae(0,1,0),sideway:Ae(1,0,0)},Nte=Ni();let Fte=class{constructor(e=Ie.Global){this.viewingMode=e,this.center=C(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Ms(Sc.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ie.Global){const n=(Ee(this.center)+Ee(e.center))/2;r.pan=GI(this.center,e.center)*n}else r.pan=fi(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===Ie.Global?v6e(e.center,r.center,i.pan,this.center):Br(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?xt(e.distance,r.distance,i.zoom):e.distance,this.pitch=xt(e.pitch,r.pitch,i.rotate);let s=e.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=xt(s,n,i.rotate)}copyFrom(e){re(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,re(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,Nte);re(this.center,e.center),he(Go,e.center,e.eye),ac(Go,Go,r),ac(rv,e.up,r),this.distance=Ee(Go),this.distance!==0&&(Go[0]/=this.distance,Go[1]/=this.distance,Go[2]/=this.distance),this.pitch=this._eyeUpToPitch(Go),this.yaw=this._eyeUpToYaw(Go,rv),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,Nte);Sh(r,r),this._axisAngleVec3(Sc.sideway,this.pitch-Math.PI/2,Sc.forward,Go),this._axisAngleVec3(Sc.upward,this.yaw,Go),this._axisAngleVec3(Sc.sideway,this.pitch-Math.PI/2,Sc.upward,rv),this._axisAngleVec3(Sc.upward,this.yaw,rv),ie(Go,Go,this.distance),ac(Go,Go,r),ac(rv,rv,r),e.center=this.center,e.eye=he(Go,this.center,Go),e.up=rv}_axisAngleVec3(e,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return ie(Tc,i,n),ot(Rl,e,i),ie(Rl,Rl,o),ie(my,e,(1-n)*me(e,i)),le(s,le(s,Tc,Rl),my)}_lookAtOrientation(e,r=Ni()){return this._upAtLookAt(e,my),ot(Tc,this.lookAtDirection,my),ge(Tc,Tc),Tc[0]===0&&Tc[1]===0&&Tc[2]===0&&re(Tc,Sc.sideway),ot(Rl,my,Tc),ge(Rl,Rl),r[0]=Tc[0],r[1]=Rl[0],r[2]=my[0],r[3]=Tc[1],r[4]=Rl[1],r[5]=my[1],r[6]=Tc[2],r[7]=Rl[2],r[8]=my[2],r}_upAtLookAt(e,r){return this.viewingMode===Ie.Local?re(r,Sc.upward):ge(r,e)}_eyeUpToPitch(e){return Math.PI-GI(Sc.upward,e)}_eyeUpToYaw(e,r){const i=fje;return Math.abs(r[2])<.5?(re(i,r),e[2]>0&&ie(i,i,-1)):re(i,e),ot(Rl,i,Sc.upward),ge(Rl,Rl),GI(Sc.sideway,Rl,Sc.upward)}};const TN={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let mje=class xve{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:TN.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new xve(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:TN.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},gje=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-h)/(p-h)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},PU=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const n=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}};function yje(t,e,r){const i=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function _je(t,e,r){const i=1/e,s=Math.log(t.compared.sourceZoom*i),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function vje(t,e,r){const i=e-t.compared.sourceZoom,s=1/i,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function bje(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function wje(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function xje(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Tje(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Sje(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Eje(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Cje(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Aje(t,e,r){const i=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*s*n*a+t.halfWindowSize*i*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function Oje(t,e,r){const i=e-t.compared.targetZoom,s=1/i,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Rje(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Pje(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Mje(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function $je(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),s=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?s*(e-i):s*(e+i)}function Ije(t,e){let r=Lje(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?bje:yje,a=s?wje:_je,l=s?xje:vje,c=n?Rje:Cje,h=n?Pje:Aje,p=n?Mje:Oje,f=S=>o(t,S,i)+Tje(t,S,i)+c(t,S,i),m=S=>a(t,S,i)+Sje(t,S,i)+h(t,S,i),y=S=>l(t,S,i)+Eje(t,S,i)+p(t,S,i);let _=f(r);const v=$je(t);let w;const T=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(w=0;w<T;w++){const O=(m(r)+1e-6)/y(r);if(isNaN(O)||r>=x&&O<0){if(!isFinite(x))return null;r=x,_=f(r);break}if(r-=O,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const A=f(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function Lje(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let Dje=class extends gje{constructor(e,r){super(),this._preallocSegments=[new PU,new PU,new PU],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=Ije(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=bX(i.zoom):e===this._descensionSegment&&(i.zoom=oF(i.zoom)),i}_updateWithApex(e,r){const[i,s,n]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Nje={zoom:0,pan:0,rotate:0};let Fje=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new mje(e),this.path=new Dje}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Que(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?wve:RR)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,Nje);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const s=r.minDuration!=null?r.minDuration:TN.minDuration/i,n=r.maxDuration!=null?r.maxDuration:TN.maxDuration/i;return Math.min(Math.max(s,e),n)}};const Uje=C();let Vje=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new Fje(()=>new Fte(e)),this._current=new Fte(e)}update(e,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=he(Uje,r.center,e.center),a=Ee(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),re(s.lookAtDirection,o),re(n.lookAtDirection,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new lt,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+Que(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var Wi;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Wi||(Wi={}));let Jm=class extends xe{constructor(e){super(e),this.state=Wi.Ready}get active(){return this.state===Wi.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Wi.Stopped,!0)}finishController(){this.state=Wi.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],Jm.prototype,"view",void 0),u([d({readOnly:!0})],Jm.prototype,"active",null),u([d()],Jm.prototype,"state",void 0),u([d({readOnly:!0})],Jm.prototype,"isInteractive",null),Jm=u([R("esri.views.3d.state.controllers.CameraController")],Jm);let AO=class extends Jm{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Lr()),this._asyncResult=null),this.state===Wi.Finished||this.state===Wi.Stopped?(M4(e),this.state===Wi.Finished?e.resolve():e.reject(Lr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Wi.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Wi.Ready&&this.state!==Wi.Running||(this.viewAnimation.state===tS.State.FINISHED?this.finish():this.viewAnimation.state===tS.State.STOPPED&&(this.state=Wi.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Wi.Finished?this.viewAnimation.finish():this.state===Wi.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Wi.Finished?this._asyncResult.resolve():this._asyncResult.reject(Lr()))}finish(){this.finishController()}};AO=u([R("esri.views.3d.state.controllers.AnimationController")],AO);let og=class extends AO{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Vje(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new tS}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);nM.copyFrom(this.view.state.camera);const s=Ch(this.view.state.viewingMode);this.intersectionHelper.intersectRay(nM.ray,s,Ute)&&(nM.center=Ute),this.animation.update(nM,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?lje[e.easing]:e.easing}}};u([d({constructOnly:!0})],og.prototype,"mode",void 0),u([d({readOnly:!0})],og.prototype,"isInteractive",null),og=u([R("esri.views.3d.state.controllers.PointToPointAnimationController")],og);const nM=new lt,Ute=C();function aF(t=kje){return[t[0],t[1],t[2],t[3]]}function OO(t,e){return zje(t[0],t[1],t[2],e,gW.get())}function zje(t,e,r,i,s=aF()){return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function AX(t,e,r){return ot(r,t,e),ge(r,r),r[3]=O5(t,e),r}const kje=[0,0,1,0];function Tve(t,e,r){return Bje(t,t.screenToRender(e,Ne.get()),r)}function Bje(t,e,r){const i=ln(Ne.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const s=ln(Ne.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,Ne.get());return n==null?null:(he(r.direction,n,r.origin),r)}function QS(t,e,r){return OX(t,t.screenToRender(e,Ne.get()),r)}function OX(t,e,r){re(r.origin,t.eye);const i=se(Ne.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(i,Ne.get());return s==null?null:(he(r.direction,s,r.origin),r)}function RX(t,e,r,i){const s=QS(e,r,Gje);return D_(t,s,i)}const Gje=kn();var lS;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(lS||(lS={}));const Sve=30,SN=[1,3e8],lF=80,Eve=8,Cve=200,Ave=1508e5,Ove=5,Rve=50,jje=5,Hje=10,MU=90,xw={exclude:new Set([R0])};function fb(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function h7(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function E_(t,e,r){const i=cu(yW.get(),r[3],r);i==null||jme(i,sn)||(he(qr,t.eye,e),$e(qr,qr,i),t.eye=le(qr,qr,e),he(qr,t.center,e),$e(qr,qr,i),t.center=le(qr,qr,e),t.up=$e(qr,t.up,i))}function qje(t,e,r,i){return gw(t,Tve(e,r,$X),i)}function d7(t,e,r,i){return gw(t,QS(e,r,$X),i)}function PX(t,e,r,i){const s=Ne.get();let n=1-r;he(s,e,t.eye);const o=Ee(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ie(s,s,n),t.eye=le(qr,t.eye,s),t.center=Br(qr,t.center,e,n))}function Pve(t,e,r){e.getScreenCenter(Vte),RX(t,e,Vte,qr)&&(e.center=qr);const i=e.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=ie(Ne.get(),e.viewForward,s);e.eye=he(qr,e.center,n)}const Vte=Zi();function $U(t,e){se(e,0,0,0);for(const r of t)le(e,e,r);ie(e,e,1/t.length)}function aL(t,e,r,i){return Math.sin(t/Ee(e))*(r+i.radius)}function zte(t,e,r,i){return aL(Math.PI/2,e,r,i)+(t-Math.PI/2)}var Bn;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Bn||(Bn={}));const kte={Elevation:3e4,Angle:Ft(16)},oM={Pole:.95,Angle:Ft(18),Tilt:45},Mve=Ft(80);function $ve(t,e,r,i,s,n){const o=C(),a=ys();let l=!0,c=!0;return t.intersectScreen(r,o,n)?a[3]=Ee(o):(c=!1,e.aboveGround&&s!==lS.Ellipsoid?a[3]=Math.max(Ee(e.center),.9*i.radius):a[3]=Ee(e.eye)-e.relativeElevation,s===lS.Silhouette?RO(a,e,r,o):l=RX(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function cF(t,e,r){return Ee(t.eye)-r.radius>kte.Elevation?Bn.Horizontal:(QS(t,e,Zte),-Math.sign(t.relativeElevation)*(.5*Math.PI+O5(t.eye,Zte.direction))<kte.Angle?Bn.Vertical:Bn.Horizontal)}function Ive(t,e,r){he(IU,r,e),t.eye=he(qr,t.eye,IU),t.center=he(qr,t.center,IU)}const IU=C();function RO(t,e,r,i){const s=QS(e,r,$X);return s!=null&&(qS(t,s,aM),D_(t,s,i)?!(ho(aM,s.origin)<ho(i,s.origin))||(re(i,aM),!1):(he(Bw,e.eye,e.center),ge(Bw,Bw),Qge(Bw,-me(ge(Bw,Bw),aM),Bte),gw(Bte,s,i),!1))}const aM=C(),Bw=C(),Bte=Mr();function Lve(t,e,r,i,s,n){let o=0;if(ot(AN,t,e),he(hM,t,e),Ee(t)<=s||!i.aboveGround){ot(r,hM,i.eye);const a=me(t,e)/(Ee(t)*Ee(e));if(a<.9999)o=xn(a);else{const c=Ee(ot(C(),t,e))/(Ee(t)*Ee(e));o=mh(c)}const l=Math.cos(ye(h_.normalize(Ft(n)),0,Mve));o=-o-Math.max(0,Ee(e)-s)/(l*s)}else he(Gte,i.eye,i.center),ot(r,hM,Gte),o=-Ee(hM)/s;return ge(r,r),ie(r,r,Ee(AN)),o}const Gte=C();function jte(t,e,r,i){let s,n;const o=Math.cos(ye(h_.normalize(Ft(i)),0,Mve));return s=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):xn(e/r),n=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):xn(t/r),(n-s)*r}function Wje(t,e,r,i,s,n,o,a,l,c){const h=jte(t[2],e[2],n[3],a),p=l?jte(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*p-Math.cos(o)*h,m=Math.cos(o)*p+Math.sin(o)*h;ge(qr,s);const y=l?f/Math.sqrt(Math.abs(n[3]**2-me(r,qr)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-me(r,i)**2));sr(c,y,_)}function Dve(t,e,r,i,s,n,o,a,l,c){ot(AN,t,e),Nk(n.up,n.eye,lM,cM,uM),Nk([0,0,1],n.eye,dg,s_,Vve),re(r,s_),re(i,dg),ge(r,r),ie(r,r,Ee(AN)),bK(t,ge(cM,cM),ge(uM,uM),ge(lM,lM),Hte),bK(e,cM,uM,lM,qte),Wje(Hte,qte,t,dg,s_,o,a,l,c,s)}function Xje(t,e,r,i,s,n,o){cu(EN,s,i),cu(CN,o,n),si(jT,EN,CN),he(e,t,r),$e(e,e,jT),le(e,e,r)}function Nve(t,e,r,i,s,n){cu(EN,i,r),cu(CN,n,s),si(jT,EN,CN),he(qr,t.eye,e),$e(qr,qr,jT),t.eye=le(qr,qr,e),he(qr,t.center,e),$e(qr,qr,jT),t.center=le(qr,qr,e),he(qr,t.up,e),$e(qr,qr,jT),t.up=le(qr,qr,e)}function MX(t,e,r,i,s,n){return(Math.abs(i)>Math.PI-oM.Angle||Math.abs(i)<oM.Angle)&&(Math.abs(t[2])<r*oM.Pole||Math.abs(e)>r)&&n.aboveGround&&s<oM.Tilt}function Fve(t,e,r,i,s,n){if(n)AX(r,i,Wte),E_(e,t,Wte);else{const o=Lve(r,i,Xte,e,t[3],s);E_(e,t,OO(Xte,o))}}function Uve(t,e,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,h;re(iv,i),dM.copyFrom(e);for(let p=0;p<a&&ho(r,iv)>l&&(c=ho(r,iv),Dve(r,iv,s_,dg,PE,dM,t,s,n,o),Nve(dM,t,dg,PE[1],s_,PE[0]),Xje(iv,iv,t,dg,PE[1],s_,PE[0]),h=ho(r,iv),h<c||p===0);p++)e.copyFrom(dM)}function Zje(t,e,r,i,s,n,o){MX(r,me(e.up,r),t[3],-h_.normalize(Ft(s)),n,e)?Uve(t,e,r,i,-h_.normalize(Ft(s)),n,o):Fve(t,e,r,i,n,o)}function Yje(t,e,r,i,s,n){const{eye:o}=t;Nk([0,0,1],o,dg,s_,Vve);const a=e.translation[0]*r.pan,l=s.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-me(t.center,dg)**2/Ee(t.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(lc(i.pan.matrix,i.pan.matrix,h,dg),i.pan.enabled=!0,s.mode){case"pan":lc(i.pan.matrix,i.pan.matrix,p,s_),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function Jje(t,e,r,i,s){const{eye:n,viewRight:o}=t,a=ot(Ne.get(),o,n),l=e.translation[0]*r.pan;switch(l!==0&&(lc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(lc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function Qje(t,e,r,i,s,n,o,a,l){MX(t.center,me(t.up,t.center),Ee(t.center),-h_.normalize(Ft(n)),o,e)?Yje(e,r,i,a,l,-h_.normalize(Ft(s))):Jje(e,r,i,a,l)}const dg=C(),s_=C(),Vve=C(),lM=C(),cM=C(),uM=C(),Hte=C(),qte=C(),PE=Ue(),Wte=aF(),EN=ve(),CN=ve(),jT=ve(),iv=C(),qr=C(),hM=C(),dM=new lt,AN=C(),Xte=C(),$X={origin:C(),direction:C()},Zte={origin:C(),direction:C()},Yte=.6,LU=4,Kje=60;let ON=class extends og{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new lt,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._constraintOptions={selection:Ri.ALL_EXCEPT_COLLISION,interactionType:Yt.ZOOM,interactionFactor:null,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Gn.TUMBLE},this._sphere=ys()}initialize(){this._intersector=Ch(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s));let n=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?xw:{})&&(n=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:RR}}_updateCamera(e,r,i,s,n){const o=Dr(this.view.spatialReference),a=cF(e,s,o),l=Math.abs(this.view.camera.position.z);ge(fM,e.eye),ie(fM,fM,-1),QS(e,s,this._tmpRayDir),ge(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=ye(Math.min(Eve,1/Math.abs(me(fM,this._tmpRayDir.direction)))*l,Cve,Ave);if(a===Bn.Horizontal){let h=Yte**r;this._sphere[3]=Ee(i),he(this._tmpViewDir,e.center,e.eye);const p=Math.min(Ee(this._tmpViewDir),c);let f=p*h;if(h<=1&&f<LU&&(f=LU,h=f/p),Math.abs(p-f)<1e-6)return;const m=Ee(e.center);if(this._sphere[3]!==m){const y=this._sphere[3]+h*(m-this._sphere[3]);e.center=ie(pM,e.center,y/m)}ie(this._tmpViewDir,this._tmpViewDir,-h),e.eye=le(pM,e.center,this._tmpViewDir),Os(this.view,e,this._constraintOptions),ho(i,e.center)>1e-12&&RX(this._sphere,e,s,this._targetOnSphere)&&Zje(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=Yte**Math.abs(r);const p=r>0?1:-1;he(this._tmpViewDir,i,e.eye);const f=Ee(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,Kje);let y=m??c;y=n&&r>0?Math.min(y,f):y,ie(this._tmpRayDir.direction,this._tmpRayDir.direction,y),le(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*h;const v=Math.max(LU,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,h=_/y),Math.abs(y-_)<1e-6)return;ie(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-h)),e.eye=le(pM,e.eye,this._tmpRayDir.direction),e.center=le(pM,e.center,this._tmpRayDir.direction)}JS(this.view,e)}};ON=u([R("esri.views.3d.state.controllers.global.ZoomStepController")],ON);const pM=C(),fM=C(),eHe=.6,tHe=4,rHe=60;let RN=class extends og{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new lt,this._tmpRayDir=C(),this._tmpCenter=C(),this._constraintOptions={selection:Ri.ALL,interactionType:Yt.ZOOM,interactionFactor:null,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Gn.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(i.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(i.camera);const n=Ch(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?xw:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center);const a=eHe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,rHe);he(mM,this._tmpCamera.eye,this._zoomLocation),ge(mM,mM);const c=ye(Math.min(Eve,1/Math.abs(me(iHe,mM)))*Math.abs(this.view.camera.position.z),Cve,Ave);if(l=l??c,l){const h=C();he(h,this._zoomLocation,this._tmpCamera.eye),(l<Ee(h)||!o)&&(ge(h,h),le(this._zoomLocation,this._tmpCamera.eye,ie(h,h,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:RR}}_updateCamera(e,r,i){he(this._tmpRayDir,i,e.eye);const s=Ee(this._tmpRayDir);let n=s*r;const o=r<=1,a=Math.max(tHe,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,r=n/s),Math.abs(s-n)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,r),e.eye=he(Jte,i,this._tmpRayDir),e.center=Br(Jte,e.center,i,1-r),Os(this.view,e,this._constraintOptions)))}};RN=u([R("esri.views.3d.state.controllers.local.ZoomStepController")],RN);const Jte=C(),iHe=Ae(0,0,1),mM=C();function sHe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function IX(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let nHe=class extends vo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(sHe(r,"primary")){const i=this._view.state.isGlobal?new ON({view:this._view,mode:"animation"}):new RN({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Zi(r.x,r.y)),e.stopPropagation()}}};function oHe(t,e,r){return t===Ie.Global?new lHe(r):new aHe(e,r)}let aHe=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Dr(r),this._unitInMeters=qa(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,s,n){var x;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(i=i??new yr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},p=Math.max(h.x,h.y,h.z);he(sv,r,e),Gw[0]=sv[0]>0?i.xmax:i.xmin,Gw[1]=sv[1]>0?i.ymax:i.ymin,Gw[2]=sv[2]>0?p/2:-p/2,he(Gw,Gw,e),ge(sv,sv);const f=1.1*me(Gw,sv)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*hHe*this._unitInMeters,v=y*dHe*this._unitInMeters,w=ye((o-v)/(_-v),0,1)**3,T=Math.min(xt(m,f,w),m)*Math.max(Math.log(Math.abs(l)),1);return zve(Math.min(T,Math.max(34064e4,p))/this._unitInMeters,cHe,this._unitInMeters,n)}},lHe=class{constructor(e){this._referenceEllipsoid=Dr(e)}compute(e,r,i,s,n){n||(n={near:0,far:0});const o=Ee(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return zve(1.2*xt(p,f,UW(h)),ye(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function zve(t,e,r,i){const s=uHe/r;return t/e>s?(i.far=t,i.near=i.far/e):(i.near=s,i.far=i.near*e),i}const cHe=2e4,uHe=2,hHe=.001,dHe=1e-4,Gw=C(),sv=C();let lL=class extends xe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&dve(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>JS(this.view,e,ch.EYE_AND_CENTER))}};u([d({constructOnly:!0})],lL.prototype,"view",void 0),lL=u([R("esri.views.3d.state.ElevationCollisionConstraint")],lL);let d3=class extends xe{constructor(e){super(e),this.nearFarHeuristic=oHe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ue(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(s=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ue(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Gr),ue(()=>{var e,r,i,s;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(s=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),Gr),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),Gr),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),Gr),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Gr),ue(()=>{var e,r,i,s,n,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Gr)]),this.view.state.isLocal&&this.addHandles(ue(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Vr)),this._updateNearFar(),this.view.state.viewingMode!==Ie.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new lL({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,nF(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Ri.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ie.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Ft(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(ja(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,s=3*r/Math.atan(i.camera.fov/2);s!==i.constraints.distance&&(i.constraints.distance=s)}_reapplyConstraints(e=Ri.ALL){this.view.state.updateCamera(r=>Os(this.view,r,{selection:e,interactionType:Yt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Gn.TUMBLE}))}};u([d({constructOnly:!0})],d3.prototype,"view",void 0),u([d({readOnly:!0})],d3.prototype,"surfaceCollisionConstraint",void 0),d3=u([R("esri.views.3d.state.ConstraintsManager")],d3);let M0=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=TO(),this._points=h_e(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:C(),endpoint:null}}update(e){d_e(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),re(this._origin,e.eye),re(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)re(this._points[r],e[r]);p_e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return X0(this.frustum,e)}intersectsRay(e){return dke(this.frustum,e)}intersectsLineSegment(e,r){return pke(this.frustum,e,r)}intersectsPoint(e){return f_e(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;DU(this.lines[r],e[r],e[i]),DU(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),DU(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function DU(t,e,r){t.origin=e,t.endpoint=r,Ng(t.direction,e,r)}M0.planePointIndices=fke,M0.nearFarLineIndices=[[Ye.NEAR_BOTTOM_LEFT,Ye.FAR_BOTTOM_LEFT],[Ye.NEAR_BOTTOM_RIGHT,Ye.FAR_BOTTOM_RIGHT],[Ye.NEAR_TOP_RIGHT,Ye.FAR_TOP_RIGHT],[Ye.NEAR_TOP_LEFT,Ye.FAR_TOP_LEFT]];let _A=class extends Jm{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Wi.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||dve(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),JS(this.view,e,ch.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Wi.Stopped)})}};u([d({constructOnly:!0})],_A.prototype,"desiredCamera",null),_A=u([R("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],_A);const pHe=C(),gM=C();function LX(){return{direction:C(),up:C()}}function kve(t,e,r,i,s){let n=ge(pHe,t),o=me(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(me(e,i)),o<.99?(re(n,e),a&&ie(n,n,-1)):n=null);let l=0;if(n){ie(gM,i,me(i,n)),he(n,n,gM);const h=me(n,s)/(Ee(n)*Ee(s));ot(gM,n,s),l=(me(gM,i)>0?1:-1)*ja(xn(h))}const c=ja(xn(-me(i,t)/Ee(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const Bve=Ae(0,1,0),Gve=Ae(0,0,1),ME=ve(),sm=C(),nm=C();function jve(t,e,r,i=LX()){const{direction:s,up:n}=i;return Fme(ME,-Ft(e)),H2(ME,ME,Ft(r)),$e(s,Gve,ME),ie(s,s,-1),$e(n,Bve,ME),i}function fHe(t,e,r,i){return kve(e,r,i,Gve,Bve)}function mHe(t,e,r,i){const s=jve(t,r,i),n=C();return ie(n,s.direction,-e),le(n,n,t),{up:s.up,eye:n,heading:r,tilt:i}}function gHe(t){return ja(t)}function yHe(t){return Ft(t)}function Hve(t,e,r,i,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return yo(e,sm,n),yo(e,nm,n),sm[0]-=r/2,nm[0]+=r/2,sm[1]-=i/2,nm[1]+=i/2,Gs(sm,n,sm,o),Gs(nm,n,nm,o),s?(s.xmin=sm[0],s.ymin=sm[1],s.xmax=nm[0],s.ymax=nm[1],s.spatialReference=o):s=new yr(sm[0],sm[1],nm[0],nm[1],o),s}const _He=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:fHe,eyeForCenterWithHeadingTilt:mHe,eyeTiltToLookAtTilt:yHe,headingTiltToDirectionUp:jve,lookAtTiltToEyeTilt:gHe,toExtent:Hve},Symbol.toStringTag,{value:"Module"})),qve=Ae(0,0,1),Wve=ge(C(),Ae(1,1,1)),vHe=new u_(-180,180),$E=ve(),w0=C(),jw=C();function Xve(t,e,r,i=LX()){ot(w0,t,qve),me(w0,w0)===0&&ot(w0,t,Wve),cu($E,-Ft(e),t),lc($E,$E,-Ft(r),w0);const{up:s,direction:n}=i;return ot(s,w0,t),ge(s,s),$e(s,s,$E),ge(n,t),na(n,n),$e(n,n,$E),i}function bHe(t,e,r,i){const s=w0,n=jw;return ge(s,t),ot(jw,s,qve),me(jw,jw)===0&&ot(jw,s,Wve),ot(n,jw,s),kve(e,r,i,s,n)}function wHe(t,e,r,i){const s={eye:C(),up:null,tilt:i,heading:r},n=w0;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=Ft(r),l=Ft(i),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Ee(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const Y=m/p,M=mh(o/Y),D=Math.PI-l-M;y=Y*Math.sin(D)}const _=f*o,v=o*o*(p*p),w=h*h*v,T=y-_,x=T*T,S=w*(w+x-n[1]*n[1]);if(S<0)return ie(s.eye,n,y/m),s.tilt=0,yM(s,t);const O=Math.sqrt(S),A=n[1]*T,P=w+x;let I;if(I=h>0?-O+A:O+A,Math.abs(P)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ie(s.eye,n,y/m),s.tilt=0,NU(s.eye),yM(s,t);s.eye[1]=I/P;const V=c*c*v,k=p*o,B=h*k*s.eye[1],z=s.eye[1]*s.eye[1],Z=1-z,W=Math.sqrt(Z),H=w*z+V-2*B*W*T+Z*x;return Math.abs(H)<1e-8?(ie(s.eye,n,y/m),s.tilt=0,NU(s.eye),yM(s,t)):(s.eye[0]=(Z*(y*n[0]-_*n[0])-k*W*(n[0]*s.eye[1]*h+n[2]*c))/H,s.eye[2]=(Z*(y*n[2]-_*n[2])-k*W*(n[2]*s.eye[1]*h-n[0]*c))/H,ie(s.eye,s.eye,y),NU(s.eye),yM(s,t))}function NU(t){const e=t[1];t[1]=-t[2],t[2]=e}function yM(t,e){const r=Xve(e,t.heading,t.tilt);return t.up=r.up,t}function xHe(t,e,r){const i=Ee(e),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),n=mh(r/(s/Math.sin(t)));return ja(t-n)}function THe(t,e,r){const i=Ft(t),s=Ee(e);return mh(r/(s/Math.sin(i)))+i}function Zve(t,e,r,i,s){let n,o,a,l;const c=e.latitude,h=Dr(t.spatialReference).radius,p=e.longitude,f=I7e(c,r,h)/2;n=p-f,o=p+f;const m=Ft(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(i/h/2),v=_*_;function w(x){const S=Math.PI/2;return(x=aLe.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+i/h,a=w(a),l=w(l),l<a){const x=l;l=a,a=x}if(a=Math.max(ja(a),-90),l=Math.min(ja(l),90),o=vHe.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const T=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Ge.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new yr(n,a,o,l,T),t.spatialReference&&t.spatialReference.isWebMercator&&tA(s,!1,s),s}const SHe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:bHe,eyeForCenterWithHeadingTilt:wHe,eyeTiltToLookAtTilt:THe,headingTiltToDirectionUp:Xve,lookAtTiltToEyeTilt:xHe,toExtent:Zve},Symbol.toStringTag,{value:"Module"}));function PN(t){return t.type==="point"}let DX=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function Yve(t){return"array"in t}function ff(t,e,r="ground"){if(PN(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(Yve(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function p7(t,e){return t!=null&&(e==null||(e===Ie.Local?!t.isGeographic||t.isWGS84||t.wkid===ih.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===ih.CGCS2000||t.wkid===ih.GCSMARS2000||t.wkid===ih.GCSMARS2000_SPHERE||t.wkid===ih.GCSMOON2000))}const Jve=J.getLogger("esri.views.3d.support.cameraUtils"),Qve=39.37,Kve=96,f7=1,EHe=8,CHe=5,e1e=1,Qte=C(),AHe={heading:0,tilt:0},$0=new pt,OHe=new u_(-20037508342788905e-9,20037508342788905e-9),RHe=new u_(-180,180);var Vo;function PR(t){return t.spatialReference||Ge.WGS84}function KS(t){return t.viewingMode==="global"?SHe:_He}function PHe(t,e,r,i,s){return KS(t).headingTiltToDirectionUp(e,r,i,s)}function qm(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=KS(t).headingTiltToDirectionUp,s=C();if(!yo(e.position,s,r))return null;const n=i(s,e.heading,e.tilt);ie(n.direction,n.direction,t.state.camera.distance),le(n.direction,n.direction,s);const o=ww(t,s,n.direction,n.up);return o.fov=Ft(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Vo||(Vo={}));const Hw=C();function cS(t,e,r){const i=t.renderSpatialReference,s=uF(t,e.eye,e.viewForward,e.up,AHe);let n=PR(t);return Gs(e.eye,i,Hw,n)||(n=Ge.WGS84,Gs(e.eye,i,Hw,n)),r==null?new gh(new pt(Hw,n),s.heading,s.tilt,ja(e.fov)):(r.position.x=Hw[0],r.position.y=Hw[1],r.position.z=Hw[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=ja(e.fov),r)}function NX(t,e,r){const i=t.state.camera,s=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===Ie.Global&&r!=null&&(e*=Math.cos(Ft(r))),e/=t.renderCoordsHelper.unitInMeters,s/(Kve*Qve/e)/Math.tan(i.fovX/2)}function jb(t,e,r){const i=t.state.camera,s=e*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=Kve*Qve/(n/s);return t.renderCoordsHelper.viewingMode===Ie.Global&&r!=null&&(o/=Math.cos(Ft(r))),o*t.renderCoordsHelper.unitInMeters}function t1e(t,e,r,i,s,n){return r1e(t,e,NX(t,r,e.latitude),i,s,n)}function r1e(t,e,r,i,s,n){if(mb(n)){const a=new eE(n.signal);return PO(t,i.heading,i.tilt,e,r,s,a),void a.resolver.promise.then(l=>{const c=$N(t,l,i.fov);if(c!=null)return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=PO(t,i.heading,i.tilt,e,r,s);return $N(t,o,i.fov,n)}function uF(t,e,r,i,s){return KS(t).directionToHeadingTilt(e,r,i,s)}function MHe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,$0,t.spatialReference)&&t.elevationProvider&&(ff(t.elevationProvider,$0)??0)>($0.z??0)-e1e)}async function $He(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,$0,t.spatialReference)||!t.elevationProvider)return!1;const i=$0.z??0;return(await t.elevationProvider.queryElevation($0.x,$0.y,i,$0.spatialReference,"ground",r)??0)>i-e1e}async function IHe(t,e,r){const i=C();if(e)if(e instanceof pt){if(yo(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const s=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return s!=null&&t.renderCoordsHelper.setAltitude(i,s),i}}else re(i,e);else re(i,t.state.camera.center);return i}function LHe(t,e){const r=C();if(e&&e instanceof pt){if(yo(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=ff(t.elevationProvider,e);i!=null&&t.renderCoordsHelper.setAltitude(r,i)}}else re(r,e||t.state.camera.center);return r}function PO(t,e,r,i,s,n,o){const a=i&&i instanceof pt?i:null;if(mb(o))return IHe(t,i,o.signal).then(c=>{m7(t,e,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=LHe(t,i);return m7(t,e,r,a,l,s,n,o)}function m7(t,e,r,i,s,n,o,a){if(i==null){const p=t.renderSpatialReference;if((i=Rg(s,p,PR(t)))==null)return null}n=Math.max(n,t.state.constraints.minimumPoiDistance);const l=FHe(t,e,r,s,n,o),c=(0,KS(t).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===Vo.ADJUST&&t.viewingMode==="global"&&r>0){const p=()=>{const m=i1e(t,s,n,VHe(t,n,r,s));return o=r-m<1?Vo.LOCKED:Vo.ADJUST,m7(t,e,m,i,s,n,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(MHe(t,c.eye))return p();if(mb(a))return $He(t,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:Ms(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||mb(a)?{center:C(),eye:C(),up:C(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=Ms(s),h.heading=c.heading,h.tilt=c.tilt,mb(a)&&a.resolver.resolve(h),h}function vA(t,e,r,i,s,n=null){let o,a,l;if(t.state.isGlobal){if(!p7(e.spatialReference,Ie.Global))return mb(n)&&n.resolver.reject(),null;const v=new pt(e.xmin,e.ymin,e.spatialReference),w=new pt(e.xmax,e.ymax,e.spatialReference),T=e.spatialReference.isGeographic?RHe:OHe;o=new pt({x:T.center(v.x,w.x),y:(w.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const x=Dr(e.spatialReference),S=$7e(o,v,w);a=S.lon,l=S.lat,T.diff(v.x,w.x)>T.range/2&&(a+=x.halfCircumference),a=Math.min(a,x.halfCircumference),l=Math.min(l,x.halfCircumference)}else{const v=t.renderSpatialReference??e.spatialReference;v.equals(e.spatialReference)||(e=mw(e,v)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const w=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new pt({x:e.xmin+.5*a,y:e.ymin+.5*l,z:w,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=t.state.camera,p=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),y=Math.max(.5*a*p,.5*l*f,.5*c*m)/f7;if(mb(n)){const v=new eE(n.signal);return PO(t,r,i,o,y,s,v),void v.resolver.promise.then(w=>{const T=$N(t,w,t.camera.fov);if(T!=null)return n.resolver.resolve(T);n.resolver.reject()},w=>n.resolver.reject(w))}const _=PO(t,r,i,o,y,s);return $N(t,_,t.camera.fov,n)}function DHe(t,e,r){const i=t.renderSpatialReference,s=Rg(r,i,PR(t));if(s==null)return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=aR(e.eye,r),l=2*a*n*f7,c=2*a*o*f7;return t.viewingMode==="global"?Zve(t,s,l,c):Hve(t,s,l,c)}function NHe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>EHe)return!0;const s=t.renderSpatialReference,n=PR(t),o=Rg(e,s,n),a=Rg(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>CHe}function FHe(t,e,r,i,s,n){let o=0;return n===Vo.ADJUST&&NHe(t,i,s)?(e=0,o=UHe(t,s,r,i)):o=FX(t,i,s,r),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:r=i1e(t,i,s,o)}}const MN=.7;function UHe(t,e,r,i){const s=FX(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-MN)+n.max*MN;return Math.min(s,o)}function VHe(t,e,r,i){let s=FX(t,i,e,r);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-MN)+s*MN}function i1e(t,e,r,i){return KS(t).lookAtTiltToEyeTilt(i,e,r)}function FX(t,e,r,i){return KS(t).eyeTiltToLookAtTilt(i,e,r)}function $N(t,e,r,i){if(e==null)return null;const s=t.renderSpatialReference,n=Rg(e.eye,s,PR(t));return n==null?null:i!=null?(i.position=n,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new gh(n,e.heading,e.tilt,r)}function zHe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);Jve.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function s1e(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);Jve.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function n1e(t,e){return Gs(e.center,t.renderSpatialReference,Qte,Ge.WGS84),jb(t,e.distance,Qte[1])}let eE=class{constructor(e){this.signal=e,this.resolver=mo()}};function mb(t){return t&&"resolver"in t}const kHe=.66;function o1e(t){return 360-Rq.normalize(t)}function hF(t){return Rq.normalize(360-t)}function IE(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function BHe(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function a1e(t,e,r,i=null){if(!e)return IE(i);const s=t.spatialReference||Ge.WGS84;if(e.camera!=null){const c=ow(e.camera.position,s);if(c==null)return IE(i);const h=e.camera.clone();return h.position=c.clone(),BHe(i,h)}if(e.targetGeometry==null)return IE(i);const n=e.get("targetGeometry.spatialReference");if(n&&!e_(n,s))return IE(i);const o=cS(t,t.state.camera);let a=Vo.ADJUST;if(e.rotation!=null&&(o.heading=o1e(e.rotation),a=Vo.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const p=e.targetGeometry.clone();return h=e.scale!=null?NX(t,e.scale,c.latitude):t.state.camera.distance,r1e(t,p,h,o,a,i)}const l=e.targetGeometry.extent;return l?vA(t,l,o.heading,o.tilt,a,i):IE(i)}function GHe(t,e,r=null){return r==null&&(r=new tp),zX(t,null,e.clone(),r)}async function jHe(t,e,r){const i=eqe(t,e);if(!i)throw new U("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new gh({fov:t.camera.fov}),n=new tp({camera:s});if(i.target instanceof tp)return nv(await WHe(t,i.target,i,r,n));if(i.target instanceof gh)return nv(c1e(t,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof yr){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return nv(o||c?await g7(t,i,i.target.center,s,r,n):await JHe(t,i,i.target,s,r,n))}const a={boundingBox:xi(),hasZ:!1,screenSpaceObjects:[]},l=o?HHe(t,i):void 0;if(await l1e(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(Dd(a.boundingBox,Es),kc.x=Es[0],kc.y=Es[1],kc.z=Es[2],kc.spatialReference=t.spatialReference,isFinite(kc.z)&&a.hasZ?c=Yq(a.boundingBox):(kc.z=void 0,c=jIe(Zq(a.boundingBox,rqe))),o||c)return nv(await g7(t,i,kc,s,r,n));const h=tqe(t,a.screenSpaceObjects);return nv(await KHe(t,i,kc,a.boundingBox,h,s,r,n))}return i.position?nv(ZHe(t,i,s,n)):nv(await YHe(t,i,s,r,n))}function UX(t,e){return e.scale==null&&e.zoom!=null?s1e(t,e.zoom):e.scale}function HHe(t,e){const r=UX(t,e);return r?nUe(r):void 0}function VX(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=o1e(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function zX(t,e,r,i){const s=t.spatialReference||Ge.WGS84;return(e=e??qm(t,r))==null||(i.targetGeometry=Rg(e.center,t.renderSpatialReference,s),i.scale=n1e(t,e),i.rotation=hF(r.heading),i.camera=r),i}function IN(t,e,r){var a,l;const i=()=>new U("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!e_(e.spatialReference,t.spatialReference))throw new U("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&t.basemapTerrain.spatialReference!=null&&e_(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?Es[2]=ff(t.elevationProvider,c)??0:Es[2]=0}(0,iqe[e.type])(e,c=>{s.push(c[0],c[1],c[2])},Es);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(oi(s,e.spatialReference,0,o,t.spatialReference,0,n)){e.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(Es[0]=o[c],Es[1]=o[c+1],Es[2]=o[c+2]):(Es[0]=o[c],Es[1]=o[c+1]),$f(r.boundingBox,Es)}}async function qHe(t,e,r,i){const s=await lu(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void IN(t,e.geometry,i);const n=s.value,o=await lu(n.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void IN(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;B2(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function l1e(t,e,r,i){var s;if(Array.isArray(e)&&e.length===2){const n=e[0],o=e[1];if(typeof n=="number"&&typeof o=="number")return kc.x=n,kc.y=o,kc.z=void 0,kc.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:Ge.WGS84,void IN(t,kc,i)}e&&"map"in e&&typeof e.map=="function"?await Gf(e.map(n=>l1e(t,n,r,i))):e instanceof M_?IN(t,e,i):e instanceof vh&&await qHe(t,e,r,i)}async function WHe(t,e,r,i,s){if(e.camera!=null)return c1e(t,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=hF(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=UX(t,r);n!=null&&(s.scale=n);const o=new eE(i);return a1e(t,s,r.tilt,o),s.camera=await o.resolver.promise,s}function c1e(t,e,r){const i=t.spatialReference,s=ow(e.position,i);return s==null?null:((e=e.clone()).fov=t.camera.fov,e.position=s,zX(t,null,e,r))}function XHe(t,e,r,i,s,n){const o=t.renderSpatialReference;return yo(r,vM,o),yo(e,FU,o),n.targetGeometry=new pt(e),s.position=new pt(r),he(LN,FU,vM),uF(t,vM,LN,i.up,s),n.scale=jb(t,fi(vM,FU),n.targetGeometry.latitude),n.rotation=hF(s.heading),n.camera=s,n}async function g7(t,e,r,i,s,n){if(r==null)throw new U("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=ww(t);if(e.position)return XHe(t,n.targetGeometry,e.position,o,i,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ie(Es,o.viewForward,-l);o.eye=le(Es,o.center,c),n.scale=jb(t,l,r.latitude)}cS(t,o,i);const a=VX(i,e)?Vo.LOCKED:Vo.ADJUST;if(!e.zoomFactor){const l=UX(t,e);l==null?(yo(r,Es,t.renderSpatialReference),f_e(o.frustum,Es)?n.scale=jb(t,fi(o.eye,Es),r.latitude):n.scale=n1e(t,o)):n.scale=l;const c=new eE(s);t1e(t,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function ZHe(t,e,r,i){const s=ww(t);return re(LN,s.viewForward),uF(t,s.eye,LN,s.up,UU),r.position=new pt(e.position),r.heading=e.heading!=null?e.heading:UU.heading,r.tilt=e.tilt!=null?e.tilt:UU.tilt,zX(t,null,r,i)}async function YHe(t,e,r,i,s){const n=ww(t);return g7(t,e,Rg(n.center,t.renderSpatialReference,t.spatialReference),r,i,s)}async function JHe(t,e,r,i,s,n){n.targetGeometry=r.clone();const o=ww(t);cS(t,o,i);const a=VX(i,e)?Vo.LOCKED:Vo.ADJUST,l=new eE(s);return vA(t,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function QHe(t,e,r,i,s){let n=0;r.z!=null?n=r.z:t.basemapTerrain&&t.elevationProvider&&(n=ff(t.elevationProvider,r)),se(Es,r.x,r.y,n),bl(t.spatialReference,Es,Kte,t.renderSpatialReference),Th(_M,Kte),Sh(_M,_M),xi(LE);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=i[_[2]];isFinite(v)||(v=n),se(Es,i[_[0]],i[_[1]],v),Gs(Es,t.spatialReference,Es,t.renderSpatialReference),$f(LE,ac(Es,Es,_M))}const a=cw(LE),l=I_(LE),c=uw(LE),h=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function KHe(t,e,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=ww(t),c=QHe(t,l,r,i,s);cS(t,l,n);const h=VX(n,e)?Vo.LOCKED:Vo.ADJUST;a.scale=jb(t,c,a.targetGeometry.latitude);const p=new eE(o);return t1e(t,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function eqe(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function nv(t){return t&&t.camera!=null&&(t.rotation=hF(t.camera.heading)),t}function tqe(t,e){const r=kHe;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(t.width,t.height)*2}const Es=C(),Kte=ve(),_M=Ni(),LE=an(),rqe=zt(),LN=C(),vM=C(),FU=C(),UU={heading:0,tilt:0},kc=new pt,iqe={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,s=t.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(se(r,t.xmin,t.ymin,t.zmin)),e(se(r,t.xmax,t.ymin,t.zmin)),e(se(r,t.xmin,t.ymax,t.zmin)),e(se(r,t.xmax,t.ymax,t.zmin)),e(se(r,t.xmin,t.ymin,t.zmax)),e(se(r,t.xmax,t.ymin,t.zmax)),e(se(r,t.xmin,t.ymax,t.zmax)),e(se(r,t.xmax,t.ymax,t.zmax))):(e(se(r,t.xmin,t.ymin,r[2])),e(se(r,t.xmax,t.ymin,r[2])),e(se(r,t.xmin,t.ymax,r[2])),e(se(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)e(se(r,i[s],i[s+1],i[s+2]))}};let sqe=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this.options.signal!=null&&sa(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Lr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await j2(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,jHe(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var n;const r=!!(this.target instanceof tp&&this.target.camera||this.target instanceof gh),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new U("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const s=qm(this.view,i);return s==null?(this.reject(new U("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new U("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;e.isFullySpecified?(s=new _A({view:this.view,desiredCamera:e.camera}),JS(this.view,e.camera,ch.EYE_AND_CENTER)):Os(this.view,e.camera),r.begin(e.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof og&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(r.state){case Wi.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Wi.Ready:case Wi.Rejected:case Wi.Running:case Wi.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof og&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new og({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new U("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},un=class extends xe{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=cS(this.view,this.view.state.camera,VU);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(qm(this.view,e),{applyConstraints:!1})||J.getLogger(this).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=cS(this.view,this.view.state.contentCamera,VU);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=qm(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(zU),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,s=Ia(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([ue(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(zU),this.test.contentCameraResetState.clear())}),ue(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),ue(()=>this.view.state.camera,o=>{const a=ho(s,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],zU),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():J.getLogger(this).error("#center=","Invalid center",e):J.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):J.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=DHe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#extent=","Invalid extent",e):J.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):J.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return jb(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,s=this._get("padding"),n=Math.round(r[er.TOP]/i),o=Math.round(r[er.RIGHT]/i),a=Math.round(r[er.BOTTOM]/i),l=Math.round(r[er.LEFT]/i);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,bM),this.view.state.updateCamera(r=>r.padding=bM))}_paddingToArray(e,r,i){e?bi(i,e.top||0,e.right||0,e.bottom||0,e.left||0):bi(i,0,0,0,0);for(let s=0;s<4;s++)i[s]=Math.round(i[s]*r)}get screenCenter(){const e=this.padding;return _h((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?GHe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||J.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,s=i!=null&&i.spatialReference;J.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else J.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?zHe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return K1(this._tmpCanvasSize,i)?this._tmpCanvasSize.pixelRatio=r:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(Bs.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(Bs.PhysicalPixelRendering,$r.IDLE)||e.isFeatureEnabled(Bs.PhysicalPixelRendering,$r.INTERACTING)||e.isFeatureEnabled(Bs.PhysicalPixelRendering,$r.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new Mg({frustum:M0},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new nqe}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([ka(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),Gr)]),bh(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([$2({prepare:()=>this._prepareFrame()}),ue(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(wM)}),ka(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Pe(this._propertiesPool)}init(){this.constraintsManager=new d3({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===Ie.Local&&this.addHandles(bh(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(wM),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),wM)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(wM),this.constraintsManager=Pe(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new sqe(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(ww(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(s=>i.stepController(e,s)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:s}of aqe){const n=e.has(i),o=this._isOverridden(i);!n&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(n||o)&&s.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof gh)return void this.setStateCamera(qm(this.view,e),{applyConstraints:!1});if(e instanceof tp){if(e.targetGeometry instanceof yr){const n=vA(this.view,e.targetGeometry,0,.5,Vo.LOCKED);return void(n!=null&&this.setStateCamera(qm(this.view,n),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,i)}const r=vA(this.view,e,0,.5,Vo.LOCKED);r!=null&&this.setStateCamera(qm(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&oqe.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof tp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof gh?this.isCompatible(e.position):e.spatialReference&&e_(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=lqe){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=gy){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=PO(this.view,s,n,e,r,Vo.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),s=vA(this.view,e,r,i,Vo.ADJUST,VU);return s?qm(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,s=r.location.latitude;if(s==null)return null;const n=NX(this.view,e,s);return this._centerPointAtDistanceToCamera(i,n)}_zoomToCamera(e){return this._scaleToCamera(s1e(this.view,e))}_viewpointToCamera(e){return qm(this.view,a1e(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&Os(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new _A({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===i.width&&s.fullHeight===i.height&&s.pixelRatio===i.pixelRatio||(gy.copyFrom(s),gy.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,bM),gy.padding=bM),gy.fullWidth=i.width,gy.fullHeight=i.height,gy.pixelRatio=i.pixelRatio,this.view.state.camera=gy),this._updateViewState()}}_updateElevation(e){var n;const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=((n=this.view.renderCoordsHelper)==null?void 0:n.getAltitude(e.eye))??0,s=r?nF(this.view,e.eye):0;e.relativeElevation=i-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=$r.ANIMATING:this.view.interacting?this.view.state.mode=$r.INTERACTING:(this.view.state.mode===$r.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=cqe?this.view.state.mode=$r.INTERACTING:this.view.state.mode=$r.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:gh,dependsOn:["view.state.camera","ready"]})],un.prototype,"camera",null),u([d({type:gh,dependsOn:["view.state.contentCamera","ready"]})],un.prototype,"contentCamera",null),u([d({type:pt})],un.prototype,"center",null),u([d({type:yr})],un.prototype,"extent",null),u([d({readOnly:!0})],un.prototype,"frustum",null),u([d({readOnly:!0})],un.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],un.prototype,"ready",void 0),u([d({type:Number})],un.prototype,"scale",null),u([d()],un.prototype,"padding",null),u([d({readOnly:!0})],un.prototype,"screenCenter",null),u([d({constructOnly:!0})],un.prototype,"view",void 0),u([d({type:tp})],un.prototype,"viewpoint",null),u([d({type:Number})],un.prototype,"zoom",null),u([d({readOnly:!0})],un.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],un.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],un.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],un.prototype,"_windowDevicePixelRatio",void 0),u([d()],un.prototype,"_devicePixelRatioOverride",void 0),un=u([R("esri.views.3d.state.ViewStateManager")],un);let nqe=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const oqe=["camera","viewpoint","extent","scale","center","zoom"],aqe=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],lqe={heading:0,tilt:0},VU=new gh,gy=new lt,bM=Zt(),wM="pending-initial-view",zU="content-camera-reset",cqe=300,ere=100;let mf=class extends Jm{constructor(){super(...arguments),this.startCamera=new lt,this.currentCamera=new lt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<ere}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Wi.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),ere),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],mf.prototype,"isInteractive",null),u([d()],mf.prototype,"_lastInteraction",void 0),mf=u([R("esri.views.3d.state.controllers.InteractiveController")],mf);var Jl;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Jl||(Jl={}));let bA=class extends mf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Jl.CENTER,this._rotScale=0,this._lastPoint=Ue(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=Ue(),this._tmpTransf=ve(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions={selection:Ri.ALL,interactionType:Yt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Gn.TUMBLE}}initialize(){this._rotScale=this.pivot===Jl.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Jl.EYE:re(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Yt.LOOK_AROUND,this._constraintOptions.tiltMode=Gn.LOOK_AROUND,this._constraintOptions.selection=Ri.NONE;break;case Jl.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?xw:{});r||re(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Yt.TUMBLE,this._constraintOptions.tiltMode=Gn.TUMBLE,this._constraintOptions.selection=Ri.ALL&~Ri.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,fb(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,s=C();he(s,this._pivotPos,i.eye);const n=Ee(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,tre);let a=Math.max(Math.min(jje,1/Math.abs(me(tre,i.viewForward)))*o,Hje);r&&(a=Math.min(n,a));const l=Dr(this.view.spatialReference),c=Zi(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),h=cF(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*MU,MU),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,MU);p==null&&f==null||(p=p??f??0,f=f==null||h===Bn.Horizontal?p:f,a=p>f?f:p,a=r?Math.min(a,n):a),ge(s,s),re(this._pivotPos,le(this._tmpPivotPoint,i.eye,ie(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case Jl.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Jl.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Os(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),fb(e,r,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;he(this._tmpViewDir,i,s);const a=Ee(this._tmpViewDir),l=xn(me(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Jl.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=ye(n+l,Ro.min,Ro.max)-l,ot(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Jl.CENTER&&(o=-o),cu(this._tmpTransf,o,this._tmpWorldUp),lc(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),$e(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=$e(kU,e.up,this._tmpTransf),le(kU,s,this._tmpViewDir),ln(this._lastPoint,this._tmpRotCurPoint),kU}};u([d()],bA.prototype,"pivot",void 0),bA=u([R("esri.views.3d.state.controllers.RotateController")],bA);const kU=C(),tre=C();let BU=class extends vo{constructor(e,r,i,s){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!IX(e.data,this.pointerAction))return;const i=Zi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new bA({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},y7=class extends mf{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=Ue(),this._panAxisAngle=aF(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=Bn.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=Zi(),this._normalizedAnchorPoint=Ue(),this._constraintOptions={selection:Ri.ALL_EXCEPT_COLLISION,interactionType:Yt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Gn.TUMBLE},this._sphere=ys(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;ln(this.dragBeginPoint,e),fb(this.startCamera,e,this._normalizedAnchorPoint);const r=Dr(this.view.spatialReference),i=$ve(this._intersectionHelper,this.startCamera,e,r,lS.Ellipsoid,this.view.map.ground.opacity===0?xw:{});if(this._navMode=cF(this.startCamera,e,r),this._navMode===Bn.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let s;QS(this.startCamera,e,this._tmpRay),ge(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(he(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Ee(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,rre);let o=ye(Math.min(Sve,1/Math.abs(me(rre,this._tmpRay.direction)))*n,SN[0],SN[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,lF);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,ie(this._tmpRay.direction,this._tmpRay.direction,o),le(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Bn.Horizontal){he(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Ee(this._tmpRayDir);fb(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;if(this._hasPickPoint&&s<r){const o=1-(1-s/r)*(1-this._sphere[3]/Ee(this.currentCamera.center));this.currentCamera.center=ie(xM,this.currentCamera.center,o)}ie(this._tmpRayDir,this._tmpRayDir,-s/r),this.currentCamera.eye=le(xM,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Pd(Ub(this.dragBeginPoint,e)),Os(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(RO(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),AX(this._pickPoint,this._targetOnSphere,this._panAxisAngle),E_(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Ee(this._tmpRay.direction);fb(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=r*2**i;const n=this.view.state.constraints.minimumPoiDistance;if(i<0&&s<n&&(s=n),Math.abs(r-s)<1e-6)return;ie(this._tmpRayDir,this._tmpRay.direction,1-s/r),this.currentCamera.eye=le(xM,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=le(xM,this.currentCamera.center,this._tmpRayDir)}JS(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};y7=u([R("esri.views.3d.state.controllers.global.ZoomController")],y7);const xM=C(),rre=C();let _7=class extends mf{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=Ue(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=Zi(),this._normalizedAnchorPoint=Ue(),this._constraintOptions={selection:Ri.ALL,interactionType:Yt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:C(),tiltMode:Gn.TUMBLE},this._plane=Mr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;ln(this.dragBeginPoint,e),fb(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?xw:{});he(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Ee(this._tmpDir);ge(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=ye(Math.min(Sve,1/Math.abs(me(uqe,this._tmpDir)))*s,SN[0],SN[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,lF);n=o??n,n=r?Math.min(n,i):n,ie(this._tmpDir,this._tmpDir,n),le(this._tmpP,this.startCamera.eye,this._tmpDir),he(this._tmpN,this.startCamera.eye,this.startCamera.center),ge(this._tmpN,this._tmpN),this._tmpN[1]<0&&na(this._tmpN,this._tmpN),bR(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;qje(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||re(this._tmpPoi,this.currentCamera.center),fb(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);ln(this._normalizedAnchorPoint,this._tmpP0),he(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Ee(this._tmpRayDir);let s=i*(1-r);this._constraintOptions.interactionDirection&&(re(this._constraintOptions.interactionDirection,this._tmpRayDir),ie(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const n=this.view.state.constraints.minimumPoiDistance;r>=0&&s<n&&(s=n,r=-(s-i)/i),Math.abs(i-s)<1e-6||(ie(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=le(ov,this.currentCamera.eye,this._tmpRayDir),Br(ov,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?ov[2]=Math.max(this.startCamera.center[2],ov[2]):ov[2]=Math.min(this.startCamera.center[2],ov[2]),this.currentCamera.center=ov,this._constraintOptions.interactionFactor=Pd(Ub(this.dragBeginPoint,e)),Os(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};_7=u([R("esri.views.3d.state.controllers.local.ZoomController")],_7);const ov=C(),uqe=Ae(0,0,1);let hqe=class extends vo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!IX(e.data,this.pointerAction))return;const i=Zi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new y7({view:this._view}):this._cameraController=new _7({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function kh(t){let e=t*t;return t<0&&(e*=-1),e}function ire(t,e,r){const i=r,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=kh(s.axes[0]),i.translation[1]=kh(s.axes[1]),i.translation[2]=kh(s.buttons[7])-kh(s.buttons[6]),i.heading=kh(s.axes[2]),i.tilt=kh(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*kh(s.axes[0]),i.translation[1]=1.2*kh(s.axes[1]),i.translation[2]=2*-kh(s.axes[2]),i.heading=1.2*kh(s.axes[5]),i.tilt=1.2*kh(s.axes[3])),i.tilt*=o,ie(i.translation,i.translation,a),i}function sre(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function GU(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let eb=class extends mf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new lt,this._headingStart=0,this._constraintOptions={selection:Ri.ALL,interactionType:Yt.NONE,interactionStartCamera:new lt,interactionFactor:0,interactionDirection:null,tiltMode:Gn.LOOK_AROUND}}handleEventGamepad(e){const r=ire(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||GU(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,sre(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=sre(this._keysButtonState,this._transformation);GU(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,av),this._applyDisabledMovementTypes(av),this._applyPan(av.pan),this._applyRotate(av.rotate),this._applyZoom(av.zoom),this._applyAscend(av.ascend),this._constraintOptions.interactionType=Yt.NONE,this._constraintOptions.selection=Ri.COLLISION,Os(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;he(Ya,r.center,r.eye),$e(Ya,Ya,e.matrix),r.center=le(Ya,Ya,r.eye),r.up=$e(Ya,r.up,e.matrix),this._constraintOptions.interactionType=Yt.LOOK_AROUND,this._constraintOptions.selection=Ri.ALL_EXCEPT_COLLISION,Os(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=$e(Ya,r.eye,e.matrix),r.center=$e(Ya,r.center,e.matrix),this.view.state.isGlobal&&(r.up=$e(Ya,r.up,e.matrix)),this._constraintOptions.interactionType=Yt.PAN,this._constraintOptions.selection=Ri.ALL,Os(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=le(Ya,this.currentCamera.eye,ie(Ne.get(),r,e)),re(DE,r),na(DE,DE),this._constraintOptions.interactionDirection=DE,this._constraintOptions.interactionType=Yt.ZOOM,this._constraintOptions.selection=Ri.ALL_EXCEPT_COLLISION,Os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ne.get());if(this._constraintOptions.interactionDirection=re(DE,r),this.view.state.isGlobal){const i=Ee(this.currentCamera.eye),s=(i+e)/i;this.currentCamera.eye=ie(Ya,this.currentCamera.eye,s),this.currentCamera.center=ie(Ya,this.currentCamera.center,s)}else{const i=ie(Ne.get(),r,e);this.currentCamera.eye=le(Ya,this.currentCamera.eye,i),this.currentCamera.center=le(Ya,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Yt.ASCEND,this._constraintOptions.selection=Ri.COLLISION,Os(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ri.ALL_EXCEPT_COLLISION,Os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){_qe(i);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,r,i):this._calculateControlTransformationGlobal(s,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,Ya)}_calculateControlTransformationLocal(e,r,i){const{viewRight:s,viewForward:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=se(Ne.get(),n[0],n[1],0);ge(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=ie(Ne.get(),s,c);Sl(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=ie(Ne.get(),l,_);Sl(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(lc(i.rotate.matrix,i.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Ne.get())),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=S_(this.view.renderCoordsHelper,r.center,r.eye),y=ye(m+f,Ro.min,Ro.max)-m;y&&(lc(i.rotate.matrix,i.rotate.matrix,y,s),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:s,viewRight:n}=r,o=this._transformation,a=this.view.navigation.gamepad,l=ot(Ne.get(),n,s);ge(l,l),na(l,l),Qje(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(av.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=o.translation[2]*e.ascend;i.ascend=h;const p=-o.heading*e.rotate;p!==0&&(lc(i.rotate.matrix,i.rotate.matrix,p,this._tmpCamera.eye),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,r.ray,c);m!==0&&(lc(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const s=Dr(this.view.spatialReference),n=aL(Ro.min,r.origin,i,s);let o=0,a=0;const l=Ne.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=S_(this.view.renderCoordsHelper,l,r.origin);o=aL(c,r.origin,i,s),a=aL(Ro.max,r.origin,i,s)}else{qS(R5(P5,i+s.radius),r,l);const c=Math.PI+O5(r.direction,l);o=zte(c,r.origin,i,s),a=zte(Ro.max,r.origin,i,s)}return ye(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=r+Math.abs(n-r);return s.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:s}=this.view.state,{direction:n}=PHe(this.view,r,0,u1e,yqe),o=i.intersectManifoldClosestSilhouette(uu(r,n),e,Ne.get()),a=fi(r,o),l=i.intersectManifoldClosestSilhouette(uu(r,Ng(Ne.get(),r,s.center)),e,Ne.get()),c=fi(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:s,isGlobal:n}=i,o=r.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Ne.get());if(n){const a=he(Ne.get(),e,o),l=Ee(a);ie(a,a,1/l);const c=ge(Ne.get(),e),h=xn(me(c,a));return l*Math.sin(Math.min(pqe,h))}{const a=re(Ne.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),fi(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:fqe}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Dr(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=Ne.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=s.width/2,h=nre*s.width,p=nre*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/i,y=f/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(n?m:f)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*_-_),zoom:2**(h*e/c)*l-l,rotate:ye(y*p,mqe,gqe)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&wh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&wh(e.rotate.matrix))}static activatesFor(e,r){const i=ire(r,e.navigation.gamepad,dqe);return!(r.action==="end"||GU(i))}};u([d({constructOnly:!0})],eb.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],eb.prototype,"disableMovements",void 0),eb=u([R("esri.views.3d.state.controllers.GamepadKeyboardController")],eb);const dqe={translation:[0,0,0],heading:0,tilt:0,zoom:0},u1e=80,pqe=Ft(u1e),nre=.75,fqe=5,mqe=Ft(30),gqe=Ft(80),av={zoom:0,ascend:0,pan:{enabled:!1,matrix:ve()},rotate:{enabled:!1,matrix:ve()}},Ya=C(),DE=C(),yqe=LX();function _qe(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,wh(t.pan.matrix),t.rotate.enabled=!1,wh(t.rotate.matrix)}let vqe=class extends vo{constructor(e){super(!0),this._view=e,this._watchHandles=new Pi,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ue(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Vr),ue(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||eb.activatesFor(this._view,e.data)){if(!i){const s=new eb({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var jl;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(jl||(jl={}));let bqe=class extends vo{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ie.Local},this._keyToNumber={[r.left]:jl.LEFT,[r.right]:jl.RIGHT,[r.forward]:jl.FORWARD,[r.backward]:jl.BACKWARD,[r.up]:jl.UP,[r.down]:jl.DOWN,[r.headingLeft]:jl.HEADINGLEFT,[r.headingRight]:jl.HEADINGRIGHT,[r.tiltUp]:jl.TILTUP,[r.tiltDown]:jl.TILTDOWN,[r.zoomIn]:jl.ZOOMIN,[r.zoomOut]:jl.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new eb({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},wqe=class extends vo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new ON({view:this._view,mode:"interaction"}):new RN({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Zi(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},DN=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},Hb=class extends AO{constructor(){super(...arguments),this._beginCamera=new lt,this._elapsedTimeSec=0,this.constraintOptions={selection:Ri.ALL,interactionType:Yt.PAN,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Gn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new tS}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),Os(this.view,r,this.constraintOptions)}};Hb=u([R("esri.views.3d.state.controllers.momentum.MomentumController")],Hb);let wA=class extends Hb{constructor(e){super(e),this.interactionType=Yt.PAN,this._tmpPan=C()}momentumStep(e,r){const i=this.momentum.value(e);ie(this._tmpPan,this.momentum.direction,i),r.eye=he(ore,r.eye,this._tmpPan),r.center=he(ore,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],wA.prototype,"momentum",void 0),wA=u([R("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],wA);const ore=C(),xqe=C(),TM=C();let cL=class extends Hb{constructor(e){super(e),this.interactionType=Yt.PAN}momentumStep(e,r){const i=this.momentum.value1(e),s=this.momentum.value2(e);re(TM,r.eye),ge(TM,TM),ot(this.momentum.axis2,TM,this.momentum.axis1),Nve(r,xqe,this.momentum.axis1,i,this.momentum.axis2,s)}};u([d({constructOnly:!0})],cL.prototype,"momentum",void 0),cL=u([R("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],cL);let V1=class extends Hb{set center(e){this._set("center",Ms(e))}set axis(e){this._set("axis",Ms(e))}constructor(e){super(e),this.interactionType=Yt.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);E_(r,this.center,OO(this.axis,i))}};u([d({constructOnly:!0})],V1.prototype,"momentum",void 0),u([d({constructOnly:!0})],V1.prototype,"center",null),u([d({constructOnly:!0})],V1.prototype,"axis",null),V1=u([R("esri.views.3d.state.controllers.momentum.MomentumController")],V1);let HT=class extends Hb{set zoomCenter(e){this._set("zoomCenter",Ms(e))}constructor(e){super(e),this.interactionType=Yt.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;re(i,r.eye);const s=this.momentum.valueDelta(0,e);PX(r,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Ng(i,r.eye,i)}};u([d({constructOnly:!0})],HT.prototype,"momentum",void 0),u([d({constructOnly:!0})],HT.prototype,"zoomCenter",null),HT=u([R("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],HT);let s1=class extends Hb{set screenCenter(e){this._set("screenCenter",Zi(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Ms(e))}constructor(e){super(e),this.interactionType=Yt.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=aF(),this._sphere=ys()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);Pve(this._sphere,r,i),this.constraintOptions.interactionType=Yt.ZOOM,Os(this.view,r,this.constraintOptions),RO(this._sphere,r,this.screenCenter,this._tmpSceneCenter),AX(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),E_(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Yt.PAN}};u([d({constructOnly:!0})],s1.prototype,"momentum",void 0),u([d({constructOnly:!0})],s1.prototype,"screenCenter",null),u([d({constructOnly:!0})],s1.prototype,"sceneCenter",null),u([d({constructOnly:!0})],s1.prototype,"radius",void 0),s1=u([R("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],s1);let Md=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},dF=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},Tqe=class extends dF{constructor(e,r,i,s,n){super(e,r,i),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},h1e=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Md(.6),this._screen=[new Md(.4),new Md(.4)],this._scene=[new Md(.6),new Md(.6),new Md(.6)],this._tmpDirection=C()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ee(this._tmpDirection);s>0&&ie(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Tqe(e,r,i,n==null?0:s/n,this._tmpDirection)}},are=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const lre=1e-5;let Sqe=class extends dF{constructor(e,r,i,s,n,o=0,a){super(e,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},Eqe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=Ue(),this._time=new Md(.3),this._screen=[new Md(.4),new Md(.4)],this._angle1=new are(.6),this._angle2=new are(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(e,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=Lve(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),ea(this._tmpAxis2)<lre?a=0:ge(this._axis1,this._tmpAxis2),this._angle1.update(a),re(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;Dve(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),ea(this._tmpAxis2)<lre?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ge(this._axis1,this._tmpAxis1),ge(this._axis2,this._tmpAxis2)),re(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new Sqe(e,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},d1e=class{constructor(e=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new Md(.8),this.time=new Md(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ye(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new dF(e,r,i)}},p1e=class extends d1e{constructor(e=3,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){const i=this.value.lastValue;if(i!=null){let s=e-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=i+s}super.add(e,r)}},Cqe=class extends dF{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),s=super.value(e+r)-i;return Math.exp(s)}},f1e=class extends d1e{constructor(e=2.5,r=.01,i=.95,s=12){super(e,r,i,s)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new Cqe(e,r,i)}},v7=class extends mf{constructor(){super(...arguments),this._smoothRotation=new DN(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Mr(),this._beginRadius=0,this._smoothScaling=new DN(.05),this._zoomCenterScreen=Zi(),this._zoomMomentumEstimator=new f1e,this._rotationMomentumEstimator=new p1e,this._panSphericalMomentumEstimator=new Eqe,this._panPlanarMomentumEstimator=new h1e,this._adjustedSphere=ys(),this._tmp3d=C(),this._tmpScreenPointArray=Zi(),this._beginScreenPoint=Zi(),this._beginScenePoint=C(),this._screenPickPoint=Zi(),this._scenePickPoint=C(),this._mode=Bn.Horizontal,this._sphere=ys(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._constraintOptions={selection:Ri.ALL,interactionType:Yt.NONE,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Gn.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var n;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-h_.normalize(Ft(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),lf(e.center,this._screenPickPoint),ln(this._beginScreenPoint,this._screenPickPoint);const i=Dr(this.view.spatialReference),s=$ve(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,lS.Silhouette,this.view.map.ground.opacity===0?xw:{});s.scenePickPoint!=null&&(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,re(this._beginScenePoint,this._scenePickPoint),this._mode=cF(this.startCamera,this._screenPickPoint,i),this._mode===Bn.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(n=this._constraintOptions.interactionStartCamera)==null||n.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===Bn.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===Bn.Horizontal?new s1({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new HT({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new V1({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===Bn.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new cL({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new wA({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,r){const i=na(this._tmp3d,this.startCamera.viewForward);bR(this._scenePickPoint,i,this._panningPlane);const s=Zi(this._screenPickPoint[0],0),n=C(),o=Ee(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],RO(this._adjustedSphere,this.startCamera,s,n);const a=Fo();this.startCamera.projectToRenderScreen(n,a);const l=C(),c=C(),h=C();he(l,this._scenePickPoint,this.currentCamera.eye);const p=Ee(l);ge(l,l);const f=Ove*Math.max(Math.abs(this.view.camera.position.z),Rve),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,lF);let y=m??f;y=r?Math.min(y,p):y,re(h,le(c,this.currentCamera.eye,ie(c,l,y))),this._panningPlane[3]=-me(this._panningPlane,h),this.startCamera.center=le(c,this.startCamera.eye,ie(c,this.startCamera.viewForward,y));const _=lf(e.center,this._tmpScreenPointArray);d7(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),Pve(this._sphere,this.currentCamera,this._smoothScaling.value),lf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Yt.ZOOM,this._constraintOptions.interactionFactor=Pd(e.radius-this._beginRadius),Os(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=lf(e.center,this._tmpScreenPointArray);RO(this._sphere,this.currentCamera,r,this._tmp3d),MX(this._beginScenePoint,me(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Uve(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Fve(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Yt.PAN,this._constraintOptions.interactionFactor=Pd(Ub(this._screenPickPoint,r)),Os(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ge(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||na(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+h7(e.angle-r),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),E_(this.currentCamera,this._sphere,OO(this._rotationAxis,n)),this._constraintOptions.interactionType=Yt.TUMBLE,this._constraintOptions.interactionFactor=Pd(e.radius*i),Os(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=lf(e.center,this._tmpScreenPointArray);d7(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(Ive(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Yt.PAN,this._constraintOptions.interactionFactor=Pd(Ub(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Os(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),PX(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Yt.ZOOM,this._constraintOptions.interactionFactor=Pd(e.radius-this._beginRadius),Os(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){re(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||na(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=h7(i);const s=r+i,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),E_(this.currentCamera,this._sphere,OO(this._rotationAxis,o)),this._constraintOptions.interactionType=Yt.TUMBLE,this._constraintOptions.interactionFactor=Pd(e.radius*o),Os(this.view,this.currentCamera,this._constraintOptions)}};v7=u([R("esri.views.3d.state.controllers.global.PinchAndPanController")],v7);const cre=Ae(0,0,1),Aqe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let b7=class extends mf{constructor(){super(...arguments),this._rotationValueSmooth=new DN(.05),this._scalingValueSmooth=new DN(.05),this._planeHorizontal=Mr(),this._planeVertical=Mr(),this._rotationMomentumEstimator=new p1e,this._panMomentumEstimator=new h1e(300,12,.9),this._zoomMomentumEstimator=new f1e,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Bn.Horizontal,this._beginCenterScreen=Zi(),this._tmpCentroid3d=C(),this._tmpCentroid2d=Zi(),this._tmp2d=Zi(),this._pointerCount=0,this._constraintOptions={selection:Ri.ALL,interactionType:Yt.NONE,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Gn.TUMBLE}}begin(e){var y;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),lf(e.center,this._beginCenterScreen),Qge(cre,0,this._planeHorizontal);const i=C(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?xw:{}),n=C();na(n,this.startCamera.viewForward);const o=C();re(o,cre);const a=me(n,o),l=mh(a<0?-a:a);this._panMode=l>=Aqe.ANGLE_THRESHOLD?Bn.Horizontal:Bn.Vertical;const c=Math.min(Ove,1/Math.abs(me(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),Rve);Ik(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||Lk(this._planeHorizontal,this._planeHorizontal);const h=C(),p=C(),f=C();he(h,i,this.currentCamera.eye);const m=Ee(h);if(ge(h,h),this._panMode===Bn.Vertical){ie(o,o,a),he(this._planeVertical,n,o),ge(this._planeVertical,this._planeVertical),Ik(this._planeVertical,this._planeVertical,i);const _=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,lF);let v=_??c;v=s?Math.min(v,m):v,re(f,le(p,this.currentCamera.eye,ie(p,h,v))),this._planeVertical[3]=-me(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),$U(this._tmpPoints,this._beginCenter)}else{const _=s?m:c;re(f,le(p,this.currentCamera.eye,ie(p,h,_))),this._planeHorizontal[3]=-me(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),$U(this._tmpPoints,this._beginCenter)}(y=this._constraintOptions.interactionStartCamera)==null||y.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===Bn.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(r){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),PX(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Yt.ZOOM,this._constraintOptions.interactionFactor=Pd(Math.abs(e.radius-this._beginRadius)),Os(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),$U(this._tmpPoints,this._tmpCentroid3d),lf(e.center,this._tmpCentroid2d),Ive(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Yt.PAN,this._constraintOptions.interactionFactor=Pd(Ub(this._beginCenterScreen,this._tmpCentroid2d)),Os(this.view,this.currentCamera,this._constraintOptions),r){const n=this._planeHorizontal,o=s,a=this._rotationValueSmooth.value,l=a+h7(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),E_(this.currentCamera,o,OO(n,h)),this._constraintOptions.interactionType=Yt.TUMBLE,this._constraintOptions.interactionFactor=Pd(Math.abs(e.radius*h)),Os(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new HT({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new V1({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new wA({view:this.view,momentum:s}):null}_computePlanePoints(e,r,i,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=C()),d7(r,i,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};b7=u([R("esri.views.3d.state.controllers.local.PinchAndPanController")],b7);let ure=class extends vo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!IX(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new v7({view:this._view}):new b7({view:this._view})}},Oqe=class extends vo{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},m1e=class extends vo{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Rqe=class extends m1e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Pqe=class extends m1e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Mqe=class extends vo{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var s,n,o;const r=this._invert?-1:1,i=Zi(0,e.data.delta*r);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new bA({view:this._view,pivot:Jl.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(n=this._cameraController)==null||n.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function hre(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>Lqe(r,t.axisThreshold))}:{buttons:[],axes:[]}}function $qe(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function Iqe(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Lqe(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let Dqe=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,hre(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new IW(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=$2({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=hre(n),l=i||Iqe(a);o&&(o.timestamp===s.timestamp||!o.active&&l||$qe(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&e(s)}}_emitGamepadEvent(e,r,i){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const dre=oe("edge"),Nqe=oe("chrome"),Fqe=oe("ff"),Uqe=oe("safari"),pre="esri-view-surface",qw={touchNone:`${pre}--touch-none`,touchPan:`${pre}--touch-pan`};let g1e=class y1e{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Dqe(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Pe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(jU[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&jU[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(jU[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?qw.touchNone:qw.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?qw.touchPan:qw.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(qw.touchNone),this._element.classList.remove(qw.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=Zye(this._element,e);return y1e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=j8e(r);i&&e==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:dre&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}dre?i*=.7:Nqe||Uqe?i*=.6:Fqe&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};g1e.test={disableSubpixelCoordinates:!1};const jU={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Vqe=class extends vo{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function _1e(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function zqe(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function kqe(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:_h()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[O,A]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(O*O+A*A)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let r=0,i=0;for(let x=0;x<t.length;x++)r+=t[x].x,i+=t[x].y;r/=t.length,i/=t.length;const s=t.map(x=>x.x-r),n=t.map(x=>x.y-i);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let x=0;x<s.length;x++){const S=s[x],O=n[x],A=S*S,P=O*O;o+=A,a+=P,l+=S*O,c+=A*S,h+=P*O,p+=S*P,f+=O*A}const m=.5*(c+p),y=.5*(h+f),_=o*a-l*l,v=(m*a-y*l)/_,w=(o*y-l*m)/_,T=_h(v+r,w+i);return{radius:Math.sqrt(v*v+w*w+(o+a)/t.length),center:T}}function xA(t){const{native:e}=t,{pointerId:r,button:i,pointerType:s}=e;return s==="mouse"?`${r}:${i}`:`${s}`}let Bqe=class extends vo{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:Gqe(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=SM(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=uL(s,v1e(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=SM(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=SM(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=uL(i,r)-e,i.lastAngle=uL(i,r)-e})}_emitEvent(e,r,i){const s=SM(this._activePointerMap);this._drag.emit(this._createPayload(e,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,s=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function v1e(t){const e=[];return t.forEach(r=>{e.push(_h(r.event.x,r.event.y))}),kqe(e)}function SM(t){const e=v1e(t);let r=0;return t.forEach(i=>{let s=uL(i,e),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function Gqe(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function uL(t,e){const r=t.event,i=r.x-e.center.x,s=r.y-e.center.y;return Math.atan2(s,i)}var fre;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(fre||(fre={}));const Z0={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let jqe=class extends vo{constructor(e=Z0.maximumDoubleClickDelay,r=Z0.maximumDoubleClickDistance,i=Z0.maximumDoubleTouchDelay,s=Z0.maximumDoubleTouchDistance,n=iR){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Li(e.doubleClickTimer))}get hasPendingInputs(){return $o(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=Li(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:s}=e.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;_1e(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=xA(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,s=xA(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},Hqe=class extends vo{constructor(e=Z0.maximumDoubleClickDelay,r=Z0.maximumDoubleClickDistance,i=Z0.maximumDoubleTouchDelay,s=Z0.maximumDoubleTouchDistance,n=iR){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=xA(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=xA(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;_1e(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=xA(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const NE={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let qqe=class extends vo{constructor(e=NE.maximumClickDelay,r=NE.movementUntilMouseDrag,i=NE.movementUntilPenDrag,s=NE.movementUntilTouchDrag,n=NE.holdDelay,o=iR){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Li(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):zqe(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),s.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},Wqe=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Xqe=class extends vo{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Wqe({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),h=Math.min(h,v);const p=i-s,f=n-o,m=a-l,y=c-h;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}},nd=class extends xe{constructor(){super(...arguments),this._handles=new Pi}destroy(){this._handles=Pe(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Pe(this._inputManager)}connect(){const e=this.view;this._source=new g1e(this.view.surface,e.input);const r=[new Hqe,new qqe,new jqe,new Bqe(this.view.navigation),new Xqe],i=new $u({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new Vqe],r_.INTERNAL),this._modeDragPan=new ure(e,"primary"),this._modeDragRotate=new BU(e,"secondary",Jl.CENTER),this._modeDragZoom=new hqe(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new Oqe(e),new nHe(e),new vqe(e),new bqe(e,s.pan),new wqe(e),new Pqe(e,s.resetTilt),new Rqe(e,s.resetHeading),new BU(e,"primary",Jl.EYE,[s.lookAround]),new BU(e,"secondary",Jl.CENTER,[s.lookAround]),new ure(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Mqe(e)],r_.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ue(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},Vr))}_updateMode(){var s;const e=this.mode,r=this.primaryDragAction,i=(s=w7.get(e))==null?void 0:s.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],nd.prototype,"view",void 0),u([d({value:"pan"})],nd.prototype,"primaryDragAction",null),u([d({value:"default"})],nd.prototype,"mode",null),u([d({readOnly:!0})],nd.prototype,"updating",null),u([d()],nd.prototype,"latestPointerType",null),u([d()],nd.prototype,"latestPointerLocation",null),u([d()],nd.prototype,"multiTouchActive",null),u([d()],nd.prototype,"_inputManager",void 0),nd=u([R("esri.views.3d.input.SceneInputManager")],nd);const w7=new Map,HU=new Map,qU=new Map;HU.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),HU.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),qU.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),qU.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),w7.set("default",HU),w7.set("pro",qU);const Zqe=nd;let vs=class extends xe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],vs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],vs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],vs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],vs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],vs.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],vs.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],vs.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],vs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],vs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],vs.prototype,"SHOW_POI",void 0),u([d()],vs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],vs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],vs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],vs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],vs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],vs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],vs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],vs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],vs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],vs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],vs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],vs.prototype,"LINE_WIREFRAMES",void 0),vs=u([R("esri.views.3d.support.DebugFlags")],vs);const ni=new vs;let Bc,m2,x7=!1,T7=!1,S7=!1,E7=!1,TA=null;function Yqe(t,e){if(!T7||!m2)return;b1e();const r=m2;let i=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];i+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,h=(n+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),w1e(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function Jqe(t){S7=ni.DECONFLICTOR_SHOW_VISIBLE,E7=ni.DECONFLICTOR_SHOW_INVISIBLE,x7=S7||E7,T7=ni.DECONFLICTOR_SHOW_GRID,TA=null,x7||T7?TA=()=>Qqe(t):Bc&&(Bc.parentElement.removeChild(Bc),Bc=null)}function b1e(){TA&&(TA(),TA=null)}function Qqe(t){Bc==null&&(Bc=document.createElement("canvas"),Bc.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Bc));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:s,height:n}=r,o=s*i,a=n*i;Bc.setAttribute("width",`${o}px`),Bc.setAttribute("height",`${a}px`),Bc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),m2=Bc.getContext("2d"),m2.clearRect(0,0,s,n),m2.font="12px Arial"}function w1e(t,e,r,i,s){b1e();const n=Bc.height,o=m2;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-r),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.closePath()}function Kqe(t,e){x7&&(e&&S7||!e&&E7)&&w1e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Do,zn;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Do||(Do={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(zn||(zn={}));function x1e(t,e){return new C1e(t,O1e,e)}function eWe(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=O1e;return new C1e(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:WU.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:WU.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:WU.minPixelSize},e)}function tWe(t){return Math.abs(t*t*t)}function T1e(t,e,r){const i=r.parameters,s=r.paddingPixelsOverride;return FE.scale=Math.min(i.divisor/(e-i.offset),1),FE.factor=tWe(t),FE.minPixelSize=i.minPixelSize,FE.paddingPixels=s,FE}function S1e(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function kX(t,e){return Math.max(xt(t*e.scale,t,e.factor),S1e(t,e))}function rWe(t,e,r){const i=T1e(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,kX(1,i)}function mre(t,e,r,i){i.scale=rWe(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function E1e(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,S1e(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function iWe(t,e,r,i){return kX(t,T1e(e,r,i))}let C1e=class A1e{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,s=sWe(),n){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===Ie.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new A1e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),h=this._coverageCompensation(e,r,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),_=m/Math.cos(y),v=y+a*n*h,w=(_-f*(m/Math.cos(v)))/(1-f);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=w,i.divisor=_-w,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=gre){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=gre){const s=this._description.curvatureDependent,n=1+e.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ye((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return i.tiltAngle=xt(h.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=xt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}};const O1e={curvatureDependent:{min:{curvature:Ft(10),tiltAngle:Ft(12),scaleFallOffFactor:.5},max:{curvature:Ft(70),tiltAngle:Ft(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},WU={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function sWe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const FE={scale:0,factor:0,minPixelSize:0,paddingPixels:0},gre={tiltAngle:0,scaleFallOffFactor:0};function nWe(t){return t instanceof Float32Array&&t.length>=16}function oWe(t){return Array.isArray(t)&&t.length>=16}function aWe(t){return nWe(t)||oWe(t)}function BX(t){t.vertex.code.add(b`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(b`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(b`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(b`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(b`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(b`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(b`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function lWe(t){t.uniforms.add(new rr("screenSizePerspective",e=>R1e(e.screenSizePerspective)))}function pF(t){t.uniforms.add(new rr("screenSizePerspectiveAlignment",e=>R1e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function R1e(t){return bi(cWe,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const cWe=Zt();var $i,Qu,SA,is,Ks;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})($i||($i={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Qu||(Qu={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(SA||(SA={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(is||(is={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Ks||(Ks={}));let uWe=class{constructor(e,r){this.vec3=e,this.id=r}};function NN(t,e,r,i){return new uWe(Ae(t,e,r),i)}var Ma;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Ma||(Ma={}));const GX=1.3;let yre=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=zt(),this.resolution=0,this.renderLocalOrigin=NN(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new hWe,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===Ma.ColorAndWater?this.renderTargets.getTarget(is.Color):e===Ma.Highlight?this.renderTargets.getTarget(is.Highlight):e===Ma.ObjectAndLayerIdColor?this.renderTargets.getTarget(is.ObjectAndLayerIdColor):this.renderTargets.getTarget(is.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(is.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(is.Color):null}getNormalTexture(e){const r=e===Ma.ColorAndWater?this.renderTargets.getTarget(is.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==is.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?iS.CHANGED:iS.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[is.Color]|+e[is.ColorNoRasterImage]<<1|+e[is.Highlight]<<2|+e[is.Water]<<3|+e[is.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];DD(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];DD(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Eg(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===$i.INNER?0:this.resolution,0,this.resolution,this.resolution)}},hWe=class{constructor(){this.extents=[zt(),zt(),zt()],this.numViews=0}},P1e=class extends ls{constructor(e,r){super(e,"mat4",Jr.Draw,(i,s,n)=>i.setUniformMatrix4fv(e,r(s,n)))}};function sp(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",za):t.uniforms.add(new iu("cameraPosition",(r,i)=>se(M1e,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function fc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Di("proj",(i,s)=>s.camera.projectionMatrix),new P1e("view",(i,s)=>Sl(_re,s.camera.viewMatrix,i.origin)),new iu("localOrigin",i=>i.origin));const r=i=>se(M1e,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Di("proj",(i,s)=>s.camera.projectionMatrix),new Di("view",(i,s)=>Sl(_re,s.camera.viewMatrix,r(s))),new Vt("localOrigin",(i,s)=>r(s)))}const _re=ve(),M1e=C();function uS(t){t.uniforms.add(new Di("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function tE(t,e){t.uniforms.add(new Oe("pixelRatio",(r,i)=>i.camera.pixelRatio/(e.draped?GX:1)))}function $1e(t,e){const r=t.vertex;e.hasVerticalOffset?(I1e(r),e.hasScreenSizePerspective&&(t.include(BX),pF(r),sp(t.vertex,e)),r.code.add(b`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?b`vec3 worldNormal = normalize(worldPos + localOrigin);`:b`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?b`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:b`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(b`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const dWe=Zt();function I1e(t){t.uniforms.add(new rr("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return bi(dWe,n*a,o,i,s)}))}function fF(t){t.uniforms.add(new Sf("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(b`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(b`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var Xl;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Xl||(Xl={}));var gl;function L1e(t,e){t.include(BX),t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.NORMAL,"vec3"),t.attributes.add(E.AUXPOS1,"vec4");const r=t.vertex;fc(r,e),sp(r,e),r.uniforms.add(new rr("viewport",(i,s)=>s.camera.fullViewport),new Oe("polygonOffset",i=>i.shaderPolygonOffset),new Oe("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new Oe("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===Xl.Occluded?1:s.renderTransparentlyOccludedHUD===Xl.NotOccluded?0:.75),new Je("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)),e.hasVerticalOffset&&I1e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(b`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(b`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.draped&&!e.hasVerticalOffset||uS(r),e.draped||(r.uniforms.add(new Oe("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(b`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===gl.Screen&&tE(r,e),e.hasScreenSizePerspective&&pF(r),r.code.add(b`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===gl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?b`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==gl.Screen?b`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===gl.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===gl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(fF),r.code.add(b`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(gl||(gl={}));const EM=an();function D1e(t,e,r,i,s,n){if(t.visible)if(t.boundingInfo){tt(t.type===os.Mesh);const o=e.tolerance;N1e(t.boundingInfo,r,i,o,s,n)}else{const o=t.indices.get(E.POSITION),a=t.vertexAttributes.get(E.POSITION);MR(r,i,0,o.length/3,o,a,void 0,s,n)}}const pWe=C();function N1e(t,e,r,i,s,n){if(t==null)return;const o=U1e(e,r,pWe);if(Xfe(EM,t.bbMin),Zfe(EM,t.bbMax),s!=null&&s.applyToAabb(EM),HX(EM,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,h=a?a.length:l.length/3;if(h>yWe){const p=t.getChildren();if(p!==void 0){for(const f of p)N1e(f,e,r,i,s,n);return}}MR(e,r,0,h,l,c,a,s,n)}}const F1e=C();function MR(t,e,r,i,s,n,o,a,l){if(o)return fWe(t,e,r,i,s,n,o,a,l);const{data:c,stride:h}=n,p=t[0],f=t[1],m=t[2],y=e[0]-p,_=e[1]-f,v=e[2]-m;for(let w=r,T=3*r;w<i;++w){let x=h*s[T++],S=c[x++],O=c[x++],A=c[x];x=h*s[T++];let P=c[x++],I=c[x++],V=c[x];x=h*s[T++];let k=c[x++],B=c[x++],z=c[x];a!=null&&([S,O,A]=a.applyToVertex(S,O,A,w),[P,I,V]=a.applyToVertex(P,I,V,w),[k,B,z]=a.applyToVertex(k,B,z,w));const Z=P-S,W=I-O,H=V-A,Y=k-S,M=B-O,D=z-A,N=_*D-M*v,G=v*Y-D*y,X=y*M-Y*_,K=Z*N+W*G+H*X;if(Math.abs(K)<=Number.EPSILON)continue;const ee=p-S,_e=f-O,Le=m-A,_t=ee*N+_e*G+Le*X;if(K>0){if(_t<0||_t>K)continue}else if(_t>0||_t<K)continue;const Rt=_e*H-W*Le,at=Le*Z-H*ee,vt=ee*W-Z*_e,ze=y*Rt+_*at+v*vt;if(K>0){if(ze<0||_t+ze>K)continue}else if(ze>0||_t+ze<K)continue;const fe=(Y*Rt+M*at+D*vt)/K;fe>=0&&l(fe,jX(Z,W,H,Y,M,D,F1e),w,!1)}}function fWe(t,e,r,i,s,n,o,a,l){const{data:c,stride:h}=n,p=t[0],f=t[1],m=t[2],y=e[0]-p,_=e[1]-f,v=e[2]-m;for(let w=r;w<i;++w){const T=o[w];let x=3*T,S=h*s[x++],O=c[S++],A=c[S++],P=c[S];S=h*s[x++];let I=c[S++],V=c[S++],k=c[S];S=h*s[x];let B=c[S++],z=c[S++],Z=c[S];a!=null&&([O,A,P]=a.applyToVertex(O,A,P,w),[I,V,k]=a.applyToVertex(I,V,k,w),[B,z,Z]=a.applyToVertex(B,z,Z,w));const W=I-O,H=V-A,Y=k-P,M=B-O,D=z-A,N=Z-P,G=_*N-D*v,X=v*M-N*y,K=y*D-M*_,ee=W*G+H*X+Y*K;if(Math.abs(ee)<=Number.EPSILON)continue;const _e=p-O,Le=f-A,_t=m-P,Rt=_e*G+Le*X+_t*K;if(ee>0){if(Rt<0||Rt>ee)continue}else if(Rt>0||Rt<ee)continue;const at=Le*Y-H*_t,vt=_t*W-Y*_e,ze=_e*H-W*Le,fe=y*at+_*vt+v*ze;if(ee>0){if(fe<0||Rt+fe>ee)continue}else if(fe>0||Rt+fe<ee)continue;const Tt=(M*at+D*vt+N*ze)/ee;Tt>=0&&l(Tt,jX(W,H,Y,M,D,N,F1e),T,!1)}}const vre=C(),bre=C();function jX(t,e,r,i,s,n,o){return se(vre,t,e,r),se(bre,i,s,n),ot(o,vre,bre),ge(o,o),o}function U1e(t,e,r){return se(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function HX(t,e,r,i){return qX(t,e,r,i,1/0)}function qX(t,e,r,i,s){const n=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-i-e[1])*r[1],h=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(t[2]-i-e[2])*r[2],f=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function V1e(t,e,r,i,s){let n=(r.screenLength||0)*t.pixelRatio;s!=null&&(n=iWe(n,i,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return ye(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function z1e(t,e){const r=e?z1e(e):{};for(const i in t){let s=t[i];s&&s.forEach&&(s=gWe(s)),s==null&&i in r||(r[i]=s)}return r}function mWe(t,e){let r=!1;for(const i in e){const s=e[i];s!==void 0&&(Array.isArray(s)?t[i]===null?(t[i]=s.slice(),r=!0):_H(t[i],s)&&(r=!0):t[i]!==s&&(r=!0,t[i]=s))}return r}function gWe(t){const e=[];return t.forEach(r=>e.push(r)),e}const k1e={multiply:1,ignore:2,replace:3,tint:4},yWe=1e3;let U_=class extends CR{constructor(e,r){super(),this.type=os.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=vr,this._pp0=Ae(0,0,1),this._pp1=Ae(0,0,0),this._parameters=z1e(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){mWe(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,r,i,this._pp0,this._pp1,n)}},B1e=class extends UBe{constructor(e,r,i){super(r,i),this.camera=e}};var Ii;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Ii||(Ii={}));let WX=class extends Kr{constructor(){super(...arguments),this.renderOccluded=Ii.Occlude}},G1e=class{constructor(){this.factor=new wre,this.factorAlignment=new wre}},wre=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function CAt(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let h=0;h<s;h++)n[i]=c,i+=o}}function xre(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length;i*=n;for(let a=0;a<o;++a){const l=2*t[a];s[i]=e[l],s[i+1]=e[l+1],i+=n}}function j1e(t,e,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],i+=o}}function hS(t,e,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*t[l];n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let h=0;h<s;++h)n[i]=e[c],n[i+1]=e[c+1],n[i+2]=e[c+2],n[i+3]=e[c+3],i+=o}}function Tre(t,e,r){const i=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<r;++n)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=s}function XX(t,e,r,i,s,n=1){if(!r)return void j1e(t,e,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],h=r[1],p=r[2],f=r[4],m=r[5],y=r[6],_=r[8],v=r[9],w=r[10],T=r[12],x=r[13],S=r[14];s*=a;let O=0,A=0,P=0;const I=T5(r)?V=>{O=e[V]+T,A=e[V+1]+x,P=e[V+2]+S}:V=>{const k=e[V],B=e[V+1],z=e[V+2];O=c*k+f*B+_*z+T,A=h*k+m*B+v*z+x,P=p*k+y*B+w*z+S};if(n===1)for(let V=0;V<l;++V)I(3*t[V]),o[s]=O,o[s+1]=A,o[s+2]=P,s+=a;else for(let V=0;V<l;++V){I(3*t[V]);for(let k=0;k<n;++k)o[s]=O,o[s+1]=A,o[s+2]=P,s+=a}}function ZX(t,e,r,i,s,n=1){if(!r)return void j1e(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],v=o[8],w=o[9],T=o[10],x=!oW(o),S=1e-6,O=1-S;s*=l;let A=0,P=0,I=0;const V=T5(o)?k=>{A=e[k],P=e[k+1],I=e[k+2]}:k=>{const B=e[k],z=e[k+1],Z=e[k+2];A=h*B+m*z+v*Z,P=p*B+y*z+w*Z,I=f*B+_*z+T*Z};if(n===1)if(x)for(let k=0;k<c;++k){V(3*t[k]);const B=A*A+P*P+I*I;if(B<O&&B>S){const z=1/Math.sqrt(B);a[s]=A*z,a[s+1]=P*z,a[s+2]=I*z}else a[s]=A,a[s+1]=P,a[s+2]=I;s+=l}else for(let k=0;k<c;++k)V(3*t[k]),a[s]=A,a[s+1]=P,a[s+2]=I,s+=l;else for(let k=0;k<c;++k){if(V(3*t[k]),x){const B=A*A+P*P+I*I;if(B<O&&B>S){const z=1/Math.sqrt(B);A*=z,P*=z,I*=z}}for(let B=0;B<n;++B)a[s]=A,a[s+1]=P,a[s+2]=I,s+=l}}function _We(t,e,r,i,s,n=1){if(!r)return void hS(t,e,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],v=o[8],w=o[9],T=o[10],x=!oW(o),S=1e-6,O=1-S;if(s*=l,n===1)for(let A=0;A<c;++A){const P=4*t[A],I=e[P],V=e[P+1],k=e[P+2],B=e[P+3];let z=h*I+m*V+v*k,Z=p*I+y*V+w*k,W=f*I+_*V+T*k;if(x){const H=z*z+Z*Z+W*W;if(H<O&&H>S){const Y=1/Math.sqrt(H);z*=Y,Z*=Y,W*=Y}}a[s]=z,a[s+1]=Z,a[s+2]=W,a[s+3]=B,s+=l}else for(let A=0;A<c;++A){const P=4*t[A],I=e[P],V=e[P+1],k=e[P+2],B=e[P+3];let z=h*I+m*V+v*k,Z=p*I+y*V+w*k,W=f*I+_*V+T*k;if(x){const H=z*z+Z*Z+W*W;if(H<O&&H>S){const Y=1/Math.sqrt(H);z*=Y,Z*=Y,W*=Y}}for(let H=0;H<n;++H)a[s]=z,a[s+1]=Z,a[s+2]=W,a[s+3]=B,s+=l}}function H1e(t,e,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(s*=a,r!==e.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const h=3*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*t[c];for(let p=0;p<n;++p)o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const h=4*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=e[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*t[c];o[s]=e[h],o[s+1]=e[h+1],o[s+2]=e[h+2],o[s+3]=255,s+=a}}else{o[s]=e[0],o[s+1]=e[1],o[s+2]=e[2],o[s+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),h=a/4,p=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=p,s+=h}}function vWe(t,e,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=t.length,a=e[0];i*=n;for(let l=0;l<o;++l)s[i]=a,i+=n}function q1e(t,e,r,i,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3],i+=o}function W1e(t,e,r,i,s,n){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)X1e(o,a,l,r,i,s,n);else if(o===E.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(E.POSITION);if(tt(!!c,`No buffer view for ${o}`),c){const h=c.length,p=s.getField(o,aa);q1e(t.objectAndLayerIdColor,p,h,n)}}}}function X1e(t,e,r,i,s,n,o){switch(t){case E.POSITION:{tt(e.size===3);const a=n.getField(t,on);tt(!!a,`No buffer view for ${t}`),a&&XX(r,e.data,i,a,o);break}case E.NORMAL:{tt(e.size===3);const a=n.getField(t,on);tt(!!a,`No buffer view for ${t}`),a&&ZX(r,e.data,s,a,o);break}case E.NORMALCOMPRESSED:{tt(e.size===2);const a=n.getField(t,ER);tt(!!a,`No buffer view for ${t}`),a&&xre(r,e.data,a,o);break}case E.UV0:{tt(e.size===2);const a=n.getField(t,F_);tt(!!a,`No buffer view for ${t}`),a&&xre(r,e.data,a,o);break}case E.COLOR:case E.SYMBOLCOLOR:{const a=n.getField(t,aa);tt(!!a,`No buffer view for ${t}`),tt(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||H1e(r,e.data,e.size,a,o);break}case E.COLORFEATUREATTRIBUTE:{const a=n.getField(t,W5);tt(!!a,`No buffer view for ${t}`),tt(e.size===1),a&&e.size===1&&vWe(r,e.data,a,o);break}case E.TANGENT:{tt(e.size===4);const a=n.getField(t,ip);tt(!!a,`No buffer view for ${t}`),a&&_We(r,e.data,s,a,o);break}case E.PROFILERIGHT:case E.PROFILEUP:case E.PROFILEVERTEXANDNORMAL:case E.FEATUREVALUE:{tt(e.size===4);const a=n.getField(t,ip);tt(!!a,`No buffer view for ${t}`),a&&hS(r,e.data,a,o)}}}function MO(t,e,r=0){const i=ye(t,0,xWe);for(let s=0;s<4;s++)e[r+s]=Math.floor(256*TWe(i*bWe[s]))}function YX(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*wWe[i];return r}const bWe=[1,256,65536,16777216],wWe=[1/256,1/65536,1/16777216,1/4294967296],xWe=YX(new Uint8ClampedArray([255,255,255,255]));function TWe(t){return t-Math.floor(t)}async function Lg(t,e){const{data:r}=await Nr(t,{responseType:"image",...e});return r}function SWe(){if(XU==null){const t=e=>kr(`esri/libs/basisu/${e}`);XU=ae(()=>import("./basis_transcoder-ca7ab0c4.js"),[]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return XU}let XU;var z1;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(z1||(z1={}));let Wd=null,CM=null;async function Z1e(){return CM==null&&(CM=SWe(),Wd=await CM),CM}function EWe(t,e){if(Wd==null)return t.byteLength;const r=new Wd.BasisFile(new Uint8Array(t)),i=J1e(r)?Y1e(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function CWe(t,e){if(Wd==null)return t.byteLength;const r=new Wd.KTX2File(new Uint8Array(t)),i=Q1e(r)?Y1e(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function Y1e(t,e,r,i,s){const n=GW(e?hs.COMPRESSED_RGBA8_ETC2_EAC:hs.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*n*o)}function J1e(t){return t.getNumImages()>=1&&!t.isUASTC()}function Q1e(t){return t.getFaces()>=1&&t.isETC1S()}async function AWe(t,e,r){Wd==null&&(Wd=await Z1e());const i=new Wd.BasisFile(new Uint8Array(r));if(!J1e(i))return null;i.startTranscoding();const s=K1e(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function OWe(t,e,r){Wd==null&&(Wd=await Z1e());const i=new Wd.KTX2File(new Uint8Array(r));if(!Q1e(i))return null;i.startTranscoding();const s=K1e(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function K1e(t,e,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[h,p]=l?i?[z1.ETC2_RGBA,hs.COMPRESSED_RGBA8_ETC2_EAC]:[z1.ETC1_RGB,hs.COMPRESSED_RGB8_ETC2]:c?i?[z1.BC3_RGBA,hs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[z1.BC1_RGB,hs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[z1.RGBA32,St.RGBA],f=e.hasMipmap?r:Math.min(1,r),m=[];for(let y=0;y<f;y++)m.push(new Uint8Array(o(y,h))),a(y,h,m[y]);return e.internalFormat=p,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,e.width=s,e.height=n,new Ct(t,e,{type:"compressed",levels:m})}const AM=J.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),RWe=542327876,PWe=131072,MWe=4;function JX(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function $We(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const IWe=JX("DXT1"),LWe=JX("DXT3"),DWe=JX("DXT5"),NWe=31,FWe=0,UWe=1,VWe=2,zWe=3,kWe=4,BWe=7,GWe=20,jWe=21;function HWe(t,e,r){const i=qWe(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=i;return e.samplingMode=s.levels.length>1?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Ct(t,e,s)}function qWe(t,e){const r=new Int32Array(t,0,NWe);if(r[FWe]!==RWe)return AM.error("Invalid magic number in DDS header"),null;if(!(r[GWe]&MWe))return AM.error("Unsupported format, must contain a FourCC code"),null;const i=r[jWe];let s,n;switch(i){case IWe:s=8,n=hs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case LWe:s=16,n=hs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case DWe:s=16,n=hs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return AM.error("Unsupported FourCC code:",$We(i)),null}let o=1,a=r[kWe],l=r[zWe];!(3&a)&&!(3&l)||(AM.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;r[VWe]&PWe&&e!==!1&&(o=Math.max(1,r[BWe]));let m=r[UWe]+4;const y=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(t,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}let Tw=class extends CR{constructor(e,r){super(),this._data=e,this.type=os.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Is,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:Lt.REPEAT,t:Lt.REPEAT},this._startPreload(e)}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(a_(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){jf(e.src)||a_(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}dispose(){this._data=void 0}_createDescriptor(e){const r=new _r;return r.wrapMode=this.parameters.wrap??Lt.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.gpuMemoryUsage)||WWe(this._data,this.parameters)}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Ct(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(yC(r)||N0(r))&&this.parameters.encoding===hg.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(yC(r)||N0(r))&&this.parameters.encoding===hg.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(yC(r)||N0(r))&&this.parameters.encoding===hg.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):N0(r)?this._loadFromPixelData(e,r):yC(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<EA.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,r){return this._glTexture=HWe(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>OWe(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>AWe(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){tt(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.parameters.components===1?St.LUMINANCE:this.parameters.components===3?St.RGB:St.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new Ct(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const s=await Lg(r,{signal:i});return Jt(i),this._loadFromImage(e,s)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const s=await ade(r,r.src,!1,i);return Jt(i),this._loadFromImage(e,s)})}_loadFromVideoElement(e,r){return r.readyState>=EA.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((s,n)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),Li(c)},a=()=>{r.readyState>=EA.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,r)))},l=h=>{o(),n(h||new U("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=sa(i,()=>l(Lr()))}))}_loadFromImage(e,r){const i=ebe(r);this.parameters.width=i.width,this.parameters.height=i.height;const s=this._createDescriptor(e);return s.pixelFormat=this.parameters.components===3?St.RGB:St.RGBA,s.width=i.width,s.height=i.height,this._glTexture=new Ct(e,s,r),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}unload(){if(this._glTexture=Fe(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function WWe(t,e){if(t==null)return 0;if(yC(t)||N0(t))return e.encoding===hg.KTX2_ENCODING?CWe(t,!!e.mipmap):e.encoding===hg.BASIS_ENCODING?EWe(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?ebe(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function ebe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var EA;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(EA||(EA={}));const $O=128,QX=.5;function XWe(t,e=$O,r=e*QX,i=0){const s=tbe(t,e,r,i);return new Tw(s,{mipmap:!1,wrap:{s:Lt.CLAMP_TO_EDGE,t:Lt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function tbe(t,e=$O,r=e*QX,i=0){switch(t){case"circle":default:return ZWe(e,r);case"square":return YWe(e,r);case"cross":return QWe(e,r,i);case"x":return KWe(e,r,i);case"kite":return JWe(e,r);case"triangle":return eXe(e,r);case"arrow":return tXe(e,r)}}function ZWe(t,e){const r=t/2-.5;return $R(t,sbe(r,r,e/2))}function YWe(t,e){return rbe(t,e,!1)}function JWe(t,e){return rbe(t,e,!0)}function QWe(t,e,r=0){return ibe(t,e,!1,r)}function KWe(t,e,r=0){return ibe(t,e,!0,r)}function eXe(t,e){return $R(t,nbe(t/2,e,e/2))}function tXe(t,e){const r=e,i=e/2,s=t/2,n=.8*r,o=sbe(s,(t-e)/2-n,Math.sqrt(n*n+i*i)),a=nbe(s,r,i);return $R(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function rbe(t,e,r){return r&&(e/=Math.SQRT2),$R(t,(i,s)=>{let n=i-.5*t+.25,o=.5*t-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function ibe(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const s=.5*e;return $R(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function sbe(t,e,r){return(i,s)=>{const n=i-t,o=s-e;return Math.sqrt(n*n+o*o)-r}}function nbe(t,e,r){const i=Math.sqrt(e*e+r*r);return(s,n)=>{const o=Math.abs(s-t)-r,a=n-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function $R(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s+t*i;let o=e(s,i);o=o/t+.5,MO(o,r,4*n)}return r}let OAt=class extends Kr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function rXe(t,e){obe(t,e,new Vt("slicePlaneOrigin",(r,i)=>ube(e,r,i)),new Vt("slicePlaneBasis1",(r,i)=>{var s;return FN(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Vt("slicePlaneBasis2",(r,i)=>{var s;return FN(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function fs(t,e){obe(t,e,new iu("slicePlaneOrigin",(r,i)=>ube(e,r,i)),new iu("slicePlaneBasis1",(r,i)=>{var s;return FN(e,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new iu("slicePlaneBasis2",(r,i)=>{var s;return FN(e,r,i,(s=i.slicePlane)==null?void 0:s.basis2)}))}function obe(t,e,...r){if(!e.hasSlicePlane){const o=b`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=b`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=b`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?b`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:b`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(n)}function abe(t,e,r){return t.instancedDoublePrecision?se(iXe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function lbe(t,e){return t!=null?he(UN,e.origin,t):e.origin}function cbe(t,e,r){return t.hasSliceTranslatedView?e!=null?Sl(sXe,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function ube(t,e,r){if(r.slicePlane==null)return za;const i=abe(t,e,r),s=lbe(i,r.slicePlane),n=cbe(t,i,r);return n!=null?$e(UN,s,n):s}function FN(t,e,r,i){if(i==null||r.slicePlane==null)return za;const s=abe(t,e,r),n=lbe(s,r.slicePlane),o=cbe(t,s,r);return o!=null?(le(UE,i,n),$e(UN,n,o),$e(UE,UE,o),he(UE,UE,UN)):i}const iXe=C(),UN=C(),UE=C(),sXe=ve();function IR(t,e){const r=e.output===L.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(E.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(E.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(b`
     void forwardObjectAndLayerIdColor() {
      ${r?i?b`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:b`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b``} }`),t.fragment.code.add(b`
      void outputObjectAndLayerIdColor() {
        ${r?b`fragColor = objectAndLayerIdColorVarying;`:b``} }`)}function nXe(t,e){const{vertex:r,fragment:i}=t;r.include(fF),e.hasMultipassGeometry&&r.include(c_e),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(b`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?b`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(hu),e.hasMultipassTerrain&&i.uniforms.add(new Je("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new Tr("nearFar",(s,n)=>n.camera.nearFar)),i.include(wc),i.code.add(b`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?b`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const oXe=Nt(1,1,0,1),hbe=Nt(1,0,1,1);function Xg(t){t.fragment.uniforms.add(new Je("depthTexture",(e,r)=>r.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",oXe).add("unoccludedHighlightFlag","vec4",hbe),t.fragment.code.add(b`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let dbe=class extends ls{constructor(e,r,i){super(e,"vec4",Jr.Pass,(s,n,o)=>s.setUniform4fv(e,r(n,o)),i)}},yl=class extends ls{constructor(e,r,i){super(e,"float",Jr.Pass,(s,n,o)=>s.setUniform1fv(e,r(n,o)),i)}};const dS={unknown:1,inches:Oo(1,"meters","inches"),feet:Oo(1,"meters","feet"),"us-feet":Oo(1,"meters","us-feet"),yards:Oo(1,"meters","yards"),miles:Oo(1,"meters","miles"),"nautical-miles":Oo(1,"meters","nautical-miles"),millimeters:Oo(1,"meters","millimeters"),centimeters:Oo(1,"meters","centimeters"),decimeters:Oo(1,"meters","decimeters"),meters:Oo(1,"meters","meters"),kilometers:Oo(1,"meters","kilometers"),"decimal-degrees":1/ZPe(1,"meters",ir.radius)};var Ko,Sre;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Ko||(Ko={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(Sre||(Sre={}));let KX=class{constructor(e){this.field=e}},aXe=class extends KX{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Ko.Undefined,Ko.Undefined,Ko.Undefined]}},lXe=class extends KX{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},cXe=class extends KX{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},uXe=class{};function VE(t){return t!=null}function Ww(t){return typeof t=="number"}function mF(t){return typeof t=="string"}function hXe(t){return t==null||mF(t)}function en(t,e){t&&t.push(e)}function dXe(t,e,r,i=ve()){const s=t||0,n=e||0,o=r||0;return s!==0&&q2(i,i,-s/180*Math.PI),n!==0&&H2(i,i,n/180*Math.PI),o!==0&&w5(i,i,o/180*Math.PI),i}function yy(t,e,r,i,s){const n=t.minSize,o=t.maxSize;if(t.expression)return en(s,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Ko.DefinedSize,!0}if(VE(t.field))return VE(t.stops)?t.stops.length===2&&Ww(t.stops[0].size)&&Ww(t.stops[1].size)?(Ere(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=Ko.DefinedSize,!0):(en(s,"Could not convert size info: stops only supported with 2 elements"),!1):Ww(n)&&Ww(o)&&VE(t.minDataValue)&&VE(t.maxDataValue)?(Ere(n,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=Ko.DefinedSize,!0):t.valueUnit==="unknown"?(en(s,"Could not convert size info: proportional size not supported"),!1):dS[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/dS[t.valueUnit],e.type[r]=Ko.DefinedSize,!0):(en(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!VE(t.field)){if(t.stops&&t.stops[0]&&Ww(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Ko.DefinedSize,!0;if(Ww(n))return e.minSize[r]=n,e.maxSize[r]=n,e.offset[r]=n,e.factor[r]=0,e.type[r]=Ko.DefinedSize,!0}return en(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Ere(t,e,r,i,s,n){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-r*o,s.factor[n]=o}function pXe(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return en(i,"Could not convert size info: unsupported property"),null;if(!hXe(t.field))return en(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return en(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new aXe(t.field);let s;switch(t.axis){case"width":return s=yy(t,e.size,0,r,i),s?e:null;case"height":return s=yy(t,e.size,2,r,i),s?e:null;case"depth":return s=yy(t,e.size,1,r,i),s?e:null;case"width-and-depth":return s=yy(t,e.size,0,r,i),s&&yy(t,e.size,1,r,i),s?e:null;case null:case void 0:case"all":return s=yy(t,e.size,0,r,i),s=s&&yy(t,e.size,1,r,i),s=s&&yy(t,e.size,2,r,i),s?e:null;default:return en(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function fXe(t,e,r){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===Ko.DefinedSize&&(n*=e.modelSize[s],t.type[s]=Ko.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let i;if(t.type[0]!==Ko.Undefined)i=0;else if(t.type[1]!==Ko.Undefined)i=1;else{if(t.type[2]===Ko.Undefined)return en(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)t.type[s]===Ko.Undefined&&(t.minSize[s]=t.minSize[i],t.maxSize[s]=t.maxSize[i],t.offset[s]=t.offset[i],t.factor[s]=t.factor[i],t.type[s]=t.type[i]);return!0}function Cre(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function mXe(t,e,r){if(t.normalizationField)return en(r,"Could not convert color info: unsupported property"),null;if(mF(t.field)){if(!t.stops)return en(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return en(r,"Could not convert color info: too many color stops"),null;e.color=new lXe(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.color.values[s]=n.value,Cre(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return en(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,Cre(e.color.colors,s,i)}}return e}function gXe(t,e,r){if(t.normalizationField)return en(r,"Could not convert opacity info: unsupported property"),null;if(mF(t.field)){if(!t.stops)return en(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return en(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new cXe(t.field);const i=t.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return en(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=i}}return e}function ZU(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function yXe(t,e,r){if(!mF(t.field))return en(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return en(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return ZU(t,e.rotation,0),e;case"roll":return ZU(t,e.rotation,1),e;case null:case void 0:case"heading":return ZU(t,e.rotation,2),e;default:return en(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let LR=class{constructor(e,r=[1,1,1],i=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function pbe(t,e,r){if(!t)return null;const i=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return en(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?pXe(n,s,e,r):s;case"color":return e.supports.color?mXe(n,s,r):s;case"opacity":return e.supports.opacity?gXe(n,s,r):null;case"rotation":return e.supports.rotation?yXe(n,s,r):s;default:return null}},new uXe);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!fXe(i.size,e,r)?null:i:null}let _Xe=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function pS(t,e){if(!t||ni.TESTS_DISABLE_FAST_UPDATES)return null;const r=pbe(t.visualVariables,e);return r?new _Xe(r,mbe(r,e),!!r.size):null}function fS(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,s=pbe(e.visualVariables,r);return!!s&&!!(OM(i.size,s.size,"size")&&OM(i.color,s.color,"color")&&OM(i.rotation,s.rotation,"rotation")&&OM(i.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=mbe(s,r),t.requiresShaderTransformation=!!s.size,!0)}function OM(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,s=e;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}let fbe=class extends Kr{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function mbe(t,e){const r=new fbe(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,wh(CA),dXe(e.rotation[2],e.rotation[0],e.rotation[1],CA),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||Ni(),Th(r.vvSymbolRotationMatrix,CA)),r}function C7(t,e,r){if(!t.vvSize)return r;$s(_y,r);const i=t.vvSymbolRotationMatrix;Xf(CA,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),si(_y,_y,CA);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];Are[s]=ye(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return b5(_y,_y,Are),Sl(_y,_y,t.vvSymbolAnchor),_y}function vXe(t,e,r){if(e.vvSize)for(let i=0;i<3;++i){const s=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=ye(s,e.vvSize.minSize[i],e.vvSize.maxSize[i])}else se(t,1,1,1)}function Xd(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const _y=ve(),Are=C(),CA=ve();let DR=class extends fbe{constructor(){super(...arguments),this.renderOccluded=Ii.Occlude}};const g2=8;function pg(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(E.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new Vt("vvSizeMinSize",s=>s.vvSize.minSize)),r.uniforms.add(new Vt("vvSizeMaxSize",s=>s.vvSize.maxSize)),r.uniforms.add(new Vt("vvSizeOffset",s=>s.vvSize.offset)),r.uniforms.add(new Vt("vvSizeFactor",s=>s.vvSize.factor)),r.uniforms.add(new Mh("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),r.uniforms.add(new Vt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),r.code.add(b`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(b`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?b`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(b`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",g2),r.uniforms.add(new yl("vvColorValues",s=>s.vvColor.values,g2),new dbe("vvColorColors",s=>s.vvColor.colors,g2)),r.code.add(b`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?b`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(b`vec4 vvColor() { return vec4(1.0); }`)}const VN=.1,co=.001;function bXe(t){const e=new br,r=t.signedDistanceFieldEnabled;if(e.include(L1e,t),e.include(fs,t),t.occlusionPass)return e.include(nXe,t),e;const{vertex:i,fragment:s}=e;e.include(BX),s.include(wc),s.include(Jf),e.include(pg,t),e.include(IR,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add(new rr("viewport",(c,h)=>h.camera.fullViewport),new Tr("screenOffset",(c,h)=>sr(gbe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Tr("anchorPosition",c=>zN(c)),new rr("materialColor",c=>c.color)),tE(i,t),r&&(i.uniforms.add(new rr("outlineColor",c=>c.outlineColor)),s.uniforms.add(new rr("outlineColor",c=>Ore(c)?c.outlineColor:wf),new Oe("outlineSize",c=>Ore(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(lWe(i),pF(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.COLOR,"vec4"),e.attributes.add(E.SIZE,"vec2"),e.attributes.add(E.AUXPOS2,"vec4"),i.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?b`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=b`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&i.include(fF);const o=t.pixelSnappingEnabled?r?b`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b`posProj += quadOffset;`;i.code.add(b`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===L.ObjectAndLayerIdColor?b`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.float(co)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.float(co)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?b`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Je("tex",c=>c.texture));const a=t.debugDrawLabelBorder?b`(isBorder > 0.0 ? 0.0 : ${b.float(VN)})`:b.float(VN),l=b`
    ${t.debugDrawLabelBorder?b`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?b`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${b.float($O)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.float(co)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?b`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===L.Alpha&&s.code.add(b`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===L.ObjectAndLayerIdColor&&s.code.add(b`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===L.Color&&s.code.add(b`
    void main() {
      ${l}
      ${t.transparencyPassType===st.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===L.Highlight&&(e.include(Xg,t),s.code.add(b`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?b`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function Ore(t){return t.outlineColor[3]>0&&t.outlineSize>0}function zN(t,e=gbe){return t.textureIsSignedDistanceField?wXe(t.anchorPosition,t.distanceFieldBoundingBox,e):ln(e,t.anchorPosition),e}function wXe(t,e,r){e!=null?sr(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):sr(r,0,0)}const gbe=Ue(),xXe=Object.freeze(Object.defineProperty({__proto__:null,build:bXe,calculateAnchorPosForRendering:zN},Symbol.toStringTag,{value:"Module"})),su=_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),TXe=vc(be.ONE,be.ONE),ybe=vc(be.ZERO,be.ONE_MINUS_SRC_ALPHA);function Zg(t){return t===st.FrontFace?null:t===st.Alpha?ybe:TXe}function gF(t){return t===st.FrontFace?El:null}const yF=5e5,_F={factor:-1,units:-2};function vF(t){return t?_F:null}function V_(t,e=Qr.LESS){return t===st.NONE||t===st.FrontFace?e:Qr.LEQUAL}let _be=class vbe extends Rr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ie.Global}initializeProgram(e){return new Er(e.rctx,vbe.shader.get().build(this.configuration),vr)}_setPipelineState(e){const r=this.configuration,i=e===st.NONE,s=e===st.FrontFace,n=this.configuration.hasPolygonOffset?SXe:null,o=(i||s)&&r.output!==L.Highlight&&(r.depthEnabled||r.occlusionPass)?El:null;return Ot({blending:r.output===L.Color||r.output===L.Alpha||r.output===L.Highlight?i?EXe:Zg(e):null,depthTest:{func:Qr.LEQUAL},depthWrite:o,colorWrite:Gt,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Et.POINTS:Et.TRIANGLES}};_be.shader=new Sr(xXe,()=>ae(()=>import("./HUDMaterial.glsl-4936fc2c.js"),[]));const SXe={factor:0,units:-4},EXe=vc(be.ONE,be.ONE_MINUS_SRC_ALPHA);let bs=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.screenCenterOffsetUnitsEnabled=gl.World,this.transparencyPassType=st.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};u([F({count:L.COUNT})],bs.prototype,"output",void 0),u([F({count:gl.COUNT})],bs.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([F({count:st.COUNT})],bs.prototype,"transparencyPassType",void 0),u([F()],bs.prototype,"spherical",void 0),u([F()],bs.prototype,"occlusionTestEnabled",void 0),u([F()],bs.prototype,"signedDistanceFieldEnabled",void 0),u([F()],bs.prototype,"vvSize",void 0),u([F()],bs.prototype,"vvColor",void 0),u([F()],bs.prototype,"hasVerticalOffset",void 0),u([F()],bs.prototype,"hasScreenSizePerspective",void 0),u([F()],bs.prototype,"debugDrawLabelBorder",void 0),u([F()],bs.prototype,"binaryHighlightOcclusionEnabled",void 0),u([F()],bs.prototype,"hasSlicePlane",void 0),u([F()],bs.prototype,"hasPolygonOffset",void 0),u([F()],bs.prototype,"depthEnabled",void 0),u([F()],bs.prototype,"pixelSnappingEnabled",void 0),u([F()],bs.prototype,"draped",void 0),u([F()],bs.prototype,"hasMultipassGeometry",void 0),u([F()],bs.prototype,"hasMultipassTerrain",void 0),u([F()],bs.prototype,"cullAboveGround",void 0),u([F()],bs.prototype,"occlusionPass",void 0),u([F()],bs.prototype,"objectAndLayerIdColorInstanced",void 0),u([F({constValue:!0})],bs.prototype,"hasSliceInVertexProgram",void 0),u([F({constValue:!1})],bs.prototype,"hasVvInstancing",void 0);let mS=class extends U_{constructor(e){super(e,new DXe),this._configuration=new bs}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?gl.Screen:gl.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===ce.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===L.Color||e===L.Alpha),e===L.Color&&(this._configuration.debugDrawLabelBorder=!!ni.LABELS_SHOW_BORDER),e===L.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Th(JU,r),e.shaderTransformer!=null){const T=e.shaderTransformer(Mre);l=T[0],c=T[5],OXe(JU)}const h=e.vertexAttributes.get(E.POSITION),p=e.vertexAttributes.get(E.SIZE),f=e.vertexAttributes.get(E.NORMAL),m=e.vertexAttributes.get(E.AUXPOS1);tt(h.size>=3);const y=i.point,_=i.camera,v=zN(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<h.data.length/h.size;T++){const x=T*h.size;se(jo,h.data[x],h.data[x+1],h.data[x+2]),$e(jo,jo,r);const S=T*p.size;vy[0]=p.data[S]*l,vy[1]=p.data[S+1]*c,$e(jo,jo,_.viewMatrix);const O=T*m.size;if(se(Ec,m.data[O],m.data[O+1],m.data[O+2]),!w&&(jo[0]+=Ec[0],jo[1]+=Ec[1],Ec[2]!==0)){const P=Ec[2];ge(Ec,jo),he(jo,jo,ie(Ec,Ec,P))}const A=T*f.size;if(se(zE,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(zE,JU,_,QU),this._applyVerticalOffsetTransformationView(jo,QU,_,YU),_.applyProjection(jo,fa),fa[0]>-1){fa[0]=Math.floor(fa[0]),fa[1]=Math.floor(fa[1]),w&&(Ec[0]||Ec[1])&&(fa[0]+=Ec[0],Ec[1]!==0&&(fa[1]+=kX(Ec[1],YU.factorAlignment)),_.unapplyProjection(fa,jo)),fa[0]+=this.parameters.screenOffset[0],fa[1]+=this.parameters.screenOffset[1],E1e(vy,YU.factor,vy);const P=$Xe*_.pixelRatio;let I=0;if(a.textureIsSignedDistanceField&&(I=a.outlineSize*_.pixelRatio/2),y&&Rre(y,fa[0],fa[1],vy,P,I,a,v)){const V=i.ray;if($e(Pre,jo,bn(MXe,_.viewMatrix)),fa[0]=y[0],fa[1]=y[1],_.unprojectFromRenderScreen(fa,jo)){const k=C();re(k,V.direction);const B=1/Ee(k);ie(k,k,B),o(fi(V.origin,jo)*B,k,-1,!0,1,Pre)}}}}}intersectDraped(e,r,i,s,n,o){const a=e.vertexAttributes.get(E.POSITION),l=e.vertexAttributes.get(E.SIZE),c=this.parameters,h=zN(c);let p=1,f=1;if(e.shaderTransformer!=null){const y=e.shaderTransformer(Mre);p=y[0],f=y[5]}p*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=IXe*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],w=a.data[_+1],T=y*l.size;vy[0]=l.data[T]*p,vy[1]=l.data[T+1]*f;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),Rre(s,v,w,vy,m,x,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new FXe(this)}_normalAndViewAngle(e,r,i,s){return aWe(r)&&(r=Th(PXe,r)),ac(s.normal,e,r),$e(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=me(bbe,LXe),s}_updateScaleInfo(e,r,i){const s=this.parameters;s.screenSizePerspective!=null?mre(i,r,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),s.screenSizePerspectiveAlignment!=null?mre(i,r,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,QU);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,r,i,s,n){return this._applyCenterOffsetNDC(e,r,i,s),n!=null&&re(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(e,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return re(n,e);const c=ye(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ie(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,r,i,s){const n=Ee(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=ie(jo,r.normal,o*a);return le(s,e,l),s}_applyVerticalOffsetTransformationView(e,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Ee(e);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Ee(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=V1e(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),ie(r.normal,r.normal,l),le(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==e&&re(i,e),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(ge(zE,i),le(i,i,ie(zE,zE,r[2])))),i}_applyCenterOffsetNDC(e,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&re(s,e),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(e,r,i,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&re(s,e),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(e,r){if(r===L.Color||r===L.Alpha||r===L.Highlight||r===L.ObjectAndLayerIdColor){if(e===ce.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return e===(i?ce.LABEL_MATERIAL:ce.HUD_MATERIAL)||s&&e===ce.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new CXe(e)}calculateRelativeScreenBounds(e,r,i=zt()){return AXe(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},CXe=class extends HW{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(_be,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function AXe(t,e,r,i=RXe){return ln(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function OXe(t){const e=t[0],r=t[1],i=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=1/Math.sqrt(e*e+r*r+i*i),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*h,t[1]=r*h,t[2]=i*h,t[3]=s*p,t[4]=n*p,t[5]=o*p,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function Rre(t,e,r,i,s,n,o,a){let l=e-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,h=r-s-(a[1]>0?i[1]*a[1]:0),p=h+i[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=i[0]*f[0],h+=i[1]*f[1],c-=i[0]*(1-f[2]),p-=i[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),t[0]>l&&t[0]<c&&t[1]>h&&t[1]<p}const YU=new G1e,RXe=Ue(),jo=C(),zE=C(),fa=Zt(),bbe=C(),Pre=C(),JU=Ni(),PXe=Ni(),MXe=ve(),Ec=C(),QU={normal:bbe,cosAngle:0},Mre=ve(),$Xe=1,IXe=2,vy=[0,0],LXe=Ae(0,0,1);let DXe=class extends q0e{constructor(){super(...arguments),this.renderOccluded=Ii.Occlude,this.color=Nt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=cr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Nt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const wbe=ji().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4u8(E.COLOR).vec2f(E.SIZE).vec4f(E.AUXPOS1).vec4f(E.AUXPOS2),NXe=wbe.clone().vec4u8(E.OBJECTANDLAYERIDCOLOR);let FXe=class{constructor(e){this._material=e,this.vertexBufferLayout=oe("enable-feature:objectAndLayerId-rendering")?NXe:wbe}elementCount(e){return 6*e.indices.get(E.POSITION).length}write(e,r,i,s,n){XX(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,e,s.position,n,6),ZX(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(E.UV0).data;let a,l,c,h;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],h=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=i.indices.get(E.POSITION).length,f=n;const m=s.uv0;for(let w=0;w<p;++w)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;H1e(i.indices.get(E.COLOR),i.vertexAttributes.get(E.COLOR).data,4,s.color,n,6);const y=i.indices.get(E.SIZE),_=i.vertexAttributes.get(E.SIZE).data;p=y.length;const v=s.size;f=n;for(let w=0;w<p;++w){const T=_[2*y[w]],x=_[2*y[w]+1];for(let S=0;S<6;++S)v.set(f,0,T),v.set(f,1,x),f+=1}if(i.indices.get(E.AUXPOS1)&&i.vertexAttributes.get(E.AUXPOS1)?hS(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,s.auxpos1,n,6):Tre(s.auxpos1,n,6*p),i.indices.get(E.AUXPOS2)&&i.vertexAttributes.get(E.AUXPOS2)?hS(i.indices.get(E.AUXPOS2),i.vertexAttributes.get(E.AUXPOS2).data,s.auxpos2,n,6):Tre(s.auxpos2,n,6*p),i.objectAndLayerIdColor!=null&&i.indices.get(E.POSITION)){const w=i.indices.get(E.POSITION).length,T=s.getField(E.OBJECTANDLAYERIDCOLOR,aa);q1e(i.objectAndLayerIdColor,T,w,n,6)}}};const _p=C(),Xw=Zt(),kE=Zt(),KU=C(),UXe=ve(),VXe=ys(),e8=kn(),zXe=C(),kXe=zt();class BXe{constructor(){this.aabr=zt(),this.distance=0,this.culled=!1,this.visible=!1}}class GXe{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var Wl;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Wl||(Wl={}));class xbe{constructor(){this.camera=new lt,this.slicePlane=Vg(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),yw(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let qT=class extends xe{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new xbe,this._state=Wl.Idle,this._active=new Map,this._visible=new Map,this._iterators=new WXe,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Wl.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Wl.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Wl.Idle:this._startUpdate(),t.madeProgress();case Wl.Process:if(this._state=Wl.Process,!this._processActiveGraphics(t))return;case Wl.Sort:if(this._state=Wl.Sort,!this._sortVisibleGraphics(t))return;case Wl.Deconflict:if(this._state=Wl.Deconflict,!this._deconflictVisibleGraphics(t))return;default:Yqe(this,this._visible),this._state=Wl.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof mS}_startUpdate(){Jqe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new BXe,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),jXe(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=GS(UXe,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?VXe:null;let s=0;for(i!=null&&($e(i,za,this._runningViewState.camera.viewMatrix),i[3]=Dr(this.view.spatialReference).radius,s=Xge(i,za));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===zn.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=!r||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),Kqe(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=$re(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=$re(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=HXe(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(zn.GRAPHIC,Do.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);yc(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=YXe,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,_p)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;$e(_p,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(E.NORMAL).data,h=l.get(E.AUXPOS1).data;o.applyShaderOffsetsView(_p,c,s.transformation,h,i,r.scaleInfo,_p),bi(Xw,_p[0],_p[1],_p[2],1),Qc(kE,Xw,i.projectionMatrix),ie(r.positionNDC,kE,1/kE[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,KU),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(KU[2]),r.distance=KU[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),bi(kE,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),Qc(Xw,kE,e),$b(Xw,Xw,1/Xw[3]),se(r.positionView,_p[0],_p[1],_p[2])}_isCulledByHorizon(t,e,r){return re(e8.direction,t.positionView),se(e8.origin,0,0,0),!!D_(e,e8,zXe)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&TW(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=e.getScreenSize(XXe);E1e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=DD(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,kXe),xt(0,n.fullWidth,.5+.5*i[0]),xt(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Yc(a),Kd(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}t_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,cR(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Bt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,Do.DECONFLICTION,e),this.visibilityGroup===zn.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function jXe(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,Do.DECONFLICTION,!0)}function*$re(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*HXe(t,e,r){e.clear(),t.forEach((s,n)=>{const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(r,Do.DECONFLICTION);const a=s.info&&s.info[r];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}u([d({constructOnly:!0})],qT.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],qT.prototype,"updating",null),qT=u([R("esri.views.3d.layers.graphics.Deconflictor")],qT);class qXe{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class WXe{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Bt({allocator:s=>s||new qXe})}}const XXe=Ue();class ZXe{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new G1e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const YXe=new ZXe,JXe=2e3;let hL=class extends qT{constructor(e){super(e),this.visibilityGroup=zn.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return zo.YIELD;const r=performance.now();if(e.state!==$r.IDLE&&r-this._lastDeconfliction<JXe)return zo.YIELD;super.runTask(e),this.state===Wl.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],hL.prototype,"parent",void 0),hL=u([R("esri.views.3d.layers.graphics.LabelDeconflictor")],hL);let A7=class extends qT{constructor(){super(...arguments),this._handles=new Pi,this._contexts=new Map,this._viewState=new xbe,this.visibilityGroup=zn.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ue(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),ue(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),ue(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Vr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(dt.GRAPHICS_DECONFLICTOR,this),this._labels=new hL({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&t8(e));r.setVisibilityFlag(zn.GRAPHIC,Do.DECONFLICTION,i)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&cye(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){$o(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const s=i.graphic.uid,n=new GXe(i,e.symbolCreationContext.slicePlaneEnabled);r.set(s,n),t8(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,r){const i=r.graphic.uid,s=e.get(i);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=t8(e);i||QXe(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(s=>s.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function t8(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function QXe(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(zn.GRAPHIC,Do.DECONFLICTION,!0))}A7=u([R("esri.views.3d.layers.graphics.GraphicsDeconflictor")],A7);function Tbe(t){return 32+t.length}function Sbe(t){return 16}function Ebe(t){if(!t)return 0;let e=Obe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=Tbe(i);break;case"number":e+=Sbe();break;case"boolean":e+=4}}return e}function Cbe(t){if(!t)return 0;if(Array.isArray(t))return KXe(t);let e=Obe;for(const r in t)t.hasOwnProperty(r)&&(e+=Abe(t[r]));return e}function KXe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=Rbe;for(let i=0;i<e;i++)r+=Abe(t[i]);return r}function Abe(t){switch(typeof t){case"object":return Cbe(t);case"string":return Tbe(t);case"number":return Sbe();case"boolean":return 4;default:return 8}}function XAt(t,e){return Rbe+t.length*e}const Obe=32,Rbe=32,eZ=(t,e,r)=>[e,r],gS=(t,e,r)=>[e,r,t[2]],tZ=(t,e,r)=>[e,r,t[2],t[3]];function ZAt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function eZe({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function tZe({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function Pbe({scale:t,translate:e},r){return r*t[0]+e[0]}function Mbe({scale:t,translate:e},r){return e[1]-r*t[1]}function $be(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=t.scale;let o=Pbe(t,r[0][0]),a=Mbe(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=e(c,o,a)}return i}function Ibe(t,e,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=$be(t,e,r[s]);return i}function rZe(t,e,r,i){return $be(t,r?i?tZ:gS:i?gS:eZ,e)}function iZe(t,e,r,i){return Ibe(t,r?i?tZ:gS:i?gS:eZ,e)}function sZe(t,e,r,i){return Ibe(t,r?i?tZ:gS:i?gS:eZ,e)}function YAt(t,e,r,i,s){return e.x=eZe(t,r.x),e.y=tZe(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m)),e}function Lbe(t,e,r,i,s){return r!=null&&(e.points=rZe(t,r.points,i,s)),e}function Dbe(t,e,r,i,s){return r==null||(e.x=Pbe(t,r.x),e.y=Mbe(t,r.y),e!==r&&(i&&(e.z=r.z),s&&(e.m=r.m))),e}function Nbe(t,e,r,i,s){return r!=null&&(e.rings=sZe(t,r.rings,i,s)),e}function Fbe(t,e,r,i,s){return r!=null&&(e.paths=iZe(t,r.paths,i,s)),e}var O7;let p3=O7=class extends de{constructor(t){super(t),this.name=null,this.code=null}clone(){return new O7({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],p3.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],p3.prototype,"code",void 0),p3=O7=u([R("esri.layers.support.CodedValue")],p3);const nZe=new Or({inherited:"inherited",codedValue:"coded-value",range:"range"});let f3=class extends de{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],f3.prototype,"name",void 0),u([et(nZe)],f3.prototype,"type",void 0),f3=u([R("esri.layers.support.Domain")],f3);const bF=f3;var R7;let m3=R7=class extends bF{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new R7({codedValues:Q(this.codedValues),name:this.name})}};u([d({type:[p3],json:{write:!0}})],m3.prototype,"codedValues",void 0),u([et({codedValue:"coded-value"})],m3.prototype,"type",void 0),m3=R7=u([R("esri.layers.support.CodedValueDomain")],m3);const Ube=m3;var P7;let dL=P7=class extends bF{constructor(t){super(t),this.type="inherited"}clone(){return new P7}};u([et({inherited:"inherited"})],dL.prototype,"type",void 0),dL=P7=u([R("esri.layers.support.InheritedDomain")],dL);const Vbe=dL;var M7;let rT=M7=class extends bF{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new M7({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],rT.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],rT.prototype,"minValue",void 0),u([et({range:"range"})],rT.prototype,"type",void 0),rT=M7=u([R("esri.layers.support.RangeDomain")],rT);const zbe=rT,kbe={key:"type",base:bF,typeMap:{range:zbe,"coded-value":Ube,inherited:Vbe}};function rZ(t){if(!t||!t.type)return null;switch(t.type){case"range":return zbe.fromJSON(t);case"codedValue":return Ube.fromJSON(t);case"inherited":return Vbe.fromJSON(t)}return null}const oZe=new Or({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var $7;const aZe=new Or({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let xa=$7=class extends de{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?aZe.fromJSON(r.fieldValueType):null}clone(){return new $7({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],xa.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],xa.prototype,"defaultValue",void 0),u([d()],xa.prototype,"description",void 0),u([Se("description")],xa.prototype,"readDescription",null),u([d({types:kbe,json:{read:{reader:rZ},write:!0}})],xa.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],xa.prototype,"editable",void 0),u([d({type:Yi,json:{write:!0}})],xa.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],xa.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],xa.prototype,"nullable",void 0),u([et(oZe)],xa.prototype,"type",void 0),u([d()],xa.prototype,"valueType",void 0),u([Se("valueType",["description"])],xa.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],xa.prototype,"visible",void 0),xa=$7=u([R("esri.layers.support.Field")],xa);const wF=xa;let QAt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function eOt(t){return t.geometry!=null}let tOt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function iOt(t){var n;const e=mpe.fromJSON(t.geometryType),r=Ge.fromJSON(t.spatialReference),i=t.transform,s=t.features.map(o=>{const a=lZe(o,e,r,t.objectIdFieldName),l=a.geometry;if(l!=null&&i)switch(l.type){case"point":a.geometry=Dbe(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=Lbe(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=Nbe(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=Fbe(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:s,spatialReference:r,fields:((n=t.fields)==null?void 0:n.map(o=>wF.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function lZe(t,e,r,i){return{uid:hc(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:cZe(t.geometry,e,r),visible:!0}}function cZe(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function Sw(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function uZe(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)r+=n.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(s.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=F0(t.vertexAttributes.position),e+=F0(t.vertexAttributes.normal),e+=F0(t.vertexAttributes.uv),e+=F0(t.vertexAttributes.tangent)}return e}function sOt(t){let e=32;return e+=Ebe(t.attributes),e+=3,e+=8+uZe(t.geometry),e}function hZe(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function nOt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function oOt(t,e){switch(xi(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)D6(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)D6(e,t.rings[r],!!t.hasZ);break;case"multipoint":D6(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function dZe(t,e){switch(yc(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)T6(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)T6(e,t.rings[r]);break;case"multipoint":T6(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function aOt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function Bbe(t){return"declaredClass"in t}function Ire(t){return"declaredClass"in t}function pZe(t){return"declaredClass"in t}function fZe(t,e){return t?pZe(t)?t:new vh({layer:e,sourceLayer:e,visible:t.visible,symbol:Q(t.symbol),attributes:Q(t.attributes),geometry:Gbe(t.geometry)}):null}function Gbe(t){return t==null?null:Bbe(t)?t:c_(mZe(t))}function mZe(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,s={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:n,y:o,z:a,m:l}=t;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=t;return{rings:Lre(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=t;return{paths:Lre(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y}=t;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=t;return{points:Hbe(n)?jbe(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function Lre(t){return gZe(t)?t.map(e=>jbe(e)):t}function jbe(t){return t.map(e=>Array.from(e))}function gZe(t){for(const e of t)if(e.length!==0)return Hbe(e);return!1}function Hbe(t){return t.length>0&&(AS(t[0])||OS(t[0]))}function yZe(t,e){if(!t)return null;let r;if(Ire(t)){if(e==null)return t.clone();if(Ire(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=Sw(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function lOt(t){const{wkid:e,wkt:r,latestWkid:i}=t,s={wkid:e,wkt:r,latestWkid:i};return Ge.fromJSON(s)}const iZ="__begin__",sZ="__end__",_Ze=new RegExp(iZ,"ig"),vZe=new RegExp(sZ,"ig"),Dre=new RegExp("^"+iZ,"i"),Nre=new RegExp(sZ+"$","i"),kN='"',bZe=kN+" + ",wZe=" + "+kN;function xZe(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function TZe(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function xF(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=xZe(t.labelExpression),e.type="conventional"),e}function SZe(t){const e=xF(t);if(!e)return null;switch(e.type){case"conventional":return I7(e.expression);case"arcade":return e.expression}return null}function EZe(t){const e=xF(t);if(!e)return null;switch(e.type){case"conventional":return AZe(e.expression);case"arcade":return nZ(e.expression)}return null}function I7(t){let e;return t?(e=U4(t,r=>iZ+'$feature["'+r+'"]'+sZ),e=Dre.test(e)?e.replace(Dre,""):kN+e,e=Nre.test(e)?e.replace(Nre,""):e+kN,e=e.replaceAll(_Ze,bZe).replaceAll(vZe,wZe)):e='""',e}const CZe=/^\s*\{([^}]+)\}\s*$/i;function AZe(t){const e=t==null?void 0:t.match(CZe);return e&&e[1].trim()||null}const OZe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,RZe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,PZe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function nZ(t){if(!t)return null;let e=OZe.exec(t)||RZe.exec(t);return e?e[1]||e[3]:(e=PZe.exec(t),e?e[2]:null)}const r8=J.getLogger("esri.layers.support.labelFormatUtils"),i8={type:"simple",evaluate:()=>null},MZe={getAttribute:(t,e)=>t.field(e)};async function qbe(t,e,r){if(!t||!t.symbol||!e)return i8;const i=t.where,s=xF(t),n=i?await ae(()=>import("./WhereClause-914ffa63.js").then(a=>a.W),["assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js"]):null;let o;if(s.type==="arcade"){const a=await uLe(s.expression,r,e);if(a==null)return i8;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){r8.error(new U("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>nZ(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=e.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":Wbe(p,h)})};if(i){let a;try{a=n.WhereClause.create(i,e)}catch(c){return r8.error(new U("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),i8}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:MZe;try{if(a.testFeature(c,h))return l(c)}catch(p){r8.error(new U("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:p}))}return null}}return o}function Wbe(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=t;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+t,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=p_(i,CC("short-date")):$q(e)&&(i=k2(+i)),i||""}const cOt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:qbe,formatField:Wbe},Symbol.toStringTag,{value:"Module"}));let Xbe=class{constructor(e=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}};function oZ(t,e){if(t.type==="point")return by(t,e,!1);if(Bbe(t))switch(t.type){case"extent":return by(t.center,e,!1);case"polygon":return by(t.centroid,e,!1);case"polyline":return by(Fre(t),e,!0);case"mesh":return by(t.origin,e,!1)}else switch(t.type){case"extent":return by($Ze(t),e,!0);case"polygon":return by(IZe(t),e,!0);case"polyline":return by(Fre(t),e,!0)}}function Fre(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=Xde(e,Wde(e)/2);return Sw(r[0],r[1],r[2],t.spatialReference)}function $Ze(t){return Sw(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function IZe(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=Jde(t.rings,!!t.hasZ);return Sw(r[0],r[1],r[2],t.spatialReference)}function by(t,e,r){const i=r?t:yZe(t);return e&&t?tge(t,i,e)?i:null:i}function hOt(t,e,r,i=0){if(t){e||(e=zt());const s=t;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),bi(e,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),e}return null}function Zbe(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(E.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function AA(t,e,r=null){const i=vR(sh);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function dOt(t,e,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?n[o]=t[o]:r!=null&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return n[3]=e??i??s[3],n}function Ure(t=sg,e,r,i=1){const s=new Array(3);if(e==null||r==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=r[a];l==="symbol-value"||p?c=f!==0?e[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return Ia(s)}function LZe(t){return t.isPrimitive!=null}function TF(t){return L7(LZe(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function L7(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function DZe(t,e,r,i=ve()){return t&&q2(i,i,-t/180*Math.PI),e&&H2(i,i,e/180*Math.PI),r&&w5(i,i,r/180*Math.PI),i}function aZ(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=qa(e),s=cw(t)*i,n=uw(t)*i,o=I_(t)*(e.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function Ybe(t,e,r,i,s,n,o,a,l,c,h){const p=GZe[h.mode];let f,m,y=0;if(oi(t,e,r,i,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,h),f=n,m=o):(f=i,m=s),oi(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function C_(t,e,r,i,s){const n=(PN(t)?t.z:Yve(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=ff(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=ff(e,t,"ground")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=ff(e,t,"scene")??0,a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=ff(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function NZe(t,e,r,i){return C_(t,e,r,i,WT),WT.z}function NR(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?as.UPDATE:t.onTheGroundChanged}function Ah(t){return t==="relative-to-ground"||t==="relative-to-scene"}function A_(t){return t!=="absolute-height"}function FZe(t,e,r,i,s){C_(e,r,s,i,WT),Zbe(t,WT.verticalDistanceToGround);const n=WT.sampledElevation,o=$s(jZe,t.transformation);return RM[0]=e.x,RM[1]=e.y,RM[2]=WT.z,bl(e.spatialReference,RM,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function UZe(t,e,r,i,s,n){let o=0;const a=n.spatialReference;e*=3,i*=3;for(let l=0;l<s;++l){const c=t[e],h=t[e+1],p=t[e+2],f=n.getElevation(c,h,p,a,"ground")??0;o+=f,r[i]=c,r[i+1]=h,r[i+2]=f,e+=3,i+=3}return o/s}function VZe(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(m,y,_,p,"ground")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function zZe(t,e,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;e*=3,i*=3;for(let f=0;f<s;++f){const m=t[e],y=t[e+1],_=t[e+2],v=n.getElevation(m,y,_,p,"scene")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=h==null?_+v+c:v+c,e+=3,i+=3}return l/s}function kZe(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function BZe(t,e,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let h=0;h<s;++h){const p=t[e],f=t[e+1],m=t[e+2];r[i]=p,r[i+1]=f,r[i+2]=c==null?m+l:l,e+=3,i+=3}return 0}let FR=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var as;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(as||(as={}));const GZe={"absolute-height":{applyElevationAlignmentBuffer:BZe,requiresAlignment:kZe},"on-the-ground":{applyElevationAlignmentBuffer:UZe,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:VZe,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:zZe,requiresAlignment:()=>!0}},jZe=ve(),WT=new FR,RM=C();function lZ(t){return t.mapPositions!=null}function Jbe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!lZ(l))continue;const{update:c,averageGeometrySampledElevation:h}=Kbe(l,e,r,i,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function gb(t,e,r,i,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,ml),Zbe(o,ml.verticalDistanceToGround),l=ml.sampledElevation):(i(a,ml),e.mode!=="absolute-height"&&(l=ml.sampledElevation));const c=$s(HZe,n??o.transformation),h=se(Qbe,c[12],c[13],c[14]);ni.TESTS_DISABLE_OPTIMIZATIONS?(fl[0]=a.x,fl[1]=a.y,fl[2]=ml.z,bl(a.spatialReference,fl,c,s.spatialReference)&&(n?$s(n,c):o.transformation=c)):s.setAltitudeOfTransformation(ml.z,c);const p=cZ/s.unitInMeters;return(Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&(n?$s(n,c):o.transformation=c),l}const HZe=ve();function qZe(t,e,r,i,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;i(o,ml);const a=e.mode!=="absolute-height"?ml.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,h=XZe;l.getGlobalTransform(c,h);const p=se(Qbe,h[12],h[13],h[14]);ni.TESTS_DISABLE_OPTIMIZATIONS?(fl[0]=o.x,fl[1]=o.y,fl[2]=ml.z,bl(o.spatialReference,fl,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(ml.z,h);const f=cZ/s.unitInMeters;return(ni.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=f||Math.abs(h[13]-p[1])>=f||Math.abs(h[14]-p[2])>=f)&&l.setGlobalTransform(c,h),a}function WZe(t,e,r,i,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!lZ(p))continue;const f=p.vertexAttributes.get(E.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=Kbe(p,e,r,i,s);c=y,l=f,h=m}h&&n.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const cZ=.01,fl=C(),gu=C(),Zw=C(),XZe=ve(),Qbe=C(),ml=new FR;function Kbe(t,e,r,i,s){let n=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;gu[0]=o[12],gu[1]=o[13],gu[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(E.POSITION),c=l.data,h=l.size,p=c.length/h,f=new DX(t.mapPositions,r);let m=0,y=0;for(let _=0;_<p;_++){if(Zw[0]=c[m],Zw[1]=c[m+1],Zw[2]=c[m+2],i(f,ml),a&&(y+=ml.sampledElevation),ni.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=ml.z,oi(c,r,m,c,s.spatialReference,m,1),c[m]-=gu[0],c[m+1]-=gu[1],c[m+2]-=gu[2],n=!0;else{fl[0]=c[m]+gu[0],fl[1]=c[m+1]+gu[1],fl[2]=c[m+2]+gu[2],s.setAltitude(fl,ml.z),c[m]=fl[0]-gu[0],c[m+1]=fl[1]-gu[1],c[m+2]=fl[2]-gu[2];const v=cZ/s.unitInMeters;(Math.abs(Zw[0]-c[m])>=v||Math.abs(Zw[1]-c[m+1])>=v||Math.abs(Zw[2]-c[m+2])>=v)&&(n=!0)}m+=h,f.offset+=3}return y/=p,{update:n,averageGeometrySampledElevation:y}}function ZZe(t){return!!t&&dS[t]!=null}function YZe(t){return 1/(dS[t]||1)}function JZe(){const t=Object.keys(dS);return t.sort(),t}const QZe=JZe(),KZe=J.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function eYe(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function fOt(t){const e=t&&t.expression;if(typeof e=="string"){const r=rwe(e);if(r!=null)return{cachedResult:r}}return null}async function mOt(t,e,r,i){const s=t&&t.expression;if(typeof s!="string")return null;const n=rwe(s);if(n!=null)return{cachedResult:n};const o=await d_();Jt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function ewe(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function SF(t,e){if(t!=null&&!twe(t)){if(!e||!t.arcade)return void KZe.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=Gbe(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function tYe(t){if(t!=null){if(twe(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function gOt(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const rYe={cachedResult:0};function twe(t){return t.cachedResult!=null}function rwe(t){return t==="0"?0:null}let cp=class iwe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=YZe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=tYe(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=ZZe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&r!=null&&i!=null?(this._featureExpressionInfoContext=eYe(e),SF(this._featureExpressionInfoContext,ewe(s.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new iwe;return e!=null&&r.setFromElevationInfo(e),r}},iYe=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var qt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(qt||(qt={}));let sYe=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},Qf=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=Vre(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,s){if(this.elevationAligner==null)return;i!=null&&SF(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>C_(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,r,i){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=C()){return re(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=an()){const r=this.stageObject.boundingVolumeObjectSpace;return Xfe(e,r.min),Zfe(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.shaderTransformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(om)&&($e(om,om,this.stageObject.shaderTransformation),le(e.render.origin,e.render.origin,om),e.render.num++)}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=nYe,l=Yq(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];wy[0]=o[p[0]],wy[1]=o[p[1]],wy[2]=o[p[2]],$e(wy,wy,this.stageObject.transformation),lv[3*h]=wy[0],lv[3*h+1]=wy[1],lv[3*h+2]=wy[2]}if(!e(lv,0,l))return null;xi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],lv[h+p]),o[p+3]=Math.max(o[p+3],lv[h+p]);c&&i.push({location:lv.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){Dd(o,om);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(r.useViewElevation)p=r.service.getElevation(om[0],om[1],h)??0;else try{const f=aZ(o,r.service.spatialReference,r);p=await r.service.queryElevation(om[0],om[1],s,f,h)??0}catch{}Wfe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e,r){e===$g.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===$g.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const s=Vre(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function Vre(t){return t.isVisible()?t.parameters.transparent?qt.TRANSPARENT:qt.OPAQUE:qt.INVISIBLE}const lv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],wy=C(),om=C(),nYe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let swe=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};var Ps;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Ps||(Ps={}));let uZ=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=qc.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===qc.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===qc.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=qc.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=qc.FAILED,!gs(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=ou(this._abortController):this._loadStatus===qc.LOADING&&(this._loadStatus=qc.FAILED),this._loader=null}};var qc;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(qc||(qc={}));const nwe=3,D7=3,owe=10;let awe=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function PM(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),I4(e)}function zre(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})}),I4(e)}function lwe(t){const e=t.components.map(r=>r.geometry);return I4(e)}function kre(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),I4(e)}function oYe(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function cwe(t,e){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&xBe(a),{components:[new awe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>vBe(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>uBe(e,1));case"cone":return r(s8,i=>Uee(e,1,.5,i,!1),!0);case"inverted-cone":return r(s8,i=>Uee(e,1,.5,i,!0),!0);case"cylinder":return r(s8,i=>wBe(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>_Be(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>fBe(e,1),!0);default:return}}const s8=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function aYe(t){return t.type==="fill"}function lYe(t){return t.type==="extrude"}function cYe(t){return t&&t.enabled&&(lYe(t)||aYe(t))&&t.edges!=null}function uYe(t){return t&&t.enabled&&t.edges||null}function uwe(t,e){return hwe(uYe(t),e)}function hwe(t,e){if(t==null)return null;const r=t.color!=null?mW(ke.toUnitRGBA(t.color)):Nt(0,0,0,0),i=uo(t.size),s=uo(t.extensionLength);switch(t.type){case"solid":return dwe({color:r,size:i,extensionLength:s,...e});case"sketch":return hYe({color:r,size:i,extensionLength:s,...e});default:return}}function dwe(t){return{...dYe,...t,type:"solid"}}function hYe(t){return{...pYe,...t,type:"sketch"}}const dYe={color:Nt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:qt.OPAQUE,hasSlicePlane:!1},pYe={color:Nt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:qt.OPAQUE,hasSlicePlane:!1},hZ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function TOt(t){return t.type==="web-style"?hZ:dZ(t.symbolLayers.toArray().map(e=>pwe(t,e)))}function dZ(t){let e=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function SOt(t){const e=dZ(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const Bre={};function pwe(t,e){var s;const r=fwe(t,e),i=cYe(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return(s=e.resource)!=null&&s.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...fYe(e.resource&&e.resource.primitive||ome),memory:r};case"path":{let n=0,o=0;switch(e.profile){case"circle":n=owe;break;case"quad":n=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":o=nwe;break;case"miter":case"bevel":o=1;break;default:return}const a=2*n,l=n*o*2;let c=-2*l-a;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(n-1);break;case"round":c+=2*(n*(D7-1)*2+n);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:l+a,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function fwe(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Ja.EXTRUDE_EDGES:Ja.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?Ja.FILL_OUTLINE:Ja.FILL;case"water":return Ja.FILL;case"line":return e.join==="round"?Ja.LINE_ROUND:Ja.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Ja.PATH_ROUND_CIRCLE;case"quad":return Ja.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Ja.PATH_MITER_CIRCLE;case"quad":return Ja.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?Ja.OBJECT_POINT:Ja.OBJECT_POLYGON;case"icon":case"text":return r?Ja.ICON_POINT:Ja.ICON_POLYGON;default:return}}function fYe(t){let e=Bre[t];if(e)return e;const r=cwe(t,null);return e={primitivesPerFeature:lwe(r.levels[0]).reduce((i,s)=>i+s.indices.get(E.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Bre[t]=e,e}const Ja={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},Yw=J.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Kf=class extends uZ{constructor(e,r,i,s){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=Yw,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new cp,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Gre(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=Gre(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&Yw.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const s=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(Yw.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(Yw.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return Yw.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return mYe}_defaultElevationInfoZ(){return gYe}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?rYe:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=jre){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=jre){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return AA(null,i);const s=e!=null?ke.toUnitRGB(e):sg;return AA(s,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=AA(i,s);return r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return pwe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==as.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let s=as.UPDATE;return e.forEach(n=>{const o=r(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=as.RECREATE}),s}applyRendererDiff(e,r){return Ps.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?Xd(r.size.field,e):0,s=r.color?Xd(r.color.field,e):0,n=r.opacity?Xd(r.opacity.field,e):0;return Nt(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&Yw.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,s,n,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Gre(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const mYe={mode:"on-the-ground",offset:0,unit:"meters"},gYe={mode:"absolute-height",offset:0,unit:"meters"},jre={hasIntrinsicColor:!1};let Yg=class extends CR{get geometries(){return this._geometries}get transformation(){return this._transformation??sn}set transformation(e){this._transformation=$s(this._transformation??ve(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(e){this._shaderTransformation=$s(this._shaderTransformation??ve(),e),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(e={}){super(),this.type=os.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new mwe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){tt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new _N($g.MaskOccludee);for(const r of this._geometries)r.occludees=ZB(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=YB(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new _N($g.Highlight);for(const r of this._geometries)r.highlights=ZB(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=YB(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return si(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=ve()){return si(r,this.shaderTransformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new Hre,this._validateBoundingVolume(this._bvWorldSpace,OA.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new Hre,this._validateBoundingVolume(this._bvObjectSpace,OA.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===OA.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&yYe(n,e,i?s.shaderTransformation:this.getCombinedShaderTransformation(s))}Br(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=i?s.shaderTransformation:this.getCombinedShaderTransformation(s),a=Y2(o);$e(qre,n.center,o);const l=fi(qre,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},mwe=class{constructor(){this.min=Ae(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ae(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Hre=class extends mwe{constructor(){super(...arguments),this.bounds=ys()}};function yYe(t,e,r){const i=t.bbMin,s=t.bbMax;if(T5(r)){const n=se(_Ye,r[12],r[13],r[14]);le(Cc,i,n),le(Bh,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Cc[o]),e.max[o]=Math.max(e.max[o],Bh[o])}else if($e(Cc,i,r),ia(i,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Cc[n]),e.max[n]=Math.max(e.max[n],Cc[n]);else{$e(Bh,s,r);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Cc[n],Bh[n]),e.max[n]=Math.max(e.max[n],Cc[n],Bh[n]);for(let n=0;n<3;++n){re(Cc,i),re(Bh,s),Cc[n]=s[n],Bh[n]=i[n],$e(Cc,Cc,r),$e(Bh,Bh,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Cc[o],Bh[o]),e.max[o]=Math.max(e.max[o],Cc[o],Bh[o])}}}const _Ye=C(),Cc=C(),Bh=C(),qre=C();var OA;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(OA||(OA={}));function pZ(t,e,r,i,s,n){const o=t.clippingExtent;if(yo(e,Y0,t.elevationProvider.spatialReference),o!=null&&!Xq(o,Y0))return null;yo(e,Y0,t.renderCoordsHelper.spatialReference),r.shaderTransformer=n,r.localOrigin=t.localOriginFactory.getOrigin(Y0);const a=new Yg({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:FZe(a,e,t.elevationProvider,t.renderCoordsHelper,i)}}function IO(t,e,r){const i=t.elevationContext,s=r.spatialReference;yo(e,Y0,s),i.centerPointInElevationSR=Sw(Y0[0],Y0[1],e.hasZ?Y0[2]:0,s??null)}function LO(t){switch(t.type){case"point":return t;case"polygon":case"extent":return oZ(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=Xde(e,Wde(e)/2);return Sw(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const Y0=C();function gwe(){return new Float32Array(2)}function vYe(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Ku(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function bYe(t,e){return new Float32Array(t,e,2)}function ywe(){return gwe()}function _we(){return Ku(1,1)}function vwe(){return Ku(1,0)}function bwe(){return Ku(0,1)}const wwe=ywe(),xwe=_we(),wYe=vwe(),xYe=bwe();Object.freeze(Object.defineProperty({__proto__:null,ONES:xwe,UNIT_X:wYe,UNIT_Y:xYe,ZEROS:wwe,clone:vYe,create:gwe,createView:bYe,fromValues:Ku,ones:_we,unitX:vwe,unitY:bwe,zeros:ywe},Symbol.toStringTag,{value:"Module"}));function TYe(t){const e=new br,{vertex:r,fragment:i}=e;return r.include(fF),e.include(L1e,t),e.include(fs,t),e.attributes.add(E.UV0,"vec2"),r.uniforms.add(new rr("viewport",(s,n)=>n.camera.fullViewport),new Oe("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Tr("pixelToNDC",(s,n)=>sr(Xre,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Oe("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Tr("screenOffset",(s,n)=>sr(Xre,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&pF(r),r.code.add(b`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?b`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?b`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:b`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?b`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:b`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?b`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:b`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new rr("uColor",s=>Wre(s.color)),new rr("borderColor",s=>Wre(s.borderColor))),t.hasMultipassGeometry&&(i.include(c_e,t),i.uniforms.add(new Tr("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(b`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?b`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:b`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Wre(t){return t??wf}const Xre=Ue(),SYe=Object.freeze(Object.defineProperty({__proto__:null,build:TYe},Symbol.toStringTag,{value:"Module"}));let Twe=class Swe extends Rr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ie.Global}initializeProgram(e){return new Er(e.rctx,Swe.shader.get().build(this.configuration),vr)}setPipelineState(e){const r=e?Qr.ALWAYS:Qr.LESS;return this.configuration.depthHudEnabled?Ot({depthTest:{func:r},depthWrite:El}):Ot({blending:_o(be.ONE,be.SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Gt})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};Twe.shader=new Sr(SYe,()=>ae(()=>import("./LineCallout.glsl-278d6f27.js"),[]));let Du=class extends Lo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=gl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};u([F({count:gl.COUNT})],Du.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([F()],Du.prototype,"spherical",void 0),u([F()],Du.prototype,"occlusionTestEnabled",void 0),u([F()],Du.prototype,"hasVerticalOffset",void 0),u([F()],Du.prototype,"hasScreenSizePerspective",void 0),u([F()],Du.prototype,"depthHudEnabled",void 0),u([F()],Du.prototype,"depthHudAlignStartEnabled",void 0),u([F()],Du.prototype,"hasSlicePlane",void 0),u([F()],Du.prototype,"hasMultipassGeometry",void 0),u([F({constValue:!0})],Du.prototype,"hasSliceInVertexProgram",void 0),u([F({constValue:!1})],Du.prototype,"draped",void 0);let MM=class N7 extends U_{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new Ewe),this._configuration=new Du,this._uniqueMaterialIdentifier=N7.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==ce.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?gl.Screen:gl.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===L.Color)switch(e){case ce.LINE_CALLOUTS:case ce.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new EYe(e)}createBufferWriter(){return new AYe}validateParameters(e){const r=N7.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},EYe=class extends N_{beginSlot(e){return this.ensureTechnique(Twe,e)}},Ewe=class extends WX{constructor(){super(...arguments),this.screenOffset=rp,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const CYe=ji().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4f(E.AUXPOS1),Zre=[Ku(0,0),Ku(1,0),Ku(0,1),Ku(1,0),Ku(1,1),Ku(0,1)];let AYe=class{constructor(){this.vertexBufferLayout=CYe}elementCount(e){return 6*e.indices.get(E.POSITION).length}write(e,r,i,s,n){XX(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,e,s.position,n,6),ZX(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,s.normal,n,6),hS(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<Zre.length;++o)s.uv0.setVec(n+o,Zre[o])}},Cwe=class Awe extends Kf{constructor(e,r){super(e,null,r,PYe),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new MM(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||rp,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new Ewe,r=this.symbol,i=r.callout;if(e.color=i.color!=null?ke.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=uo(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:uo(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=i.border!=null&&i.border.color!=null?ke.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.at(0).type==="object",n=r.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return RYe}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,s=this.setGraphicElevationContext(i,new cp,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!dme(l)))return null;const a=oZ(i.geometry);return a==null?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){var e;(e=this._material)==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=NR(Awe.elevationModeChangeTypes,i,s);return n!==as.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._material)==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Ah(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:hZ.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,s=new Ve(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new Ve(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[E.POSITION,s],[E.NORMAL,new Ve([0,0,1],3,!0)],[E.AUXPOS1,n]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=MM.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(i);return s==null&&(s=new MM(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new MM(r),isUnique:!0}}_createAs3DShape(e,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new js(a.material,this._createVertexData(i),OYe,null,os.Point,o),c=pZ(this._context,e,l,r,s);if(c==null)return null;const h=new Qf(this,c.object,[l],a.isUnique?[a.material]:null,null,gb,r);return h.metadata=new swe(i.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=Ah(r.mode),IO(h,e,this._context.elevationProvider),h}};Cwe.elevationModeChangeTypes={definedChanged:as.UPDATE,staysOnTheGround:as.UPDATE,onTheGroundChanged:as.RECREATE};const n8=[0],OYe=[[E.POSITION,n8],[E.NORMAL,n8],[E.AUXPOS1,n8]],RYe={mode:"relative-to-ground",offset:0},PYe={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let MYe=class{constructor(e,r,i=C(),s=Zt(),n=Ue(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},$Ye=class extends iYe{};const Yre=J.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function IYe(t,e){if(!tW(t))return Yre.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=LYe[t.callout.type];return r?new r(t,e):(Yre.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const LYe={line:Cwe};let qb=class Owe{constructor(e=null,r={},i,s){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new Owe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function DOt(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let NOt=class extends qb{},DYe=class Rwe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new Rwe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},O_=class pL{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,s,n]=e,o=s-r,a=n-i;return new pL([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)e(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(e){return e?(e.set(this.coords),new pL(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new pL(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function la(t,e){return t?e?4:3:e?3:2}const UR=J.getLogger("esri.layers.graphics.featureConversionUtils"),Pwe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},NYe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n},Jre=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2]},FYe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+3]},UYe=(t,e,r,i,s,n)=>{t[r]=s,t[r+1]=n,t[r+2]=e[i+2],t[r+3]=e[i+3]};function fZ(t,e,r,i){if(t){if(r)return e&&i?UYe:Jre;if(e&&i)return FYe}else if(e&&i)return Jre;return NYe}function o8({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function a8({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function l8({scale:t,translate:e},r,i){return r*t[i]+e[i]}function UOt(t,e,r){return t?e?r?yZ(t):mZ(t):r?gZ(t):EF(t):null}function EF(t){const e=t.coords;return{x:e[0],y:e[1]}}function Mwe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function mZ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function VYe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function gZ(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function zYe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function yZ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function kYe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function BYe(t,e,r,i){let s=EF;r&&i?s=yZ:r?s=mZ:i&&(s=gZ);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function _Z(t,e){return t&&e?kYe:t?VYe:e?zYe:Mwe}function GYe(t,e,r,i,s){const n=_Z(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new O_,o):null;t.push(new qb(l,a,null,s?a[s]:void 0))}return t}function VOt(t,e,r=_Z(e.z!=null,e.m!=null)){return r(t,e)}function jYe(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?$we(s,r,i):null});return t}function $we(t,e,r){if(t==null)return null;const i=la(e,r),s=[];for(let n=0;n<t.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[n+a]);s.push(o)}return e?r?{points:s,hasZ:e,hasM:r}:{points:s,hasZ:e}:r?{points:s,hasM:r}:{points:s}}function HYe(t,e,r,i,s){const n=la(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?Iwe(new O_,o,n):null;t.push(new qb(l,a,null,s?a[s]:void 0))}return t}function Iwe(t,e,r=la(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let s=0;for(const n of e.points)for(let o=0;o<r;o++)i[s++]=n[o];return t}function qYe(t,e,r,i){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?Lwe(s,r,i):null});return t}function Lwe(t,e,r){if(!t)return null;const i=la(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function WYe(t,e,r,i,s){const n=la(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?Dwe(new O_,o,n):null;t.push(new qb(l,a,null,s?a[s]:void 0))}return t}function Dwe(t,e,r=la(e.hasZ,e.hasM)){const{lengths:i,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return t}function XYe(t,e,r,i){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?Nwe(s,r,i):null;if(o!=null){const l=EF(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function Nwe(t,e,r){if(!t)return null;const i=la(e,r),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function ZYe(t,e,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?Fwe(new O_,n,r,i):null,c=s?a[s]:void 0;o!=null?t.push(new qb(l,a,Mwe(new O_,o),c)):t.push(new qb(l,a,null,c))}return t}function Fwe(t,e,r=e.hasZ,i=e.hasM){return YYe(t,e.rings,r,i)}function YYe(t,e,r,i){const s=la(r,i),{lengths:n,coords:o}=t;let a=0;fg(t);for(const l of e){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return t}const y2=[],RA=[];function zOt(t,e,r,i,s){y2[0]=t;const[n]=Uwe(RA,y2,e,r,i,s);return np(y2),np(RA),n}function Uwe(t,e,r,i,s,n){if(np(t),!r){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new qb(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return GYe(t,e,i,s,n);case"esriGeometryMultipoint":return HYe(t,e,i,s,n);case"esriGeometryPolyline":return WYe(t,e,i,s,n);case"esriGeometryPolygon":return ZYe(t,e,i,s,n);default:UR.error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${r}'`)),np(t)}return t}function kOt(t,e,r,i){RA[0]=t,Vwe(y2,RA,e,r,i);const s=y2[0];return np(y2),np(RA),s}function JYe(t,e,r){if(t==null)return null;const i=new O_;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),Tq(t)?_Z(e??t.z!=null,r??t.m!=null)(i,t):o2(t)?Fwe(i,t,e,r):Sq(t)?Dwe(i,t,la(e,r)):xq(t)?Iwe(i,t,la(e,r)):void UR.error("convertFromGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${t}'`))}function QYe(t,e,r,i){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=EF;return r&&i?n=yZ:r?n=mZ:i&&(n=gZ),n(s)}case"esriGeometryMultipoint":return $we(s,r,i);case"esriGeometryPolyline":return Lwe(s,r,i);case"esriGeometryPolygon":return Nwe(s,r,i);default:return UR.error("convertToGeometry:unknown-geometry",new U(`Unable to parse unknown geometry type '${e}'`)),null}}function KYe(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function Vwe(t,e,r,i,s){if(np(t),r==null)return KYe(t,e);switch(r){case"esriGeometryPoint":return BYe(t,e,i,s);case"esriGeometryMultipoint":return jYe(t,e,i,s);case"esriGeometryPolyline":return qYe(t,e,i,s);case"esriGeometryPolygon":return XYe(t,e,i,s);default:UR.error("convertToFeatureSet:unknown-geometry",new U(`Unable to parse unknown geometry type '${r}'`))}return t}function BOt(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=t,m={features:Vwe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:h,queryGeometry:QYe(p,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function GOt(t,e){const r=new DYe,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=t;return p&&(r.fields=p),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(n&&Uwe(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(UR.error(new U("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function jOt(t){const{transform:e,features:r,hasM:i,hasZ:s}=t;if(!e)return t;for(const n of r)n.geometry!=null&&Kre(n.geometry,n.geometry,i,s,e),n.centroid!=null&&Kre(n.centroid,n.centroid,i,s,e);return t.transform=null,t}function HOt(t,e){const{geometryType:r,features:i,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new O_,Qre(l.geometry,a.geometry,s,n,r,t),a.centroid&&(l.centroid=new O_,Qre(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function Qre(t,e,r,i,s,n,o=r,a=i){if(fg(t),e==null||!e.coords.length)return null;const l=Pwe[s],{coords:c,lengths:h}=e,p=la(r,i),f=la(r&&o,i&&a),m=fZ(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,o8(n,c[0]),a8(n,c[1])),fg(t,p,0),t;let y,_,v,w,T=0,x=0,S=x;for(const O of h){if(O<l)continue;let A=0;x=S,v=y=o8(n,c[T]),w=_=a8(n,c[T+1]),m(t.coords,c,x,T,v,w),A++,T+=p,x+=f;for(let P=1;P<O;P++,T+=p)v=o8(n,c[T]),w=a8(n,c[T+1]),v===y&&w===_||(m(t.coords,c,x,T,v-y,w-_),x+=f,A++,y=v,_=w);A>=l&&(t.lengths.push(A),S=x)}return np(t.coords,S),t.coords.length?t:null}function qOt(t,e,r,i,s,n,o=r,a=i){if(fg(t),!e||!e.coords.length)return null;const l=Pwe[s],{coords:c,lengths:h}=e,p=la(r,i),f=la(r&&o,i&&a),m=fZ(r,i,o,a);if(!h.length)return m(t.coords,c,0,0,c[0],c[1]),fg(t,p,0),t;let y=0;const _=n*n;for(const v of h){if(v<l){y+=v*p;continue}const w=t.coords.length/f,T=y,x=y+(v-1)*p;m(t.coords,c,t.coords.length,T,c[T],c[T+1]),F7(t.coords,c,p,_,m,T,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/f-w;S>=l?t.lengths.push(S):np(t.coords,w*f),y+=v*p}return t.coords.length?t:null}function eJe(t,e,r,i){const s=t[e],n=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function F7(t,e,r,i,s,n,o){let a,l=i,c=0;for(let h=n+r;h<o;h+=r)a=eJe(e,h,n,o),a>l&&(c=h,l=a);l>i&&(c-n>r&&F7(t,e,r,i,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>r&&F7(t,e,r,i,s,c,o))}function WOt(t,e,r,i){if(e==null||!e.coords||!e.coords.length)return null;const s=la(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return Uz(t)?k4e(t,n,o,a,l):yq(n,o,a,l,t),t}function Kre(t,e,r,i,s){const{coords:n,lengths:o}=e,a=la(r,i);if(!n.length)return t!==e&&fg(t),t;M4(s);const{originPosition:l,scale:c,translate:h}=s,p=rJe;p.originPosition=l;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=l8(p,n[_],_);return t!==e&&fg(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let x=0;x<a;++x)t.coords[y+x]=l8(p,n[y+x],x);let w=t.coords[y],T=t.coords[y+1];y+=a;for(let x=1;x<v;x++,y+=a){w+=n[y]*f[0],T+=n[y+1]*f[1],t.coords[y]=w,t.coords[y+1]=T;for(let S=2;S<a;++S)t.coords[y+S]=l8(p,n[y+S],S)}}return t!==e&&fg(t,n.length,o.length),t}function XOt(t,e,r,i,s,n){if(fg(t),t.lengths.push(...e.lengths),r===s&&i===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=la(r,i),a=fZ(r,i,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function tJe(t,e,r,i){let s=0,n=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=n+t[i*(e+a)],c=o+t[i*(e+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function ZOt(t,e){const{coords:r,lengths:i}=t;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=tJe(r,s,a,e),s+=a}return Math.abs(n)}function fg(t,e=0,r=0){np(t.lengths,r),np(t.coords,e)}function np(t,e=0){t.length!==e&&(t.length=e)}const rJe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},eie=new No(Array,t=>u5(t,Yfe),null,10,5),iJe=zt();let sJe=class{get labelLayers(){return this._labelLayers||JAe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,s,n){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=Do.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=n?ewe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(zn.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=zn.GRAPHIC,r){const i=r?this._visibleFlags|r|zn.LABEL*r:this._visibleFlags;return e===zn.GRAPHIC?(i&Do.ALL_GRAPHIC)===Do.ALL_GRAPHIC:(i&Do.ALL_LABEL)===Do.ALL_LABEL}setVisibilityFlag(e,r,i){const s=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const n=this.isVisible(e);if(s===n)return!1;if(e===zn.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(zn.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=zt(),dZe(r,this._extent);const i=r.spatialReference;if(!wn(i,e)&&!_R(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Hd.fromExtent(s.type==="mesh"?s.extent:s)),JYe(s,r,i)}get usedMemory(){let e=Ebe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const s=r.type==="draped"?i.memory.draped:i.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=hZe(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:C(),num:0},draped:{origin:Ue(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&ie(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&sc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?xi(n.boundingBox):n.boundingBox=xi(),n.requiresDrapedElevation=!1,await H4(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=eie.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&B2(n.boundingBox,l),eie.release(l)}),V4e(n.boundingBox)||HV(Zq(n.boundingBox,iJe))?n:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},JOt=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},nJe=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var tie,rie,iie,U7={exports:{}};U7.exports,tie=U7,rie=function(){function t(M,D,N){N=N||2;var G,X,K,ee,_e,Le,_t,Rt=D&&D.length,at=Rt?D[0]*N:M.length,vt=e(M,0,at,N,!0),ze=[];if(!vt||vt.next===vt.prev)return ze;if(Rt&&(vt=l(M,D,vt,N)),M.length>80*N){G=K=M[0],X=ee=M[1];for(var fe=N;fe<at;fe+=N)(_e=M[fe])<G&&(G=_e),(Le=M[fe+1])<X&&(X=Le),_e>K&&(K=_e),Le>ee&&(ee=Le);_t=(_t=Math.max(K-G,ee-X))!==0?1/_t:0}return i(vt,ze,N,G,X,_t),ze}function e(M,D,N,G,X){var K,ee;if(X===Y(M,D,N,G)>0)for(K=D;K<N;K+=G)ee=Z(K,M[K],M[K+1],ee);else for(K=N-G;K>=D;K-=G)ee=Z(K,M[K],M[K+1],ee);if(ee&&O(ee,ee.next)){var _e=ee.next;W(ee),ee=_e}return ee}function r(M,D){if(!M)return M;D||(D=M);var N,G=M;do if(N=!1,G.steiner||!O(G,G.next)&&S(G.prev,G,G.next)!==0)G=G.next;else{var X=G.prev;if(W(G),(G=D=X)===G.next)break;N=!0}while(N||G!==D);return D}function i(M,D,N,G,X,K,ee){if(M){!ee&&K&&y(M,G,X,K);for(var _e,Le,_t=M;M.prev!==M.next;)if(_e=M.prev,Le=M.next,K?n(M,G,X,K):s(M))D.push(_e.i/N),D.push(M.i/N),D.push(Le.i/N),W(M),M=Le.next,_t=Le.next;else if((M=Le)===_t){ee?ee===1?i(M=o(r(M),D,N),D,N,G,X,K,2):ee===2&&a(M,D,N,G,X,K):i(r(M),D,N,G,X,K,1);break}}}function s(M){var D=M.prev,N=M,G=M.next;if(S(D,N,G)>=0)return!1;for(var X=M.next.next;X!==M.prev;){if(T(D.x,D.y,N.x,N.y,G.x,G.y,X.x,X.y)&&S(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function n(M,D,N,G){var X=M.prev,K=M,ee=M.next;if(S(X,K,ee)>=0)return!1;for(var _e=X.x<K.x?X.x<ee.x?X.x:ee.x:K.x<ee.x?K.x:ee.x,Le=X.y<K.y?X.y<ee.y?X.y:ee.y:K.y<ee.y?K.y:ee.y,_t=X.x>K.x?X.x>ee.x?X.x:ee.x:K.x>ee.x?K.x:ee.x,Rt=X.y>K.y?X.y>ee.y?X.y:ee.y:K.y>ee.y?K.y:ee.y,at=v(_e,Le,D,N,G),vt=v(_t,Rt,D,N,G),ze=M.prevZ,fe=M.nextZ;ze&&ze.z>=at&&fe&&fe.z<=vt;){if(ze!==M.prev&&ze!==M.next&&T(X.x,X.y,K.x,K.y,ee.x,ee.y,ze.x,ze.y)&&S(ze.prev,ze,ze.next)>=0||(ze=ze.prevZ,fe!==M.prev&&fe!==M.next&&T(X.x,X.y,K.x,K.y,ee.x,ee.y,fe.x,fe.y)&&S(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ze&&ze.z>=at;){if(ze!==M.prev&&ze!==M.next&&T(X.x,X.y,K.x,K.y,ee.x,ee.y,ze.x,ze.y)&&S(ze.prev,ze,ze.next)>=0)return!1;ze=ze.prevZ}for(;fe&&fe.z<=vt;){if(fe!==M.prev&&fe!==M.next&&T(X.x,X.y,K.x,K.y,ee.x,ee.y,fe.x,fe.y)&&S(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function o(M,D,N){var G=M;do{var X=G.prev,K=G.next.next;!O(X,K)&&A(X,G,G.next,K)&&k(X,K)&&k(K,X)&&(D.push(X.i/N),D.push(G.i/N),D.push(K.i/N),W(G),W(G.next),G=M=K),G=G.next}while(G!==M);return r(G)}function a(M,D,N,G,X,K){var ee=M;do{for(var _e=ee.next.next;_e!==ee.prev;){if(ee.i!==_e.i&&x(ee,_e)){var Le=z(ee,_e);return ee=r(ee,ee.next),Le=r(Le,Le.next),i(ee,D,N,G,X,K),void i(Le,D,N,G,X,K)}_e=_e.next}ee=ee.next}while(ee!==M)}function l(M,D,N,G){var X,K,ee,_e=[];for(X=0,K=D.length;X<K;X++)(ee=e(M,D[X]*G,X<K-1?D[X+1]*G:M.length,G,!1))===ee.next&&(ee.steiner=!0),_e.push(w(ee));for(_e.sort(c),X=0;X<_e.length;X++)N=r(N=p(_e[X],N),N.next);return N}function c(M,D){return M.x-D.x}function h(M){if(M.next.prev===M)return M;let D=M;for(;;){const N=D.next;if(N.prev===D||N===D||N===M)break;D=N}return D}function p(M,D){var N=f(M,D);if(!N)return D;var G=z(N,M),X=r(N,N.next);let K=h(G);return r(K,K.next),X=h(X),h(D===N?X:D)}function f(M,D){var N,G=D,X=M.x,K=M.y,ee=-1/0;do{if(K<=G.y&&K>=G.next.y&&G.next.y!==G.y){var _e=G.x+(K-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(_e<=X&&_e>ee){if(ee=_e,_e===X){if(K===G.y)return G;if(K===G.next.y)return G.next}N=G.x<G.next.x?G:G.next}}G=G.next}while(G!==D);if(!N)return null;if(X===ee)return N;var Le,_t=N,Rt=N.x,at=N.y,vt=1/0;G=N;do X>=G.x&&G.x>=Rt&&X!==G.x&&T(K<at?X:ee,K,Rt,at,K<at?ee:X,K,G.x,G.y)&&(Le=Math.abs(K-G.y)/(X-G.x),k(G,M)&&(Le<vt||Le===vt&&(G.x>N.x||G.x===N.x&&m(N,G)))&&(N=G,vt=Le)),G=G.next;while(G!==_t);return N}function m(M,D){return S(M.prev,M,D.prev)<0&&S(D.next,M,M.next)<0}function y(M,D,N,G){var X=M;do X.z===null&&(X.z=v(X.x,X.y,D,N,G)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==M);X.prevZ.nextZ=null,X.prevZ=null,_(X)}function _(M){var D,N,G,X,K,ee,_e,Le,_t=1;do{for(N=M,M=null,K=null,ee=0;N;){for(ee++,G=N,_e=0,D=0;D<_t&&(_e++,G=G.nextZ);D++);for(Le=_t;_e>0||Le>0&&G;)_e!==0&&(Le===0||!G||N.z<=G.z)?(X=N,N=N.nextZ,_e--):(X=G,G=G.nextZ,Le--),K?K.nextZ=X:M=X,X.prevZ=K,K=X;N=G}K.nextZ=null,_t*=2}while(ee>1);return M}function v(M,D,N,G,X){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M=32767*(M-N)*X)|M<<8))|M<<4))|M<<2))|M<<1))|(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-G)*X)|D<<8))|D<<4))|D<<2))|D<<1))<<1}function w(M){var D=M,N=M;do(D.x<N.x||D.x===N.x&&D.y<N.y)&&(N=D),D=D.next;while(D!==M);return N}function T(M,D,N,G,X,K,ee,_e){return(X-ee)*(D-_e)-(M-ee)*(K-_e)>=0&&(M-ee)*(G-_e)-(N-ee)*(D-_e)>=0&&(N-ee)*(K-_e)-(X-ee)*(G-_e)>=0}function x(M,D){return M.next.i!==D.i&&M.prev.i!==D.i&&!V(M,D)&&(k(M,D)&&k(D,M)&&B(M,D)&&(S(M.prev,M,D.prev)||S(M,D.prev,D))||O(M,D)&&S(M.prev,M,M.next)>0&&S(D.prev,D,D.next)>0)}function S(M,D,N){return(D.y-M.y)*(N.x-D.x)-(D.x-M.x)*(N.y-D.y)}function O(M,D){return M.x===D.x&&M.y===D.y}function A(M,D,N,G){var X=I(S(M,D,N)),K=I(S(M,D,G)),ee=I(S(N,G,M)),_e=I(S(N,G,D));return X!==K&&ee!==_e||!(X!==0||!P(M,N,D))||!(K!==0||!P(M,G,D))||!(ee!==0||!P(N,M,G))||!(_e!==0||!P(N,D,G))}function P(M,D,N){return D.x<=Math.max(M.x,N.x)&&D.x>=Math.min(M.x,N.x)&&D.y<=Math.max(M.y,N.y)&&D.y>=Math.min(M.y,N.y)}function I(M){return M>0?1:M<0?-1:0}function V(M,D){var N=M;do{if(N.i!==M.i&&N.next.i!==M.i&&N.i!==D.i&&N.next.i!==D.i&&A(N,N.next,M,D))return!0;N=N.next}while(N!==M);return!1}function k(M,D){return S(M.prev,M,M.next)<0?S(M,D,M.next)>=0&&S(M,M.prev,D)>=0:S(M,D,M.prev)<0||S(M,M.next,D)<0}function B(M,D){var N=M,G=!1,X=(M.x+D.x)/2,K=(M.y+D.y)/2;do N.y>K!=N.next.y>K&&N.next.y!==N.y&&X<(N.next.x-N.x)*(K-N.y)/(N.next.y-N.y)+N.x&&(G=!G),N=N.next;while(N!==M);return G}function z(M,D){var N=new H(M.i,M.x,M.y),G=new H(D.i,D.x,D.y),X=M.next,K=D.prev;return M.next=D,D.prev=M,N.next=X,X.prev=N,G.next=N,N.prev=G,K.next=G,G.prev=K,G}function Z(M,D,N,G){var X=new H(M,D,N);return G?(X.next=G.next,X.prev=G,G.next.prev=X,G.next=X):(X.prev=X,X.next=X),X}function W(M){M.next.prev=M.prev,M.prev.next=M.next,M.prevZ&&(M.prevZ.nextZ=M.nextZ),M.nextZ&&(M.nextZ.prevZ=M.prevZ)}function H(M,D,N){this.i=M,this.x=D,this.y=N,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Y(M,D,N,G){for(var X=0,K=D,ee=N-G;K<N;K+=G)X+=(M[ee]-M[K])*(M[K+1]+M[ee+1]),ee=K;return X}return t.deviation=function(M,D,N,G){var X=D&&D.length,K=X?D[0]*N:M.length,ee=Math.abs(Y(M,0,K,N));if(X)for(var _e=0,Le=D.length;_e<Le;_e++){var _t=D[_e]*N,Rt=_e<Le-1?D[_e+1]*N:M.length;ee-=Math.abs(Y(M,_t,Rt,N))}var at=0;for(_e=0;_e<G.length;_e+=3){var vt=G[_e]*N,ze=G[_e+1]*N,fe=G[_e+2]*N;at+=Math.abs((M[vt]-M[fe])*(M[ze+1]-M[vt+1])-(M[vt]-M[ze])*(M[fe+1]-M[vt+1]))}return ee===0&&at===0?0:Math.abs((at-ee)/ee)},t.flatten=function(M){for(var D=M[0][0].length,N={vertices:[],holes:[],dimensions:D},G=0,X=0;X<M.length;X++){for(var K=0;K<M[X].length;K++)for(var ee=0;ee<D;ee++)N.vertices.push(M[X][K][ee]);X>0&&(G+=M[X-1].length,N.holes.push(G))}return N},t},(iie=rie())!==void 0&&(tie.exports=iie);const yS=OR(U7.exports),CF=J.getLogger("esri.views.3d.support.buffer.math");function oJe(t,e,r){_S(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function _S(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return CF.error("source and destination buffers need to have the same number of elements"),t;const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],h=r[5],p=r[6],f=r[8],m=r[9],y=r[10],_=r[12],v=r[13],w=r[14];let T=0,x=0;for(let S=0;S<n;S++){const O=e[T],A=e[T+1],P=e[T+2];t[x]=o*O+c*A+f*P+_,t[x+1]=a*O+h*A+m*P+v,t[x+2]=l*O+p*A+y*P+w,T+=s,x+=i}return t}function zwe(t,e,r){Wb(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function Wb(t,e,r,i=3,s=i){if(t.length/i!==Math.ceil(e.length/s))return void CF.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],p=r[5],f=r[6],m=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const T=e[_],x=e[_+1],S=e[_+2];t[v]=o*T+c*x+f*S,t[v+1]=a*T+h*x+m*S,t[v+2]=l*T+p*x+y*S,_+=s,v+=i}}function aJe(t,e,r){BN(t.typedBuffer,e,r,t.typedBufferStride)}function BN(t,e,r,i=3){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],a+=o,l+=i}function lJe(t,e){AF(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function AF(t,e,r=3,i=r){const s=Math.min(t.length/r,e.length/i);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],h=e[n+2],p=l*l+c*c+h*h;if(p>0){const f=1/Math.sqrt(p);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*h}n+=i,o+=r}}function cJe(t,e,r){const i=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let h=0;h<i;h++)s[c]=o[l]>>r,s[c+1]=o[l+1]>>r,s[c+2]=o[l+2]>>r,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:AF,normalizeView:lJe,scale:BN,scaleView:aJe,shiftRight:cJe,transformMat3:Wb,transformMat3View:zwe,transformMat4:_S,transformMat4View:oJe},Symbol.toStringTag,{value:"Module"}));function uJe(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function sie(t,e,r,i,s,n=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:s,draped:n}}var mg,ao;function J0(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function DO(t){return t!=null&&!isNaN(t)&&isFinite(t)}function kwe(t){return t.valueExpression?mg.Expression:t.field&&typeof t.field=="string"?mg.Field:mg.Unknown}function hJe(t,e){const r=e||kwe(t),i=t.valueUnit||"unknown";return r===mg.Unknown?ao.Constant:t.stops?ao.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?ao.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?ao.Proportional:ao.Additive:ao.Identity:ao.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(mg||(mg={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(ao||(ao={}));const R_=J.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),nie=new vh,fL=Math.PI,Bwe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function Gwe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void R_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void R_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!p){const T=_.createSyntaxTree(i.valueExpression);p=_.createFunction(T),i.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=bZ(a,c);if(y){const _=y[0],v=y[1],w=_===v?i.stops[_].color:ke.blendColors(i.stops[_].color,i.stops[v].color,y[2],r!=null?r.color:void 0);return new ke(w)}}}function jwe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void R_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n&&n.attributes;let a=s?e:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(r==null||r.arcade==null)return void R_.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),w=_.createExecContext(n,v);if(!p){const T=_.createSyntaxTree(i.valueExpression);p=_.createFunction(T),i.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=bZ(a,c);if(y){const _=y[0],v=y[1];if(_===v)return i.stops[_].opacity;{const w=i.stops[_].opacity;return w+(i.stops[v].opacity-w)*y[2]}}}}function Hwe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void R_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(r==null||r.arcade==null)return void R_.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(m),v=y.createExecContext(a,_);if(!p){const w=y.createSyntaxTree(i.valueExpression);p=y.createFunction(w),i.cache.compiledFunc=p}f=y.executeFunction(p,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function dJe(t,e,r){const i=typeof e=="number",s=i?null:e,n=s&&s.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const h=r!=null?r.scale:void 0,p=r!=null?r.view:void 0;o=h==null||p==="3d"?pJe(t):h}else if(!i)switch(t.inputValueType){case mg.Expression:{if(r==null||r.arcade==null)return void R_.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(t.valueExpression);l=p.createFunction(y),t.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case mg.Field:n&&(o=n[t.field]);break;case mg.Unknown:o=null}if(!DO(o))return null;if(i||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return DO(c)&&c!==0?o/c:null}function pJe(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function OF(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void R_.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Wwe(dJe(i,e,r),i,e,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function mc(t,e,r){return t==null?null:J0(t)?OF(t,e,r):DO(t)?t:null}function qwe(t,e,r){return DO(r)&&t>r?r:DO(e)&&t<e?e:t}function fJe(t,e,r,i){return t+((mc(e.minSize,r,i)||e.minDataValue)??0)}function mJe(t,e,r){const i=t.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=t.minSize),mc(s,e,r)}function gJe(t,e,r,i){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=mc(e.minSize,r,i),o=mc(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?fL*(n/2)**2:n*n,h=c+s*((l?fL*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/fL):Math.sqrt(h)}return n+s*(o-n)}function yJe(t,e,r,i){const s=i!=null?i.shape:void 0,n=t/e.minDataValue,o=mc(e.minSize,r,i),a=mc(e.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,qwe(l,o,a)}function _Je(t,e,r,i,s){var l,c,h;const[n,o,a]=bZ(t,s);if(n===o)return mc((l=e.stops)==null?void 0:l[n].size,r,i);{const p=mc((c=e.stops)==null?void 0:c[n].size,r,i);return p+(mc((h=e.stops)==null?void 0:h[o].size,r,i)-p)*a}}function vJe(t,e,r,i){const s=(i!=null&&i.resolution?i.resolution:1)*dS[e.valueUnit],n=mc(e.minSize,r,i),o=mc(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/fL)/s:a==="radius"||a==="distance"?2*t/s:t/s,qwe(l,n,o)}function Wwe(t,e,r,i,s){switch(e.transformationType){case ao.Additive:return fJe(t,e,r,i);case ao.Constant:return mJe(e,r,i);case ao.ClampedLinear:return gJe(t,e,r,i);case ao.Proportional:return yJe(t,e,r,i);case ao.Stops:return _Je(t,e,r,i,s);case ao.RealWorldSize:return vJe(t,e,r,i);case ao.Identity:return t;case ao.Unknown:return null}}function bJe(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const s={scale:e,view:r};let n=mc(t.minSize,nie,s),o=mc(t.maxSize,nie,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function vZ(t,e,r){if(!t.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=Gwe(l,e,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=jwe(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=Hwe(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=OF(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function bZ(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((s,n)=>t<s?(i=n,!0):(r=n,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function wJe(t,e,r){const i=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":OF(s,e,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const eRt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:wJe,getColor:Gwe,getOpacity:jwe,getRotationAngle:Hwe,getSize:OF,getSizeForValue:Wwe,getSizeFromNumberOrVariable:mc,getSizeRangeAtScale:bJe,getVisualVariableValues:vZ,viewScaleRE:Bwe},Symbol.toStringTag,{value:"Module"}));function RF(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function xJe(t,e){if(t.symbol!=null)return t.symbol;const r=RF(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function tRt(t,e){const r=RF(t,e),i=xJe(t,e);if(i==null)return null;const s={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return s;const n=vZ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function TJe(t,e){if(t.symbol!=null)return t.symbol;const r=RF(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function rRt(t,e){const r=RF(t,e),i=await TJe(t,e);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=vZ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=ke.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function SJe(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function EJe(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function oie(t){const e=[[E.POSITION,t.indices]],r=[[E.POSITION,new Ve(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(r.push([E.COLORFEATUREATTRIBUTE,new Ve([t.attributeData.colorFeature],1,!0)]),e.push([E.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(r.push([E.COLOR,new Ve(t.attributeData.color,4,!0)]),e.push([E.COLOR,ZS(t.indices.length)])),t.attributeData.uvMapSpace&&(r.push([E.UVMAPSPACE,new Ve(t.attributeData.uvMapSpace,4,!0)]),e.push([E.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(r.push([E.BOUNDINGRECT,new Ve(t.attributeData.boundingRect,9,!0)]),e.push([E.BOUNDINGRECT,t.indices])),new js(t.material,r,e,t.mapPositions,os.Mesh,t.attributeData.objectAndLayerIdColor)}function aie(t,e=null){const r=[[E.POSITION,t.indices],[E.UV0,t.indices]],i=[[E.POSITION,new Ve(t.attributeData.position,3,!0)],[E.UV0,new Ve(t.attributeData.uv0,2,!0)]];return new js(t.material,i,r,t.mapPositions,os.Mesh,e)}function NO(t){switch(t.type){case"extent":if(t instanceof yr)return Hd.fromExtent(t);break;case"polygon":return t}return null}let PF=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function V7(t,e,r){const i=Array.isArray(t),s=i?t.length/e:t.byteLength/(4*e),n=i?t:new Uint32Array(t,0,s*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const P=c[A+1]-c[A];P>h&&(h=P)}else h=s;const p=Math.floor(1.1*h)+1;(vp==null||vp.length<2*p)&&(vp=new Uint32Array(uIe(2*p)));for(let A=0;A<2*p;A++)vp[A]=0;let f=0;const m=!!c&&!!a,y=m?l:s;let _=yN(s);const v=new Uint32Array(l),w=1.96;let T=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,x=1,S=c?c[1]:y;for(let A=0;A<y;A++){if(A===T){const z=1-f/A;if(z+w*Math.sqrt(z*(1-z)/A)<o)return null;T*=2}if(A===S){for(let z=0;z<2*p;z++)vp[z]=0;if(a)for(let z=c[x-1];z<c[x];z++)v[z]=_[a[z]];S=c[++x]}const P=m?a[A]:A,I=P*e,V=OJe(n,I,e);let k=V%p,B=f;for(;vp[2*k+1]!==0;){if(vp[2*k]===V){const z=vp[2*k+1]-1;if(CJe(n,I,z*e,e)){B=_[z];break}}k++,k>=p&&(k-=p)}B===f&&(vp[2*k]=V,vp[2*k+1]=P+1,f++),_[P]=B}if(o!==0&&1-f/s<o)return null;if(m){for(let A=c[x-1];A<v.length;A++)v[A]=_[a[A]];_=Ef(v)}const O=i?new Array(f):new Uint32Array(f*e);f=0;for(let A=0;A<y;A++)_[A]===f&&(AJe(n,(m?a[A]:A)*e,O,f*e,e),f++);if(a&&!m){const A=new Uint32Array(l);for(let P=0;P<A.length;P++)A[P]=_[a[P]];_=Ef(A)}return{buffer:Array.isArray(O)?O:O.buffer,indices:_,uniqueCount:f}}function CJe(t,e,r,i){for(let s=0;s<i;s++)if(t[e+s]!==t[r+s])return!1;return!0}function AJe(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[e+n]}function OJe(t,e,r){let i=0;for(let s=0;s<r;s++)i=t[e+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let vp=null;function sRt(t){const e=VR(t.rings,t.hasZ,Vf.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,h=hh(e.position,3*c,3*l),p=a.holeIndices.map(m=>m-c),f=Ef(yS(h,p,3));r.push({position:h,faces:f}),i+=h.length,s+=f.length}const n=RJe(r,i,s),o=Array.isArray(n.position)?V7(n.position,3,{originalIndices:n.faces}):V7(n.position.buffer,6,{originalIndices:n.faces});return n.position=q_e(new Float64Array(o.buffer)),n.faces=o.indices,n}function RJe(t,e,r){if(t.length===1)return t[0];const i=Uo(e),s=new Array(r);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:i,faces:Ef(s)}}function VR(t,e,r){const i=t.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let m=0;m<i;++m)h+=t[m].length;const p=Uo(3*h);let f=0;for(let m=i-1;m>=0;m--){const y=t[m],_=r===Vf.CCW_IS_HOLE&&PJe(y);if(_&&i!==1)s[a++]=y;else{let v=y.length;for(let T=0;T<a;++T)v+=s[T].length;const w={index:f,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=_?$M(y,y.length-1,-1,p,f,y.length,e):$M(y,0,1,p,f,y.length,e);for(let T=0;T<a;++T){const x=s[T];w.holeIndices[T]=f,w.pathLengths[T+1]=x.length,x.length>0&&(o[c++]={index:f,count:x.length}),f=$M(x,0,1,p,f,x.length,e)}a=0,w.count>0&&(n[l++]=w)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=$M(y,0,1,p,f,y.length,e)}return n.length=l,o.length=c,{position:p,polygons:n,outlines:o}}function $M(t,e,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,e+=r}return s/3}function PJe(t){return!Zde(t,!1,!1)}var Vf;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Vf||(Vf={}));var PA,GN,z7;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(PA||(PA={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(GN||(GN={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(z7||(z7={}));let Xwe=class{constructor(e,r){this._fbo=null;const i=new _r;i.wrapMode=Lt.CLAMP_TO_EDGE,i.samplingMode=At.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new nn(e,i)}dispose(){this._fbo=Fe(this._fbo)}getTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}isValid(){return this._fbo!=null}resize(e,r){var i;(i=this._fbo)==null||i.resize(e,r)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){var r;const e=(r=this._fbo)==null?void 0:r.colorTexture;e!=null&&e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},Jw=class{constructor(e,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new Xwe(e,s)}},MJe=class{constructor(e){this.renderTargets=[new Jw(e,L.Color,is.Color),new Jw(e,L.Color,is.ColorNoRasterImage),new Jw(e,L.Highlight,is.Highlight,!1),new Jw(e,L.Normal,is.Water),new Jw(e,L.Color,is.Occluded)],oe("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new Jw(e,L.ObjectAndLayerIdColor,is.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){return e?(r.lastUsed=i,!1):i-r.lastUsed>$Je?(r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0,!1):r.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const $Je=1e3;let Zwe=class extends Kr{constructor(){super(...arguments),this.color=Nt(1,1,1,1)}};function IJe(){const t=new br;return t.include(Ph),t.fragment.uniforms.add(new Je("tex",e=>e.texture),new rr("uColor",e=>e.color)),t.fragment.code.add(b`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const LJe=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Zwe,build:IJe},Symbol.toStringTag,{value:"Module"}));let Ywe=class{constructor(e){this._context=e,this._perConstructorInstances=new YS,this._frameCounter=0,this._keepAliveFrameCount=lie}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=NJe){const i=r.key;let s=this._perConstructorInstances.get(e,i);if(s==null){const n=new e(this._context,r,()=>this.release(n));s=new DJe(n),this._perConstructorInstances.set(e,i,s)}return++s.refCount,s.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==lie&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(r,i))}),await Promise.all(e)}},DJe=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const lie=-1,NJe=new ca;let Jwe=class{constructor(e,r,i,s){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new YS}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new FJe(n),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(Fe(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&J.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},FJe=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,tt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const UJe={orderedRepackingEnabled:!1},VJe=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let k7=class mL{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Dn,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Dn.clearPool(),B7[0]=null,cv.prune(),n1.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Dn.acquire();for(let s=0;s<r;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}Dn.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Dn.acquire();for(const s of e){const n=r??Z2(this.objectToBoundingSphere(s),jJe);g3(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}Dn.release(i),this._shrink()}update(e,r){if(!g3(r[3])&&this._isDegenerate(e))return;const i=GJe(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const s=uu(e,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,s){const n=uu(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=c8(e,r),h=p=>{if(--n,!s(p))return;const f=this.objectToBoundingSphere(p);if(!X0(i,f))return;const m=x0(e,r,f),y=m-f[3],_=m+f[3];y<o&&(o=y,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!X0(i,p.bounds)||(ie(yu,c,p.halfSize),le(yu,yu,p.bounds),x0(e,r,yu)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},e,r),l}forEachInDepthRange(e,r,i,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{i===mL.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(s);const p=x0(r,i,e),f=c8(r,i),m=c8(r,-i),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),w=v,T=x0(r,i,w)-p,x=T-v[3],S=T+v[3];x>c||S<l||!X0(o,v)||n(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!X0(o,_.bounds)||(ie(yu,f,_.halfSize),le(yu,yu,_.bounds),x0(r,i,yu)-p>c)||(ie(yu,m,_.halfSize),le(yu,yu,_.bounds),x0(r,i,yu)-p<l))return!1;const v=_.node;return v.terminals.forAll(w=>y(w)),v.residents!==null&&v.residents.forAll(w=>y(w)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=cg(r),s=r,n=l=>{const c=this.objectToBoundingSphere(l),h=cg(c),p=i+h;return!(ho(c,s)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=cg(l.bounds),h=i+c;if(ho(l.bounds,s)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return IM(r.bounds,2*-r.halfSize,Gc),IM(r.bounds,2*r.halfSize,jc),hee(e.origin,e.direction,Gc,jc)}_intersectsNodeWithOffset(e,r,i){return IM(r.bounds,2*-r.halfSize,Gc),IM(r.bounds,2*r.halfSize,jc),i.applyToMinMax(Gc,jc),hee(e.origin,e.direction,Gc,jc)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||Mk(i,e)}_intersectsObjectWithOffset(e,r,i){const s=this.objectToBoundingSphere(r);return!(s[3]>0)||Mk(i.applyToBoundingSphere(s),e)}_forEachNode(e,r){let i=Dn.acquire().init(e);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(Dn.acquire().init(i).advance(n));Dn.release(i)}}_forEachNodeDepthOrdered(e,r,i,s=mL.DepthOrder.FRONT_TO_BACK){let n=Dn.acquire().init(e);const o=[n];for(BJe(i,s,hie);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=hie[a];n.node.children[l]&&o.push(Dn.acquire().init(n).advance(l))}Dn.release(n)}}_remove(e,r,i){cv.clear();const s=i.advanceTo(r,(n,o)=>{cv.push(n.node),cv.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(e),s.length===0)for(let n=cv.length-2;n>=0;n-=2){const o=cv.data[n],a=cv.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Bt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const s=Dn.acquire().init(e);this._add(r.at(i),s),Dn.release(s)}}_grow(e,r){if(r!==0&&(cie(e,r,i=>this.objectToBoundingSphere(i),am),g3(am[3])&&!this._fitsInsideTree(am)))if(this._nodeIsEmpty(this._root.node))Z2(am,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(am);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(am,i):this._growRootAsSubNode(i),Dn.release(i)}}_rebuildTree(e,r){re(h8,r.bounds),h8[3]=r.halfSize,cie([e,h8],2,s=>s,d8);const i=Dn.acquire().init(this._root);this._root.initFrom(null,d8,d8[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Dn.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),h=i[l]+r-(n[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(p+f)*Math.LOG2E);s=Math.max(s,m),LM[l].min=p,LM[l].max=f}for(let l=0;l<3;l++){let c=LM[l].min,h=LM[l].max;const p=(s-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const f=n[l]-o-c*o*2;u8[l]=f+(h+c)*o}const a=s*o;return u8[3]=a*Kwe,Dn.acquire().initFrom(null,u8,a,0)}_growRootAsSubNode(e){const r=this._root.node;re(am,this._root.bounds),am[3]=this._root.halfSize,this._root.init(e),e.advanceTo(am,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&e==null;)i=s++,e=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(e){return!g3(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:s}}static fromJSON(e){const r=new mL(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},Dn=class iT{constructor(){this.bounds=ys(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,s=this.depth){return this.node=e??iT.createEmptyNode(),r!=null&&Z2(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*Kwe}advance(e){let r=this.node.children[e];r||(r=iT.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=Qwe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Bt({shrink:!0}),residents:new Bt({shrink:!0})}}static acquire(){return iT._pool.acquire()}static release(e){iT._pool.release(e)}static clearPool(){iT._pool.prune()}};function zJe(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function kJe(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function IM(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function cie(t,e,r,i){if(e===1){const s=r(t[0]);Z2(s,i)}else{Gc[0]=1/0,Gc[1]=1/0,Gc[2]=1/0,jc[0]=-1/0,jc[1]=-1/0,jc[2]=-1/0;for(let s=0;s<e;s++){const n=r(t[s]);g3(n[3])&&(zJe(Gc,n),kJe(jc,n))}Br(i,Gc,jc,.5),i[3]=Math.max(jc[0]-Gc[0],jc[1]-Gc[1],jc[2]-Gc[2])/2}}function BJe(t,e,r){if(!n1.length)for(let i=0;i<8;++i)n1.push({index:0,distance:0});for(let i=0;i<8;++i){const s=Qwe[i];n1.data[i].index=i,n1.data[i].distance=x0(t,e,s)}n1.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=n1.data[i].index}function c8(t,e){let r,i=1/0;for(let s=0;s<8;++s){const n=x0(t,e,uie[s]);n<i&&(i=n,r=uie[s])}return r}function x0(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function g3(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Dn._pool=new No(Dn),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(k7||(k7={}));const Qwe=[Ae(-1,-1,-1),Ae(1,-1,-1),Ae(-1,1,-1),Ae(1,1,-1),Ae(-1,-1,1),Ae(1,-1,1),Ae(-1,1,1),Ae(1,1,1)],uie=[Ae(-1,-1,-1),Ae(-1,-1,1),Ae(-1,1,-1),Ae(-1,1,1),Ae(1,-1,-1),Ae(1,-1,1),Ae(1,1,-1),Ae(1,1,1)],Kwe=Math.sqrt(3),B7=[null];function GJe(t){return B7[0]=t,B7}const u8=ys(),yu=C(),Gc=C(),jc=C(),cv=new Bt,jJe=ys(),am=ys(),h8=ys(),d8=ys(),LM=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],n1=new Bt,hie=[0,0,0,0,0,0,0,0],Vd=k7;var n_;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(n_||(n_={}));let exe=class extends CR{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=os.Layer,this.events=new Is,this.sliceable=!1,this._objects=new Bt,this._objectsAdded=new Bt,this._handles=new Pi,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??n_.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const s of VJe)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==n_.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Vd(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Pe(this._octree),this._objectsAdded.clear()}};function jN(t){return t!=null&&t.type===os.Layer}var nu,Xb;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(nu||(nu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(Xb||(Xb={}));let ro=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=st.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=nu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=Xb.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===nu.Draped}};u([F({count:L.COUNT})],ro.prototype,"output",void 0),u([F({count:st.COUNT})],ro.prototype,"transparencyPassType",void 0),u([F()],ro.prototype,"occluder",void 0),u([F()],ro.prototype,"hasSlicePlane",void 0),u([F()],ro.prototype,"writeDepth",void 0),u([F({count:nu.COUNT})],ro.prototype,"space",void 0),u([F()],ro.prototype,"hideOnShortSegments",void 0),u([F()],ro.prototype,"hasCap",void 0),u([F({count:Xb.COUNT})],ro.prototype,"anchor",void 0),u([F()],ro.prototype,"hasTip",void 0),u([F()],ro.prototype,"vvSize",void 0),u([F()],ro.prototype,"vvColor",void 0),u([F()],ro.prototype,"vvOpacity",void 0),u([F()],ro.prototype,"hasOccludees",void 0),u([F()],ro.prototype,"hasMultipassTerrain",void 0),u([F()],ro.prototype,"cullAboveGround",void 0),u([F({constValue:!0})],ro.prototype,"hasVvInstancing",void 0),u([F({constValue:!0})],ro.prototype,"hasSliceTranslatedView",void 0);const die=8;function txe(t,e){const r=t.vertex;r.uniforms.add(new Oe("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(E.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Vt("vvSizeMinSize",i=>i.vvSize.minSize),new Vt("vvSizeMaxSize",i=>i.vvSize.maxSize),new Vt("vvSizeOffset",i=>i.vvSize.offset),new Vt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(b`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(E.SIZE,"float"),r.code.add(b`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(E.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new yl("vvOpacityValues",i=>i.vvOpacity.values,die),new yl("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,die)),r.code.add(b`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(b`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(pg,e),t.attributes.add(E.COLORFEATUREATTRIBUTE,"float"),r.code.add(b`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(E.COLOR,"vec4"),r.code.add(b`vec4 getColor(){
return applyOpacity(color);
}`))}function Dg(t,e){switch(t.fragment.include(wc),e.output){case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:t.fragment.code.add(b`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case L.Depth:t.fragment.code.add(b`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let rxe=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${hc()}`,s=>s.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:s}=i,n=s.gpuMemoryUsage;this._orphanCache.put(r,s,n)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const s=this._orphanCache.pop(r)??this._createTexture(e),n=new HJe(s);return this._repository.set(r,n),s}},HJe=class{constructor(e){this.texture=e,this.refCount=1}};function qJe(t,e){return new rxe(r=>{const{encodedData:i,paddedPixels:s}=WJe(r),n=new _r;return n.internalFormat=St.RGBA,n.width=s,n.height=1,n.wrapMode=Lt.CLAMP_TO_EDGE,new Ct(t,n,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function WJe(t){const e=wZ(t),r=1/t.pixelRatio,i=ixe(t),s=sxe(t),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const m of e){for(let y=0;y<m;y++){const _=a*(Math.min(y,m-1-y)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=i+nxe,p=new Uint8Array(4*h);let f=4;for(const m of c)MO(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:h}}function wZ(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function ixe(t){if(t==null)return 1;const e=wZ(t);return Math.floor(e.reduce((r,i)=>r+i))}function sxe(t){return wZ(t).reduce((e,r)=>Math.max(e,r))}const nxe=2;function XJe(t){return t==null?wf:t.length===4?t:bi(ZJe,t[0],t[1],t[2],1)}const ZJe=Zt();function oxe(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?YJe(t,e):JJe(t)}function YJe(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:s}=t;s.include(wc),e.draped||(sp(i,e),i.uniforms.add(new Oe("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(b`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(b`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${KJe};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(b`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(b`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),tE(i,e),i.code.add(b`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?b`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",nxe),s.uniforms.add(new Je("stipplePatternTexture",n=>n.stippleTexture),new Oe("stipplePatternSDFNormalizer",n=>QJe(n.stipplePattern)),new Oe("stipplePatternPixelSizeInv",n=>1/xZ(n))),s.code.add(b`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),s.code.add(b`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?b`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:b`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?b`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?b`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:b`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?b`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:b`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(s.uniforms.add(new rr("stippleOffColor",n=>XJe(n.stippleOffColor))),s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(b`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function JJe(t){t.fragment.code.add(b`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function QJe(t){return t?(Math.floor(.5*(sxe(t)-1))+.5)/t.pixelRatio:1}function xZ(t){const e=t.stipplePattern;return e?ixe(t.stipplePattern)/e.pixelRatio:1}const KJe=b.float(.4),yb=64,TZ=yb/2,axe=TZ/5,eQe=yb/axe,tQe=.25;function rQe(t,e){const r=tbe(t,yb,TZ,axe),i=new _r;return i.internalFormat=St.RGBA,i.width=yb,i.height=yb,i.wrapMode=Lt.CLAMP_TO_EDGE,new Ct(e,i,r)}function lxe(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",eQe),tE(r,e),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(b`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===nu.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Oe("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),r.code.add(b`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var dh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(dh||(dh={}));let zi=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.capType=dh.BUTT,this.transparencyPassType=st.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};u([F({count:L.COUNT})],zi.prototype,"output",void 0),u([F({count:dh.COUNT})],zi.prototype,"capType",void 0),u([F({count:st.COUNT})],zi.prototype,"transparencyPassType",void 0),u([F()],zi.prototype,"occluder",void 0),u([F()],zi.prototype,"hasSlicePlane",void 0),u([F()],zi.prototype,"hasPolygonOffset",void 0),u([F()],zi.prototype,"writeDepth",void 0),u([F()],zi.prototype,"draped",void 0),u([F()],zi.prototype,"stippleEnabled",void 0),u([F()],zi.prototype,"stippleOffColorEnabled",void 0),u([F()],zi.prototype,"stippleScaleWithLineWidth",void 0),u([F()],zi.prototype,"stipplePreferContinuous",void 0),u([F()],zi.prototype,"roundJoins",void 0),u([F()],zi.prototype,"applyMarkerOffset",void 0),u([F()],zi.prototype,"vvSize",void 0),u([F()],zi.prototype,"vvColor",void 0),u([F()],zi.prototype,"vvOpacity",void 0),u([F()],zi.prototype,"falloffEnabled",void 0),u([F()],zi.prototype,"innerColorEnabled",void 0),u([F()],zi.prototype,"hasOccludees",void 0),u([F()],zi.prototype,"hasMultipassTerrain",void 0),u([F()],zi.prototype,"cullAboveGround",void 0),u([F()],zi.prototype,"wireframe",void 0),u([F({constValue:!0})],zi.prototype,"stippleRequiresClamp",void 0),u([F({constValue:!0})],zi.prototype,"stippleRequiresStretchMeasure",void 0),u([F({constValue:!0})],zi.prototype,"hasVvInstancing",void 0),u([F({constValue:!0})],zi.prototype,"hasSliceTranslatedView",void 0),u([F()],zi.prototype,"objectAndLayerIdColorInstanced",void 0);const HN=1;function iQe(t){const e=new br,{vertex:r,fragment:i}=e,s=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha);e.include(xR),e.include(txe,t),e.include(oxe,t);const n=t.applyMarkerOffset&&!t.draped;n&&(r.uniforms.add(new Oe("markerScale",m=>m.markerScale)),e.include(lxe,{space:nu.World,draped:!1})),t.output===L.Depth&&e.include(Dg,t),e.include(IR,t),fc(r,t),r.uniforms.add(new Di("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new Tr("nearFar",(m,y)=>y.camera.nearFar),new Oe("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new rr("viewport",(m,y)=>y.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.SUBDIVISIONFACTOR,"float"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),e.attributes.add(E.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),w_(e),s&&e.varyings.add("depth","float");const o=t.stippleEnabled&&t.stippleScaleWithLineWidth;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===dh.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const h=t.stippleEnabled&&a,p=t.falloffEnabled||h;p&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(b`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),q5(e),r.code.add(b`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),tE(r,t),r.code.add(b`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?b`vLineWidth = lineWidth;`:""}
      ${o?b`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(b`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(b`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&r.code.add(b`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?b`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(b`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(b`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?b`min(1.0, subdivisionFactor * ${b.float((HN+2)/(HN+1))})`:b`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(b`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==dh.BUTT;return r.code.add(b`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?b`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(b`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?b`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?b`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?b`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(b`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Oe("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(b`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(b`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Oe("stipplePatternPixelSize",m=>xZ(m))),r.code.add(b`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(b`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&e.include(du,t),e.include(fs,t),i.include(Jf),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(b`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(b`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${b.float(co)}) {
        discard;
      }
    `),h?i.code.add(b`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${b.float(co)}, stippleCoverage);
      `):i.code.add(b`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new rr("intrinsicColor",m=>m.color)),t.output!==L.ObjectAndLayerIdColor&&i.code.add(b`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(b`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new rr("innerColor",m=>m.innerColor??m.color),new Oe("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),i.code.add(b`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(b`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Oe("falloff",m=>m.falloff)),i.code.add(b`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(b`
    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(co)}) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Color&&t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===L.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""}
    ${t.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const sQe=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:HN,build:iQe},Symbol.toStringTag,{value:"Module"})),SZ={func:Qr.LESS},qN={func:Qr.ALWAYS},zf={mask:255},cxe={mask:0},nQe=t=>({function:{func:Qr.NOTEQUAL,ref:t,mask:t},operation:{fail:ms.KEEP,zFail:ms.KEEP,zPass:ms.KEEP}}),oQe=t=>({function:{func:Qr.ALWAYS,ref:t,mask:t},operation:{fail:ms.KEEP,zFail:ms.KEEP,zPass:ms.REPLACE}}),z_={function:{func:Qr.ALWAYS,ref:wl.OutlineVisualElementMask,mask:wl.OutlineVisualElementMask},operation:{fail:ms.KEEP,zFail:ms.KEEP,zPass:ms.ZERO}},P_={function:{func:Qr.ALWAYS,ref:wl.OutlineVisualElementMask,mask:wl.OutlineVisualElementMask},operation:{fail:ms.KEEP,zFail:ms.KEEP,zPass:ms.REPLACE}},uxe={function:{func:Qr.EQUAL,ref:wl.OutlineVisualElementMask,mask:wl.OutlineVisualElementMask},operation:{fail:ms.KEEP,zFail:ms.KEEP,zPass:ms.KEEP}},hxe={function:{func:Qr.NOTEQUAL,ref:wl.OutlineVisualElementMask,mask:wl.OutlineVisualElementMask},operation:{fail:ms.KEEP,zFail:ms.KEEP,zPass:ms.KEEP}},dxe=new Map([[E.POSITION,0],[E.SUBDIVISIONFACTOR,1],[E.UV0,2],[E.AUXPOS1,3],[E.AUXPOS2,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7],[E.OBJECTANDLAYERIDCOLOR,8]]);let pxe=class fxe extends Rr{initializeProgram(e){return new Er(e.rctx,fxe.shader.get().build(this.configuration),dxe)}_makePipelineState(e,r){const i=this.configuration,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:i.output===L.Color||i.output===L.Alpha?s?su:Zg(e):null,depthTest:{func:V_(e)},depthWrite:s?i.writeDepth?El:null:gF(e),colorWrite:Gt,stencilWrite:i.hasOccludees?zf:null,stencilTest:i.hasOccludees?r?P_:z_:null,polygonOffset:s||n?i.hasPolygonOffset?pie:null:_F})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?pie:null;this._occluderPipelineTransparent=Ot({blending:su,polygonOffset:r,depthTest:qN,depthWrite:null,colorWrite:Gt,stencilWrite:null,stencilTest:hxe}),this._occluderPipelineOpaque=Ot({blending:su,polygonOffset:r,depthTest:qN,depthWrite:null,colorWrite:Gt,stencilWrite:cxe,stencilTest:uxe}),this._occluderPipelineMaskWrite=Ot({blending:null,polygonOffset:r,depthTest:SZ,depthWrite:null,colorWrite:null,stencilWrite:zf,stencilTest:P_})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Et.LINES:Et.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===ce.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ce.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};pxe.shader=new Sr(sQe,()=>ae(()=>import("./RibbonLine.glsl-ed662f40.js"),[]));const pie={factor:0,units:-4};var Hl;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Hl||(Hl={}));let XT=class extends U_{constructor(e){super(e,new lQe),this._configuration=new zi,this._vertexAttributeLocations=dxe}isClosed(e,r){return gxe(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===ce.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==L.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&uQe(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ii.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(E.POSITION).data,l=e.vertexAttributes.get(E.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=ye(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const h=s[0],p=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],T=h-v,x=p-w,S=a[_+3]-v,O=a[_+4]-w,A=ye((S*T+O*x)/(S*S+O*O),0,1),P=S*A-T,I=O*A-x,V=P*P+I*I;V<m&&(m=V,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!E0e(r))return void J.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(E.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const T=a.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=ye(this.parameters.vvSize.offset[0]+T*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(E.SIZE)&&(c*=a.get(E.SIZE).data[0]);const h=i.camera,p=hQe;ln(p,i.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;se(BE[0],p[0]-f,p[1]+f,0),se(BE[1],p[0]+f,p[1]+f,0),se(BE[2],p[0]+f,p[1]-f,0),se(BE[3],p[0]-f,p[1]-f,0);for(let T=0;T<4;T++)if(!h.unprojectFromRenderScreen(BE[T],lm[T]))return;Qo(h.eye,lm[0],lm[1],f8),Qo(h.eye,lm[1],lm[2],m8),Qo(h.eye,lm[2],lm[3],g8),Qo(h.eye,lm[3],lm[0],y8);let m=Number.MAX_VALUE,y=0;const _=mxe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let T=0;T<_;T+=3){Qa[0]=l[T]+r[12],Qa[1]=l[T+1]+r[13],Qa[2]=l[T+2]+r[14];const x=(T+3)%l.length;if(Ka[0]=l[x]+r[12],Ka[1]=l[x+1]+r[13],Ka[2]=l[x+2]+r[14],pi(f8,Qa)<0&&pi(f8,Ka)<0||pi(m8,Qa)<0&&pi(m8,Ka)<0||pi(g8,Qa)<0&&pi(g8,Ka)<0||pi(y8,Qa)<0&&pi(y8,Ka)<0)continue;if(h.projectToRenderScreen(Qa,hv),h.projectToRenderScreen(Ka,dv),hv[2]<0&&dv[2]>0){he(bp,Qa,Ka);const O=h.frustum,A=-pi(O[di.NEAR],Qa)/me(bp,O[di.NEAR]);ie(bp,bp,A),le(Qa,Qa,bp),h.projectToRenderScreen(Qa,hv)}else if(hv[2]>0&&dv[2]<0){he(bp,Ka,Qa);const O=h.frustum,A=-pi(O[di.NEAR],Ka)/me(bp,O[di.NEAR]);ie(bp,bp,A),le(Ka,Ka,bp),h.projectToRenderScreen(Ka,dv)}else if(hv[2]<0&&dv[2]<0)continue;hv[2]=0,dv[2]=0;const S=_W(db(hv,dv,gie),p);S<m&&(m=S,re(fie,Qa),re(mie,Ka),y=T/3)}const v=i.rayBegin,w=i.rayEnd;if(m<f*f){let T=Number.MAX_VALUE;if(zge(db(fie,mie,gie),db(v,w,dQe),uv)){he(uv,uv,v);const x=Ee(uv);ie(uv,uv,1/x),T=x/fi(v,w)}o(T,uv,y,!1)}}get _layout(){const e=ji().vec3f(E.POSITION).f32(E.SUBDIVISIONFACTOR).vec2f(E.UV0).vec3f(E.AUXPOS1).vec3f(E.AUXPOS2);return this.parameters.vvSize?e.f32(E.SIZEFEATUREATTRIBUTE):e.f32(E.SIZE),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4f(E.COLOR),this.parameters.vvOpacity&&e.f32(E.OPACITYFEATUREATTRIBUTE),oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new cQe(this._layout,this.parameters)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth||r===L.ObjectAndLayerIdColor?e===ce.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ii.OccludeAndTransparentStencil?e===ce.OPAQUE_MATERIAL||e===ce.OCCLUDER_MATERIAL||e===ce.TRANSPARENT_OCCLUDER_MATERIAL:r===L.Color||r===L.Alpha?e===(this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ce.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new aQe(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},aQe=class extends N_{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(pxe,e)}},lQe=class extends DR{constructor(){super(...arguments),this.width=0,this.color=sh,this.join="miter",this.cap=dh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},cQe=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=HN+i}}_isClosed(e){return mxe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(E.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,r,i,s,n){var H;const o=pQe,a=fQe,l=mQe,c=i.vertexAttributes.get(E.POSITION).data,h=i.indices&&i.indices.get(E.POSITION),p=(H=i.vertexAttributes.get(E.DISTANCETOSTART))==null?void 0:H.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSize?m=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(f=i.vertexAttributes.get(E.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColor?_=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(y=i.vertexAttributes.get(E.COLOR).data);const v=oe("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacity&&(w=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const T=c.length/3,x=new Float32Array(s.buffer),S=oe("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,O=this.vertexBufferLayout.stride/4;let A=n*O;const P=A;let I=0;const V=p?(Y,M,D)=>I=p[D]:(Y,M,D)=>I+=fi(Y,M),k=oe("enable-feature:objectAndLayerId-rendering"),B=(Y,M,D,N,G,X,K)=>{if(x[A++]=M[0],x[A++]=M[1],x[A++]=M[2],x[A++]=N,x[A++]=K,x[A++]=G,x[A++]=Y[0],x[A++]=Y[1],x[A++]=Y[2],x[A++]=D[0],x[A++]=D[1],x[A++]=D[2],x[A++]=this._parameters.vvSize?m:f,this._parameters.vvColor)x[A++]=_;else{const ee=Math.min(4*X,y.length-4);x[A++]=y[ee],x[A++]=y[ee+1],x[A++]=y[ee+2],x[A++]=y[ee+3]}this._parameters.vvOpacity&&(x[A++]=w),k&&(v!=null&&(S[4*A]=v[0],S[4*A+1]=v[1],S[4*A+2]=v[2],S[4*A+3]=v[3]),A++)};A+=O,se(a,c[0],c[1],c[2]),e&&$e(a,a,e);const z=this._isClosed(i);if(z){const Y=c.length-3;se(o,c[Y],c[Y+1],c[Y+2]),e&&$e(o,o,e)}else se(l,c[3],c[4],c[5]),e&&$e(l,l,e),B(a,a,l,1,Hl.LEFT_CAP_START,0,0),B(a,a,l,1,Hl.RIGHT_CAP_START,0,0),re(o,a),re(a,l);const Z=z?0:1,W=z?T:T-1;for(let Y=Z;Y<W;Y++){const M=(Y+1)%T*3;se(l,c[M],c[M+1],c[M+2]),e&&$e(l,l,e),V(o,a,Y),B(o,a,l,0,Hl.LEFT_JOIN_END,Y,I),B(o,a,l,0,Hl.RIGHT_JOIN_END,Y,I);const D=this.numJoinSubdivisions;for(let N=0;N<D;++N){const G=(N+1)/(D+1);B(o,a,l,G,Hl.LEFT_JOIN_END,Y,I),B(o,a,l,G,Hl.RIGHT_JOIN_END,Y,I)}B(o,a,l,1,Hl.LEFT_JOIN_START,Y,I),B(o,a,l,1,Hl.RIGHT_JOIN_START,Y,I),re(o,a),re(a,l)}z?(se(l,c[3],c[4],c[5]),e&&$e(l,l,e),I=V(o,a,W),B(o,a,l,0,Hl.LEFT_JOIN_END,Z,I),B(o,a,l,0,Hl.RIGHT_JOIN_END,Z,I)):(I=V(o,a,W),B(o,a,a,0,Hl.LEFT_CAP_END,W,I),B(o,a,a,0,Hl.RIGHT_CAP_END,W,I)),p8(x,P+O,x,P,O),A=p8(x,A-O,x,A,O),this._parameters.wireframe&&this._addWireframeVertices(s,P,A,O)}_addWireframeVertices(e,r,i,s){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=p8(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function p8(t,e,r,i,s){for(let n=0;n<s;n++)r[i++]=t[e++];return i}function mxe(t,e,r){return gxe(t,e.get(E.POSITION).data,r?r.get(E.POSITION):null)}function gxe(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function uQe(t){return t.anchor===Xb.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Qa=C(),Ka=C(),bp=C(),uv=C(),hQe=C(),hv=Fo(),dv=Fo(),fie=C(),mie=C(),gie=op(),dQe=op(),pQe=C(),fQe=C(),mQe=C(),BE=[Fo(),Fo(),Fo(),Fo()],lm=[C(),C(),C(),C()],f8=Mr(),m8=Mr(),g8=Mr(),y8=Mr();let EZ=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+hc()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const h=NN(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const i=this._gridSize,s=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(he(Zn,e,r.vec3),Zn[0]=Math.abs(Zn[0]),Zn[1]=Math.abs(Zn[1]),Zn[2]=Math.abs(Zn[2]),Zn[0]<c&&Zn[1]<c&&Zn[2]<c){if(l){const h=Math.max(...Zn);if(he(Zn,e,l.vec3),Zn[0]=Math.abs(Zn[0]),Zn[1]=Math.abs(Zn[1]),Zn[2]=Math.abs(Zn[2]),Math.max(...Zn)<h)return l}return r}return l||(l=NN(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Nt(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new XT({width:2,color:r}),s.add(this._material);const m=new exe(s,{pickable:!1}),y=new Yg({castShadow:!1});s.add(y),m.add(y),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?p:-p),c[3*m+1]=e[1]+(2&a[m]?p:-p),c[3*m+2]=e[2]+(4&a[m]?p:-p),m>0&&h.push(m-1,m);oi(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new js(this._material,[[E.POSITION,new Ve(c,3,!0)]],[[E.POSITION,h]],null,os.Line);s.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const Zn=C();let yxe=class{constructor(e,r,i,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new lt,this.output=L.Color,this.renderOccludedMask=yie,this.bindParameters=new H5(r,i,s!=null?s.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=yie}},gQe=class extends yxe{constructor(e,r,i,s,n){super(e,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const yie=Ii.Occlude|Ii.OccludeAndTransparent|Ii.OccludeAndTransparentStencil;let y3=class extends lt{constructor(){super(...arguments),this._projectionMatrix=ve()}get projectionMatrix(){return this._projectionMatrix}};u([d()],y3.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],y3.prototype,"projectionMatrix",null),y3=u([R("esri.views.3d.webgl-engine.lib.CascadeCamera")],y3);const _ie=16;function CZ(t){return Math.ceil(t/_ie)*_ie}var vS;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(vS||(vS={}));let DM=class{constructor(){this.camera=new y3,this.lightMat=ve()}},yQe=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},AZ=class{get depthTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return bi(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new yQe,this._projectionView=ve(),this._projectionViewInverse=ve(),this._modelViewLight=ve(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Zt(),this._cascades=[new DM,new DM,new DM,new DM],this._lastOrigin=null,this._maxTextureSize=Math.min(oe("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=Fe(this._fbo),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=ye(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)v8[e]=this._cascades[e];return v8.length=this._numCascades,v8}start(e,r,i,s,n){tt(this.enabled),this._textureSize=this._computeTextureSize(e,n,s),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,o,s),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let h=0;h<this._numCascades;++h)this._constructCascade(h,c,l,r);this._lastOrigin=null,this.clear()}finish(e){tt(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!ia(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),re(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Sl(Sie,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)Eie[16*r+i]=Sie[i]}}return Eie}takeCascadeSnapshotTo(e,r){tt(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,Ct.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(ns.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,Ct.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(wi.COLOR_BUFFER_BIT|wi.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r,i){const s=Math.min(window.devicePixelRatio,r)/e.pixelRatio,n=Math.max(e.fullWidth,e.fullHeight)*s,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,CZ((this.numCascades===1?1:2)*n*o)))}_ensureDepthTexture(){var r,i;if(((r=this._fbo)==null?void 0:r.width)===this._textureSize)return;const e=new _r(this._textureSize);e.wrapMode=Lt.CLAMP_TO_EDGE,e.samplingMode=At.NEAREST,(i=this._fbo)==null||i.dispose(),this._fbo=new nn(this._rctx,e,new hN(ks.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let r=this._snapshots[e];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i=new _r;return i.wrapMode=Lt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new Ct(this._rctx,i),this._snapshots[e]=r,r}_discardSnapshot(e){this._snapshots[e]=Fe(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);tt(l<c);for(let m=0;m<8;++m){bi(vie,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=qu[m];Qc(y,vie,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}na(_8,qu[0]),n.camera.viewMatrix=Sl(_Qe,this._modelViewLight,_8);for(let m=0;m<8;++m)$e(qu[m],qu[m],n.camera.viewMatrix);let h=qu[0][2],p=qu[0][2];for(let m=1;m<8;++m)h=Math.min(h,qu[m][2]),p=Math.max(p,qu[m][2]);h-=200,p+=200,n.camera.near=-p,n.camera.far=-h,xQe(i,s,h,p,n.camera),si(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/(this.numCascades===1?1:2);n.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,r){si(this._projectionView,e.projectionMatrix,e.viewMatrix),bn(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Ie.Global?e.eye:se(_8,0,0,1);x5(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(SVe(e/r,4)),s);const n=(e-r)/this._numCascades,o=(e/r)**(1/this._numCascades);let a=r,l=r;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=xt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get gpuMemoryUsage(){var e;return this._snapshots.reduce((r,i)=>r+((i==null?void 0:i.gpuMemoryUsage)??0),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const _Qe=ve(),vie=Zt(),qu=[];for(let t=0;t<8;++t)qu.push(Zt());const bie=Ue(),wie=Ue(),vQe=Ue(),xie=Ue(),Tie=Ue(),_8=C(),v8=[],Sie=ve(),Eie=new Array(64),Ac=Ue(),Qw=Ue(),pv=[Ue(),Ue(),Ue(),Ue()],cn=Ue(),b8=Ue(),xy=Ue(),GE=Ue(),Kw=Ue(),ex=Ue(),NM=Ue();function bQe(t,e,r,i,s,n,o,a){sr(Ac,0,0);for(let O=0;O<4;++O)Sd(Ac,Ac,t[O]);sc(Ac,Ac,.25),sr(Qw,0,0);for(let O=4;O<8;++O)Sd(Qw,Qw,t[O]);sc(Qw,Qw,.25),Ju(pv[0],t[4],t[5],.5),Ju(pv[1],t[5],t[6],.5),Ju(pv[2],t[6],t[7],.5),Ju(pv[3],t[7],t[4],.5);let l=0,c=nN(pv[0],Ac);for(let O=1;O<4;++O){const A=nN(pv[O],Ac);A<c&&(c=A,l=O)}uf(cn,pv[l],t[l+4]);const h=cn[0];let p,f;cn[0]=-cn[1],cn[1]=h,uf(b8,Qw,Ac),Ys(b8,cn)<0&&FW(cn,cn),Ju(cn,cn,b8,r),wO(cn,cn),p=f=Ys(uf(xy,t[0],Ac),cn);for(let O=1;O<8;++O){const A=Ys(uf(xy,t[O],Ac),cn);A<p?p=A:A>f&&(f=A)}ln(i,Ac),sc(xy,cn,p-e),Sd(i,i,xy);let m=-1,y=1,_=0,v=0;for(let O=0;O<8;++O){uf(GE,t[O],i),wO(GE,GE);const A=cn[0]*GE[1]-cn[1]*GE[0];A>0?A>m&&(m=A,_=O):A<y&&(y=A,v=O)}Iw(m>0,"leftArea"),Iw(y<0,"rightArea"),sc(Kw,cn,p),Sd(Kw,Kw,Ac),sc(ex,cn,f),Sd(ex,ex,Ac),NM[0]=-cn[1],NM[1]=cn[0];const w=kP(i,t[v],ex,Sd(xy,ex,NM),1,s),T=kP(i,t[_],ex,xy,1,n),x=kP(i,t[_],Kw,Sd(xy,Kw,NM),1,o),S=kP(i,t[v],Kw,xy,1,a);Iw(w,"rayRay"),Iw(T,"rayRay"),Iw(x,"rayRay"),Iw(S,"rayRay")}function fr(t,e){return 3*e+t}const Cie=Ue();function Pl(t,e){return sr(Cie,t[e],t[e+3]),Cie}const el=Ue(),We=Ni();function wQe(t,e,r,i,s){uf(el,r,i),sc(el,el,.5),We[0]=el[0],We[1]=el[1],We[2]=0,We[3]=el[1],We[4]=-el[0],We[5]=0,We[6]=el[0]*el[0]+el[1]*el[1],We[7]=el[0]*el[1]-el[1]*el[0],We[8]=1,We[fr(0,2)]=-Ys(Pl(We,0),t),We[fr(1,2)]=-Ys(Pl(We,1),t);let n=Ys(Pl(We,0),r)+We[fr(0,2)],o=Ys(Pl(We,1),r)+We[fr(1,2)],a=Ys(Pl(We,0),i)+We[fr(0,2)],l=Ys(Pl(We,1),i)+We[fr(1,2)];n=-(n+a)/(o+l),We[fr(0,0)]+=We[fr(1,0)]*n,We[fr(0,1)]+=We[fr(1,1)]*n,We[fr(0,2)]+=We[fr(1,2)]*n,n=1/(Ys(Pl(We,0),r)+We[fr(0,2)]),o=1/(Ys(Pl(We,1),r)+We[fr(1,2)]),We[fr(0,0)]*=n,We[fr(0,1)]*=n,We[fr(0,2)]*=n,We[fr(1,0)]*=o,We[fr(1,1)]*=o,We[fr(1,2)]*=o,We[fr(2,0)]=We[fr(1,0)],We[fr(2,1)]=We[fr(1,1)],We[fr(2,2)]=We[fr(1,2)],We[fr(1,2)]+=1,n=Ys(Pl(We,1),e)+We[fr(1,2)],o=Ys(Pl(We,2),e)+We[fr(2,2)],a=Ys(Pl(We,1),r)+We[fr(1,2)],l=Ys(Pl(We,2),r)+We[fr(2,2)],n=-.5*(n/o+a/l),We[fr(1,0)]+=We[fr(2,0)]*n,We[fr(1,1)]+=We[fr(2,1)]*n,We[fr(1,2)]+=We[fr(2,2)]*n,n=Ys(Pl(We,1),e)+We[fr(1,2)],o=Ys(Pl(We,2),e)+We[fr(2,2)],a=-o/n,We[fr(1,0)]*=a,We[fr(1,1)]*=a,We[fr(1,2)]*=a,s[0]=We[0],s[1]=We[1],s[2]=0,s[3]=We[2],s[4]=We[3],s[5]=We[4],s[6]=0,s[7]=We[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=We[6],s[13]=We[7],s[14]=0,s[15]=We[8]}function xQe(t,e,r,i,s){const n=1/qu[0][3],o=1/qu[4][3];tt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(xn(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,bQe(qu,a,l,bie,wie,vQe,xie,Tie),wQe(bie,wie,xie,Tie,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function TQe(t){return lp(t)&&t.intersector===Bi.TERRAIN&&!!t.target}let SQe=class extends rF{constructor(e,r,i){super(e,r),this.triangleNr=i}};function _xe(t){return lp(t)&&t.intersector===Bi.OVERLAY&&!!t.target}let G7=class{constructor(){this.adds=new Bt,this.removes=new Bt,this.updates=new Bt({allocator:e=>e||new EQe,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},EQe=class{},CQe=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var qi,fn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(qi||(qi={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(fn||(fn={}));function vxe(t){const e=new Map,r=i=>{let s=e.get(i);return s||(s=new CQe,e.set(i,s)),s};return t.removes.forAll(i=>{w8(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{w8(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{w8(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function w8(t){return t.geometry.indexCount>=1}let bxe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===ug.LOADED)return s;this._repository.requestRender()}return null}};function zR(t,e){switch(e.normalType){case Ar.Compressed:t.attributes.add(E.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(b`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Ar.Attribute:t.attributes.add(E.NORMAL,"vec3"),t.vertex.code.add(b`vec3 normalModel() {
return normal;
}`);break;case Ar.ScreenDerivative:t.fragment.code.add(b`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Ar.COUNT:case Ar.Ground:}}var Ar;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Ar||(Ar={}));function MF(t,e){switch(e.normalType){case Ar.Attribute:case Ar.Compressed:t.include(zR,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new xO("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new Mh("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(b`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Ar.Ground:t.include(c2,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(b`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?b`normalize(vPositionWorldCameraRelative);`:b`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Ar.ScreenDerivative:t.vertex.code.add(b`void forwardNormal() {}`);break;default:e.normalType;case Ar.COUNT:}}let wxe=class extends E_e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ni()}},xxe=class extends C_e{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Ni(),this.toMapSpace=Zt()}},j7=class extends xxe{constructor(e=C()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},rE=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(E.POSITION).length}write(e,r,i,s,n){W1e(i,this.vertexBufferLayout,e,r,s,n)}};const AQe=ji().vec3f(E.POSITION),OQe=ji().vec3f(E.POSITION).vec2f(E.UV0),RQe=ji().vec3f(E.POSITION).vec4u8(E.COLOR);ji().vec3f(E.POSITION).vec4u8(E.OBJECTANDLAYERIDCOLOR);const PQe=ji().vec3f(E.POSITION).vec2f(E.UV0).vec4u8(E.OBJECTANDLAYERIDCOLOR);ji().vec3f(E.POSITION).vec4u8(E.COLOR).vec4u8(E.OBJECTANDLAYERIDCOLOR);let OZ=class extends U_{intersect(e,r,i,s,n,o){return D1e(e,i,s,n,void 0,o)}};function MQe(t){t.fragment.code.add(b`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function $Qe(t){t.fragment.code.add(b`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}let kR=class extends ls{constructor(e,r){super(e,"int",Jr.Pass,(i,s,n)=>i.setUniform1i(e,r(s,n)))}},IQe=class extends ls{constructor(e,r,i){super(e,"mat4",Jr.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,r(n,o,a)),i)}},LQe=class extends ls{constructor(e,r,i){super(e,"mat4",Jr.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,r(n,o)),i)}},DQe=class extends Kr{constructor(){super(...arguments),this.origin=C()}},NQe=class extends DQe{},FQe=class extends Kr{constructor(){super(...arguments),this.modelTransformation=sn}},RZ=class extends FQe{constructor(){super(...arguments),this.origin=C()}};function $F(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new LQe("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Txe(t))}function Zb(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new IQe("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),Txe(t))}function Txe(t){const e=t.fragment;e.include(wc),e.uniforms.add(new Je("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new kR("numCascades",(r,i)=>i.shadowMap.numCascades),new rr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(b`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function Aie(t){t.fragment.uniforms.add(new Je("texWaveNormal",e=>e.waveNormal),new Je("texWavePerturbation",e=>e.wavePertubation),new rr("waveParams",e=>bi(UQe,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Tr("waveDirection",e=>sr(VQe,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(MQe),t.fragment.code.add(b`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const UQe=Zt(),VQe=Ue();function FO(t,e){e.spherical?t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(b`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(b`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function zQe(t){const e=t.fragment.code;e.add(b`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(b`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(b`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function PZ(t,e){const r=t.fragment.code;t.include(xR),e.pbrMode!==rt.Normal&&e.pbrMode!==rt.Schematic&&e.pbrMode!==rt.Terrain&&e.pbrMode!==rt.TerrainWithWater||(r.add(b`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(b`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==rt.Normal&&e.pbrMode!==rt.Schematic||(t.include(zQe),r.add(b`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(b`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(b`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(b`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function kQe(t,e){const r=t.fragment.code;t.include(xR),r.add(b`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(b`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(b`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(b`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(b`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function Sxe(t,e){t.include(kQe,e),t.include(k5),t.include($Qe),e.hasCloudsReflections&&t.include(W0e,e),e.hasScreenSpaceReflections&&t.include(lke,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(b`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Oe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Oe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(b`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new Di("view",(i,s)=>s.ssr.camera.viewMatrix),new Je("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new Oe("fadeFactorSSR",(i,s)=>s.ssr.fadeFactor)),r.code.add(b`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(b`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(b`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(b`return waterRenderedColor;
}`)}function BQe(t){const e=new br,{vertex:r,fragment:i}=e;fc(r,t),e.include(vl,t),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.UV0,"vec2");const s=new rr("waterColor",n=>n.color);if(t.output===L.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(co)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(b`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==L.Color&&t.output!==L.Alpha||(e.include(FO,t),e.include(XS,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(co)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===L.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(du,t),t.output){case L.Alpha:e.include(fs,t),i.uniforms.add(s),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case L.Color:e.include(oN),e.include(WW,{pbrMode:rt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Aie),e.include(fs,t),e.include(Zb,t),e.include(Sxe,t),i.uniforms.add(s,new Oe("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),sp(i,t),i.include(Jf),zg(i),Yf(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?b`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case L.Normal:e.include(FO,t),e.include(Aie,t),e.include(fs,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(b`
        void main(void) {
          if (waterColor.a < ${b.float(co)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Oe("timeElapsed",n=>n.timeElapsed)),i.code.add(b`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case L.Highlight:e.include(Xg,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(co)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(fs,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case L.ObjectAndLayerIdColor:e.include(IR,t),e.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(b`
      void main(void) {
        if (waterColor.a < ${b.float(co)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(fs,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const GQe=Object.freeze(Object.defineProperty({__proto__:null,build:BQe},Symbol.toStringTag,{value:"Module"}));let Exe=class Cxe extends Rr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ie.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Er(e.rctx,Cxe.shader.get().build(this.configuration),vr)}_setPipelineState(e){const r=this.configuration,i=e===st.NONE,s=e===st.FrontFace;return Ot({blending:r.output!==L.Normal&&r.output!==L.Highlight&&r.output!==L.ObjectAndLayerIdColor&&r.transparent?i?su:Zg(e):null,depthTest:{func:V_(e)},depthWrite:i?r.writeDepth?El:null:gF(e),colorWrite:Gt,polygonOffset:i||s?null:vF(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Exe.shader=new Sr(GQe,()=>ae(()=>import("./WaterSurface.glsl-6c130b17.js"),[]));let An=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.transparencyPassType=st.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};u([F({count:L.COUNT})],An.prototype,"output",void 0),u([F({count:st.COUNT})],An.prototype,"transparencyPassType",void 0),u([F()],An.prototype,"spherical",void 0),u([F()],An.prototype,"receiveShadows",void 0),u([F()],An.prototype,"hasSlicePlane",void 0),u([F()],An.prototype,"transparent",void 0),u([F()],An.prototype,"enableOffset",void 0),u([F()],An.prototype,"writeDepth",void 0),u([F()],An.prototype,"hasScreenSpaceReflections",void 0),u([F()],An.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],An.prototype,"hasCloudsReflections",void 0),u([F()],An.prototype,"objectAndLayerIdColorInstanced",void 0),u([F()],An.prototype,"isDraped",void 0),u([F()],An.prototype,"hasMultipassTerrain",void 0),u([F()],An.prototype,"cullAboveGround",void 0),u([F({constValue:rt.Water})],An.prototype,"pbrMode",void 0),u([F({constValue:!0})],An.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!0})],An.prototype,"highStepCount",void 0),u([F({constValue:!1})],An.prototype,"useFillLights",void 0);let jQe=class extends N_{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===L.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(Exe,e)}},Axe=class extends OZ{constructor(e){super(e,new Oxe),this._configuration=new An,this.animation=new eve}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<yF,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<HQe;const i=this.animation.advance(e);return this.setParameters({timeElapsed:AH(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case L.Normal:return e===ce.DRAPED_WATER;case L.Color:if(this.parameters.isDraped)return e===ce.DRAPED_MATERIAL;break;case L.Alpha:break;case L.Highlight:case L.ObjectAndLayerIdColor:return e===ce.OPAQUE_MATERIAL||e===ce.DRAPED_MATERIAL;default:return!1}let i=ce.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new jQe(e)}createBufferWriter(){return new rE(oe("enable-feature:objectAndLayerId-rendering")?PQe:OQe)}},Oxe=class extends WX{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=cr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Nt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=C(),this.modelTransformation=null}};const HQe=35e3;let MZ=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function Oie(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const s=e.get(i.to);s&&(i.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0)})}let Rie=class extends MZ{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},qQe=class{constructor(){this.first=0,this.count=0}},WQe=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Bt({allocator:e=>e||new MZ,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=FM(),this.drawCommandsHighlight=FM(),this.drawCommandsOccludees=FM(),this.drawCommandsShadowHighlightRest=FM()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(Pie(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),Pie(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function XQe(t){return t.vao!=null}function FM(){return new Bt({allocator:t=>t||new qQe,deallocator:t=>t})}function Pie(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(ZQe(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function ZQe(t,e){return t.first+t.count>=e.from}let YQe=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const gL=-3;var Qm;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Qm||(Qm={}));let JQe=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=QQe+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,r,i,s=0){this._storage.put(this,e,r,i,s)}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},Rxe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Bt,this._users=new Bt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,r,i,s,n){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,Qm.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,Qm.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return void console.warn("Refusing to cache entry with invalid size "+s);const a=1+Math.max(n,gL)-gL;this._db.set(r,{entry:i,size:s,lifetime:a,lives:a}),this._size+=s,e.size+=s,this._checkSizeLimits()}updateSize(e,r,i,s){r=e.id+r;const n=this._db.get(r);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(r,i,Qm.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSizeLimits()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:h,name:p}=c;if(a.startsWith(h)){const f=r[p]||0;r[p]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+gL-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,s)=>{s.startsWith(r)&&(this._size-=i.size,this._db.delete(s),this._notifyRemove(s,i.entry,Qm.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,Qm.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let s;return this._removeFuncs.some(n=>{if(e.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,r]of this._db)if(this._purgeItem(e,r),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[r,i]of this._db)if(r.startsWith(e.id)&&(this._purgeItem(r,i,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,r,i=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const s=this._notifyRemove(e,r.entry,Qm.SOME);s!=null&&s>0&&(this._size+=s,i&&(i.size+=s),r.lives=r.lifetime,r.size=s,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},QQe=0;const KQe=gL+1;let eKe=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache("VaoCache",tKe)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(i!=null){const n=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,KQe),n}const s=new ap(this._rctx,this._locations,{geometry:this._layout},{geometry:Ir.createVertex(this._rctx,xr.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(e==null)return null;const r=e.byteSize,i=r.toString(),s=this._cache.pop(i);return s!=null?(s.push(e),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[e],r,-1),null}};function tKe(t,e){if(e===Qm.ALL)return void t.forEach(s=>s.dispose());const r=t.pop(),i=t.length*r.byteSize;return r.dispose(),i}let Pxe=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new bxe(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new eKe(e,i.vertexAttributeLocations,xc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof Axe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Ii.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(fn.GEOMETRY|fn.TRANSFORMATION)){const c=kM(r.elementCount(l.geometry.geometry)*i),h=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),BM()}s.updateType&(fn.HIGHLIGHT|fn.OCCLUDEE|fn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new YS;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=i.get(n.id,null);o==null&&(o=new Mie(n.vec3),i.set(n.id,null,o)),o.changes.push(s)}for(const s of r){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=i.get(n.id,a);l==null&&(l=new Mie(n.vec3),i.set(n.id,a,l)),l.changes.push(s)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),h=c!=null?c.changes:[];o.delete(l,null);let p=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void tt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),XA(p.buffers,m),void(p.buffers.length===0&&h.length===0&&s.delete(l));const y=m.numElements,_=m.vao.byteSize/4,v=h.reduce((S,O)=>S+i.elementCount(O.geometry),0),w=f.changes.reduce((S,O)=>S+i.elementCount(O.geometry),0),T=Math.min((y+v-w)*n,zM),x=T>_;T>WN&&T<_/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(m.vao),XA(p.buffers,m)):x?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(p==null&&(p=new YQe(c.origin),s.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new WQe,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,$o(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const y of i.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(zM/o);let l=e.numElements;for(;r.length>0;){const y=r.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const v=new Rie(y,0,0);tt(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,h=kM(c),p=s.vertexBufferLayout.createView(h.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,p,f);const v=f;f+=s.elementCount(y.geometry.geometry),e.updateInstance(_,v,f),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Lie(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),BM(),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=wp.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=wp.pushNew();p.from=c.from,p.to=c.to}Oie(wp);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=wp.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=kM(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;wp.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),BM(),e.holes.pushArray(wp.data,wp.length),wp.forAll((a,l)=>wp.data[l]=null),wp.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!XQe(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=e.numElements,o=r.reduce((w,T)=>w+i.elementCount(T.geometry),0),a=Math.min((n+o)*s,zM),l=4*a;if(e.vao.byteSize<Lie(zM-WN)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);Oie(e.holes);const c=new Array;for(const w of r){const T=i.elementCount(w.geometry),x=rKe(e.holes,T);c.push(x)}const h=e.vao.vertexBuffers.geometry;let p=0,f=0,m=0;const y=kM(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((w,T)=>{const x=c[T];if(x==null)return;if(m!==x){const A=m-f;A>0&&h.setSubData(y,f*s,0,A*s),f=x,p=0}const S=i.elementCount(w.geometry);this._writeGeometry(w,_,p),p+=S,m=x+S;const O=new Rie(w,x,x+S);tt(e.instances.get(w.id)==null),e.addInstance(w.id,O),e.drawCommandsDirty=!0});const v=m-f;v>0&&h.setSubData(y,f*s,0,v*s),ZAe(r,(w,T)=>c[T]==null),BM()}_writeGeometry(e,r,i){const s=e.localOrigin.vec3;EVe($ie,-s[0],-s[1],-s[2]);const n=si(iKe,$ie,e.transformation);bn(UM,n),_c(UM,UM),this._bufferWriter.write(n,UM,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}prepareTechnique(e){const{output:r,bindParameters:i}=e;if(!this.requiresSlot(i.slot,r))return null;const s=r===L.Highlight||r===L.ShadowHighlight;if(s&&!this._hasHighlights)return null;const n=r===L.ShadowExcludeHighlight,o=!(s||n);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(s&&!l.hasHighlights)continue;const c=(s?l.drawCommandsHighlight:n&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,h=o&&l.drawCommandsOccludees||null;if(c!=null&&c.length||h!=null&&h.length){const p=this._glMaterials.load(e.rctx,i.slot,r),f=p!=null?p.beginSlot(i):null;if(f!=null)return f}}return null}render(e,r){var c;const{output:i,bindParameters:s}=e,n=i===L.Highlight||i===L.ShadowHighlight,o=i===L.ShadowExcludeHighlight,a=!(n||o),l=this._rctx;(c=l.appleAmdDriverHelper)==null||c.resetIndicesType(),l.bindTechnique(r,this.material.parameters,s);for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(n&&!p.hasHighlights)continue;const f=(n?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,m=a&&p.drawCommandsOccludees||null;(f!=null&&f.length||m!=null&&m.length)&&(r.program.bindDraw(new j7(h.origin),s,this.material.parameters),r.ensureAttributeLocations(p.vao),l.bindVAO(p.vao),f!=null&&f.length&&(r.bindPipelineState(l,s.slot,!1),f.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))),m!=null&&m.length&&(r.bindPipelineState(l,s.slot,!0),m.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},Mie=class{constructor(e){this.origin=e,this.changes=new Array}};function rKe(t,e){let r;if(!t.some(s=>!(s.numElements<e)&&(r=s,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const $ie=ve(),iKe=ve(),UM=ve(),wp=new Bt({allocator:t=>t||new MZ,deallocator:null}),WN=65536,VM=4*WN,Iie=1024,Mxe=16777216,zM=Mxe/4;let yL=new Float32Array(WN);function kM(t){return yL.length<t&&(yL=new Float32Array(t)),yL}function Lie(t){const e=4*t;return e<=Iie?Iie:e<VM?VM:Math.max(Math.min(Math.ceil(1.5*e/VM)*VM,Mxe),e)}function BM(){yL=new Float32Array(2)}let Uc=class extends xe{constructor(e){super(e),this._pending=new sKe,this._changes=new G7,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Bt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return $o(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=vxe(this._changes);let r=!1,i=!1,s=!1;return e.forEach((n,o)=>{let a=this._materialRenderers.get(o);if(!a&&n.adds.length>0&&(a=new Pxe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,s=!0),!a)return;const l=i||a.hasHighlights,c=s||a.hasWater;a.modify(n),i=i||l!==a.hasHighlights,s=s||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=$o(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=$o(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of i)this._pending.adds.add(n);s&&this.notifyChange("updating"),r===qi.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===qi.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case fn.TRANSFORMATION:case fn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case fn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{if(r.material.shouldRender(e)){const i=r.prepareTechnique(e);i!=null&&r.render(e,i)}})}intersect(e,r,i,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,i,r,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const s=i.material.renderPriority-r.material.renderPriority;return s!==0?s:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],x8[0]=i[0]-s,x8[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,x8,(l,c,h)=>{nKe(r,h,e.material.renderPriority,o,n,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicGeometryChanged(s),r=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const s=i.graphicUid;s!=null&&s!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(s),r=s)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],Uc.prototype,"drapeSource",void 0),u([d()],Uc.prototype,"updating",null),u([d()],Uc.prototype,"rctx",null),u([d()],Uc.prototype,"rendererContext",void 0),u([d()],Uc.prototype,"_materialRepository",null),u([d()],Uc.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],Uc.prototype,"isEmpty",null),u([d()],Uc.prototype,"_materialRenderers",void 0),u([d()],Uc.prototype,"_geometries",void 0),Uc=u([R("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Uc);let sKe=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function nKe(t,e,r,i,s,n,o){const a=new SQe(n,o,e),l=c=>{c.set(Bi.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==fo.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===fo.ALL){const c=_X(s.ray);l(c),s.results.all.push(c)}}const x8=Ue();let $Z=class extends ls{constructor(e,r){super(e,"vec2",Jr.Draw,(i,s,n,o)=>i.setUniform2fv(e,r(s,n,o)))}};const T8=4;function oKe(){const t=new br,e=t.fragment;t.include(Ph);const r=(T8+1)/2,i=1/(2*r*r);return e.include(hu),e.uniforms.add(new Je("depthMap",s=>s.depthTexture),new uh("tex",s=>s.colorTexture),new $Z("blurSize",s=>s.blurSize),new Oe("projScale",(s,n)=>{const o=fi(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new Tr("nearFar",(s,n)=>n.camera.nearFar)),e.code.add(b`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${b.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(b`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${b.int(T8)}; r <= ${b.int(T8)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const aKe=Object.freeze(Object.defineProperty({__proto__:null,build:oKe},Symbol.toStringTag,{value:"Module"}));let $xe=class Ixe extends Rr{initializeProgram(e){return new Er(e.rctx,Ixe.shader.get().build(),vr)}initializePipeline(){return Ot({colorWrite:Gt})}};$xe.shader=new Sr(aKe,()=>ae(()=>import("./SSAOBlur.glsl-e4dc60e9.js"),[]));const lKe="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function IF(t){t.fragment.uniforms.add(new rr("projInfo",(e,r)=>cKe(r))),t.fragment.uniforms.add(new Tr("zScale",(e,r)=>Lxe(r))),t.fragment.code.add(b`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function cKe(t){const e=t.camera.projectionMatrix;return e[11]===0?bi(Die,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):bi(Die,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Die=Zt();function Lxe(t){return t.camera.projectionMatrix[11]===0?sr(Nie,0,1):sr(Nie,1,0)}const Nie=Ue(),Fie=16;function uKe(){const t=new br,e=t.fragment;return t.include(Ph),e.include(hu),t.include(IF),e.uniforms.add(new Oe("radius",(r,i)=>IZ(i.camera))),e.code.add(b`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(b`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Tr("nearFar",(r,i)=>i.camera.nearFar),new Je("normalMap",r=>r.normalTexture),new Je("depthMap",r=>r.depthTexture),new Tr("zScale",(r,i)=>Lxe(i)),new Oe("projScale",r=>r.projScale),new Je("rnm",r=>r.noiseTexture),new Tr("rnmScale",(r,i)=>sr(Uie,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Oe("intensity",r=>r.intensity),new Tr("screenSize",(r,i)=>sr(Uie,i.camera.fullWidth,i.camera.fullHeight))),e.code.add(b`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${b.int(Fie)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${b.int(Fie)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function IZ(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Uie=Ue(),hKe=Object.freeze(Object.defineProperty({__proto__:null,build:uKe,getRadius:IZ},Symbol.toStringTag,{value:"Module"}));let Dxe=class Nxe extends Rr{initializeProgram(e){return new Er(e.rctx,Nxe.shader.get().build(),vr)}initializePipeline(){return Ot({colorWrite:Gt})}};Dxe.shader=new Sr(hKe,()=>ae(()=>import("./SSAO.glsl-06149c4b.js"),[]));let dKe=class extends Kr{constructor(){super(...arguments),this.projScale=1}},pKe=class extends dKe{constructor(){super(...arguments),this.intensity=1}},fKe=class extends Kr{},mKe=class extends fKe{constructor(){super(...arguments),this.blurSize=Ue()}};const _3=2;let Fxe=class{constructor(e,r,i,s){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new pKe,this._drawParameters=new mKe}dispose(){this.enabled=!1,this._quadVAO=Fe(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){var e,r;(e=this._ssaoFBO)==null||e.resize(0,0),(r=this._blurFBO)==null||r.resize(0,0)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){var e;return(e=this._ssaoFBO)==null?void 0:e.colorTexture}render(e,r,i,s){if(this._enableTime==null||i==null||s==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*gKe/IZ(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],f=h/_3,m=p/_3;this._ssaoFBO.resize(h,p),this._blurFBO.resize(f,m),this._quadVAO==null&&(this._quadVAO=Cl(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),n.bindVAO(this._quadVAO);const y=Io(this._quadVAO,"geometry");n.drawArrays(Et.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,e);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,sr(this._drawParameters.blurSize,0,_3/p),_.bindDraw(this._drawParameters,e,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(Et.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.setClearColor(1,1,1,0),n.clear(wi.COLOR_BUFFER_BIT),n.setViewport(0,0,f,m),this._drawParameters.colorTexture=this._blurFBO.colorTexture,sr(this._drawParameters.blurSize,_3/h,0),_.bindDraw(this._drawParameters,e,this._passParameters),n.drawArrays(Et.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new _r;e.wrapMode=Lt.CLAMP_TO_EDGE,this._ssaoFBO=new nn(this._rctx,e),this._blurFBO=new nn(this._rctx,e);const r=Uint8Array.from(atob(lKe),i=>i.charCodeAt(0));e.pixelFormat=St.RGB,e.wrapMode=Lt.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new Ct(this._rctx,e,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(Dxe)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire($xe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=Fe(this._passParameters.noiseTexture),this._blurFBO=Fe(this._blurFBO),this._ssaoFBO=Fe(this._ssaoFBO)}get gpuMemoryUsage(){var e,r;return(((e=this._blurFBO)==null?void 0:e.gpuMemoryUsage)??0)+(((r=this._ssaoFBO)==null?void 0:r.gpuMemoryUsage)??0)}};const gKe=.5;let LZ=class Uxe extends Rr{initializeProgram(e){return new Er(e.rctx,Uxe.shader.get().build(),vr)}initializePipeline(){return this.configuration.hasAlpha?Ot({blending:_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt}):Ot({colorWrite:Gt})}};LZ.shader=new Sr(LJe,()=>ae(()=>import("./TextureOnly.glsl-818f177f.js"),[]));let DZ=class extends ca{constructor(){super(...arguments),this.hasAlpha=!1}};u([F()],DZ.prototype,"hasAlpha",void 0);let Hp=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Pi,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Bt,this._passParameters=new Zwe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new lt,this.worldToPCSRatio=1,this.events=new Is,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:i,markerTextureRepository:s}=e;this._shaderTechniqueRepository=new Ywe({rctx:this._rctx,viewingMode:Ie.Local,stippleTextureRepository:i,markerTextureRepository:s,waterTextureRepository:r}),this._renderContext=new yxe(this._rctx,new AZ(this._rctx,this.view.state.viewingMode),new Fxe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ue(()=>r.updating,()=>this.events.emit("content-changed"),Cs),ue(()=>this.spatialReference,n=>this._localOriginFactory=new EZ(n),Cs),ka(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new Jwe(e.textureRepository,this._shaderTechniqueRepository,n=>{(n.renderOccluded&XN)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ce.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=j0e(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=st.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new tX(Ae(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(dt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=ki(this._debugTextureTechnique),this._passParameters.texture=Fe(this._passParameters.texture),this._bindParameters.highlightDepthTexture=Fe(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Pe(this._shaderTechniqueRepository),this._temporaryFBO=Fe(this._temporaryFBO),this._quadVAO=Fe(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||$o(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Uc)}createDrapeSourceRenderer(e,r,i){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ue(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const r=MOe();if(this._overlayRenderTarget!=null)for(const i of this._overlayRenderTarget.renderTargets){const s=this.overlays[$i.INNER].validTargets[i.type];e=this._overlayRenderTarget.validateUsageForTarget(s,i,r)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=hI(e,i=>i.drapeTargetType===z7.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=hI(e,i=>i.drapeSourceType===PA.Features),r.hasDrapedRasterSource=hI(e,i=>i.drapeSourceType===PA.RasterImage)})}ensureOverlays(e,r){this._overlays==null&&(this._overlayRenderTarget=new MJe(this._rctx),this._overlays=[new yre($i.INNER,this._overlayRenderTarget),new yre($i.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Fe(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||r(s))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Fa,e=>e.updatePolicy===n_.SYNC)}get isEmpty(){return!ni.OVERLAY_DRAW_DEBUG_TEXTURE&&!$o(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const s=e.canvasGeometries;if(s.numViews===0)return!1;const{alignPixelEnabled:n,contentPixelRatio:o}=i;this._screenToWorldRatio=o*e.mapUnitsPerPixel/GX;const a=r.output;if(this.isEmpty||a===L.Highlight&&!this.hasHighlights||a===L.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=r.fbo;if(!l.isValid())return!1;const c=2*e.resolution,h=e.resolution;l.resize(c,h);const p=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===L.Normal?ce.DRAPED_WATER:ce.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(p),e.index===$i.INNER&&(p.setClearColor(0,0,0,0),p.clearSafe(wi.COLOR_BUFFER_BIT)),r.type===is.Occluded&&(this._renderContext.renderOccludedMask=XN),ni.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==is.Occluded)for(let f=0;f<s.numViews;f++)this._setViewParameters(s.extents[f],e),this._drawDebugTexture(e.resolution,_Ke[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:f,renderer:m})=>{if(r.type===is.ColorNoRasterImage&&f.drapeSourceType===PA.RasterImage)return;const{fullOpacity:y}=f,_=y!=null&&y<1&&a===L.Color;_&&(this.bindTemporaryFramebuffer(this._rctx,c,h),p.clearSafe(wi.COLOR_BUFFER_BIT));for(let v=0;v<s.numViews;v++)this._setViewParameters(s.extents[v],e),m.render(this._renderContext);_&&this._temporaryFBO!=null&&(l.bind(p),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),y,e.index))}),p.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){this._temporaryFBO==null&&(this._temporaryFBO=new Xwe(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,s){var o;let n=0;for(const a of this._renderers.values())n=((o=a.intersect)==null?void 0:o.call(a,e,r,i,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),n=s>=0,o=this._renderers.size*(i.renderGroup??(n?GN.MapLayer:GN.ViewLayer))+(n?s:0);this._sortedRenderers.push(new yKe(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],kme(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),yR(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=$o(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=$o(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=$o(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(Et.TRIANGLE_STRIP,0,Io(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r){if(se(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(a/10);c<2||h<2||10*c>e-20||10*h>e-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&c&&1&h?1&l^1&a?0:255:1&c^1&h?0:128)}const n=new _r(e);n.samplingMode=At.NEAREST,this._passParameters.texture=new Ct(this._rctx,n,i);const o=new DZ;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(LZ,o),this._quadVAO=Cl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],Hp.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],Hp.prototype,"_shaderTechniqueRepository",void 0),u([d({constructOnly:!0})],Hp.prototype,"view",void 0),u([d()],Hp.prototype,"worldToPCSRatio",void 0),u([d()],Hp.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Hp.prototype,"updating",null),u([d()],Hp.prototype,"isEmpty",null),Hp=u([R("esri.views.3d.terrain.OverlayRenderer")],Hp);let yKe=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const _Ke=[[1,.5,.5],[.5,.5,1]],NZ=-2,XN=Ii.OccludeAndTransparent;function FZ(t,e,r,i){const s=VR(t.rings,!!t.hasZ,Vf.CCW_IS_HOLE),n=Uo(s.position.length),o=Ybe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,r,i),a=o!=null;return new wKe(s.position,n,kxe(s.polygons,s.position,n),zxe(s.outlines,s.position,n),a,o)}function Vxe(t,e){const r=VR(t.rings,!1,Vf.CCW_IS_HOLE),i=oi(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=NZ;return{position:r.position,polygons:kxe(r.polygons,r.position),outlines:zxe(r.outlines,r.position),projectionSuccess:i}}function zxe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return r!=null?new Bxe(i,s,hh(e,n,o),hh(r,n,o)):new UZ(i,s,hh(e,n,o))})}function kxe(t,e,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),p=r!=null?new vKe(s,n,hh(e,3*s,3*n),hh(r,l,c),h,a):new bKe(s,n,hh(e,3*s,3*n),h,a);i.push(p)}return i}let UZ=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},Bxe=class extends UZ{constructor(e,r,i,s){super(e,r,i),this.mapPositions=s}},vKe=class extends Bxe{constructor(e,r,i,s,n,o){super(e,r,i,s),this.holeIndices=n,this.pathLengths=o}},bKe=class extends UZ{constructor(e,r,i,s,n){super(e,r,i),this.holeIndices=s,this.pathLengths=n}},wKe=class{constructor(e,r,i,s,n,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function Yb(t,e,r,i,s,n=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),a=r*o,l=i*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,h=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,p=e*n;t[p]=Vie(c),t[p+1]=Vie(h)}function xKe(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let s=0;s<e;++s)Yb(r,s,t[i++],t[i++],t[i++]);return r}function TKe(t,e,r,i=2){const s=r*i,n=zie(e[s]),o=zie(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),ge(t,t)}function Vie(t){return ye(Math.round(32767*t),-32767,32767)}function zie(t){return ye(t/32767,-1,1)}function Gxe(t,e){const r=t.fragment;switch(r.code.add(b`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Qi.None:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Qi.View:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Qi.WindingOrder:r.code.add(b`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Qi.COUNT:}}var Qi;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Qi||(Qi={}));function jxe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||ia(n,za))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const LF=[1,1,.5],VZ=[0,.6,.2],SKe=[0,1,.2];function Hxe(t){t.vertex.code.add(b`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let EKe=class extends ca{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function qxe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(E.MODELORIGINHI,"vec3"),t.attributes.add(E.MODELORIGINLO,"vec3"),t.attributes.add(E.MODEL,"mat3"),t.attributes.add(E.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(fN,e),r.uniforms.add(new iu("viewOriginHi",(i,s)=>rBe(se(GM,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),GM)),new iu("viewOriginLo",(i,s)=>iBe(se(GM,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),GM)))),r.code.add(b`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(b`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?b`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(b`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===L.Normal&&(uS(r),r.code.add(b`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(b`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([F()],EKe.prototype,"instancedDoublePrecision",void 0);const GM=C();var Fs;function Wxe(t){switch(t){case"multiply":default:return Fs.Multiply;case"ignore":return Fs.Ignore;case"replace":return Fs.Replace;case"tint":return Fs.Tint}}function Xxe(t,e,r){if(t==null||e===Fs.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=ye(Math.round(t[3]*ZN),0,ZN),s=i===0||e===Fs.Tint?0:e===Fs.Replace?CKe:AKe;r[0]=ye(Math.round(t[0]*tx),0,tx),r[1]=ye(Math.round(t[1]*tx),0,tx),r[2]=ye(Math.round(t[2]*tx),0,tx),r[3]=i+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Fs||(Fs={}));const tx=255,ZN=85,CKe=ZN,AKe=2*ZN;function Zxe(t){t.vertex.code.add(b`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.int(Fs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.int(Fs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.int(Fs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.int(Fs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function Yxe(t,e){e.hasSymbolColors?(t.include(Zxe),t.attributes.add(E.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(b`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new kR("colorMixMode",r=>k1e[r.colorMixMode])),t.vertex.code.add(b`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Ew(t,e){e.hasVertexColors?(t.attributes.add(E.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(b`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(b`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(b`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function OKe(t){t.fragment.code.add(b`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.float(co)}) { discard; } }
  `)}let _b=class extends ls{constructor(e,r){super(e,"float",Jr.Draw,(i,s,n)=>i.setUniform1f(e,r(s,n)))}};function vb(t,e){Jxe(t,e,new Oe("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function RKe(t,e){Jxe(t,e,new _b("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Jxe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Xr.Mask&&e.alphaDiscardMode!==Xr.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Xr.Blend:return t.include(OKe);case Xr.Opaque:i.code.add(b`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Xr.Mask:i.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Xr.MaskBlend:t.fragment.code.add(b`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function Qxe(t,e){const{vertex:r,fragment:i}=t,s=e.hasModelTransformation;if(s){const o=Ni();r.uniforms.add(new Di("model",a=>a.modelTransformation??sn)),r.uniforms.add(new Mh("normalTransform",a=>(b_(o,a.modelTransformation??sn),o)))}const n=e.hasColorTexture&&e.alphaDiscardMode!==Xr.Opaque;switch(e.output){case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:case L.ObjectAndLayerIdColor:fc(r,e),t.include(vl,e),t.include(Tf,e),t.include(pg,e),t.include(Dg,e),t.include(fs,e),t.include(IR,e),Bb(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new Je("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(vb,e),i.code.add(b`
          void main(void) {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:b`outputDepth(depth);`}
          }
        `);break;case L.Normal:{fc(r,e),t.include(vl,e),t.include(zR,e),t.include(MF,e),t.include(Tf,e),t.include(pg,e),n&&i.uniforms.add(new Je("tex",a=>a.texture)),e.normalType===Ar.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===Ar.Attribute||e.normalType===Ar.Compressed;r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?b`vNormalWorld = ${s?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:b`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(fs,e),t.include(vb,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Ar.ScreenDerivative?b`vec3 normal = screenDerivativeNormal(vPositionView);`:b`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case L.Highlight:fc(r,e),t.include(vl,e),t.include(Tf,e),t.include(pg,e),n&&i.uniforms.add(new Je("tex",o=>o.texture)),r.code.add(b`
          void main(void) {
            vpos = calculateVPos();
            ${s?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(fs,e),t.include(vb,e),t.include(Xg,e),i.code.add(b`
          void main() {
            discardBySlice(vpos);
            ${n?b`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function Kxe(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(E.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Qi.WindingOrder?r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(b`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(b`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Rs.None&&(t.include(jW,e),r.uniforms.add(e.pbrTextureBindType===Jr.Pass?new Je("normalTexture",i=>i.textureNormal):new uh("normalTexture",i=>i.textureNormal)),r.code.add(b`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function BR(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new Je("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/_3),r.code.add(b`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(b`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function GR(t){t.constants.add("ambientBoostFactor","float",w_e)}function iE(t){t.uniforms.add(new Oe("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function Jb(t,e){const r=t.fragment;switch(t.include(BR,e),e.pbrMode!==rt.Disabled&&t.include(PZ,e),t.include(WW,e),t.include(xR),r.code.add(b`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===rt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),GR(r),iE(r),zg(r),r.code.add(b`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?b`normalize(vPosWorld)`:b`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Yf(r),r.code.add(b`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case rt.Disabled:case rt.WaterOnIntegratedMesh:case rt.Water:t.include(oN),r.code.add(b`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case rt.Normal:case rt.Schematic:r.code.add(b`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(b`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new Sf("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(b`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Oe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Oe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)),r.code.add(b`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(b`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===rt.Schematic?b`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:b`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case rt.Terrain:case rt.TerrainWithWater:t.include(oN),r.code.add(b`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case rt.COUNT:}}function xl(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function eTe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function _L(t,e,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function PKe(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:eTe,create:xl,createView:PKe,fromValues:_L},Symbol.toStringTag,{value:"Module"}));function MKe(t){t.vertex.uniforms.add(new Mh("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:xl())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(b`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function $Ke(t){t.vertex.uniforms.add(new Mh("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:xl())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(b`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function IKe(t){t.vertex.uniforms.add(new Mh("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:xl())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(b`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function LKe(t){t.vertex.uniforms.add(new Mh("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:xl())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(b`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function DKe(t){t.vertex.uniforms.add(new Mh("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:xl())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(b`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function UO(t){t.include(Jf),t.code.add(b`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${b.int(Fs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${b.int(Fs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Fs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${b.int(Fs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${b.int(Fs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function NKe(t){const e=new br,{vertex:r,fragment:i,varyings:s}=e;if(fc(r,t),e.include(TR),s.add("vpos","vec3"),e.include(pg,t),e.include(qxe,t),e.include($1e,t),t.hasColorTextureTransform&&e.include(MKe),t.output===L.Color||t.output===L.Alpha){t.hasNormalTextureTransform&&e.include($Ke),t.hasEmissionTextureTransform&&e.include(IKe),t.hasOcclusionTextureTransform&&e.include(LKe),t.hasMetallicRoughnessTextureTransform&&e.include(DKe),sp(r,t),e.include(zR,t),e.include(vl,t);const n=t.normalType===Ar.Attribute||t.normalType===Ar.Compressed;n&&t.offsetBackfaces&&e.include(Hxe),e.include(Kxe,t),e.include(MF,t),t.instancedColor&&e.attributes.add(E.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Tf,t),e.include(XS,t),e.include(Yxe,t),e.include(Ew,t),r.uniforms.add(new rr("externalColor",a=>a.externalColor)),s.add("vcolorExt","vec4"),t.hasMultipassTerrain&&s.add("depth","float");const o=t.hasModelTransformation;if(o){const a=Ni();r.uniforms.add(new Di("model",l=>l.modelTransformation??sn)),r.uniforms.add(new Mh("normalTransform",l=>(b_(a,l.modelTransformation??sn),a)))}r.code.add(b`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${b.float(co)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?b`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?b`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?b`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?b`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?b`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?b`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case L.Alpha:e.include(fs,t),e.include(vb,t),e.include(du,t),i.uniforms.add(new Oe("opacity",n=>n.opacity),new Oe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),i.include(UO),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case L.Color:e.include(fs,t),e.include(Jb,t),e.include(BR,t),e.include(vb,t),e.include(t.instancedDoublePrecision?$F:Zb,t),e.include(du,t),sp(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new Vt("ambient",n=>n.ambient),new Vt("diffuse",n=>n.diffuse),new Oe("opacity",n=>n.opacity),new Oe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),e.include(qW,t),e.include(PZ,t),i.include(UO),e.include(Gxe,t),GR(i),iE(i),Yf(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Ar.ScreenDerivative?b`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:b`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===rt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?b`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?b`normalUV`:"vuv0"});`:b`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?b`normalize(posWorld);`:b`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?b`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===rt.Normal||t.pbrMode===rt.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===st.Color?b`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(Qxe,t),e}const FKe=Object.freeze(Object.defineProperty({__proto__:null,build:NKe},Symbol.toStringTag,{value:"Module"}));let UKe=class extends wxe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ia(LF),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=mi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ae(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Ar.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ae(.2,.2,.2),this.diffuse=Ae(.8,.8,.8),this.externalColor=Nt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Vb.Less,this.textureAlphaMode=Xr.Blend,this.textureAlphaCutoff=VN,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ii.Occlude}},VKe=class extends xxe{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}},zZ=class tTe extends Rr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ie.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Rs.Default:Rs.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,tTe.shader)}_initializeProgram(e,r){return new Er(e.rctx,r.get().build(this.configuration),vr)}_convertDepthTestFunction(e){return e===Vb.Lequal?Qr.LEQUAL:Qr.LESS}_makePipeline(e,r){const i=this.configuration,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:i.output!==L.Color&&i.output!==L.Alpha||!i.transparent?null:s?su:Zg(e),culling:zKe(i)?B5(i.cullFace):null,depthTest:{func:V_(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?El:null,colorWrite:Gt,stencilWrite:i.hasOccludees?zf:null,stencilTest:i.hasOccludees?r?P_:z_:null,polygonOffset:s||n?null:vF(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function zKe(t){return t.cullFace!==mi.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}zZ.shader=new Sr(FKe,()=>ae(()=>import("./DefaultMaterial.glsl-775a3f62.js"),[]));let Ht=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.alphaDiscardMode=Xr.Opaque,this.doubleSidedMode=Qi.None,this.pbrMode=rt.Disabled,this.cullFace=mi.None,this.transparencyPassType=st.NONE,this.normalType=Ar.Attribute,this.textureCoordinateType=Rs.None,this.customDepthTest=Vb.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};u([F({count:L.COUNT})],Ht.prototype,"output",void 0),u([F({count:Xr.COUNT})],Ht.prototype,"alphaDiscardMode",void 0),u([F({count:Qi.COUNT})],Ht.prototype,"doubleSidedMode",void 0),u([F({count:rt.COUNT})],Ht.prototype,"pbrMode",void 0),u([F({count:mi.COUNT})],Ht.prototype,"cullFace",void 0),u([F({count:st.COUNT})],Ht.prototype,"transparencyPassType",void 0),u([F({count:Ar.COUNT})],Ht.prototype,"normalType",void 0),u([F({count:Rs.COUNT})],Ht.prototype,"textureCoordinateType",void 0),u([F({count:Vb.COUNT})],Ht.prototype,"customDepthTest",void 0),u([F()],Ht.prototype,"spherical",void 0),u([F()],Ht.prototype,"hasVertexColors",void 0),u([F()],Ht.prototype,"hasSymbolColors",void 0),u([F()],Ht.prototype,"hasVerticalOffset",void 0),u([F()],Ht.prototype,"hasSlicePlane",void 0),u([F()],Ht.prototype,"hasSliceHighlight",void 0),u([F()],Ht.prototype,"hasColorTexture",void 0),u([F()],Ht.prototype,"hasMetallicRoughnessTexture",void 0),u([F()],Ht.prototype,"hasEmissionTexture",void 0),u([F()],Ht.prototype,"hasOcclusionTexture",void 0),u([F()],Ht.prototype,"hasNormalTexture",void 0),u([F()],Ht.prototype,"hasScreenSizePerspective",void 0),u([F()],Ht.prototype,"hasVertexTangents",void 0),u([F()],Ht.prototype,"hasOccludees",void 0),u([F()],Ht.prototype,"hasMultipassTerrain",void 0),u([F()],Ht.prototype,"hasModelTransformation",void 0),u([F()],Ht.prototype,"offsetBackfaces",void 0),u([F()],Ht.prototype,"vvSize",void 0),u([F()],Ht.prototype,"vvColor",void 0),u([F()],Ht.prototype,"receiveShadows",void 0),u([F()],Ht.prototype,"receiveAmbientOcclusion",void 0),u([F()],Ht.prototype,"textureAlphaPremultiplied",void 0),u([F()],Ht.prototype,"instanced",void 0),u([F()],Ht.prototype,"instancedColor",void 0),u([F()],Ht.prototype,"objectAndLayerIdColorInstanced",void 0),u([F()],Ht.prototype,"instancedDoublePrecision",void 0),u([F()],Ht.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],Ht.prototype,"writeDepth",void 0),u([F()],Ht.prototype,"transparent",void 0),u([F()],Ht.prototype,"enableOffset",void 0),u([F()],Ht.prototype,"cullAboveGround",void 0),u([F()],Ht.prototype,"snowCover",void 0),u([F()],Ht.prototype,"hasColorTextureTransform",void 0),u([F()],Ht.prototype,"hasEmissionTextureTransform",void 0),u([F()],Ht.prototype,"hasNormalTextureTransform",void 0),u([F()],Ht.prototype,"hasOcclusionTextureTransform",void 0),u([F()],Ht.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([F({constValue:!0})],Ht.prototype,"hasVvInstancing",void 0),u([F({constValue:!1})],Ht.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!1})],Ht.prototype,"supportsTextureAtlas",void 0),u([F({constValue:!0})],Ht.prototype,"useFillLights",void 0);function kKe(t){const e=new br,{vertex:r,fragment:i,varyings:s}=e;return fc(r,t),e.include(TR),s.add("vpos","vec3"),e.include(pg,t),e.include(qxe,t),e.include($1e,t),t.output!==L.Color&&t.output!==L.Alpha||(sp(e.vertex,t),e.include(zR,t),e.include(vl,t),t.offsetBackfaces&&e.include(Hxe),t.instancedColor&&e.attributes.add(E.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.hasMultipassTerrain&&s.add("depth","float"),e.include(Tf,t),e.include(XS,t),e.include(Yxe,t),e.include(Ew,t),r.uniforms.add(new rr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(b`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${b.float(co)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?b`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===L.Alpha&&(e.include(fs,t),e.include(vb,t),e.include(du,t),i.uniforms.add(new Oe("opacity",n=>n.opacity),new Oe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),i.include(UO),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?b`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===L.Color&&(e.include(fs,t),e.include(Jb,t),e.include(BR,t),e.include(vb,t),e.include(t.instancedDoublePrecision?$F:Zb,t),e.include(du,t),sp(e.fragment,t),zg(i),GR(i),iE(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Vt("ambient",n=>n.ambient),new Vt("diffuse",n=>n.diffuse),new Oe("opacity",n=>n.opacity),new Oe("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Je("tex",n=>n.texture)),e.include(qW,t),e.include(PZ,t),i.include(UO),Yf(i),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?b`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?b`colorUV`:b`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:b`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===rt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?b`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:b`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?b`albedo = mix(albedo, vec3(1), 0.9);`:b``}
        ${b`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===rt.Normal||t.pbrMode===rt.Schematic?t.spherical?b`vec3 normalGround = normalize(vpos + localOrigin);`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:b``}
        ${t.pbrMode===rt.Normal||t.pbrMode===rt.Schematic?b`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?b`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:b`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===st.Color?b`fragColor = premultiplyAlpha(fragColor);`:b``}
      }
    `)),e.include(Qxe,t),e}const BKe=Object.freeze(Object.defineProperty({__proto__:null,build:kKe},Symbol.toStringTag,{value:"Module"}));let rTe=class iTe extends zZ{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Ar.Attribute,r.doubleSidedMode=Qi.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,iTe.shader)}};rTe.shader=new Sr(BKe,()=>ae(()=>import("./RealisticTree.glsl-c4dbd6ef.js"),[]));let kf=class extends U_{constructor(e){super(e,HKe),this.supportsEdges=!0,this._configuration=new Ht,this._vertexBufferLayout=qKe(this.parameters)}isVisibleForOutput(e){return e!==L.Shadow&&e!==L.ShadowExcludeHighlight&&e!==L.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||n||s;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?mi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==L.Color&&e!==L.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Qi.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Qi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Qi.WindingOrder:Qi.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?rt.Schematic:rt.Normal:rt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<yF,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,s,n,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(E8,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Ie.Global:l=ge(kie,E8);break;case Ie.Local:l=re(kie,ZKe)}let c=0;const h=he(YKe,E8,a.eye),p=Ee(h),f=ie(h,h,1/p);let m=null;this.parameters.screenSizePerspective&&(m=me(l,f)),c+=V1e(a,p,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),ie(l,l,c),ac(S8,l,i.transform.inverseRotation),s=he(WKe,s,S8),n=he(XKe,n,S8)}D1e(e,i,s,n,l7(i.verticalOffset),o)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Depth||r===L.Normal||r===L.Shadow||r===L.ShadowHighlight||r===L.ShadowExcludeHighlight||r===L.Highlight||r===L.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ce.OPAQUE_MATERIAL)||e===ce.DRAPED_MATERIAL:!1}createGLMaterial(e){return new GKe(e)}createBufferWriter(){return new rE(this._vertexBufferLayout)}},GKe=class extends HW{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==L.Color&&this._output!==L.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?rTe:zZ,e)}},jKe=class extends UKe{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const HKe=new jKe;function qKe(t){const e=ji().vec3f(E.POSITION);return t.normalType===Ar.Compressed?e.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(E.NORMAL),t.hasVertexTangents&&e.vec4f(E.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(E.UV0),t.hasVertexColors&&e.vec4u8(E.COLOR),t.hasSymbolColors&&e.vec4u8(E.SYMBOLCOLOR),oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),e}const WKe=C(),XKe=C(),ZKe=Ae(0,0,1),kie=C(),S8=C(),E8=C(),YKe=C(),JKe=["polygon","extent"];let QKe=class extends Kf{constructor(e,r,i,s){super(e,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=TF(this._getSymbolSize());if(c)throw new U("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=Ia(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?mi.None:mi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ar.Compressed};this._material=new kf(o),this._bottomMaterial=new kf({...o,cullFace:mi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,JKe,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new cp);return this._createAs3DShape(r,e.renderingInfo,i,s,r.uid)}layerOpacityChanged(e,r){var a,l;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(c=>{const h=r(c);h!=null&&h.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,A_)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const s=r(i);s!=null&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?SJe(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Ps.RecreateSymbol:Ps.RecreateGraphics}async queryForSnapping(e,r,i,s){const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/sO(r),{objectId:o,target:a}=e,l=Q(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,p=Q(c),f=Q(h);return p.z=(p.z??0)+n,f.z=(f.z??0)+n,[sie(o,l,1/0,p,f)]}case"vertex":return[uJe(o,l,1/0),sie(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,s,n){const o=NO(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(I=>I.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=FZ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=oZ(o);if(l==null)return null;const c=new Array,h=new Array,p=an(),f=ve(),m=C(),y=this._context.renderCoordsHelper.viewingMode===Ie.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,m),bl(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const _=ve();bn(_,f);const v=Ni();b_(v,_);const{polygons:w,mapPositions:T,position:x}=a;for(const I of w){const V=I.count;if(this._context.clippingExtent&&(xi(p),Kc(p,I.mapPositions),!Nd(p,this._context.clippingExtent)))continue;const k=yS(I.mapPositions,I.holeIndices,3);if(k.length===0)continue;const B=k.length,z=6*V,Z=yN(z+B),W=yN(B),H=Uo(3*z),Y=Uo(3*z),M=Uo(3*z),D=Uo(z);KKe(x,T,k,I,H,M,Y,D,Z,W,this._getExtrusionSize(r),m,y),_S(H,H,_);const N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),G=new set(H,M,xKe(Y),D);c.push(Bie(this._material,Z,Z.length-W.length,G,i,N),Bie(this._bottomMaterial,W,0,G,i,N)),h.push(G.heights)}if(c.length===0)return null;const S=new Yg({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});S.transformation=f;const O=uwe(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=O!=null?{baseMaterial:this._material,edgeMaterials:[O],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,P=new Qf(this,S,c,null,null,(I,V,k,B,z)=>ret(I,V,k,B,z,h),s,A);return P.alignedSampledElevation=a.sampledElevation,P.needsElevationUpdates=A_(s.mode),P}};function Bie(t,e,r,i,s,n){const o=ZS(e.length),a=[[E.POSITION,new Ve(i.positions,3,!0)],[E.NORMALCOMPRESSED,new Ve(i.normals,2,!0)],[E.COLOR,new Ve(s,4,!0)]],l=[[E.POSITION,e],[E.NORMALCOMPRESSED,e],[E.COLOR,o]];return new js(t,a,l,i.elevation,os.Mesh,n,r)}function KKe(t,e,r,i,s,n,o,a,l,c,h,p,f){const m=r.length/3;let y=0,_=2*i.count;eet(t,e,i.index,i.count,r,0,m,s,n,o,a,l,c,_,h,p,f);let v=2*i.count;_=0,Gie(s,n,a,o,y,i.pathLengths[0],i.count,v,l,_,h),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let w=1;w<i.pathLengths.length;++w)Gie(s,n,a,o,y,i.pathLengths[w],i.count,v,l,_,h),v+=4*i.pathLengths[w],_+=2*i.pathLengths[w],y+=i.pathLengths[w]}function eet(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_,v){re(tl,_);const w=y>0?1:-1;let T=3*r,x=0,S=3*x,O=i,A=3*O;for(let V=0;V<i;++V)v&&(tl[0]=t[T],tl[1]=t[T+1],tl[2]=t[T+2],ge(tl,tl)),a[S]=t[T],a[S+1]=t[T+1],a[S+2]=t[T+2],l[S]=e[T],l[S+1]=e[T+1],l[S+2]=e[T+2],c[S]=-w*tl[0],c[S+1]=-w*tl[1],c[S+2]=-w*tl[2],h[x]=0,a[A]=t[T]+y*tl[0],a[A+1]=t[T+1]+y*tl[1],a[A+2]=t[T+2]+y*tl[2],l[A]=e[T],l[A+1]=e[T+1],l[A+2]=e[T+2],c[A]=w*tl[0],c[A+1]=w*tl[1],c[A+2]=w*tl[2],h[O]=y,S+=3,A+=3,T+=3,x+=1,O+=1;T=3*n,S=0,A=3*m;const P=y<0?Zie:Xie,I=y<0?Xie:Zie;for(let V=0;V<o;++V)f[S]=s[T+P[0]],f[S+1]=s[T+P[1]],f[S+2]=s[T+P[2]],p[A]=s[T+I[0]]+i,p[A+1]=s[T+I[1]]+i,p[A+2]=s[T+I[2]]+i,S+=3,A+=3,T+=3}function jM(t,e,r,i,s,n,o){i[n]=i[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],r[n]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const jE=C();function Gie(t,e,r,i,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,_=a,v=a+1,w=a+2*n,T=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let x=0;x<n;++x)x===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),tet(t,p,f,m,jE),jM(t,e,i,r,jE,_,p),jM(t,e,i,r,jE,v,f),jM(t,e,i,r,jE,w,m),jM(t,e,i,r,jE,T,y),l[c++]=_,l[c++]=w,l[c++]=T,l[c++]=_,l[c++]=T,l[c++]=v,p++,f++,m++,y++,_+=2,v+=2,w+=2,T+=2}const C8=C(),jie=C(),Hie=C(),qie=C(),Wie=C();function tet(t,e,r,i,s){e*=3,r*=3,i*=3,se(C8,t[e++],t[e++],t[e++]),se(jie,t[r++],t[r++],t[r++]),se(Hie,t[i++],t[i++],t[i++]),he(qie,jie,C8),he(Wie,Hie,C8),ot(s,Wie,qie),ge(s,s)}const rx=C();function ret(t,e,r,i,s,n){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let h=0;const p=o.transformation,f=GS(ve(),p);for(let m=0;m<l;m+=2){const y=a[m];if(!lZ(y))continue;const _=y.getMutableAttribute(E.POSITION).data,v=n[m/2],w=new DX(y.mapPositions),T=_.length/3;let x=0,S=!1,O=0;for(let A=0;A<T;A++){rx[0]=_[x],rx[1]=_[x+1],rx[2]=_[x+2],i(w,HM),c&&(O+=HM.sampledElevation),ni.TESTS_DISABLE_OPTIMIZATIONS?(se(Ml,w.array[w.offset],w.array[w.offset+1],HM.z+v[x/3]),r!=null&&s.toRenderCoords(Ml,r,Ml),$e(Ml,Ml,f)):(se(Ml,_[x],_[x+1],_[x+2]),$e(Ml,Ml,p),s.setAltitude(Ml,HM.z+v[x/3]),$e(Ml,Ml,f)),_[x]=Ml[0],_[x+1]=Ml[1],_[x+2]=Ml[2];const P=iet/s.unitInMeters;(Math.abs(rx[0]-_[x])>=P||Math.abs(rx[1]-_[x+1])>=P||Math.abs(rx[2]-_[x+2])>=P)&&(S=!0),w.offset+=3,x+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m]),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m+1])),h+=O/T}return h/l}const Ml=C(),tl=C(),HM=new FR,Xie=[0,2,1],Zie=[0,1,2],iet=.01;let set=class{constructor(e,r,i,s){this.positions=e,this.elevation=r,this.normals=i,this.heights=s}};function DF(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function net(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function oet(t,e,r,i,s,n,o,a,l,c,h,p,f,m,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=p,v[12]=f,v[13]=m,v[14]=y,v[15]=_,v}function aet(t,e){return new Float32Array(t,e,16)}const cet=DF();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:cet,clone:net,create:DF,createView:aet,fromValues:oet},Symbol.toStringTag,{value:"Module"}));const uet=(t,e)=>{const r=Xf(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return _c(r,r)},het=(t,e)=>{const r=Xf(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return _c(r,r)},det=(t,e)=>{const r=1-e,i=Xf(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return _c(i,i)},pet=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),s=Xf(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return _c(s,s)},fet=(t,e)=>{const r=1-2*e,i=Xf(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return _c(i,i)},met=(t,e)=>{const r=Xf(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return _c(r,r)},get=(t,e)=>{const r=1-e,i=Xf(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return _c(i,i)};let sTe=class nTe{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=ec(e.strength,r.strength,i),this.radius=ec(e.radius,r.radius,i),this.threshold=ec(e.threshold,r.threshold,i)}clone(){return new nTe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:MA(this.radius),strength:this.strength,threshold:this.threshold}}},oTe=class aTe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(ec(e.radius,r.radius,i))}clone(){return new aTe(this.radius)}toJSON(){return{type:"blur",radius:MA(this.radius)}}},H7=class lTe{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=ec(e.amount,r.amount,i),this._updateMatrix()}clone(){return new lTe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||DF();switch(this.type){case"brightness":this._colorMatrix=uet(e,this.amount);break;case"contrast":this._colorMatrix=het(e,this.amount);break;case"grayscale":this._colorMatrix=det(e,this.amount);break;case"invert":this._colorMatrix=fet(e,this.amount);break;case"saturate":this._colorMatrix=met(e,this.amount);break;case"sepia":this._colorMatrix=get(e,this.amount)}}},cTe=class uTe{constructor(e,r,i,s){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=ec(e.offsetX,r.offsetX,i),this.offsetY=ec(e.offsetY,r.offsetY,i),this.blurRadius=ec(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(ec(e.color[0],r.color[0],i)),this.color[1]=Math.round(ec(e.color[1],r.color[1],i)),this.color[2]=Math.round(ec(e.color[2],r.color[2],i)),this.color[3]=ec(e.color[3],r.color[3],i)}clone(){return new uTe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:MA(this.offsetX),yoffset:MA(this.offsetY),blurRadius:MA(this.blurRadius),color:e}}},hTe=class dTe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=ec(e.angle,r.angle,i),this._updateMatrix()}clone(){return new dTe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||DF();this._colorMatrix=pet(e,this.angle)}},pTe=class fTe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=ec(e.amount,r.amount,i)}clone(){return new fTe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function ec(t,e,r){return t+(e-t)*r}function MA(t){return Math.round(1e3*yh(t))/1e3}function yet(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new H7(t.type,0);case"saturate":case"brightness":case"contrast":return new H7(t.type,1);case"opacity":return new pTe(1);case"hue-rotate":return new hTe(0);case"blur":return new oTe(0);case"drop-shadow":return new cTe(0,0,0,[...oq("transparent")]);case"bloom":return new sTe(0,0,1)}}function _et(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,s)=>i.type===r[s].type)}function vet(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let s=i.length;s<r.length;s++)i.push(yet(r[s]))}function bet(t){const e=t[0];return!!e&&"type"in e}var Yie,Jie,q7={exports:{}};q7.exports,Jie=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:tm},h=tm,p="none",f=")",m=",",y="(",_="%",v="px",w="cm",T="mm",x="in",S="pt",O="pc",A="deg",P="rad",I="grad",V="turn",k="#",B=".",z="e",Z=/^[ \t\n\r]/,W=/^[a-z\-]/,H=/^[0-9a-fA-F]/,Y=/^[+\-]/,M=/^[0-9]/,D=Xa("none"),N=En("none",!1),G=En(")",!1),X=En(",",!1),K=Xa("whitespace"),ee=G_([" ","	",`
`,"\r"],!1,!1),_e=Xa("function"),Le=En("(",!1),_t=Xa("identifier"),Rt=G_([["a","z"],"-"],!1,!1),at=Xa("percentage"),vt=En("%",!1),ze=Xa("length"),fe=En("px",!1),Tt=En("cm",!1),bt=En("mm",!1),Ce=En("in",!1),Be=En("pt",!1),je=En("pc",!1),ft=Xa("angle"),ct=En("deg",!1),hr=En("rad",!1),He=En("grad",!1),mt=En("turn",!1),dr=Xa("number"),nt=Xa("color"),ut=En("#",!1),gt=G_([["0","9"],["a","f"],["A","F"]],!1,!1),Dt=G_(["+","-"],!1,!1),jt=G_([["0","9"]],!1,!1),Ti=En(".",!1),jr=En("e",!1),gi=function(){return[]},kt=function(j,pe){return{type:"function",name:j,parameters:pe||[]}},ai=function(j,pe){return pe.length>0?cE(j,pe,3):[j]},Ur=function(j){return{type:"quantity",value:j.value,unit:j.unit}},ei=function(j){return{type:"color",colorType:j.type,value:j.value}},Pr=function(j){return j},Si=function(){return Al()},zr=function(j){return{value:j,unit:"%"}},li=function(j){return{value:j,unit:"px"}},ti=function(j){return{value:j,unit:"cm"}},pr=function(j){return{value:j,unit:"mm"}},ci=function(j){return{value:j,unit:"in"}},Fi=function(j){return{value:j,unit:"pt"}},Hn=function(j){return{value:j,unit:"pc"}},qn=function(j){return{value:j,unit:"deg"}},Wn=function(j){return{value:j,unit:"rad"}},Xn=function(j){return{value:j,unit:"grad"}},Hi=function(j){return{value:j,unit:"turn"}},Ui=function(j){return{value:j,unit:null}},Hr=function(){return{type:"hex",value:Al()}},Tn=function(j){return{type:"function",value:j}},bo=function(){return{type:"named",value:Al()}},ua=function(){return parseFloat(Al())},ne=0,Ei=0,Lh=[{line:1,column:1}],Sn=0,Dh=[],Qe=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function Al(){return s.substring(Ei,ne)}function En(j,pe){return{type:"literal",text:j,ignoreCase:pe}}function G_(j,pe,Te){return{type:"class",parts:j,inverted:pe,ignoreCase:Te}}function j_(){return{type:"end"}}function Xa(j){return{type:"other",description:j}}function em(j){var pe,Te=Lh[j];if(Te)return Te;for(pe=j-1;!Lh[pe];)pe--;for(Te={line:(Te=Lh[pe]).line,column:Te.column};pe<j;)s.charCodeAt(pe)===10?(Te.line++,Te.column=1):Te.column++,pe++;return Lh[j]=Te,Te}function H_(j,pe,Te){var ar=em(j),Vs=em(pe),yi={source:l,start:{offset:j,line:ar.line,column:ar.column},end:{offset:pe,line:Vs.line,column:Vs.column}};return Te&&l&&typeof l.offset=="function"&&(yi.start=l.offset(yi.start),yi.end=l.offset(yi.end)),yi}function Qt(j){ne<Sn||(ne>Sn&&(Sn=ne,Dh=[]),Dh.push(j))}function Qg(j,pe,Te){return new e(e.buildMessage(j,pe),j,pe,Te)}function tm(){var j;return(j=Kg())===a&&(j=ha()),j}function Kg(){var j,pe;return Qe++,j=ne,Ki(),s.substr(ne,4)===p?(pe=p,ne+=4):(pe=a,Qe===0&&Qt(N)),pe!==a?(Ki(),Ei=j,j=gi()):(ne=j,j=a),Qe--,j===a&&Qe===0&&Qt(D),j}function ha(){var j,pe;if(j=[],(pe=Ol())!==a)for(;pe!==a;)j.push(pe),pe=Ol();else j=a;return j}function Ol(){var j,pe,Te,ar;return j=ne,Ki(),(pe=ey())!==a?(Ki(),(Te=hp())===a&&(Te=null),Ki(),s.charCodeAt(ne)===41?(ar=f,ne++):(ar=a,Qe===0&&Qt(G)),ar!==a?(Ki(),Ei=j,j=kt(pe,Te)):(ne=j,j=a)):(ne=j,j=a),j}function hp(){var j,pe,Te,ar,Vs,yi,da,Z_;if(j=ne,(pe=Cn())!==a){for(Te=[],ar=ne,Vs=Ki(),s.charCodeAt(ne)===44?(yi=m,ne++):(yi=a,Qe===0&&Qt(X)),yi===a&&(yi=null),da=Ki(),(Z_=Cn())!==a?ar=Vs=[Vs,yi,da,Z_]:(ne=ar,ar=a);ar!==a;)Te.push(ar),ar=ne,Vs=Ki(),s.charCodeAt(ne)===44?(yi=m,ne++):(yi=a,Qe===0&&Qt(X)),yi===a&&(yi=null),da=Ki(),(Z_=Cn())!==a?ar=Vs=[Vs,yi,da,Z_]:(ne=ar,ar=a);Ei=j,j=ai(pe,Te)}else ne=j,j=a;return j}function Cn(){var j,pe;return j=ne,(pe=W_())===a&&(pe=Cw())===a&&(pe=X_())===a&&(pe=ty()),pe!==a&&(Ei=j,pe=Ur(pe)),(j=pe)===a&&(j=ne,(pe=tP())!==a&&(Ei=j,pe=ei(pe)),j=pe),j}function Ki(){var j,pe;for(Qe++,j=[],Z.test(s.charAt(ne))?(pe=s.charAt(ne),ne++):(pe=a,Qe===0&&Qt(ee));pe!==a;)j.push(pe),Z.test(s.charAt(ne))?(pe=s.charAt(ne),ne++):(pe=a,Qe===0&&Qt(ee));return Qe--,pe=a,Qe===0&&Qt(K),j}function ey(){var j,pe,Te;return Qe++,j=ne,(pe=q_())!==a?(s.charCodeAt(ne)===40?(Te=y,ne++):(Te=a,Qe===0&&Qt(Le)),Te!==a?(Ei=j,j=Pr(pe)):(ne=j,j=a)):(ne=j,j=a),Qe--,j===a&&(pe=a,Qe===0&&Qt(_e)),j}function q_(){var j,pe,Te;if(Qe++,j=ne,pe=[],W.test(s.charAt(ne))?(Te=s.charAt(ne),ne++):(Te=a,Qe===0&&Qt(Rt)),Te!==a)for(;Te!==a;)pe.push(Te),W.test(s.charAt(ne))?(Te=s.charAt(ne),ne++):(Te=a,Qe===0&&Qt(Rt));else pe=a;return pe!==a&&(Ei=j,pe=Si()),Qe--,(j=pe)===a&&(pe=a,Qe===0&&Qt(_t)),j}function W_(){var j,pe,Te;return Qe++,j=ne,Ki(),(pe=Za())!==a?(s.charCodeAt(ne)===37?(Te=_,ne++):(Te=a,Qe===0&&Qt(vt)),Te!==a?(Ei=j,j=zr(pe)):(ne=j,j=a)):(ne=j,j=a),Qe--,j===a&&Qe===0&&Qt(at),j}function Cw(){var j,pe,Te;return Qe++,j=ne,Ki(),(pe=Za())!==a?(s.substr(ne,2)===v?(Te=v,ne+=2):(Te=a,Qe===0&&Qt(fe)),Te!==a?(Ei=j,j=li(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Ki(),(pe=Za())!==a?(s.substr(ne,2)===w?(Te=w,ne+=2):(Te=a,Qe===0&&Qt(Tt)),Te!==a?(Ei=j,j=ti(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Ki(),(pe=Za())!==a?(s.substr(ne,2)===T?(Te=T,ne+=2):(Te=a,Qe===0&&Qt(bt)),Te!==a?(Ei=j,j=pr(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Ki(),(pe=Za())!==a?(s.substr(ne,2)===x?(Te=x,ne+=2):(Te=a,Qe===0&&Qt(Ce)),Te!==a?(Ei=j,j=ci(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Ki(),(pe=Za())!==a?(s.substr(ne,2)===S?(Te=S,ne+=2):(Te=a,Qe===0&&Qt(Be)),Te!==a?(Ei=j,j=Fi(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,Ki(),(pe=Za())!==a?(s.substr(ne,2)===O?(Te=O,ne+=2):(Te=a,Qe===0&&Qt(je)),Te!==a?(Ei=j,j=Hn(pe)):(ne=j,j=a)):(ne=j,j=a)))))),Qe--,j===a&&Qe===0&&Qt(ze),j}function X_(){var j,pe,Te;return Qe++,j=ne,(pe=Za())!==a?(s.substr(ne,3)===A?(Te=A,ne+=3):(Te=a,Qe===0&&Qt(ct)),Te!==a?(Ei=j,j=qn(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,(pe=Za())!==a?(s.substr(ne,3)===P?(Te=P,ne+=3):(Te=a,Qe===0&&Qt(hr)),Te!==a?(Ei=j,j=Wn(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,(pe=Za())!==a?(s.substr(ne,4)===I?(Te=I,ne+=4):(Te=a,Qe===0&&Qt(He)),Te!==a?(Ei=j,j=Xn(pe)):(ne=j,j=a)):(ne=j,j=a),j===a&&(j=ne,(pe=Za())!==a?(s.substr(ne,4)===V?(Te=V,ne+=4):(Te=a,Qe===0&&Qt(mt)),Te!==a?(Ei=j,j=Hi(pe)):(ne=j,j=a)):(ne=j,j=a)))),Qe--,j===a&&(pe=a,Qe===0&&Qt(ft)),j}function ty(){var j,pe;return Qe++,j=ne,Ki(),(pe=Za())!==a?(Ei=j,j=Ui(pe)):(ne=j,j=a),Qe--,j===a&&Qe===0&&Qt(dr),j}function tP(){var j,pe,Te,ar;if(Qe++,j=ne,s.charCodeAt(ne)===35?(pe=k,ne++):(pe=a,Qe===0&&Qt(ut)),pe!==a){if(Te=[],H.test(s.charAt(ne))?(ar=s.charAt(ne),ne++):(ar=a,Qe===0&&Qt(gt)),ar!==a)for(;ar!==a;)Te.push(ar),H.test(s.charAt(ne))?(ar=s.charAt(ne),ne++):(ar=a,Qe===0&&Qt(gt));else Te=a;Te!==a?(Ei=j,j=Hr()):(ne=j,j=a)}else ne=j,j=a;return j===a&&(j=ne,(pe=Ol())!==a&&(Ei=j,pe=Tn(pe)),(j=pe)===a&&(j=ne,(pe=q_())!==a&&(Ei=j,pe=bo()),j=pe)),Qe--,j===a&&(pe=a,Qe===0&&Qt(nt)),j}function Za(){var j,pe,Te,ar,Vs,yi,da;for(j=ne,Y.test(s.charAt(ne))?(s.charAt(ne),ne++):Qe===0&&Qt(Dt),pe=ne,Te=[],M.test(s.charAt(ne))?(ar=s.charAt(ne),ne++):(ar=a,Qe===0&&Qt(jt));ar!==a;)Te.push(ar),M.test(s.charAt(ne))?(ar=s.charAt(ne),ne++):(ar=a,Qe===0&&Qt(jt));if(s.charCodeAt(ne)===46?(ar=B,ne++):(ar=a,Qe===0&&Qt(Ti)),ar!==a){if(Vs=[],M.test(s.charAt(ne))?(yi=s.charAt(ne),ne++):(yi=a,Qe===0&&Qt(jt)),yi!==a)for(;yi!==a;)Vs.push(yi),M.test(s.charAt(ne))?(yi=s.charAt(ne),ne++):(yi=a,Qe===0&&Qt(jt));else Vs=a;Vs!==a?pe=Te=[Te,ar,Vs]:(ne=pe,pe=a)}else ne=pe,pe=a;if(pe===a)if(pe=[],M.test(s.charAt(ne))?(Te=s.charAt(ne),ne++):(Te=a,Qe===0&&Qt(jt)),Te!==a)for(;Te!==a;)pe.push(Te),M.test(s.charAt(ne))?(Te=s.charAt(ne),ne++):(Te=a,Qe===0&&Qt(jt));else pe=a;if(pe!==a){if(Te=ne,s.charCodeAt(ne)===101?(ar=z,ne++):(ar=a,Qe===0&&Qt(jr)),ar!==a){if(Y.test(s.charAt(ne))?(Vs=s.charAt(ne),ne++):(Vs=a,Qe===0&&Qt(Dt)),Vs===a&&(Vs=null),yi=[],M.test(s.charAt(ne))?(da=s.charAt(ne),ne++):(da=a,Qe===0&&Qt(jt)),da!==a)for(;da!==a;)yi.push(da),M.test(s.charAt(ne))?(da=s.charAt(ne),ne++):(da=a,Qe===0&&Qt(jt));else yi=a;yi!==a?Te=ar=[ar,Vs,yi]:(ne=Te,Te=a)}else ne=Te,Te=a;Te===a&&(Te=null),Ei=j,j=ua()}else ne=j,j=a;return j}function lE(j,pe){return j.map(function(Te){return Te[pe]})}function cE(j,pe,Te){return[j].concat(lE(pe,Te))}if((o=h())!==a&&ne===s.length)return o;throw o!==a&&ne<s.length&&Qt(j_()),Qg(Dh,Sn<s.length?s.charAt(Sn):null,Sn<s.length?H_(Sn,Sn+1):H_(Sn,Sn))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,h=this.location.source+":"+c.line+":"+c.column;if(a){var p=this.location.end,f=r("",c.line.toString().length," "),m=a[l.line-1],y=(l.line===p.line?p.column:m.length+1)-l.column||1;n+=`
 --> `+h+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+r("",l.column-1," ")+r("",y,"^")}else n+=`
 at `+h}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,_,v=m.map(h);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:i}},(Yie=q7).exports&&(Yie.exports=Jie());var wet=q7.exports;function mTe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=Qie(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new U("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Qie(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!_et(e[r].effects,e[r+1].effects))throw new U("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});vet(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function Qie(t){let e;if(!t)return[];try{e=wet.parse(t)}catch(r){throw new U("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>xet(r))}function xet(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Tet(t);case"opacity":return Eet(t);case"hue-rotate":return Cet(t);case"blur":return Aet(t);case"drop-shadow":return Oet(t);case"bloom":return Ret(t)}}catch(e){throw e.details.filter=t,e}throw new U("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Tet(t){let e=1;return sE(t.parameters,1),t.parameters.length===1&&(e=Ed(t.parameters[0])),new H7(t.name,e)}function Eet(t){let e=1;return sE(t.parameters,1),t.parameters.length===1&&(e=Ed(t.parameters[0])),new pTe(e)}function Cet(t){let e=0;return sE(t.parameters,1),t.parameters.length===1&&(e=Det(t.parameters[0])),new hTe(e)}function Aet(t){let e=0;return sE(t.parameters,1),t.parameters.length===1&&(e=GZ(t.parameters[0]),jR(e,t.parameters[0])),new oTe(e)}function Oet(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new U("effect:type-error","Accepts only one color",{});r=Net(i)}else{const s=GZ(i);if(Object.isFrozen(e))throw new U("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&jR(s,i)}if(e.length<2||e.length>3)throw new U("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new cTe(e[0],e[1],e[2]||0,r||gTe("black"))}function Ret(t){let e=1,r=0,i=0;return sE(t.parameters,3),t.parameters[0]&&(e=Ed(t.parameters[0])),t.parameters[1]&&(r=GZ(t.parameters[1]),jR(r,t.parameters[1])),t.parameters[2]&&(i=Ed(t.parameters[2])),new sTe(e,r,i)}function sE(t,e){if(t.length>e)throw new U("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function NF(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in BZ)return"<length>";if(t.unit in kZ)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function jR(t,e){if(t<0)throw new U("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function Pet(t){if(t.type!=="quantity"||t.unit!==null)throw new U("effect:type-error",`Expected <double>, Actual: ${NF(t)}`,{term:t})}function Met(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new U("effect:type-error",`Expected <double> or <percentage>, Actual: ${NF(t)}`,{term:t})}const kZ={deg:1,grad:.9,rad:180/Math.PI,turn:360};function $et(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&kZ[t.unit]!=null))throw new U("effect:type-error",`Expected <angle>, Actual: ${NF(t)}`,{term:t})}const BZ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Iet(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&BZ[t.unit]!=null))throw new U("effect:type-error",`Expected <length>, Actual: ${NF(t)}`,{term:t})}function Ed(t){Met(t);const e=t.value;return jR(e,t),t.unit==="%"?.01*e:e}function Let(t){return Pet(t),jR(t.value,t),t.value}function Det(t){return $et(t),t.value*kZ[t.unit]||0}function GZ(t){return Iet(t),t.value*BZ[t.unit]||0}function Net(t){switch(t.colorType){case"hex":return A$e(t.value);case"named":return gTe(t.value);case"function":return Vet(t.value)}}function gTe(t){if(!Sde(t))throw new U("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return C$e(t)}const Fet=/^rgba?/i,Uet=/^hsla?/i;function Vet(t){if(sE(t.parameters,4),Fet.test(t.name))return[Ed(t.parameters[0]),Ed(t.parameters[1]),Ed(t.parameters[2]),t.parameters[3]?Ed(t.parameters[3]):1];if(Uet.test(t.name))return Ede(Let(t.parameters[0]),Ed(t.parameters[1]),Ed(t.parameters[2]),t.parameters[3]?Ed(t.parameters[3]):1);throw new U("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function jZ(t,e,r){var i;try{return ket(t)}catch(s){(i=r==null?void 0:r.messages)==null||i.push(s)}return null}function HZ(t,e,r,i){try{const s=zet(t);Ga(r,s,e)}catch(s){i.messages&&i.messages.push(s)}}function zet(t){const e=mTe(t);return e?bet(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function ket(t){if(!t||t.length===0)return null;if(Bet(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:Kie(r.value)});return e}return Kie(t)}function Bet(t){const e=t[0];return!!e&&"scale"in e}function Kie(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[cm(r,"amount")];break;case"blur":i=[cm(r,"radius","pt")];break;case"hue-rotate":i=[cm(r,"angle","deg")];break;case"drop-shadow":i=[cm(r,"xoffset","pt"),cm(r,"yoffset","pt"),cm(r,"blurRadius","pt"),Get(r,"color")];break;case"bloom":i=[cm(r,"strength"),cm(r,"radius","pt"),cm(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;mTe(s),e.push(s)}return e.join(" ")}function cm(t,e,r){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function Get(t,e){if(t[e]==null)throw new U("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}function jet(t){return typeof t=="function"}function $Pt(t,e,r,i){return jet(t)?t(e,r,i):t}function IPt(t){return[t.r,t.g,t.b,t.a]}const Het=` /-,
`;function ese(t){let e=t.length;for(;e--;)if(!Het.includes(t.charAt(e)))return!1;return!0}function qet(t,e){const r=[];let i=0,s=-1;do if(s=t.indexOf("[",i),s>=i){if(s>i){const n=t.substr(i,s-i);r.push([n,null,ese(n)])}if(i=s+1,s=t.indexOf("]",i),s>=i){if(s>i){const n=e[t.substr(i,s-i)];n&&r.push([null,n,!1])}i=s+1}}while(s!==-1);if(i<t.length-1){const n=t.substr(i);r.push([n,null,ese(n)])}return r}function Wet(t,e,r){let i="",s=null;for(const n of e){const[o,a,l]=n;if(o)l?s=o:(s&&(i+=s,s=null),i+=o);else{const c=t.attributes[a];c&&(s&&(i+=s,s=null),i+=c)}}return Xet(i,r)}function LPt(t,e,r){const i=qet(e,t);return s=>Wet(s,i,r)}function Xet(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function DPt(t,e,r,i,s,n,o=!0){const a=e/s,l=r/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let y=0,_=0,v=0,w=0,T=0,x=0,S=0;const O=(p+.5)*l;for(let A=Math.floor(p*l);A<(p+1)*l;A++){const P=Math.abs(O-(A+.5))/h,I=(f+.5)*a,V=P*P;for(let k=Math.floor(f*a);k<(f+1)*a;k++){let B=Math.abs(I-(k+.5))/c;const z=Math.sqrt(V+B*B);z>=-1&&z<=1&&(y=2*z*z*z-3*z*z+1,y>0&&(B=4*(k+A*e),S+=y*t[B+3],v+=y,t[B+3]<255&&(y=y*t[B+3]/250),w+=y*t[B],T+=y*t[B+1],x+=y*t[B+2],_+=y))}}i[m]=w/_,i[m+1]=T/_,i[m+2]=x/_,i[m+3]=S/v}}function yTe(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function Zet(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function Yet(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function Jet(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function _Te(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const NPt=(t,e=0)=>t==null||isNaN(t)?e:t,FPt=t=>t.tintColor?yTe(t.tintColor):{r:255,g:255,b:255,a:1},UPt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function VPt(){return ae(()=>import("./geometryEngineJSON-fa5ffbf0.js"),["assets/geometryEngineJSON-fa5ffbf0.js","assets/geometryEngineBase-91f379ee.js","assets/geometryEngineJSON-18c69b5c.js","assets/json-48e3ea08.js"])}function zPt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function kPt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function BPt(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function GPt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function tse(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=tse(e);if(r!=null)return r}break;case"CIMTextSymbol":return tse(t.symbol);case"CIMSolidFill":return t.color}}function rse(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=rse(r);if(i!=null)return i}break}case"CIMTextSymbol":return rse(t.symbol);case"CIMSolidStroke":return t.color}}function ise(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=ise(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return ise(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function jPt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function HPt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function qPt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const WPt=t=>t.includes("data:image/svg+xml");function XPt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function vTe(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const s of t.effects)ett(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":Qet(s,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":vTe(s.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function Qet(t,e,r){if(t&&(t.markerPlacement&&Ket(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||vTe(i.symbol,e,!0,r)}function Ket(t,e){switch(_Te(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function ett(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function ttt(t){const e=[];return W7(Zet(t),e),e.length?new ke(yTe(e[0])):null}function W7(t,e){var s;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const n of r.symbolLayers)if(!(n.colorLocked||i&&(Jet(n)||Yet(n)&&n.markerPlacement&&_Te(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&sse(e,n.tintColor);break;case"CIMVectorMarker":(s=n.markerGraphics)==null||s.forEach(o=>{W7(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":sse(e,n.color);break;case"CIMHatchFill":W7(n.lineSymbol,e)}}}function sse(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}let bTe=class{constructor(e,r){this._storage=new Rxe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new bTe(1e3);new ke([128,128,128]);const rtt=new ke("white");function itt(t){return Ql(t.resource).href}function YPt(t,e){if(!t)return null;let r=null;return Db(t)?r=stt(t):y5(t)&&(r=t.type==="cim"?ttt(t):t.color?new ke(t.color):null),r?VO(r,e):null}function stt(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var s;i.type==="object"&&((s=i.resource)!=null&&s.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new ke(r):null}function VO(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new ke(r)}function ntt(t,e,r){const i=t.symbolLayers;if(!i)return;const s=n=>VO(e=e??n??(r!=null?rtt:null),r);i.forEach(n=>{var o;if(n.type!=="object"||!((o=n.resource)!=null&&o.href)||e)if(n.type==="water")n.color=s(n.color);else{const a=n.material!=null?n.material.color:null,l=s(a);n.material==null?n.material=new ru({color:l}):n.material.color=l,r!=null&&"outline"in n&&n.outline!=null&&n.outline.color!=null&&(n.outline.color=VO(n.outline.color,r))}})}function ott(t,e,r){(e=e??t.color)&&(t.color=VO(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=VO(t.outline.color,r))}function JPt(t,e,r){t&&(e||r!=null)&&(e&&(e=new ke(e)),Db(t)?ntt(t,e,r):y5(t)&&ott(t,e,r))}async function att(t,e){const r=t.symbolLayers;r&&await H4(r,async i=>ltt(i,e))}async function ltt(t,e){switch(t.type){case"extrude":utt(t,e);break;case"icon":case"line":case"text":ctt(t,e);break;case"path":dtt(t,e);break;case"object":await htt(t,e)}}function ctt(t,e){const r=wTe(e);r!=null&&(t.size=r)}function wTe(t){for(const e of t)if(typeof e=="number")return e;return null}function utt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function htt(t,e){const{resourceSize:r,symbolSize:i}=await ptt(t),s=xTe(e,r,i);t.width=$A(e[0],i[0],r[0],s),t.depth=$A(e[1],i[1],r[1],s),t.height=$A(e[2],i[2],r[2],s)}function dtt(t,e){const r=xTe(e,sg,[t.width,void 0,t.height]);t.width=$A(e[0],t.width,1,r),t.height=$A(e[2],t.height,1,r)}function xTe(t,e,r){for(let i=0;i<3;i++){const s=t[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/e[i]:1}case"proportional":break;default:if(s&&e[i])return s/e[i]}}return 1}async function ptt(t){const{computeObjectLayerResourceSize:e}=await ae(()=>import("./symbolLayerUtils-ea0a9b5e.js"),[]),r=await e(t,10),{width:i,height:s,depth:n}=t,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function $A(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function ftt(t,e){const r=wTe(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function QPt(t,e){if(t&&e)return Db(t)?att(t,e):void(y5(t)&&ftt(t,e))}function KPt(t,e,r){if(t&&e!=null)if(Db(t)){const i=t.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=e;break;case"roll":s.roll=e;break;default:s.heading=e}})}else y5(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function eMt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function tMt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function mtt(t,e,r,i,s){if(t==null)return null;const n=t.referencesGeometry()&&s?gtt(e,i,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return J.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const A8=new Map;function gtt(t,e,r){const{transform:i,hasZ:s,hasM:n}=r;A8.has(e)||A8.set(e,ytt(e));const o=A8.get(e)(t.geometry,i,s,n);return{...t,geometry:o}}function ytt(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,s,n)=>Dbe(i,e,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>Nbe(i,e,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>Fbe(i,e,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>Lbe(i,e,r,s,n);default:return J.getLogger("esri.views.2d.support.arcadeOnDemand").error(new U("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const rMt=1.2,_tt=wf;let FF=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,qi.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,fn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,qi.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=C()){return se(e,0,0,0)}getBoundingBoxObjectSpace(e=an()){return xi(e)}addObjectState(e,r){e===$g.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,fn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,fn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(ix)&&(e.draped.origin[0]+=ix[0],e.draped.origin[1]+=ix[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,s,n){xi(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,nse,i),U4e(n,nse)}if(r){let o;Dd(n,ix);const a=aZ(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(ix[0],ix[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,r,i,s){if(this.boundingBox)u5(xp,this.boundingBox);else{const n=e.boundingSphere,o=n[3];xp[0]=n[0]-o,xp[1]=n[1]-o,xp[2]=n[2]-o,xp[3]=n[0]+o,xp[4]=n[1]+o,xp[5]=n[2]+o}return r(xp,0,2),this.calculateRelativeScreenBounds&&s.push({location:Dd(xp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Zq(xp,i)}};const nse=zt(),xp=an(),ix=C();let TTe=class{constructor(e,r,i,s=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=X7(ose,qM,qM).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const v=e.measureText(y),w=v.width,T=w+r;this._textWidths.push(w),this._lineWidths.push(T),o=Math.max(o,T),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),_===0&&(s=v),_===this._lines.length-1&&(n=v)});const c=e.font;let h=lse.get(c);if(!h){const y=e.measureText(btt);h=new xtt(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),lse.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new wtt(a-f,l-m,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*vtt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case o_.Left:return this._backgroundHorizontalPadding;case o_.Center:return(this.displayWidth-this._lineWidths[e])/2;case o_.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,r+p,i),this._renderLineDecoration(e,r+p,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+p,i,this._textWidths[c]),i+=this._lineSpacing}if(ni.TEXT_SHOW_BASELINE){e.strokeStyle=ase,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(e,[s,p],[s+this.displayWidth,p]),c+=this._lineSpacing}}if(ni.TEXT_SHOW_BORDER&&(e.strokeStyle=ase,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ye(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+s),e.arcTo(r,i,r+s,i,s),e.lineTo(r+n-s,i),e.arcTo(r+n,i,r+n,i+s,s),e.lineTo(r+n,i+o-s),e.arcTo(r+n,i+o,r+n-s,i+o,s),e.lineTo(r+s,i+o),e.arcTo(r,i+o,r,i+o-s,s),e.closePath()):e.rect(r,i,n,o)}_renderHalo(e,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=X7(ose,Math.max(o,qM),Math.max(a,qM)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of STe)this._fillText(e,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(p*s),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,s){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(e,r,i,s){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,h),e.stroke()}};const STe=[];for(let e=0;e<360;e+=360/16)STe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var o_;function X7(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(o_||(o_={}));const ose={canvas:null},vtt=.2,qM=512,ase="rgb(255, 0, 255, 0.5)",btt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let wtt=class{constructor(e,r,i,s,n){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}},xtt=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const lse=new Map,Ttt=Object.freeze({left:0,center:.5,right:1}),vL=Object.freeze({"bottom-left":cr(0,0),bottom:cr(.5,0),"bottom-right":cr(1,0),left:cr(0,.5),center:cr(.5,.5),right:cr(1,.5),"top-left":cr(0,1),top:cr(.5,1),"top-right":cr(1,1)});function ETe(t){switch(t){case"left":return o_.Left;case"right":return o_.Right;default:return o_.Center}}function cse(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Stt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Ett(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Ctt(t){return t==="middle"?"center":t}let bS=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=ve(),this._shaderTransformation=null,this._boundingSphere=null,this.id=hc(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=$e(ys(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*Y2(this.shaderTransformation),this._boundingSphere):jge}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=$s(ve(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const Att=ve(),use=Ae(0,0,1),Ott=16,Rtt=1.5,tb=QX,Ptt=[tb/2,tb/2,1-tb/2,1-tb/2],Mtt=[$O*tb,$O*tb];let Z7=class CTe extends Kf{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,s){super(e,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const s=itt(this.symbolLayer),n=Cb(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),e):await this._prepareResourcesHref(r,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=TF(this._getIconSize());if(e)throw new U("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?uo(e.size):Ott);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height};i=new Tw(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if($tt(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;e.verticalOffset={screenLength:uo(i),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(O8(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>XWe(r));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=Ptt;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/tb,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await lu(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw Po(o.error),new U("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[s,Math.round(s/l)]:[Math.round(s*l),s],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const s=new zS({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await ae(()=>import("./CIMSymbolRasterizer-a419cb9c.js"),["assets/CIMSymbolRasterizer-a419cb9c.js","assets/cimAnalyzer-9902eef3.js","assets/TileClipper-ae6eca9e.js","assets/definitions-9264ac24.js","assets/number-e491b09e.js","assets/BidiEngine-9a40f2f4.js","assets/imageutils-5dee4438.js","assets/rasterizingUtils-4885de94.js"])).CIMSymbolRasterizer;Jt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await hLe(p,this._context.layer.spatialReference,n);a=(m,y,_)=>{const v=mtt(f,m,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Jt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||i5e}_getOutlineSize(){let e=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(uo(r.outline.size),0):(e=O8(this._getPrimitive())?Rtt:0,Math.max(e,0))}_getOutlineColor(){var s;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(s=r==null?void 0:r.outline)==null?void 0:s.color;if(i!=null){const n=ke.toUnitRGB(i),o=i.a*e;return[n[0],n[1],n[2],o]}return[0,0,0,0]}_getFillColor(){var i,s;if(O8(this._getPrimitive()))return _tt;const e=this._getPrimitive()==null,r=(s=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:s.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?cr((r.x||0)+.5,.5-(r.y||0)):e in vL?vL[e]:vL.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new mS(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=pS(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new mS(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=ki(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const s=e.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[i]=uo(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var p;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const f=this._generateTextureCIM(r),m={textureId:f.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(m,this._context.stage),s=[f.parameters.width,f.parameters.height]}else s=this._size,i=this._material;const n=LO(r.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((p=this._fastUpdates)!=null&&p.visualVariables.size)){const f=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,f)}l*=this._symbolTextureRatio;const c=cr(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(r,new cp);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,e.layer.uid):this._createAs3DShape(r,n,i,a,c,h,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=NR(CTe.elevationModeChangeTypes,i,s);if(n!==as.UPDATE)return n;const o=Ah(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!fS(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Ps.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return Ps.FastUpdate}_defaultElevationInfoNoZ(){return Itt}_createAs3DShape(e,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?_=>C7(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=JB(i,use,null,s,n,Ltt,null,l,p),m=pZ(this._context,r,f,o,a,c);if(m==null)return null;const y=new Qf(this,m.object,[f],null,null,gb,o);return y.alignedSampledElevation=m.sampledElevation,y.needsElevationUpdates=Ah(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),IO(y,r,this._context.elevationProvider),y}_createAsOverlay(e,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Zt();yo(r,a,this._context.overlaySR),a[2]=NZ;const l=this._context.clippingExtent;if(l!=null&&!Xq(l,a))return null;const c=this.getFastUpdateAttrValues(e),h=c&&this._fastUpdates?_=>C7(this._fastUpdates.materialParameters,c,_):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=JB(i,use,a,s,n,null,null,c,p),m=new bS(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:h}),y=new FF(this,[m],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,h),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(o=Ue())=>{const a=r(Att);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=e[0]/this._symbolTextureRatio+i,n=e[1]/this._symbolTextureRatio+i;return(o=Ue())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Ae(e,e,e),i=yh(1),s=e*i,n=Ae(s,s,s);return new LR({size:!0,color:!0,rotation:!0,opacity:!1},r,n,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function $tt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function O8(t){return t!=null&&(t==="cross"||t==="x")}Z7.PRIMITIVE_SIZE=Mtt,Z7.elevationModeChangeTypes={definedChanged:as.UPDATE,staysOnTheGround:as.NONE,onTheGroundChanged:as.RECREATE};const Itt={mode:"relative-to-ground",offset:0},Ltt=Nt(0,0,0,1);function Y7(t){switch(t){case"butt":return dh.BUTT;case"square":return dh.SQUARE;case"round":return dh.ROUND;default:return null}}function hse(t){return t==="diamond"?"kite":t}function J7(t,e,r=null){const i=[],s=[],n=e.mapPositions;Dtt(e,s,i);const o=s[0][1].data,a=i[0][1].length,l=ZS(a);return Ntt(e,s,i,l),Vtt(e,s,i,l),Ftt(e,s,i,l),Utt(e,s,i,l),ztt(e,s,i,l),ktt(e,s,i,l),Btt(e,s,i,o),new js(t,s,i,n,os.Line,r)}function Dtt(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=t,n=Gtt(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;e.push([E.POSITION,new Ve(l,3,n)]),r.push([E.POSITION,a])}function Ntt(t,e,r,i){if(t.attributeData.colorFeature!=null)return;const s=t.attributeData.color;e.push([E.COLOR,new Ve(s??sh,4)]),r.push([E.COLOR,i])}function Ftt(t,e,r,i){if(t.attributeData.normal==null)return;const s=t.attributeData.normal;e.push([E.NORMAL,new Ve(s,3)]),r.push([E.NORMAL,i])}function Utt(t,e,r,i){t.attributeData.colorFeature!=null&&(e.push([E.COLORFEATUREATTRIBUTE,new Ve([t.attributeData.colorFeature],1,!0)]),r.push([E.COLOR,i]))}function Vtt(t,e,r,i){t.attributeData.sizeFeature==null&&(e.push([E.SIZE,new Ve([t.attributeData.size??1],1,!0)]),r.push([E.SIZE,i]))}function ztt(t,e,r,i){t.attributeData.sizeFeature!=null&&(e.push([E.SIZEFEATUREATTRIBUTE,new Ve([t.attributeData.sizeFeature],1,!0)]),r.push([E.SIZEFEATUREATTRIBUTE,i]))}function ktt(t,e,r,i){const s=t.attributeData.opacityFeature;s!=null&&(e.push([E.OPACITYFEATUREATTRIBUTE,new Ve([s],1,!0)]),r.push([E.OPACITYFEATUREATTRIBUTE,i]))}function Btt(t,e,r,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Ie.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=Uo(i.length),n=Dr(t.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)C5(i,f,s,f,n);const o=i.length/3,a=Ji(o+1);let l=jtt,c=Htt,h=0,p=0;se(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),se(c,s[p++],s[p++],s[p++]),h+=S0e(l,c),a[f]=h,[l,c]=[c,l];e.push([E.DISTANCETOSTART,new Ve(a,1,!0)]),r.push([E.DISTANCETOSTART,r[0][1]])}function Gtt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const jtt=C(),Htt=C();function lMt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const s=i.length,n=Uo(3*s);i.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function qtt(t,e,r,i){const s=t.type==="polygon"?Vf.CCW_IS_HOLE:Vf.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=VR(n,!!t.hasZ,s),l=Uo(o.length),c=Ybe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),h=c!=null;return{lines:h?ATe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function Wtt(t,e){const r=t.type==="polygon"?Vf.CCW_IS_HOLE:Vf.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=VR(i,!1,r),o=oi(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=NZ;return{lines:o?ATe(n,s):[],projectionSuccess:o}}function ATe(t,e,r=null){const i=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:hh(e,3*s,3*n),mapPositions:r!=null?hh(r,o,a):void 0})}return i}function Xtt(t){const e=new br,r=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha),i=t.space===nu.World;e.include(txe,t),e.include(lxe,t),t.output===L.Depth&&e.include(Dg,t);const{vertex:s,fragment:n}=e;return n.include(wc),fc(s,t),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),w_(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Tr("nearFar",(o,a)=>a.camera.nearFar),new rr("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(b`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(b`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(E.NORMAL,"vec3"),uS(s),s.constants.add("tiltThreshold","float",.7),s.code.add(b`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(b`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(b`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===Xb.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===nu.Screen&&(s.uniforms.add(new Di("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(b`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(b`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Oe("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(b`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),tE(s,t),q5(e),s.code.add(b`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&s.code.add(b`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(b`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(b`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===nu.Screen&&s.code.add(b`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(b`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(du,t),e.include(fs,t),n.uniforms.add(new rr("intrinsicColor",o=>o.color),new Je("tex",o=>o.markerTexture)),n.include(Jf),e.constants.add("texelSize","float",1/yb),n.code.add(b`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",TZ/yb),e.constants.add("relativeTipLineWidth","float",tQe),n.code.add(b`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",co),n.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(finalColor.a);`:""}
    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Color&&t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===L.Highlight?b`fragColor = vec4(1.0);`:""}
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""}
  }
  `),e}const Ztt=Object.freeze(Object.defineProperty({__proto__:null,build:Xtt},Symbol.toStringTag,{value:"Module"})),OTe=new Map([[E.POSITION,0],[E.UV0,2],[E.AUXPOS1,3],[E.NORMAL,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7]]);let RTe=class PTe extends Rr{initializeProgram(e){return new Er(e.rctx,PTe.shader.get().build(this.configuration),OTe)}_makePipelineState(e,r){const i=this.configuration,s=e===st.NONE;return Ot({blending:i.output===L.Color||i.output===L.Alpha?s?su:Zg(e):null,depthTest:{func:V_(e)},depthWrite:s?i.writeDepth?El:null:gF(e),colorWrite:Gt,stencilWrite:i.hasOccludees?zf:null,stencilTest:i.hasOccludees?r?P_:z_:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ot({blending:su,depthTest:qN,depthWrite:null,colorWrite:Gt,stencilWrite:null,stencilTest:hxe}),this._occluderPipelineOpaque=Ot({blending:su,depthTest:qN,depthWrite:null,colorWrite:Gt,stencilWrite:cxe,stencilTest:uxe}),this._occluderPipelineMaskWrite=Ot({blending:null,depthTest:SZ,depthWrite:null,colorWrite:null,stencilWrite:zf,stencilTest:P_})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===ce.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ce.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};RTe.shader=new Sr(Ztt,()=>ae(()=>import("./LineMarker.glsl-781e685e.js"),[]));let Ytt=class extends U_{constructor(e){super(e,new Qtt),this._vertexAttributeLocations=OTe,this._configuration=new ro,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===ce.DRAPED_MATERIAL?nu.Draped:this.parameters.worldSpace?nu.World:nu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==dh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Ii.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=ji().vec3f(E.POSITION).vec2f(E.UV0).vec3f(E.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(E.NORMAL),this.parameters.vvSize?e.f32(E.SIZEFEATUREATTRIBUTE):e.f32(E.SIZE),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4f(E.COLOR),this.parameters.vvOpacity&&e.f32(E.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Ktt(this._layout,this.parameters)}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth?e===ce.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ii.OccludeAndTransparentStencil?e===ce.OPAQUE_MATERIAL||e===ce.OCCLUDER_MATERIAL||e===ce.TRANSPARENT_OCCLUDER_MATERIAL:r===L.Color||r===L.Alpha?e===(this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ce.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Jtt(e)}},Jtt=class extends HW{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(RTe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Qtt=class extends DR{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=dh.BUTT,this.anchor=Xb.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Ktt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,s,n){const o=i.vertexAttributes.get(E.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(E.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let h=1,p=0;this._parameters.vvSize?p=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(h=i.vertexAttributes.get(E.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(f=i.vertexAttributes.get(E.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const w=(O,A,P,I)=>{if(_[v++]=O[0],_[v++]=O[1],_[v++]=O[2],_[v++]=P[0],_[v++]=P[1],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=p:_[v++]=h,this._parameters.vvColor)_[v++]=m;else{const V=Math.min(4*I,f.length-4);_[v++]=f[V],_[v++]=f[V+1],_[v++]=f[V+2],_[v++]=f[V+3]}this._parameters.vvOpacity&&(_[v++]=y)};let T;(function(O){O[O.ASCENDING=1]="ASCENDING",O[O.DESCENDING=-1]="DESCENDING"})(T||(T={}));const x=(O,A)=>{const P=se(ert,o[3*O],o[3*O+1],o[3*O+2]),I=trt;let V=O+A;do se(I,o[3*V],o[3*V+1],o[3*V+2]),V+=A;while(l_(P,I)&&V>=0&&V<a);e&&($e(P,P,e),$e(I,I,e)),w(P,I,[-1,-1],O),w(P,I,[1,-1],O),w(P,I,[1,1],O),w(P,I,[-1,-1],O),w(P,I,[1,1],O),w(P,I,[-1,1],O)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,T.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,T.DESCENDING)}};const ert=C(),trt=C(),Ho={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},rrt={dash:Ho.dash,"dash-dot":[...Ho.dash,...Ho.dot],dot:Ho.dot,"long-dash":Ho["long-dash"],"long-dash-dot":[...Ho["long-dash"],...Ho.dot],"long-dash-dot-dot":[...Ho["long-dash"],...Ho.dot,...Ho.dot],none:null,"short-dash":Ho["short-dash"],"short-dash-dot":[...Ho["short-dash"],...Ho["short-dot"]],"short-dash-dot-dot":[...Ho["short-dash"],...Ho["short-dot"],...Ho["short-dot"]],"short-dot":Ho["short-dot"],solid:null},irt=8;function srt(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function pMt(t){return{pattern:[t,t],pixelRatio:2}}function MTe(t){return t!=null&&t.type==="style"?nrt(t.style):null}function nrt(t){return t!=null?srt(rrt[t],irt):null}const ort=["polyline","polygon","extent"],dse=new LR({size:!0,color:!0,rotation:!1,opacity:!0});let $Te=class ITe extends Kf{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){if(this._fastUpdates=pS(this._context.renderer,dse),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:yh(1))<0)throw new U("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){var n,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Y7(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:MTe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return(o=this._fastUpdates)!=null&&o.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new XT(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new XT(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new XT({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new XT({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new Ytt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:hse(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(e){return this._drivenProperties.size&&e.size?uo(EJe(e.size)):1}_getDrivenColor(e){const r=Nt(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,ort,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new cp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return Ps.RecreateSymbol;{const s=this._fastUpdates;if(!fS(s,r,dse))return Ps.RecreateSymbol;this._forEachMaterial(n=>n.setParameters(s.materialParameters))}}return Ps.FastUpdate}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=Y7(r.cap.newValue??"butt"),delete r.cap);const s=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){var a,l;const i=e.parameters.color,s=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Nt(i[0],i[1],i[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=NR(ITe.elevationModeChangeTypes,i,s);if(n!==as.UPDATE)return n;const o=Ah(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof yr)return Hd.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=an(),c=qtt(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(xi(l),Kc(l,v),!Nd(l,this._context.clippingExtent)))continue;const w=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,n.type,IA.ELEVATED,i);a.push(w),ni.LINE_WIREFRAMES&&a.push(w.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new Yg({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),f=new Qf(this,p,a,null,null,WZe,r);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=Ah(r.mode),f}_createGeometry(e,r,i,s,n,o,a){var _,v,w;const l=o===IA.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",h=(_=this._fastUpdates)==null?void 0:_.visualVariables.color,p=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,f=(w=this._fastUpdates)==null?void 0:w.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:i,size:p?null:this._getDrivenSize(r.renderingInfo),color:h?null:this._getDrivenColor(r.renderingInfo),sizeFeature:p?Xd(p.field,r.graphic):null,colorFeature:h?Xd(h.field,r.graphic):null,opacityFeature:f?Xd(f.field,r.graphic):null};return J7(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:y},m)}_createAsOverlay(e,r){const i=e.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=ni.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=an(),p=xi(),f=Wtt(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(xi(h),Kc(h,y.position),!Nd(h,this._context.clippingExtent))continue;B2(p,h);const _=v=>{const w=this._createGeometry(v,e,y.position,void 0,s.type,IA.DRAPED,i.uid),T=new bS(w,{layerUid:r,graphicUid:i.uid});c.push(T)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Kc(h,y.position,0,1),v!=="end"&&v!=="begin-end"||Kc(h,y.position,y.position.length-3,1)}_(o),ni.LINE_WIREFRAMES&&_(a)}return new FF(this,c,p,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??yh(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?uo(1):1:uo(e)}_prepareMaterialPatch(e,r,i){var a,l;const s=r.material;if(s==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?(a=s.newValue)==null?void 0:a.color:((l=s.diff.color)==null?void 0:l.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(vR(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){var h;const i=r.marker,s=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=i.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),s,e);const c=(h=i.diff.style)==null?void 0:h.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:hse(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var IA;$Te.elevationModeChangeTypes={definedChanged:as.RECREATE,staysOnTheGround:as.NONE,onTheGroundChanged:as.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(IA||(IA={}));let HE=null,YN=!0;function R8(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(YN)try{return new ImageData(t,e)}catch{YN=!1}return LTe(t,e,r)}function art(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(YN)try{return new ImageData(t,e,r)}catch{YN=!1}const s=LTe(e,r,i);return s.data.set(t,0),s}function lrt(){return HE||(HE=document.createElement("canvas"),HE.width=1,HE.height=1),HE}function LTe(t,e,r){return r||(r=lrt()),r.getContext("2d").createImageData(t,e)}var sT;const P8=new WeakMap;let crt=0,qp=sT=class extends de{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const s={type:"image-element",src:Og(t.src,i),crossOrigin:t.crossOrigin};e[r]=s}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};e[r]=n}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:Og(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(t)};e[r]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(P8.has(this.data)||P8.set(this.data,++crt),e(P8.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new sT(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return art(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new sT({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new sT({data:t}):Sb(sT,t)}};u([d({type:String,json:{write:f_}})],qp.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],qp.prototype,"data",null),u([De("data")],qp.prototype,"writeData",null),u([Se("data")],qp.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],qp.prototype,"transparent",null),u([d({json:{write:!0}})],qp.prototype,"wrap",void 0),u([d({readOnly:!0})],qp.prototype,"contentHash",null),qp=sT=u([R("esri.geometry.support.MeshTexture")],qp);const LA=qp;let nT=class extends Gi(de){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};u([d({type:[Number],nonNullable:!0,json:{write:!0}})],nT.prototype,"offset",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],nT.prototype,"rotation",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],nT.prototype,"scale",void 0),nT=u([R("esri.geometry.support.MeshTextureTransform")],nT);const _2=nT;var Q7;let od=Q7=class extends de{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new Q7(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){var e,r,i,s;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(i=this.colorTextureTransform)==null?void 0:i.clone(),normalTextureTransform:(s=this.normalTextureTransform)==null?void 0:s.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};u([d({type:ke,json:{write:!0}})],od.prototype,"color",void 0),u([d({type:LA,json:{write:!0}})],od.prototype,"colorTexture",void 0),u([d({type:_2,json:{write:!0}})],od.prototype,"colorTextureTransform",void 0),u([d({type:LA,json:{write:!0}})],od.prototype,"normalTexture",void 0),u([d({type:_2,json:{write:!0}})],od.prototype,"normalTextureTransform",void 0),u([d({nonNullable:!0,json:{write:!0}})],od.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],od.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],od.prototype,"doubleSided",void 0),od=Q7=u([R("esri.geometry.support.MeshMaterial")],od);const qZ=od;var K7;let Nu=K7=class extends qZ{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new K7(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,r,i,s,n,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(t),emissiveTextureTransform:(i=this.emissiveTextureTransform)==null?void 0:i.clone(),occlusionTexture:(s=this.occlusionTexture)==null?void 0:s.cloneWithDeduplication(t),occlusionTextureTransform:(n=this.occlusionTextureTransform)==null?void 0:n.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};u([d({type:ke,json:{write:!0}})],Nu.prototype,"emissiveColor",void 0),u([d({type:LA,json:{write:!0}})],Nu.prototype,"emissiveTexture",void 0),u([d({type:_2,json:{write:!0}})],Nu.prototype,"emissiveTextureTransform",void 0),u([d({type:LA,json:{write:!0}})],Nu.prototype,"occlusionTexture",void 0),u([d({type:_2,json:{write:!0}})],Nu.prototype,"occlusionTextureTransform",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Nu.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Nu.prototype,"roughness",void 0),u([d({type:LA,json:{write:!0}})],Nu.prototype,"metallicRoughnessTexture",void 0),u([d({type:_2,json:{write:!0}})],Nu.prototype,"metallicRoughnessTextureTransform",void 0),Nu=K7=u([R("esri.geometry.support.MeshMaterialMetallicRoughness")],Nu);const DTe=Nu;var bL;const NTe="esri.geometry.support.MeshVertexAttributes",sx=J.getLogger(NTe);let _u=bL=class extends de{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return oT(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},sx)}castPosition(t){return t&&t instanceof Float32Array&&sx.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),oT(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},sx)}castUv(t){return oT(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},sx)}castNormal(t){return oT(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},sx)}castTangent(t){return oT(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},sx)}clone(){const t={position:Q(this.position),uv:Q(this.uv),normal:Q(this.normal),tangent:Q(this.tangent),color:Q(this.color)};return new bL(t)}clonePositional(){const t={position:Q(this.position),normal:Q(this.normal),tangent:Q(this.tangent),uv:this.uv,color:this.color};return new bL(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function M8(t,e,r,i){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function oT(t,e,r,i,s){if(!t)return t;if(t instanceof e)return M8(t,i,e,s);for(const n of r)if(t instanceof n)return M8(new e(t),i,e,s);if(Array.isArray(t))return M8(new e(t),i,e,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function qE(t,e,r){e[r]=urt(t)}function urt(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}u([d({json:{write:qE}})],_u.prototype,"color",void 0),u([gr("color")],_u.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:qE}})],_u.prototype,"position",void 0),u([gr("position")],_u.prototype,"castPosition",null),u([d({json:{write:qE}})],_u.prototype,"uv",void 0),u([gr("uv")],_u.prototype,"castUv",null),u([d({json:{write:qE}})],_u.prototype,"normal",void 0),u([gr("normal")],_u.prototype,"castNormal",null),u([d({json:{write:qE}})],_u.prototype,"tangent",void 0),u([gr("tangent")],_u.prototype,"castTangent",null),_u=bL=u([R(NTe)],_u);var v3;const FTe="esri.geometry.support.MeshComponent",hrt=J.getLogger(FTe);let Pm=v3=class extends de{static from(t){return Sb(v3,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return oT(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},hrt)}castMaterial(t){return Sb(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?DTe:qZ,t)}clone(){return new v3({faces:Q(this.faces),shading:this.shading,material:Q(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:Q(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new v3(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};u([d({json:{write:!0}})],Pm.prototype,"faces",void 0),u([gr("faces")],Pm.prototype,"castFaces",null),u([d({type:qZ,json:{write:!0}})],Pm.prototype,"material",void 0),u([gr("material")],Pm.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],Pm.prototype,"shading",void 0),u([d({type:Boolean})],Pm.prototype,"trustSourceNormals",void 0),Pm=v3=u([R(FTe)],Pm);const drt=Pm,UF=J.getLogger("esri.geometry.support.meshUtils.normalProjection");function prt(t,e,r,i,s){return zF(i)?(VF(gg.TO_PCPF,on.fromTypedArray(t),Eh.fromTypedArray(e),Eh.fromTypedArray(r),i,on.fromTypedArray(s)),s):(UF.error("Cannot convert spatial reference to PCPF"),s)}function mMt(t,e,r,i,s){return zF(i)?(VF(gg.FROM_PCPF,on.fromTypedArray(t),Eh.fromTypedArray(e),Eh.fromTypedArray(r),i,on.fromTypedArray(s)),s):(UF.error("Cannot convert to spatial reference from PCPF"),s)}function gMt(t,e,r){return oi(t,e,0,r,Df(e),0,t.length/3),r}function yMt(t,e,r){return oi(t,Df(r),0,e,r,0,t.length/3),e}function frt(t,e,r){return b_(Nn,r),Wb(e,t,Nn),KW(Nn)||AF(e,e),e}function mrt(t,e,r){if(b_(Nn,r),Wb(e,t,Nn,4),KW(Nn)||AF(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function grt(t,e,r,i,s){if(!zF(i))return UF.error("Cannot convert spatial reference to PCPF"),s;VF(gg.TO_PCPF,on.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Eh.fromTypedArray(e),Eh.fromTypedArray(r),i,on.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function _Mt(t,e,r,i,s){if(!zF(i))return UF.error("Cannot convert to spatial reference from PCPF"),s;VF(gg.FROM_PCPF,on.fromTypedArray(t,16),Eh.fromTypedArray(e),Eh.fromTypedArray(r),i,on.fromTypedArray(s,16));for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function VF(t,e,r,i,s,n){if(!e)return;const o=r.count,a=Df(s);if(UTe(s))for(let l=0;l<o;l++)i.getVec(l,WM),e.getVec(l,Tp),bl(a,WM,XM,a),Th(Nn,XM),t===gg.FROM_PCPF&&Sh(Nn,Nn),ac(Tp,Tp,Nn),n.setVec(l,Tp);else for(let l=0;l<o;l++){i.getVec(l,WM),e.getVec(l,Tp),bl(a,WM,XM,a),Th(Nn,XM);const c=ED(r.get(l,1));let h=Math.cos(c);t===gg.TO_PCPF&&(h=1/h),Nn[0]*=h,Nn[1]*=h,Nn[2]*=h,Nn[3]*=h,Nn[4]*=h,Nn[5]*=h,t===gg.FROM_PCPF&&Sh(Nn,Nn),ac(Tp,Tp,Nn),ge(Tp,Tp),n.setVec(l,Tp)}return n}function zF(t){return UTe(t)||yrt(t)}function UTe(t){return t.isWGS84||Zhe(t)||Hf(t)||qf(t)}function yrt(t){return t.isWebMercator}var gg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(gg||(gg={}));const WM=C(),Tp=C(),XM=ve(),Nn=Ni();var DA;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(DA||(DA={}));let VTe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=hg.KTX2_ENCODING}};function bb(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function _rt(t){return new Promise((e,r)=>{const i=new Blob([t]),s=new FileReader;s.onload=()=>{const n=s.result;e(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function vrt(t,e){return e===hg.KTX2_ENCODING?new VTe(t):new Promise((r,i)=>{const s=new Blob([t],{type:e}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=h=>{URL.revokeObjectURL(n),i(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function df(t){if(t==null)return null;const e=t.offset!=null?t.offset:wwe,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:xwe,s=_L(1,0,0,0,1,0,e[0],e[1],1),n=_L(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=_L(i[0],0,0,0,i[1],0,0,0,1),a=xl();return sS(a,n,o),sS(a,s,a),a}J.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");let brt=class extends Qf{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,s=i.geometries.slice();i.removeAllGeometries();const n=mk($8,i.transformation),o=r.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=s}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(s=>e(s.material));r.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=i[s];o.setParameters({modelTransformation:null}),o===n.material?r.addGeometry(n):r.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=mk($8,e),a=i.getOrigin(o);if(a===n)return;const l=(r==null?void 0:r.localMatrix)??sn;s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:s}=this,n=(r==null?void 0:r.localMatrix)??sn;if(!this._fastTransformUpdatesEnabled)return s.clearShaderTransformation(),s.transformation=e,s.geometries.forEach(m=>{m.transformation=n}),void this.resetEdgeObject(i);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,h=si(pse,o,a),p=si(fse,l,c);s.shaderTransformation=l,this._setFastMaterialTransformation({matA:h,matB:p});const f=()=>c;for(const m of s.geometries)m.shaderTransformer=f;this.resetEdgeObject(i)}alignWithElevation(e,r,i,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,s);i!=null&&SF(this.elevationContext.featureExpressionInfoContext,i);const n=(m,y)=>C_(m,e,this.elevationContext,r,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=si(pse,a,l),h=$s(wrt,o.shaderTransformation);this.alignedSampledElevation=gb(this,this.elevationContext,e.spatialReference,n,r,h),o.shaderTransformation=h;const p=o.geometries[0].shaderTransformation,f=si(fse,h,p);this._setFastMaterialTransformation({matA:c,matB:f}),this.resetEdgeObject(s)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const s=i.geometries[0].localOrigin,n=yR(xrt,ie($8,s.vec3,-1)),o=si(mse,n,e),a=si(gse,n,r),l=bn(mse,o),c=si(gse,a,l);for(const h of i.geometries)h.material.setParameters({modelTransformation:c})}};const $8=C(),pse=ve(),fse=ve(),wrt=ve(),mse=ve(),gse=ve(),xrt=ve();let Trt=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=r.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),r.delete(s),s}const n=new kf(s.parameters);return i.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},i.localOriginFactory)}disable(e,r,i){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,h=this._fastTransformOriginalMaterials.get(c);return r.has(h.uid)?(s.add(c),r.byUid(h.uid).material):(n.add(c),h.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),a.dispose(),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o),o.dispose();for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},Srt=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){var i;const r=(i=this._byMaterial.get(e))==null?void 0:i.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function Ert(t){const e=new br,{vertex:r,fragment:i}=e;return e.include(vl,t),e.include(Ew,t),e.include(oxe,t),fc(r,t),t.stippleEnabled&&(e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),r.uniforms.add(new rr("viewport",(s,n)=>n.camera.fullViewport))),e.attributes.add(E.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(b`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(b`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Oe("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(b`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(b`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(b`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(b`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Oe("stipplePatternPixelSize",s=>xZ(s))),r.code.add(b`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(b`}`),t.output===L.Highlight&&e.include(Xg,t),e.include(fs,t),i.uniforms.add(new Oe("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new rr("constantColor",s=>s.color)),i.code.add(b`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===L.ObjectAndLayerIdColor?b`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${b.float(co)}) {
      discard;
    }

    ${t.output===L.Color?b`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===L.Highlight?b`outputHighlight();`:""}
  }
  `),e}const Crt=Object.freeze(Object.defineProperty({__proto__:null,build:Ert},Symbol.toStringTag,{value:"Module"}));let zTe=class kTe extends Rr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==L.Highlight}initializeProgram(e){return new Er(e.rctx,kTe.shader.get().build(this.configuration),vr)}initializePipeline(){const e=this.configuration,r=_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Ot({blending:n,depthTest:SZ,depthWrite:o,colorWrite:Gt,stencilWrite:e.hasOccludees?zf:null,stencilTest:e.hasOccludees?s?P_:z_:null});return e.output===L.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,El),i(!1,e.transparent||this._stippleEnabled?r:null,El)):i(!1)}get primitiveType(){return Et.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};zTe.shader=new Sr(Crt,()=>ae(()=>import("./NativeLine.glsl-1dffbb1c.js"),[]));let Ic=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};u([F({count:L.COUNT})],Ic.prototype,"output",void 0),u([F()],Ic.prototype,"hasSlicePlane",void 0),u([F()],Ic.prototype,"hasVertexColors",void 0),u([F()],Ic.prototype,"transparent",void 0),u([F()],Ic.prototype,"draped",void 0),u([F()],Ic.prototype,"stippleEnabled",void 0),u([F()],Ic.prototype,"stippleOffColorEnabled",void 0),u([F()],Ic.prototype,"stipplePreferContinuous",void 0),u([F()],Ic.prototype,"hasOccludees",void 0),u([F({constValue:!1})],Ic.prototype,"stippleRequiresClamp",void 0),u([F({constValue:!1})],Ic.prototype,"stippleScaleWithLineWidth",void 0),u([F({constValue:!1})],Ic.prototype,"stippleRequiresStretchMeasure",void 0);var JN;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(JN||(JN={}));let yse=class extends U_{constructor(e){super(e,new Rrt),this._configuration=new Ic}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===ce.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,s,n,o){if(!i.options.selectionMode||!e.visible)return;if(!E0e(r))return void J.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(E.POSITION).data,l=i.camera,c=Mrt;ln(c,i.point);const h=2;se(WE[0],c[0]-h,c[1]+h,0),se(WE[1],c[0]+h,c[1]+h,0),se(WE[2],c[0]+h,c[1]-h,0),se(WE[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(WE[_],um[_]))return;Qo(l.eye,um[0],um[1],I8),Qo(l.eye,um[1],um[2],L8),Qo(l.eye,um[2],um[3],D8),Qo(l.eye,um[3],um[0],N8);let p=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Ta[0]=a[_]+r[12],Ta[1]=a[_+1]+r[13],Ta[2]=a[_+2]+r[14],Sa[0]=a[_+3]+r[12],Sa[1]=a[_+4]+r[13],Sa[2]=a[_+5]+r[14],pi(I8,Ta)<0&&pi(I8,Sa)<0||pi(L8,Ta)<0&&pi(L8,Sa)<0||pi(D8,Ta)<0&&pi(D8,Sa)<0||pi(N8,Ta)<0&&pi(N8,Sa)<0)continue;if(l.projectToRenderScreen(Ta,mv),l.projectToRenderScreen(Sa,gv),mv[2]<0&&gv[2]>0){he(Sp,Ta,Sa);const w=l.frustum,T=-pi(w[di.NEAR],Ta)/me(Sp,w[di.NEAR]);ie(Sp,Sp,T),le(Ta,Ta,Sp),l.projectToRenderScreen(Ta,mv)}else if(mv[2]>0&&gv[2]<0){he(Sp,Sa,Ta);const w=l.frustum,T=-pi(w[di.NEAR],Sa)/me(Sp,w[di.NEAR]);ie(Sp,Sp,T),le(Sa,Sa,Sp),l.projectToRenderScreen(Sa,gv)}else if(mv[2]<0&&gv[2]<0)continue;mv[2]=0,gv[2]=0;const v=_W(db(mv,gv,bse),c);v<p&&(p=v,re(_se,Ta),re(vse,Sa),f=_/3)}const m=i.rayBegin,y=i.rayEnd;if(p<h*h){let _=Number.MAX_VALUE;if(zge(db(_se,vse,bse),db(m,y,Prt),fv)){he(fv,fv,m);const v=Ee(fv);ie(fv,fv,1/v),_=v/fi(m,y)}o(_,fv,f,!1)}}intersectDraped(e,r,i,s,n,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(E.POSITION).data,l=e.vertexAttributes.get(E.SIZE),c=l?l.data[0]:0,h=s[0],p=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],w=a[_+1],T=h-v,x=p-w,S=a[_+3]-v,O=a[_+4]-w,A=ye((S*T+O*x)/(S*S+O*O),0,1),P=S*A-T,I=O*A-x,V=P*P+I*I;V<m&&(m=V,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}requiresSlot(e,r){return!(r!==L.Color&&r!==L.Highlight&&r!==L.ObjectAndLayerIdColor||e!==ce.OPAQUE_MATERIAL&&e!==ce.DRAPED_MATERIAL)}createGLMaterial(e){return new Art(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?RQe:AQe;return this.parameters.stipplePattern==null?new rE(e):new Ort(e.clone().vec3f(E.AUXPOS1).vec2f(E.UV0))}},Art=class extends N_{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===L.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(zTe,e)}},Ort=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(E.POSITION).length}write(e,r,i,s,n){W1e(i,this.vertexBufferLayout,e,r,s,n),this._writeAuxpos1(e,i,s,n),this._writeUV0(e,i,s,n)}_writeAuxpos1(e,r,i,s){const n=i.getField(E.AUXPOS1,on),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],_=a[m+1],v=a[m+2],w=l[0]*y+l[4]*_+l[8]*v+l[12],T=l[1]*y+l[5]*_+l[9]*v+l[13],x=l[2]*y+l[6]*_+l[10]*v+l[14];h[s]=w,h[s+1]=T,h[s+2]=x,s+=c}}_writeUV0(e,r,i,s){var x;const n=i.getField(E.UV0,F_),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=(x=r.vertexAttributes.get(E.DISTANCETOSTART))==null?void 0:x.data,c=n.typedBufferStride,h=n.typedBuffer;let p=0;h[s*=c]=JN.START,h[s+1]=p,s+=c;const f=3*o[0],m=se(Ta,a[f],a[f+1],a[f+2]);e&&$e(m,m,e);const y=Sa,_=o.length-1;let v=1;const w=l?(S,O,A)=>p=l[A]:(S,O,A)=>p+=fi(S,O);for(let S=1;S<_;S+=2){const O=3*o[S];se(y,a[O],a[O+1],a[O+2]),e&&$e(y,y,e),w(m,y,v++);for(let A=0;A<2;++A)h[s]=1-A,h[s+1]=p,s+=c;re(m,y)}const T=3*o[_];se(y,a[T],a[T+1],a[T+2]),e&&$e(y,y,e),w(m,y,v),h[s]=JN.END,h[s+1]=p}},Rrt=class extends WX{constructor(){super(...arguments),this.color=sh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Ta=C(),Sa=C(),Sp=C(),fv=C(),mv=Fo(),gv=Fo(),_se=C(),vse=C(),bse=op(),Prt=op(),Mrt=C(),WE=[Fo(),Fo(),Fo(),Fo()],um=[C(),C(),C(),C()],I8=Mr(),L8=Mr(),D8=Mr(),N8=Mr(),$rt=["mesh"];let Irt=class extends Kf{constructor(e,r,i,s){super(e,r,i,s),this._materialInfoCache=new Srt,this._fastUpdateProcessor=new Trt,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){ni.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new yse({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new yse({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,$rt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new cp),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=r(s);n!=null&&n.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,A_)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const s=r(i);s!=null&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=Lrt,{origin:a,transform:l}=i;switch(bl(r,se(Yn,a.x,a.y,a.z??0),o,n),s){case DA.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case DA.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case DA.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:h,renderCoordsHelper:p}=this._context,f=(m,y)=>C_(m,h,c,p,y);return e.alignedSampledElevation=gb(e,c,h.spatialReference,f,p,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof ke?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:s}=e??Nrt;return`${r[0]},${r[1]},${s},${i[0]},${i[1]}`}_materialProperties(e,r,i){const s=this._materialPropertiesDefault(e,i);if(!r.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:h,alphaCutoff:p,alphaMode:f}=r.material,m=this._colorOrTextureUid(n),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),w=this._textureTransformUid(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${m},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${w},ds:${h},ac:${p},am:${f}`,r.material instanceof DTe){const{metallic:T,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:O,emissiveColor:A,emissiveTexture:P,emissiveTextureTransform:I,occlusionTexture:V,occlusionTextureTransform:k}=r.material,B=this._colorOrTextureUid(S),z=this._textureTransformUid(O),Z=this._colorOrTextureUid(A),W=this._colorOrTextureUid(P),H=this._textureTransformUid(I),Y=this._colorOrTextureUid(V),M=this._textureTransformUid(k);s.metallic=T,s.roughness=x,s.metallicRoughnessTexture=S,s.emissiveColor=A,s.emissiveTexture=P,s.occlusionTexture=V,s.colorTextureTransform=this._convertTextureTransform(a),s.normalTextureTransform=this._convertTextureTransform(c),s.emissiveTextureTransform=this._convertTextureTransform(I),s.occlusionTextureTransform=this._convertTextureTransform(k),s.metallicRoughnessTextureTransform=this._convertTextureTransform(O),s.uid=`${s.uid},mrm:${T},mrr:${x},mrt:${B},mrtt:${z},emuid:${Z},etmuid:${W},ett:${H},otmuid:${Y},ott:${M}`}return s}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:s}=e;return{scale:r,offset:i,rotation:Ft(s)}}_setInternalColorValueParameters(e,r){r.diffuse=ke.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Xr.Opaque);return r!=null?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const s=`${e.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new Tw(bb(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!bb(i)&&r!==Xr.Opaque,encoding:bb(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Lt.CLAMP_TO_EDGE;case"mirror":return Lt.MIRRORED_REPEAT;default:return Lt.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(r.emissiveFactor=ke.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=df(e.colorTextureTransform),r.normalTextureTransformMatrix=df(e.normalTextureTransform),r.occlusionTextureTransformMatrix=df(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=df(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=df(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=sh;else{const s=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;s!=null?e.externalColor=ke.toUnitRGBA(s):(i=null,e.externalColor=sh)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var y,_,v;const i=(y=r.material)==null?void 0:y.color,s=(_=r.material)==null?void 0:_.colorTexture,n=(v=r.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||s!=null&&s.transparent||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const h={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},p=jxe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:ke.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:za,diffuse:sg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:mi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=p?[...VZ]:[l.metallic,l.roughness,LF[2]],r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?mi.None:mi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new kf(f);return h.material=m,this._materialInfoCache.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Xr.MaskBlend:Xr.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Xr.Opaque:r.alphaMode==="mask"?Xr.Mask:Xr.Blend}_addDebugNormals(e,r){const i=r.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const y=r[m],_=y.vertexAttributes.get(E.POSITION),v=y.vertexAttributes.get(E.NORMAL),w=y.indices.get(E.POSITION),T=y.indices.get(E.NORMAL),x=_.data,S=v.data;for(let O=0;O<w.length;O++){const A=3*w[O],P=3*T[O];for(let I=0;I<3;I++)o.push(x[A+I]);for(let I=0;I<3;I++)o.push(x[A+I]+S[P+I]*n);if(a.push(a.length),a.push(a.length),O%3==0){this._calculateFaceNormal(x,w,O,ax),this._getFaceVertices(x,w,O,Yn,nx,ox),le(Yn,Yn,nx),le(Yn,Yn,ox),ie(Yn,Yn,1/3);for(let I=0;I<3;I++)l.push(Yn[I]);for(let I=0;I<3;I++)l.push(Yn[I]+ax[I]*n);c.push(c.length),c.push(c.length)}}}const h=r[0].transformation,p=new js(this._debugVertexNormalMaterial,[[E.POSITION,new Ve(o,3,!0)]],[[E.POSITION,a]],null,os.Line);r.push(p),p.transformation=h;const f=new js(this._debugFaceNormalMaterial,[[E.POSITION,new Ve(l,3,!0)]],[[E.POSITION,c]],null,os.Line);f.transformation=h,r.push(f)}_createAs3DShape(e,r,i,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;ni.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new Yg({geometries:a,layerUid:this._context.layer.uid,graphicUid:s});c.transformation=l;const h=uwe(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=h!=null?new sYe(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new brt(this,c,a,null,null,gb,i,p);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=A_(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(v,w)=>C_(v,m,i,y,w);return f.alignedSampledElevation=gb(f,i,m.spatialReference,_,y),f}_getCenterPointInElevationSR(e){const r=Sw(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return lW([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,r,i,s){if(r==null)return this._createComponentNormalsFlat(e,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(e,s,o,ax);for(let a=0;a<3;a++){const l=3*s[o+a];Yn[0]=r[l],Yn[1]=r[l+1],Yn[2]=r[l+2],me(ax,Yn)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new F8(r,s,n)}_createComponentNormalsFlat(e,r){const i=Ji(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(e,r,n,ax);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new F8(i,s,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,ax);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:C(),count:0},i[c]=h),le(h.normal,h.normal,a),h.count++}}const s=Ji(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(ge(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new F8(s,n,!1)}_getFaceVertices(e,r,i,s,n,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,s){return this._getFaceVertices(e,r,i,Yn,nx,ox),he(nx,nx,Yn),he(ox,ox,Yn),ot(Yn,nx,ox),ge(s,Yn),s}_getOrCreateComponents(e){return e.components??Drt}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const s=r.reprojection===ql.ECEF?r.transformBeforeProject:null;if(s!=null&&(i=_S(new Float64Array(i.length),i,s)),r.reprojection===ql.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=s!=null?i:new Float64Array(i.length);return oi(i,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(e,r,i){let s=e.vertexAttributes.normal;if(s==null)return null;const n=i.reprojection===ql.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=frt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===ql.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return prt(s,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let s=e.vertexAttributes.tangent;if(s==null)return null;const n=i.reprojection===ql.ECEF?i.transformBeforeProject:null;if(n!=null&&(s=mrt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===ql.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const o=e.vertexAttributes.position,a=n!=null?s:new Float32Array(s.length);return grt(s,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const s=this._getVertexOpacityAndColor(e),n=Wxe((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return Xxe(s,n,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s!=null&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n!=null&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(r),p=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===ql.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,p,f),geometryTransformation:a.reprojection===ql.NONE&&a.geometryTransformation!=null?a.geometryTransformation:ve()}}_computeReprojectionInfo(e){var n;const{vertexSpace:r}=e,i=r.isRelative,s=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===Ie.Local?ql.NONE:ql.ECEF:ql.NONE;if(i){const{origin:o}=r,a=ve(),l=((n=e.transform)==null?void 0:n.localMatrix)??sn;if(s===ql.NONE)return bl(e.spatialReference,o,a,this._context.renderCoordsHelper.spatialReference),{reprojection:s,objectTransformation:a,geometryTransformation:X2(l),needsBufferCopy:!1};const c=yR(ve(),o);return si(c,c,l),{reprojection:s,transformBeforeProject:c,needsBufferCopy:!0}}return{reprojection:s,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;ZM[0]=o.x,ZM[1]=o.y,ZM[2]=o.z??0;const a=ve();return bl(e.spatialReference,ZM,a,n),bn(wse,a),_S(r,r,wse),i==null&&s==null||(Th(XE,a),Sh(XE,XE),i!=null&&Wb(i,i,XE),s!=null&&Wb(s,s,XE,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??oS(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return i==null||e.spatialReference.equals(i)?s=r:(s=new Float64Array(r.length),oi(e.vertexAttributes.position,e.spatialReference,0,s,i,0,n)),xi(U8),Kc(U8,s,0,n),!Nd(U8,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!If(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,r);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:f}=s,m=this._getOrCreateComponents(e),y=new Array;let _=!1;for(const v of m){if(!this._validateFaces(e,v))return null;const w=this._getOrCreateFaces(e,v);if(w.length===0)continue;const T=this._createComponentNormals(n,c,v,w);T.didFlipNormals&&(_=!0);const x=[[E.POSITION,new Ve(n,3,!0)],[E.NORMAL,new Ve(T.normals,3,!0)]],S=[[E.POSITION,w],[E.NORMAL,T.indices]];a!=null&&(x.push([E.COLOR,new Ve(a,4,!0)]),S.push([E.COLOR,w])),l!=null&&(x.push([E.SYMBOLCOLOR,new Ve(l,4,!0)]),S.push([E.SYMBOLCOLOR,ZS(w.length)])),o!=null&&(x.push([E.UV0,new Ve(o,2,!0)]),S.push([E.UV0,w])),h!=null&&(x.push([E.TANGENT,new Ve(h,4,!0)]),S.push([E.TANGENT,w]));const O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(e,v),P=new js(A,x,S,null,os.Mesh,O);P.transformation=f,y.push(P)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:p}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},F8=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const ZM=C(),Yn=C(),nx=C(),ox=C(),ax=C(),wse=ve(),XE=Ni(),Lrt=ve(),U8=an(),Drt=[new drt],Nrt=new _2;var ql;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(ql||(ql={}));let Frt=class{constructor(e,r,i,s){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){SF(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>C_(o,e,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Ep),$e(e,this._lodRenderer.baseBoundingSphere.center,Ep)}getBoundingBoxObjectSpace(e=an()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Ep);const r=this._lodRenderer.baseBoundingBox;xi(e);for(let i=0;i<8;++i)se(vu,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),$e(vu,vu,Ep),$f(e,vu);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Ep),e.render.origin[0]+=Ep[12],e.render.origin[1]+=Ep[13],e.render.origin[2]+=Ep[14],e.render.num++}async getProjectedBoundingBox(e,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Urt,l=Yq(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Ep);for(let h=0;h<l;h++){const p=a[h];vu[0]=o[p[0]],vu[1]=o[p[1]],vu[2]=o[p[2]],$e(vu,vu,Ep),yv[3*h]=vu[0],yv[3*h+1]=vu[1],yv[3*h+2]=vu[2]}if(!e(yv,0,l))return null;xi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],yv[h+p]),o[p+3]=Math.max(o[p+3],yv[h+p]);c&&i.push({location:yv.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(Dd(o,V8),this.elevationContext.mode!=="absolute-height")){let h;const p=aZ(o,r.service.spatialReference,r);try{h=await r.service.queryElevation(V8[0],V8[1],s,p,"ground")}catch{}h!=null&&Wfe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){if(e===$g.Highlight){const i=new _N(e);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const yv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],vu=C(),V8=C(),Urt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Ep=ve();function Vrt(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new awe(r,i))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function zrt(t){return{levels:t.map(e=>Vrt(e))}}function krt(t){return t=t||globalThis.location.hostname,Brt.some(e=>(t==null?void 0:t.match(e))!=null)}function eG(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(BTe)!=null||e.match(jTe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(GTe)!=null||e.match(HTe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const BTe=/^devext.arcgis.com$/,GTe=/^qaext.arcgis.com$/,jTe=/^[\w-]*\.mapsdevext.arcgis.com$/,HTe=/^[\w-]*\.mapsqa.arcgis.com$/,Brt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,BTe,GTe,/^jsapps.esri.com$/,jTe,HTe];function Grt(t,e,r){if(t.count!==e.count)return void CF.error("source and destination buffers need to have the same number of elements");const i=t.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=r[9],y=r[10],_=r[11],v=r[12],w=r[13],T=r[14],x=r[15],S=t.typedBuffer,O=t.typedBufferStride,A=e.typedBuffer,P=e.typedBufferStride;for(let I=0;I<i;I++){const V=I*O,k=I*P,B=A[k],z=A[k+1],Z=A[k+2],W=A[k+3];S[V]=s*B+l*z+f*Z+v*W,S[V+1]=n*B+c*z+m*Z+w*W,S[V+2]=o*B+h*z+y*Z+T*W,S[V+3]=a*B+p*z+_*Z+x*W}}function jrt(t,e,r){WZ(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function WZ(t,e,r,i=4,s=i){if(t.length/i!=e.length/s)return void CF.error("source and destination buffers need to have the same number of elements");const n=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],h=r[4],p=r[5],f=r[6],m=r[7],y=r[8];let _=0,v=0;for(let w=0;w<n;w++){const T=e[_],x=e[_+1],S=e[_+2],O=e[_+3];t[v]=o*T+c*x+f*S,t[v+1]=a*T+h*x+m*S,t[v+2]=l*T+p*x+y*S,t[v+3]=O,_+=s,v+=i}}function Hrt(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);i[l]=y*h,i[l+1]=y*p,i[l+2]=y*f}}}function qrt(t,e,r){QN(t.typedBuffer,e,r,t.typedBufferStride)}function QN(t,e,r,i=4){const s=Math.min(t.length/i,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=r*n[a],t[l+1]=r*n[a+1],t[l+2]=r*n[a+2],t[l+3]=r*n[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:Hrt,scale:QN,scaleView:qrt,transformMat3:WZ,transformMat3View:jrt,transformMat4:Grt},Symbol.toStringTag,{value:"Module"}));function Wrt(t,e){XZ(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function XZ(t,e,r=2,i=r){const s=e.length/2;let n=0,o=0;if(Jd(e)||KAe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=r,o+=i;return}const a=eOe(e);if(QAe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=r,o+=i;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=r,o+=i}function Xrt(t,e,r,i){const s=t.typedBuffer,n=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:Xrt,normalizeIntegerBuffer:XZ,normalizeIntegerBufferView:Wrt},Symbol.toStringTag,{value:"Module"}));function Zrt(t,e){HR(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function HR(t,e,r=3,i=r){const s=e.length/i;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=r,o+=i}function Yrt(t,e,r,i,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:HR,copyView:Zrt,fill:Yrt},Symbol.toStringTag,{value:"Module"}));function Jrt(t,e){ZZ(t.typedBuffer,e,t.typedBufferStride)}function ZZ(t,e,r=4){const i=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=s}function Qrt(t,e,r,i,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let h=0;h<l;++h)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:ZZ,copyView:Jrt,fill:Qrt},Symbol.toStringTag,{value:"Module"}));let qTe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return jf(e)?(Jt(r),BH(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await Nr(r,{responseType:Krt[e]})).data;const s=await lu(this._streamDataRequester.request(r,e,i));if(s.ok===!0)return s.value;throw Po(s.error),new U("",`Request for resource failed: ${s.error}`)}};const Krt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function eit(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function tit(t,e={}){return{data:t,parameters:{wrap:{s:Lt.REPEAT,t:Lt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let Qb=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new U(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new Qb(this.major,this.minor,this._context)}static parse(e,r=""){const[i,s]=e.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!n.test(i))throw new U((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!s||!s.match||!n.test(s))throw new U((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(s,10);return new Qb(o,a,r)}};function wL(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:wL},Symbol.toStringTag,{value:"Module"}));let xse=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var NA,Tse;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(NA||(NA={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Tse||(Tse={}));const WTe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},rit={pbrMetallicRoughness:WTe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},iit={ESRI_externalColorMixMode:"tint"},Sse=(t={})=>{const e={...WTe,...t.pbrMetallicRoughness},r=sit({...iit,...t.extras});return{...rit,...t,pbrMetallicRoughness:e,extras:r}};function sit(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const nit={magFilter:At.LINEAR,minFilter:At.LINEAR_MIPMAP_LINEAR,wrapS:Lt.REPEAT,wrapT:Lt.REPEAT},oit=t=>({...nit,...t});function ait(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(e=s||"",r=n||"","")),{dirPart:e,filePart:r}}const YM={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let lit=class o0{constructor(e,r,i,s){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=ait(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new U("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new U("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new U("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(jf(r)){const o=Cb(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new o0(e,r,l)}catch{}const a=BH(r);if(o0._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new o0(e,r,o)}const s=await e.loadBinary(r,i);if(o0._isGLBData(s))return this._fromGLBData(e,r,s);const n=await e.loadJSON(r,i);return new o0(e,r,n)}static _isGLBData(e){if(e==null)return!1;const r=new xse(e);return r.remainingBytes()>=4&&r.readUint32()===YM.MAGIC}static async _fromGLBData(e,r,i){const s=await o0._parseGLBData(i);return new o0(e,r,s.json,s.binaryData)}static async _parseGLBData(e){const r=new xse(e);if(r.remainingBytes()<12)throw new U("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==YM.MAGIC)throw new U("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<n)throw new U("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new U("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),h=r.readUint32();if(l===0){if(h!==YM.CHUNK_TYPE_JSON)throw new U("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new U("gltf-loader-error","No JSON data found.");o=await _rt(r.readUint8Array(c))}else if(l===1){if(h!==YM.CHUNK_TYPE_BIN)throw new U("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else J.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new U("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new U("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,r);if(s.byteLength!==i.byteLength)throw new U("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,r){if(!this.json.accessors)throw new U("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new U("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[NA.MAT2,NA.MAT3,NA.MAT4])throw new U("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=hit[i.type],a=dit[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Ke.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Ke.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Ke.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Ke.UNSIGNED_BYTE:return wL(this._wrapAccessor(nS,i));case Ke.UNSIGNED_SHORT:return wL(this._wrapAccessor(J5,i));case Ke.UNSIGNED_INT:return wL(this._wrapAccessor(K5,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new U("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==Ke.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(on,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new U("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==Ke.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(on,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new U("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==Ke.FLOAT)throw new U("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Ke[i.componentType]);if(i.componentCount!==4)throw new U("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new ip(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new U("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new U("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Ke.FLOAT)return this._wrapAccessor(F_,i);if(!i.normalized)throw new U("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return pit(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new U("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new U("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Ke.FLOAT)return this._wrapAccessor(ip,i);if(i.componentType===Ke.UNSIGNED_BYTE)return this._wrapAccessor(aa,i);if(i.componentType===Ke.UNSIGNED_SHORT)return this._wrapAccessor(SR,i)}else if(i.componentCount===3){if(i.componentType===Ke.FLOAT)return this._wrapAccessor(on,i);if(i.componentType===Ke.UNSIGNED_BYTE)return this._wrapAccessor(Y5,i);if(i.componentType===Ke.UNSIGNED_SHORT)return this._wrapAccessor(Q5,i)}throw new U("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Ke[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var n,o,a,l,c,h,p,f,m,y;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const _=e.material!=null?Sse(this.json.materials[e.material]):Sse(),v=_.pbrMetallicRoughness,w=this.hasVertexColors(e),T=this.getTexture(v.baseColorTexture,r),x=this.getTexture(_.normalTexture,r),S=i?this.getTexture(_.occlusionTexture,r):void 0,O=i?this.getTexture(_.emissiveTexture,r):void 0,A=i?this.getTexture(v.metallicRoughnessTexture,r):void 0,P=e.material!=null?e.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:v.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await T,normalTexture:await x,name:_.name,id:P,occlusionTexture:await S,emissiveTexture:await O,emissiveFactor:_.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await A,hasVertexColors:w,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(f=(p=_.emissiveTexture)==null?void 0:p.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(y=(m=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:y.KHR_texture_transform}}return s}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new U("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,s=this.json.textures[i],n=oit(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return lhe(this._textureCache,i,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new U("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return cit;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?r=si(ve(),i,s.matrix):s.translation||s.rotation||s.scale?(r=X2(i),s.translation&&Sl(r,r,s.translation),s.rotation&&(JM[3]=pX(JM,s.rotation),lc(r,r,JM[3],JM)),s.scale&&b5(r,r,s.scale)):r=X2(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return Zc(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=Qb.parse(this.json.asset.version,"glTF");uit.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new U("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(e,n),n}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new U("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new VTe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new U("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new U("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new U("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return vrt(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await hV(Array.from(this._bufferLoaders.values())),r=await hV(Array.from(this._textureLoaders.values()));return e.reduce((i,s)=>i+((s==null?void 0:s.byteLength)??0),0)+r.reduce((i,s)=>i+(s?bb(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const cit=Nme(ve(),Math.PI/2),uit=new Qb(2,0,"glTF"),JM=Rh(),hit={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},dit={[Ke.BYTE]:1,[Ke.UNSIGNED_BYTE]:1,[Ke.SHORT]:2,[Ke.UNSIGNED_SHORT]:2,[Ke.FLOAT]:4,[Ke.INT]:4,[Ke.UNSIGNED_INT]:4};function pit(t){switch(t.componentType){case Ke.BYTE:return new eF(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_BYTE:return new Z5(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.SHORT:return new ER(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_SHORT:return new uX(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.UNSIGNED_INT:return new hX(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Ke.FLOAT:return new F_(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let fit=0;async function XTe(t,e,r={},i=!0){const s=await lit.load(t,e,r),n="gltf_"+fit++,o={lods:[],materials:new Map,textures:new Map,meta:mit(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await git(s,async(h,p,f,m)=>{const y=l.get(f)??0;l.set(f,y+1);const _=h.mode!==void 0?h.mode:Et.TRIANGLES,v=_===Et.TRIANGLES||_===Et.TRIANGLE_STRIP||_===Et.TRIANGLE_FAN?_:null;if(v==null)return void J.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Et[_]+"). Skipping primitive.");if(!s.hasPositions(h))return void J.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(h,r),T=s.getMaterial(h,r,i),x=s.hasNormals(h)?s.getNormalData(h,r):null,S=s.hasTangents(h)?s.getTangentData(h,r):null,O=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,r):null,A=s.hasVertexColors(h)?s.getVertexColors(h,r):null,P=s.getIndexData(h,r),I={transform:X2(p),attributes:{position:await w,normal:x?await x:null,texCoord0:O?await O:null,color:A?await A:null,tangent:S?await S:null},indices:await P,primitiveType:v,material:_it(o,await T,n)};let V=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(V=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:V},o.lods[f].parts[y]=I});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function mit(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const s=i.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function git(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),yit(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=t.getNodeTransform(a);if(c.weights!=null&&J.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=r.meshes[c.mesh];for(const f of p.primitives)n.push(e(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function yit(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function _it(t,e,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=tit(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:vit.includes(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=eit({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(s,n)}return s}const vit=[At.LINEAR_MIPMAP_LINEAR,At.LINEAR_MIPMAP_NEAREST];function bit(t,e){switch(e){case Et.TRIANGLES:return wit(t);case Et.TRIANGLE_STRIP:return xit(t);case Et.TRIANGLE_FAN:return Tit(t)}}function wit(t){return typeof t=="number"?oS(t):N0(t)?new Uint16Array(t):t}function xit(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=yN(3*r);if(typeof t=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=t[n],i[s++]=t[n+1],i[s++]=t[n+2]):(i[s++]=t[n+1],i[s++]=t[n],i[s++]=t[n+2])}return i}function Tit(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const s=t[0];let n=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}let Sit=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},Eit=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new Sit,this.numberOfVertices=0}};const Mm=J.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function ZTe(t,e){const r=await Cit(t,e),i=await Mit(r.textureDefinitions??{},e);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+Cbe(r)}}async function Cit(t,e){const r=e!=null&&e.streamDataRequester;if(r)return Ait(t,r,e);const i=await lu(Nr(t,e));if(i.ok===!0)return i.value.data;Po(i.error),YTe(i.error)}async function Ait(t,e,r){const i=await lu(e.request(t,"json",r));if(i.ok===!0)return i.value;Po(i.error),YTe(i.error.details.url)}function YTe(t){throw new U("",`Request for object resource failed: ${t}`)}function Oit(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(Mm.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Mm.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Mm.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(Mm.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else Mm.warn("Indexed geometries must specify faces"),i=!1;break}default:Mm.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(Mm.warn("Geometry requires material"),i=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(Mm.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function Rit(t,e){var y;const r=new Array,i=new Array,s=new Array,n=new YS,o=t.resource,a=Qb.parse(o.version||"1.0","wosr");Iit.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions??{},p=t.textures;let f=0;const m=new Map;for(let _=0;_<c.length;_++){const v=c[_];if(!Oit(v))continue;const w=$it(v),T=v.params.vertexAttributes,x=[];for(const z in T){const Z=T[z],W=Z.values;x.push([z,new Ve(W,Z.valuesPerElement,!0)])}const S=[];if(v.params.topology!=="PerAttributeArray"){const z=v.params.faces;for(const Z in z)S.push([Z,z[Z].values])}const O=w.texture,A=p&&p[O];if(A&&!m.has(O)){const{image:z,parameters:Z}=A,W=new Tw(z,Z);i.push(W),m.set(O,W)}const P=m.get(O),I=P?P.id:void 0,V=w.material;let k=n.get(V,O);if(k==null){const z=h[V.substring(V.lastIndexOf("/")+1)].params;z.transparency===1&&(z.transparency=0);const Z=A&&A.alphaChannelUsage,W=z.transparency>0||Z==="transparency"||Z==="maskAndTransparency",H=A?JTe(A.alphaChannelUsage):void 0,Y={ambient:Ia(z.diffuse),diffuse:Ia(z.diffuse),opacity:1-(z.transparency||0),transparent:W,textureAlphaMode:H,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:mi.None,colorMixMode:z.externalColorMixMode||"tint",textureAlphaPremultiplied:(A==null?void 0:A.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParamsMixin&&Object.assign(Y,e.materialParamsMixin),k=new kf(Y),n.set(V,O,k)}s.push(k);const B=new js(k,x,S);f+=((y=S.find(z=>z[0]===E.POSITION))==null?void 0:y[1].length)??0,r.push(B)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:Pit(r)}}function Pit(t){const e=xi();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&($f(e,i.bbMin),$f(e,i.bbMax))}),e}async function Mit(t,e){const r=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){Mm.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:Lt.REPEAT,t:Lt.REPEAT},preMultiplyAlpha:JTe(h)!==Xr.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):Lg(l,e);r.push(f.then(m=>({refId:c,image:m,parameters:p,alphaChannelUsage:h})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function JTe(t){switch(t){case"mask":return Xr.Mask;case"maskAndTransparency":return Xr.MaskBlend;case"none":return Xr.Opaque;default:return Xr.Blend}}function $it(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const Iit=new Qb(1,2,"wosr"),lx=2.1;async function QTe(t,e){var p;const r=KTe(eG(t));if(r.fileType==="wosr"){const f=await(e.cache?e.cache.loadWOSR(r.url,e):ZTe(r.url,e)),{engineResources:m,referenceBoundingBox:y}=Rit(f,e);return{lods:m,referenceBoundingBox:y,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):XTe(new qTe(e.streamDataRequester),r.url,e,e.usePBR)),s=(p=i.model.meta)==null?void 0:p.ESRI_proxyEllipsoid,n=i.meta.isEsriSymbolResource&&s!=null&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,Fit(i,s));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...SKe]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...LF]},l={...e.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=e2e(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function KTe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function e2e(t,e,r,i){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=xi();return s.lods.forEach((h,p)=>{const f=i.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&p!==i.singleLodIndex;if(f&&p!==0)return;const m=new Eit(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(y=>{const _=f?new kf({}):Lit(s,y,m,e,r,o,a),{geometry:v,vertexCount:w}=Dit(y,_??new kf({})),T=v.boundingInfo;T!=null&&p===0&&($f(c,T.bbMin),$f(c,T.bbMax)),_!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=w)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function Lit(t,e,r,i,s,n,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,h=e.attributes.normal!=null;if(l==null)return null;const p=Nit(l.alphaMode);if(!n.has(a)){if(c){const O=(A,P=!1)=>{if(A!=null&&!o.has(A)){const I=t.textures.get(A);if(I!=null){const V=I.data;o.set(A,new Tw(bb(V)?V.data:V,{...I.parameters,preMultiplyAlpha:!bb(V)&&P,encoding:bb(V)&&V.encoding!=null?V.encoding:void 0}))}}};O(l.textureColor,p!==Xr.Opaque),O(l.textureNormal),O(l.textureOcclusion),O(l.textureEmissive),O(l.textureMetallicRoughness)}const m=l.color[0]**(1/lx),y=l.color[1]**(1/lx),_=l.color[2]**(1/lx),v=l.emissiveFactor[0]**(1/lx),w=l.emissiveFactor[1]**(1/lx),T=l.emissiveFactor[2]**(1/lx),x=l.textureColor!=null&&c?o.get(l.textureColor):null,S=jxe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});n.set(a,new kf({...i,transparent:p===Xr.Blend,customDepthTest:Vb.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?mi.None:mi.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:h?Ar.Attribute:Ar.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:x!=null?x.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:x!=null&&!!x.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,w,T],mrrFactors:S?[...VZ]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:df(l.colorTextureTransform),normalTextureTransformMatrix:df(l.normalTextureTransform),occlusionTextureTransformMatrix:df(l.occlusionTextureTransform),emissiveTextureTransformMatrix:df(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:df(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(r.stageResources.materials.push(f),c){const m=y=>{y!=null&&r.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function Dit(t,e){const r=t.attributes.position.count,i=bit(t.indices||r,t.primitiveType),s=Ji(3*r),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;_S(s,n,t.transform,3,o);const a=[[E.POSITION,new Ve(s,3,!0)]],l=[[E.POSITION,i]];if(t.attributes.normal!=null){const c=Ji(3*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.normal;b_(QM,t.transform),Wb(c,h,QM,3,p),a.push([E.NORMAL,new Ve(c,3,!0)]),l.push([E.NORMAL,i])}if(t.attributes.tangent!=null){const c=Ji(4*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.tangent;b_(QM,t.transform),WZ(c,h,QM,4,p),a.push([E.TANGENT,new Ve(c,4,!0)]),l.push([E.TANGENT,i])}if(t.attributes.texCoord0!=null){const c=Ji(2*r),{typedBuffer:h,typedBufferStride:p}=t.attributes.texCoord0;XZ(c,h,2,p),a.push([E.UV0,new Ve(c,2,!0)]),l.push([E.UV0,i])}if(t.attributes.color!=null){const c=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof ip?QN(c,t.attributes.color,255):t.attributes.color instanceof aa?ZZ(c,t.attributes.color):t.attributes.color instanceof SR&&QN(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof on?BN(c,t.attributes.color,255,4):t.attributes.color instanceof Y5?HR(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof Q5&&BN(c,t.attributes.color,1/256,4)),a.push([E.COLOR,new Ve(c,4,!0)]),l.push([E.COLOR,i])}return{geometry:new js(e,a,l),vertexCount:r}}const QM=Ni();function Nit(t){switch(t){case"BLEND":return Xr.Blend;case"MASK":return Xr.Mask;case"OPAQUE":case null:case void 0:return Xr.Opaque}}function Fit(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=C(),c=C(),h=C(),p=new Uint8Array(4*a),f=new Float64Array(3*a),m=bn(ve(),s.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),$e(c,c,s.transform),he(h,c,e.center),RD(h,h,e.radius);const w=h[2],T=Ee(h),x=Math.min(.45+.55*T*T,1);RD(h,h,e.radius),m!==null&&$e(h,h,m),ge(h,h),r+1!==t.model.lods.length&&t.model.lods.length>1&&Br(h,h,l,w>-1?.2:Math.min(-4*w-3.8,1)),f[y]=h[0],f[y+1]=h[1],f[y+2]=h[2],y+=3,p[_]=255*x,p[_+1]=255*x,p[_+2]=255*x,p[_+3]=255,_+=4}s.attributes.normal=new on(f),s.attributes.color=new aa(p)}}}const NMt=Object.freeze(Object.defineProperty({__proto__:null,fetch:QTe,gltfToEngineResources:e2e,parseUrl:KTe},Symbol.toStringTag,{value:"Module"})),Uit=()=>!!oe("enable-feature:force-wosr"),FMt=()=>!!oe("enable-feature:direct-3d-object-feature-layer-display"),Vit=()=>oe.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),zit=()=>oe.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),UMt=()=>!!oe("enable-i3s-patching"),kit=()=>oe.add("enable-i3s-patching",!0,!0,!0),Bit=()=>oe.add("enable-i3s-patching",!1,!0,!0),Ese=()=>!!oe("enable-feature:SceneLayer-editing"),Git=(t="i3s-patching")=>{switch(Bit(),zit(),oe.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":Vit();break;case"i3s-patching":kit()}};Git("i3s-patching");let z8={};async function jit(t,e){try{return{data:(await JZ(t,e)).data,baseUrl:HH(t),styleUrl:t}}catch(r){return Po(r),null}}function Hit(t,e,r){const i=e.portal!=null?e.portal:jn.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${t}`;return z8[n]||(z8[n]=qit(t,i,r).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl??"",styleName:t}))),z8[n]}function qit(t,e,r){return e.load(r).then(()=>{const i=new af({disableExtraQuery:!0,query:`owner:${Cse} AND type:${Ase} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let s=null;const n=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===Ase&&a.owner===Cse){s=a;break}}if(!s)throw new U("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(r)})}function YZ(t,e,r){return t&&t.styleUrl!=null?jit(t.styleUrl,r):t&&t.styleName!=null?Hit(t.styleName,e,r):Promise.reject(new U("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function t2e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function r2e(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Uit())for(const i of r){const s=t.formatInfos.find(n=>n.type===i);if(s)return s.href}return t.webRef}function JZ(t,e){const r={responseType:"json",query:{f:"json"},...e};return Nr(Bd(t),r)}const Cse="esri_en",Ase="Style",Wit="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",ZE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function Xit(t,e=ZE){var a,l;if(!t)return{symbol:null};const{retainId:r=ZE.retainId,ignoreDrivers:i=ZE.ignoreDrivers,hasLabelingContext:s=ZE.hasLabelingContext,retainCIM:n=ZE.retainCIM}=e;let o=null;if(Db(t)||t instanceof pw)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new U("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=n?t.clone():k0.fromCIMSymbol(t)}else if(t instanceof Oh)o=f5.fromSimpleLineSymbol(t);else if(t instanceof L_)o=k0.fromSimpleMarkerSymbol(t);else if(t instanceof g5)o=k0.fromPictureMarkerSymbol(t);else if(t instanceof dw)o=e.geometryType&&e.geometryType==="mesh"?m5.fromSimpleFillSymbol(t):gR.fromSimpleFillSymbol(t);else{if(!(t instanceof BS))return{error:new U("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=s?p5.fromTextSymbol(t):k0.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&Db(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function KN(t,e,r,i){const s=i2e(t,{},{context:i,isLabelSymbol:!1});s!=null&&(e[r]=s)}function Ose(t,e,r,i){const s=i2e(t,{},{context:i,isLabelSymbol:!0});s!=null&&(e[r]=s)}function Rse(t){return t instanceof kS||t instanceof pw}function i2e(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!Rse(t)){const a=Xit(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!bde(i==null?void 0:i.layer))&&Rse(t)?(o==null||o.push(new U("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function s2e(t,e){return m5e(t,null,e)}function Zit(t,e,r,i){const s=t.name;return s==null?Promise.reject(new U("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?Yit(s,e,i):YZ(t,e,i).then(n=>KZ(Ql(n),s,e,r,r2e,i))}function QZ(t,e){return e.items.find(r=>r.name===t)}function KZ(t,e,r,i,s,n){var m;const o=r&&r.portal!=null?r.portal:jn.getDefault(),a={portal:o,url:go(t.baseUrl),origin:"portal-item"},l=QZ(e,t.data);if(!l){const y=`The symbol name '${e}' could not be found`;return Promise.reject(new U("symbolstyleutils:symbol-name-not-found",y,{symbolName:e}))}let c=Ag(s(l,i),a),h=((m=l.thumbnail)==null?void 0:m.href)??null;const p=l.thumbnail&&l.thumbnail.imageData;krt()&&(c=eG(c)??"",h=eG(h));const f={portal:o,url:go(HH(c)),origin:"portal-item"};return JZ(c,n).then(y=>{const _=i==="cimRef"?t2e(y.data):y.data,v=s2e(_,f);if(v&&Db(v)){if(h){const w=Ag(h,a);v.thumbnail=new cb({url:w})}else p&&(v.thumbnail=new cb({url:`data:image/png;base64,${p}`}));t.styleUrl?v.styleOrigin=new uO({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(v.styleOrigin=new uO({portal:r.portal,styleName:t.styleName,name:e}))}return v})}function Yit(t,e,r){const i=Wit.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:jn.getDefault();return JZ(i,r).then(n=>{const o=t2e(n.data);return s2e(o,{portal:s,url:go(HH(i)),origin:"portal-item"})})}const Jit=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:KZ,getStyleItemFromStyle:QZ,resolveWebStyleSymbol:Zit},Symbol.toStringTag,{value:"Module"}));async function Qit(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new U("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await YZ(t,r).catch(()=>null);if(i===null)return null;const s=QZ(e,i.data);if(s&&!((a=s.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const n=await KZ(i,e,r,"webRef",(l,c)=>r2e(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Kit=class{constructor(e,r,i){this._elementSize=r,this._buffer=Ir.createVertex(e,xr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},est=class{constructor(e){this.modelOriginHi=e.getField(E.MODELORIGINHI,on),this.modelOriginLo=e.getField(E.MODELORIGINLO,on),this.model=e.getField(E.MODEL,x_),this.modelNormal=e.getField(E.MODELNORMAL,x_),this.featureAttribute=e.getField(E.INSTANCEFEATUREATTRIBUTE,ip),this.color=e.getField(E.INSTANCECOLOR,aa),this.objectAndLayerIdColor=e.getField(E.INSTANCEOBJECTANDLAYERIDCOLOR,aa)}},Pse=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){tt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){tt(this._updating,"not updating"),this.size<BAe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){tt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),tt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){tt(this._updating,"not updating"),tt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(e4,Math.floor(this._capacity*$4));this._resize(e)}_shrink(){const e=Math.max(e4,Math.floor(this._capacity*kAe));this._resize(e)}_resize(e){if(tt(this._updating,"not updating"),e===this._capacity)return;const r=new Kit(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);tt(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new est(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const e4=64;var Mi;function tst(t){let e=ji().mat4f64(E.LOCALTRANSFORM).mat4f64(E.GLOBALTRANSFORM).vec4f64(E.BOUNDINGSPHERE).vec3f64(E.MODELORIGIN).mat3f(E.MODEL).mat3f(E.MODELNORMAL).vec2f(E.MODELSCALEFACTORS);return t.includes(E.FEATUREATTRIBUTE)&&(e=e.vec4f(E.FEATUREATTRIBUTE)),t.includes(E.COLOR)&&(e=e.vec4u8(E.COLOR)),t.includes(E.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(E.OBJECTANDLAYERIDCOLOR)),e=e.u8(E.STATE).u8(E.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Mi||(Mi={}));let Mse=class{constructor(e){this.localTransform=e.getField(E.LOCALTRANSFORM,SO),this.globalTransform=e.getField(E.GLOBALTRANSFORM,SO),this.modelOrigin=e.getField(E.MODELORIGIN,Eh),this.model=e.getField(E.MODEL,x_),this.modelNormal=e.getField(E.MODELNORMAL,x_),this.modelScaleFactors=e.getField(E.MODELSCALEFACTORS,F_),this.boundingSphere=e.getField(E.BOUNDINGSPHERE,X5),this.featureAttribute=e.getField(E.FEATUREATTRIBUTE,ip),this.color=e.getField(E.COLOR,aa),this.objectAndLayerIdColor=e.getField(E.OBJECTANDLAYERIDCOLOR,aa),this.state=e.getField(E.STATE,nS),this.lodLevel=e.getField(E.LODLEVEL,nS)}},aT=class extends xe{constructor(e,r){super(e),this.events=new Is,this._capacity=0,this._size=0,this._next=0,this._layout=tst(r),this._capacity=e4,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Mse(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Mi.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;tt(e>=0&&e<this._capacity&&(r.get(e)&Mi.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Mi.ACTIVE)?this._setStateFlags(e,Mi.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;tt(e>=0&&e<this._capacity&&(r.get(e)&Mi.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=$l,s=Gh;r.localTransform.getMat(e,$se),r.globalTransform.getMat(e,k8);const n=si(k8,k8,$se);se(i,n[12],n[13],n[14]),r.modelOrigin.setVec(e,i),Th(s,n),r.model.setMat(e,s);const o=_6e($l,n);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),bw(s,s),Sh(s,s),r.modelNormal.setMat(e,s),this._setStateFlags(e,Mi.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Gh),i.modelOrigin.getVec(e,$l),r[0]=Gh[0],r[1]=Gh[1],r[2]=Gh[2],r[3]=0,r[4]=Gh[3],r[5]=Gh[4],r[6]=Gh[5],r[7]=0,r[8]=Gh[6],r[9]=Gh[7],r[10]=Gh[8],r[11]=0,r[12]=$l[0],r[13]=$l[1],r[14]=$l[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor($l,this,e),r*=Math.max($l[0],$l[1],$l[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor($l,this,e),r*=rst($l[0],$l[1],$l[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Mi.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Mi.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Mi.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Mi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(e4,Math.floor(this._capacity*$4)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Mse(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Mi.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function rst(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}u([d({constructOnly:!0})],aT.prototype,"shaderTransformation",void 0),u([d()],aT.prototype,"_size",void 0),u([d({readOnly:!0})],aT.prototype,"size",null),aT=u([R("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],aT);const $l=C(),Gh=Ni(),$se=ve(),k8=ve();let ist=class extends Vd{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=ys(),this._tmpMat4=ve()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);$e(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*Y2(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},sst=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const s=i.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},nst=class extends rF{constructor(e,r,i,s,n,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function eY(t){return lp(t)&&t.intersector===Bi.LOD&&!!t.target}let ost=class{constructor(e,r){const i=e.renderContext.rctx,s=r.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new bxe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Ir.createVertex(i,xr.STATIC_DRAW,l.buffer),this.vao=new ap(i,vr,{geometry:xc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,s,(h,p,f,m,y)=>{if(h>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,h))return;const _=new nst(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(Bi.LOD,_,h,p,e.transform.transform,y),e.options.store!==fo.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(Bi.LOD,_,h,p,e.transform.transform,y),e.options.store===fo.ALL){const v=_X(e.results.min.ray);v.set(Bi.LOD,_,h,p,e.transform.transform,y),e.results.all.push(v)}}})}},ast=class n2e{static async create(e,r,i){const s=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new ost(e,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(nw);if(yn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Jt(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new n2e(r.minScreenSpaceRadius,n)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(e,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=xi();this.components.forEach(r=>{r.boundingInfo!=null&&($f(e,r.boundingInfo.bbMin),$f(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=C();Dd(e,r),this._boundingSphere={center:r,radius:.5*qfe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const lst=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new sst(e,r)};let Fu=class extends xe{constructor(e,r){super(e),this.type=Bi.LOD,this.isGround=!1,this._handles=new Pi,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new lt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[ce.OPAQUE_MATERIAL,ce.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new aT({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(r.registerTask(dt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=ust(this.optionalFields),this._glInstanceBufferLayout=xc(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(r=>r.forEach(i=>{e.cpu+=i.memoryUsage.cpu,e.gpu+=i.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=i.triangleCount;r.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new Pse(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new Pse(i,this._instanceBufferLayout)),ast.create(e,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(nw);if(yn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Jt(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=lst(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(ce.TRANSPARENT_MATERIAL,L.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!ni.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Fa),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>i.push(this._beginComponent(e,s[o],a)))})),i}render(e,r){const i=this._getInstanceDatas(e.output);if(!i)return;let s=0;e.rctx.bindVAO(),i.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[s++],n[a],l,a))}))}_getInstanceDatas(e){const r=e!==L.Highlight&&e!==L.ShadowHighlight,i=e!==L.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=C();he(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,Dse),e.transform.set(Dse),$e(Nse,i,e.transform.inverse),$e(Fse,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;tt((l&Mi.ACTIVE)!=0,"invalid instance state"),tt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,r,Nse,Fse,a,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new ist(r,this.baseBoundingSphere);for(let s=0;s<r.capacity;++s)i.get(s)&Mi.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Pe(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Vd.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(r,Vd.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Cp),he(Cp,Cp,n);const a=me(Cp,r)-Cp[3];o.boundingSphere.getVec(s,Cp),he(Cp,Cp,n);const l=me(Cp,r)+Cp[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:s}=this;this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Mi.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(p&Mi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][m].freeTail(),p&Mi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][m].freeTail(),p&Mi.REMOVE)n.freeInstance(c);else if(p&Mi.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,Lse),y=s.selectLevel(Lse,n.getCombinedMedianScaleFactor(c),i)),f=p&~(Mi.ACTIVE|Mi.TRANSFORM_CHANGED),y>=0&&(p&Mi.HIGHLIGHT?(Ise(this._highlightRenderInstanceData[0][y],o,c),f|=Mi.HIGHLIGHT_ACTIVE):(Ise(this._defaultRenderInstanceData[0][y],o,c),f|=Mi.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(Mi.ACTIVE|Mi.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const y=!!(p&Mi.ACTIVE),_=!!(f&Mi.ACTIVE);!y&&_?this._octreeCached.addInstance(c):y&&!_?this._octreeCached.removeInstance(c):y&&_&&p&Mi.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){const{bindParameters:s,rctx:n,output:o}=e;if(r.size===0||!i.material.requiresSlot(s.slot,e.output))return null;const a=i.glMaterials.load(n,s.slot,o);return a!=null?a.beginSlot(s):null}_renderComponent(e,r,i,s,n){var v;if(!r)return;const{bindParameters:o,rctx:a}=e;(v=a.appleAmdDriverHelper)==null||v.resetIndicesType();const l=a.bindTechnique(r,s.material.parameters,o);a.bindVAO(s.vao),r.ensureAttributeLocations(s.vao),l.bindDraw(hst,o,s.material.parameters),ni.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===L.Color&&(l.setUniform4fv("externalColor",Use[Math.min(n,Use.length-1)]),l.setUniform1i("colorMixMode",k1e.replace));const c=a.capabilities.instancing,h=i.capacity,p=i.headIndex,f=i.tailIndex,m=i.firstIndex,y=this._glInstanceBufferLayout,_=(w,T)=>{kW(a,vr,i.buffer,y,w),c.drawArraysInstanced(r.primitiveType,0,s.vertexCount,T-w),BW(a,vr,i.buffer,y)};s.material.parameters.transparent&&m!=null?p>f?(tt(m>=f&&m<=p,"invalid firstIndex"),_(m,p),_(f,m)):p<f&&(m<=p?(tt(m>=0&&m<=p,"invalid firstIndex"),_(m,p),_(f,h),_(0,m)):(tt(m>=f&&m<=h,"invalid firstIndex"),_(m,h),_(0,p),_(f,m))):p>f?_(f,p):p<f&&(_(0,p),_(f,h)),a.bindVAO(null)}};function Ise(t,e,r){const i=t.allocateHead();cst(e,r,t.view,i)}function cst(t,e,r,i){sBe(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function ust(t){let e=ji().vec3f(E.MODELORIGINHI).vec3f(E.MODELORIGINLO).mat3f(E.MODEL).mat3f(E.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(E.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(E.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(E.INSTANCEOBJECTANDLAYERIDCOLOR)),e}u([d({constructOnly:!0})],Fu.prototype,"symbol",void 0),u([d({constructOnly:!0})],Fu.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],Fu.prototype,"metadata",void 0),u([d({constructOnly:!0})],Fu.prototype,"shaderTransformation",void 0),u([d()],Fu.prototype,"_instanceData",void 0),u([d()],Fu.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],Fu.prototype,"_enableLevelSelection",null),u([d()],Fu.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],Fu.prototype,"running",null),Fu=u([R("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Fu);const Lse=C(),Cp=Zt(),Dse=ve(),Nse=C(),Fse=C(),Use=[Nt(1,0,1,1),Nt(0,0,1,1),Nt(0,1,0,1),Nt(1,1,0,1),Nt(1,0,0,1)],hst=new VKe;let Vse=class{constructor(e,r,i,s,n,o,a,l,c,h,p,f){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}},dst=class extends Kf{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,s){super(e,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&TF(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&oYe(r.primitive)?r.primitive:ome;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await Qit(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}_setMaterialTransparencyParams(e,r=(s=>(s=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:s.color)()){const n=this._getCombinedOpacity(r),o=n<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=n,e.cullFace=o?mi.None:mi.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,s=an(W4e(e)),n=Ia(bP(s)),o=Ia(N6(n,i)),a=Ee(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...VZ],ambient:sg,diffuse:sg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:T,minWorldLength:x,maxWorldLength:S}=f.verticalOffset;h.verticalOffset={screenLength:uo(T),minWorldLength:x||0,maxWorldLength:S??1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=sh;else{const T=i.material!=null?i.material.color:null,x=T!=null?ke.toUnitRGBA(T):sh;h.externalColor=x}this._fastUpdates=pS(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),h.isInstanced=!0,this._fastUpdates?(Object.assign(h,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(h.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),oe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const m=new kf(h),y=cwe(e,m);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=PM(y).map(T=>({opacity:1,transparent:T.parameters.transparent})),v=await this._createStageResources(y,p,r),w=await this._createLodRenderer(y,r);return new Vse(y,w,v,_,n,l,c,s,o,a,p,null)}async _createResourcesForUrl(e,r){var k,B;const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=pS(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),oe("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:z,minWorldLength:Z,maxWorldLength:W}=s.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:uo(z),minWorldLength:Z||0,maxWorldLength:W??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const n=i.usePBR,o=await QTe(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=zrt(o.lods);c.levels.sort((z,Z)=>z.minScreenSpaceRadius-Z.minScreenSpaceRadius);const h=this._context,p=this.symbolLayer.material,f=this._getExternalColorParameters(p),m=(B=(k=this.symbolLayer)==null?void 0:k.material)==null?void 0:B.color,y=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=PM(c),w=PM(c).map(z=>({opacity:z.parameters.opacity||1,transparent:z.parameters.transparent}));v.forEach(z=>{const Z=z.parameters;z.setParameters(f);const W=Z.opacity*y,H=W<1||_||Z.transparent;z.setParameters({opacity:W,transparent:H}),h.screenSizePerspectiveEnabled&&z.setParameters({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})});const T=o.referenceBoundingBox,x=Ia(bP(T)),S=Ia(c.levels[0].pivotOffset),O=Ia(N6(x,this.symbolLayer)),A=Ee(O),P=this._fastUpdates;fS(P,this._context.renderer,this._fastVisualVariableConvertOptions(T,O,x,S))&&v.forEach(z=>z.setParameters(P.materialParameters));const I=await this._createStageResources(c,n,r),V=await this._createLodRenderer(c,r);return new Vse(c,V,I,w,x,a,l,T,O,A,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const s=this._context.stage,n=PM(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=zre(e);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),Jt(i);const a=kre(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,h)=>{l.getFeatureAttribute(c,KM),$s(h,C7(n.materialParameters,KM,h))},scaleFactor:(l,c,h)=>{c.getFeatureAttribute(h,KM),vXe(l,n.materialParameters,KM)}}:null,a=new Fu({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=sh:e!=null&&e.color!=null?r.externalColor=ke.toUnitRGBA(e.color):(r.externalColor=sh,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=LO(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new cp),n=e.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var n,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:o.color,h=s[a],p=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*h.opacity,f=p<1||e||h.transparent;l.setParameters({opacity:p,transparent:f}),this._isPrimitive&&l.setParameters({cullFace:f?mi.None:mi.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,A_)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return Ps.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!fS(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return Ps.RecreateSymbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Ps.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=lwe(e.levels[0]).reduce((n,o)=>n+o.indices.get(E.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>o+F0(a.data),0)+Array.from(n.indices.values()).reduce((o,a)=>o+F0(a),0),s=zre(e).reduce((n,o)=>n+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+kre(e).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...fwe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(yo(r,cx,this._context.elevationProvider.spatialReference),l!=null&&!Xq(l,cx))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(r,s,B8,e$),p=this._computeLocalTransform(this._resources,this.symbolLayer,i,zse),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,AA(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const y=new Frt(this,m,qZe,s);return c&&(y.alignedSampledElevation=e$.sampledElevation),y.needsElevationUpdates=A_(s.mode),IO(y,r,this._context.elevationProvider),y}_computeGlobalTransform(e,r,i,s){return C_(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),cx[0]=e.x,cx[1]=e.y,cx[2]=s.z,bl(e.spatialReference,cx,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,s){return wh(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(e,i,s),this._applyAnchor(e,r,s),s}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:e.symbolSize,n=Ure(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||b5(i,i,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&LO(r);if(i==null)return!1;const s=this.getGeometryElevationMode(r);return e.elevationContext.mode===s&&(this._computeGlobalTransform(i,e.elevationContext,B8,e$),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=e$.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,B8,!0),IO(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),p=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===qc.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Ia(N6(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(m,f,_,zse),w=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=s!=null?ke.toUnitRGBA(s):sh;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var s;if(!((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)||!r)return DZe(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const s=C();switch(i.anchor){case"center":re(s,Dd(e)),na(s,s);break;case"top":{const n=Dd(e);se(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=Dd(e);se(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=Dd(e),o=bP(e),a=i.anchorPosition,l=a?Ae(a.x,a.y,a.z):za;Z4(s,o,l),le(s,s,n),na(s,s);break}default:r!=null?na(s,r):re(s,za)}return s}_applyAnchor(e,r,i){var n;if((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);s&&Sl(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,s){const n=e!=null?Ia(bP(e)):sg,o=e!=null?this._computeAnchor(e,s,this.symbolLayer):za,a=this._context.renderCoordsHelper.unitInMeters,l=Ure(r??void 0,r,i,a),c=Ae(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new LR({size:!0,color:!0,rotation:!0,opacity:!1},n,r??sg,a,o,l,c)}};const cx=C(),zse=ve(),B8=ve(),KM=Zt(),e$=new FR;let pst=class{constructor(e,r,i,s){this.vertices=e,this.positionsES=r,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=i[a],c=i[a+1],h=i[a+2];this.origin=Ae(l,c,h),this.positions=Ji(3*n);const p=this.offset+3*n;for(let f=this.offset;f<p;f+=3)this.positions[f]=i[f]-l,this.positions[f+1]=i[f+1]-c,this.positions[f+2]=i[f+2]-h;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const s=this.positions;r.vRight[0]=s[i+3]-s[i],r.vRight[1]=s[i+4]-s[i+1],r.vRight[2]=s[i+5]-s[i+2],i+=3;let n=Ee(r.vRight);r.vMinSiblingLength=n,ge(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[i+3]-s[i],l.vRight[1]=s[i+4]-s[i+1],l.vRight[2]=s[i+5]-s[i+2];const c=Ee(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,ge(l.vRight,l.vRight)}else re(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,i+=3}}},fst=class{constructor(e,r,i,s,n,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=Zke(1*this.numVerticesTotal),this.profileRightAxes=Ji(4*this.numVerticesTotal),this.profileUpAxes=Ji(4*this.numVerticesTotal),this.profileVertexAndNormals=Ji(4*this.numVerticesTotal),this.positions=gN(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=gN(e,r,3*i.length);let s=0;const n=(a,l,c,h,p)=>this.emitCapVertex(s,a,l,c,h,p),o=(a,l,c,h)=>this.emitVertex(s,a,l,c,h);for(this.startCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=1;s<i.length-1;++s)this.extruder.extrude(i[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(i[s],n),s=i.length-1,this.endCap.rebuildCapGeometry(i[s],n)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,p)=>{n.push(c),n.push(h),n.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<r;++c){const h=this.profile.indices[2*c],p=this.profile.indices[2*c+1];for(let f=0;f<i;++f){const m=f*e+h,y=(f+1)*e+p,_=f*e+p;l(m,(f+1)*e+h,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Ef(n),this.normalIndices=Ef(o),this.pathVertexIndices=Ef(a)}onPathChanged(){this._rebuildGeometry()}},tY=class{rebuildConnectingProfileGeometry(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],0,0)}},kse=class extends tY{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},t$=class extends tY{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const s=this.profilePlaneOffset;for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],s,0)}rebuildCapGeometry(e,r){const i=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=o2e;sr(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,n,s)}buildTopology(e,r){const i=this.profile,s=this.vertexBufferStart+i.indices[0];for(let n=1;n<i.numSegments;++n){const o=i.indices[2*n],a=i.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,s):r(s,l,c)}}},Bse=class extends tY{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const s=r.indices[2*i],n=r.indices[2*i+1];r.poleIndices[s]===r.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,s=e.frame,n=.5*this.sign,o=mst,a=o2e;sr(a,0,0);for(const l of i.poles)l.normal?r(s,l.position,l.normal,n,0):r(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(s,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,h=Math.sin(c),p=Math.cos(c);for(let f=0;f<i.vertices.length;++f){const m=i.poles[i.poleIndices[f]];uf(o,i.vertices[f],m.position),sc(o,o,h),m.normal?(Sd(o,o,m.position),r(s,o,m.normal,n*p,0)):(wO(a,o),sc(a,a,h),Sd(o,o,m.position),r(s,o,a,n*p,this.sign*p))}}}buildTopology(e,r){const i=this.profile,s=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],h=this.vertexBufferStart+i.poleIndices[l];let p=s+a,f=s+l;for(let m=0;m<this.numSegments-1;++m){const y=n+m*i.vertices.length+a,_=n+m*i.vertices.length+l;this.flip?(r(y,f,p),r(f,y,_)):(r(p,f,y),r(_,y,f)),p=y,f=_}this.flip?(r(c,f,p),c!==h&&r(c,h,f)):(r(p,f,c),c!==h&&r(f,h,c))}}};const mst=Ue(),o2e=Ue();let gst=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],!1)}},G8=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const s=_st,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){cu(jse,.5*-n+c*n/this.numBendSubdivisions,l),yst(s,a,jse);for(let h=0;h<r.vertices.length;++h)Ys(r.vertices[h],o)*n>=0?i(s,r.vertices[h],r.normals[h],!1):i(a,e.applyMiterStretch(Gse,r.vertices[h]),r.normals[h],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const h=Ys(r.vertices[c],o)*n>=0;i(a,e.applyMiterStretch(Gse,r.vertices[c]),r.normals[c],!h)}}},a2e=class{constructor(){this.up=C(),this.right=C()}};function yst(t,e,r){$e(t.up,e.up,r),$e(t.right,e.right,r)}const Gse=Ue(),jse=ve(),_st=new a2e;let vst=class extends js{constructor(e,r,i,s,n,o,a){super(e,r,i,null,os.Mesh,a),this.path=s,this.geometrySR=n,this.stencilWidth=o}};var Cf;function l2e(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Cf||(Cf={}));let c2e=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},u2e=class extends c2e{constructor(e){super(e),this.vertexAttributeColor=Nt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Ji(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let h=i[c];const p=h===0||h===s.vertices.length-1;h*=3;const f=Sst;let m=0,y=0;const _=4*c,v=se(Est,o[_],o[_+1],o[_+2]),w=se(Cst,a[_],a[_+1],a[_+2]),T=sr(Hse,l[_]*e[0],l[_+1]*e[1]);if(p)ot(f,w,v),m=o[_+3]*e[0],y=a[_+3];else{const A=wst,P=xst;sr(A,o[_+3],a[_+3]);const I=NW(A);wO(A,A);const V=Ys(T,A);if(Math.abs(V)>I){sr(P,-A[1],A[0]);const k=Ys(T,P);sc(A,A,I*Math.sign(V)),sc(P,P,k),Sd(T,A,P)}se(f,0,0,0)}const x=se(Tst,v[0]*T[0]+w[0]*T[1],v[1]*T[0]+w[1]*T[1],v[2]*T[0]+w[2]*T[1]),S=3*c;this.vertexAttributePosition[S]=n[h]+x[0]+f[0]*m,this.vertexAttributePosition[S+1]=n[h+1]+x[1]+f[1]*m,this.vertexAttributePosition[S+2]=n[h+2]+x[2]+f[2]*m;const O=sr(Hse,l[_+2],l[_+3]);Yb(this.vertexAttributeNormal,c,v[0]*O[0]+w[0]*O[1]+f[0]*y,v[1]*O[0]+w[1]*O[1]+f[1]*y,v[2]*O[0]+w[2]*O[1]+f[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new h2e([[E.POSITION,new Ve(this.vertexAttributePosition,3,!0)],[E.NORMALCOMPRESSED,new Ve(this.vertexAttributeNormal,2,!0)],[E.COLOR,new Ve(this.vertexAttributeColor,4)]],[[E.POSITION,this.builder.vertexIndices],[E.NORMALCOMPRESSED,this.builder.normalIndices],[E.COLOR,ZS(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const s=this.builder.vertexIndices,n=new Ve(this.vertexAttributePosition,3),o=s.length/3;MR(e,r,0,o,s,n,void 0,void 0,i)}},bst=class extends c2e{constructor(e,r,i,s){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new u2e(e),this.vvData=Ji(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return new h2e([[E.POSITION,new Ve(this.builder.positions,3,!0)],[E.PROFILERIGHT,new Ve(this.builder.profileRightAxes,4,!0)],[E.PROFILEUP,new Ve(this.builder.profileUpAxes,4,!0)],[E.PROFILEVERTEXANDNORMAL,new Ve(this.builder.profileVertexAndNormals,4,!0)],[E.FEATUREVALUE,new Ve(this.vvData,4,!0)]],[[E.POSITION,this.builder.pathVertexIndices],[E.PROFILERIGHT,this.builder.vertexIndices],[E.PROFILEUP,this.builder.vertexIndices],[E.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[E.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(E.POSITION);r&&(r.data=this.builder.positions)}},h2e=class{constructor(e,r){this.vertexAttributes=e,this.indices=r}};const Hse=Ue(),wst=Ue(),xst=Ue(),Tst=C(),Sst=C(),Est=C(),Cst=C();function Ast(t,e){let r=null;const i=t.vertices.length,s=.99619469809,n=C(),o=C(),a=C(),l=C(),c=C(),h=C(),p=Mr();let f=t.vertices[0];re(o,e),se(n,0,1,0),vN(f.vRight,o,n,n,a,o,s),re(f.frame.up,o),re(f.frame.right,a);const m=t.positions;let y=t.offset;r=f;for(let _=1;_<i;++_){f=t.vertices[_],le(c,f.vLeft,f.vRight);let v=Ee(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),h[0]=m[y]+r.frame.up[0],h[1]=m[y+1]+r.frame.up[1],h[2]=m[y+2]+r.frame.up[2],y+=3;const w=se(Ost,m[y],m[y+1],m[y+2]);bR(w,c,p),gw(p,uu(h,f.vLeft),l)?(l[0]-=m[y],l[1]-=m[y+1],l[2]-=m[y+2],ge(o,l),ot(a,c,o),ge(a,a)):vN(c,r.frame.up,r.frame.right,n,a,o,s),re(f.frame.up,o),re(f.frame.right,a),r=f}}const Ost=C();let d2e=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(XC(e)),this.normals.push(XC(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:XC(e),normal:r?XC(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};const p2e={top:[0,-.5],bottom:[0,.5]};function j8(t){const r=owe,i=new d2e,s={v0:0,v1:0};i.addPole(cr(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),h=cr(l*.5,c*.5),p=cr(l,c);i.addVertex(h,p)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,s)}const n={v0:r-1,v1:0};if(i.addSegment(n,s),t!=="center"){const o=p2e[t];i.translate(o[0],o[1])}return i}const Rst={center:j8("center"),top:j8("top"),bottom:j8("bottom")},Pst={center:H8("center"),top:H8("top"),bottom:H8("bottom")};function H8(t){const i=new d2e,s=cr(.5*-1,.5*-1),n=cr(.5*1,.5*-1),o=cr(.5*1,.5*1),a=cr(.5*-1,.5*1),l=cr(0,-1),c=cr(1,0),h=cr(0,1),p=cr(-1,0);if(i.addPole(cr(0,.5*1),h),i.addPole(cr(0,.5*1)),i.addPole(cr(0,.5*-1)),i.addPole(cr(0,.5*-1),l),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,h),i.addVertex(a,h),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,p),i.addVertex(s,p),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=p2e[t];i.translate(f[0],f[1])}return i}function Mst(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function $st(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function f2e(t,e,r,i,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}function Ist(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function Lst(t,e){const r=e[0],i=e[1],s=e[2],n=e[3];let o=r*n-s*i;return o?(o=1/o,t[0]=n*o,t[1]=-i*o,t[2]=-s*o,t[3]=r*o,t):null}function Dst(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function Nst(t){return t[0]*t[3]-t[2]*t[1]}function m2e(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1],c=r[2],h=r[3];return t[0]=i*a+n*l,t[1]=s*a+o*l,t[2]=i*c+n*h,t[3]=s*c+o*h,t}function Fst(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=s*l+o*a,t[2]=i*-a+n*l,t[3]=s*-a+o*l,t}function Ust(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function Vst(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function zst(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function kst(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Bst(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function Gst(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function jst(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function g2e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Hst(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function qst(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],h=Wa();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function Wst(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Xst(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const Zst=m2e,Yst=g2e;Object.freeze(Object.defineProperty({__proto__:null,LDU:Gst,add:jst,adjoint:Dst,copy:Mst,determinant:Nst,equals:qst,exactEquals:Hst,frob:Bst,fromRotation:Vst,fromScaling:zst,identity:$st,invert:Lst,mul:Zst,multiply:m2e,multiplyScalar:Wst,multiplyScalarAndAdd:Xst,rotate:Fst,scale:Ust,set:f2e,str:kst,sub:Yst,subtract:g2e,transpose:Ist},Symbol.toStringTag,{value:"Module"}));function y2e(){return[1,0,0,1]}function Jst(t){return[t[0],t[1],t[2],t[3]]}function Qst(t,e,r,i){return[t,e,r,i]}function Kst(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Jst,create:y2e,createView:Kst,fromValues:Qst},Symbol.toStringTag,{value:"Module"}));let _2e=class{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new a2e}setFrameFromUpVector(e){re(this.frame.up,e),le(JE,this.vLeft,this.vRight),ge(JE,JE),ie(Xse,this.frame.up,me(JE,this.frame.up)),he(r$,JE,Xse),ge(r$,r$),ot(this.frame.right,r$,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},ent=class extends _2e{get rotationFrameUp(){return this.frame.up}get rotationRight(){return $ge}get rotationAngle(){return ie(Ty,this.frame.up,me(this.frame.up,this.vLeft)),he(Ty,this.vLeft,Ty),na(Ty,Ty),ge(Ty,Ty),ie(hx,this.frame.up,me(this.frame.up,this.vRight)),he(hx,this.vRight,hx),ge(hx,hx),ot(t4,this.rotationFrameUp,this.vLeft),Math.sign(me(t4,this.vRight))*(Math.PI-xn(me(Ty,hx)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const s=VV(Math.cos(.5*i));return sr(e,(s-1+1)*r[0],r[1])}},tnt=class extends _2e{get rotationFrameUp(){const e=Math.sign(me(this.frame.right,this.vRight));return ot(YE,this.vRight,this.vLeft),ie(YE,YE,e),ge(YE,YE)}get rotationRight(){const e=this.rotationFrameUp,r=me(e,this.frame.up),i=me(e,this.frame.right);return ie(ux,this.frame.up,-i),ie(Wse,this.frame.right,r),le(ux,ux,Wse),ge(ux,ux),rnt(qse,this.frame,ux),qse}get rotationAngle(){const e=Math.sign(me(this.frame.right,this.vRight));return na(t4,this.vLeft),-e*(Math.PI-xn(me(t4,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*VV(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const s=VV(Math.cos(.5*i)),n=this.rotationRight,o=f2e(snt,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return b0e(e,r,o)}};function rnt(t,e,r){sr(t,me(r,e.right),me(r,e.up))}function int(t){switch(t){case Cf.World:return new ent;case Cf.Path:return new tnt}}const YE=C(),qse=Ue(),ux=C(),Wse=C(),t4=C(),Ty=C(),hx=C(),Xse=C(),JE=C(),r$=C(),snt=y2e(),q8=8;function nnt(t,e){const r=E.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(b`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Tr("size",s=>s.size)),e.vvSize?(i.uniforms.add(new Vt("vvSizeMinSize",s=>s.vvSize.minSize),new Vt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Vt("vvSizeOffset",s=>s.vvSize.offset),new Vt("vvSizeFactor",s=>s.vvSize.factor)),i.code.add(b`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(b`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",q8),i.uniforms.add(new yl("vvOpacityValues",s=>s.vvOpacity.values,q8),new yl("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,q8)),i.code.add(b`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(b`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",g2),i.uniforms.add(new yl("vvColorValues",s=>s.vvColor.values,g2),new dbe("vvColorColors",s=>s.vvColor.colors,g2)),i.code.add(b`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(b`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(TR),t.attributes.add(E.PROFILERIGHT,"vec4"),t.attributes.add(E.PROFILEUP,"vec4"),t.attributes.add(E.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(b`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(b`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(b`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(b`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let ont=class extends DR{constructor(){super(...arguments),this.size=cr(1,1)}};function ant(t){const e=new br,{vertex:r,fragment:i}=e;switch(fc(r,t),e.varyings.add("vpos","vec3"),e.include(nnt,t),t.output!==L.Color&&t.output!==L.Alpha||(e.include(vl,t),e.include(Zb,t),e.include(XS,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(b`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===L.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(du,t),t.output){case L.Alpha:e.include(fs,t),i.uniforms.add(new Oe("opacity",s=>s.opacity)),i.code.add(b`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case L.Color:e.include(fs,t),e.include(Jb,t),e.include(BR,t),e.include(Zb,t),e.include(Gxe,t),sp(i,t),GR(i),iE(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Vt("ambient",s=>s.ambient),new Vt("diffuse",s=>s.diffuse),new Vt("specular",s=>s.specular),new Oe("opacity",s=>s.opacity)),i.include(Jf),Yf(i),i.code.add(b`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case L.Depth:case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:e.include(vl,t),Bb(e),e.varyings.add("depth","float"),r.code.add(b`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(fs,t),e.include(Dg,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case L.Normal:e.include(vl,t),e.include(FO,t),uS(r),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(fs,t),i.code.add(b`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case L.Highlight:e.include(vl,t),e.include(FO,t),e.varyings.add("vnormal","vec3"),r.code.add(b`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(fs,t),e.include(Xg,t),i.code.add(b`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const lnt=Object.freeze(Object.defineProperty({__proto__:null,build:ant},Symbol.toStringTag,{value:"Module"})),v2e=new Map([[E.POSITION,0],[E.PROFILERIGHT,1],[E.PROFILEUP,2],[E.PROFILEVERTEXANDNORMAL,3],[E.FEATUREVALUE,4]]);let cnt=class extends ont{constructor(){super(...arguments),this.ambient=Ae(.2,.2,.2),this.diffuse=Ae(.8,.8,.8),this.specular=Ae(0,0,0),this.opacity=1,this.origin=C(),this.modelTransformation=null}},b2e=class w2e extends Rr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ie.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Er(e.rctx,w2e.shader.get().build(this.configuration),v2e)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===st.NONE,s=e===st.FrontFace;return Ot({blending:r.output!==L.Color&&r.output!==L.Alpha||!r.transparent?null:i?su:Zg(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Qi.None?P0e:null,depthTest:{func:V_(e)},depthWrite:i||s?El:null,colorWrite:Gt,stencilWrite:r.hasOccludees?zf:null,stencilTest:r.hasOccludees?z_:null,polygonOffset:i||s?null:_F})}};b2e.shader=new Sr(lnt,()=>ae(()=>import("./Path.glsl-608b49c2.js"),[]));let On=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.doubleSidedMode=Qi.None,this.transparencyPassType=st.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};u([F({count:L.COUNT})],On.prototype,"output",void 0),u([F({count:Qi.COUNT})],On.prototype,"doubleSidedMode",void 0),u([F({count:st.COUNT})],On.prototype,"transparencyPassType",void 0),u([F()],On.prototype,"spherical",void 0),u([F()],On.prototype,"receiveShadows",void 0),u([F()],On.prototype,"receiveAmbientOcclusion",void 0),u([F()],On.prototype,"vvSize",void 0),u([F()],On.prototype,"vvColor",void 0),u([F()],On.prototype,"vvOpacity",void 0),u([F()],On.prototype,"hasSlicePlane",void 0),u([F()],On.prototype,"transparent",void 0),u([F()],On.prototype,"hasOccludees",void 0),u([F()],On.prototype,"hasMultipassTerrain",void 0),u([F()],On.prototype,"cullAboveGround",void 0),u([F()],On.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F({constValue:rt.Disabled})],On.prototype,"pbrMode",void 0),u([F({constValue:!0})],On.prototype,"hasVvInstancing",void 0),u([F({constValue:!1})],On.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!1})],On.prototype,"useFillLights",void 0);let unt=class x2e extends U_{constructor(e){super(e,new dnt),this.supportsEdges=!0,this._vertexAttributeLocations=v2e,this._configuration=new On,this._vertexBufferLayout=x2e.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==L.Color&&e!==L.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Qi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Qi.WindingOrder:Qi.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==L.Shadow&&e!==L.ShadowExcludeHighlight&&e!==L.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,s,n,o){const a=e;if(!l2e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:w,minSize:T,maxSize:x}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=ye(v[0]+S*w[0],T[0],x[0]),c[1]*=ye(v[2]+S*w[2],T[2],x[2])}const h=Math.max(c[0],c[1]),p=e.boundingInfo;if(p==null)return void this._intersectTriangles(l,c,s,n,o);const f=Lb(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];HX(f,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(e,r,i,s,n){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,s,n)}createBufferWriter(){return new rE(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case L.Color:case L.Alpha:case L.Depth:case L.Normal:case L.Highlight:case L.ObjectAndLayerIdColor:return e===(this.parameters.transparent?ce.TRANSPARENT_MATERIAL:ce.OPAQUE_MATERIAL)||e===ce.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new hnt(e)}static getVertexBufferLayout(){return ji().vec3f(E.POSITION).vec4f(E.PROFILERIGHT).vec4f(E.PROFILEUP).vec4f(E.PROFILEVERTEXANDNORMAL).vec4f(E.FEATUREVALUE)}},hnt=class extends N_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(b2e,e)}},dnt=class extends cnt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const pnt=["polyline"];let fnt=class extends Kf{constructor(e,r,i,s){super(e,r,i,s),this._intrinsicSize=cr(1,1),this._upVectorAlignment=Cf.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){var f,m,y,_;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new LR({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((m=(f=this._context.renderer)==null?void 0:f.visualVariables)==null?void 0:m.length)>0?pS(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Cf.World:Cf.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=Rst[i];break;case"quad":this._profile=Pst[i]}switch(this.symbolLayer.join){case"round":this._extruder=new G8(0,nwe);break;case"bevel":this._extruder=new G8(0,1);break;case"miter":this._extruder=new G8(.8*Math.PI,1);break;default:this._extruder=new gst}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new kse,this._endCap=new kse;break;case"butt":default:this._startCap=new t$(this._profile,0),this._endCap=new t$(this._profile,0,!0);break;case"square":this._startCap=new t$(this._profile,-.5),this._endCap=new t$(this._profile,.5,!0);break;case"round":{const v=s==="quad";this._startCap=new Bse({profile:this._profile,flip:!1,breakNormals:v,subdivisions:D7}),this._endCap=new Bse({profile:this._profile,flip:!0,breakNormals:v,subdivisions:D7});break}}const o=(_=(y=this.symbolLayer)==null?void 0:y.material)==null?void 0:_.color,a=this._getCombinedOpacityAndColor(o),l=Ia(a),c=a[3],h=c<1||this.needsDrivenTransparentPass,p={diffuse:l,ambient:l,opacity:c,transparent:h,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||n==="none"?mi.None:mi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(sr(this._intrinsicSize,e,r),!L7(this._intrinsicSize[0])||!L7(this._intrinsicSize[1])))throw new U("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||sc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const v={...p,...this._fastUpdates.materialParameters,size:Cge(this._intrinsicSize)};this._material=new unt(v)}else p.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,p.normalType=Ar.Compressed,this._material=new kf(p);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,pnt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new cp),s=e.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){var s,n;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,A_)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!fS(this._fastUpdates,r,this._vvConvertOptions))return Ps.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Ps.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const p of i)r+=p.length;const l=Uo(3*r);let c,h=0;for(const p of i){s.push({offset:h,numVertices:p.length});for(const f of p)l[h++]=f[0],l[h++]=f[1],l[h++]=e.hasZ?f[2]:0}return o==null||n.equals(o)||oi(l,n,0,l,o,0,r)?(o==null||o.equals(a)?c=q_e(l):(c=Uo(3*r),oi(l,o,0,c,a,0,r)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,s){var y,_,v;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(w=>w.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=an(),h=this._context.renderCoordsHelper,p=new DX(o.vertexDataES);for(const w of o.pathVertexDataInfos){const T=w.numVertices;if(T<2)continue;const x=w.offset;if(this._context.clippingExtent!=null&&(xi(c),Kc(c,o.vertexDataES,x,T),!Nd(c,this._context.clippingExtent)))continue;const S=new Array,O=x+3*T;for(let Z=x;Z<O;Z+=3){p.offset=Z;const W=NZe(p,this._context.elevationProvider,i,h);se(ds,o.vertexDataRS[Z],o.vertexDataRS[Z+1],o.vertexDataRS[Z+2]),h.setAltitude(ds,W),o.vertexDataRS[Z]=ds[0],o.vertexDataRS[Z+1]=ds[1],o.vertexDataRS[Z+2]=ds[2],S.push(int(this._upVectorAlignment))}const A=new pst(S,o.vertexDataES,o.vertexDataRS,x);T2e(A,this._upVectorAlignment,this._context.renderCoordsHelper);const P=new fst(A,this._profile,this._extruder,this._startCap,this._endCap);let I=null;if(this._fastUpdates){const Z=this._fastUpdates.visualVariables,W=Xd((y=Z.size)==null?void 0:y.field,e)??0,H=Xd((_=Z.color)==null?void 0:_.field,e)??0,Y=Xd((v=Z.opacity)==null?void 0:v.field,e)??0;I=new bst(P,W,H,Y)}else{const Z=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Y=r.size;Z[0]*=Zse(Y[0],Y[2]==="symbol-value"?this.symbolLayer.height||0:Y[2],this.symbolLayer.width||0),Z[1]*=Zse(Y[2],Y[0]==="symbol-value"?this.symbolLayer.width||0:Y[0],this.symbolLayer.height||0)}let W;this._drivenProperties.color&&(W=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(W=W?[W[0],W[1],W[2],r.opacity]:[1,1,1,r.opacity]);const H=new u2e(P);H.bake(Z),W&&H.bakeVertexColors(W),I=H}const{vertexAttributes:V,indices:k}=I.createGeometryData(),B=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),z=new vst(this._material,V,k,I,l,this._stencilWidth,B);z.transformation=Sl(ve(),sn,P.path.origin),a.push(z)}if(a.length===0)return null;const f=new Yg({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),m=new Qf(this,f,a,null,null,(w,T,x,S,O)=>gnt(w,T,S,O,this._upVectorAlignment),i);return m.alignedSampledElevation=0,m.needsElevationUpdates=A_(i.mode),m}};function T2e(t,e,r){const{origin:i,positions:s}=t;let n=t.offset;switch(e){default:case Cf.World:for(const o of t.vertices)ds[0]=s[n++]+i[0],ds[1]=s[n++]+i[1],ds[2]=s[n++]+i[2],r.worldUpAtPosition(ds,ds),o.setFrameFromUpVector(ds);break;case Cf.Path:ds[0]=s[n]+i[0],ds[1]=s[n+1]+i[1],ds[2]=s[n+2]+i[2],r.worldUpAtPosition(ds,ds),Ast(t,ds)}}function Zse(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function mnt(t,e,r,i){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let h=t.offset;h<c;h+=3)se(ds,l[h],l[h+1],l[h+2]),r(ds,W8),s+=W8.sampledElevation,ds[0]=a[h]+n[0],ds[1]=a[h+1]+n[1],ds[2]=a[h+2]+n[2],i.setAltitude(ds,W8.z),a[h]=ds[0]-n[0],a[h+1]=ds[1]-n[1],a[h+2]=ds[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function gnt(t,e,r,i,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!l2e(l))continue;const c=l.path,h=c.builder.path;a+=mnt(h,e,r,i),s!==Cf.World&&T2e(h,s,i),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const ds=C(),W8=new FR;function ynt(t,e,r,i,s=1){if(r.isGeographic&&i===Ie.Global){const c=Uo(e.length),h=e.length,p=Dr(r);for(let f=0;f<h;f+=3)C5(e,f,c,f,p);e=c}sr(Qs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Qs[0]=Math.min(Qs[0],e[c]),Qs[1]=Math.min(Qs[1],e[c+1]);const n=Qs[0]%s,o=Qs[1]%s,a=Qs[0]-n,l=Qs[1]-o;for(let c=0;c<e.length;c+=3){const h=c/3*4;t[h]=(e[c]-a)/s,t[h+1]=(e[c+1]-l)/s,t[h+2]=a/s,t[h+3]=l/s}}function S2e(t,e,r,i,s=1){se(_v,1,0,0),se(vv,0,1,0),se(px,0,0,1),bnt(X8,r),_nt(r,Yse)&&vnt(Yse,_v,vv,px,i,X8),sr(Qs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),sr(bv,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<r.length;h+=3){se(dx,r[h],r[h+1],r[h+2]);const p=me(_v,dx),f=me(vv,dx);Qs[0]=Math.min(Qs[0],p),Qs[1]=Math.min(Qs[1],f),bv[0]=Math.max(bv[0],p),bv[1]=Math.max(bv[1],f)}const n=me(px,X8);Y8(Sy,Qs[0],Qs[1],n,_v,vv,px),Y8(wv,bv[0],Qs[1],n,_v,vv,px),Y8(xv,Qs[0],bv[1],n,_v,vv,px),he(wv,wv,Sy),ie(wv,wv,.5),he(xv,xv,Sy),ie(xv,xv,.5),le(Sy,Sy,wv),le(Sy,Sy,xv);const o=Qs[0]%s,a=Qs[1]%s,l=Qs[0]-o,c=Qs[1]-a;for(let h=0;h<r.length;h+=3){se(dx,r[h],r[h+1],r[h+2]);const p=h/3,f=4*p;t[f]=(me(_v,dx)-l)/s,t[f+1]=(me(vv,dx)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*p;for(let y=0;y<3;y++)e[m+y]=Sy[y],e[m+y+3]=wv[y],e[m+y+6]=xv[y]}}const X8=C(),dx=C(),Yse=Mr(),_v=C(),vv=C(),px=C(),Qs=Ue(),bv=Ue(),Sy=C(),wv=C(),xv=C();function _nt(t,e){const r=t.length/3-1;return Kge(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function vnt(t,e,r,i,s,n){s!=null?(s.basisMatrixAtPosition(n,Ap),se(i$,Ap[0],Ap[1],Ap[2]),se(s$,Ap[4],Ap[5],Ap[6]),se(Z8,Ap[8],Ap[9],Ap[10])):(se(i$,1,0,0),se(s$,0,1,0),se(Z8,0,0,1));const o=t;me(o,Z8)<0&&ie(o,o,-1),re(i,o);const a=me(o,s$),l=me(o,i$);Math.abs(a)<Math.abs(l)?(X1(e,i$,o,-l),ge(e,e),ot(r,e,o),ge(r,r),ie(r,r,-1)):(X1(r,s$,o,-a),ge(r,r),ot(e,r,o),ge(e,e))}const Ap=ve(),i$=C(),s$=C(),Z8=C();function bnt(t,e){se(QE,0,0,0);for(let r=0;r<e.length-3;r+=3)QE[0]+=e[r],QE[1]+=e[r+1],QE[2]+=e[r+2];ie(t,QE,1/(e.length/3-1))}const QE=C();function Y8(t,e,r,i,s,n,o){se(t,e*s[0]+r*n[0]+i*o[0],e*s[1]+r*n[1]+i*o[1],e*s[2]+r*n[2]+i*o[2])}function wnt(t){const e=new br,{vertex:r,fragment:i,attributes:s,varyings:n}=e;fc(r,t),e.include(vl,t),e.include(Ew,t),e.include(pg,t),e.include(IR,t),s.add(E.POSITION,"vec3"),t.vvColor&&s.add(E.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha);o&&n.add("depth","float"),r.uniforms.add(new rr("eColor",c=>c.color));const a=t.output===L.Depth;a&&(e.include(Dg,t),Bb(e),w_(e)),r.code.add(b`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(fs,t),o&&e.include(du,t),i.include(Jf);const l=t.output===L.Highlight;return l&&e.include(Xg,t),i.code.add(b`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===L.ObjectAndLayerIdColor?b`fColor.a = 1.0;`:""}

    if (fColor.a < ${b.float(co)}) {
      discard;
    }

    ${t.output===L.Alpha?b`fragColor = vec4(fColor.a);`:""}

    ${t.output===L.Color?b`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?b`outputHighlight();`:""};
    ${t.output===L.Depth?b`outputDepth(linearDepth);`:""};
    ${t.output===L.ObjectAndLayerIdColor?b`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const xnt=Object.freeze(Object.defineProperty({__proto__:null,build:wnt},Symbol.toStringTag,{value:"Module"}));let E2e=class C2e extends Rr{initializeProgram(e){return new Er(e.rctx,C2e.shader.get().build(this.configuration),vr)}_createPipeline(e,r){const i=this.configuration,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:i.output!==L.Color&&i.output!==L.Alpha||!i.transparent?null:s?su:Zg(e),culling:B5(i.cullFace),depthTest:{func:V_(e)},depthWrite:(s||n)&&i.writeDepth?El:null,colorWrite:Gt,stencilWrite:i.hasOccludees?zf:null,stencilTest:i.hasOccludees?r?P_:z_:null,polygonOffset:s||n?i.polygonOffset?Tnt:null:vF(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};E2e.shader=new Sr(xnt,()=>ae(()=>import("./ColorMaterial.glsl-f82aa1ca.js"),[]));const Tnt={factor:1,units:1};let To=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.cullFace=mi.None,this.transparencyPassType=st.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};u([F({count:L.COUNT})],To.prototype,"output",void 0),u([F({count:mi.COUNT})],To.prototype,"cullFace",void 0),u([F({count:st.COUNT})],To.prototype,"transparencyPassType",void 0),u([F()],To.prototype,"hasSlicePlane",void 0),u([F()],To.prototype,"hasVertexColors",void 0),u([F()],To.prototype,"transparent",void 0),u([F()],To.prototype,"polygonOffset",void 0),u([F()],To.prototype,"enableOffset",void 0),u([F()],To.prototype,"writeDepth",void 0),u([F()],To.prototype,"hasOccludees",void 0),u([F()],To.prototype,"hasMultipassTerrain",void 0),u([F()],To.prototype,"cullAboveGround",void 0),u([F()],To.prototype,"objectAndLayerIdColorInstanced",void 0),u([F()],To.prototype,"vvColor",void 0),u([F({constValue:!0})],To.prototype,"hasVvInstancing",void 0),u([F({constValue:!1})],To.prototype,"vvSize",void 0),u([F({constValue:!1})],To.prototype,"vvOpacity",void 0);let Jse=class extends OZ{constructor(e){super(e,new Ent),this.supportsEdges=!0,this._configuration=new To}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<yF,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth&&this.parameters.writeLinearDepth||r===L.ObjectAndLayerIdColor?e===ce.DRAPED_MATERIAL?!0:r===L.Highlight?e===ce.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ce.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new Snt(e)}createBufferWriter(){const e=ji().vec3f(E.POSITION);return oe("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4u8(E.COLOR),new rE(e)}},Snt=class extends N_{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this.ensureTechnique(E2e,e)}},Ent=class extends DR{constructor(){super(...arguments),this.color=wf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=mi.None,this.hasOccludees=!1}};var lo;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(lo||(lo={}));const tG=.70710678118,Qse=tG,Cnt=.08715574274;function Ant(t){const e=new br,r=t.hasMultipassTerrain&&(t.output===L.Color||t.output===L.Alpha),{vertex:i,fragment:s,attributes:n,varyings:o}=e;fc(i,t),e.include(vl,t),e.include(Ew,t),e.include(pg,t),t.draped?i.uniforms.add(new Oe("worldToScreenRatio",(c,h)=>1/h.screenToPCSRatio)):n.add(E.BOUNDINGRECT,"mat3"),n.add(E.POSITION,"vec3"),n.add(E.UVMAPSPACE,"vec4"),t.vvColor&&n.add(E.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new rr("uColor",c=>c.color));const a=t.style===lo.ForwardDiagonal||t.style===lo.BackwardDiagonal||t.style===lo.DiagonalCross;a&&i.code.add(b`
      const mat2 rotate45 = mat2(${b.float(tG)}, ${b.float(-Qse)},
                                 ${b.float(Qse)}, ${b.float(tG)});
    `),t.draped||(sp(i,t),i.uniforms.add(new Oe("worldToScreenPerDistanceRatio",(c,h)=>1/h.camera.perScreenPixelRatio)),i.code.add(b`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(b`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(b`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${b.float(Cnt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(b`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":b`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${b.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===L.Depth;return l&&(e.include(Dg,t),Bb(e),w_(e)),i.code.add(b`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?b`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:b`transformPosition(proj, view, vpos);`}
    }
  `),e.include(fs,t),s.include(Jf),t.draped&&s.uniforms.add(new Oe("texelSize",(c,h)=>1/h.camera.pixelRatio)),t.output===L.Highlight&&e.include(Xg,t),r&&e.include(du,t),t.output!==L.Highlight&&(s.code.add(b`
      const float lineWidth = ${b.float(t.lineWidth)};
      const float spacing = ${b.float(t.patternSpacing)};
      const float spacingINV = ${b.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(b`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.code.add(b`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==L.Highlight?b`color.a *= ${Ont(t)};`:""}

      ${t.output===L.ObjectAndLayerIdColor?b`color.a = 1.0;`:""}

      if (color.a < ${b.float(co)}) {
        discard;
      }

      ${t.output===L.Alpha?b`fragColor = vec4(color.a);`:""}

      ${t.output===L.Color?b`fragColor = color; ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===L.Highlight?b`outputHighlight();`:""}
      ${t.output===L.Depth?b`outputDepth(linearDepth);`:""};
    }
  `),e}function Ont(t){function e(r){return t.draped?b`coverage(vuv.${r}, texelSize)`:b`sampleAA(vuv.${r})`}switch(t.style){case lo.ForwardDiagonal:case lo.Horizontal:return e("y");case lo.BackwardDiagonal:case lo.Vertical:return e("x");case lo.DiagonalCross:case lo.Cross:return b`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const Rnt=Object.freeze(Object.defineProperty({__proto__:null,build:Ant},Symbol.toStringTag,{value:"Module"}));let A2e=class O2e extends Rr{initializeProgram(e){return new Er(e.rctx,O2e.shader.get().build(this.configuration),R2e)}_setPipelineState(e,r){const i=this.configuration,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:i.output===L.Color||i.output===L.Alpha?s?su:Zg(e):null,culling:B5(i.cullFace),depthTest:{func:V_(e)},depthWrite:s?i.writeDepth?El:null:gF(e),colorWrite:Gt,stencilWrite:i.hasOccludees?zf:null,stencilTest:i.hasOccludees?r?P_:z_:null,polygonOffset:s||n?i.polygonOffset?Pnt:null:vF(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};A2e.shader=new Sr(Rnt,()=>ae(()=>import("./Pattern.glsl-41d7f897.js"),[]));const Pnt={factor:1,units:1};let Rn=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.cullFace=mi.None,this.transparencyPassType=st.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}};u([F({count:L.COUNT})],Rn.prototype,"output",void 0),u([F({count:mi.COUNT})],Rn.prototype,"cullFace",void 0),u([F({count:lo.COUNT})],Rn.prototype,"style",void 0),u([F({count:st.COUNT})],Rn.prototype,"transparencyPassType",void 0),u([F()],Rn.prototype,"hasSlicePlane",void 0),u([F()],Rn.prototype,"hasVertexColors",void 0),u([F()],Rn.prototype,"polygonOffset",void 0),u([F()],Rn.prototype,"writeDepth",void 0),u([F()],Rn.prototype,"hasOccludees",void 0),u([F()],Rn.prototype,"patternSpacing",void 0),u([F()],Rn.prototype,"lineWidth",void 0),u([F()],Rn.prototype,"enableOffset",void 0),u([F()],Rn.prototype,"draped",void 0),u([F()],Rn.prototype,"hasMultipassTerrain",void 0),u([F()],Rn.prototype,"cullAboveGround",void 0),u([F()],Rn.prototype,"vvColor",void 0),u([F({constValue:!1})],Rn.prototype,"hasVvInstancing",void 0),u([F({constValue:!1})],Rn.prototype,"vvSize",void 0),u([F({constValue:!1})],Rn.prototype,"vvOpacity",void 0);const R2e=new Map([[E.POSITION,0],[E.COLOR,3],[E.UVMAPSPACE,4],[E.COLORFEATUREATTRIBUTE,5],[E.BOUNDINGRECT,6]]);let rY=class extends OZ{constructor(e){super(e,new Int),this.supportsEdges=!0,this._vertexAttributeLocations=R2e,this._configuration=new Rn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<yF,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===L.Color||r===L.Alpha||r===L.Highlight||r===L.Depth&&this.parameters.writeLinearDepth?e===ce.DRAPED_MATERIAL?!0:r===L.Highlight?e===ce.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?ce.TRANSPARENT_MATERIAL:ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new Mnt(e)}createBufferWriter(){const e=ji().vec3f(E.POSITION).vec4f(E.UVMAPSPACE);return this.parameters.draped||e.mat3f(E.BOUNDINGRECT),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4u8(E.COLOR),new $nt(e)}},Mnt=class extends N_{_updateParameters(e){return this.ensureTechnique(A2e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==L.Color&&this._output!==L.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},$nt=class extends rE{write(e,r,i,s,n){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case E.UVMAPSPACE:{tt(a.size===4);const c=s.getField(o,ip);c&&hS(l,a.data,c,n);break}case E.BOUNDINGRECT:{tt(a.size===9);const c=s.getField(o,x_);c&&this.writeBoundingRect(l,a.data,e,c,n);break}default:X1e(o,a,l,e,r,s,n)}}}writeBoundingRect(e,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const p=9*e[h],f=r[p],m=r[p+1],y=r[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=r[p+_];n+=l}}},Int=class extends DR{constructor(){super(...arguments),this.color=Nt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=mi.None,this.hasOccludees=!1,this.style=lo.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function Lnt(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new Jse(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Nt(0,0,0,0),e.transparent=!0),new Jse(e)):(e.style=Dnt(r.style),new rY(e))}function Dnt(t){switch(t){case"horizontal":return lo.Horizontal;case"vertical":return lo.Vertical;case"cross":return lo.Cross;case"forward-diagonal":return lo.ForwardDiagonal;case"backward-diagonal":return lo.BackwardDiagonal;case"diagonal-cross":return lo.DiagonalCross;default:return}}function Nnt(t){return t.material instanceof rY&&!t.material.parameters.draped}function Fnt(t,e){if(Nnt(t)){const r=t.vertexAttributes.get(E.POSITION).data,i=t.getMutableAttribute(E.UVMAPSPACE).data,s=t.getMutableAttribute(E.BOUNDINGRECT).data;S2e(i,s,r,e)}}function Unt(t,e,r,i,s){const n=Jbe(t,e,r,i,s),o=t.stageObject.geometries;for(const a of o)Fnt(a,s);return n}const Vnt=["polyline","polygon","extent"],Kse=new LR({size:!1,color:!0,rotation:!1,opacity:!1});let P2e=class M2e extends Kf{constructor(e,r,i,s){super(e,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=pS(this._context.renderer,Kse)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){var i,s,n;if(this._material!=null)return;const e=(s=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:s.color,r=this._getCombinedOpacityAndColor(e);this._material=Lnt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(n=this._fastUpdates)==null?void 0:n.materialParameters}),this._needsUV=this._material instanceof rY,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const s=MTe(e.pattern);return new XT({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:Y7(e.patternCap||"butt")})};this._outlineMaterial=r(uo(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Vnt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(r,new cp);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!fS(this._fastUpdates,r,Kse))return Ps.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return Ps.FastUpdate}layerOpacityChanged(){var e,r;if(this._material!=null){const i=this._material.parameters.color,s=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,n=this._getCombinedOpacity(s);this._material.setParameters({color:[i[0],i[1],i[2],n],transparent:n<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const i=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=NR(M2e.elevationModeChangeTypes,i,s);if(n!==as.UPDATE)return n;const o=Ah(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var h;const s=NO(e.geometry);if(!s)return null;const n=FZ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new znt(n,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Ji(4*a,!0),o.boundingRect=Uo(9*a,!0),S2e(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Yg({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Qf(this,l,o.outGeometries,null,null,Unt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Ah(i.mode),c}_createAs3DShapeFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(xi(jh),Kc(jh,o),!Nd(jh,this._context.clippingExtent)))continue;const h=yS(o,a,3);if(h.length===0)continue;const p=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,f=oie({material:this._material,indices:h,mapPositions:o,attributeData:{position:n,color:p?null:r.color,colorFeature:p?Xd(p.field,e):null,uvMapSpace:this._needsUV?gN(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?hh(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(f)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(this._context.clippingExtent!=null&&(xi(jh),Kc(jh,s),!Nd(jh,this._context.clippingExtent)))continue;const o=J7(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,r){var a;const i=NO(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=Vxe(i,this._context.overlaySR),n=new knt(s,r,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Ji(4*o,!0),ynt(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=xi(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new FF(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var s;const i=r.renderData.polygons;for(const{position:n,holeIndices:o,index:a,count:l}of i){const c=xi(jh);if(Kc(c,n),!Nd(c,this._context.clippingExtent))continue;const h=yS(n,o,3);if(h.length===0)continue;B2(r.outBoundingBox,c);const p=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,f=oie({material:this._material,indices:h,attributeData:{position:n,color:p?null:r.color,colorFeature:p?Xd(p.field,e):null,uvMapSpace:this._needsUV?gN(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new bS(f,r))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(xi(jh),Kc(jh,s),!Nd(jh,this._context.clippingExtent))continue;B2(e.outBoundingBox,jh);const n=J7(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new bS(n,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,s;const e=(s=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:s.color,r=this._getOutlineOpacity();return AA(e!=null?ke.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};P2e.elevationModeChangeTypes={definedChanged:as.RECREATE,staysOnTheGround:as.NONE,onTheGroundChanged:as.RECREATE};const jh=an();let znt=class extends PF{constructor(e,r,i,s){super(e,i,s),this.color=r}},knt=class extends PF{constructor(e,r,i,s){super(e,i,s),this.color=r}};const Bnt="arial-unicode-ms",ene="woff2",tne=new Map,$2e=new Set;let Gnt=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function jnt(t){const e=Wnt(t),r=tne.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${Zr.fontsUrl}/woff2/${e}.${ene}') format('${ene}')`,{style:t.style,weight:t.weight}),s=document.fonts;if(s.has(i)&&i.status==="loading")return i.loaded;const n=i.load().then(()=>(s.add(i),i));return tne.set(e,new Gnt(i,n)),$2e.add(i),n}function Hnt(t){return $2e.has(t)}function qnt(t){if(!t)return Bnt;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Wnt(t){const e=Xnt(t)+Znt(t);return qnt(t.family)+(e.length>0?e:"-regular")}function Xnt(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Znt(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let I2e=class L2e{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var f,m,y,_,v;const i=(f=e==null?void 0:e.material)==null?void 0:f.color,s=ke.toUnitRGBA(i)??wf,n=e.size!=null?uo(e.size):12,o=e.lineHeight,a=e.background!=null?ke.toUnitRGBA(e.background.color):wf,l={family:((m=e.font)==null?void 0:m.family)??"sans-serif",decoration:((y=e.font)==null?void 0:y.decoration)??"none",weight:((_=e.font)==null?void 0:_.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,h=c!=null&&c.color!=null&&c.size>0?{size:uo(c.size),color:ke.toUnitRGBA(c.color)}:{size:0,color:wf},p=new L2e({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r});if(e.font){let w=!1;const T=p.fontString(n);try{w=(await document.fonts.load(T)).some(x=>!Hnt(x))}catch{J.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${T}'. Some text symbology may be rendered using the default browser font.`)}if(!w&&!Ynt.has(e.font.family))try{await jnt(e.font)}catch{}}return p}};const Ynt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let Jnt=class{constructor(e,r,i){this._renderer=new TTe(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=X7(Qnt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Tw(e,{wrap:{s:Lt.CLAMP_TO_EDGE,t:Lt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Qnt={canvas:null},Knt=[0,0,1];let eot=class extends Kf{constructor(e,r,i,s){super(e,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=TF(this.symbolLayer.size);if(e)throw new U("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await I2e.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=LO(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=tW(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!dme(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new Xbe(n,this.symbolLayer.horizontalAlignment,Ctt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(e,r,i,s){const n=e.graphic,o=LO(n.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(e,r,i=0){const s=super.setGraphicElevationContext(e,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return rne(e,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),as.UPDATE}slicePlaneEnabledChanged(e,r){return rne(e,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Ah(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return rot}_createAs3DShape(e,r,i,s,n,o){var I;const a=this.setGraphicElevationContext(e,new cp,s.elevationOffset),l=((I=e.geometry)==null?void 0:I.type)==="polyline",c=e.uid;let h=null,p=null;if(o==null){const V=ETe(s.horizontalPlacement);h=new Jnt(i,V,this._textRenderParameters);let k=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{k!=null&&k.release()});const B=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(B==null||pu(B))return p.release(),null;k=B}}const f=tot(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?m.textureId=o.id:p!=null&&(m.textureId=p.texture.id),s.verticalOffset!=null){const{screenLength:V,minWorldLength:k,maxWorldLength:B}=s.verticalOffset;m.verticalOffset={screenLength:uo(V),minWorldLength:k||0,maxWorldLength:B??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:V,screenSizePerspectiveSettingsLabels:k}=this._context.sharedResources;m.screenSizePerspective=k.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=V}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,n!=null){const V=JSON.stringify(m);y=n.get(V),y==null&&(y=new mS(m),n.add(V,y))}else y=new mS(m);const _=s.translation,v=h?cr(h.displayWidth,h.displayHeight):rp,w=s.centerOffset,T=JB(y,Knt,_,null,v,w,[0,0],null),x=pZ(this._context,r,T,a,c);if(x==null)return null;const S=new Qf(this,x.object,[T],n==null?[y]:null,p,gb,a);S.alignedSampledElevation=x.sampledElevation,S.needsElevationUpdates=Ah(a.mode)||a.mode==="absolute-height";const{displayWidth:O,displayHeight:A}=h??s;S.getScreenSize=(V=Ue())=>(V[0]=O,V[1]=A,V);const P=new swe(s.elevationOffset,i);return S.metadata=P,IO(S,r,this._context.elevationProvider),S}};function rne(t,e,r){t&&t.forEach(i=>{const s=e(i);s!=null&&r(s,i.graphic)})}function tot(t,e){if(e.verticalPlacement==="baseline"){const i=Ttt[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return cr(i,s)}const r=Ett(e.horizontalPlacement,e.verticalPlacement);return vL[r]}const rot={mode:"relative-to-ground",offset:0},iot={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},sot=["polyline","polygon","extent"];let rG=class o1 extends Kf{constructor(e,r,i,s){super(e,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,sot,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new cp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const e=new Oxe,r=this.symbolLayer.color;r!=null&&(e.color=ke.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?o1.headingVectorFromAngle(this.symbolLayer.waveDirection):cr(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=iot[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new Axe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const s=this._elevationContext.mode,n=NR(o1.elevationModeChangeTypes,i,s);if(n!==as.UPDATE)return n;const o=Ah(s);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var p;const s=NO(e.geometry);if(s==null)return null;const n=FZ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=Uo(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new not(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(p=this._context.stage.renderView)==null?void 0:p.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Yg({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),h=new Qf(this,c,l.outGeometries,null,null,Jbe,r);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=Ah(r.mode),h}_createUVCoordsFromVertices(e,r,i,s){const n=qa(s);yc(Ey);for(let l=0;l<i;l++)sr(ine,r[3*l],r[3*l+1]),n2(Ey,ine);$b(Ey,Ey,n);const o=Ey[0]%o1.unitSizeOfTexture,a=Ey[1]%o1.unitSizeOfTexture;n$[0]=Ey[0]-o,n$[1]=Ey[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*n-n$[0])/o1.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*n-n$[1])/o1.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(xi(Tv),Kc(Tv,a),!Nd(Tv,this._context.clippingExtent)))continue;const c=yS(a,l,3);if(c.length===0)continue;const h=hh(i,2*n,2*s),p=aie({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}},e.objectAndLayerIdColor);e.outGeometries.push(p)}}_createAsOverlay(e){var a;const r=NO(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=Vxe(r,this._context.overlaySR),s=i.position.length/3,n=Uo(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new oot(i,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=xi(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new FF(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(xi(Tv),Kc(Tv,s),!Nd(Tv,this._context.clippingExtent))continue;B2(e.outBoundingBox,Tv);const l=yS(s,n,3);if(l.length===0)continue;const c=hh(r,2*o,2*a),h=aie({material:this._material,indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new bS(h,e))}}static headingVectorFromAngle(e){const r=Ue(),i=X4(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};rG.unitSizeOfTexture=100,rG.elevationModeChangeTypes={definedChanged:as.RECREATE,staysOnTheGround:as.NONE,onTheGroundChanged:as.RECREATE};const n$=Ue(),Ey=zt(),ine=Ue(),Tv=an();let not=class extends PF{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}},oot=class extends PF{constructor(e,r,i,s){super(e,i,s),this.uvCoords=r}};function aot(t,e,r,i){var n;const s=((n=cot[t.type])==null?void 0:n[e.type])||lot[e.type];return s?new s(t,e,r,i):(J.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const lot={icon:Z7,object:dst,line:$Te,path:fnt,fill:P2e,extrude:QKe,text:eot,water:rG},cot={"mesh-3d":{fill:Irt}};let uot=class extends uZ{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];s!=null&&(s.symbol=e,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.at(n);if(o.enabled===!1)continue;o$.renderPriority=1-(1+n)/i,o$.renderPriorityStep=1/i,o$.ignoreDrivers=o.ignoreDrivers;const a=aot(this.symbol,o,this._context,o$),l=EH(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await H4(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Jt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,s=this.symbolLayers.map(o=>(o==null?void 0:o.createGraphics3DGraphic(e))??null),n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new sJe(i,r||this,s,e.layer,n)}get complexity(){return dZ(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Qf?l:null};if(n!=null&&!n.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==qc.LOADED?Ps.RecreateSymbol:this.symbolLayers.reduce((i,s)=>i!==Ps.RecreateSymbol&&s!=null?Math.min(i,s.applyRendererDiff(e,r)):i,Ps.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===qc.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];h!=null&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,s)=>i.updateGeometry(s,r))}updateTransform(e,r,i,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,r,i,s))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(s==null)continue;const n=e.layers[i];if(!n||!r(s,n))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const s=e.layers[r];s!=null&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===qc.LOADING?e++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,s){const n=this.symbolLayers.filter(nw).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,s)),o=await Promise.all(n);return Jt(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const o$=new nJe;let hot=class extends uZ{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:hZ}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):Ps.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,s){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,r,i,s))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function iY(t){return t instanceof hot?t.graphics3DSymbol:t instanceof uot?t:null}const zO=J.getLogger("esri.views.3d.layers.graphics.labelPlacement");function dot(t){const e=wot(t);if(e==null)return null;const r=pot(t,e);if(r==null)return null;const i=r.anchor,s=!!e.hasLabelVerticalOffset;return mot({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Ue(),centerOffset:Nt(0,0,0,-1),centerOffsetUnits:"world",translation:C(),elevationOffset:0,hasLabelVerticalOffset:s},r,t)}function pot(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=zd[r],s=i||r4(t);return r&&!i&&zO.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),fot(s,t)}function sY(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=iY(e);return r!=null?r.symbol.symbolLayers.at(0):null}function fot(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(zO.warnOncePerTick(sne(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),r4(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return zO.warnOncePerTick(sne(t==null?void 0:t.placement,`'${i}' geometries`)),r4(e);break;case"point":case"mesh":return t}return t}function sne(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function r4(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=sY(t);return r!=null&&r.type==="extrude"?zd["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return zd["above-center"];default:return}}function mot(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":yot(t,e,r);break;case"polygon":got(t,e,r);break;case"mesh":nY(t,e,r.graphics3DGraphic.layers[0])}return t}function got(t,e,r){const i=sY(r);if(i!=null)switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(FA),Dd(FA,t.translation),t.translation[2]=I_(FA)/2):se(t.translation,0,0,0),nY(t,e,s);break}}}function yot(t,e,r){const i=sY(r);if(i==null)return;const s=r.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):se(t.translation,0,0,0),i.type){case"icon":case"text":_ot(t,e,r,s);break;case"object":nY(t,e,s)}}function _ot(t,e,r,i){const{graphics3DGraphic:s}=r,n=i!=null?i.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(zd[r.labelClass.labelPlacement]&&zO.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=vot(r);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function vot(t,e=xot){const{graphics3DGraphic:r}=t,i=r.layers[0],s=i!=null?i.stageObject.geometries[0].material:null;if(s&&s instanceof mS){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function nY(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(FA):FA,s=Ae(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Ee(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function bot(t){return t==="above-center"}function wot(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,s=iY(i.graphics3DSymbol),n=oc(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=zd[e]||r4(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:nne(n.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&bot(o.placement)?{placement:"above-center",verticalOffset:nne(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(zO.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function nne(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const zd={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},one={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in one){const e=one[t],r=zd[t];e.forEach(i=>{zd[i]=r})}Object.freeze&&(Object.freeze(zd),Object.keys(zd).forEach(t=>{var e;Object.freeze(zd[t]),Object.freeze((e=zd[t])==null?void 0:e.normalizedOffset)}));const xot=[0,0],FA=an();let ane=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const a$=4096;let Tot=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Zt()}},Sot=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new Tot,this.rendered=!1}},Eot=class{constructor(e,r,i){this.size=e,this.cursor=r,this.lineHeight=i}resize(e){this.size.height=e}resetCursor(){this.cursor.x=UA,this.cursor.y=UA+D2e,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}},b3=class extends xe{constructor(e){super(e),this.type=os.Texture,this.id=hc(),this.events=new Is,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new Eot({width:a$,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=Fe(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const r=new _r;return r.wrapMode=Lt.CLAMP_TO_EDGE,r.flipped=!0,r.samplingMode=At.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,r}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new Ct(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(dt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Li(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Fe(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,r,i,s){const n=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,bi(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+o)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=i,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].setAttributeData(E.SIZE,[0,0]),r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=n+UA,l=o+UA+D2e;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=i.cursor.y+l+i.lineHeight-i.size.height,h=i.size.height+c<a$;if(h){const p=Math.ceil(i.size.height*Math.max(1.3,(c+i.size.height)/i.size.height));this._resizeAtlas(Math.min(CZ(p),a$))}return!r||!h&&i.size.height===a$?(this._processRemovals(),ZT.OK):(this._repack(),ZT.REPACK)}i.cursor.x=UA,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,s,a,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return ZT.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].setAttributeData(E.UV0,e.placement.uvMinMax),i.geometries[0].setAttributeData(E.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(this._glTexture==null)return zo.YIELD;let i=!1;if($o(this._elementsToAddOrUpdate,(n,o)=>{const a=this._elements.get(o);if(a!=null&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const h=c.geometries[0],p=this._elements.get(o);h.setAttributeData(E.UV0,p.placement.uvMinMax),h.setAttributeData(E.SIZE,[p.textRenderer.displayWidth,p.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===ZT.REPACK&&(i=!0,!0)}),i)return this.runTask(Fa,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),$o(this._elementsToRender,(n,o)=>(this._processRenderingRequest(n),this._elementsToRender.delete(o),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&UJe.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new Sot(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,s)=>e.push({element:i,key:s}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,s)=>i.key.localeCompare(s.key)),this._elements.clear();for(const{element:i,key:s}of e)this._elements.set(s,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:s}=this,n=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:s,resizeAtlas:o=>n._resizeAtlas(o),run:(o,a)=>n.runTask(o,a)}}};u([d({constructOnly:!0})],b3.prototype,"view",void 0),u([d({type:Boolean})],b3.prototype,"updating",void 0),b3=u([R("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],b3);const UA=2,D2e=2;var ZT;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(ZT||(ZT={}));let lne=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},Cot=class{constructor(e,r,i,s,n){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},Aot=class{constructor(e,r,i,s,n,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new exe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},a1=class extends xe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Pi,this._handles.add([ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(dt.LABELER,this)]),this._textTextureAtlas=new b3({view:this.view}),this._hudMaterialCollection=new ane(this.view._stage),this._calloutMaterialCollection=new ane(this.view._stage)}dispose(){this._handles=Pe(this._handles),this._textTextureAtlas=Fe(this._textTextureAtlas),this._hudMaterialCollection=Fe(this._hudMaterialCollection),this._calloutMaterialCollection=Fe(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),Hh.graphic=null,Hh.renderingInfo=null,Hh.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const s=new lne(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s),r.setVisibilityFlag(zn.LABEL,Do.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(zn.LABEL,Do.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),zo.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!cne(r)){if(Oot(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),J8(r)){this._dirty=!0;continue}if(!cne(r))continue}$o(r.labelsToInitialize,(i,s)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(s,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),Jt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,s=i.layer,n=s.labelingInfo&&s.labelingInfo.filter(c=>!!c.symbol);!n||n.length===0||(await H4(n,async(c,h)=>{const p=c.symbol,f=iY(i.getOrCreateGraphics3DSymbol(p));if(f==null)return void J.getLogger(this).error("Failed to create Graphics3DSymbol for label");await f.load(),Jt(r);let m=null;tW(p)&&p.hasVisibleCallout()&&(m=IYe(p,i.symbolCreationContext),await m.load(),Jt(r));const y=await lu(qbe(c,e.layer.fieldsIndex,this.view.spatialReference));if(Jt(r),y.ok===!0){const _=await this._createTextRenderParameters(f.symbol);Jt(r),e.labelClassContexts[h]=new Cot(c,f,m,_,y.value)}else J.getLogger(this).error(`Label expression failed to evaluate: ${y.error}`)}),Jt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(gs(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return(r==null?void 0:r.type)!=="text"?null:I2e.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,ou(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,s,n){const o=new Xbe(i.verticalOffset,cse(i.anchor),Stt(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return Hh.graphic=r,Hh.renderingInfo=null,Hh.layer=s,n.createLabel(Hh,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,s,n){return Hh.graphic=e,Hh.layer=n,Hh.renderingInfo=new MYe(null,r,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(Hh)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let n=!1;const o=r.graphic,a=i.layer,l=l$(i.layer);for(let h=0;h<s.length;h++){const p=e.textRenderers[h],f=e.textLabelPlacements[h];if(p==null||f==null)continue;const m=s[h],y=m.graphics3DSymbol,_=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,v=y.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(i.elevationInfoOverride);const w=this._createTextSymbolGraphic(p,o,f,a,v);if(w==null)return!1;w._labelClass=m.labelClass,w._labelIndex=h,r.addLabelGraphic(w,i.stageLayer),r.deconflictionPriority=((c=m.textRenderParameters)==null?void 0:c.definition.size)??0,r.setVisibilityFlag(zn.LABEL,Do.USER,l),r.setVisibilityFlag(zn.LABEL,Do.SCALE_RANGE,!0),r.setVisibilityFlag(zn.LABEL,Do.DECONFLICTION,!1),n=!0;const T=m.graphics3DCalloutSymbolLayer;if(T&&f.hasLabelVerticalOffset){T.setElevationInfoOverride(i.elevationInfoOverride);const x=this._createLineCalloutGraphic(o,_,T,f,a);x!=null&&(m.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(x,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const s=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];s!=null&&s.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const T=l.needsHydrationToEvaluate()?fZe(s,r.layer):s;c=l.evaluate(T)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const h=a.graphics3DSymbol,p=((n=h.symbol)==null?void 0:n.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,y=r.disablePlacement,_=dot({graphics3DGraphic:f,labelSymbol:p,labelClass:m,disablePlacement:y});if(_==null)continue;const v=cse(_.anchor),w=ETe(v);e.textRenderers[o]=new TTe(c,w,a.textRenderParameters),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const s=new lne(e,r);this._labels.set(i,s),e.labelsToInitialize.set(i,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,s=this._labels.get(i);e.graphics.delete(i),s&&(this._destroyGraphic(s,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const s=e.graphics.get(i);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const s=new Map;r.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const r=l$(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const s=this._labels.get(i);s&&(this._destroyGraphic(s,i),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(i,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const s=i&&i.emptySymbolLabelSupported||!1,n=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new Aot(this.view._stage,a,e,r,s,n,o,l$(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>l$(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(s=>this._removeGraphic(r,s)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,s=this._labels.get(i);s&&s.visible!==r&&(r&&!s.rendered?(this._labelsToAdd.set(i,s),this._labelsToRemove.delete(i),s.textInitialized||s.labelingContext.labelsToInitialize.set(i,s)):!r&&s.rendered&&(this._labelsToRemove.set(i,s),this._labelsToAdd.delete(i)),s.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>J8(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(J8(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function J8(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function cne(t){return t.labelClassContexts&&t.labelClassContexts.length}function Oot(t){return t.labelClassContexts===null}function l$(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}u([d({constructOnly:!0})],a1.prototype,"view",void 0),u([d({constructOnly:!0})],a1.prototype,"deconflictor",void 0),u([d()],a1.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],a1.prototype,"updating",null),a1=u([R("esri.views.3d.layers.graphics.Labeler")],a1);const Hh=new $Ye(null,null,null);let w3=class lT{constructor(e,r,i,s=null){this.lij=[0,0,0],this.extent=zt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Yo.VISIBLE_ON_SURFACE,screenRect:zt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,r,i,s)}acquire(e,r,i,s){this.tilingScheme=s,this.id=lT.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,s.getExtent(e,r,i,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(r,i,s,this.tilingScheme),e[1].acquire(r,i+1,s,this.tilingScheme),e[2].acquire(r,i,s+1,this.tilingScheme),e[3].acquire(r,i+1,s+1,this.tilingScheme),e):[new lT(r,i,s,this.tilingScheme),new lT(r,i+1,s,this.tilingScheme),new lT(r,i,s+1,this.tilingScheme),new lT(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Eg(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Yo;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Yo||(Yo={}));const N2e=.5*Math.PI,Rot=N2e/Math.PI*180;let Pot=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let r=0;r<4;r++)this._extent[r]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[r]=Mr();this._planes[di.NEAR]=Mr(),this._planes[di.FAR]=Mr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,r,i),le(this._center.origin,n[0].origin,n[2].origin),ie(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ie(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Ng(a.cap.direction,a.origin,l.origin),mO(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ie(a.direction,a.direction,-1)}mO(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[di.NEAR]),s?Lk(this._planes[di.NEAR],this._planes[di.FAR]):(M5(this._planes[di.FAR],this._planes[di.NEAR]),Lk(this._planes[di.NEAR],this._planes[di.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Dr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Ie.Global){const n=this._maxSpanSpatialReference.isGeographic?Rot:N2e*r;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!e.intersectsRay(uu(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&e.intersectsRay(uu(o.origin,o.direction))||e.intersectsLineSegment(db(o.origin,o.cap.next,$ot),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(Y7e(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){_q(e,qh),qh[2]=i,bl(r,qh,Q8,this._renderCoordsHelper.spatialReference),bn(une,Q8),xi(Il);for(const{x0:n,x1:o,y0:a,y1:l}of Mot)for(let c=0;c<5;c++){const h=c/4;qh[0]=xt(e[n],e[o],h),qh[1]=xt(e[a],e[l],h),qh[2]=i,Gs(qh,r,qh,this._renderCoordsHelper.spatialReference),$e(qh,qh,une),$f(Il,qh)}se(this._extent[0].origin,Il[0],Il[1],Il[2]),se(this._extent[1].origin,Il[3],Il[1],Il[2]),se(this._extent[2].origin,Il[3],Il[4],Il[2]),se(this._extent[3].origin,Il[0],Il[4],Il[2]);for(let n=0;n<4;++n)$e(this._extent[n].origin,this._extent[n].origin,Q8)}_toRenderBoundingExtentLocal(e,r,i){_R(e,r,hm,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,hm[0],hm[1],i),se(this._extent[1].origin,hm[2],hm[1],i),se(this._extent[2].origin,hm[2],hm[3],i),se(this._extent[3].origin,hm[0],hm[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case Ie.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case Ie.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(pi(e.planes[di.NEAR],this._center.origin)<0&&me(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(pi(e.planes[di.NEAR],i.origin)<0&&me(i.direction,e.direction)<0)return!0}return!1}};const Mot=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],qh=C(),Q8=ve(),une=ve(),Il=an(),hm=zt(),$ot=op();let Iot=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new M0(e),this._extendedFrustum=new M0(e),this._intersector=new Pot({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Yo.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===Ie.Global&&e.lij[0]>=Lot&&e.lij[0]<Dot,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Yo.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=M0.nearFarLineIndices,i=e.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];he(Oc,l,a),ie(Oc,Oc,Fot),le(i[o],a,Oc)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Yo.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const s=fne.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Yo.INVISIBLE&&(r=o,o===Yo.VISIBLE_ON_SURFACE))break}return fne.release(s),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ie.Global&&e.lij[0]<Not?this._calculateSingleTileVisibilitySided(e,!1)===Yo.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Dr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Yo.VISIBLE_ON_SURFACE:Yo.VISIBLE_WHEN_EXTENDED:Yo.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Oc);this._aboveGround||na(r,r);const i=xn(-me(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Oc),a){case Ye.FAR_BOTTOM_LEFT:case Ye.FAR_TOP_LEFT:case Ye.NEAR_BOTTOM_LEFT:case Ye.NEAR_TOP_LEFT:Dk(this._extendedFrustum.planes[di.LEFT],Oc,Oc);break;case Ye.FAR_BOTTOM_RIGHT:case Ye.FAR_TOP_RIGHT:case Ye.NEAR_BOTTOM_RIGHT:case Ye.NEAR_TOP_RIGHT:Dk(this._extendedFrustum.planes[di.RIGHT],Oc,Oc)}ie(Oc,Oc,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(uu(l,Oc),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),Qo(n[Ye.NEAR_BOTTOM_LEFT],n[Ye.NEAR_BOTTOM_RIGHT],n[Ye.NEAR_TOP_RIGHT],dne),Qo(n[Ye.NEAR_BOTTOM_RIGHT],n[Ye.NEAR_TOP_RIGHT],n[Ye.NEAR_TOP_LEFT],pne),me(dne,pne)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[Ye.NEAR_BOTTOM_LEFT],o[Ye.NEAR_BOTTOM_RIGHT]]=[o[Ye.NEAR_BOTTOM_RIGHT],o[Ye.NEAR_BOTTOM_LEFT]]:[o[Ye.NEAR_TOP_LEFT],o[Ye.NEAR_TOP_RIGHT]]=[o[Ye.NEAR_TOP_RIGHT],o[Ye.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-hne;return{zWithMargin:e,pointIndices:M0.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+hne;return{zWithMargin:e,pointIndices:M0.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const Lot=2,Dot=6,Not=12,Fot=.95,hne=1,Oc=C(),dne=Mr(),pne=Mr(),fne=new No(Array,t=>{t.length!==4&&(t[0]=new w3,t[1]=new w3,t[2]=new w3,t[3]=new w3)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let Uot=class{constructor(e){this._camera=new lt,this._focusOnMap=[0,0],this._screenRect=zt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new Iot(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,yq(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=GIe(e.extent,this._focusOnMap),e.measures.visibility!==Yo.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=Vot,i=1<<r,s=e.measures.screenRect;yc(s);let n=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),h=c*c;for(let p=0;p<i;p++)for(let f=0;f<i;f++)if(n+=this._computeScreenArea(e,o,a+p,l+f,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Yo.VISIBLE_WHEN_EXTENDED?this._tileSize*zot:this._tileSize}_computeScreenArea(e,r,i,s,n){const o=e.measures.visibility===Yo.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,Cy),yc(K8);for(let a=0;a<4;a++)n2(K8,Cy[a]);return t_(n,K8,n),Nee(Cy[0],Cy[1],Cy[2])+Nee(Cy[0],Cy[2],Cy[3])}_projectToScreen(e,r,i,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,KE),this._toRenderCoords(KE,0,3,Ay[0]),this._toRenderCoords(KE,2,3,Ay[1]),this._toRenderCoords(KE,2,1,Ay[2]),this._toRenderCoords(KE,0,1,Ay[3]),s&&(this._projectToPlane(Ay,this._camera.frustum[di.NEAR]),this._projectToPlane(Ay,this._camera.frustum[di.TOP]),this._projectToPlane(Ay,this._camera.frustum[di.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(Ay[o],mne),this._camera.renderToScreen(mne,n[o])}_projectToPlane(e,r){for(let s=0;s<4;s++)tC[s]=pi(r,e[s]);const i=Math.max(tC[0],tC[1],tC[2],tC[3]);if(i>0){const s=ie(eC,r,-i);for(let n=0;n<4;n++)le(e[n],e[n],s)}}_toRenderCoords(e,r,i,s){return eC[0]=e[r],eC[1]=e[i],eC[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(eC,this._tilingScheme.spatialReference,s),s}};const K8=zt(),Vot=2,zot=5,Cy=[Zi(),Zi(),Zi(),Zi()],KE=zt(),eC=C(),Ay=[C(),C(),C(),C()],tC=[0,0,0,0],mne=Fo();function J$t(t,e,r){if(t==null||r==null)return!1;let i=!0;return Js[0]=t.xmin!=null?t.xmin:0,Js[1]=t.ymin!=null?t.ymin:0,Js[2]=t.zmin!=null?t.zmin:0,i=i&&oi(Js,t.spatialReference,0,e,r,0,1),Js[0]=t.xmax!=null?t.xmax:0,Js[1]=t.ymax!=null?t.ymax:0,Js[2]=t.zmax!=null?t.zmax:0,i=i&&oi(Js,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function F2e(t,e,r){if(t==null||r==null)return!1;let i=!0;return Js[0]=t.xmin!=null?t.xmin:0,Js[1]=t.ymin!=null?t.ymin:0,Js[2]=t.zmin!=null?t.zmin:0,i=i&&oi(Js,t.spatialReference,0,Js,r,0,1),e[0]=Js[0],e[1]=Js[1],Js[0]=t.xmax!=null?t.xmax:0,Js[1]=t.ymax!=null?t.ymax:0,Js[2]=t.zmax!=null?t.zmax:0,i=i&&oi(Js,t.spatialReference,0,Js,r,0,1),e[2]=Js[0],e[3]=Js[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const Js=C();let so=class extends xe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void J.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=zt();return F2e(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Mt,this.tileSize=512,this._idToTile=new Map,this._handles=new Pi,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Bt}initialize(){this._handles.add([ue(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Gr),ue(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Cs)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(dt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Li(this._frameWorker),this._handles=Pe(this._handles)}addClient(){const e=Bot();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Ba(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Fa))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=dt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=dt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Uot({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new w3(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const s=r.measures.screenRect,n=i.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),yc(c$);for(let r=0;r<e.length;r++)if(t_(c$,e.data[r].measures.screenRect,c$),Kd(c$)>Got)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!cR(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Yo.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const r=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),i=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Yo.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};u([d({constructOnly:!0})],so.prototype,"scheduler",void 0),u([d({constructOnly:!0})],so.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],so.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],so.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],so.prototype,"focus",void 0),u([d({constructOnly:!0})],so.prototype,"viewState",void 0),u([d({constructOnly:!0})],so.prototype,"terrain",void 0),u([d()],so.prototype,"tiles",void 0),u([d()],so.prototype,"tileSize",void 0),u([d({readOnly:!0})],so.prototype,"tilingScheme",null),u([d()],so.prototype,"filterExtent",null),u([d({readOnly:!0})],so.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],so.prototype,"_rootTileIds",null),u([d({value:!1})],so.prototype,"suspended",null),u([d({readOnly:!0})],so.prototype,"updating",null),so=u([R("esri.views.3d.layers.support.FeatureTileTree3D")],so);let kot=0;function Bot(){return kot++}const c$=zt(),Got=10;let es=class extends xe{constructor(){super(...arguments),this._propertiesPool=new Mg({camera:lt},this),this._lastSeenCameraProjectionValues=new lt,this.mode=$r.ANIMATING,this._cssCamera=new lt,this._camera=new lt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Is,this.viewingMode=Ie.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new Rm({mode:this.viewingMode}))}exit(){var e;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Mg({camera:lt},this)}destroy(){var e,r;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,(r=this._propertiesPool)==null||r.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ie.Global){const e=Dr(this.spatialReference).radius;this.camera=new lt({eye:Ae(4*e,0,0),center:Ae(e,0,0),up:Ae(0,0,1)})}else this.camera=new lt({eye:Ae(0,0,100),center:Ae(0,0,0),up:Ae(0,1,0)})}get animation(){return this.cameraController instanceof AO&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/s),e.width=Math.round(i/s),e}set camera(e){e!==bu&&bu.copyFrom(e),bu.computeUp(this.viewingMode),this.events.emit("before-camera-change",bu);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,bu)&&(this._lastSeenCameraProjectionValues.copyFrom(bu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(bu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(bu),this._cameraChanged=!r.almostEquals(bu),this._cameraChanged)){const i=ahe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===$r.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ie.Global}get isLocal(){return this.viewingMode===Ie.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(gne),this.addHandles(bh(()=>e.state===Wi.Finished||e.state===Wi.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),gne),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Wi.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Wi.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();bu.copyFrom(this._get("camera")),e(bu),this.camera=bu,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[er.TOP]!==r.padding[er.TOP]||e.padding[er.RIGHT]!==r.padding[er.RIGHT]||e.padding[er.BOTTOM]!==r.padding[er.BOTTOM]||e.padding[er.LEFT]!==r.padding[er.LEFT]}};u([d()],es.prototype,"mode",void 0),u([d({readOnly:!0,type:tS})],es.prototype,"animation",null),u([d({type:lt})],es.prototype,"camera",null),u([d({type:lt})],es.prototype,"cssCamera",null),u([d()],es.prototype,"_cssCamera",void 0),u([d()],es.prototype,"_camera",void 0),u([d({readOnly:!0})],es.prototype,"pixelRatio",null),u([d()],es.prototype,"rasterPixelRatio",void 0),u([d()],es.prototype,"contentPixelRatio",void 0),u([d({readOnly:!0})],es.prototype,"alignPixelEnabled",null),u([d({readOnly:!0})],es.prototype,"updating",null),u([d({})],es.prototype,"_contentCamera",void 0),u([d({type:lt})],es.prototype,"contentCamera",null),u([d({readOnly:!0})],es.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],es.prototype,"constraints",void 0),u([d({readOnly:!0})],es.prototype,"events",void 0),u([d({readOnly:!0})],es.prototype,"isGlobal",null),u([d({readOnly:!0})],es.prototype,"isLocal",null),u([d({readOnly:!0})],es.prototype,"viewingMode",void 0),u([d({readOnly:!0})],es.prototype,"spatialReference",void 0),u([d()],es.prototype,"navigating",null),u([d()],es.prototype,"stationary",null),u([d()],es.prototype,"_cameraChanged",void 0),u([d()],es.prototype,"cameraController",null),es=u([R("esri.views.3d.state.ViewState")],es);const jot=es,bu=new lt,gne="ViewStateHandles";let Hot=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Bt,this._tolerance=aS,this._tmpRay=kn(),this._tmpRegion=zt(),this._validateHUDIntersector=Ch(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),yne(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,yne(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,s){return r.options.selectionMode=!1,r.options.store=fo.MIN,this.computeIntersection(e,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,s=.5){return e.getRenderCenter(d$,i,s),d$[0]+=.0466,d$[1]-=.0123,OX(e,d$,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const s=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||lp(s)&&s.intersector!==Bi.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=aS){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Bi.TERRAIN?1:i.type===Bi.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Bi.TERRAIN?1:i.type===Bi.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return Tve(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==Ie.Local||e==null||le(r,e.origin,ge(Ne.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,s)}_intersectElevation(e,r,i=0,s=null){if(e==null)return null;const n=r!=null?r.mode:"absolute-height",o=(r==null?void 0:r.offset)??0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,h$)){const T=this._view.computeMapPointFromVec3d(h$);return T.z??(T.z=0),T.z-=o,T}return null}const c=this._view.state.camera,h=Ne.get();c.projectToRenderScreen(e.origin,h);const p=new _ne(null,this._forEachLayer),f=this._view.slicePlane,m=f!=null?Cte(f):null,y=Ch(this.viewingMode);y.options.store=fo.MIN,y.options.verticalOffset=l;const _=e.origin,v=le(Ne.get(),_,e.direction);y.reset(_,v,c),y.point=h;const w=s?"type"in s&&s.type==="graphics"?T=>T.layerUid!==s.uid:T=>T.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const T=x=>(!w||w(x))&&!!x.lastValidElevationBB;y.intersect(p.layers,h,this._tolerance,null,T),this._externalIntersectionHandlers.forAll(x=>{if(x.type===Bi.I3S||x.type===Bi.TERRAIN){const S=x.slicePlaneEnabled?m:null;x.intersect(y,S,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(T=>{if(T.isGround){const x=T.slicePlaneEnabled?m:null;T.intersect(y,x,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(h$)){const T=this._view.computeMapPointFromVec3d(h$);return T.z=i,T}return null}computeIntersection(e,r,i){var y;if(e==null)return;const s=this._view.state.camera,n=Ne.get();s.projectToRenderScreen(e.origin,n);const o=new _ne(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=le(Ne.get(),e.origin,e.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=c!=null?Cte(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const v=_.layerUid,w=Array.isArray(v),T=w?v:[v];w&&(r.options.filteredLayerUids=[]);let x=!1;for(const S of T)o.filterLayerUid(S)?x=!0:w&&r.options.filteredLayerUids.push(S);if(r.options.isFiltered=!x,_.isGround&&p||!r.options.isFiltered){const S=_.slicePlaneEnabled?h:null;_.intersect(r,S,a,l,n)}});const f=Ne.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&m.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const _=m.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,w=Ne.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(f[0],f[1],f[2],v,"ground"))??0,_.intersect(r,w,r.results.ground,T=>o.filterRenderGeometry(T))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;Eg(this._tmpRegion,XV);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=w=>{const T=new Wot(w);i.projectToRenderScreen(w.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),n2(n,T.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const w of r.all)r.min.target.object!==w.target.object&&r.max.target.object!==w.target.object&&o(w);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-x3),h=Math.max(0,n[1]-x3),p=Math.min(Yc(n)+2*x3,a-c),f=Math.min(Kd(n)+2*x3,l-h),m=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,h,p,f,m);let y=!0;const _=e.results.max.dist==null;let v=0;for(const w of s)for(const T of qot)if(m[4*(Math.min(w.screenPoint[0]+T[0],a)-n[0]+(Math.min(w.screenPoint[1]+T[1],l)-n[1])*p)]){y&&(e.results.min.copy(w.result),y=!1),_&&e.results.max.copy(w.result),e.options.store===fo.ALL&&e.results.all.splice(v++,0,w.result);break}}};const x3=1,qot=(()=>{const t=[],e=x3;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let Wot=class{constructor(e){this.result=e,this.screenPoint=Fo()}},u$;function yne(t){return u$&&u$.viewingMode===t||(u$=Ch(t)),u$}let _ne=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function vne(t){return typeof t=="object"&&"intersect"in t}const h$=C(),d$=Fo();let iIt=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,s,n){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,n,i,s)}},Xot=class{constructor(e,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(dt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,s=0){const n=mo(),o={x:e,y:r,minDemResolution:s,result:n,signal:i};return this._queries.push(o),sa(i,()=>{vH(this._queries,o),n.reject(Lr())}),n.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(h=>h.result.reject()),void e.madeProgress();const s=r.map(h=>[h.x,h.y]),n=r.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new lR({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(h=>!!h.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let h=0;r.forEach(p=>sa(p.signal,()=>{h++,p.result.reject(Lr()),h===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(h=>{r.forEach((p,f)=>{p.signal!=null&&p.signal.aborted?p.result.reject(Lr()):p.result.resolve(h.geometry.points[f][2])})}).catch(h=>{r.forEach(p=>p.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(Fa)}}},T3=class extends Is.EventedMixin(xe){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Pe(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new Xot(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&wn(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=p$(o,this._im,e,r,i,s,n),o==null&&(o=p$(o,this._ground,e,r,i,s,n)),n==="scene"&&(o=p$(o,this._scene,e,r,i,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,s=-1/0;for(const n of[this._im,this._ground,this._scene])n.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),s=Math.max(s,a.max))}});return{min:i,max:s}}queryElevation(e,r,i,s,n,o=null,a=0){const l=mo();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{n==="scene"&&(c=p$(c,this._scene,e,r,i,s,n)),l.resolve(c)}).catch(c=>{gs(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,s,n))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){var r;this._handles.has(e)&&((r=this._handles.get(e))==null||r.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const s=i.indexOf(e);s>-1&&i.splice(s,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function p$(t,e,r,i,s,n,o){for(const a of e){const l=a.getElevation(r,i,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}u([d({constructOnly:!0})],T3.prototype,"view",void 0),u([d()],T3.prototype,"spatialReference",null),T3=u([R("esri.views.3d.support.CombinedElevationProvider")],T3);let S3=class iG{static isValidProfile(e){return e in iG.profiles}static getDefaultProfile(){return oe("esri-iPhone")?"low":"medium"}static apply(e,r){const i=iG.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function bne(){const t=!!oe("esri-mobile"),e=!!oe("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!oe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!oe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}S3.test={reset(){const t=bne();for(const e of Object.keys(t))S3.profiles[e]=t[e]}},function(t){t.profiles=bne()}(S3||(S3={}));const xL=S3;function U2e(){return new Float32Array(4)}function Zot(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Bf(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function Yot(t,e){return new Float32Array(t,e,4)}function V2e(){return U2e()}function z2e(){return Bf(1,1,1,1)}function k2e(){return Bf(1,0,0,0)}function B2e(){return Bf(0,1,0,0)}function G2e(){return Bf(0,0,1,0)}function j2e(){return Bf(0,0,0,1)}const Jot=V2e(),Qot=z2e(),Kot=k2e(),eat=B2e(),tat=G2e(),rat=j2e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Qot,UNIT_W:rat,UNIT_X:Kot,UNIT_Y:eat,UNIT_Z:tat,ZEROS:Jot,clone:Zot,create:U2e,createView:Yot,fromValues:Bf,ones:z2e,unitW:j2e,unitX:k2e,unitY:B2e,unitZ:G2e,zeros:V2e},Symbol.toStringTag,{value:"Module"}));const wne=new ke([0,255,255]),xne=new ke([0,0,0]),Tne=1,Sne=.25,Ene=.4,Cne=.2;let Wp=class extends xe{constructor(){super(...arguments),this.color=wne.clone(),this.haloColor=null,this.haloOpacity=Tne,this.fillOpacity=Sne,this.shadowOpacity=Ene,this.shadowColor=xne.clone(),this.shadowDifference=Cne}static toEngineOptions(e){const r=ke.toUnitRGBA(e.color??wne),i=e.haloColor!=null?ke.toUnitRGBA(e.haloColor):r,s=ke.toUnitRGBA(e.shadowColor??xne),n=e.haloOpacity??Tne,o=e.fillOpacity??Sne,a=e.shadowOpacity??Ene,l=e.shadowDifference??Cne;return{color:Bf(r[0],r[1],r[2],r[3]),haloColor:Bf(i[0],i[1],i[2],i[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Nt(s[0],s[1],s[2],s[3]),occludedShadowOpacity:a*(1-l)}}};u([d({type:ke})],Wp.prototype,"color",void 0),u([d({type:ke})],Wp.prototype,"haloColor",void 0),u([d()],Wp.prototype,"haloOpacity",void 0),u([d()],Wp.prototype,"fillOpacity",void 0),u([d()],Wp.prototype,"shadowOpacity",void 0),u([d({type:ke})],Wp.prototype,"shadowColor",void 0),u([d()],Wp.prototype,"shadowDifference",void 0),Wp=u([R("esri.views.3d.support.HighlightOptions")],Wp);const sG=Wp;function iat(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function sat(t){return typeof t=="string"?go(t):Q(t)}function nat(t,e,r){const i={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=nat(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=e?o:JSON.stringify(o)}else i[s]=e?n:JSON.stringify(n);else i[s]=n}return i}function lIt(t){return{geometryType:Eq(t[0]),geometries:t.map(e=>e.toJSON())}}function oat(t,e,r){const i=rLe(e);return t.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}let l1=class extends de{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:Eq(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],l1.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],l1.prototype,"outSpatialReference",void 0),u([d()],l1.prototype,"transformation",void 0),u([d()],l1.prototype,"transformForward",void 0),l1=u([R("esri.rest.support.ProjectParameters")],l1);const oY=l1,aat=Hs(oY);async function H2e(t,e,r){e=aat(e);const i=sat(t),s={...i.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=Eq(e.geometries[0]),a=iat(s,r);return Nr(i.path+"/project",a).then(({data:{geometries:l}})=>oat(l,o,n))}async function aY(t=null,e){var s,n;if(Zr.geometryServiceUrl)return Zr.geometryServiceUrl;if(!t)throw new U("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||jn.getDefault():t,await r.load({signal:e});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new U("internal:geometry-service-url-not-configured");return i}async function lat(t,e,r=null,i){const s=await aY(r,i),n=new oY;n.geometries=[t],n.outSpatialReference=e;const o=await H2e(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new U("internal:geometry-service-projection-failed")}const cat=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:aY,projectGeometry:lat},Symbol.toStringTag,{value:"Module"}));let uat=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=qa(this.spatialReference,Dr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=aY(e&&e.get("portalItem")).catch(()=>{throw new U("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],s=!1);const n=i.map(l=>l instanceof pt?l:new pt(l,this.spatialReference)),o=new oY({geometries:n,outSpatialReference:Ge.WGS84}),a=(await H2e(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}},bd=class extends xe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],bd.prototype,"minTotalNumberOfFeatures",void 0),u([d()],bd.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],bd.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],bd.prototype,"snapshotAvailable",void 0),u([d()],bd.prototype,"polygonLodFactor",void 0),u([d()],bd.prototype,"polylineLodFactor",void 0),u([d()],bd.prototype,"skipHighSymbolLods",void 0),bd=u([R("esri.views.3d.support.QualitySettings.Graphics3DSettings")],bd);let Af=class extends xe{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Af.prototype,"lodFactor",void 0),Af=u([R("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Af);let i4=class extends Af{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};i4=u([R("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],i4);let Wm=class extends xe{constructor(){super(...arguments),this.object=new i4,this.point=new Af,this.integratedMesh=new Af,this.pointCloud=new Af,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:i4})],Wm.prototype,"object",void 0),u([d({type:Af})],Wm.prototype,"point",void 0),u([d({type:Af})],Wm.prototype,"integratedMesh",void 0),u([d({type:Af})],Wm.prototype,"pointCloud",void 0),u([d()],Wm.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Wm=u([R("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Wm);let T0=class extends xe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],T0.prototype,"lodBias",void 0),u([d()],T0.prototype,"angledSplitBias",void 0),u([d()],T0.prototype,"reduceTileLevelDifferences",void 0),u([d()],T0.prototype,"textureFadeDuration",void 0),T0=u([R("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],T0);let YT=class extends xe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],YT.prototype,"pixelRatio",void 0),u([d()],YT.prototype,"maxTotalNumberOfFeatures",void 0),YT=u([R("esri.views.3d.support.QualitySettings.HeatmapSettings")],YT);let So=class extends xe{constructor(){super(...arguments),this.graphics3D=new bd,this.sceneService=new Wm,this.tiledSurface=new T0,this.heatmap=new YT,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:bd})],So.prototype,"graphics3D",void 0),u([d({type:Wm})],So.prototype,"sceneService",void 0),u([d({type:T0})],So.prototype,"tiledSurface",void 0),u([d({type:YT})],So.prototype,"heatmap",void 0),u([d()],So.prototype,"fadeDuration",void 0),u([d()],So.prototype,"antialiasingEnabled",void 0),u([d()],So.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],So.prototype,"highQualityTransparency",void 0),u([d()],So.prototype,"highResolutionAtmosphere",void 0),u([d()],So.prototype,"reflections",void 0),u([d()],So.prototype,"ambientOcclusion",void 0),u([d()],So.prototype,"memoryLimit",void 0),u([d()],So.prototype,"additionalCacheMemory",void 0),u([d()],So.prototype,"frameRate",void 0),u([d()],So.prototype,"maximumPixelRatio",void 0),So=u([R("esri.views.3d.support.QualitySettings.QualitySettings")],So);const Ane=So;function hat(t){return AS(t)&&t.length>=3}function dat(t){return(OS(t)||Array.isArray(t))&&t.length>=3}function pat(t){return hat(t)||dat(t)}let fat=class nG{constructor(e,r,i,s){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=q6e(s)}set extent(e){e&&W6e(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return tUe(this._coordinateSystem,e)}setAltitude(e,r,i=e){return fye(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){rUe(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return J6e(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return Q6e(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,cc.X,Ne.get()),s=this.worldBasisAtPosition(e,cc.Y,Ne.get()),n=this.worldBasisAtPosition(e,cc.Z,Ne.get());return Xf(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Ne.get()),s=this.worldBasisAtPosition(e,cc.Y,Ne.get()),n=Gge(r,s,i);return ja(n)}intersectManifoldClosestSilhouette(e,r,i){return q6(this._coordinateSystem,r,this._tmpCoordinateSystem),eUe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){q6(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=Ne.get();return K6e(this._tmpCoordinateSystem,e,s)?re(i,s):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===Ie.Global)return this.intersectManifold(e,r,i);q6(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Ne.get();return gw(s.plane,e,n)?re(i,n):null}toRenderCoords(e,r,i){return PN(e)?yo(e,r,this.spatialReference):Gs(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return PN(r)?(i!=null&&(r.spatialReference=i),lW(e,this.spatialReference,r)):pat(r)?Gs(e,this.spatialReference,r,i)?r:null:Rg(e,this.spatialReference,r)}static create(e,r){switch(e){case Ie.Local:return new nG(Ie.Local,r,qa(r),Y6e());case Ie.Global:return new nG(Ie.Global,r,1,Z6e(r))}}static renderUnitScaleFactor(e,r){return FJ(e)/FJ(r)}};var pf;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(pf||(pf={}));const mat=(()=>{const t=new Array;return t[pf.ELEVATION]=10,t[pf.BASEMAP]=10,t[pf.I3S_INDEX]=10,t[pf.I3S_DATA]=10,t[pf.SYMBOLOGY]=5,t})(),gat=30;function q2e(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function yat(t){return new ll({view:t})}const f$=1,e9=1,_at=.75,vat=.6,One=1.3;let ll=class extends xe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Rxe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(f$),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,r){return new JQe(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<vat&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(f$);else if(e)(this._memoryPredicted>1.1*e9||this._usedMemory>e9)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/One),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>e9)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/One),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<_at&&this._quality<f$){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),f$))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l;if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const r=((a=this.view)==null?void 0:a._stage)&&this.view._stage.renderView&&((l=this.view._stage.renderer)==null?void 0:l.edgeView);r!=null&&(e+=r.usedMemory);let i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(c=>{if(q2e(c)){const h=c.ignoresMemoryFactor?this._quality:1;e+=c.usedMemory*h,i+=c.unloadedMemory*h}});const s=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const c=p=>(p/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",h=Math.round(100*this._quality);J.getLogger(this).warn(`Memory Limit exceeded! Limit: ${c(n)} Current: ${c(e)} Projected: ${c(e+i)} Quality: ${h}%`)}this._usedMemory=e/n,this._memoryPredicted=(e+i)/n;const o=n-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};u([d({constructOnly:!0})],ll.prototype,"view",void 0),u([d()],ll.prototype,"maxMemory",null),u([d()],ll.prototype,"additionalCacheMemory",null),u([d()],ll.prototype,"memoryFactor",null),u([d()],ll.prototype,"updating",null),u([d()],ll.prototype,"usedMemory",null),u([d()],ll.prototype,"_quality",void 0),u([d()],ll.prototype,"_usedMemory",void 0),u([d()],ll.prototype,"_updating",void 0),u([d()],ll.prototype,"_stableQuality",void 0),u([d()],ll.prototype,"_maxMemory",void 0),u([d()],ll.prototype,"_additionalCacheMemory",void 0),ll=u([R("esri.views.3d.support.MemoryController")],ll);let bat=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},wat=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new xat}},xat=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Tat=class{constructor(e,r,i,s){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new wat(n))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,s)=>this._taskCallback(i,s))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,tt(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},TL=class extends xe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new Tat((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,r),i&&(this._frameTask=i.registerTask(dt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Li(this._frameTask),this._tasks.forEach(e=>ou(e.abortController)),this._loadQueue=Pe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,s={}){const n=mo();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,r,i,s,n);return sa(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,r,i,s,n,o){const a=new Cat(e,r,i,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;XA(e.resolvers,r),r.reject(Lr()),e.resolvers.length===0&&(e.status===Bu.DOWNLOADING&&(e.status=Bu.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=Bu.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,s,n){const o=Aat(s!=null&&s.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,r,i,o,n)}_doneLoadingCB(e,r){this._loadQueue&&(tt(e.status===Bu.DOWNLOADING),e.status=Bu.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();Jt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==Bu.DOWNLOADED&&(r.err=r.err||Lr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!gs(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(r)gs(r)?s.reject(r):s.reject(new U("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const n=i<=0?e.result:Q(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===Bu.CANCELLED)return!1;let i,s;switch(e.startTime=performance.now(),e.status=Bu.DOWNLOADING,e.docType){case"binary":s="array-buffer",i=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=Nr(e.url,{...e.options,responseType:s,timeout:i,signal:n});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===Bu.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const h=c.data,p=Eat(h);if(s="image",e.size=h.byteLength,p==="unknown")return e.request=Nr(e.url,{responseType:s,timeout:i,signal:n}),void e.request.then(y=>a(y.data),l);const f=new Blob([h],{type:p}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=Nr(m,{responseType:s,timeout:i,signal:n}),e.request.then(y=>a(new kF(y.data,p,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],TL.prototype,"updating",void 0),TL=u([R("esri.views.3d.support.StreamDataLoader")],TL);const Sat={numRetries:0};function Eat(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let kF=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},Cat=class extends bat{constructor(e,r,i,s,n){super(s),this.url=e,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=Bu.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Sat.numRetries}};function Aat(t,e,r){return`${t}:${e}:${r}`}var Bu;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Bu||(Bu={}));let SL=class extends xe{constructor(){super(...arguments),this.updating=!1}};function Oat(t){return new ad({view:t})}u([d({readOnly:!0})],SL.prototype,"updating",void 0),SL=u([R("esri.views.3d.support.ResourceControllerMain")],SL);let ad=class extends SL{constructor(){super(...arguments),this._immediateTask=eS,this._normalTask=eS,this._updatingObjects=_O([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=m9e(),this._memoryController=yat(this.view),this._streamDataLoader=new TL,this._streamDataLoader.setup(gat,mat,this._scheduler),this.addHandles([ue(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Gr),ue(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=$2({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(dt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(dt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Li(this._frameTask),this._streamDataLoader=Pe(this._streamDataLoader),this._memoryController=Pe(this._memoryController),this._scheduler=Pe(this._scheduler),this.view=null}get updating(){var e,r,i,s;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,s,n)=>r.request(i,s,e,n),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],Ba(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(AH(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d()],ad.prototype,"view",void 0),u([d()],ad.prototype,"_scheduler",void 0),u([d()],ad.prototype,"_memoryController",void 0),u([d()],ad.prototype,"_streamDataLoader",void 0),u([d()],ad.prototype,"_immediateTask",void 0),u([d()],ad.prototype,"_normalTask",void 0),u([d()],ad.prototype,"_updatingObjects",void 0),u([d({readOnly:!0})],ad.prototype,"updating",null),ad=u([R("esri.views.3d.support.ResourceControllerImpl")],ad);function Rat(t){return q2e(t)}function Pat(t){return"performanceInfo"in t}var Jo,it;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Jo||(Jo={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(it||(it={}));const fx=C(),Mat=C(),dm=C(),pm=C();function $at(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return tpe(i,e);const s=Math.min(i[2]-i[0],i[3]-i[1]);return BIe(i,e,r*s)}function m$(t,e,r,i){re(fx,r),fx[i]=e[i];const s=he(fx,fx,e),n=he(Mat,t,e),o=me(n,s),a=me(s,s);let l;l=o<=0?e:a<=o?r:le(fx,e,ie(s,s,o/a));const c=he(fx,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Iat(t,e,r){const i=t.extent;if(i==null)return 0;dm[0]=i[0],dm[1]=i[1],dm[2]=r,pm[0]=i[2],pm[1]=i[3],pm[2]=r;let s=1/0,n=1/0;return e[0]<dm[0]?s=m$(e,dm,pm,0):e[0]>pm[0]&&(s=m$(e,pm,dm,0)),e[1]<dm[1]?n=m$(e,dm,pm,1):e[1]>pm[1]&&(n=m$(e,pm,dm,1)),Math.min(s,n)}function Lat(t,e,r){if(t==null)return $W();if(t.spatialReference.isGeographic&&!y_(t.spatialReference))return new U("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=ic.checkUnsupported(t);if(i!=null)return i;if(r==null)return new U("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=Dat(t,r);if(s)return s;const n=t.spatialReference;return e==null||n.equals(e)||e.isWGS84&&n.isWebMercator?null:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function Dat(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,s=[i*t.size[0],i*t.size[1]],n=[t.origin.x,t.origin.y],o=Kde(e),a=zt();ic.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>VT){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new U("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:VT})}return null}const Nat=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Lat,isInsideExtent:$at,tiltToExtentEdge:Iat},Symbol.toStringTag,{value:"Module"}));function Fat(){return!0}function Uat(){return 0}function Vat(t,e){if(t==null)return $W();const r=t.lods.length-1,i=t.spatialReference,s=y_(i)||Hf(i)||qf(i);if(i.isWebMercator){if(!ic.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new U("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new U("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!ic.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new U("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new U("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new U("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const zat=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Vat,isInsideExtent:Fat,tiltToExtentEdge:Uat},Symbol.toStringTag,{value:"Module"})),kat={[Ie.Global]:zat,[Ie.Local]:Nat};function of(t,e){t||console.warn("Terrain: "+e)}let rn=!1,s4=!1;function Bat(t){s4=t,rn=rn||t}function Gat(t){rn=t}function we(t,e){var r;if(rn&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function oG(t){return BF(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function n4(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function BF(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function lY(t){return(t==null?void 0:t.type)==="tile-3d"}function kO(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function W2e(t){return(t==null?void 0:t.type)==="wmts-3d"}function aG(t){return(t==null?void 0:t.type)==="elevation-3d"}function rC(t){return(t==null?void 0:t.type)==="group"}function o4(t){return t&&(lY(t)||W2e(t)||BF(t)||kO(t))}function lG(t){return t&&(lY(t)||BF(t)||kO(t)||W2e(t))}function BO(t){return lG(t)||aG(t)}function jat(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function X2e(t){return Z2e(t==null?void 0:t.sourceLayerInfo)}function Hat(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function qat(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof kF||e instanceof HTMLCanvasElement||e instanceof ImageData}function Z2e(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function v2(t){return t!=null&&"release"in t&&t.release(),null}function Rne(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function cY(t,e,r,i){return kat[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function GF(t,e,r){let i=null,s=null;if((t==null?void 0:t.type)==="wmts"){const n=Wat(t,e,r);i=n.tileInfo,s=n.fullExtent}else{s=n4(t)?t.getCompatibleFullExtent(e):t.fullExtent;const n=r===Ie.Local;if(n4(t))i=t.getCompatibleTileInfo(e,s,n);else if((t==null?void 0:t.type)==="vector-tile"){const o=n&&!Xat(e)||Zat.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&s!=null&&cY(i,s,e,r)==null?{tileInfo:i,fullExtent:s}:null}function Wat(t,e,r){const i=h$e(t);if(i!=null){if(!Mt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>cY(n.tileInfo,n.fullExtent,e,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Xat(t){return t.isWGS84||t.isWebMercator||Zhe(t)||!eO(t)}const Zat={force512VTL:!1};function Pne(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function fm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function eh(t,e,r=Qat){return Math.abs(t-e)<r}function a4(t){return t===it.NORTH_EAST?it.SOUTH_WEST:t===it.NORTH_WEST?it.SOUTH_EAST:t===it.SOUTH_WEST?it.NORTH_EAST:it.NORTH_WEST}function l4(t){return t===it.NORTH?it.SOUTH:t===it.EAST?it.WEST:t===it.SOUTH?it.NORTH:it.EAST}function Yat(t){return t===it.NORTH_WEST||t===it.SOUTH_WEST}function Jat(t){return t===it.NORTH_WEST||t===it.NORTH_EAST}function Mne(t){return t===it.NORTH_WEST||t===it.WEST||t===it.SOUTH_WEST}function $ne(t){return t===it.NORTH_EAST||t===it.EAST||t===it.SOUTH_EAST}function Ine(t){return t===it.SOUTH_EAST||t===it.SOUTH||t===it.SOUTH_WEST}function Lne(t){return t===it.NORTH_EAST||t===it.NORTH||t===it.NORTH_WEST}const gf=[it.NORTH,it.EAST,it.SOUTH,it.WEST],GO=[it.NORTH_EAST,it.SOUTH_EAST,it.SOUTH_WEST,it.NORTH_WEST],Qat=1e-5;let Kat=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=BO(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,Pat(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},elt=class{constructor(e){var i;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const s=e.resourceController.memoryController;this.totalMemory=(s.maxMemory??0)*QD.MEGABYTES,this.usedMemory=Math.round(s.usedMemory*this.totalMemory),this.quality=s.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,e.allLayerViews.items.forEach(s=>{(Rat(s)||BO(s))&&this.layerPerformanceInfos.push(new Kat(s,e))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}},tlt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const s=i?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>XTe(new qTe(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>ZTe(e,n),r)}async _loadOnce(e,r,i,s,n){Jt(n);const o=sa(n,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),Jt(n),l}finally{Li(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},rlt=class extends zT{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){Jt(i);const s=i!=null?i.signal:null,n=this.makeUid(e,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new Hye,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(e,h,r);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:n,texture:p,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await Jue(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,r,i){var n;const s={width:r.width,height:r.height,wrap:{s:Lt.CLAMP_TO_EDGE,t:Lt.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(Ghe(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new Tw(r,s)}},ilt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(pf.SYMBOLOGY),this.objectResourceCache=new tlt((i,s)=>e.resourceController.memoryController.newCache(i,s)),this.textures=new rlt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Dr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=x1e(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=eWe(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Ba();this._graphicsOwners.push(e);const r=ue(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Ba(()=>{r.remove(),XA(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Pi;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ue(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,Gr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Pe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;g$.distance=e.centerOnSurfaceInfrequent.distance,g$.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(g$),this.screenSizePerspectiveSettingsLabels.update(g$),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const g$={distance:0,fovY:0};let cT=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new k0({symbolLayers:[new z0({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new hw({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(r==null)return;this.hide();const i=new pt({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new vh({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},I0=class extends xe{constructor(e){super(e),this.handles=new Pi}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],I0.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],I0.prototype,"surface",void 0),u([d({constructOnly:!0})],I0.prototype,"state",void 0),I0=u([R("esri.views.3d.support.PointOfInterest")],I0);const slt=Array;let ld=class extends I0{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Mg({location:pt,renderLocation:slt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new pt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(ka(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=fi(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return jb(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),zo.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>nlt&&this.renderCoordsHelper.viewingMode===Ie.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?olt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{gs(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,zo.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(t9,this._estimatedSurfaceAltitude,this._camera.eye),ia(this._get("renderLocation"),t9)||(this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),t9)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],ld.prototype,"scheduler",void 0),u([d({constructOnly:!0})],ld.prototype,"cache",void 0),u([d({constructOnly:!0})],ld.prototype,"task",void 0),u([d({readOnly:!0})],ld.prototype,"location",null),u([d({constructOnly:!0})],ld.prototype,"map",void 0),u([d({readOnly:!0})],ld.prototype,"renderLocation",void 0),u([d({readOnly:!0})],ld.prototype,"scale",null),u([d({readOnly:!0})],ld.prototype,"updating",null),ld=u([R("esri.views.3d.support.CameraOnSurface")],ld);const t9=C(),nlt=1e5,olt=1e6,alt=Array;let Gu=class extends I0{constructor(e){super(e),this._propertiesPool=new Mg({location:pt,renderLocation:alt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Li(this._frameWorker),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,zo.YIELD}_updateRenderLocation(){const e=clt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=ult;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(re(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=fi(this._camera.eye,e):(ie(e,this._camera.viewForward,this._get("distance")),le(e,e,this._camera.eye)),ia(this._get("renderLocation"),e)||this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var s,n;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=Dr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=ea(i.eye),c=l<a*a,h=fi(i.eye,r);if(c&&h>o/4){const p=a-Math.sqrt(l);return ie(r,i.viewForward,p),le(r,r,i.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&_R(o,(n=this.surface)==null?void 0:n.spatialReference,iC,this.renderCoordsHelper.spatialReference)&&(r[0]=ye(r[0],iC[0],iC[2]),r[1]=ye(r[1],iC[1],iC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(ni.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,s=fi(i,e),n=fi(i,r);if(Math.abs(n-s)/s>llt)return!0}return!1}};u([d({constructOnly:!0})],Gu.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Gu.prototype,"task",void 0),u([d()],Gu.prototype,"distance",void 0),u([d({constructOnly:!0})],Gu.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Gu.prototype,"location",null),u([d({readOnly:!0})],Gu.prototype,"renderLocation",void 0),u([d()],Gu.prototype,"updating",void 0),Gu=u([R("esri.views.3d.support.CenterOnSurface")],Gu);const llt=.05,clt=C(),ult=C(),iC=zt();let hlt=class{constructor(e){this._handles=new Pi,this.events=new Is,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Pe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",dlt)}};const dlt={},plt=Array;let Xp=class extends I0{constructor(e){super(e),this._propertiesPool=new Mg({location:pt,renderLocation:plt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ue(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ue(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(dt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Pe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,Dne);const n=Math.max(0,(Math.acos(me(Dne,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!l_(e,r)){const c=this._propertiesPool.get("renderLocation");re(c,r),this._set("renderLocation",c)}return zo.YIELD}const o=1-ye(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Nne);const l=this._propertiesPool.get("renderLocation");return Br(l,r,Nne,a),e&&l_(e,l)||this._set("renderLocation",l),zo.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(Fo());if(i[1]=r.aboveGround?r.padding[er.BOTTOM]:r.fullHeight-r.padding[er.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,sC)){he(sC,sC,r.eye);const n=ge(sC,sC);if(this.renderCoordsHelper.intersectManifold(uu(r.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,r.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],Xp.prototype,"_dirty",void 0),u([d({constructOnly:!0})],Xp.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Xp.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],Xp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],Xp.prototype,"updating",null),u([d({readOnly:!0})],Xp.prototype,"location",null),u([d({readOnly:!0})],Xp.prototype,"renderLocation",void 0),Xp=u([R("esri.views.3d.support.pointsOfInterest.Focus")],Xp);const Dne=C(),sC=C(),Nne=C();let $m=class extends xe{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Pi}initialize(){this.view.state.isLocal&&(this._handles.add([ue(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),ka(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=_q(this.surfaceView.extent),r=new pt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{gs(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};u([d({constructOnly:!0})],$m.prototype,"view",void 0),u([d({constructOnly:!0})],$m.prototype,"cache",void 0),u([d()],$m.prototype,"surface",null),u([d()],$m.prototype,"surfaceView",null),u([d({readOnly:!0})],$m.prototype,"location",void 0),u([d({readOnly:!0})],$m.prototype,"renderLocation",null),$m=u([R("esri.views.3d.terrain.StableSurfaceCenter")],$m);let Im=class extends xe{constructor(e){super(e),this._tileGeometryUpdateExtent=yc(),this._tileGeometryUpdateSpatialReference=null,this.events=new Is,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(dt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",flt),yc(this._tileGeometryUpdateExtent),this._set("updating",!1)),zo.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,t_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,s=mlt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Sv,r),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Ev,r),Sv[0]<Ev[0]?(s[0]=Sv[0],s[2]=Ev[0]):(s[0]=Ev[0],s[2]=Sv[0]),Sv[1]<Ev[1]?(s[1]=Sv[1],s[3]=Ev[1]):(s[1]=Ev[1],s[3]=Sv[1]),cR(s,e)}};u([d({constructOnly:!0})],Im.prototype,"state",void 0),u([d({constructOnly:!0})],Im.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],Im.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Im.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Im.prototype,"surface",void 0),u([d({readOnly:!0})],Im.prototype,"updating",void 0),Im=u([R("esri.views.3d.support.SurfaceGeometryUpdates")],Im);const flt={},Sv=C(),Ev=C(),mlt=yc();let hl=class extends xe{constructor(e){super(e),this._handles=new Pi,this._tmpRay=kn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Mg({renderPointOfView:glt},this),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map}initialize(){var h;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:s}=this.view;this._surfaceIntersector=Ch(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=fo.MIN,this._contentIntersector=Ch(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(h=this.view.basemapTerrain)==null?void 0:h.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Gu({...l,task:dt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Gu({...l,task:dt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Gu({...l,task:dt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new ld({...l,cache:a,task:dt.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new Im({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new hlt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new $m({cache:a,view:this.view})),this._set("focus",new Xp({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(p,f)=>this._estimateSurfaceIntersectionAtRenderPoint(p,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new cT(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new cT(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new cT(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new cT(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new cT(c,"green","Focus")),this._handles.add([ue(()=>e.contentCamera,p=>this._cameraChanged(p),Gr),ue(()=>r.extent,()=>this._updateCenterPointsOfInterest()),bh(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),Gr),ka(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),ka(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),bh(()=>ni.SHOW_POI,p=>this._setDebug(p),Vr)]),this._cameraChanged(this.view.state.contentCamera);for(const p of this._pois)p.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,mx,_lt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(mx):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=le(mx,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(mx)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(mx)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const s=OX(r,e,ylt);if(s==null)return null;const n=s.origin,o=le(mx,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;ia(this.renderPointOfView,r)||this._set("renderPointOfView",re(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(ue(()=>r.renderLocation,i=>{var s;return(s=this._debugCenters.get(r))==null?void 0:s.show(i,r.renderCoordsHelper.spatialReference)},Vr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],hl.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],hl.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],hl.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],hl.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],hl.prototype,"focus",void 0),u([d({readOnly:!0})],hl.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],hl.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],hl.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],hl.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],hl.prototype,"view",void 0),u([d({readOnly:!0})],hl.prototype,"updating",null),hl=u([R("esri.views.3d.support.PointsOfInterest")],hl);const glt=Array,mx=C(),ylt=kn(),_lt={exclude:new Set([R0])},jO=new Mt,VA=new WeakMap;function vlt(t){Y2e(t)&&jO.push(t)}function blt(t){Y2e(t)&&jO.includes(t)&&jO.remove(t)}function Y2e(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function J2e(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:J2e(e,t%e):0}let r9=0,y$=0;function wlt(){const t=Date.now();for(const e of jO)e.refreshInterval&&t-(VA.get(e)??0)+5>=6e4*e.refreshInterval&&(VA.set(e,t),e.refresh(t))}she(()=>{const t=Date.now();let e=0;for(const r of jO)e=J2e(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?VA.get(r)||VA.set(r,t):VA.delete(r);if(e!==y$){if(y$=e,clearInterval(r9),y$===0)return void(r9=0);r9=setInterval(wlt,y$)}});function xlt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Tlt=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=CH(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||vlt(this)},()=>{})}destroy(){blt(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){uV(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{J.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),u([d()],e.prototype,"refreshParameters",null),e=u([R("esri.layers.mixins.RefreshableLayer")],e),e};let Slt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},Elt=class{constructor(e,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}},Q2e=class{constructor(e,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=Ime(e,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>J.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Ba(()=>{i.removed=!0,vH(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const s=this._transferLists[e],n=s?s(r):[];return this._thread.invoke(e,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(Jt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},Fne=class extends Q2e{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(zA.forEach((e,r)=>{e===this&&zA.delete(r)}),this.destroy())}};const zA=new Map;function Clt(t=null){let e=zA.get(t);return e||(t!=null?(e=new Fne(r=>t.immediate.schedule(r)),zA.set(t,e)):(e=new Fne,zA.set(null,e))),++e.ref,e}var tc,Une,Vne;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(tc||(tc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Une||(Une={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Vne||(Vne={}));let Alt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},WIt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function ZIt(t,e,r,i,s,n){const o=r-s;if(o>=0)return(e>>o)+(i-(n<<o))*(t>>o);const a=-o;return e-(n-(i<<a))*(t>>a)<<a}let YIt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(e,r,i,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function Olt(t,e,r,i,s,n){const o=e[i++];for(let a=0;a<o;a++){const l=new Alt(n);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let f=0;f<c;f++){const m=e[i++],y=e[i++],_=e[i++],v=e[i++],w=!!e[i++],T=e[i++],x=r[i++],S=r[i++],O=e[i++],A=e[i++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:v,hard:w,partIndex:T,width:O,height:A,minLod:x,maxLod:S})}const h=t[i++];for(let f=0;f<h;f++)l.textVertexRanges.push([t[i++],t[i++]]);const p=t[i++];for(let f=0;f<p;f++)l.iconVertexRanges.push([t[i++],t[i++]]);s.push(l)}return i}function QIt(t,e,r){for(const[i,s]of t.symbols)Rlt(t,e,r,s,i)}function Rlt(t,e,r,i,s){const n=t.layerData.get(s);if(n.type===tc.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let jF=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},Plt=class extends jF{constructor(e,r){super(e,r),this.type=tc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Fe(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Ir.createVertex(e,xr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Ir.createIndex(e,xr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.lineMaterial;this.vao=new xh(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}},Mlt=class extends jF{constructor(e,r){super(e,r),this.type=tc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=i[s++],l=i[s++],c=i[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.fillVAO)==null?void 0:r.memoryEstimate)??0)+(((i=this.outlineVAO)==null?void 0:i.memoryEstimate)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Fe(this.fillVAO),this.outlineVAO=Fe(this.outlineVAO)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Ir.createVertex(e,xr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Ir.createIndex(e,xr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],p=Ir.createVertex(e,xr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=Ir.createIndex(e,xr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new xh(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new xh(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:p},m)}},$lt=class extends jF{constructor(e,r,i){super(e,r),this.type=tc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=Olt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.iconVAO)==null?void 0:r.memoryEstimate)??0)+(((i=this.textVAO)==null?void 0:i.memoryEstimate)??0)+F0(this.iconOpacity)+F0(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=Fe(this.iconVAO),this.textVAO=Fe(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.byteLength&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===s.byteLength&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Ir.createVertex(e,xr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Ir.createIndex(e,xr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=s[i++],p=Ir.createVertex(e,xr.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;const f=s[i++],m=Ir.createIndex(e,xr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,f));i+=f;const y=Ir.createVertex(e,xr.STATIC_DRAW,this.iconOpacity.buffer),_=Ir.createVertex(e,xr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,w=v.iconMaterial,T=v.textMaterial;this.iconVAO=new xh(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new xh(e,T.getAttributeLocations(),T.getLayoutInfo(),{geometry:p,opacity:_},m)}},Ilt=class extends jF{constructor(e,r){super(e,r),this.type=tc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Fe(this.vao)}doPrepareForRendering(e,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++],a=Ir.createVertex(e,xr.STATIC_DRAW,new Int32Array(n.buffer,4*i,o));i+=o;const l=s[i++],c=Ir.createIndex(e,xr.STATIC_DRAW,new Uint32Array(s.buffer,4*i,l));i+=l;const h=this.layer.circleMaterial;this.vao=new xh(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},c)}};const sLt=!0,nLt=32,zne=200,Llt=1/oe("mapview-transitions-duration");let Dlt=class extends Is{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=mo(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=mo(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=e*Llt;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},cG=class c1{static getId(e,r,i,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${s}`}constructor(e,r,i,s){this.set(e,r,i,s)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,s){this.set(e,r,i,s)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new c1(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new c1(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new c1(e,r,i,s),new c1(e,r,i+1,s),new c1(e,r+1,i,s),new c1(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};cG.pool=new No(cG,null,null,25,50);let Nlt=class extends Dlt{constructor(e,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new cG(e),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;ZW(i,o,0,0,0,a,0,s,n,1),sS(this.transforms.dvs,e.displayViewMat3,i)}},i9=class K2e extends Nlt{constructor(e,r,i,s,n,o,a,l=null){super(e,r,i,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<zne}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<zne)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){var i;let r=!1;for(const s of e)if(this.layerData.has(s)){const n=this.layerData.get(s);this._memoryUsedByLayerData-=n.memoryUsed,n.type===tc.SYMBOL&&this.symbols.has(s)&&(this.symbols.delete(s),r=!0),n.destroy(),this.layerData.delete(s),this.layerCount--}(i=this._memCache)==null||i.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(eSe.delete(this),K2e._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var i;let r=!1;if(e){const{bucketsWithData:s,emptyBuckets:n}=e,o=this._createRenderBuckets(s);if(n&&n.byteLength>0){const a=new Uint32Array(n);for(const l of a)this._deleteLayerData(l)}for(const[a,l]of o)this._deleteLayerData(a),l.type===tc.SYMBOL&&(this.symbols.set(a,l.symbols),r=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(a,l),this.layerCount++;(i=this._memCache)==null||i.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[s,n]of this.layerData)n.type===tc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;YW(o),cN(o,o,n),JW(o,o,Math.PI*e.rotation/180),QW(o,o,[i,s,1])}_createTransforms(){return{dvs:xl(),tileMat3:xl(),tileUnitsToPixels:xl()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const s of e){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case tc.FILL:i=new Mlt(e,this.styleRepository);break;case tc.LINE:i=new Plt(e,this.styleRepository);break;case tc.SYMBOL:i=new $lt(e,this.styleRepository,this);break;case tc.CIRCLE:i=new Ilt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const eSe=new Map;function Flt(){eSe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const lLt={value:.5,readOnly:!0},Ult={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let JT=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},Vlt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},zlt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new Vlt(i,r)}computeMinMaxValue(e,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*yO;let f=(c-1)/o,m=(i-this.j*o)*f,y=(r-this.i*o)*f;if(f<1){const _=Math.floor(m),v=Math.floor(y),w=_+v*c,T=h[w],x=h[w+1],S=h[w+c],O=h[w+c+1];if(T+x+S+O<p){const A=m-_,P=y-v,I=PP(T,x,S,O,A,P),V=PP(T,x,S,O,A+f,P),k=PP(T,x,S,O,A,P+f),B=PP(T,x,S,O,A+f,P+f);return s.min=Math.min(I,V,k,B),s.max=Math.max(I,V,k,B),s}m=_,y=v,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let v=y;v<=y+f;v++){const w=h[_+v*c];w<p?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const klt=.5*yO;function Xi(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=ye(i.dy*(i.y1-e),0,s),o=ye(i.dx*(t-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,h=a*c+l,p=i.data.values,f=p[h],m=p[h+1],y=h+c,_=p[y],v=p[y+1];if(f+_+m+v<klt){n-=a,o-=l;const w=f+(m-f)*o;return w+(_+(v-_)*o-w)*n}}return null}let ku=class extends xe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=tSe(i.fullExtent,this.viewSpatialReference);s!=null&&e.push(Kde(s))}}),e}};function Blt(t,e){return t===Ie.Global?new uG(e):new hG(e)}u([d({readOnly:!0})],ku.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],ku.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],ku.prototype,"stencilEnabledExtents",null),u([d()],ku.prototype,"viewSpatialReference",void 0),u([d()],ku.prototype,"tilingScheme",void 0),u([d()],ku.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],ku.prototype,"layers",void 0),u([d({constructOnly:!0})],ku.prototype,"layerViews",void 0),ku=u([R("esri.views.3d.terrain.ExtentHelper")],ku);let uG=class extends ku{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Gye:N8e}};uG=u([R("esri.views.3d.terrain.ExtentHelperGlobal")],uG);let hG=class extends ku{_computeLayerViewsExtent(){const e=yc(),r=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=tSe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,r);t_(e,a,e)}});const i=HV(e)?e:null,s=this._get("layerViewsExtent");return ab(i,s)?s:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=yc();this.layers.forEach(o=>{if(o.loaded&&sA(o)){const a=GF(o,r,Ie.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(n4(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&t_(i,c,i)}}),t_(i,this.defaultTiledLayersExtent,i);const s=HV(i)?i:null,n=this._get("tiledLayersExtent");return ab(s,n)?n:s}};function tSe(t,e){return t==null||t.spatialReference.equals(e)?t:aW(t,t.spatialReference,e)}hG=u([R("esri.views.3d.terrain.ExtentHelperLocal")],hG);var tr;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(tr||(tr={}));const u1=[tr.ELEVATION,tr.MAP];function rSe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.search(".glsl")!==-1&&delete t[i]}}const Glt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Oy,Ea=class extends xe{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||ni.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Dr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Pi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=oe("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){var s;const e=this.view;this.renderer=new Hp({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const r=()=>this.setDrawTexturesDirty();this._groundIntersector=Ch(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{r(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",n=>{var o;return(o=e._stage)==null?void 0:o.renderer.setParameters({hasOverlayWater:n})}),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),ue(()=>e.state.camera.pixelRatio,r),ue(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ue(()=>{var n,o,a;return[(n=e.pointsOfInterest)==null?void 0:n.renderPointOfView,(a=(o=e.pointsOfInterest)==null?void 0:o.centerOnSurfaceFrequent)==null?void 0:a.location]},()=>this.setPlacementDirty()),ue(()=>{var n,o;return[(n=e.state)==null?void 0:n.pixelRatio,(o=e.state)==null?void 0:o.contentPixelRatio]},()=>this.setPlacementDirty(),Gr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(dt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",n=>{this._updateOverlays(Fa,n.camera,ps.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,ps.BACKGROUND,n)})]);let i=n=>this._renderOverlayCallback(n);this._removeRenderOverlayCallback=()=>{i=()=>{}},(s=e._stage)==null||s.renderer.setParameters({renderOverlay:n=>i(n)})}_renderOverlayCallback(e){this._contentUpdated=!1;const r=this.renderer;r.processSyncDrapeSources(),r.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(r.overlays,ps.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){var e,r;this._handles=Pe(this._handles),this._removeRenderOverlayCallback(),(r=(e=this.view)==null?void 0:e._stage)==null||r.renderer.setParameters({renderOverlay:()=>{}}),Oy!=null&&(Oy.hide(),Oy=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new u_(-20037508342787e-6,20037508342787e-6):new u_(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Uc)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,ps.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return zo.YIELD;const s=this._computeOverlayResolution(r);this._computeOverlayExtents(r,s,mm);const n=Yc(mm.inner)/Yc(mm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay($i.INNER,mm.inner,s,1*mm.pixelRatioAdjustment,mm.mapUnitsPerPixel),a=this._updateOverlay($i.OUTER,mm.outer,s,n*mm.pixelRatioAdjustment,mm.mapUnitsPerPixel);o!==ef.EXTENT&&a!==ef.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===ef.NONE&&a===ef.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,s=e.fullHeight/e.pixelRatio*r,n=Math.ceil(1.5*Math.max(i,s));return Math.min(CZ(n),this._maxResolution)}_updateOverlay(e,r,i,s,n){if(this.renderer.overlays.length===0)return ef.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,jlt(r,o.extent)&&i===o.resolution)return a===n?ef.NONE:ef.RERENDER_ONLY;Eg(o.extent,r),o.resolution=i;const l=_q(o.extent);return o.renderLocalOrigin=NN(l[0],l[1],0,"OV_"+this._latestOriginId++),ef.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[$i.INNER],s=this.renderer.overlays[$i.OUTER],n=e.extent;this._rectInsideRect(i.extent,n)||this._rectanglesOverlap(n,i.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,$i.INNER,r),this._setTileOverlayData(n,$i.OUTER,r)):(this._clearTileOverlayData($i.INNER,r),this._clearTileOverlayData($i.OUTER,r))}else this._clearTileOverlayData($i.INNER,r),this._clearTileOverlayData($i.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[$i.INNER],i=this.renderer.overlays[$i.OUTER],s=this._pointIsInExtent(e,r.extent)?r:i;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[r].extent,n=Yc(s),o=Kd(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,Yc(e)/n,Kd(e)/o),i.setOffset(r,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){rSe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Fa)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,s=new B1e(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Wlt,r,i);if(n==null)return!1;const o=n.origin,a=le(_$,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=ye(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const h=_$;qS(R5(P5,Dr(this.view.spatialReference).radius+l),uu(e.eye,e.viewForward),h),he(h,h,e.eye);const p=h_.normalize(Gge(e.viewForward,h,e.viewRight))/e.fovY+.5,f=p<=0||p>=1?.5:s;i=c?f*p:p+f*(1-p)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(h),f=Nt(0,p,1,0),m=Qc(f,f,e.projectionMatrix)[1],y=ye(.5+.5*m,0,1);i=y===1||y===0?.5:c?y*s:1-(1-y)*s}return!!this._intersectGroundFromView(e,.5,i,r)&&Y4(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=C();this._findHorizonBasedPointOfInterest(e,n)||re(n,s),ni.OVERLAY_SHOW_CENTER?(Oy==null&&(Oy=new cT(this.view.graphics,"red")),Oy.show(n,this._renderSR)):Oy!=null&&Oy.hide();const o=Math.max(.1,fi(e.eye,n)),a=S_(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||Gs(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,h=c&&this._spatialReference!=null?1/Dr(this._spatialReference).metersPerDegree:1,p=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/p*o*h;i.mapUnitsPerPixel=f/this._worldToPCSRatio;let m=r*f/2*GX,y=!1,_=c?90:1/0;this._isSpherical&&l!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(m/=Math.cos(ED(n[1])),_=l[3]):(y=!0,m/=Dr(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;y&&(v=1/Math.max(.2,Math.cos(Math.abs(Ft(n[1])))),m*v>180&&(v=180/m),i.mapUnitsPerPixel*=v);const w=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/w)*w);const T=m*v,x=32,S=.5*r/(x*T),O=.5*r/(x*m);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*O)/O;const A=i.inner;A[0]=n[0]-T,A[1]=n[1]-m,A[2]=n[0]+T,A[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const P=i.outer;if(6*T>Yc(l))Eg(P,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)P[0]=A[0]-T,P[1]=A[1]-m,P[2]=A[2]+T,P[3]=A[3]+m;else{Gs(e.eye,this._renderSR,_$,this._spatialReference),uf(Cv,n,_$);let V=-Math.atan2(Cv[1],Cv[0])+.125*Math.PI;V<0&&(V+=2*Math.PI);const k=Math.floor(V/(.25*Math.PI));$b(Cv,Glt[k],2*m),Cv[0]*=v,Cv[2]*=v,dq(P,A,Cv)}if(this._isSpherical)P[0]=this._longitudeCyclical.clamp(P[0]),P[2]=this._longitudeCyclical.clamp(P[2]),P[1]=Math.max(P[1],-_),P[3]=Math.min(P[3],_);else{const V=qV(A,l,Hlt),k=qV(P,l,qlt);hQ(V,k)&&(P[2]=P[0],P[3]=P[1])}const I=Math.abs(A[2]-A[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,I),i.pixelRatioAdjustment=i.mapUnitsPerPixel/I}_drawOverlayTextures(e,r,i){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[$i.INNER],i),o=this._drawOverlay(e[$i.OUTER],i);n!==iS.CHANGED&&o!==iS.CHANGED||this.surface.updateTileOverlayParams(ps.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(r),r===ps.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(ps.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):cR(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:hQ(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,s=e.y;return i>r[0]&&i<r[2]&&s>r[1]&&s<r[3]}_shiftExtentToFitBounds(e,r,i){let s=0,n=0;e[0]<-r?s=e[0]+r:e[2]>r&&(s=r-e[2]),e[1]<-i?n=e[1]+i:e[3]>i&&(n=i-e[3]),DD(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Fa)}}};function jlt(t,e){const i=ni.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}u([d()],Ea.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Ea.prototype,"running",null),u([d()],Ea.prototype,"_placementDirty",void 0),u([d()],Ea.prototype,"_contentUpdated",void 0),u([d()],Ea.prototype,"_isSpherical",null),u([d()],Ea.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],Ea.prototype,"renderer",void 0),u([d({constructOnly:!0})],Ea.prototype,"view",void 0),u([d({constructOnly:!0})],Ea.prototype,"surface",void 0),u([d()],Ea.prototype,"suspended",null),u([d()],Ea.prototype,"updating",null),u([d({type:Boolean})],Ea.prototype,"hasHighlights",null),u([d({type:Boolean})],Ea.prototype,"rendersOccluded",null),Ea=u([R("esri.views.3d.terrain.OverlayManager")],Ea);const Cv=Zt(),_$=C(),mm={inner:zt(),outer:zt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Hlt=zt(),qlt=zt(),Wlt=kn();var ef;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(ef||(ef={}));let iSe=class dG{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!dG.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+s),r}}release(e){if(dG.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Bt({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};iSe.test={disabled:!1};let Xlt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=xi(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},kne=class{constructor(e,r,i,s,n){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return we(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),le(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:s}=this.attributes.normalCompressed;TKe(e,i,this.getAttributeIndex(r),s)}_setNormal(e,r,i,s){const{typedBuffer:n,typedBufferStride:o}=this.attributes.normalCompressed;Yb(n,e,r,i,s,o)}_setUV(e,r,i){Zd(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,s){this._setNormal(this.getAttributeIndex(e),r,i,s)}setVertexFromValuesRawPositionUV(e,r,i,s,n,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,s,n,o,a,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,r,i,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}};const Zlt=ji().vec3f(E.POSITION).vec2i16(E.UV0).vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),uY=new iSe(t=>Zlt.createBuffer(t),t=>t.count);function Ylt(){uY.clear()}function sSe(t){return uY.acquire(t)}function Jlt(t){uY.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const Bne=16384;function Zd(t,e,r,i){t.setValues(e,r*Bne,i*Bne)}function ph(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let Qlt=class{constructor(){this.sinLonLUT=new Array(YC+1),this.cosLonLUT=new Array(YC+1),this.sinLatLUT=new Array(YC+1),this.cosLatLUT=new Array(YC+1)}update(e,r,i){const s=r[0],n=r[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},v$=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},Klt=class{constructor(){this.cornerNeighborData=[new v$,new v$,new v$,new v$],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},ect=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Klt}},nSe=class EL{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Pe(this._current),this._next=Pe(this._next),this._waiting=Pe(this._waiting),this._delayed=Pe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=EL.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,yg.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==Ks.FADING,n=e-this._fadeStart>=r;(i||s||n)&&(Pe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=EL.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=yg.Immediate){this._delayed=Pe(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=EL.test.fadeMoment||performance.now();return r!==yg.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Pe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var yg;nSe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(yg||(yg={}));var wS;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(wS||(wS={}));let oSe=class{constructor(){this._queue=new Bt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},tct=class{constructor(){this._q=new Bt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function kA(t,e,r){if(e==null||e.fullExtent==null)return!1;const i=e.fullExtent,s=t.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function _g(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function aSe(t,e,r=null){r==null||r.length===0?t===wS.BACK_TO_FRONT?e.sort(rct):e.sort(ict):e.sort((i,s)=>sct(i,s,t,r))}function rct(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function ict(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function lSe(t,e,r){const i=t.screenDepth,s=e.screenDepth;return i<s?-r:i>s?r:_g(t,e)}function sct(t,e,r,i){return Gne(t,i)===Gne(e,i)?lSe(t,e,r):t?r:-r}function Gne(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function nct(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,s=e.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function oct(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(nct)}function act(t,e,r){let i=1,s=0,n=0;for(;t!==e;)if(i*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),!(1&t.lij[1])&&(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,s,n,i)}function lct(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function SLt(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,s=r?e:t,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}let hY=class{get updating(){return!!this._tileRequested}init(e,r,i,s){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Ks.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),s=oG(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?kA:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=m!=null?m.tile.level:-1,_=m!=null&&y-p>=a,v=s==null?void 0:s.tilemapCache,w=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;h&&c(h,s,!1)&&h.level>=n;){const T=h.level,x=p-T,S=h.layerInfo[r][e];if(S.data&&x>=a){(!_||T>y)&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}const O=(w==null?void 0:w.getLevelRowColumn(h.lij))??h.lij;if((v==null?void 0:v.getAvailability(O[0],O[1],h.lij[2]))!=="unavailable"&&T<=o&&!S.data&&!S.dataMissing&&((!f||h.level===n||T%Bye==0||p-f.level<a)&&(f=h),x>=l))break;h=h.parent}if(f!=null&&p-f.level<a)if(m)f=null;else{const T=this._findAncestorWithData();T!=null&&(this._setUpsampleTile(T),f=T.layerInfo[r][e].dataInvalidated?T:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=r)return s;i=s}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Ks.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},cct=class extends hY{get _desiredMinLevelDelta(){throw jne}get _progressiveLevelModulo(){throw jne}dispose(){}};const jne=new Error("Abstract method called on TileAgent"),Ll=new cct;let cSe=class extends hY{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return kk(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},uSe=class extends hY{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Bye}};var wb,Kb;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(wb||(wb={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(Kb||(Kb={}));function uct(t){t.fragment.uniforms.add(new Je("u_colormap",e=>e.u_colormap),new Oe("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Oe("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Oe("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(b`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function hct(t){t.fragment.uniforms.add(new Je("u_transformGrid",e=>e.u_transformGrid),new Tr("u_transformSpacing",e=>e.common.u_transformSpacing),new Tr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(b`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let hSe=class extends Kr{constructor(){super(...arguments),this.scale=1,this.offset=rp}};function dSe(t){t.attributes.add(E.POSITION,"vec2"),t.attributes.add(E.UV0,"vec2"),t.vertex.uniforms.add(new Oe("scale",e=>e.scale)),t.vertex.uniforms.add(new Tr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let dct=class extends hSe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function pct(t,e){t.include(hct),t.fragment.uniforms.add(new Je("u_image",i=>i.u_image),new Sf("u_flipY",i=>i.common.u_flipY),new Sf("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new Tr("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(b`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(b`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(b`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Re;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Re||(Re={}));const pG={normal:Re.Normal,average:Re.Average,lighten:Re.Lighten,lighter:Re.Lighter,screen:Re.Screen,plus:Re.Plus,"color-dodge":Re.ColorDodge,darken:Re.Darken,multiply:Re.Multiply,"color-burn":Re.ColorBurn,overlay:Re.Overlay,"soft-light":Re.SoftLight,"hard-light":Re.HardLight,"vivid-light":Re.VividLight,hue:Re.Hue,saturation:Re.Saturation,luminosity:Re.Luminosity,color:Re.Color,difference:Re.Difference,exclusion:Re.Exclusion,minus:Re.Minus,invert:Re.Invert,reflect:Re.Reflect,"destination-over":Re.DestinationOver,"destination-atop":Re.DestinationAtop,"destination-in":Re.DestinationIn,"destination-out":Re.DestinationOut,"source-atop":Re.SourceAtop,"source-in":Re.SourceIn,"source-out":Re.SourceOut,xor:Re.Xor};function fct(t){return t===Re.DestinationOver||t===Re.DestinationAtop||t===Re.DestinationIn||t===Re.DestinationOut||t===Re.SourceAtop||t===Re.SourceIn||t===Re.SourceOut||t===Re.Xor}function dY(t){t.code.add(b`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.float(257)};
      if(pos < 0.5 || pos > ${b.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function mct(t,e){const r=e.blendMode;r!==Re.Normal&&(r===Re.Reflect&&t.code.add(b`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Re.ColorDodge&&r!==Re.VividLight||t.code.add(b`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Re.ColorBurn&&r!==Re.VividLight||t.code.add(b`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Re.Overlay&&t.code.add(b`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Re.HardLight&&t.code.add(b`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Re.SoftLight&&t.code.add(b`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Re.VividLight&&t.code.add(b`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Re.Hue&&r!==Re.Saturation&&r!==Re.Color&&r!==Re.Luminosity||(t.code.add(b`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Re.Hue&&r!==Re.Saturation||t.code.add(b`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(b`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Re.Multiply?b`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Average?b`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Lighten?b`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Darken?b`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Lighter?b`return vec4(cl * ol + cb * ob, ol + ob);`:r===Re.Plus?b`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Re.Minus?b`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Re.Screen?b`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Difference?b`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Invert?b`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Re.DestinationOver?b`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Re.DestinationAtop?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Re.DestinationOut?b`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Re.SourceAtop?b`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Re.SourceOut?b`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Re.Xor?b`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Re.DestinationIn?b`return vec4(cb * ob * ol, ol * ob);`:r===Re.SourceIn?b`return vec4(cl * ol * ob, ol * ob);`:r===Re.Hue?b`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Saturation?b`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Color?b`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Luminosity?b`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Exclusion?b`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Reflect?b`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.ColorDodge?b`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.ColorBurn?b`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.Overlay?b`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.SoftLight?b`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.HardLight?b`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Re.VividLight?b`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b``}
    }
  `))}var mn,kd,Cd;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(mn||(mn={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(kd||(kd={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Cd||(Cd={}));function pSe(t,e){const r=e.output===mn.GridComposite,i=e.output===mn.ColorComposite,s=e.output===mn.GroupBackgroundComposite,n=e.output===mn.Composite;r&&t.fragment.include(dY),i&&t.fragment.uniforms.add(new Vt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===kd.Required;o&&t.fragment.uniforms.add(new Oe("baseOpacity",c=>c.baseOpacity)),n&&t.fragment.uniforms.add(new Je("fboColor",c=>c.fboTexture));const a=e.blendMode!==Re.Normal,l=e.premultipliedSource===Cd.On;t.fragment.include(mct,e),t.fragment.code.add(b`
    vec4 getBackground(vec2 uv) {
      return ${o?b`baseOpacity *`:""} ${s?b`vec4(0.0, 0.0, 0.0, 0.0)`:i?b`vec4(backgroundColor, 1.0)`:r?b`vec4(gridColor(uv), 1.0)`:b`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?b`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:b`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?b`colorLayer * opacity;`:b`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let HF=class extends dct{constructor(e,r,i,s,n,o){super(e,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=za,this.fboTexture=null,this.baseOpacity=1}},gct=class extends HF{},yct=class extends HF{};function _ct(t){const e=new br;return e.include(dSe),e.include(pct,t),e.include(uct,t),e.include(pSe,t),e.fragment.code.add(b`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===wb.Stretch?bct(e,t):t.colorizerType===wb.Lut?vct(e):t.colorizerType===wb.Hillshade&&wct(e,t),e}function vct(t){t.fragment.code.add(b`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function bct(t,e){t.fragment.uniforms.add(new kR("u_bandCount",i=>i.symbolizer.u_bandCount),new yl("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new yl("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new yl("u_factor",i=>i.symbolizer.u_factor,3),new Oe("u_minOutput",i=>i.symbolizer.u_minOutput),new Oe("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Sf("u_useGamma",i=>i.symbolizer.u_useGamma),new yl("u_gamma",i=>i.symbolizer.u_gamma,3),new yl("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Oe("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(b`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?b`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:b`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(b`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Kb.Noop?b`
        fragColor = applyBackgroundBlend(currentPixel);`:b`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function wct(t,e){const r=t.fragment;r.uniforms.add(new Je("u_image",s=>s.u_image),new kR("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new yl("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new yl("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new yl("u_cosZs",s=>s.symbolizer.u_cosZs,6),new yl("u_weights",s=>s.symbolizer.u_weights,6),new Tr("u_factor",s=>s.symbolizer.u_factor),new Oe("u_minValue",s=>s.symbolizer.u_minValue),new Oe("u_maxValue",s=>s.symbolizer.u_maxValue),new Tr("u_srcImageSize",s=>s.common.u_srcImageSize)),r.include(Jf),r.code.add(b`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(b`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?b`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:b`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(b`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const xct=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:yct,ColorizerStretchUniforms:gct,ColorizerUniforms:HF,build:_ct},Symbol.toStringTag,{value:"Module"}));function Tct(t,e,r="nearest",i=!1){var c;const s=!(i&&e.pixelType==="u8"),n=s?Us.FLOAT:Us.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new _r;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===or.WEBGL2&&s?Ze.RGBA32F:St.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?At.NEAREST:At.LINEAR,l.dataType=n,l.wrapMode=Lt.CLAMP_TO_EDGE,new Ct(t,l,o)}function Sct(t,e){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=e,a=r[0]>1,l=new _r;l.width=a?4*n:n,l.height=o,l.internalFormat=t.type===or.WEBGL2?Ze.RGBA32F:St.RGBA,l.dataType=Us.FLOAT,l.samplingMode=At.NEAREST,l.wrapMode=Lt.CLAMP_TO_EDGE;const c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new Ct(t,l,c)}function Hne(t,e){const r=new _r;return r.internalFormat=St.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=At.NEAREST,r.wrapMode=Lt.CLAMP_TO_EDGE,new Ct(t,r,e)}function Ect(t,e,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:rp,u_transformGridSize:t?t.size:rp,u_targetImageSize:e,u_srcImageSize:r}}function Cct(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Act(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function Oct(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const qne={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let Rct=class{constructor(e,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Fe(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...qne,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||qne}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var s;return!!((s=this._bandIds)!=null&&s[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?At.LINEAR:At.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Fe(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=Sct(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:s,opacity:n}=this,o=Ect(r,[i,s],[this.source.width,this.source.height],n),a=Cct(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Act(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Oct(this.symbolizerParameters):null;return new HF(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Fe(this._rasterTexture),this._transformGridTexture=Fe(this._transformGridTexture),this._colormapTexture=Fe(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Fe(this._rasterTexture));const s=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=Fe(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Tct(e,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=Fe(this._colormapTexture),this._colormapTexture=Hne(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=Hne(e,i),void(this._colormap=i)):(this._colormapTexture=Fe(this._colormapTexture),void(this._colormap=null))}},CL=class{constructor(){this.waitingAgents=new Bt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=s9.acquire();return r._init(e),r}release(){this.dispose(),AL.delete(this),s9.release(this)}dispose(){this.loadingAgent=Fe(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=v2(this._data)}static prune(){s9.prune(0)}_init(e){this.waitingAgents.clear(),this._data=v2(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=ou(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),act(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){v2(this._data),this._data=e}};const s9=new No(CL,null,()=>{}),AL=new Map;function Pct(){AL.size>0&&(console.log(`${AL.size} live TilePerLayerInfo allocations:`),AL.forEach(t=>console.log(t,`
`)))}let uT=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}};var yt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(yt||(yt={}));const Mct=.1;let pY=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=zt(),this._elevationBounds=Ue(),this.layerInfo=[[],[]],this.extentInRadians=zt(),this.centerAtSeaLevel=C(),this._center=[C(),ys(),C()],this.up=lq(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C()}static prune(){fY.prune(0),mY.prune(0),CL.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Ns.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??Jo.INTERSECTS;this._frustumVisibility=r===Jo.INSIDE?Jo.INSIDE:r===Jo.OUTSIDE?Jo.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==Jo.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Dr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Ns.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,r&&r.elevationBounds?ln(this._elevationBounds,r.elevationBounds):sr(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of u1){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=CL.acquire(this._surface.upsampleInfoPool),s===tr.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,YC)}release(){of(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of u1){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[tr.MAP].reduce((e,r)=>e+(r instanceof i9?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){var i;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:s}of this.layerInfo[tr.MAP])s instanceof i9?e+=this._getTerrainDataMemory(s):this._mapTileMemoryInternal+=this._getTerrainDataMemory(s);const r=this._cpuImageMemorySize;for(const s of this.layerInfo[tr.ELEVATION])this._usedMemory+=s.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((i=this.renderData.texture)==null?void 0:i.gpuMemoryUsage)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===tr.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===tr.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof uT?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof kF?this._cpuImageMemorySize:e instanceof Rct?e.memoryUsage:e instanceof i9?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const r=this._center[Ns.MIDDLE],i=e,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Jo.OUTSIDE))return yt.NONE;const s=this.level;he(w$,this._center[Ns.MIDDLE],r);let n=ea(w$),o=w$,a=Ns.MIDDLE;he(n9,this._center[Ns.TOP],r);const l=ea(n9);l<n&&(n=l,o=n9,a=Ns.TOP),he(o9,this._center[Ns.BOTTOM],r);const c=ea(o9);if(c<n&&(n=c,o=o9,a=Ns.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return yt.SPLIT;const h=i!=null?i-s:1/0,p=Math.sqrt(n),f=e.fovX*p*2,m=this._edgeLen/f,y=()=>{if(s<e.maxLod)return this.elevationLevel=s,yt.NONE;const P=s+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return P!==this.elevationLevel?(this.elevationLevel=P,yt.ELEVATION):yt.NONE};if(h<=.5)return y();const _=me(this.up,w$),v=this._elevationBounds[1]-this._elevationBounds[0],w=v/this.edgeLen;if(e.aboveGround&&_>0&&w<.001&&_/p-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-w>0)return yt.NONE;const T=i!=null?3-Math.min(h,2):1;if(m*T<e.relativeWidthLimit||s>=e.maxLod)return y();if(s<7)return yt.SPLIT;ie(Jn,this.up,_),he(Jn,Jn,o);const x=ea(Jn);if(x<=this.radius*this.radius)return yt.SPLIT;ie(Jn,Jn,this.radius/Math.sqrt(x)),le(Jn,Jn,this._center[a]),he(Jn,r,Jn);const S=Math.min(1,(Math.abs(me(Jn,this.up))+.5*v+this._curvatureHeight)/Ee(Jn)),O=Mct/e.angledSplitBias,A=e.fovY*p*2;return S*(this._edgeLen/A*T)<O*e.relativeHeightLimit?yt.NONE:yt.SPLIT}setChildren(e,r,i,s){of(!!(e&&r&&i&&s),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of u1)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of u1){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==Ll&&(b$(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(yt.GEOMETRY),this.resetPendingUpdate(yt.TEXTURE_NOFADING),this.resetPendingUpdate(yt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[tr.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Ll&&(b$(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(ab(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(yt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of u1){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Ll&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(yt.SPLIT)||e!==tr.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===yt.SPLIT||e===yt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const s=this.layerInfo[r][e];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e);const a=s.data&&"type"in s.data&&s.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(s.requestPromise)return!0;ou(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return ea(he(Jn,this._center[Ns.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const s=this.layerInfo[r][e],n=s.waitingAgents,o=n.removeUnordered(i)!=null;of(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const s=i!=null&&"type"in i&&i.type==="vector-tile",n=this.layerInfo[r][e];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const s=this.layerInfo[r][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,r)),e){case tr.MAP:return this._updateTexture(r);case tr.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Ks.FADING?yt.TEXTURE_NOFADING:yt.TEXTURE_FADING),this.setPendingUpdate(e===Ks.FADING?yt.TEXTURE_FADING:yt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(yt.GEOMETRY);for(const e of this.layerInfo[tr.ELEVATION])e.pendingUpdates|=yt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];sr(e,1/0,-1/0);const s=this.layerInfo[tr.ELEVATION];let n=!0;for(const o of s)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;ie(Jn,this.up,r),le(i[Ns.MIDDLE],this.centerAtSeaLevel,Jn),ie(Jn,this.up,e[0]),le(i[Ns.TOP],this.centerAtSeaLevel,Jn),ie(Jn,this.up,e[1]),le(i[Ns.BOTTOM],this.centerAtSeaLevel,Jn)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[tr.ELEVATION][e],s=kk(this.level),n=Math.max(this.elevationLevel-s,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,tr.ELEVATION),l=oG(a);if(!kA(this,l,!1))return;const c=Ict;let h=!1;const p=i.data;if(p&&p.level<=n){const f=i.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,y=0;for(let _=this._parent;_&&(!m||y<s)&&(y=this.elevationLevel-_.level,f=m||f,m=_.layerInfo[tr.ELEVATION][e].data,!(!m&&f&&_.level<=n));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(i.elevationBounds==null&&(i.elevationBounds=new JT),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==Ll&&(b$(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:CL.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Ks.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Ll&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of u1){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Ll&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Ll&&this.updateRenderData(e,Ks.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Ll&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Ll,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||D2(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var s,n,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(o4(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||D2((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=e;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=oG(l);if(o.loadingAgent?kA(this,c,!1)?(o.loadingAgent!==Ll&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Ll&&(a=o.loadingAgent.update())):o.dispose():kA(this,c,!1)&&(o.loadingAgent=$ct(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Ll&&this.setPendingUpdate(yt.GEOMETRY):(b$(o.loadingAgent),o.loadingAgent=Ll)),o.loadingAgent===Ll&&this.updateRenderData(r,Ks.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,kk(this.level)-r),s=ye(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const s of i)if(Lct(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(e,r){const i=this.lij,s=this.getNeighborLIJ(i,e);return s?Dct(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(e,r){const i=e===it.NORTH_EAST?1:e===it.NORTH_WEST?0:e===it.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(a4(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===it.NORTH?[0,1]:e===it.NORTH_EAST?[1]:e===it.EAST?[1,3]:e===it.SOUTH_EAST?[3]:e===it.SOUTH?[2,3]:e===it.SOUTH_WEST?[2]:e===it.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(e){GO.forEach(r=>this.findNeighborCornerTileExact(r,e)),gf.forEach(r=>{var i;return(i=this.findNeighborTile(r,s=>s.level===this.level||e(s)))==null?void 0:i.forAllSubtreeOnSide(l4(r),e)})}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(we(!rn||i>=0),i===0)return 0;const s=2**i,n=(1&e)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return rn&&(we(a<=l&&l<a+s),we(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const r=this.level,i=s=>s.level===r||s.isLoaded;gf.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(l4(s),o=>!!o.isLoaded&&(e(o,s),!0))}),GO.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(a4(s),a=>a.isLoaded);we(!n||fG(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,r){const i=Lne(r)?-1:Ine(r)?1:0,s=Mne(r)?-1:$ne(r)?1:0,n=[e[0],e[1]+i,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+Wa()>=r}checkGeometryWaterproofness(){var e;s4&&(we(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(Lne(e)&&r[3]+s>=i[3]||Ine(e)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&Mne(e)&&r[0]-s<=i[0])&&!(!n&&$ne(e)&&r[2]+s>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;re(this._lastPOI,e);const i=this._center[Ns.MIDDLE],s=e[0]-i[0],n=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}};function $ct(t,e,r,i){const s=r===tr.ELEVATION?mY.acquire():fY.acquire();return s.init(t,e,r,i),s}function b$(t){t.dispose(),t instanceof cSe?mY.release(t):t instanceof uSe&&fY.release(t)}const fY=new No(uSe),mY=new No(cSe),Ict=new JT;var Ns;function Lct(t,e){const r=t.level,i=e[0];if(r>i)return!1;const s=i-r,n=Math.floor(e[1]/2**s),o=Math.floor(e[2]/2**s);return n===t.lij[1]&&o===t.lij[2]}function Dct(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Nct(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===it.EAST||t.isWestEnd&&e.isEastEnd&&r===it.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case it.NORTH:return eh(t.extent[3],e.extent[1],i);case it.SOUTH:return eh(t.extent[1],e.extent[3],i);case it.EAST:return eh(t.extent[2],e.extent[0],i)||eh(t.extent[2],-e.extent[0],i);case it.WEST:return eh(t.extent[0],e.extent[2],i)||eh(t.extent[0],-e.extent[2],i)}}function fG(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Wne(t,e,r):Wne(e,t,a4(r)))}function Wne(t,e,r){we(t.level>=e.level);const i=Yat(r),s=Jat(r),n=t.extent,o=e.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=eh(a[0],l[0],c)||t.surface.isGlobal&&eh(a[0],-l[0],c),p=eh(a[1],l[1],c);if(h&&p)return!0;if(t.level===e.level||!h&&!p)return we(!1),!1;const f=h?Xne(o[1],o[3],n[1],n[3],c):Xne(o[0],o[2],n[0],n[2],c);return we(f),f}function Xne(t,e,r,i,s){return t-s<=r&&r<=i&&i<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Ns||(Ns={}));const w$=C(),n9=C(),o9=C(),Jn=C();let Fct=class{constructor(){this._scales=Nt(-1,-1,-1,-1),this._offsets=Nt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function Uct(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(b`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(b`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let gY=class extends wxe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var nc;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(nc||(nc={}));let Vct=class extends gY{constructor(){super(...arguments),this.identifier=nc.Material,this.output=L.Color,this.transparent=!1,this.integratedMesh=!1}},zct=class extends gY{constructor(){super(...arguments),this.identifier=nc.ShadowMap}},kct=class extends gY{constructor(){super(...arguments),this.identifier=nc.Highlight}},c4=class extends ls{constructor(e,r){super(e,"vec4",Jr.Draw,(i,s,n)=>i.setUniform4fv(e,r(s,n)))}};var vg;function Bct(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new c4("overlayTexOffset",(s,n)=>Gct(s,n)),new c4("overlayTexScale",(s,n)=>jct(s,n))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Je("ovColorTex",(s,n)=>mG(s,n))),fSe(t,e)}function fSe(t,e){e.pbrMode!==rt.Water&&e.pbrMode!==rt.WaterOnIntegratedMesh&&e.pbrMode!==rt.TerrainWithWater||t.include(Sxe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(b`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(b`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(b`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(b`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==rt.Water&&e.pbrMode!==rt.WaterOnIntegratedMesh&&e.pbrMode!==rt.TerrainWithWater||(zg(i),Yf(i),i.code.add(b`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function mG(t,e){return e.overlays.length===0?null:t.identifier===nc.Material&&t.output===L.Color?e.overlays[$i.INNER].getColorTextureNoRasterImage():t.identifier===nc.Material&&t.output===L.ObjectAndLayerIdColor?e.overlays[$i.INNER].getColorTexture(Ma.ObjectAndLayerIdColor):t.identifier===nc.Highlight?e.overlays[$i.INNER].getValidTexture(is.Highlight):null}function Gct(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;epe(s)>0&&(b2[2*i]=t.toMapSpace[0]/Yc(s)-s[0]/Yc(s),b2[2*i+1]=t.toMapSpace[1]/Kd(s)-s[1]/Kd(s))}return b2}function jct(t,e){for(const r of e.overlays){const{index:i,extent:s}=r;epe(s)>0&&(b2[2*i]=t.toMapSpace[2]/Yc(s),b2[2*i+1]=t.toMapSpace[3]/Kd(s))}return b2}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(vg||(vg={}));const b2=Zt();var yf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(yf||(yf={}));let Hct=class extends RZ{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=Ma.None}};function nC(t,e){t.vertex.uniforms.add(new u4("overlayTexOffset"),new u4("overlayTexScale")),t.fragment.uniforms.add(new Oe("overlayOpacity",r=>r.overlayOpacity),new Je("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[$i.INNER].getColorTexture(r.overlaySource))),fSe(t,e)}function qct(t,e){const{vertex:r,fragment:i,varyings:s}=t;s.add("vtc","vec2"),r.uniforms.add(new u4("texOffsetAndScale")),i.uniforms.add(new Zne("tex")),i.uniforms.add(new a9("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(r.uniforms.add(new u4("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new Zne("texNext")),i.uniforms.add(new a9("nextTexOpacities")),i.uniforms.add(new Wct("fadeFactor")));const o=e.tileBlendInput===yf.ColorComposite,a=e.tileBlendInput===yf.GridComposite;a&&i.include(dY),o&&i.uniforms.add(new a9("backgroundColor")),r.code.add(b`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?b`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b``}
  }`),i.code.add(b`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?b`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?b`backgroundColor`:b`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:b`return color;`}
    }`),n?i.code.add(b`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(b`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let Wct=class extends ls{constructor(e){super(e,"float")}},a9=class extends ls{constructor(e){super(e,"vec3")}},u4=class extends ls{constructor(e){super(e,"vec4")}},Zne=class extends ls{constructor(e){super(e,"sampler2D")}},mSe=class extends Hct{};function Xct(t){const e=new br,{vertex:r,fragment:i,varyings:s}=e;e.include(TR),e.include(zR,t),e.include(Tf,t);const n=()=>{e.include(FO,t),r.code.add(b`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};fc(r,t),e.include(vl,t);const o=t.overlayMode!==vg.Disabled,a=o&&t.invisible;switch(t.output){case L.Color:{e.include(qct,t),e.include(Jb,t),o&&e.include(nC,{...t,pbrMode:t.pbrMode===rt.Terrain?rt.TerrainWithWater:rt.Water});const l=t.overlayMode===vg.EnabledWithWater;l&&e.include(Uct,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&uS(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(XS,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(b`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?b`forwardVertexTangent(vnormal);`:b``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?b`setOverlayVTC(uv);`:""}
          ${t.tileBorders?b`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?b`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?b`forwardLinearDepth();`:""}

        }
      `),e.include(fs,t),e.include(Jb,t),e.include(BR,t),e.include(Zb,t),sp(i,t),GR(i),iE(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Vt("viewDirection",(h,p)=>ge(Yne,se(Yne,p.camera.viewMatrix[12],p.camera.viewMatrix[13],p.camera.viewMatrix[14])))),l&&i.uniforms.add(new Je("ovWaterTex",(h,p)=>p.overlays.length===0?null:p.overlays[$i.INNER].getNormalTexture(h.overlaySource)),new P1e("view",(h,p)=>Sl(Zct,p.camera.viewMatrix,h.origin))),i.code.add(b`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),zg(i),Yf(i),i.code.add(b`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?b`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?b`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===rt.Terrain||t.pbrMode===rt.TerrainWithWater?b`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:b`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?b`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?b`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?b`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:b`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?b`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case L.Depth:a&&e.include(nC,t),e.include(Dg,t),w_(e),Bb(e),r.code.add(b`
              void main(void) {
                ${a?b`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(b`
              void main() {
                ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case L.Shadow:case L.ShadowHighlight:case L.ShadowExcludeHighlight:e.include(Dg,t),w_(e),Bb(e),r.code.add(b`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(b`void main() {
outputDepth(linearDepth);
}`);break;case L.Normal:a&&e.include(nC,t),s.add("vnormal","vec3"),uS(r),n(),r.code.add(b`
            void main(void) {
              ${a?b`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(b`
            void main() {
              ${a?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case L.Highlight:o&&e.include(nC,t),r.code.add(b`
          void main() {
            ${o?b`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Xg,t),i.code.add(b`
          void main() {
            ${o?b`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===L.ObjectAndLayerIdColor&&(e.include(nC,{...t,pbrMode:rt.Disabled}),r.code.add(b`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(b`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const Zct=ve(),Yne=C(),Yct=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:mSe,build:Xct},Symbol.toStringTag,{value:"Module"}));let gSe=class ySe extends Rr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===Ie.Global}initializeProgram(e){return new Er(e.rctx,ySe.shader.get().build(this.configuration),_Se)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Ot({blending:r.renderOccluded?vc(be.ONE,be.ONE_MINUS_SRC_ALPHA):null,culling:i?VW:null,depthTest:r.renderOccluded?null:{func:Qr.LESS},depthWrite:r.renderOccluded?null:El,colorWrite:Gt,stencilTest:e?nQe(wl.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};gSe.shader=new Sr(Yct,()=>ae(()=>import("./Terrain.glsl-86d83407.js"),[]));const _Se=new Map([[E.POSITION,0],[E.UV0,1],[E.NORMALCOMPRESSED,2]]);let Jct=class{constructor(){this.geometry=new Xlt,this.intersectionData=null,this.geometryState=null,this._textureRef=new nSe(()=>this.tile.surface.textureFadeDuration),this.overlay=new Fct,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,xi(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new ect,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),rn&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)we(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return s}const n=i.level,o=gf[e];if(!r)return we(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const c=r,h=c.renderData.geometryState,p=n-c.level;if(we(p>=0),p===0){const y=h.numVerticesPerSide-1;return Math.max(y,s)}const f=2**p,m=h.neighborData.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}we(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(l4(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(we(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(gf[l],i),h=k1(e,c),p=((a=h==null?void 0:h.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,f=s[l],m=h!==k1(e,f),y=n[l]!==p;s[l]=c,(m||y)&&(n[l]=p,this._markEdgeDirty(l));const _=r.edgeResolutions[l],v=this._calculateEdgeResolution(l,c);we(Ib(v)),we(v>=1),r.edgeResolutions[l]=v,_!==v&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(GO[l],i);o[l]=c;const h=k1(e,s[l]),p=k1(e,s[(l+1)%4]),f=k1(e,c);Wh[l]=f,Wh[(l+1)%4]=p,Wh[(l+2)%4]=e,Wh[(l+3)%4]=h,we(Wh.some(v=>(v==null?void 0:v.isLoaded)||v===e));const m=Wh.reduce((v,w)=>Math.min(v,(w==null?void 0:w.level)??1/0),1/0);Wh.forEach((v,w)=>{v&&(v==null?void 0:v.level)>m&&(Wh[w]=null)}),we(Wh.some(v=>(v==null?void 0:v.isLoaded)||v===e));const y=r.cornerNeighborData[l].cornerTiles,_=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let v=0;v<4;++v){const w=Wh[v],T=(w==null?void 0:w.renderData.geometryState.samplerDataVersion)??-1,x=y[v]!==w,S=!x&&_[v]!==T;(x||S)&&(y[v]=w,_[v]=T,this._markCornerDirty(l))}we(y.some(v=>(v==null?void 0:v.isLoaded)||v===e))}rn&&we(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)Wh[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;rn&&we(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometry.vertexAttributes,n=!i||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,Jlt(this.geometry),!0)}ensureTexture(e,r){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),wg(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,s=e.gl;this._vao=new ap(e,_Se,{geometry:xc(r.layout)},{geometry:Ir.createVertex(e,s.STATIC_DRAW,r.buffer)},Ir.createIndex(e,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=yg.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[tr.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let h=0;h<i;h++){const p=r[h];if(p.upsampleInfo!=null){const f=p.upsampleInfo.tile,m=f.layerInfo[tr.ELEVATION][h].data,y=m&&m.samplerData;e&&e[n]===y||(a=!0),s[n++]=y,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(h,tr.ELEVATION);if(kA(this.tile,f.layer,!1)){const m=p.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,s;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!rn)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void we(e==null?void 0:e.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=gf.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),s=e.level;we(this._dirtyCorners===0),we(this._dirtyEdges===0),we(this._dirtyEdgeResolutions===0),we(!this._numVerticesPerSideChanged),we(!this._samplerDataChanged),we(!this._clippingAreaChanged),we(!this._wireframeChanged);const n=GO.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];we(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}gf.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,N=>(N.level===s||(N==null?void 0:N.isLoaded))&&(N==null?void 0:N.intersectsClippingArea));if(!c){const N=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void we(!N)}we(c.isLoaded||c.level===e.level),we(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const h=s-c.level;if(!c.isLoaded)return we(!c.isLeaf),void we(h===0);const p=c.renderData;we(Nct(e,c,a)),we(h>=0);const f=2**h;if(h<0)return void we(!1);const m=e.renderData,y=m.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,w=p.geometry;if(!w)return void we(!1);const T=this.geometryState.neighborData.edgePeerNeighbors[l];if(T!=null&&T.isLoaded){const N=T.renderData;we(T==T),we(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===N.geometryState.samplerDataVersion),we(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===N.geometryState.samplerDataVersion)}const x=(l+2)%4,S=w.outerEdges[x],O=_.count-1,A=S.count-1;we(O*f===A,`Tile[${e.lij}]:e${l},res=${O} edgeRes mismatch with Neighbor[${c.lij}]:e${x},res=${A} (expected:${O*f})`);const P=e.extent,I=a===it.NORTH||a===it.SOUTH,V=S.count-1,k=V/2**h,B=_.count-1;if(k<1)return void we(B===1);we(k===B),we(Ib(k));const z=w.numVerticesPerSide-1;we(h>0||k===Math.max(z,v));const Z=e.getNeighborEdgeStartVertexIndex(l,c);we(0<=Z&&Z<f);const W=Z*k;we(0<=W&&W<=V-k);let H=0,Y=W;_.getVertexPos(Op,0),_.getVertexPos(Rp,_.count-1);const M=fi(Op,Rp),D=Math.max(Qct,1e-4*M);for(let N=0;N<=k;++N){_.getVertexPos(Op,H),S.getVertexPos(Rp,Y);const G=N/k,X=I?P[0]+G*(P[2]-P[0]):a===it.WEST?P[0]:P[2],K=I?a===it.SOUTH?P[1]:P[3]:P[1]+G*(P[3]-P[1]),ee=e.surface.extent;if(ee==null||t5(ee,X,K)){const _e=aR(Op,Rp),Le=Zl(Op)-ir.radius,_t=Zl(Rp)-ir.radius,Rt=_e<D;if(!Rt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${H}/${_.count}] and [${c.lij}].edge${x}[${Y}/${S.count}]`),ee!=null&&console.warn("  surface extent= ",ee," x,y=",X,",",K);const ze=C();he(ze,m.localOrigin,p.localOrigin),Zl(ze)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${p.localOrigin} d=${Zl(ze)} [${ze}]`),(()=>{const fe=Ms(Op),Tt=Ms(Rp);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(Op,H),S.getVertexPos(Rp,Y);const bt=C();_n(bt,Op,fe),Zl(bt)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${fe} vs ${Op} d=${Zl(bt)} [${bt}]`),_n(bt,Rp,Tt),Zl(bt)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Tt} vs ${Rp} d=${Zl(bt)} [${bt}]`)})(),we(Rt,`Mismatch in tile [${e.lij}].edge[${l}][${H}/${_.count}] vs neighbor [${c.lij}].edge[${x}][${Y}/${S.count}] ${fm(Op)} vs ${fm(Rp)}  dist=${_e} h(t|n|d)=${Le}|${_t}|${_t-Le}`)}_.getNormal(gx,H),S.getNormal(yx,Y),ge(Jne,gx),ge(Qne,yx);const at=me(Jne,Qne),vt=1-at<.01||!1||e===c;if(!vt){const ze=C();_n(ze,gx,yx);const fe=()=>`Mismatch in tile edge normal ${Pne(e.lij)} (${H}/${_.count-1}) edge ${l} vs neighbor ${Pne(c.lij)}  (${Y}/${S.count-1}) nedge ${x} :${fm(gx)} vs ${fm(yx)}  dot = ${at} : ${fm(ze)}`;console.warn("Mismatch in tile edge normal: ",fe());{e.updateEdgeElevations(),c.updateEdgeElevations();const Tt=C(),bt=C();_.getNormal(Tt,H),S.getNormal(bt,Y),l_(gx,Tt)||console.warn("Missing update in tile normal: ",fm(gx)," => ",fm(Tt)),l_(yx,bt)||console.warn("Missing update in neighbor normal: ",fm(yx)," => ",fm(bt))}we(vt,fe())}}H+=1,Y+=1}})}};const Op=C(),Rp=C(),gx=C(),yx=C(),Jne=C(),Qne=C(),Qct=1,Wh=[null,null,null,null];function k1(t,e){return e!=null&&e.isLoaded||e===t?e:null}const Kct=65536;function eut(t,e){const r=t.tile,{extent:i,extentInRadians:s,surface:n}=r,o=t.localOrigin,a=t.geometryState,l=n.isWebMercator,c=a.numVerticesPerSide,h=c-1,p=(c-2)**2,f=l&&(e===Qu.HAS_SOUTH_POLE||e===Qu.HAS_BOTH_POLES),m=l&&(e===Qu.HAS_NORTH_POLE||e===Qu.HAS_BOTH_POLES),y=6,_=((f?1:0)+(m?1:0))*y*(h+1),v=a.neighborData,w=v.edgeResolutions.reduce((P,I)=>P+I+1,0),T=sSe(p+_+w),x=t.geometry;x.numVerticesPerSide=a.numVerticesPerSide,x.vertexAttributes=T;const S=x.boundingBox;xi(S);const O=yY(t);no.update(h,s,O),tut(t),OSe(t,p),vSe(t);const A=[];if((()=>{let P=p+w;const I=o[0],V=o[1],k=o[2],B=r.ellipsoid.radius,z=i[1],Z=i[3],W=(H,Y)=>{const M=Y*c;ph(-I,-V,H*B-k,S),A.push({connectedRowOffset:M,connectedOuterEdgeOffset:H===1?0:2,rowOffset:P,latitudeResolution:y});const D=xSe(H===-1?z:Z,B),N=H*Math.PI/2-D,G=.99*(H===1?1:-1),X=B+0,K=T.position,ee=T.uv0,{typedBuffer:_e,typedBufferStride:Le}=T.normalCompressed;for(let _t=1;_t<=y;++_t){const Rt=D+N*(_t/y),at=Math.cos(Rt),vt=Math.sin(Rt);for(let ze=0;ze<=h;ze++){const fe=ze/h,Tt=no.sinLonLUT[ze],bt=no.cosLonLUT[ze]*at,Ce=Tt*at,Be=vt,je=bt*X-I,ft=Ce*X-V,ct=Be*X-k;ph(je,ft,ct,S),K.setValues(P,je,ft,ct),Zd(ee,P,fe,G),Yb(_e,P,bt,Ce,Be,Le),++P}}};f&&W(-1,0),m&&W(1,h)})(),ASe(x,a.numVerticesPerSide,A,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,rn)for(let P=0;P<4;++P)we(x.outerEdges[P].count===v.edgeResolutions[P]+1)}function tut(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,s=i-2,n=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:h,typedBufferStride:p}=a.normalCompressed,f=e.extent,m=f[0],y=f[2],_=f[1],v=f[3],w=e.ellipsoid.radius,T=r.samplerData,x=t.localOrigin,S=x[0],O=x[1],A=x[2],P=l.typedBuffer,I=l.typedBufferStride,V=1/n,k=o.boundingBox;let B=0;if(1<=s){const z=V,Z=_*(1-z)+v*z,W=no.sinLatLUT[1],H=no.cosLatLUT[1];for(let Y=1;Y<=s;Y++){const M=Y*V,D=m*(1-M)+y*M,N=no.sinLonLUT[Y],G=no.cosLonLUT[Y],X=w+Xi(D,Z,T),K=X*G*H-S,ee=X*N*H-O,_e=X*W-A;ph(K,ee,_e,k);const Le=(Y-1)*I;P[Le]=K,P[Le+1]=ee,P[Le+2]=_e,Zd(c,Y-1,M,z)}}for(let z=1;z<=s;z++){const Z=z*V,W=_*(1-Z)+v*Z,H=no.sinLatLUT[z],Y=no.cosLatLUT[z],M=z+1,D=M*V,N=_*(1-D)+v*D,G=no.sinLatLUT[M],X=no.cosLatLUT[M],K=no.sinLonLUT[0],ee=no.cosLonLUT[0],_e=w+Xi(m,W,T);let Le=ee*Y*_e-S,_t=K*Y*_e-O,Rt=H*_e-A;const at=B*I;let vt=P[at],ze=P[at+1],fe=P[at+2];for(let Tt=1;Tt<=s;Tt++){const bt=Tt*V,Ce=m*(1-bt)+y*bt,Be=no.sinLonLUT[Tt],je=no.cosLonLUT[Tt];let ft=0,ct=0,hr=0;if(Tt<s){const pr=(B+1)*I;ft=P[pr],ct=P[pr+1],hr=P[pr+2]}else{const pr=no.sinLonLUT[n],ci=no.cosLonLUT[n],Fi=w+Xi(y,W,T);ft=ci*Y*Fi-S,ct=pr*Y*Fi-O,hr=H*Fi-A}const He=Le,mt=_t,dr=Rt;Le=vt,_t=ze,Rt=fe,vt=ft,ze=ct,fe=hr;const nt=ft-He,ut=ct-mt,gt=hr-dr;let Dt=0,jt=0,Ti=0;if(z>1){const pr=(B-s)*I;Dt=P[pr],jt=P[pr+1],Ti=P[pr+2]}else{const pr=no.sinLatLUT[0],ci=no.cosLatLUT[0],Fi=w+Xi(Ce,_,T);Dt=je*ci*Fi-S,jt=Be*ci*Fi-O,Ti=pr*Fi-A}const jr=w+Xi(Ce,N,T),gi=je*X*jr-S,kt=Be*X*jr-O,ai=G*jr-A;if(z<s){const pr=B+s,ci=pr*I;P[ci]=gi,P[ci+1]=kt,P[ci+2]=ai,ph(gi,kt,ai,k),Zd(c,pr,bt,D)}const Ur=Dt-gi,ei=jt-kt,Pr=Ti-ai;let Si=je*Y,zr=Be*Y,li=H;li*li<.999&&(Si=gt*ei-ut*Pr,zr=nt*Pr-gt*Ur,li=ut*Ur-nt*ei);const ti=1/Math.sqrt(Si*Si+zr*zr+li*li);Yb(h,B,Si*ti,zr*ti,li*ti,p),++B}}}function rut(t){t.tile.intersectsClippingArea&&(vSe(t),qF(t))}function iut(t){t.tile.intersectsClippingArea&&(wSe(t),bSe(t,!0),qF(t))}function vSe(t){t.tile.intersectsClippingArea&&(wSe(t),bSe(t))}function bSe(t,e=!1){const r=t.geometryState,i=t.geometry,s=r.neighborData,n=t.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],p=c[2],f=c[1],m=c[3],y=r.samplerData,_=a[0],v=a[2],w=a[1],T=a[3],x=yY(t),S=i.boundingBox,O=t.localOrigin,A=O[0],P=O[1],I=O[2],V=i.vertexAttributes,k=V.position,B=k.typedBuffer,z=k.typedBufferStride,Z=V.uv0;for(let W=0;W<4;++W){const H=W===1||W===3,Y=s.edgeResolutions[W];we(Ib(Y));const M=Y+1,D=k1(n,s.edgePeerNeighbors[W]);if(MSe(n,D,W)){RSe(t,W,D);continue}const N=D!=null;we(!N||D.level===n.level),we(!N||_g(n,D)<=0);const G=D==null?void 0:D.renderData,X=G==null?void 0:G.geometryState;if(rn){const nt=n.surface;if(!D&&nt&&!nt.updatingRootTiles){const ut=gf[W],gt=n.findNeighborTile(ut,Dt=>Dt.isLoaded||Dt.isLeaf||Dt.level===n.level);gt?gt.intersectsClippingArea&&(we(!gt.isLoaded),we(!gt.isLeaf),we(gt.level===o)):we((nt==null?void 0:nt.rootTiles)==null||!n.shouldHaveNeighbor(ut))}}const K=W===1?a[2]:a[0],ee=D==null?void 0:D.extent,_e=ee&&H?W===1?ee[0]:ee[2]:K,Le=W===0?a[3]:a[1],_t=W===1?1:0,Rt=W===0?1:0,at=W===1?p:h,vt=W===0?m:f,ze=Math.sin(at),fe=Math.cos(at),Tt=Math.sin(vt),bt=Math.cos(vt),Ce=X==null?void 0:X.samplerData,Be=N?(nt,ut,gt)=>.5*(Xi(nt,ut,y)+Xi(gt,ut,Ce)):(nt,ut,gt)=>Xi(nt,ut,y),je=i.outerEdges[W],ft=e&&M>3?M-3:1,ct=y!=null&&y.some(nt=>nt!=null),hr=Ce!=null&&Ce.some(nt=>nt!=null),He=ct||hr,mt=1/Y,dr=je.index0;we(!ee||eh(ee[2]-ee[0],a[2]-a[0])),(()=>{const nt=W===1?-1:W===3?1:0,ut=W===0?-1:W===2?1:0,gt=(a[2]-a[0])*mt,Dt=nt*gt,jt=ut*gt,Ti=H?nt*((p-h)*mt):0,jr=H?0:ut*mt,gi=Rt,kt=H?at+Ti:at,ai=H?Math.sin(kt):ze,Ur=H?Math.cos(kt):fe,ei=H?at-Ti:at,Pr=H?Math.sin(ei):ze,Si=H?Math.cos(ei):fe,zr=H?vt:x(gi+jr),li=H?Tt:Math.sin(zr),ti=H?bt:Math.cos(zr),pr=H?vt:x(gi-jr),ci=H?Tt:Math.sin(pr),Fi=H?bt:Math.cos(pr);let Hn=0,qn=0,Wn=0;{const Hr=0*mt,Tn=H?K:_*(1-Hr)+v*Hr,bo=H?_e:Tn,ua=H?w*(1-Hr)+T*Hr:Le,ne=H?at:h*(1-Hr)+p*Hr,Ei=H?ze:Math.sin(ne),Lh=H?fe:Math.cos(ne),Sn=H?x(Hr):vt,Dh=H?Math.sin(Sn):Tt,Qe=H?Math.cos(Sn):bt,Al=l+Be(Tn,ua,bo);Hn=Lh*Qe*Al,qn=Ei*Qe*Al,Wn=Dh*Al}let Xn=0,Hi=0,Ui=0;{const Hr=1*mt,Tn=H?K:_*(1-Hr)+v*Hr,bo=H?_e:Tn,ua=H?w*(1-Hr)+T*Hr:Le,ne=H?at:h*(1-Hr)+p*Hr,Ei=H?ze:Math.sin(ne),Lh=H?fe:Math.cos(ne),Sn=H?x(Hr):vt,Dh=H?Math.sin(Sn):Tt,Qe=H?Math.cos(Sn):bt,Al=l+Be(Tn,ua,bo);Xn=Lh*Qe*Al,Hi=Ei*Qe*Al,Ui=Dh*Al}for(let Hr=1;Hr<M-1;Hr+=ft){let Tn=0,bo=0,ua=0;{const ha=(Hr+1)*mt,Ol=H?K:_*(1-ha)+v*ha,hp=H?_e:Ol,Cn=H?w*(1-ha)+T*ha:Le,Ki=H?at:h*(1-ha)+p*ha,ey=H?ze:Math.sin(Ki),q_=H?fe:Math.cos(Ki),W_=H?x(ha):vt,Cw=H?Math.sin(W_):Tt,X_=H?Math.cos(W_):bt,ty=l+Be(Ol,Cn,hp);Tn=q_*X_*ty,bo=ey*X_*ty,ua=Cw*ty}const ne=Tn,Ei=bo,Lh=ua,Sn=Xn,Dh=Hi,Qe=Ui;Xn=ne,Hi=Ei,Ui=Lh;{const ha=dr+Hr,Ol=ha*z,hp=Sn-A,Cn=Dh-P,Ki=Qe-I;B[Ol]=hp,B[Ol+1]=Cn,B[Ol+2]=Ki,ph(hp,Cn,Ki,S);const ey=Hr*mt;Zd(Z,ha,H?_t:ey,H?ey:Rt)}const Al=Hn,En=qn,G_=Wn;Hn=Sn,qn=Dh,Wn=Qe;const j_=Sn,Xa=Dh,em=Qe,H_=1/Math.sqrt(j_*j_+Xa*Xa+em*em),Qt=em*H_;let Qg=0,tm=0,Kg=0;if(He&&Qt*Qt<.999){let ha=0,Ol=0,hp=0;{const Cn=W===0?-1:1;ha=Cn*(ne-Al),Ol=Cn*(Ei-En),hp=Cn*(Lh-G_)}{const Cn=Hr*mt,Ki=H?K:_*(1-Cn)+v*Cn,ey=H?_e:Ki,q_=H?w*(1-Cn)+T*Cn:Le,W_=H?at:h*(1-Cn)+p*Cn,Cw=H?ze:Math.sin(W_),X_=H?fe:Math.cos(W_),ty=H?x(Cn):vt,tP=H?Math.sin(ty):Tt,Za=H?Math.cos(ty):bt;let lE=j_,cE=Xa,j=em;if(N){const pe=l+Xi(ey-Dt,q_-jt,Ce),Te=H?Za:Fi;lE=(H?Si:X_)*Te*pe,cE=(H?Pr:Cw)*Te*pe,j=(H?tP:ci)*pe}{const pe=l+Xi(Ki+Dt,q_+jt,y),Te=H?Za:ti,ar=(H?Ur:X_)*Te*pe,Vs=(H?ai:Cw)*Te*pe,yi=(H?tP:li)*pe;N||(lE=2*j_-ar,cE=2*Xa-Vs,j=2*em-yi);const da=W===3?-1:1,Z_=da*(lE-ar),iJ=da*(cE-Vs),sJ=da*(j-yi);Qg=hp*iJ-Ol*sJ,tm=ha*sJ-hp*Z_,Kg=Ol*Z_-ha*iJ;const c6=1/Math.sqrt(Qg*Qg+tm*tm+Kg*Kg);Qg*=c6,tm*=c6,Kg*=c6}}}else Qg=j_*H_,tm=Xa*H_,Kg=em*H_;je.setNormalFromValues(Hr,Qg,tm,Kg)}})()}}function wSe(t){PSe(t)}function xSe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function sut(t,e,r,i){return xSe(t*(1-i)+e*i,r)}function nut(t,e,r){return t*(1-r)+e*r}function yY(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,s=e.ellipsoid.radius;return n=>sut(i[1],i[3],s,n)}const r=e.extentInRadians;return i=>nut(r[1],r[3],i)}function out(t,e){const r=t.tile.extent,i=t.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-s)/o):0,h=l!=null?Math.max(0,(l[1]-n)/a):0,p=l!=null?Math.min(1,(l[2]-s)/o):1,f=l!=null?Math.min(1,(l[3]-n)/a):1,m=i.numVerticesPerSide,y=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((x,S)=>x+S+1,0),v=sSe(y+_),w=t.geometry,T=w.boundingBox;xi(T),w.numVerticesPerSide=i.numVerticesPerSide,w.vertexAttributes=v,bi(w.uvRange,c,h,p,f),aut(t),OSe(t,y),TSe(t),ASe(w,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),t.intersectionData=null}function aut(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,s=i.samplerData,n=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??_Y,c=e.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),v=Math.max(p,l[1]),w=Math.min(m,l[3]),T=e.ellipsoid.radius,x=e.horizontalScale,S=i.numVerticesPerSide,O=S-1,A=S-2,P=t.geometry,I=P.vertexAttributes,V=I.position,k=I.uv0,{typedBuffer:B,typedBufferStride:z}=I.normalCompressed,Z=P.uvRange,W=Z[0],H=Z[1],Y=Z[2],M=Z[3],D=P.boundingBox,N=n[0],G=n[1],X=n[2],K=V.typedBuffer,ee=V.typedBufferStride;let _e=0;const Le=ye(p,v,w),_t=o?(Math.PI/2-2*Math.atan(Math.exp(-Le/T)))*T:Le*x,Rt=1/O,at=ye(p*(1-Rt)+m*Rt,v,w);let vt=_t,ze=o?(Math.PI/2-2*Math.atan(Math.exp(-at/T)))*T:at*x;for(let fe=1;fe<=A;fe++){const Tt=fe/O,bt=ye(p*(1-Tt)+m*Tt,v,w),Ce=ye(Tt,H,M),Be=ze,je=(fe-1)/O,ft=ye(p*(1-je)+m*je,v,w),ct=vt,hr=(fe+1)/O,He=ye(p*(1-hr)+m*hr,v,w),mt=o?(Math.PI/2-2*Math.atan(Math.exp(-He/T)))*T:He*x,dr=ye(hr,H,M);vt=ze,ze=mt;const nt=ye(h,y,_);let ut=nt*x,gt=Xi(nt,bt,s);const Dt=1/O,jt=ye(Dt,W,Y),Ti=ye(h*(1-jt)+f*jt,y,_);let jr=jt,gi=Ti,kt=Ti*x,ai=Xi(Ti,bt,s);if(fe===1){const Ur=kt-N,ei=vt-G,Pr=ai-X,Si=0*ee;K[Si]=Ur,K[Si+1]=ei,K[Si+2]=Pr,ph(Ur,ei,Pr,D);const zr=ye(Dt,W,Y);Zd(k,_e,zr,Ce)}for(let Ur=1;Ur<=A;Ur++){const ei=kt,Pr=ai,Si=(Ur+1)/O,zr=ye(Si,W,Y),li=ye(h*(1-Si)+f*Si,y,_),ti=gi;gi=li;{const Hi=_e+1,Ui=Hi*ee;if(fe===1||Ur===A){const Hr=li*x,Tn=Xi(li,bt,s);if(fe===1&&Ur<A){const bo=Hr-N,ua=Be-G,ne=Tn-X;K[Ui]=bo,K[Ui+1]=ua,K[Ui+2]=ne,ph(bo,ua,ne,D),Zd(k,Hi,zr,Ce)}kt=Hr,ai=Tn}else kt=K[Ui]+N,ai=K[Ui+2]+X}const pr=kt,ci=ai,Fi=ut,Hn=gt;ut=ei,gt=Pr;const qn=(_e-A)*ee,Wn=fe===1?Xi(ti,ft,s):K[qn+2]+X,Xn=Xi(ti,He,s);if(fe<A){const Hi=_e+A,Ui=Hi*ee,Hr=ei-N,Tn=mt-G,bo=Xn-X;K[Ui]=Hr,K[Ui+1]=Tn,K[Ui+2]=bo,ph(Hr,Tn,bo,D);const ua=jr;jr=zr,Zd(k,Hi,ua,dr)}{const Hi=pr-Fi,Ui=ct-mt,Hr=Ui*(ci-Hn),Tn=Hi*(Wn-Xn),bo=-Ui*Hi,ua=Hr*Hr+Tn*Tn+bo*bo;if(ua===0)Yb(B,_e,0,0,1,z);else{const ne=1/Math.sqrt(ua);Yb(B,_e,Hr*ne,Tn*ne,bo*ne,z)}}++_e}}}function lut(t,e){t.tile.intersectsClippingArea&&(ESe(t),SSe(t,!0),qF(t))}function cut(t,e){t.tile.intersectsClippingArea&&(TSe(t),qF(t))}function TSe(t,e){t.tile.intersectsClippingArea&&(ESe(t),SSe(t,!1))}function SSe(t,e){const r=t.geometryState,i=r.neighborData,s=t.tile,n=s.surface,o=s.extent,a=r.clippingArea,l=a??_Y,c=o[0],h=o[2],p=o[1],f=o[3],m=[f>l[3],h>l[2],p<l[1],c<l[0]],y=t.geometry,_=s.horizontalScale,v=CSe(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,_),w=y.boundingBox,T=y.uvRange[0],x=y.uvRange[1],S=y.uvRange[2],O=y.uvRange[3],A=Math.max(c,l[0]),P=Math.min(h,l[2]),I=Math.max(p,l[1]),V=Math.min(f,l[3]),k=t.localOrigin,B=k[0],z=k[1],Z=k[2],W=r.samplerData;for(let H=0;H<4;++H){const Y=H===1||H===3,M=i.edgeResolutions[H];we(Ib(M));const D=M+1,N=m[H],G=k1(s,i.edgePeerNeighbors[H]);if(!N&&MSe(s,G,H)){RSe(t,H,G);continue}const X=G!=null&&!N,K=G==null?void 0:G.renderData,ee=K==null?void 0:K.geometryState;if(rn&&(we(!X||G.level===s.level),we(!X||_g(s,G)<=0),s&&!G&&!n.updatingRootTiles)){const nt=gf[H],ut=s.findNeighborTile(nt,gt=>gt.isLoaded||gt.isLeaf||gt.level===s.level);n.updatingRootTiles||(ut?ut.intersectsClippingArea&&(we(!ut.isLoaded),we(!ut.isLeaf),we(ut.level===s.level)):we((n==null?void 0:n.rootTiles)==null||!s.shouldHaveNeighbor(nt)))}const _e=ye(H===1?h:c,A,P),Le=ye(H===0?f:p,I,V),_t=ee==null?void 0:ee.samplerData,Rt=y.outerEdges[H],at=e&&D>3?D-3:1,vt=ye(H===1?1:0,T,S),ze=ye(H===0?1:0,x,O),fe=X?(nt,ut)=>.5*(Xi(nt,ut,_t)+Xi(nt,ut,W)):(nt,ut)=>Xi(nt,ut,W),Tt=(h-c)/M,bt=Y?H===1?Tt:-Tt:0,Ce=Y?0:H===0?Tt:-Tt,Be=-bt,je=-Ce;let ft=0,ct=0,hr=0;{const nt=0/M,ut=Y?_e:ye(c*(1-nt)+h*nt,A,P),gt=Y?ye(p*(1-nt)+f*nt,I,V):Le,Dt=fe(ut,gt);ft=ut*_,ct=v(gt),hr=Dt}let He=0,mt=0,dr=0;{const nt=1/M,ut=Y?_e:ye(c*(1-nt)+h*nt,A,P),gt=Y?ye(p*(1-nt)+f*nt,I,V):Le,Dt=fe(ut,gt);He=ut*_,mt=v(gt),dr=Dt}for(let nt=1;nt<D-1;nt+=at){const ut=nt/M,gt=He,Dt=mt,jt=dr;{const zr=Y?vt:ye(ut,T,S),li=Y?ye(ut,x,O):ze,ti=gt-B,pr=Dt-z,ci=jt-Z;ph(gt,pr,ci,w),Rt.setVertexFromValuesRawPositionUV(nt,ti,pr,ci,zr,li)}{const zr=(nt+1)/M,li=Y?_e:ye(c*(1-zr)+h*zr,A,P),ti=Y?ye(p*(1-zr)+f*zr,I,V):Le,pr=fe(li,ti);He=li*_,mt=v(ti),dr=pr}const Ti=He,jr=dr,gi=ft,kt=ct,ai=hr;ft=gt,ct=Dt,hr=jt;let Ur=0,ei=0,Pr=0;if(Y){const zr=mt-Dt,li=jr-jt,ti=kt-Dt,pr=ai-jt,ci=ye(p*(1-ut)+f*ut,I,V),Fi=_e+Be,Hn=Fi*_-gt,qn=Xi(Fi,ci,W)-jt,Wn=H===3?-1:1;if(Ur=Wn*(-ti+zr)*qn,ei=Wn*Hn*(-pr+li),Pr=-Wn*Hn*(-ti+zr),X){const Xn=_e+bt,Hi=Xn*_-gt;Ur=(-ti+zr)*(qn-(Xi(Xn,ci,_t)-jt)),ei=(Hn-Hi)*(-pr+li),Pr=-(Hn-Hi)*(-ti+zr)}}else{const zr=Ti-gt,li=jr-jt,ti=gi-gt,pr=ai-jt,ci=ye(c*(1-ut)+h*ut,A,P),Fi=Le+je,Hn=Xi(ci,Fi,W)-jt,qn=v(Fi)-Dt,Wn=H===2?-1:1;if(Ur=Wn*qn*(-pr+li),ei=Wn*(-ti+zr)*Hn,Pr=-Wn*qn*(-ti+zr),X){const Xn=ci,Hi=Le+Ce,Ui=v(Hi)-Dt;Ur=(-qn+Ui)*(-pr+li),ei=(-ti+zr)*(-Hn+(Xi(Xn,Hi,_t)-jt)),Pr=-(-qn+Ui)*(-ti+zr)}}const Si=1/Math.sqrt(Ur*Ur+ei*ei+Pr*Pr);Rt.setNormalFromValues(nt,Ur*Si,ei*Si,Pr*Si)}}}function ESe(t,e){PSe(t)}function uut(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function hut(t,e){return t*e}function CSe(t,e,r){return t?i=>uut(i,e):i=>hut(i,r)}function ASe(t,e,r,i,s,n){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=gf.map((x,S)=>S===0&&s[1]<e-2||S===1&&i[1]<e-2||S===2&&s[0]>1||S===3&&i[0]>1),h=t.outerEdges.reduce((x,S,O)=>x+(c[O]?0:o-2+S.count-1),0),p=r.reduce((x,S)=>x+o*(2*(S.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+p)*f,y=a>=Kct?new Uint32Array(m):new Uint16Array(m);let _=0;const v=e-2,w=o-2;we(w>=0);const T=(x,S,O,A,P,I)=>{const V=x*P,k=I[V],B=I[V+1],z=I[V+2],Z=S*P,W=I[Z],H=I[Z+1],Y=I[Z+2],M=O*P,D=I[M],N=I[M+1],G=I[M+2],X=A*P,K=I[X],ee=I[X+1],_e=I[X+2];return(W-K)*(W-K)+(H-ee)*(H-ee)+(Y-_e)*(Y-_e)>(k-D)*(k-D)+(B-N)*(B-N)+(z-G)*(z-G)};if(n){const x=(O,A,P)=>{y[_++]=O,y[_++]=A,y[_++]=A,y[_++]=P,y[_++]=P,y[_++]=O,rn&&(we(O<a),we(A<a),we(P<a),we(_<=m))};(()=>{for(let O=Math.max(s[0],1)-1;O<Math.min(s[1],e-2)-1;++O){const A=O*v;for(let P=Math.max(i[0],1)-1;P<Math.min(i[1],e-2)-1;++P){const I=O*v+P,V=I+1,k=V+v,B=k-1,z=A+P,Z=z+1,W=Z+v,H=W-1,Y=t.vertexAttributes.position.typedBuffer,M=t.vertexAttributes.position.typedBufferStride;T(z,Z,W,H,M,Y)?(x(I,V,k),x(k,B,I)):(x(I,V,B),x(B,k,V))}}})(),we(_===3*l*f),(()=>{for(let O=0;O<4;++O){const A=_;if(c[O])continue;const P=t.outerEdges[O],I=t.innerEdges[O];let V=0,k=0;const B=P.count,z=I.count;we(z===o-1);let Z=0;const W=O===1||O===2?(H,Y,M)=>x(H,Y,M):(H,Y,M)=>x(H,M,Y);for(;V<B-1||k<z-1;){const H=I.getVertexIndex(k),Y=P.getVertexIndex(V),M=V<B-1,D=k<z-1;M&&(!D||(M?0+o*(V+.5)/(B-1):0)<=(D?1+w*(k+.5)/(z-1):0))?(++V,rn&&we(V<B),W(H,Y,P.getVertexIndex(V)),Z++):(++k,rn&&we(k<z),W(H,Y,I.getVertexIndex(k)),Z++)}rn&&(we(V===B-1),we(k===z-1),we(Z===B+z-2),we(Z===o-2+P.count-1),we(_===A+3*Z*f))}})(),we(_===3*(l+h)*f);const S=O=>{const A=t.outerEdges[O.connectedOuterEdgeOffset];let P=A.getVertexIndex(0),I=A.stride;for(let V=0;V<O.latitudeResolution;++V){const k=V===0?O.rowOffset:P+e;for(let B=0;B<o;B++)x(P,P+1,k+B),V<O.latitudeResolution-1&&x(P+1,k+B+1,k+B),P+=I;P=k,I=1}};r.forEach(S)}else{(()=>{const S=Math.max(s[0],1)-1,O=Math.min(s[1],e-2)-1,A=Math.max(i[0],1)-1,P=Math.min(i[1],e-2)-1;for(let I=S;I<O;++I){const V=I*v;for(let k=A;k<P;++k){const B=V+k,z=B+1,Z=z+v,W=Z-1,H=t.vertexAttributes.position.typedBuffer,Y=t.vertexAttributes.position.typedBufferStride;T(B,z,Z,W,Y,H)?(y[_]=B,y[_+1]=z,y[_+2]=Z,y[_+3]=Z,y[_+4]=W,y[_+5]=B):(y[_]=B,y[_+1]=z,y[_+2]=W,y[_+3]=W,y[_+4]=z,y[_+5]=Z),_+=6}}})(),we(_===3*l*f),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const O=t.outerEdges[S],A=t.innerEdges[S];let P=0,I=0;const V=O.count,k=A.count;we(k===o-1);const B=S===1||S===2,z=B?1:2,Z=B?2:1,W=O.index0,H=O.stride,Y=A.index0,M=A.stride;for(;P<V-1||I<k-1;){const D=Y+I*M,N=W+P*H,G=P<V-1,X=I<k-1,K=G&&(!X||(G?0+o*(P+.5)/(V-1):0)<=(X?1+w*(I+.5)/(k-1):0));K?++P:++I;const ee=K?N+H:D+M;y[_]=D,y[_+z]=N,y[_+Z]=ee,_+=3}}})(),we(_===3*(l+h)*f);const x=S=>{const O=t.outerEdges[S.connectedOuterEdgeOffset];let A=O.getVertexIndex(0),P=O.stride;for(let I=0;I<S.latitudeResolution;++I){const V=I===0?S.rowOffset:A+e;for(let k=0;k<o;k++){const B=V+k;y[_]=A,y[_+1]=A+1,y[_+2]=B,I<S.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=B+1,y[_+5]=B,_+=6):_+=3,A+=P}A=V,P=1}};r.forEach(x)}we(_===m),t.indices=y,t.indexCount=m}function OSe(t,e){const r=t.localOrigin,i=t.geometry,s=t.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new kne(o,r,h,p,n)}{const c=a,h=s[l]+1;i.outerEdges[l]=new kne(o,r,c,1,h),a+=h}}}function RSe(t,e,r){const i=(e+2)%4,s=t.geometryState,n=t.tile,o=s.neighborData,a=n.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];we(Ib(c));const h=c+1,p=t.geometry,f=p.boundingBox,m=p.outerEdges[e],y=p.uvRange[0],_=p.uvRange[1],v=p.uvRange[2],w=p.uvRange[3],T=ye(e===1?1:0,y,v),x=ye(e===0?1:0,_,w),S=r.renderData,O=S.geometryState,A=S.geometry.outerEdges[i],P=n.getNeighborEdgeStartVertexIndex(e,r)*c,I=c*2**a;we(O.neighborData.edgeResolutions[i]===I),we(A.count-1===I);const V=S.localOrigin[0]-t.localOrigin[0],k=S.localOrigin[1]-t.localOrigin[1],B=S.localOrigin[2]-t.localOrigin[2],z=m.attributes,Z=m.index0,W=m.stride,H=z.position.typedBuffer,Y=z.position.typedBufferStride,M=z.normalCompressed.typedBuffer,D=z.normalCompressed.typedBufferStride,N=z.uv0,G=A.attributes,X=A.index0,K=A.stride,ee=G.position.typedBuffer,_e=G.position.typedBufferStride,Le=G.normalCompressed.typedBuffer,_t=G.normalCompressed.typedBufferStride;for(let Rt=1;Rt<h-1;++Rt){const at=Z+W*Rt,vt=X+K*(P+Rt),ze=at*Y,fe=vt*_e,Tt=ee[fe]+V,bt=ee[fe+1]+k,Ce=ee[fe+2]+B;H[ze]=Tt,H[ze+1]=bt,H[ze+2]=Ce,ph(Tt,bt,Ce,f);const Be=at*D,je=vt*_t;M[Be]=Le[je],M[Be+1]=Le[je+1];const ft=Rt/c,ct=l?T:ye(ft,y,v),hr=l?ye(ft,_,w):x;Zd(N,at,ct,hr)}}function PSe(t){var ze;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,s=r.cornerNeighborData,n=t.geometry,o=n.outerEdges,a=n.boundingBox,l=t.tile,c=((ze=t.tile.surface.view)==null?void 0:ze.viewingMode)==="local",h=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,y=0,_=0;const v=(fe,Tt,bt)=>{const Ce=p[Tt===0?1:3],Be=p[fe===0?0:2],je=Math.cos(Ce),ft=Math.sin(Ce),ct=Math.sin(Be),hr=Math.cos(Be),He=h+bt;m=hr*je*He,y=ct*je*He,_=ft*He},w=c?(()=>{const fe=t.geometryState.clippingArea,Tt=l.extent,bt=fe!=null&&(Tt[3]>fe[3]||Tt[2]>fe[2]||Tt[1]<fe[1]||Tt[0]<fe[0]),Ce=CSe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Be,je,ft)=>{const ct=Be===0?Z[0]:Z[2],hr=je===0?Z[1]:Z[3],He=bt?ye(ct,fe[0],fe[2]):ct,mt=bt?ye(hr,fe[1],fe[3]):hr,dr=ft;m=He*f,y=Ce(mt),_=dr}})():v;let T=0,x=0,S=0,O=0,A=0,P=0,I=0,V=0,k=0;const B=c&&t.tile.surface.isWebMercatorOnPlateeCarree,z=(fe,Tt,bt,Ce,Be)=>{let je=0,ft=0,ct=0;if(c){const hr=Tt*f,He=B?(Math.PI/2-2*Math.atan(Math.exp(-bt/h)))*h:bt*f;je=hr-m,ft=He-y,ct=Ce-_}else{const hr=yY(fe),He=fe.tile,mt=He.extent,dr=He.extentInRadians,nt=(Tt-mt[0])/(mt[2]-mt[0]),ut=(bt-mt[1])/(mt[3]-mt[1]),gt=dr[0]*(1-nt)+dr[2]*nt,Dt=hr(ut),jt=Math.cos(Dt),Ti=Math.sin(Dt),jr=Math.sin(gt),gi=Math.cos(gt),kt=h+Ce;je=gi*jt*kt-m,ft=jr*jt*kt-y,ct=Ti*kt-_}switch(Be){case 0:I+=je,V+=ft,k+=ct;break;case 1:O-=je,A-=ft,P-=ct;break;case 2:I-=je,V-=ft,k-=ct;break;case 3:O+=je,A+=ft,P+=ct}},Z=l.extent,W=e.clippingArea,H=W??_Y,Y=Z[0],M=Z[2],D=Z[1],N=Z[3],G=[N>H[3],M>H[2],D<H[1],Y<H[0]],X=Math.max(Y,H[0]),K=Math.min(M,H[2]),ee=Math.max(D,H[1]),_e=Math.min(N,H[3]),Le=n.uvRange[0],_t=n.uvRange[1],Rt=n.uvRange[2],at=n.uvRange[3],vt=fe=>{var hr;const Tt=s[fe].cornerTiles;T=0,x=0,S=1,O=0,A=0,P=0,I=0,V=0,k=0;let bt=1/0;for(let He=0;He<4;++He)bt=Math.min(bt,((hr=Tt[He])==null?void 0:hr.level)??1/0);for(let He=0;He<4;++He){const mt=Tt[He];oC[He]=(mt==null?void 0:mt.level)===bt?mt:null}let Ce=1,Be=0;for(let He=0;He<4;++He){const mt=oC[He];mt&&(Ce=Math.max(Ce,mt==null?void 0:mt.renderData.geometryState.numVerticesPerSide),Be=mt.extent[2]-mt.extent[0])}const je=Be,ft=Ce;we(ft>1);const ct=je/ft;for(let He=0;He<4;++He){const mt=oC[(He+3)%4],dr=oC[He%4];if(!mt&&!dr)continue;const nt=He===0?1:He===1?2:He===2?3:0,ut=He===0?2:He===1?3:He===2?0:1;if(mt&&dr){const gt=l9[He][0]*ct,Dt=l9[He][1]*ct,jt=mt.extent,Ti=jt[nt===0||nt===1?2:0]+gt,jr=jt[nt===0||nt===3?3:1]+Dt,gi=dr.extent,kt=gi[ut===0||ut===1?2:0]+gt,ai=gi[ut===0||ut===3?3:1]+Dt,Ur=mt.renderData,ei=dr.renderData,Pr=Xi(Ti,jr,Ur.geometryState.samplerData),Si=Xi(kt,ai,ei.geometryState.samplerData);z(Ur,Ti,jr,.5*(Pr+Si),He)}else{const gt=mt??dr,Dt=mt?nt:ut,jt=gt.extent,Ti=l9[He],jr=jt[Dt===0||Dt===1?2:0]+Ti[0]*ct,gi=jt[Dt===0||Dt===3?3:1]+Ti[1]*ct,kt=gt.renderData,ai=Xi(jr,gi,kt.geometryState.samplerData);z(kt,jr,gi,ai,He)}}if(!c){const He=Math.sqrt(m*m+y*y+_*_);T=m/He,x=y/He,S=_/He}if(c||S*S<.999){const He=Math.sqrt(O*O+A*A+P*P);O/=He,A/=He,P/=He;const mt=Math.sqrt(I*I+V*V+k*k);I/=mt,V/=mt,k/=mt,T=P*V-A*k,x=O*k-P*I,S=A*I-O*V;const dr=1/Math.sqrt(T*T+x*x+S*S);T*=dr,x*=dr,S*=dr}};for(let fe=0;fe<4;++fe){const Tt=fe,bt=(fe+1)%4,Ce=fe===0||fe===1?1:0,Be=fe===0||fe===3?1:0,je=ye(Ce,Le,Rt),ft=ye(Be,_t,at),ct=o[Tt],hr=fe===0||fe===3?ct.count-1:0,He=o[bt],mt=fe===0||fe===1?He.count-1:0,dr=s[fe].cornerTiles;let nt=-1;for(let Dt=0;Dt<4;++Dt){const jt=dr[Dt];jt&&(nt===-1||_g(dr[nt],jt)>0)&&(nt=Dt)}const ut=nt,gt=dr[ut];if(gt!==l){const Dt=l.level-gt.level,jt=2**Dt,Ti=[gt.lij[0]+Dt,gt.lij[1]*jt,gt.lij[2]*jt],jr=[Ti[1]+jt===l.lij[1],fe===0&&(ut===1||ut===0&&gt!==dr[3])||fe===1&&(ut===0||ut===1&&gt!==dr[2]),Ti[1]===l.lij[1]+1,fe===2&&(ut===3||ut===2&&gt!==dr[1])||fe===3&&(ut===2||ut===3&&gt!==dr[0])],gi=jr.reduce((Pr,Si)=>Pr+(Si?1:0),0);we(gi===1||gi===2);let kt=-1,ai=-1;const Ur=gt.renderData;if(gi===1){const Pr=jr.findIndex(zr=>zr);we(0<=Pr&&Pr<=3),kt=(Pr+2)%4;const Si=t.geometryState.neighborData.edgeResolutions[Pr];ai=l.getNeighborEdgeStartVertexIndex(Pr,gt)*Si+Si*(Pr===0&&fe===0||Pr===1&&fe===0||Pr===2&&fe===1||Pr===3&&fe===3?1:0)}else{we(jr[1]||jr[3]),kt=jr[1]?3:1;const Pr=Ur.geometryState.neighborData.edgeResolutions[kt];ai=fe===0||fe===3?0:Pr}const ei=Ur.geometry.outerEdges[kt];{const Pr=ct.index0+hr*ct.stride,Si=He.index0+mt*He.stride,zr=ei.index0+ai*ei.stride;{const li=ei.attributes.position,ti=li.typedBuffer,pr=zr*li.typedBufferStride,ci=t.localOrigin,Fi=ei.localOrigin,Hn=ti[pr]+Fi[0]-ci[0],qn=ti[pr+1]+Fi[1]-ci[1],Wn=ti[pr+2]+Fi[2]-ci[2];ph(Hn,qn,Wn,a);{const Xn=ct.attributes.position,Hi=Xn.typedBuffer,Ui=Pr*Xn.typedBufferStride;Hi[Ui]=Hn,Hi[Ui+1]=qn,Hi[Ui+2]=Wn}{const Xn=He.attributes.position,Hi=Xn.typedBuffer,Ui=Si*Xn.typedBufferStride;Hi[Ui]=Hn,Hi[Ui+1]=qn,Hi[Ui+2]=Wn}}Zd(ct.attributes.uv0,Pr,je,ft),Zd(He.attributes.uv0,Si,je,ft);{const li=ei.attributes.normalCompressed.typedBuffer,ti=zr*ei.attributes.normalCompressed.typedBufferStride;{const pr=ct.attributes.normalCompressed,ci=pr.typedBuffer,Fi=Pr*pr.typedBufferStride;ci[Fi]=li[ti],ci[Fi+1]=li[ti+1]}{const pr=He.attributes.normalCompressed,ci=pr.typedBuffer,Fi=Si*pr.typedBufferStride;ci[Fi]=li[ti],ci[Fi+1]=li[ti+1]}}}}else{const Dt=G[Tt],jt=G[bt];let Ti;if(Dt||jt){const ai=ye(Y*(1-Ce)+M*Ce,X,K),Ur=ye(D*(1-Be)+N*Be,ee,_e),ei=e.samplerData;Ti=Xi(ai,Ur,ei)}else Ti=dut(dr);w(Ce,Be,Ti),vt(fe);const jr=m-i[0],gi=y-i[1],kt=_-i[2];ph(jr,gi,kt,a),ct.setVertexFromValuesRawPositionUVNormal(hr,jr,gi,kt,je,ft,T,x,S),He.setVertexFromValuesRawPositionUVNormal(mt,jr,gi,kt,je,ft,T,x,S)}}for(let fe=0;fe<4;++fe)oC[fe]=null}function dut(t){var n,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);rn&&(we(!t[0]||!t[2]||fG(t[0],t[2],it.SOUTH_WEST)),we(!t[1]||!t[3]||fG(t[1],t[3],it.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,h=a===0||a===3,p=l.extent,f=p[c?0:2],m=p[h?1:3],y=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;i+=Xi(f,m,y),r++}}const s=r?i/r:0;return we(s!=null),s}function qF(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const l9=[[0,1],[1,0],[0,-1],[-1,0]],no=new Qlt,_Y=yq(-1/0,-1/0,1/0,1/0),oC=[null,null,null,null];function MSe(t,e,r){if(!e)return!1;const i=_g(t,e);return i>0||i===0&&r>=2}let put=class extends pY{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=zt(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=s!=null&&rO(s)&&n!=null&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Ae(c[0],c[1],0);Gs(h,Ge.WebMercator,h,Ge.PlateCarree);const p=Ae(c[2],c[3],0);Gs(p,Ge.WebMercator,p,Ge.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Ns.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let h=0;h<6;h++){const p=e[h],f=p[0],m=p[1],y=p[2],_=p[3];if(f*(f>0?i:o)+m*(m>0?s:a)+y*(y>0?n:l)+_>=0)return Jo.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?s:a)+y*(y<0?n:l)+_<=0}return c?Jo.INSIDE:Jo.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return B4e(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,s){return x$[0]=1/r[0],x$[1]=1/r[1],x$[2]=1/r[2],qX(this._aabb(),e,x$,i,s)}createGeometry(){out(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){lut(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){cut(this.renderData,this._horizontalScaleFactor)}};const x$=C();let fut=class{constructor(){this.extent=Zt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},OL=class extends xe{constructor(){super(...arguments),this._queries=new Bt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Bt({initialSize:30}),this._queryPool=new No(fut)}queryVisibleLevelRange(e,r,i,s){const n=this._queryPool.acquire();oh(n.extent,e),n.minLevel=r??-Number.MAX_VALUE,n.maxLevel=i??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([d()],OL.prototype,"updating",null),OL=u([R("esri.views.3d.terrain.ScaleRangeQueries")],OL);let mut=class extends pY{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=ys(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=xt(o,l,.5),p=xt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),mge(this.centerAtSeaLevel,p,h,this.ellipsoid.radius),ge(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[Ns.MIDDLE],0,0,0),se(e[Ns.TOP],0,0,0),se(e[Ns.BOTTOM],0,0,0),e[Ns.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Ns.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,gut(r,i,3*n));e[Ns.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!X0(e,this._boundingSphere))return Jo.OUTSIDE;if(this.lij[0]<10)return Jo.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<WS;n++){const o=n===di.NEAR,a=e[n],l=a[0],c=a[1],h=a[2],p=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*r[y]+c*r[y+1]+h*r[y+2]+p<0){if(f=!0,!s)break}else s=!1}if(!f)return Jo.OUTSIDE}return s?Jo.INSIDE:Jo.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){eut(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),rn&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)se(r,0,0,0),e[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];Av(toe,a,l,s),Av(roe,a,c,s),le(r,toe,roe);const h=.5*(i[0]+i[1]);ie(r,r,(s+h)/Zl(r));const p=this.convexHull;let f=0;const m=(_,v)=>{const w=_[0]-p[3*v],T=_[1]-p[3*v+1],x=_[2]-p[3*v+2];return Math.sqrt(w*w+T*T+x*x)};for(let _=0;_<8;++_){const v=m(r,_);f=Math.max(f,v)}const y=f;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===Qu.HAS_NORTH_POLE,a=n&&s===Qu.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=e[0],p=e[2],f=a?-c:e[1],m=o?c:e[3],y=.5*(h+p),_=i[0],v=r+(l?Math.min(0,_-1):_),w=(Y,M,D)=>Av(Y,M,D,v),T=C(),x=C(),S=C(),O=C();w(T,h,f),w(x,h,m),w(S,p,m),w(O,p,f);const A=(Y,M)=>{for(let D=0;D<3;++D)this._convexHull[3*M+D]=Y[D]};A(T,0),A(x,1),A(S,2),A(O,3);const P=i[1],I=r+(l?Math.max(0,P+1):P),V=C(),k=C(),B=C();Av(k,y,m,v),Av(B,y,f,v),le(V,k,B),ge(V,V);const z=C(),Z=C(),W=(Y,M)=>{_n(Z,Y,M),ge(Z,Z);const D=-me(Y,z)/me(Z,z);we(D>=0),ie(Z,Z,D),le(Y,Y,Z)};if(2**this.lij[0]>2*this.lij[1]){const Y=B,M=C();ot(M,eoe,Y),ge(M,M),ot(z,Y,M),ge(z,z),we(eh(me(z,Y)/Zl(Y),0)),W(T,x),W(O,S),A(T,0),A(O,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Y=k,M=C();ot(M,eoe,Y),ge(M,M),ot(z,M,Y),ge(z,z),W(x,T),W(S,O),A(x,1),A(S,2)}const H=(Y,M)=>{const D=I/me(M,V);for(let N=0;N<3;++N)this._convexHull[3*Y+N]=M[N]*D};H(4,T),H(5,x),H(6,S),H(7,O)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?Qu.HAS_BOTH_POLES:Qu.HAS_NORTH_POLE:i?Qu.HAS_SOUTH_POLE:Qu.REGULAR}intersectsRay(e,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],p=(l*r[0]+c*r[1]+h*r[2])/a,f=r[0]*p-l,m=r[1]*p-c,y=r[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<Kne.length?Kne[this.level]+1:2}updateCornerElevations(){iut(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){rut(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var bt;if(!rn||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,s=C(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[Ns.MIDDLE][3],p=this.convexHull,f=(Ce,Be)=>{for(let je=0;je<3;++je)Ce[je]=p[3*Be+je]};{const Ce=C(),Be=C(),je=C(),ft=C(),ct=C(),hr=(He,mt,dr,nt)=>{f(Be,He),f(je,mt),f(ft,dr),_n(Be,Be,je),_n(ft,ft,je),ot(Ce,Be,ft),ge(Ce,Ce);const ut=me(Ce,je);f(ct,nt);const gt=me(Ce,ct),Dt=Math.abs(gt-ut);we(eh(Dt,0),`Non coplanar ${He},${mt},${dr},${nt} diff = ${Dt}`)};hr(0,1,2,3),hr(4,5,6,7),hr(0,1,4,5),hr(1,2,5,6),hr(2,3,6,7),hr(3,0,7,4)}const m=Uo(24),y=(Ce,Be,je)=>{const ft=4*Ce;for(let ct=0;ct<3;++ct)m[ft+ct]=Be[ct];m[ft+3]=je},_=C(),v=C(),w=C(),T=C(),x=(Ce,Be,je,ft)=>{f(_,Be),f(v,je),f(w,ft),_n(_,_,v),ge(_,_),_n(w,w,v),ge(w,w),ot(T,_,w),ge(T,T);const ct=me(T,v);y(Ce,T,ct)};x(0,0,1,2),x(1,1,0,4),x(2,1,5,2),x(3,3,2,6),x(4,4,0,3),x(5,4,6,5);const S=1,O=(Ce,Be,je,ft)=>{const ct=4*Ce;return m[ct]*Be+m[ct+1]*je+m[ct+2]*ft-m[ct+3]},A=(Ce,Be,je,ft)=>O(Ce,Be,je,ft)>=-S,P=(Ce,Be)=>A(Ce,Be[0],Be[1],Be[2]),I=2**this.lij[0]>2*this.lij[1],V=(Ce,Be,je)=>Math.sqrt($Se(Ce,Be,je,i[0],i[1],i[2]))<r,k=Ce=>V(Ce[0],Ce[1],Ce[2]),B=(Ce,Be)=>V(Ce[Be],Ce[Be+1],Ce[Be+2]),z=this.extentInRadians,Z=.5*(z[0]+z[2]),W=z[1],H=z[3],Y=C(),M=C();Av(Y,Z,H,a),Av(M,Z,W,a);const D=I?"Upper":"Lower";let N=!0;for(let Ce=0;Ce<6;++Ce){for(let Be=0;Be<8;++Be){const je=3*Be,ft=A(Ce,p[je],p[je+1],p[je+2]);N&&(N=ft),we(ft,`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${Ce}`)}we(P(Ce,M),`Tile[${this.lij}] (${D}) bottom mid outside of plane ${Ce}`),we(P(Ce,Y),`Tile[${this.lij}] (${D}) top mid outside of plane ${Ce}`)}we(N,"Not all convex hull points are inside  convex hull polyhedron"),we(k(M),`Tile[${this.lij}] (${D}) bottom mid outside of bounding sphere`),we(k(Y),`Tile[${this.lij}] (${D}) top mid outside of bounding sphere`);for(let Ce=0;Ce<8;++Ce){const Be=B(p,3*Ce);we(Be,`Tile[${this.lij}] Convex hull point ${Ce} outside of bounding sphere`)}for(let Ce=0;Ce<6;++Ce)for(let Be=0;Be<8;++Be){const je=3*Be;A(Ce,p[je],p[je+1],p[je+2])||console.error(`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${Ce}`)}const G=this.extentInRadians,X=Math.max(G[2]-G[0],G[3]-G[1]),K=Math.round(X*n),ee=this.renderData;if(!ee)return;const{geometry:_e,localOrigin:Le}=ee,_t=(bt=_e.vertexAttributes)==null?void 0:bt.position;if(!_t)return;const Rt=_t.count,at=C(),vt=_e.numVerticesPerSide-2,ze=vt*vt,fe=ee.geometryState.neighborData,Tt=fe.edgeResolutions.reduce((Ce,Be)=>Ce+Be+1,0);for(let Ce=0;Ce<Rt;++Ce){const Be=Ce<ze,je=!Be&&Ce<ze+Tt;let ft=!1,ct=-1;if(je){let kt=ze;for(let ai=0;ai<4;++ai){const Ur=fe.edgeResolutions[ai];if(Ce===kt||Ce===kt+Ur-1){ft=!0;break}if(kt+=Ur,Ce<kt){ct=ai;break}}}const hr=je?fe.edgePeerNeighbors[ct]:null,He=je&&hr&&_g(this,hr)>0;_t.getVec(Ce,s),le(at,s,Le);const mt=Zl(at)-n;let dr=0,nt=!1;const ut=o[0]-mt,gt=mt-o[1],Dt=ut>l,jt=gt>l,Ti=Dt||jt,jr=()=>{const kt=Be?"internal":je&&!ft?"edge":ft?"corner":"pole";return`Tile[${this.lij}].vertex[${Ce}]:${kt}`+(Dt?"(below)":jt?"(above)":"")+(He?"(Neighbor)":"")},gi=aR(at,i);if(gi>=r+c){const kt=gi-r;Ti||(console.error(`${jr()} is out of the bounding sphere by ${kt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${mt.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(kt/r).toFixed(0)})`),nt=!0)}for(let kt=0;kt<6;++kt)if(!A(kt,at[0],at[1],at[2])){const ai=O(kt,at[0],at[1],at[2]),Ur=Ce%vt,ei=(Ce-Ur)/vt;kt===0&&ut||kt===5&&gt||(console.error(`${jr()} (${Ur},${ei})|${vt}] is out of the bounding trapezoid plane ${kt} h=${Math.round(mt)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(ai)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${K}`),++dr)}if(nt||dr>0)break}}};const Kne=[128,64,64,32,16,8,8,4];function gut(t,e,r){return $Se(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function $Se(t,e,r,i,s,n){const o=i-t,a=s-e,l=n-r;return o*o+a*a+l*l}const Av=(t,e,r,i)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*s,t[1]=i*o*n,t[2]=i*a},eoe=[0,0,1],toe=C(),roe=C();let cd=class extends xe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};u([d()],cd.prototype,"fovX",void 0),u([d()],cd.prototype,"fovY",void 0),u([d()],cd.prototype,"relativeWidthLimit",void 0),u([d()],cd.prototype,"relativeHeightLimit",void 0),u([d()],cd.prototype,"maxLod",void 0),u([d()],cd.prototype,"angledSplitBias",void 0),u([d()],cd.prototype,"aboveGround",void 0),u([d()],cd.prototype,"frustum",void 0),cd=u([R("esri.views.3d.terrain.SplitLimits")],cd);let ISe=class extends ca{constructor(){super(...arguments),this.blendMode=Re.Normal}};u([F({count:Re.COUNT})],ISe.prototype,"blendMode",void 0);let BA=class extends ISe{constructor(){super(...arguments),this.output=mn.Composite,this.baseOpacityMode=kd.NotRequired,this.premultipliedSource=Cd.Off}};u([F({count:mn.COUNT})],BA.prototype,"output",void 0),u([F({count:kd.COUNT})],BA.prototype,"baseOpacityMode",void 0),u([F()],BA.prototype,"premultipliedSource",void 0);var ew;function yut(t){const e=new br;if(e.include(dSe),t.background===ew.Only){const r=t.output===mn.ColorComposite;return r?e.fragment.uniforms.add(new Vt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(dY),e.fragment.code.add(b`
    void main() {
      fragColor = vec4(${r?b`backgroundColor`:b`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(pSe,t),e.fragment.uniforms.add(new Je("tex",r=>r.texture)),e.fragment.uniforms.add(new Oe("opacity",r=>r.opacity)),e.fragment.code.add(b`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(ew||(ew={}));const _ut=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return ew},build:yut},Symbol.toStringTag,{value:"Module"}));let vut=class extends hSe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=za}},LSe=class DSe extends Rr{initializeProgram(e){return new Er(e.rctx,DSe.shader.get().build(this.configuration),vr)}initializePipeline(){return Ot({blending:vc(be.ONE,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};LSe.shader=new Sr(_ut,()=>ae(()=>import("./BlendLayers.glsl-3559e0cb.js"),[]));let NSe=class extends BA{constructor(){super(...arguments),this.background=ew.BelowLayer}};u([F()],NSe.prototype,"background",void 0);let c9=class{constructor(e,r,i,s,n,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Nt(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ae(s,n,o)}destroy(){this.texture.release()}};function but(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function wut(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function xut(t,e,r,i,s,n,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t[4]=n,t[5]=o,t}function FSe(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=r*n-i*s;return l?(l=1/l,t[0]=n*l,t[1]=-i*l,t[2]=-s*l,t[3]=r*l,t[4]=(s*a-n*o)*l,t[5]=(i*o-r*a)*l,t):null}function Tut(t){return t[0]*t[3]-t[1]*t[2]}function USe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1],p=r[2],f=r[3],m=r[4],y=r[5];return t[0]=i*c+n*h,t[1]=s*c+o*h,t[2]=i*p+n*f,t[3]=s*p+o*f,t[4]=i*m+n*y+a,t[5]=s*m+o*y+l,t}function vY(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*c,t[1]=s*h+o*c,t[2]=i*-c+n*h,t[3]=s*-c+o*h,t[4]=a,t[5]=l,t}function VSe(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i*c,t[1]=s*c,t[2]=n*h,t[3]=o*h,t[4]=a,t[5]=l,t}function bY(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],h=r[1];return t[0]=i,t[1]=s,t[2]=n,t[3]=o,t[4]=i*c+n*h+a,t[5]=s*c+o*h+l,t}function Sut(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function Eut(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function wY(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Cut(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Aut(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Out(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function zSe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Rut(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function Put(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function Mut(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function $ut(t,e){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],p=e[3],f=e[4],m=e[5],y=Wa();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=y*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=y*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const Iut=USe,Lut=zSe;Object.freeze(Object.defineProperty({__proto__:null,add:Out,copy:but,determinant:Tut,equals:$ut,exactEquals:Mut,frob:Aut,fromRotation:Sut,fromScaling:Eut,fromTranslation:wY,identity:wut,invert:FSe,mul:Iut,multiply:USe,multiplyScalar:Rut,multiplyScalarAndAdd:Put,rotate:vY,scale:VSe,set:xut,str:Cut,sub:Lut,subtract:zSe,translate:bY},Symbol.toStringTag,{value:"Module"}));function kSe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Dut(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Nut(t,e,r,i,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function Fut(t,e){return new Float32Array(t,e,6)}function BSe(t,e,r,i){const s=e[i],n=e[i+1];t[i]=r[0]*s+r[2]*n+r[4],t[i+1]=r[1]*s+r[3]*n+r[5]}function Uut(t,e,r,i=0,s=0,n=2){const o=s||e.length/n;for(let a=i;a<o;a++)BSe(t,e,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:Dut,create:kSe,createView:Fut,fromValues:Nut,transform:BSe,transformMany:Uut},Symbol.toStringTag,{value:"Module"}));function RL(){return[1,0,0,1,0,0]}function Vut(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function zut(t,e,r,i,s,n){return[t,e,r,i,s,n]}function kut(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Vut,create:RL,createView:kut,fromValues:zut},Symbol.toStringTag,{value:"Module"}));function But(t){return t instanceof Float32Array&&t.length>=2}function Gut(t){return Array.isArray(t)&&t.length>=2}function u9(t){return But(t)||Gut(t)}const jut=96,Hut=39.37;function xY(t,e){return e.type?sr(t,e.x,e.y):ln(t,e)}function qut(t){return qa(t)}function Wut(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const Xut=function(){const t=Ue();return function(e,r,i){const s=r.targetGeometry;xY(t,s);const n=.5*WF(r);return e.xmin=t[0]-n*i[0],e.ymin=t[1]-n*i[1],e.xmax=t[0]+n*i[0],e.ymax=t[1]+n*i[1],e.spatialReference=s.spatialReference,e}}();function WF(t){return t.scale*Zut(t.targetGeometry)}function Zut(t){return t!=null&&ra(t.spatialReference)?1/(qut(t.spatialReference)*Hut*jut):1}function Yut(t){return X4(t.rotation)||0}const TY=function(){const t=Ue(),e=Ue(),r=Ue();return function(i,s,n,o,a,l){return FW(t,s),sc(e,n,.5*l),sr(r,1/o*l,-1/o*l),wY(i,e),a&&vY(i,i,a),VSe(i,i,r),bY(i,i,t),i}}(),Jut=function(){const t=Ue();return function(e,r,i,s){const n=WF(r),o=Yut(r);return xY(t,r.targetGeometry),TY(e,t,i,n,o,s)}}(),Qut=function(){const t=Ue();return function(e,r,i,s){const n=WF(r);return xY(t,r.targetGeometry),TY(e,t,i,n,0,s)}}();function Kut(t){const e=sb(t);return e?e.valid[1]-e.valid[0]:0}function eht(t,e){return Math.round(Kut(t)/e)}var gG;const gm=[0,0];let a0=gG=class extends de{constructor(t){super(t),this._viewpoint2D={center:Ue(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new yr,this.id=0,this.inverseTransform=RL(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=RL(),this.transformNoRotation=RL(),this.displayMat3=xl(),this.displayViewMat3=xl(),this.viewMat3=xl(),this.viewMat2d=kSe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=Wut(r,t.viewpoint),this._set("size",ln(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new gG({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return u9(e)?Qv(t,e,this.inverseTransform):(gm[0]=e,gm[1]=r,Qv(t,gm,this.inverseTransform))}toScreen(t,e,r){return u9(e)?Qv(t,e,this.transform):(gm[0]=e,gm[1]=r,Qv(t,gm,this.transform))}toScreenNoRotation(t,e,r){return u9(e)?Qv(t,e,this.transformNoRotation):(gm[0]=e,gm[1]=r,Qv(t,gm,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return TY(t,r,s,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new tp({targetGeometry:new pt(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!e||!r)return;this.resolution=WF(o),this.rotation=i,this.scale=r,this.spatialReference=e,ln(this.center,t);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;ZW(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=YW(this.viewMat3),h=Ku(n[0]/2,n[1]/2),p=Ku(-n[0]/2,-n[1]/2),f=X4(i);cN(c,c,h),JW(c,c,f),cN(c,c,p),sS(this.displayViewMat3,this.displayMat3,c);const m=wY(this.viewMat2d,h);return vY(m,m,f),bY(m,m,p),Xut(this.extent,o,n),Jut(this.transform,o,n,s),FSe(this.inverseTransform,this.transform),Qut(this.transformNoRotation,o,n,s),this.worldScreenWidth=eht(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],a0.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],a0.prototype,"pixelRatio",null),u([d({json:{write:!0}})],a0.prototype,"size",null),u([d()],a0.prototype,"spatialReference",void 0),u([d({type:tp,json:{write:!0}})],a0.prototype,"viewpoint",null),a0=gG=u([R("esri.views.2d.ViewState")],a0);const tht=a0;var yG,_G,ioe,soe,noe,ooe,aoe,loe,coe,uoe,hoe,doe,poe,foe,moe,goe,yoe,_oe,voe,boe,woe,xoe,Toe,Soe,Eoe,Coe,Aoe,Ooe,Roe,Poe,Moe,$oe,Ioe,Loe,Doe,Noe,Foe,Uoe,Voe,zoe,koe,Boe,Goe,joe,Hoe,qoe,Woe,Xoe,Zoe,Yoe,Joe,Qoe,Koe,eae,tae,rae,iae,sae,nae,oae,aae;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(yG||(yG={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(_G||(_G={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(ioe||(ioe={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(soe||(soe={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(noe||(noe={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(ooe||(ooe={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(aoe||(aoe={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(loe||(loe={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(coe||(coe={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(uoe||(uoe={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(hoe||(hoe={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(doe||(doe={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(poe||(poe={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(foe||(foe={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(moe||(moe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(goe||(goe={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(yoe||(yoe={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(_oe||(_oe={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(voe||(voe={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(boe||(boe={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(woe||(woe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(xoe||(xoe={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Toe||(Toe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Soe||(Soe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(Eoe||(Eoe={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(Coe||(Coe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Aoe||(Aoe={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(Ooe||(Ooe={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(Roe||(Roe={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(Poe||(Poe={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(Moe||(Moe={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}($oe||($oe={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(Ioe||(Ioe={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(Loe||(Loe={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(Doe||(Doe={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Noe||(Noe={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Foe||(Foe={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(Uoe||(Uoe={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(Voe||(Voe={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(zoe||(zoe={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(koe||(koe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Boe||(Boe={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Goe||(Goe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(joe||(joe={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(Hoe||(Hoe={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(qoe||(qoe={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Woe||(Woe={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(Xoe||(Xoe={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Zoe||(Zoe={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Yoe||(Yoe={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Joe||(Joe={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Qoe||(Qoe={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Koe||(Koe={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(eae||(eae={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(tae||(tae={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(rae||(rae={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(iae||(iae={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(sae||(sae={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(nae||(nae={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(oae||(oae={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(aae||(aae={}));var vG,B1,bG,h4,wG,d4,xG,G1,TG;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(vG||(vG={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(B1||(B1={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(bG||(bG={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(h4||(h4={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(wG||(wG={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(d4||(d4={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(xG||(xG={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(G1||(G1={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(TG||(TG={}));let Xh=class{};Xh.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B1.VISIBLE}},Xh.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B1.VISIBLE}},Xh.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B1.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:yG.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:_G.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Xh.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B1.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:bG.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:d4.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:h4.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:d4.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:wG.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:h4.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:xG.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[TG.HORIZONTAL]}},Xh.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:B1.VISIBLE}},Xh.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Xh.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:G1.MAP}},Xh.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:G1.MAP},"line-width":{type:"number",minimum:0,default:1}},Xh.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:G1.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:G1.MAP}},Xh.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Xh.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:G1.MAP}};const rht=.125;let iht=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new tht({viewpoint:new tp({targetGeometry:new pt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,s,n,o,a,l,c,h,p){this._render(e,r,i,s,n,o,a,l,c,h,p)}renderSymbols(e,r,i,s,n,o,a,l,c,h,p){this._render(e,r,i,s,n,o,a,l,c,h,p,vG.SYMBOL)}_render(e,r,i,s,n,o,a,l,c,h,p,f){const m=r[0]-o.getLevelShift(r[0]),y=this._renderParams;y.context=e,y.painter=s,y.glyphMosaic=s.glyphMosaic,y.spriteMosaic=s.spriteMosaic,y.pixelRatio=h*p,y.displayLevel=m,y.requiredLevel=m;const _=o.getScale(r[0]),[v,w]=o.getOffset(r,a*_),T=rht*a*_/c,x=i.transforms.dvs;x[0]=T,x[4]=-T,x[6]=-1-v-l[0]*a*2,x[7]=1+w+(1-l[1])*a*2-2,y.state.size[0]=c/p,y.state.size[1]=c/p,y.state.pixelRatio=p,i.stage||i.attachWithContext(e),i.triangleCount=0,s.drawTile(y,i,n,f)}},GSe=class jSe extends Rr{initializeProgram(e){return new Er(e.rctx,jSe.shader.get().build(this.configuration),vr)}initializePipeline(){return Ot({blending:vc(be.ONE,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};GSe.shader=new Sr(xct,()=>ae(()=>import("./RasterColorizer.glsl-d5a2450d.js"),[]));let E3=class extends BA{constructor(){super(...arguments),this.colorizerType=wb.Stretch,this.stretchType=Kb.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};u([F({count:wb.COUNT})],E3.prototype,"colorizerType",void 0),u([F({count:Kb.COUNT})],E3.prototype,"stretchType",void 0),u([F()],E3.prototype,"applyColormap",void 0),u([F()],E3.prototype,"requireBilinearWithNN",void 0);let lae=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new nn(this._rctx,new _r(e),new hN(ks.DEPTH_COMPONENT16,e));return this._fbos.set(e,i),i}};const sht=J.getLogger("esri.views.3d.terrain");let nht=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new iht,this._bindParameters=new H5(null,null,null),this._blendLayersTechniqueConfig=new NSe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Cl(this._rctx,wR)}dispose(){this._fbos.forEach(Fe),this._fbos=null,this._vtFBO=Fe(this._vtFBO),this._vaoQuad=Fe(this._vaoQuad),this._vectorTileHelper=Fe(this._vectorTileHelper),this._backgroundTechnique=ki(this._backgroundTechnique),this._applyOpacityTechnique=ki(this._applyOpacityTechnique),this._blendLayersTechnique=ki(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,s=Cd.Off,n=ew.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(LSe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Re.Normal,r?mn.ColorComposite:mn.GridComposite,kd.NotRequired,Cd.Off,ew.Only),s=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Et.TRIANGLE_STRIP,0,Io(this._vaoQuad,"geometry"))}drawGroup(e,r,i,s,n,o=Cd.On){r===mn.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,s,n,o=Cd.Off){if(e.texture==null)return;e.fboTexture=r===mn.GroupBackgroundComposite||s===Re.Normal&&n===kd.NotRequired&&o===Cd.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,tr.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=s===Re.Normal&&n===kd.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,r,i,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new E3,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Kb.Noop:Kb.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(GSe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,s,n,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,tr.MAP),m=n===kd.Required||e.opacity<1||s!==Re.Normal||r!==mn.Composite,y=m?Cd.On:Cd.Off;this._getBlendLayersTechnique(s,r,n,y).bindPipelineState(h);let _=null,v=null;m?(v=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new lae(this._rctx)),_=this._vtFBO.get(i),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(wi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom),o.vtlNeighborInfos.forAll(w=>this._vectorTileHelper.renderSymbols(h,w.sourceLod,w.sourceLayerInfo.data,f.painter,f.layer.styleRepository,f.schemaHelper,1,w.offset,l,a,f.contentZoom))}catch(w){sht.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return _==null||(h.bindFramebuffer(v),e.texture=_.colorTexture,e.offset=rp,e.scale=1,this.drawRasterData(e,r,i,s,n,y),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Ct.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;r.gl.copyTexImage2D(ns.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),r.bindTexture(i,Ct.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(wi.COLOR_BUFFER_BIT|wi.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new lae(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},oht=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new Bt({allocator:e=>e||new aht})}},aht=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},lht=class{constructor(e,r,i,s){this.start=e,this.end=r,this.blendMode=i,this.opacity=s}},cht=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new vut,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new nht(this._rctx,this._techniqueRepository),this._blackTex=new uT(gze(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Fe(this._composition),this._backgroundTexture=ki(this._backgroundTexture),this._blackTex=ki(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let h=!1;p4.clear(),_x.length=0;const p=e.layerInfo[tr.MAP];let f=p.length,m=0,y=null;for(;m<p.length;m++){const v=i.layerViewByIndex(m,tr.MAP),w=v.layer.opacity;cae[m]=w;const T=v.fullOpacity;if(uae[m]=T,wde(v.layer)&&f>=p.length&&(f=m),o4(v)){hae[m]=v.layer.blendMode;let S=v.layer.blendMode!=="normal";if(D2(v.layer.parent)){const O=SG(v.layer.parent);O!=null&&O!==""&&(S=HSe(v.layer.parent)||S)}S&&(h=S,l=!1)}if(w===0&&!h){p[m].pendingUpdates&=~(yt.TEXTURE_NOFADING&yt.TEXTURE_FADING);continue}++o;const x=h9(e,m);if(x){if(p[m].pendingUpdates&=~(yt.TEXTURE_NOFADING&yt.TEXTURE_FADING),D2(v.layer.parent)){const S=SG(v.layer.parent);S!=null&&S!==""&&qSe(v.layer.parent,m)}kO(v)?a=Math.max(a,this.tileSize*c):s===1&&T===1&&(v.isOpaque||this._dataToTexture(x)&&x.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,y===null&&(y=m)}}const _=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),n!==0&&y!==null?n===1&&!h&&this._useLayerTexture(e,y,f,uae[y])||this._composeMapLayers(e,r,m-1,f,cae,hae,a,_,!l||h,p4,h):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=rp,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=yg.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=yg.Delayed);const s=e.renderData;this._backgroundTexture&&s.textureReference==null&&(i=yg.Immediate),s.setTextureReference(this._backgroundTexture!=null?new c9(this._backgroundTexture,Ks.FADING,dae,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,s){const n=r<i,o=n?1:e.surface.baseOpacity,a=n?e.surface.baseOpacity:1,l=h9(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new c9(l.sourceLayerInfo.data,Ks.FADING,l,o,a,s)),!0)}_composeMapLayers(e,r,i,s,n,o,a,l,c,h,p){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,y=At.LINEAR_MIPMAP_LINEAR,_=!1,v=0;for(let x=i;x>=0;x--){const S=h9(e,x);if(!S||n[x]===0&&!p)continue;const O=x<s&&f<1&&!m;this._passParameters.baseOpacity=O?f:1;const A=this._passParameters.baseOpacity<1?kd.Required:kd.NotRequired;O&&(m=!0);let P=!1;h.forEach(B=>{B.start===x&&(_x.push(B),this._composition.openGroup(a),P=!0)});const I=v===0,V=P?mn.GroupBackgroundComposite:c&&I?this.backgroundIsGrid?mn.GridComposite:mn.ColorComposite:mn.Composite,k=pG[o[x]];for(X2e(S)?(this._passParameters.opacity=n[x],_=this._composition.drawVectorData(this._passParameters,V,a,k,A,S,l,this.tileSize,_)):jat(S)?(this._passParameters.opacity=n[x],this._composition.drawImageryTileData(this._passParameters,V,a,k,A,S),this._hasNearestInterpolation(S)&&(y=At.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=n[x],this._composition.drawRasterData(this._passParameters,V,a,k,A));_x.length>0&&_x[_x.length-1].end===x;){const B=_x.pop();this._passParameters.opacity=B.opacity,this._passParameters.offset=rp,this._passParameters.scale=1;const z=c&&I?this.backgroundIsGrid?mn.GridComposite:mn.ColorComposite:mn.Composite;this._composition.drawGroup(this._passParameters,z,a,pG[B.blendMode],A)}v++}const w=e.renderData,T=w.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(T),this._composition.unbind(),w.setTextureReference(new c9(T,r,dae,m?1:f,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(qat(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return Hat(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=At.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const i=new _r;i.wrapMode=Lt.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const s=this._rctx;let n;if(typeof e=="number")i.width=i.height=e,n=new uT(new Ct(s,i));else if(e instanceof kF)i.isOpaque=e.isOpaque,n=new uT(new Ct(s,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,n=new uT(new Ct(s,i,e))}catch{n=new uT(G0e(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,Ct.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,Ct.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function h9(t,e){ma.layerIndex=e,ma.vtlNeighborInfos.clear();const r=t.layerInfo[tr.MAP][e];if(r.data)return sr(ma.offset,0,0),ma.tile=t,ma.scale=1,ma.sourceLod=t.lij,ma.sourceLayerInfo=r,X2e(ma)&&t.forEachLoadedNeighbor((s,n)=>{if(s.level!==t.level)return;const o=s.layerInfo[tr.MAP][e];if(!Z2e(o)||r.data===o.data)return;const a=ma.vtlNeighborInfos.pushNew();a.offset=Lm[n],a.sourceLod=s.lij,a.sourceLayerInfo=o}),ma;const i=r.upsampleInfo;if(i){const s=i.tile.layerInfo[tr.MAP][e];return ma.tile=i.tile,ln(ma.offset,i.offset),ma.scale=i.scale,ma.sourceLod=i.tile.lij,ma.sourceLayerInfo=s,ma}return null}function SG(t){return t.get("uid")}function HSe(t){let e=t.blendMode!=="normal";return D2(t.parent)&&(e=HSe(t.parent)||e),e}function qSe(t,e){D2(t.parent)&&qSe(t.parent,e);const r=SG(t);if(r!=null&&r!==""){const i=p4.get(r);i?i.start=e:p4.set(r,new lht(e,e,t.blendMode,t.opacity))}}const cae=new Array,uae=new Array,hae=new Array,p4=new Map,_x=new Array,ma=new oht,dae={offset:[0,0],scale:1},Lm=new Array;Lm[it.NORTH]=[0,-1],Lm[it.NORTH_EAST]=[-1,-1],Lm[it.EAST]=[-1,0],Lm[it.SOUTH_EAST]=[-1,1],Lm[it.SOUTH]=[0,1],Lm[it.SOUTH_WEST]=[1,1],Lm[it.WEST]=[1,0],Lm[it.NORTH_WEST]=[1,-1];const WSe=200,d9=40,uht=.8,hht=10,C3=1e-6;function dht(t,e,r){const i=e,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(s[a]<=C3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-C3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(i[a]>l){if(s[a]>=-C3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=C3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let pae=class{constructor(e,r,i,s,n){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}},SY=class EG{constructor(e,r,i,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=C(),this.bspNodeTree=new Array;const n=i-r,o=n<=XSe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=yht(e,r,i,s.data,s.stride),l=ye(Math.log2(n/d9),2,hht),c=(h,p,f)=>{const m=mht(o,a,h,p),y=p-h;if(y<=d9){const S=new pae(m,void 0,0,h,p);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=ght(m),w=fht(o,a,h,p,_,v),T=(S,O)=>{if(f>l)return;const A=O-S;return A<d9||A>=uht*y?void 0:c(S,O,f+1)},x=new pae(m,_,v,w.next,w.mid);return this.bspNodeTree.push(x),x.leftNode=T(h,w.next),x.rightNode=T(w.mid,p),x};c(0,n,0),this.triangleVertexIndices=_ht(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],f=h[1],m=h[2];for(let y=e,_=3*e;y<r;++y){let v=i[_++]*n;const w=s[v++],T=s[v++],x=s[v];v=i[_++]*n;const S=s[v++],O=s[v++],A=s[v];v=i[_++]*n;const P=S-w,I=O-T,V=A-x,k=s[v++]-w,B=s[v++]-T,z=s[v]-x,Z=f*z-B*m,W=m*k-z*p,H=p*B-k*f,Y=P*Z+I*W+V*H;if(Math.abs(Y)<=Number.EPSILON)continue;const M=a-w,D=l-T,N=c-x,G=M*Z+D*W+N*H;if(Y>0){if(G<0||G>Y)continue}else if(G>0||G<Y)continue;const X=D*V-I*N,K=N*P-V*M,ee=M*I-P*D,_e=p*X+f*K+m*ee;if(Y>0){if(_e<0||G+_e>Y)continue}else if(_e>0||G+_e<Y)continue;const Le=(k*X+B*K+z*ee)/Y;if(Le>=0){const _t=this.indices[y]+this.firstTriangleIndex,Rt=jX(P,I,V,k,B,z,pht);this._callback(Le,Rt,_t,!1)}}}EG.numFacesTested+=r-e}intersectRay(e,r){EG.numFacesTested=0;const i=Ae(e.r0[0],e.r0[1],e.r0[2]),s=Ae(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<C3)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!dht(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=r,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};SY.numFacesTested=0;const pht=C(),vx=[1/0,1/0,1/0],bx=[-1/0,-1/0,-1/0];function fht(t,e,r,i,s,n){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function mht(t,e,r,i){if(i<=r)return Lb(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[r];for(let n=0;n<3;++n)vx[n]=e[s+0+n],bx[n]=e[s+3+n]}for(let s=r+1;s<i;++s){const n=6*t[s];for(let o=0;o<3;++o)vx[o]=Math.min(vx[o],e[n+0+o]),bx[o]=Math.max(bx[o],e[n+3+o])}return Lb(vx[0],vx[1],vx[2],bx[0],bx[1],bx[2])}function ght(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],s=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function yht(t,e,r,i,s){const n=r-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,h=t[l+1]*s,p=t[l+2]*s;for(let f=0;f<3;++f){const m=i[c+f],y=i[h+f],_=i[p+f];o[6*a+f]=Math.min(m,y,_),o[6*a+3+f]=Math.max(m,y,_)}}return o}function _ht(t,e,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(e[3*a+l],n);const o=n<=XSe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const h=e[l+c];o[3*a+c]=h}}return o}const XSe=65535;let Ls=class extends Lo{constructor(){super(...arguments),this.output=L.Color,this.overlayMode=vg.Disabled,this.tileBlendInput=yf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=rt.Terrain}};u([F({count:L.COUNT})],Ls.prototype,"output",void 0),u([F({count:vg.COUNT})],Ls.prototype,"overlayMode",void 0),u([F({count:yf.COUNT})],Ls.prototype,"tileBlendInput",void 0),u([F()],Ls.prototype,"spherical",void 0),u([F()],Ls.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],Ls.prototype,"receiveShadows",void 0),u([F()],Ls.prototype,"hasSlicePlane",void 0),u([F()],Ls.prototype,"backfaceCullingEnabled",void 0),u([F()],Ls.prototype,"textureFadingEnabled",void 0),u([F()],Ls.prototype,"renderOccluded",void 0),u([F()],Ls.prototype,"hasScreenSpaceReflections",void 0),u([F()],Ls.prototype,"hasCloudsReflections",void 0),u([F()],Ls.prototype,"invisible",void 0),u([F()],Ls.prototype,"tileBorders",void 0),u([F()],Ls.prototype,"visualizeNormals",void 0),u([F()],Ls.prototype,"screenSizePerspective",void 0),u([F()],Ls.prototype,"receiveAmbientOcclusion",void 0),u([F({count:rt.COUNT})],Ls.prototype,"pbrMode",void 0),u([F({constValue:Ar.Compressed})],Ls.prototype,"normalType",void 0),u([F({constValue:Rs.Compressed})],Ls.prototype,"textureCoordinateType",void 0),u([F({constValue:!1})],Ls.prototype,"highStepCount",void 0),u([F({constValue:!1})],Ls.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!1})],Ls.prototype,"useFillLights",void 0);const p9=7,vht=10,f9=an();var dn;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(dn||(dn={}));let Vl=class extends xe{get _isGlobal(){return this._stage.viewingMode===Ie.Global}constructor(e){super(e),this.type=Bi.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ls,this._passParameters=new mSe,this._rctx=null,this._renderDataPool=new No(Jct),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new oSe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=dn.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Ii.Occlude}initialize(){const e=[ce.OPAQUE_TERRAIN,ce.TRANSPARENT_TERRAIN,ce.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),Ylt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===dn.TransparentWithDraped||e===dn.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return R0}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?XN:Ii.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,yt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===yt.TEXTURE_FADING?Ks.FADING:Ks.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[tr.ELEVATION])i.pendingUpdates&=~yt.GEOMETRY;e.resetPendingUpdate(yt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=vht-p9,i=Math.max(0,Math.floor((e.level-r)/p9)*p9);if(this._isGlobal&&i===0)return za;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=ps.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=ps.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=ps.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new cht(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=G0e(this._rctx)}uninitializeRenderContext(){this._emptyTex=Fe(this._emptyTex),this._tileRenderer=Fe(this._tileRenderer)}intersect(e,r,i,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==dn.Opaque)return;const n=bht,o=wht;he(n,s,i),se(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===fo.MIN,p=!!e.results.ground.target,f=CGe(e.verticalOffset),m=e.tolerance;let y,_=h&&a.dist!=null?a.dist:1/0;const v=T=>{const x=T.renderData;if(!(x!=null&&x.vao))return;const S=x.geometry;u5(f9,S.boundingBox);const O=x.localOrigin;f!=null&&(f.localOrigin=O,f.applyToAabb(f9));const A=f9;if(wx[0]=i[0]-O[0],wx[1]=i[1]-O[1],wx[2]=i[2]-O[2],!qX(A,wx,o,m,_))return;const P=(H,Y,M)=>{H.set(this.type,T,Y,M,sn),_=h&&a.dist!=null?a.dist:1/0},I=(H,Y)=>{if(Y!=null&&H>=0&&(e.options.backfacesTerrain||me(Y,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,s,H))){if((c.dist==null||H<c.dist)&&P(c,H,Y),e.options.isFiltered)return;e.options.store===fo.ALL&&(y==null?(y=_X(e.ray),P(y,H,Y),e.results.all.push(y)):H<y.dist&&P(y,H,Y)),(a.dist==null||H<a.dist)&&P(a,H,Y),e.options.store!==fo.MIN&&(l.dist==null||H>l.dist)&&P(l,H,Y)}},V=xht;he(V,s,O);const k=S.indices,B=S.vertexAttributes,z=B.getField(E.POSITION,on),Z=new Ve(z.typedBuffer,3,!1,B.stride/4),W=S.indexCount/3;if(!f&&W>WSe){const H=T.renderData;H.intersectionData==null&&(H.intersectionData=new SY(k,0,W,Z)),H.intersectionData.intersectRay({r0:wx,r1:V},I)}else MR(wx,V,0,W,k,Z,null,f,I)},w=this._rootTiles;w!=null&&(()=>{const T=this._tileIterator;T.reset(w);const x=e.options.invisibleTerrain;for(let S=T.next();S;S=T.next())!(S.visible||x&&S.intersectsClippingArea)||f==null&&!S.intersectsRay(i,n,m,_)||p&&this._useStencilForTile(S)?T.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const s of this._patchGroups.values())for(const n of s)((i=n.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(n);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===ce.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&XN))return null}else{const r=this.transparency===dn.Opaque?ce.OPAQUE_TERRAIN:ce.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case L.Color:return this.transparency===dn.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?vg.Disabled:this._overlayRenderer.hasWater?vg.EnabledWithWater:vg.Enabled,this._updateTechnique(L.Color,e.bindParameters.slot===ce.OCCLUDED_TERRAIN));case L.Shadow:case L.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Shadow,!1)):null;case L.Depth:return this.transparency===dn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Depth,!1));case L.Normal:return this.transparency===dn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Normal,!1));case L.ObjectAndLayerIdColor:return this.transparency===dn.Empty?null:this._updateTechnique(L.ObjectAndLayerIdColor,!1);case L.Highlight:return this.transparency!==dn.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case L.Color:{const s=e.bindParameters.slot===ce.OCCLUDED_TERRAIN?Ma.Occluded:Ma.ColorAndWater;this.transparency===dn.Opaque?this._renderMaterialPass(e,r,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case L.Depth:case L.Normal:this._renderAuxiliaryPass(e,r,Ma.ColorAndWater);break;case L.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,Ma.Highlight);break;case L.Shadow:case L.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,Ma.None);break;case L.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Ma.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:s}=e;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const s=e.rctx;this._passParameters.overlaySource=i,s.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i=null;if(e!=null){const s=ke.toUnitRGBA(e);i=Ae(s[0]||0,s[1]||0,s[2]||0)}r.setBackground(i),this._allTiles.forAll(s=>r.updateTileTexture(s,Ks.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?yf.GridComposite:r.backgroundColor!=null?yf.ColorComposite:yf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==wS.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)aSe(this.renderOrder,i,r);e.sort((i,s)=>lSe(i[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),s=i.renderData;if(!s){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const n=s.localOrigin;let o=this._patchGroups.get(n);o||(o=new Array,this._patchGroups.set(n,o)),o.push(i),(!this._highestVisibleLODTile||i.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;r.program.bindDraw(new j7(o),e.bindParameters,this._passParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,r,n[a],Et.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const s=e.bindParameters.camera,n=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=x1e(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:f,fovY:s.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===Ma.Occluded;a&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",za),n.setUniform4fv("texOffsetAndScale",wf));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:za;this._techniqueConfiguration.tileBlendInput===yf.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Et.LINES:Et.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const p of h.values()){const f=p[0].renderData.localOrigin;r.program.bindDraw(new j7(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of p){const y=m.renderData,_=y.textureReference;if(_!=null){if(!a){n.setUniform4fv("texOffsetAndScale",_.offsetAndScale),n.bindTexture("tex",_.texture.texture);const v=y.textureFadeFactor,w=v<1?y.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&w!=null&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",w.offsetAndScale),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),y.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,r,m,c,o,i),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,s,n,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(rn&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const h=r.program;o===Ma.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,a.overlay),n&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const p=a.geometry.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,p,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(gSe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],Vl.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],Vl.prototype,"_stage",void 0),u([d({readOnly:!0})],Vl.prototype,"_isGlobal",null),u([d({constructOnly:!0})],Vl.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],Vl.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],Vl.prototype,"renderingDisabled",null),u([d()],Vl.prototype,"renderPatchBorders",null),u([d()],Vl.prototype,"visualizeNormals",null),u([d()],Vl.prototype,"cullBackFaces",null),u([d({value:wS.FRONT_TO_BACK})],Vl.prototype,"renderOrder",null),u([d()],Vl.prototype,"wireframe",null),Vl=u([R("esri.views.3d.terrain.TerrainRenderer")],Vl);const bht=C(),wht=C(),wx=C(),xht=C();let Tht=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Zp=class extends xe{constructor(e){super(e),this._handles=new Pi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ue(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Pe(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!sA(r)||r.isRejected())&&!(r.isFulfilled()&&!Sht(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||n4(r)))),e)if(e.isResolved()){const r=GF(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new ic(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===Ie.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=ic.makeWebMercatorAuxiliarySphere(r):y_(e.spatialReference)&&(e=ic.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ue(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ie.Global){const e=this.extentHelper.viewSpatialReference,r=y_(e)||Hf(e)||qf(e);e.isWebMercator?this.tilingScheme=ic.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=ic.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||ab(e,this.extent)||(this.tilingScheme=ic.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Sht(t,e,r){return GF(t,e,r)!=null}u([d()],Zp.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],Zp.prototype,"extent",void 0),u([d({value:!1})],Zp.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],Zp.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],Zp.prototype,"layers",void 0),u([d({constructOnly:!0})],Zp.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],Zp.prototype,"viewingMode",void 0),Zp=u([R("esri.views.3d.terrain.TilingSchemeLogic")],Zp);let Eht=class{constructor(){this.offset=Ue(),this.scale=0,this.tile=null}init(e,r,i,s){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},Wt=class extends Is.EventedMixin(xe){constructor(e){var r,i;super(e),this._scaleRangeQueries=new OL,this._iteratorPool=new No(oSe,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new tct,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new Tht,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new cd,this._frustum=TO(),this._viewProjectionMatrix=ve(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Pi,this._watchUpdatingTracking=new bf,this._frameTask=eS,this._allTiles=new Bt,this._upsampleInfoPool=new No(Eht),this._rootTilesExtent=zt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ge.WebMercator,this.visibleElevationBounds=new JT(1/0,-1/0),this.rootTileElevationBounds=new JT(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Ea({...e,surface:this}),this._isGlobal=!((i=(r=e.view)==null?void 0:r.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=Clt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new No(put):new No(mut);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",o=>o.unloadMapData()),this._elevationQueryCache=new Slt(e.newCache("elevation-query")),this._handles.add([ue(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),ue(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),ue(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new Vl({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Dr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ue(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Ks.UNFADED:Ks.IMMEDIATE)},Cs),ue(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Ks.UNFADED:Ks.IMMEDIATE),Cs),ue(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},Gr),ue(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Cs),ue(()=>this.snapLevel,()=>this._viewChanged=!0,Gr),ue(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),ue(()=>ni.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?ae(()=>import("./TerrainTileTree3DDebugger-702a58a2.js"),["assets/TerrainTileTree3DDebugger-702a58a2.js","assets/TileTreeDebugger-a9368681.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&ni.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Pe(this._treeDebugger))},Vr)]);const{spatialReference:r}=this.view;this._extentHelper=Blt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new oO({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),s=new Zp({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",s),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(pf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(pf.BASEMAP);const n=this.view.resourceController.scheduler;this._frameTask=n.registerTask(dt.TERRAIN_SURFACE,this),this._handles.add([ue(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Vr),ue(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Gr),ue(()=>this.extent,()=>this._updateRootTiles(),Vr),this.view.on("resize",()=>this._viewChangeUpdate()),ue(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Cs),ue(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,Vr),ue(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?rt.Terrain:rt.Disabled,Vr),ue(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Gr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=ki(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Pe(this._upsampleMapCache),this._elevationQueryCache=Pe(this._elevationQueryCache),this._set("tilingSchemeLogic",Pe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Pe(this.overlayManager)),this._tilePool=Pe(this._tilePool),pY.prune(),this._treeDebugger=Pe(this._treeDebugger),this._renderer=Pe(this._renderer),this._iteratorPool=Pe(this._iteratorPool),this._set("view",null),this._extentHelper=Pe(this._extentHelper),this._upsampleInfoPool=Pe(this._upsampleInfoPool),Flt(),Pct()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,r;if(this.lodSnapping===SA.ON){const i=this.view,s=this.tilingScheme,n=(r=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:r.scale;if(s&&n){const o=i.state.contentCamera;let a=uF(i,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=s.levelAtScale(n)-l,h=Math.min(c,this._splitLimits.maxLod||1/0);return h<=0?null:h}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?SA.ON:SA.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(r==null||e==null)return null;const i=zt(),s=F2e(r,i,e)?i:null,n=this._get("extent");return ab(s,n)?n:s}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=qV(this.groundExtent,this._userClippingExtent,zt()),r=this._get("extent");return ab(e,r)?r:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){var e,r;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(e=this._watchUpdatingTracking)!=null&&e.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(r=this.overlayManager)!=null&&r.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var e,r,i;return((i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity)??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}get wireframe(){var e;return(e=this._renderer)==null?void 0:e.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===dn.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,s){this._renderer.intersect(e,r,i,s)}getElevation(e,r,i,s){const n=this._rootTiles;if(n==null||!n.length||n[0].layerInfo[tr.ELEVATION].length===0)return null;const o=rl;return o[0]=e,o[1]=r,o[2]=i,Gs(o,s,o,this._spatialReference)?mae(n,o[0],o[1]):(J.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const s=this._rootTiles,n=s?s[0].layerInfo[tr.ELEVATION].length:0;if(s!=null&&s.length&&n!==0)for(let o=0;o<r;++o){const a=3*o;i(o,mae(s,e[a],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!yo(e,rl,this.spatialReference))return J.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(r!=null){for(const i of r)if(i!=null&&i.containsPoint(rl)){let s=i;for(;s.children[0]&&!s.rendered;){const n=s.children[0].extent;let o=0;rl[0]>n[2]&&(o+=1),rl[1]<n[1]&&(o+=2),s=s.children[o]}return this._getLodBiasCorrectedScale(s.level)}}return 1/0}getSphereElevationBounds(e,r){var a;if(rl[0]=e[0],rl[1]=e[1],rl[2]=e[2],rl[3]=e[3],!Gs(rl,r,rl,(a=this.tilingScheme)==null?void 0:a.spatialReference))return J.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,s=-1/0;const n=l=>{if(l&&uQ(l.extent,rl))if(l.isLeaf||l.rendered)i=Math.min(i,l.elevationBounds[0]),s=Math.max(s,l.elevationBounds[1]);else for(const c of l.children)n(c)},o=this._rootTiles;if(o!=null)for(const l of o)n(l);return{min:i,max:s}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!yo(e,rl,this.spatialReference))return J.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;rl[3]=r;let i=null;const s=o=>{if(o&&uQ(o.extent,rl)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)s(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},n=this._rootTiles;if(n!=null)for(const o of n)s(o);return i}queryVisibleScaleRange(e,r,i,s){const n=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,n+a,o+a,s)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,s=this._allSurfaceLayersTransparent()?r?dn.Empty:dn.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?dn.Opaque:dn.Semitransparent,n=i!==s;return n&&(this._renderer.transparency=s,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){var i,s,n;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;of(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((s=(i=this.view)==null?void 0:i.state)!=null&&s.isLocal),this.tilingScheme&&this._removeAllTiles();const r=(e==null?void 0:e.spatialReference)??Ge.WebMercator;this._spatialReference=r,this._isWebMercator=!!(r!=null&&r.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&rO((n=this.view)==null?void 0:n.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,s){const n=this._tilePool.acquire();return T$[0]=e,T$[1]=r,T$[2]=i,n.init(T$,s,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=Oht;let s=r.rootTilesInExtent(e,i,5*VT);if(this._rootTiles!=null){if(s.length>VT)return void J.getLogger(this).warn(F8e);const n=this._rootTiles.map(a=>a.lij),o=GAe(n,s,fae);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>fae(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,s.length>VT&&(J.getLogger(this).warn(U8e),s=r.rootTilesInExtent(e,i,VT)),this._setRootTiles(s.map(n=>this._newRootTile(n)));ab(i,this._rootTilesExtent)||(this._rootTilesExtent=zt(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(_g);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===yt.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(yt.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(yt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const r=lct(e),i=this.visibleElevationBounds;let s=r?i.min:1/0,n=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(yt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(yt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(s=Math.min(c.elevationBounds[0],s),n=Math.max(c.elevationBounds[1],n))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(s)&&isFinite(n)&&(i.min!==s||i.max!==n)&&(this.visibleElevationBounds=new JT(s,n))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBounds:n})=>{e=Math.min(e,n[0]),r=Math.max(r,n[1])});const s=this.rootTileElevationBounds;s.min===e&&s.max===r||(this.rootTileElevationBounds=new JT(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),s=Math.tan(.5*r.fovY),n=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=s,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=TO()),dN(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,dN(this._frustum,e.frustum),si(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),re(this._eyePosRenderSR,r.eye),Gs(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(ZSe(e)?this._loadChildren(e):Aht(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(yt.TEXTURE_FADING)?yt.TEXTURE_FADING:!!e.resetPendingUpdate(yt.TEXTURE_NOFADING)&&yt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=g9.extent;yc(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>t_(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),g9.spatialReference=this.spatialReference,this.emit("elevation-change",g9)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,s=this._splitLimits,n=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(s,n,i);if(a!==yt.SPLIT){if(o.resetPendingUpdate(yt.SPLIT)&&o.updateAgentSuspension(),a===yt.ELEVATION&&o.updateAgents(tr.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(yt.MERGE),o.resetPendingUpdate(yt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let h=l.next();!l.done;h=l.next())this._updateClippingStatus(h),h.updateVisibility(),h.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(yt.MERGE),o.isLeaf&&(o.setPendingUpdate(yt.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(yt.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(oct(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){we(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea),i=(n,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<n.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(_g);const s=r.length;for(let n=0;n<s;++n){const o=r[n];we(o.isLoaded),we(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,h=p=>{var m;const f=GO[p];i(o,(m=c[p])==null?void 0:m.findCorner(a4(f),y=>y.isLoaded))};for(let p=0;p<4;++p)if(l&1<<p){const f=a.geometryState.neighborData.edgePeerNeighbors[p];f&&(f==null?void 0:f.level)>=o.level&&f.forAllSubtreeOnSide(l4(gf[p]),m=>!(!m.isLoaded||!m.intersectsClippingArea)&&(we(e.has(m)||_g(o,m)<0),i(o,m),!0)),h((p+1)%4),h(p)}}e.clear(),this._updateTilesGeometries(r),rn&&s4&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const s=this.view.state.fixedContentCamera;let n=!1;for(;!e.done;){n=!0;let o=!1;const a=!this._allTiles.some(l=>{var h;if(!i&&!s&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(yt.MERGE)){if(!r)return l.setPendingUpdate(yt.MERGE),e.done;for(;(h=c.parent)!=null&&h.resetPendingUpdate(yt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(yt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(yt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}n?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(yt.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ps.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*D8e}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=ye(e-this._lodBias,0,r.length-1),s=i-Math.floor(i);return r[Math.floor(i)].scale*(1-s)+r[Math.ceil(i)].scale*s}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){of(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],s=2*e.lij[2];e.setChildren(this._createTile(r,i,s,e),this._createTile(r,i,s+1,e),this._createTile(r,i+1,s,e),this._createTile(r,i+1,s+1,e)),e.setPendingUpdate(yt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){S$.spatialReference=this.spatialReference,S$.extent=e.extent,S$.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",S$)}_createTile(e,r,i,s){of(!!s,"_createTile sanity check");const n=this._acquireTile(e,r,i,s);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(yt.SPLIT),n}get shortBatches(){return this.view.state.mode!==$r.IDLE}_mergeTile(e){of(!e.hasPendingUpdate(yt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(of(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){of(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const s=r[i];this._unloadChildren(s),this._unloadTile(s)}}_loadTile(e){e.load(),e.setPendingUpdate(yt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const s=new zlt(e.lij,e.extent,i);e.dataArrived(r,tr.ELEVATION,s);const n=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=Fa){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let s=-1;for(const n of this.view.allLayerViews.items)if(i.add(n.uid),BO(n)||rC(n))if(this._basemapLayerViewHandles.has(n.uid)&&!rC(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<s||s==null)&&(r=!0),s=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((n,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var r,i;let e=((i=(r=this.view.map)==null?void 0:r.ground)==null?void 0:i.opacity)===0;for(const s of this.view.allLayerViews.items)if(lG(s)&&!wde(s.layer)&&s.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((o4(e)||rC(e))&&fct(pG[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return aG(e)?tr.ELEVATION:tr.MAP}_registerTiledLayerView(e){const r=[];if((o4(e)||rC(e))&&r.push(ue(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Ks.UNFADED)})),!rC(e)){const i=this._layerClassFromLayerView(e);r.push(ue(()=>e.suspended,()=>this._updateTiledLayers())),r.push(ue(()=>e.fullOpacity,()=>this._updateTileTextures(Ks.UNFADED))),r.push(ue(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),r.push(e.on("data-changed",()=>{const s=this._getLayerIdxByUID(i,e.uid);s!=null&&this._invalidateLayerData(s,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(const i of r)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(s=>{if(!s.layer||s.suspended||!BO(s)||!s.fullExtent)return;const n=this._layerClassFromLayerView(s);if(n===tr.MAP){const o=s.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[n].push(s)});for(const s of u1){const n=this._layerViews[s],o=r[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let p=0;p<a;p++){const f=o[p].uid;this._layerIndexByUid[s].set(f,p);const m=n.indexOf(o[p]);c[p]=m,p!==m&&(l=!0),m>-1&&(h[m]=p)}if(l){const p=this._postorderIterator;for(p.reset(this._rootTiles);!p.done;)p.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===tr.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(tr.MAP),e===Ks.IMMEDIATE?this.renderer.updateTileTexture(r,yt.TEXTURE_NOFADING):r.updateRenderData(tr.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=ps.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,s){const n=this.layerViewByIndex(r,i),o=n.layer;return!o.tilemapCache||kO(n)?this._requestTileData(e,i,n,s):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...s,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Jt(s),gs(a)||this._dataMissing(e,i,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,n,s),s.signal)))}_requestTileData(e,r,i,s){return r===tr.ELEVATION?aG(i)?this._requestElevationTileData(e,i,s):Promise.reject():lG(i)?this._requestMapTileData(e,i,s):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const s=a=>{if(yn(i))return;const l=this._layerIndexByUid[tr.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):J.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",tr.ELEVATION,e.lij.toString())},n=a=>{gs(a)||(this._dataMissing(e,tr.ELEVATION,r,a),this.requestUpdate())};if(Rne(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:yO,signal:i.signal}).then(a=>{if(!yn(i))return this._frameTask.schedule(()=>s(a),i.signal,n);J.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:yO},i.signal)).then(a=>{a?s(new Elt(a)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const s=(h,p)=>{--this._asyncWorkItems,v2(p),yn(i)||(this._dataMissing(e,tr.MAP,r,h),this.requestUpdate())},n=h=>p=>s(p,h),o=h=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),yn(i)?v2(h):this._mapTileDataArrived(e,r,h)},i.signal,n(h)).catch(n(h)),a=(h,p=null)=>this._frameTask.schedule(()=>s(h,p));if(kO(r)){const h=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(h[0],h[1],h[2],i).then(o,a)}if(BF(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(lY(r)&&Rne(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(h=>{if(yn(i))return J.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Lr());o(h)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);xlt(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const s=this._getLayerIdxByUID(tr.MAP,r.uid);s!=null?e.dataArrived(s,tr.MAP,i):(v2(i),J.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,s){const n=this._getLayerIdxByUID(r,i.uid);n!=null?e.dataMissing(n,r,s):J.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=this.overlayManager.gpuMemoryUsage;const i=this._layerClassFromLayerView(e),s=this._getLayerIdxByUID(i,e.uid);return s!=null&&this._allTiles.forAll(n=>r+=n.getUsedMemoryForLayer(i,s)),r}getTile(e){if(e==null||this._rootTiles==null)return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],s=Math.floor(r[1]/i),n=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===s&&a.lij[2]===n&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return of(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){m9.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&m9.push(i)});const r=m9.toArray();return aSe(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!s4)return;const e=this._rootTiles;if(e==null)return;const r=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometry)==null?void 0:l.indices)==null?void 0:c.length)>0},i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},s=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometry)||(((l=o.renderData.geometry.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),r(o)){o.checkGeometryWaterproofness();for(const c of o.children)i(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)s(c)},n=o=>{var h;const a=((h=o.parent)==null?void 0:h.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const p of o.children)n(p)};for(const o of e)s(o),n(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const s=(i+(i<0?r:0))%r;return[e[0],e[1],s]}enableInternalChecks(e){Gat(e)}enableWaterproofnessChecks(e){Bat(e)}};u([d()],Wt.prototype,"_renderer",void 0),u([d({constructOnly:!0})],Wt.prototype,"_scaleRangeQueries",void 0),u([d({constructOnly:!0})],Wt.prototype,"view",void 0),u([d({constructOnly:!0})],Wt.prototype,"overlayManager",void 0),u([d()],Wt.prototype,"_hasPendingUpdates",void 0),u([d()],Wt.prototype,"_asyncWorkItems",void 0),u([d()],Wt.prototype,"_allTilesDirty",void 0),u([d()],Wt.prototype,"_allTilesSorted",void 0),u([d()],Wt.prototype,"_viewChanged",void 0),u([d()],Wt.prototype,"_splitLimits",void 0),u([d({readOnly:!0})],Wt.prototype,"_watchUpdatingTracking",void 0),u([d()],Wt.prototype,"_frameTask",void 0),u([d({readOnly:!0})],Wt.prototype,"snapLevel",null),u([d({readOnly:!0})],Wt.prototype,"lodSnapping",null),u([d()],Wt.prototype,"_userClippingExtent",null),u([d()],Wt.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],Wt.prototype,"extent",null),u([d({readOnly:!0})],Wt.prototype,"groundExtent",null),u([d({readOnly:!0})],Wt.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],Wt.prototype,"updating",null),u([d({readOnly:!0})],Wt.prototype,"running",null),u([d(Ult)],Wt.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],Wt.prototype,"updatingProgressValue",null),u([d()],Wt.prototype,"_maxNumUpdating",void 0),u([d()],Wt.prototype,"baseOpacity",null),u([d()],Wt.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],Wt.prototype,"viewingMode",null),u([d()],Wt.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],Wt.prototype,"ready",null),u([d({value:wS.FRONT_TO_BACK})],Wt.prototype,"renderOrder",null),u([d({readOnly:!0})],Wt.prototype,"rootTiles",null),u([d()],Wt.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],Wt.prototype,"spatialReference",null),u([d({type:ke})],Wt.prototype,"backgroundColor",null),u([d({value:!1})],Wt.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],Wt.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],Wt.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],Wt.prototype,"tilingSchemeLogic",void 0),u([d()],Wt.prototype,"wireframe",null),u([d({value:!1})],Wt.prototype,"suspended",null),u([d()],Wt.prototype,"textureFadeDuration",null),u([d()],Wt.prototype,"visibleElevationBounds",void 0),u([d()],Wt.prototype,"rootTileElevationBounds",void 0),u([d()],Wt.prototype,"_layerViewsDirty",void 0),u([d()],Wt.prototype,"renderPatchBorders",null),u([d()],Wt.prototype,"visualizeNormals",null),u([d()],Wt.prototype,"renderingDisabled",null),Wt=u([R("esri.views.3d.terrain.TerrainSurface")],Wt);const Cht=Wt;function fae(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ZSe(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(ZSe(r))return!0;return!1}function Aht(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const rl=Zt(),Oht=zt(),T$=[0,0,0],m9=new Bt,g9={spatialReference:null,extent:zt(),context:"ground"},S$={spatialReference:null,extent:null,scale:0};function mae(t,e,r){var i;for(const s of t){if(!s.containsPointXY(e,r))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(r<n.extentMidY?2:0);n=n.children[a]}const o=((i=n==null?void 0:n.renderData)==null?void 0:i.geometryState.samplerData)??null;return Xi(e,r,o)}return null}let Rht=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},A3=class extends xe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},h)=>{let p=!1;if(l===qi.UPDATE){const f=o.get(h);if(f){if(c&fn.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(p=!0)}p||r.updates.push({renderGeometry:f,updateType:c})}else tt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===qi.REMOVE||p){const f=o.get(h);f?(r.removes.push(f),o.delete(h)):l===qi.REMOVE&&tt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===qi.ADD||p){const f=this.model.getObject(n);if(f!=null){const m=this.model.getRenderGeometry(f,a);r.adds.push(m),o.set(h,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(s=>s.forEach(n=>r.push(n)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,qi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(fn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(fn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(fn.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,qi.UPDATE,fn.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryAdded(r,s,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const s of r.geometries)this._objectGeometryRemoved(r,s,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,r,qi.UPDATE,fn.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,qi.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,qi.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,s,n=fn.NONE){i=i??this._getParentLayerId(e);const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const h=c.operation;h===qi.REMOVE&&s===qi.ADD&&c.states!==fn.NONE?c.operation=qi.UPDATE:h===qi.REMOVE&&s===qi.ADD||h===qi.ADD&&s===qi.REMOVE?l.delete(a):h!==qi.UPDATE||s!==qi.REMOVE&&s!==qi.UPDATE?(tt((h===qi.REMOVE||h===qi.ADD)&&s===qi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(a,new Rht(s,r,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}get _hasDirtyGeometryRecords(){return $o(this._dirtyGeomRecords,e=>$o(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let s=i.get(r);return s||(s=new Map,i.set(r,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:kOe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,s)=>{i.forEach((n,o)=>{r.length>0&&(r+=`
`),r+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,s)=>e.commitLayer(s,r))}}};u([d({constructOnly:!0})],A3.prototype,"model",void 0),u([d()],A3.prototype,"dirty",void 0),A3=u([R("esri.views.3d.webgl-engine.lib.ModelDirtySet")],A3);const Pht=A3;let PL=class extends xe{constructor(){super(...arguments),this.dirtySet=new Pht({model:this}),this._content=new Map,this._originFactory=new EZ(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;tt(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),jN(e)&&this.dirtySet.layerAdded(e)}remove(e){tt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),jN(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)r!=null&&(tt(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)tt(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:s}=r,n=new bS(r,{shaderTransformer:i,castShadow:e.castShadow});return n.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),n.localOrigin=s??this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.updateTransformation(n=>e.getCombinedStaticTransformation(r,n));const s=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==s}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<os.COUNT;++i)e[i]=r.filter(s=>s.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],PL.prototype,"dirtySet",void 0),PL=u([R("esri.views.3d.webgl-engine.parts.Model")],PL);function YSe(){const t=new Float32Array(4);return t[3]=1,t}function JSe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Mht(t,e,r,i){const s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s}function QSe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:JSe,create:YSe,createView:QSe,fromValues:Mht},Symbol.toStringTag,{value:"Module"}));const xS=1e-6,aC=[0,0,0],E$=[0,0,0];function $ht(t,e){const{data:r,size:i}=t,s=r.length/i;if(s<=0)return;const n=new kht(t);ML(aC,n.minProj,n.maxProj),j1(aC,aC,.5),th(E$,n.maxProj,n.minProj);const o=CG(E$),a=new Bht;a.quality=o,s<14&&(t=new Ve(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(Iht(n,t,y,l,c,h,p,f,m,a)){case 1:return void vae(aC,E$,e);case 2:return void zht(t,p,e)}Lht(t,y,l,c,h,p,f,m,a),KSe(t,a.b0,a.b1,a.b2,x2,T2);const _=[0,0,0];th(_,T2,x2),a.quality=CG(_),a.quality<o?eEe(a.b0,a.b1,a.b2,x2,T2,_,e):vae(aC,E$,e)}function Iht(t,e,r,i,s,n,o,a,l,c){return Dht(t,i,s),AG(i,s)<xS?1:(th(o,i,s),Ao(o,o),Nht(e,i,o,n)<xS?2:(th(a,s,n),Ao(a,a),th(l,n,i),Ao(l,l),rh(r,a,o),Ao(r,r),h1(e,r,o,a,l,c),0))}const lC=[0,0,0],cC=[0,0,0],wu=[0,0,0],xu=[0,0,0],Tu=[0,0,0],Ry=[0,0,0],Py=[0,0,0],My=[0,0,0];function Lht(t,e,r,i,s,n,o,a,l){Fht(t,e,r,lC,cC),lC[0]!==void 0&&(th(wu,lC,r),Ao(wu,wu),th(xu,lC,i),Ao(xu,xu),th(Tu,lC,s),Ao(Tu,Tu),rh(Ry,xu,n),Ao(Ry,Ry),rh(Py,Tu,o),Ao(Py,Py),rh(My,wu,a),Ao(My,My),h1(t,Ry,n,xu,wu,l),h1(t,Py,o,Tu,xu,l),h1(t,My,a,wu,Tu,l)),cC[0]!==void 0&&(th(wu,cC,r),Ao(wu,wu),th(xu,cC,i),Ao(xu,xu),th(Tu,cC,s),Ao(Tu,Tu),rh(Ry,xu,n),Ao(Ry,Ry),rh(Py,Tu,o),Ao(Py,Py),rh(My,wu,a),Ao(My,My),h1(t,Ry,n,xu,wu,l),h1(t,Py,o,Tu,xu,l),h1(t,My,a,wu,Tu,l))}function Dht(t,e,r){let i=AG(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=AG(t.maxVert[n],t.minVert[n]);o>i&&(i=o,s=n)}uc(e,t.minVert[s]),uc(r,t.maxVert[s])}const Su=[0,0,0];function Nht(t,e,r,i){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Su[0]=s[l]-e[0],Su[1]=s[l+1]-e[1],Su[2]=s[l+2]-e[2];const c=r[0]*Su[0]+r[1]*Su[1]+r[2]*Su[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=Su[0]*Su[0]+Su[1]*Su[1]+Su[2]*Su[2]-c*c/h;p>o&&(o=p,a=l)}return uc(i,s,a),o}const pn=[0,0];function Fht(t,e,r,i,s){Vht(t,e,pn,s,i);const n=rEe(r,e);pn[1]-xS<=n&&(i[0]=void 0),pn[0]+xS>=n&&(s[0]=void 0)}const gae=[0,0,0],yae=[0,0,0],_ae=[0,0,0],xx=[0,0,0],Tx=[0,0,0],C$=[0,0,0];function h1(t,e,r,i,s,n){if(tEe(e)<xS)return;rh(gae,r,e),rh(yae,i,e),rh(_ae,s,e),w2(t,e,pn),Tx[1]=pn[0],xx[1]=pn[1],C$[1]=xx[1]-Tx[1];const o=[r,i,s],a=[gae,yae,_ae];for(let l=0;l<3;++l){w2(t,o[l],pn),Tx[0]=pn[0],xx[0]=pn[1],w2(t,a[l],pn),Tx[2]=pn[0],xx[2]=pn[1],C$[0]=xx[0]-Tx[0],C$[2]=xx[2]-Tx[2];const c=CG(C$);c<n.quality&&(uc(n.b0,o[l]),uc(n.b1,e),uc(n.b2,a[l]),n.quality=c)}}const Uht=[0,0,0];function w2(t,e,r){const{data:i,size:s}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*e[0]+i[n+1]*e[1]+i[n+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function Vht(t,e,r,i,s){const{data:n,size:o}=t;uc(i,n),uc(s,i),r[0]=rEe(Uht,e),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<r[0]&&(r[0]=l,uc(i,n,a)),l>r[1]&&(r[1]=l,uc(s,n,a))}}function vae(t,e,r){uc(r.center,t),j1(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const ym=[0,0,0],Sx=[0,0,0],uC=[0,0,0],x2=[0,0,0],T2=[0,0,0],bae=[0,0,0];function zht(t,e,r){uc(ym,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?ym[0]=0:Math.abs(e[1])>Math.abs(e[2])?ym[1]=0:ym[2]=0,tEe(ym)<xS&&(ym[0]=ym[1]=ym[2]=1),rh(Sx,e,ym),Ao(Sx,Sx),rh(uC,e,Sx),Ao(uC,uC),KSe(t,e,Sx,uC,x2,T2),th(bae,T2,x2),eEe(e,Sx,uC,x2,T2,bae,r)}function KSe(t,e,r,i,s,n){w2(t,e,pn),s[0]=pn[0],n[0]=pn[1],w2(t,r,pn),s[1]=pn[0],n[1]=pn[1],w2(t,i,pn),s[2]=pn[0],n[2]=pn[1]}const A$=[0,0,0],Pp=[1,0,0,0,1,0,0,0,1],Ex=[0,0,0];function eEe(t,e,r,i,s,n,o){Pp[0]=t[0],Pp[1]=t[1],Pp[2]=t[2],Pp[3]=e[0],Pp[4]=e[1],Pp[5]=e[2],Pp[6]=r[0],Pp[7]=r[1],Pp[8]=r[2],Ght(o.quaternion,Pp),ML(Ex,i,s),j1(Ex,Ex,.5),j1(o.center,t,Ex[0]),j1(A$,e,Ex[1]),ML(o.center,o.center,A$),j1(A$,r,Ex[2]),ML(o.center,o.center,A$),j1(o.halfSize,n,.5)}const Rc=7;let kht=class{constructor(e){this.minVert=new Array(Rc),this.maxVert=new Array(Rc);const r=64*Rc;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Rc),i+=8*Rc,this.maxProj=new Float64Array(this.buffer,i,Rc),i+=8*Rc;for(let l=0;l<Rc;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Rc;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Rc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Rc),n=new Array(Rc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Rc;++l){let c=s[l];uc(this.minVert[l],o,c),c=n[l],uc(this.maxVert[l],o,c)}}},Bht=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function CG(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function ML(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function th(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function j1(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function uc(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function rh(t,e,r){const i=e[0],s=e[1],n=e[2],o=r[0],a=r[1],l=r[2];t[0]=s*l-n*a,t[1]=n*o-i*l,t[2]=i*a-s*o}function Ao(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function tEe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function AG(t,e){const r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return r*r+i*i+s*s}function rEe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ght(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*n+n]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+i]+e[3*i+s])*o,t[n]=(e[3*n+i]+e[3*i+n])*o}}const xb=Rh(),Pa=C(),OG=C(),jht=Ni();let ODt=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:aq(this.buffer,56*a+0),halfSize:Q0e(this.buffer,56*a+24),quaternion:QSe(this.buffer,56*a+36)}}};function EY(t=[0,0,0],e=[-1,-1,-1],r=Rh()){return{center:Ms(t),halfSize:uN(e),quaternion:JSe(r)}}function wae(t){return EY(t.center,t.halfSize,t.quaternion)}function PDt(t,e){re(e.center,t.center),re(e.halfSize,t.halfSize),AR(e.quaternion,t.quaternion)}function iEe(t,e){return e=e||EY(),$ht(t,e),e}function d1(t,e){const r=pi(e,t.center),i=XF(t,e);return r>i?1:r<-i?-1:0}function MDt(t,e){return Pa[0]=t.center[0]-e[0],Pa[1]=t.center[1]-e[1],Pa[2]=t.center[2]-e[2],Uf(xb,t.quaternion),pc(Pa,Pa,xb),PD(Pa,Pa),hq(OG,Pa,t.halfSize),Y4(OG,Pa)<e[3]*e[3]}function $Dt(t,e){e||(e=an());const r=G5(jht,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),s=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),n=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-s,e[2]=t.center[2]-n,e[3]=t.center[0]+i,e[4]=t.center[1]+s,e[5]=t.center[2]+n,e}function IDt(t,e){return pi(e,t.center)-XF(t,e)}function LDt(t,e){return pi(e,t.center)+XF(t,e)}function DDt(t,e){return d1(t,e[0])<=0&&d1(t,e[1])<=0&&d1(t,e[2])<=0&&d1(t,e[3])<=0&&d1(t,e[4])<=0&&d1(t,e[5])<=0}function NDt(t,e,r,i=0){Uf(xb,t.quaternion),he(Pa,e,t.center);const s=pc(Pa,Pa,xb),n=pc(OG,r,xb);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+t.halfSize[l]-s[l])/n[l],h=(-i-t.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>t.halfSize[l]+i||s[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function XF(t,e){Uf(xb,t.quaternion),pc(Pa,e,xb);const r=t.halfSize;return Math.abs(Pa[0]*r[0])+Math.abs(Pa[1]*r[1])+Math.abs(Pa[2]*r[2])}function sEe(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],pc(i,i,t.quaternion),le(i,i,t.center)}}function Hht(t){return Zl(t.halfSize)}function qht(t,e,r,i,s){if(AR(s.quaternion,t.quaternion),i===Ie.Global){Uf(O$,t.quaternion),pc($y,t.center,O$),PD(Cx,$y),hq(Ax,Cx,t.halfSize),_n(Ax,Cx,Ax);const n=Ee(Ax);le(Ax,Cx,t.halfSize);const o=Ee(Ax);if(n<r)re(s.center,t.center),se($y,r,r,r),le(s.halfSize,t.halfSize,$y);else{const a=o>0?1+e/o:1,l=n>0?1+r/n:1,c=(l+a)/2,h=(l-a)/2;ie(s.halfSize,Cx,h),X1(s.halfSize,s.halfSize,t.halfSize,c),ie(s.center,Cx,c),X1(s.center,s.center,t.halfSize,h),Ide($y,$y),Z4(s.center,s.center,$y),pc(s.center,s.center,s.quaternion)}}else{const n=se($y,0,0,1);X1(s.center,t.center,n,(r+e)/2),Uf(O$,t.quaternion),pc(n,n,O$),PD(n,n),X1(s.halfSize,t.halfSize,n,(r-e)/2)}return s}const $y=C(),Cx=C(),Ax=C(),O$=Rh();let Wht=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Xht(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!e(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=e[n],l=e[o];r[s]=a,r[s+1]=l-a}return r}};function Xht(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let s=1;s<t.length;s++){const n=t[s];r+i===n?i+=1:(e.push(r),e.push(i),r=n,i=1)}return e.push(r),e.push(i),e}let Zht=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new Wht(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=Yht(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function Yht(t,e,r){const i=[],s=[];let n=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let O3=class extends xe{constructor(){super(...arguments),this.visible=S2.Hidden}};var S2;u([d({autoDestroy:!0})],O3.prototype,"renderable",void 0),u([d({autoDestroy:!0})],O3.prototype,"components",void 0),O3=u([R("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],O3),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(S2||(S2={}));function Jht(t,e,r,i){if(r>=e)return t;t==null&&(t=Qht());const s=t.isVisibleBit;let n=t.data;const o=oEe(n),a=r/o|0,l=r-o*a,c=(e-1)/o|0,h=n,p=i===s;if(!(r<h.length*o)&&p){const f=a+1,m=Math.ceil(h.length*$4),y=c+1;let _=Math.max(f,m);_=Math.min(_,y),n=new Uint32Array(_),n.set(h)}return a<n.length&&(n[a]=edt(n[a],l,p)),t.data=n,t}function nEe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,s=oEe(i);return e<i.length*s?Kht(r,i,e,s):!t.isVisibleBit}function Qht(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function Kht(t,e,r,i){const s=r/i|0,n=r-s*i;return tdt(e[s],n)===t}function oEe(t){return t.BYTES_PER_ELEMENT*8}function edt(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function tdt(t,e){return(t&1<<e)!=0}let rdt=class{constructor(e,r){this._components=r,this._indices=e.indices!=null?Ef(e.indices):oS(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,s,n,o,a){const l=new Ve(this._positions,3,!1,3),c=this._indices,h=this._components.offsets,p=U1e(e,r,idt),f=e[2],m=r[2];this._components.visibility.forEachComponent(y=>{if(!nEe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,sdt);if(o!=null){const x=o[y];n!=null?n.componentOffset=x:(e[2]=f-x,r[2]=m-x)}if(n!=null&&n.applyToAabb(_),!HX(_,e,p,i))return!0;const v=h[y]/3,w=h[y+1]/3,T=(x,S,O)=>a(y,x,ac(S,S,s),O);return n==null&&w-v>WSe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new SY(this._indices,v,w,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:r},T)):MR(e,r,v,w,c,l,void 0,n,T),!0})}_computePerComponentAabbs(){const e=this._components.count,r=Ji(6*e),i=this._indices,s=this._positions,n=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const w=3*i[v],T=s[w],x=s[w+1],S=s[w+2];h=Math.min(h,T),p=Math.min(p,x),f=Math.min(f,S),m=Math.max(m,T),y=Math.max(y,x),_=Math.max(_,S)}r[o++]=h,r[o++]=p,r[o++]=f,r[o++]=m,r[o++]=y,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}};const idt=C(),sdt=an();let ndt=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},odt=class{constructor(e,r,i,s){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}},adt=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function ldt(t,e){return{near:t,far:e}}function qR(t){return t?HO(t,1/0,-1/0):ldt(1/0,-1/0)}function HO(t,e,r){return t.near=e,t.far=r,t}function TS(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function R$(t,e){return t.near<=e&&e<=t.far}const RG={near:0,far:0};function cdt(t,e){const r=qR(),{eye:i,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=me(_n(Lc,a.center,i),n),c=XF(a,n);if(R$(r,l-c)&&R$(r,l+c))return;const h=fdt(a,s);if(h===-1)return;if(h===0)return _m.far=l+c,_m.near=l-c,void TS(r,_m);const p=P$.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<P$.length;o++){const a=P$.data[o];if(R$(r,a.near)&&R$(r,a.far))continue;_m.far=a.far,_m.near=1/0,pdt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,udt,c=>{let h=hdt;for(let p=0;p<aEe&&c.length>0;p++){if(!(a.mask&1<<p))continue;ddt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){se(dl,c.data[p],c.data[p+1],c.data[p+2]);const f=me(_n(dl,dl,i),n);_m.near=Math.min(_m.near,f)}})===0&&(_m.near=0),TS(r,_m)}return P$.length=0,r}const P$=new Bt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=CS(t.object),t)}),_m=qR(),dl=C(),Ov=C(),udt=new Bt({deallocator:null}),hdt=new Bt({deallocator:null});function ddt(t,e,r){r.length=0;const i=e.length-3;y9(dl,e,i);const s=pi(t,dl);s<=0&&(r.push(dl[0]),r.push(dl[1]),r.push(dl[2]));let n=0,o=s;for(;n<i;n+=3){y9(Ov,e,n);const a=pi(t,Ov);o*a<0&&(Br(dl,Ov,dl,a/(a-o)),pl(r,dl)),a<=0&&pl(r,Ov),o=a,re(dl,Ov)}o*s<0&&(y9(Ov,e,i),Br(dl,Ov,dl,s/(s-o)),pl(r,dl))}function y9(t,e,r){return se(t,e.data[r],e.data[r+1],e.data[r+2])}function pl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function pdt(t,e,r,i){Uf(Tae,t.quaternion),_n(Lc,e,t.center),pc(Lc,Lc,Tae);const s=8*((Lc[0]<-t.halfSize[0]?-1:Lc[0]>t.halfSize[0]?1:0)+3*(Lc[1]<-t.halfSize[1]?-1:Lc[1]>t.halfSize[1]?1:0)+9*(Lc[2]<-t.halfSize[2]?-1:Lc[2]>t.halfSize[2]?1:0)+13),n=xae[s];if(n===0)return n;G5(M$,t.quaternion),QW(M$,M$,t.halfSize);const o=(a,l)=>{const c=xae[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),ac(a,a,M$),le(a,t.center,a)};return r.length=0,pl(r,o(_9,0)),pl(r,o(Sae,1)),pl(r,o(Lc,2)),pl(r,o(Eae,3)),i(r),n===1||(r.length=0,pl(r,_9),pl(r,Eae),pl(r,o(Lc,4)),pl(r,o(Cae,5)),i(r),n===2||(r.length=0,pl(r,_9),pl(r,Cae),pl(r,o(Lc,6)),pl(r,Sae),i(r))),n}const xae=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let s=0;s<i.length;s++)t[e+s]=i[s];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),aEe=4;function fdt(t,e){let r=0;for(let i=0;i<aEe;i++){const s=d1(t,e[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const M$=Ni(),Tae=Rh(),Lc=C(),_9=C(),Sae=C(),Eae=C(),Cae=C();let mdt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?cdt(e,this._objects.visibleObjects):null}};function gdt(t){const e=ji().vec3f(E.POSITION);return t.normals&&e.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Rs.Default?e.vec2f(E.UV0):t.textureCoordinates===Rs.Atlas&&(e.vec2f(E.UV0),e.vec4u16(E.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(E.COLOR,{glNormalized:!0}),e}let ydt=class{constructor(){this.externalColor=Zt(),this.externalColorMixMode=Fs.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},_dt=class extends ls{constructor(e,r){super(e,"int",Jr.Draw,(i,s,n)=>i.setUniform1i(e,r(s,n)))}};var Of;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Of||(Of={}));const CY=429496.7296;function lEe(t,e){MO(t/CY*.5+.5,e)}function vdt(t,e){switch(e.componentData){case Of.Varying:return bdt(t,e);case Of.Uniform:return wdt(t);case Of.COUNT:return;default:e.componentData}}function bdt(t,e){const{vertex:r,fragment:i}=t;r.include(wc),r.uniforms.add(new uh("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(E.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===L.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(Zxe),r.constants.add("elevationScale","float",2*CY),r.constants.add("stride","float",oe("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(b`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(b`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?b`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:b`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(b`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?b`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function wdt(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new c4("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new _dt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(b`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(b`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var nh;function xdt(t,e){const r=t.vertex;switch(r.code.add(b`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case nh.None:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) {}`);break;case nh.Opaque:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case nh.Transparent:r.code.add(b`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(nh||(nh={}));var Rf;function WDt(t){return t&&Hf(t)?Rf.Mars:t&&qf(t)?Rf.Moon:Rf.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Rf||(Rf={}));var Xc;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Xc||(Xc={}));let lr=class extends ca{constructor(){super(...arguments),this.output=L.Color,this.textureCoordinateType=Rs.None,this.componentData=Of.Uniform,this.cullFace=mi.Back,this.vertexDiscardMode=nh.None,this.doubleSidedMode=Qi.WindingOrder,this.alphaDiscardMode=Xr.Opaque,this.integratedMeshMode=Xc.None,this.transparencyPassType=st.NONE,this.ellipsoidMode=Rf.Earth,this.pbrMode=rt.Disabled,this.normalType=Ar.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};u([F({count:L.COUNT})],lr.prototype,"output",void 0),u([F({count:Rs.COUNT})],lr.prototype,"textureCoordinateType",void 0),u([F({count:Of.COUNT})],lr.prototype,"componentData",void 0),u([F({count:mi.COUNT})],lr.prototype,"cullFace",void 0),u([F({count:nh.COUNT})],lr.prototype,"vertexDiscardMode",void 0),u([F({count:Qi.COUNT})],lr.prototype,"doubleSidedMode",void 0),u([F({count:Xr.COUNT})],lr.prototype,"alphaDiscardMode",void 0),u([F({count:Xc.COUNT})],lr.prototype,"integratedMeshMode",void 0),u([F({count:st.COUNT})],lr.prototype,"transparencyPassType",void 0),u([F({count:Rf.COUNT})],lr.prototype,"ellipsoidMode",void 0),u([F({count:rt.COUNT})],lr.prototype,"pbrMode",void 0),u([F({count:Ar.COUNT})],lr.prototype,"normalType",void 0),u([F()],lr.prototype,"spherical",void 0),u([F()],lr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],lr.prototype,"hasVertexColors",void 0),u([F()],lr.prototype,"hasNormals",void 0),u([F()],lr.prototype,"hasSlicePlane",void 0),u([F()],lr.prototype,"hasBaseColorTexture",void 0),u([F()],lr.prototype,"receiveAmbientOcclusion",void 0),u([F()],lr.prototype,"receiveShadows",void 0),u([F()],lr.prototype,"blendingEnabled",void 0),u([F()],lr.prototype,"hasScreenSpaceReflections",void 0),u([F()],lr.prototype,"hasPolygonOffset",void 0),u([F()],lr.prototype,"hasMetallicRoughnessTexture",void 0),u([F()],lr.prototype,"hasEmissionTexture",void 0),u([F()],lr.prototype,"hasOcclusionTexture",void 0),u([F()],lr.prototype,"hasNormalTexture",void 0),u([F()],lr.prototype,"hasOccludees",void 0),u([F()],lr.prototype,"hasMultipassTerrain",void 0),u([F()],lr.prototype,"cullAboveGround",void 0),u([F()],lr.prototype,"hasCloudsReflections",void 0),u([F()],lr.prototype,"snowCover",void 0),u([F()],lr.prototype,"objectAndLayerIdColor",void 0),u([F({constValue:Jr.Draw})],lr.prototype,"pbrTextureBindType",void 0),u([F({constValue:!0})],lr.prototype,"hasSliceHighlight",void 0),u([F({constValue:!1})],lr.prototype,"hasSliceInVertexProgram",void 0),u([F({constValue:!1})],lr.prototype,"useCustomDTRExponentForWater",void 0),u([F({constValue:!1})],lr.prototype,"hasVertexTangents",void 0),u([F({constValue:!0})],lr.prototype,"supportsTextureAtlas",void 0),u([F({constValue:!1})],lr.prototype,"highStepCount",void 0),u([F({constValue:!1})],lr.prototype,"instancedDoublePrecision",void 0),u([F({constValue:!0})],lr.prototype,"useFillLights",void 0),u([F({constValue:!1})],lr.prototype,"objectAndLayerIdColorInstanced",void 0);function Aae(t,e){t.include(Ew,e),t.fragment.include(UO);const r=t.fragment;r.uniforms.add(new c4("baseColor",i=>i.baseColor)),r.uniforms.add(new _b("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(b`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(b`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(b`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Oae(t,e){const r=t.fragment;switch(e.doubleSidedMode){case Qi.None:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Qi.View:t.include(c2,e),r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Qi.WindingOrder:r.code.add(b`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Qi.COUNT:}switch(e.normalType){case Ar.Attribute:case Ar.Compressed:t.include(MF,e),r.code.add(b`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ar.ScreenDerivative:t.include(c2,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ar.Ground:e.spherical?(t.include(c2,e),r.code.add(b`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(b`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(b`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Ar.COUNT:}}function Tdt(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===L.Color||e.alphaDiscardMode!==Xr.Opaque)){t.include(jW,e);const i=e.textureCoordinateType===Rs.Atlas;r.uniforms.add(new uh("baseColorTexture",s=>s.texture)),i?(t.include(H0e),r.code.add(b`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(b`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(b`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Sdt(t){const e=new br;e.include(c2,t),e.include(MF,t),e.include(Ew,t),e.include(Tf,t),e.include(XS,t),e.include(vdt,t),e.include(RKe,t),e.include(rXe,t),e.include(Tdt,t),e.include(xdt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==rt.Normal&&t.pbrMode!==rt.Schematic||(e.include(qW,t),t.hasNormalTexture&&e.include(Kxe,t));const s=t.output===L.Shadow||t.output===L.ShadowHighlight||t.output===L.ShadowExcludeHighlight;s&&t.componentData===Of.Varying?r.code.add(b`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(b`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===Xc.ColorOverlay||t.integratedMeshMode===Xc.ColorOverlayWithWater,o=n&&t.output===L.Color&&t.pbrMode===rt.WaterOnIntegratedMesh;return n&&(e.include(Jb,t),e.include(Bct,t),t.spherical?r.code.add(b`
      const float invEllipsoidRadius = ${b.float(1/(t.ellipsoidMode===Rf.Earth?ir.radius:t.ellipsoidMode===Rf.Mars?_f.radius:Sg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(b`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(b`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===L.ObjectAndLayerIdColor?b`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${b.float(co)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===L.ObjectAndLayerIdColor?b`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?b`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:b`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?b`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===L.Alpha&&(i.include(hu),e.include(du,t),e.include(Aae,t),n&&i.uniforms.add(new Je("ovColorTex",(a,l)=>mG(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===L.Color&&(i.include(hu),e.include(du,t),e.include(Aae,t),e.include(Oae,t),e.include(Jb,t),t.receiveShadows?(e.include($F,t),i.code.add(b`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(b`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new Je("ovColorTex",(a,l)=>mG(a,l))),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?b`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?b`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===rt.Normal||t.pbrMode===rt.Schematic?(Yf(i),i.code.add(b`
        ${t.pbrMode===rt.Normal?b`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(b`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(b`vec3 shadingNormal = normalVertex;`),i.code.add(b`${t.spherical?b`vec3 normalGround = normalize(positionWorld());`:b`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(b`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?b`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(b`float shadow = evaluateShadow();`):t.spherical?(iE(i),i.code.add(b`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(b`float shadow = 0.0;`),o&&i.uniforms.add(new Je("ovNormalTex",(a,l)=>AY(l))),t.snowCover&&i.code.add(b`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(b`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?b` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?b`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(b`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===st.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===L.Depth||s)&&(e.include(Dg,t),i.code.add(b`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===L.Normal&&(e.include(Oae,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===Ar.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===L.ObjectAndLayerIdColor&&e.fragment.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===L.Highlight&&(e.include(Xg,t),i.code.add(b`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?b`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function AY(t){return t.overlays.length===0?null:t.overlays[$i.INNER].getValidTexture(is.Water)}const Edt=Object.freeze(Object.defineProperty({__proto__:null,build:Sdt,getOverlayNormalTexture:AY},Symbol.toStringTag,{value:"Module"}));let cEe=class uEe extends Rr{initializeConfiguration(e,r){r.spherical=e.viewingMode===Ie.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Er(e.rctx,uEe.shader.get().build(this.configuration),hEe)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==Xc.None,s=e===st.NONE,n=e===st.FrontFace;return Ot({blending:r.output!==L.Color&&r.output!==L.Alpha||!r.blendingEnabled?null:s?su:Zg(e),culling:B5(r.cullFace),depthTest:{func:V_(e)},depthWrite:s||n?El:null,colorWrite:Gt,stencilWrite:i||r.hasOccludees?zf:null,stencilTest:i?oQe(wl.IntegratedMeshMaskExcluded):r.hasOccludees?z_:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:_F})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};cEe.shader=new Sr(Edt,()=>ae(()=>import("./ComponentShader.glsl-7e08dbcd.js"),[]));const hEe=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.COLOR,2],[E.UV0,3],[E.UVREGION,4],[E.COMPONENTINDEX,5]]);let Cdt=class extends Kr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},OY=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function ts(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(n){const o=this[i];if(o==null)this[i]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(s){this[i]!==s&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function Rae(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let ZF=class{constructor(e){this._low=C(),this._high=C(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){re(this._low,re(Pae,e));const r=_n(Pae,e,this._low);re(this._high,r)}get(e){return le(e,this._low,this._high)}getLowScaled(e){return ie(e,this._low,1)}};const Pae=ss();let Pn=class extends Cdt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Nt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ia(LF),this.emissiveFactor=Ae(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new $L,this.componentParameters=new GA,this.textureAlphaCutoff=VN,this.alphaDiscardMode=Xr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Rf.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new lr;const i=new ZF(e.position),s=eTe(e.rotationScale);bw(s,s),this.transformNormalGlobalFromModel=Tge(Sh(s,s)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=ki(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=r.identifier===nc.Material&&i.transparencyPassType!=null?i.transparencyPassType:st.NONE,n.hasMultipassTerrain=r.identifier===nc.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===nc.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Qi.View:Qi.None,n.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Oa.Transparent||o===Oa.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Odt(i)?AY(i)?Xc.ColorOverlayWithWater:Xc.ColorOverlay:Xc.NoOverlay:Xc.None,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(n.pbrMode=n.integratedMeshMode===Xc.ColorOverlayWithWater?rt.WaterOnIntegratedMesh:this.usePBR?a?rt.Schematic:rt.Normal:rt.Disabled,n.normalType=n.integratedMeshMode===Xc.None?n.hasNormals?Ar.Compressed:Ar.ScreenDerivative:Ar.Ground,n.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===nc.ShadowMap)n.output=L.Shadow,n.vertexDiscardMode=nh.None;else if(r.identifier===nc.Highlight)n.output=L.Highlight,n.vertexDiscardMode=nh.None;else{switch(this._computeWhichMaterialPass()===Oa.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?nh.Opaque:nh.Transparent:n.vertexDiscardMode=nh.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case L.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=i.cloudsFade.data!=null;break;case L.Alpha:n.hasOccludees=i.hasOccludees;break;case L.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(cEe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Oa.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Oa.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Oa.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Oa.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),Adt(r)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==gn.None;h&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),h&&e.highlightShadowMap.submitDraw(this,s,l,o)),h&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Oa.IntegratedMesh:this.objectOpacity<1?Oa.Transparent:this.componentParameters.opaqueOverride===gn.All?Oa.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Xr.Blend||this.alphaDiscardMode===Xr.MaskBlend?Oa.Transparent:this.componentParameters.transparent===gn.None?Oa.Opaque:this.componentParameters.transparent===gn.All?Oa.Transparent:Oa.OpaqueAndTransparent}};var Oa,gn;u([ts({vectorOps:kde})],Pn.prototype,"baseColor",void 0),u([ts()],Pn.prototype,"usePBR",void 0),u([ts()],Pn.prototype,"hasParametersFromSource",void 0),u([ts({vectorOps:iQ})],Pn.prototype,"mrrFactors",void 0),u([ts({vectorOps:iQ})],Pn.prototype,"emissiveFactor",void 0),u([ts({dispose:!0})],Pn.prototype,"baseColorTexture",void 0),u([ts({dispose:!0})],Pn.prototype,"metallicRoughnessTexture",void 0),u([ts({dispose:!0})],Pn.prototype,"emissionTexture",void 0),u([ts({dispose:!0})],Pn.prototype,"occlusionTexture",void 0),u([ts({dispose:!0})],Pn.prototype,"normalTexture",void 0),u([ts()],Pn.prototype,"objectOpacity",void 0),u([Rae()],Pn.prototype,"commonMaterialParameters",void 0),u([Rae()],Pn.prototype,"componentParameters",void 0),u([ts()],Pn.prototype,"textureAlphaCutoff",void 0),u([ts()],Pn.prototype,"alphaDiscardMode",void 0),u([ts()],Pn.prototype,"isIntegratedMesh",void 0),u([ts()],Pn.prototype,"polygonOffsetEnabled",void 0),u([ts()],Pn.prototype,"ellipsoidMode",void 0),u([ts()],Pn.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Oa||(Oa={}));let $L=class extends OY{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=mi.Back,this.hasSlicePlane=!0}};u([ts()],$L.prototype,"doubleSided",void 0),u([ts()],$L.prototype,"cullFace",void 0),u([ts()],$L.prototype,"hasSlicePlane",void 0);let GA=class extends OY{constructor(){super(...arguments),this.externalColor=Nt(1,1,1,1),this.externalColorMixMode=Fs.Multiply,this.castShadows=gn.All}get transparent(){return this.externalColor[3]<1?gn.All:gn.None}get opaqueOverride(){return this.externalColorMixMode===Fs.Replace&&this.externalColor[3]===1?gn.All:gn.None}get visible(){return this.externalColor[3]>0?gn.All:gn.None}get type(){return Of.Uniform}};u([ts({vectorOps:kde})],GA.prototype,"externalColor",void 0),u([ts()],GA.prototype,"externalColorMixMode",void 0),u([ts()],GA.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(gn||(gn={}));let R3=class extends OY{constructor(){super(...arguments),this.texture=null,this.transparent=gn.None,this.opaqueOverride=gn.None,this.castShadows=gn.None}get type(){return Of.Varying}};function Adt(t){return t.overlays.length!==0&&t.overlays[$i.INNER].getValidTexture(is.Highlight)!=null}function Odt(t){return t.overlays.length!==0&&t.overlays[$i.INNER].getColorTextureNoRasterImage()!=null}u([ts()],R3.prototype,"texture",void 0),u([ts()],R3.prototype,"transparent",void 0),u([ts()],R3.prototype,"opaqueOverride",void 0),u([ts()],R3.prototype,"castShadows",void 0);const f4=ji().vec3f(E.POSITION).u16(E.COMPONENTINDEX).u16(E.U16PADDING),dEe=ji().vec2u8(E.SIDENESS),Rdt=xc(dEe),pEe=ji().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u8(E.VARIANTOFFSET,{glNormalized:!0}).u8(E.VARIANTSTROKE).u8(E.VARIANTEXTENSION,{glNormalized:!0}).u8(E.U8PADDING,{glPadding:!0}).u16(E.U16PADDING,{glPadding:!0}),PG=pEe.clone().vec3f(E.NORMAL),MG=pEe.clone().vec3f(E.NORMALA).vec3f(E.NORMALB),fEe=new Map([[E.POSITION0,0],[E.POSITION1,1],[E.COMPONENTINDEX,2],[E.VARIANTOFFSET,3],[E.VARIANTSTROKE,4],[E.VARIANTEXTENSION,5],[E.NORMAL,6],[E.NORMALA,6],[E.NORMALB,7],[E.SIDENESS,8]]);function Mae(t,e,r){const i=e/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(w,T)=>{w<T?s[w+1]++:n[T+1]++};for(let w=0;w<i;w++){const T=t[3*w],x=t[3*w+1],S=t[3*w+2];o(T,x),o(x,S),o(S,T)}let a=0,l=0;for(let w=0;w<r;w++){const T=s[w+1],x=n[w+1];s[w+1]=a,n[w+1]=l,a+=T,l+=x}const c=new Uint32Array(6*i),h=s[r],p=(w,T,x)=>{if(w<T){const S=s[w+1]++;c[2*S]=T,c[2*S+1]=x}else{const S=n[T+1]++;c[2*h+2*S]=w,c[2*h+2*S+1]=x}};for(let w=0;w<i;w++){const T=t[3*w],x=t[3*w+1],S=t[3*w+2];p(T,x,w),p(x,S,w),p(S,T,w)}const f=(w,T)=>{const x=2*w,S=T-w;for(let O=1;O<S;O++){const A=c[x+2*O],P=c[x+2*O+1];let I=O-1;for(;I>=0&&c[x+2*I]>A;I--)c[x+2*I+2]=c[x+2*I],c[x+2*I+3]=c[x+2*I+1];c[x+2*I+2]=A,c[x+2*I+3]=P}};for(let w=0;w<r;w++)f(s[w],s[w+1]),f(h+n[w],h+n[w+1]);const m=new Int32Array(3*i),y=(w,T)=>w===t[3*T]?0:w===t[3*T+1]?1:w===t[3*T+2]?2:-1,_=(w,T)=>{const x=y(w,T);m[3*T+x]=-1},v=(w,T,x,S)=>{const O=y(w,T);m[3*T+O]=S;const A=y(x,S);m[3*S+A]=T};for(let w=0;w<r;w++){let T=s[w];const x=s[w+1];let S=n[w];const O=n[w+1];for(;T<x&&S<O;){const A=c[2*T],P=c[2*h+2*S];A===P?(v(w,c[2*T+1],P,c[2*h+2*S+1]),T++,S++):A<P?(_(w,c[2*T+1]),T++):(_(P,c[2*h+2*S+1]),S++)}for(;T<x;)_(w,c[2*T+1]),T++;for(;S<O;)_(c[2*h+2*S],c[2*h+2*S+1]),S++}return m}let mEe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?Mdt:Pdt}write(e,r,i){const s=this._edgeHashFunction(i);I$.seed=s;const n=I$.getIntRange(0,255),o=I$.getIntRange(0,this.settings.variants-1),a=.7,l=I$.getFloat(),c=255*(.5*$dt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,n),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const RY=new Float32Array(6),m4=new Uint32Array(RY.buffer),Q0=new Uint32Array(1);function Pdt(t){const e=RY;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],Q0[0]=5381;for(let r=0;r<m4.length;r++)Q0[0]=31*Q0[0]+m4[r];return Q0[0]}function Mdt(t){const e=RY;e[0]=Ox(t.position0[0]),e[1]=Ox(t.position0[1]),e[2]=Ox(t.position0[2]),e[3]=Ox(t.position1[0]),e[4]=Ox(t.position1[1]),e[5]=Ox(t.position1[2]),Q0[0]=5381;for(let r=0;r<m4.length;r++)Q0[0]=31*Q0[0]+m4[r];return Q0[0]}const $ae=1e4;function Ox(t){return Math.round(t*$ae)/$ae}function $dt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let g4=class{constructor(){this._commonWriter=new mEe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return PG.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),le($$,i.faceNormal0,i.faceNormal1),ge($$,$$),e.normal.setVec(r,$$)}trim(e,r){return this._commonWriter.trim(e,r)}};g4.Layout=PG,g4.glLayout=xc(PG,1);let y4=class{constructor(){this._commonWriter=new mEe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return MG.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};y4.Layout=MG,y4.glLayout=xc(MG,1);const $$=C(),I$=new J3,p1=-1;var _4;function Idt(t,e,r,i=Vdt){const s=t.vertices.position,n=t.vertices.componentIndex,o=Ft(i.anglePlanar),a=Ft(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=$G.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,_=Udt(t),v=Fdt(t),w=v.length/4,T=e.allocate(w);let x=0;const S=w,O=r.allocate(S);let A=0,P=0,I=0;const V=WAe(0,w),k=new Float32Array(w);k.forEach((H,Y,M)=>{s.getVec(v[4*Y],p),s.getVec(v[4*Y+1],f),M[Y]=fi(p,f)}),V.sort((H,Y)=>k[Y]-k[H]);const B=new Array,z=new Array;for(let H=0;H<w;H++){const Y=V[H],M=k[Y],D=v[4*Y],N=v[4*Y+1],G=v[4*Y+2],X=v[4*Y+3],K=X===p1;if(s.getVec(D,p),s.getVec(N,f),K)se(m,_[3*G],_[3*G+1],_[3*G+2]),re(y,m),h.componentIndex=n.get(D),h.cosAngle=me(m,y);else{if(se(m,_[3*G],_[3*G+1],_[3*G+2]),se(y,_[3*X],_[3*X+1],_[3*X+2]),h.componentIndex=n.get(D),h.cosAngle=me(m,y),Ddt(h,c))continue;h.cosAngle<-.9999&&re(y,m)}P+=M,I++,K||Ldt(h,l)?(e.write(T,x++,h),B.push(M)):Ndt(h,o)&&(r.write(O,A++,h),z.push(M))}const Z=new Float32Array(B.reverse()),W=new Float32Array(z.reverse());return{regular:{instancesData:e.trim(T,x),lodInfo:{lengths:Z}},silhouette:{instancesData:r.trim(O,A),lodInfo:{lengths:W}},averageEdgeLength:P/I}}function Ldt(t,e){return t.cosAngle<e}function Ddt(t,e){return t.cosAngle>e}function Ndt(t,e){const r=xn(t.cosAngle),i=$G.fwd,s=$G.ortho;return Ng(i,t.position1,t.position0),r*(me(ot(s,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function Fdt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let s=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],p=r[3*a],f=r[3*a+1],m=r[3*a+2];s+=l===p1||p<f?1:0,s+=c===p1||f<m?1:0,s+=h===p1||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],h=i[3*a+2],p=r[3*a],f=r[3*a+1],m=r[3*a+2];(l===p1||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===p1||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===p1||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function Udt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,s=v9.v0,n=v9.v1,o=v9.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],h=i[3*l+1],p=i[3*l+2];r.getVec(c,s),r.getVec(h,n),r.getVec(p,o),he(n,n,s),he(o,o,s),ot(s,n,o),ge(s,s),a[3*l]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(_4||(_4={}));const $G={edge:{position0:C(),position1:C(),faceNormal0:C(),faceNormal1:C(),componentIndex:0,cosAngle:0},ortho:C(),fwd:C()},v9={v0:C(),v1:C(),v2:C()},Vdt={anglePlanar:4,angleSignificantEdge:35};function zdt(t){const e=kdt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Iae.updateSettings(t.writerSettings),Lae.updateSettings(t.writerSettings),Idt(e,Iae,Lae)}function kdt(t,e,r,i){if(e){const o=Mae(r,i,t.count);return new Bdt(r,i,o,t)}const s=V7(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),n=Mae(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:f4.createView(s.buffer)}}let Bdt=class{constructor(e,r,i,s){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=s}};const Iae=new g4,Lae=new y4,oNt=ji().vec3f(E.POSITION0).vec3f(E.POSITION1),Gdt=ji().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u16(E.U16PADDING,{glPadding:!0});let jdt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},Hdt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new _r;i.samplingMode=At.NEAREST,i.wrapMode=Lt.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new Ct(this._rctx,i),this._data=new aa(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,s,n,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,r,i,s){const n=e*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}getDataElement(e,r,i){const s=e*this._fieldCount+r;return this._dirty=!0,this._data.get(s,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,s=new aa(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const gEe=65536;let qdt=class{constructor(e,r=1){this.textureBuffer=new Hdt(e,r),this._indexManager=new jdt(gEe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},yEe=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>gEe)return null;const r=new qdt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Dae=J.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let Wdt=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Bt,new Bt],this._renderSubmit=new mdt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=oe("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new yEe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){tt(this._objects[S2.Hidden].length===0&&this._objects[S2.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r==null||r.destroy()}createObject(e){const r=new O3;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=wae(e.obb),r.components=new Zht(this._componentBufferManager,Ef(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new rdt(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=ho(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new ydt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,_=n.verticalOffsets,v=1/0,w=-1/0,T=!1,x=!1,S=0;for(let O=0;O<n.count;O++){r(O,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Fs.Replace&&l.externalColor[3]===1),y+=+l.castShadows,Xxe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[O],0,h[0],h[1],h[2],h[3]),T||(T=O>0&&S!==p[0]),S=p[0],x||(x=l.elevationOffset!==0),x&&_==null&&(_=new Array(O).fill(0)),_!=null&&(_[O]=l.elevationOffset),v=Math.min(v,l.elevationOffset),w=Math.max(w,l.elevationOffset),lEe(l.elevationOffset,h),c.setData(a[O],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[O],2,A[0],A[1],A[2],A[3]),l.pickable!==nEe(n.pickability,O)&&(n.pickability=Jht(n.pickability,n.count,O,l.pickable))}n.verticalOffsets=x?_:null,i.offsetObb=x?qht(i.obb,v,w,this._viewingMode,i.offsetObb!=null?i.offsetObb:wae(i.obb)):null,T||x||this._hasObjectAndLayerId?(s.componentParameters=new R3,s.componentParameters.castShadows=b9(y,n.count),s.componentParameters.transparent=b9(f,n.count),s.componentParameters.opaqueOverride=b9(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new GA,s.componentParameters.castShadows=l.castShadows?gn.All:gn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,s=!1){e.intersectionGeometry.getComponentAabb(r,i);const n=e,o=n.components.verticalOffsets;if(s||o==null)return i;const a=o[r];if(this._viewingMode===Ie.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=EGe(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,s,n,o){const a=e;n!=null&&(n.localOrigin=a.transform.position);const l=bw(Nae,a.transform.rotationScale);_n(L$,r,a.transform.position),_n(D$,i,a.transform.position),ac(L$,L$,l),ac(D$,D$,l);const c=Sh(Nae,l);return a.intersectionGeometry.intersect(L$,D$,s,c,n,a.components.verticalOffsets,o)}addEdges(e,r,i,s){const n=e,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(e,n.transform,{center:n.obb.center,radius:Hht(n.obb)},a,o,l,i,s)}async extractEdgeInformation(e,r,i){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:Gdt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=f4.createBuffer(a.length/3);HR(c.position.typedBuffer,a,c.position.typedBufferStride,3),zwe(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:Ms(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,r,i,s){if(e&&r.allVisible())return e;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=Jd(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],p=i[c];for(let f=h;f<p;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void Dae.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else Dae.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[S2.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Ir.createVertex(i,xr.STATIC_DRAW,s.vertices.data),a=oc(s.indices,_=>Ir.createIndex(i,xr.STATIC_DRAW,_)),l=xc(gdt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],w=r.offsets[_+1],T=r.materialDataIndices[_];if(s.indices!=null)for(let x=v;x<w;x++)c[s.indices[x]]=T;else for(let x=v;x<w;x++)c[x]=T}const h=Ir.createVertex(i,xr.STATIC_DRAW,c.buffer),p=new Pn(e.transform,e.toMapSpace),f=new xh(i,hEe,{data:l,componentIndices:Xdt},{data:o,componentIndices:h},a),m=new odt(f,Et.TRIANGLES,n,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+h.byteLength+(a!=null?a.byteLength:0)};return new ndt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}};const Xdt=xc(ji().u16(E.COMPONENTINDEX));function b9(t,e){return t===e?gn.All:t===0?gn.None:gn.Some}const Nae=xl(),L$=C(),D$=C();let _Ee=class extends Kr{constructor(){super(...arguments),this.scale=Ue()}};function Zdt(t){const e=new br;e.attributes.add(E.POSITION,"vec2"),e.varyings.add("uv0","vec2"),e.varyings.add("uv1","vec2"),e.vertex.uniforms.add(new Tr("scale",i=>i.scale)),e.vertex.code.add(b`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),e.fragment.uniforms.add(new Je("tex",i=>i.texture),new Je("depthTexture",i=>i.depthTexture),new Tr("scale",i=>i.scale),new Tr("clampUV",i=>Ydt(i)));const r=t.haze;return e.fragment.code.add(b`
    void main() {
      ${r?b`vec4`:b`float`} depthSample = texture(depthTexture, uv0) ${r?"":b`.r`};
      if (depthSample ${r?b`== vec4(0)`:b`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),e}function Ydt(t){if(!t.texture)return Fae;const e=sr(Fae,t.texture.descriptor.width,t.texture.descriptor.height),r=DW(e,e,t.scale),i=v0e(r,r);return T0e(i,t.scale,i)}const Fae=Ue(),Jdt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:_Ee,build:Zdt},Symbol.toStringTag,{value:"Module"}));let vEe=class bEe extends Rr{initializeProgram(e){return new Er(e.rctx,bEe.shader.get().build(this.configuration),vr)}initializePipeline(){return this.configuration.haze?Ot({blending:_o(be.ONE,be.ZERO,be.ONE_MINUS_SRC_COLOR,be.ONE),depthTest:{func:Qr.ALWAYS},colorWrite:Gt}):Ot({blending:vc(be.SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),depthTest:{func:Qr.ALWAYS},colorWrite:Gt})}};vEe.shader=new Sr(Jdt,()=>ae(()=>import("./AtmosphereCompositing.glsl-4a5ab414.js"),[]));let wEe=class extends Kr{constructor(){super(...arguments),this.opacity=1}};function Qdt(t){const e=new br;return e.include(Ph),e.fragment.uniforms.add(new Je("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Oe("opacity",r=>r.opacity)),e.fragment.code.add(b`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const Kdt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:wEe,build:Qdt},Symbol.toStringTag,{value:"Module"}));var ta;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(ta||(ta={}));let IG=class extends ca{constructor(){super(...arguments),this.alphaMode=ta.None,this.hasOpacityFactor=!1}};u([F({count:ta.COUNT})],IG.prototype,"alphaMode",void 0),u([F()],IG.prototype,"hasOpacityFactor",void 0);let xEe=class TEe extends Rr{initializeProgram(e){return new Er(e.rctx,TEe.shader.get().build(this.configuration),vr)}initializePipeline(){switch(this.configuration.alphaMode){case ta.None:return Ot({colorWrite:Gt});case ta.Alpha:return Ot({blending:_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt});case ta.PremultipliedAlpha:case ta.COUNT:return Ot({blending:vc(be.ONE,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}}};xEe.shader=new Sr(Kdt,()=>ae(()=>import("./Compositing.glsl-ab81ff62.js"),[]));let SEe=class extends Kr{};function ept(){const t=new br;return t.include(Ph),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.code.add(b`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const tpt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:SEe,build:ept},Symbol.toStringTag,{value:"Module"}));let EEe=class CEe extends Rr{initializeProgram(e){return new Er(e.rctx,CEe.shader.get().build(),vr)}initializePipeline(){return Ot({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};EEe.shader=new Sr(tpt,()=>ae(()=>import("./HUDCompositing.glsl-0dd7f131.js"),[]));let AEe=class extends Kr{};function rpt(){const t=new br;return t.include(Ph),t.fragment.uniforms.add(new Je("colorTexture",e=>e.colorTexture),new Je("alphaTexture",e=>e.alphaTexture),new Je("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(b`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const ipt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:AEe,build:rpt},Symbol.toStringTag,{value:"Module"}));let OEe=class REe extends Rr{initializeProgram(e){return new Er(e.rctx,REe.shader.get().build(),vr)}initializePipeline(){return Ot({blending:_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};OEe.shader=new Sr(ipt,()=>ae(()=>import("./OITCompositing.glsl-ad511803.js"),[]));let PEe=class extends Kr{constructor(){super(...arguments),this.overlayIndex=$i.INNER,this.opacity=1}};function spt(){const t=new br;return t.include(Ph),t.fragment.uniforms.add(new Je("tex",e=>e.texture)),t.fragment.uniforms.add(new kR("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Oe("opacity",e=>e.opacity)),t.fragment.code.add(b`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const npt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:PEe,build:spt},Symbol.toStringTag,{value:"Module"}));let MEe=class $Ee extends Rr{initializeProgram(e){return new Er(e.rctx,$Ee.shader.get().build(),vr)}initializePipeline(){return Ot({blending:vc(be.ONE,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};MEe.shader=new Sr(npt,()=>ae(()=>import("./OverlayCompositing.glsl-e2c36d29.js"),[]));let opt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new IG,this._atmosphereConfiguration=new lN,this._passParameters=new wEe,this._atmosphereParameters=new _Ee,this._oitParameters=new AEe,this._hudParameters=new SEe,this._overlayParameters=new PEe}destroy(){this._vao=Fe(this._vao)}compositeOIT(e,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(OEe);n.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Et.TRIANGLE_STRIP,0,Io(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(EEe);i.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(Et.TRIANGLE_STRIP,0,Io(n,"geometry")),s.release()}compositeOverlay(e,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(MEe);n.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Et.TRIANGLE_STRIP,0,Io(a,"geometry")),o.release()}compositeAtmosphere(e,r,i,s,n){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTexture=i,this._atmosphereParameters.scale=s,this._atmosphereConfiguration.haze=n;const a=this._techniqueRepository.acquire(vEe,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Et.TRIANGLE_STRIP,0,Io(l,"geometry")),a.release()}composite(e,r,i=ta.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(xEe,this._configuration);n.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Et.TRIANGLE_STRIP,0,Io(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=Cl(this._rctx)),this._vao}};const apt=1e4,LG=100,lpt=500,cpt=500,upt=.1;function hpt(t,e,r){return YX(e,t)*(r[1]-r[0])+r[0]}function dpt(t,e,r){let i=0;if(!e.some(n=>(i+=n.numGeometries,i>=apt)))return bpt.compute(t,e);const s=qR();return r.forAll(n=>{n.visible&&TS(s,ppt(t,n))}),s}function ppt(t,e){if(!e.visible)return;const r=qR(),i=e.getSpatialQueryAccelerator();return i!=null?fpt(r,t,i):mpt(r,t,e.objects),r}function fpt(t,e,r){const i=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<lpt)HO(Wu,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,s,Vd.DepthOrder.FRONT_TO_BACK,Wu,(l,c)=>{DG(t,e,l),Wu.far=t.near,c.setRange(Wu)},n,o),HO(Wu,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,s,Vd.DepthOrder.BACK_TO_FRONT,Wu,(l,c)=>{DG(t,e,l),Wu.near=t.far,c.setRange(Wu)},n,o);else{const l=Math.max(Math.min(a,cpt),Math.ceil(a*upt)),c=r.findClosest(s,Vd.DepthOrder.FRONT_TO_BACK,n,o,l),h=r.findClosest(s,Vd.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Uae(t,e,c.boundingVolumeWorldSpace.bounds),Uae(t,e,h.boundingVolumeWorldSpace.bounds))}}function mpt(t,e,r){Rx.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&Rx.add(i)}),Rx.empty||(Rx.sort(e),HO(Wu,e.near,Math.min(t.near,e.far)),Rx.forEachInDepthRange(Wu,Vd.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<t.near&&DG(t,e,i)}),HO(Wu,Math.max(t.far,e.near),e.far),Rx.forEachInDepthRange(Wu,Vd.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{t.far=Math.max(t.far,n)}))}function DG(t,e,r){if(!r.visible||!X0(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=vpt;r.geometries.forEach(n=>{si(s,i,n.shaderTransformation);const o=Y2(s);IEe(t,e,n.boundingInfo,s,o)})}function IEe(t,e,r,i,s){if(r==null)return;$e($a,r.center,i);const{eye:n,viewForward:o}=e,a=o[0]*($a[0]-n[0])+o[1]*($a[1]-n[1])+o[2]*($a[2]-n[2]);if($a[3]=r.radius*s,!(a-$a[3]>t.near&&a+$a[3]<t.far)&&X0(e.frustum,$a))if(r.radius>LG&&r.getChildren())for(const l of r.getChildren())IEe(t,e,l,i,s);else NG.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function Uae(t,e,r){const i=e.eye,s=e.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];t.near=Math.min(t.near,n-r[3]),t.far=Math.max(t.far,n+r[3])}let gpt=class{constructor(){this._items=new Bt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,r,i){if(r===Vd.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||i(n.obj,n.near,n.far)}}},ypt=class{constructor(){this._view=ve(),this._viewProj=ve(),this._frustum=TO(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),$s(this._view,e.viewMatrix),si(this._viewProj,e.projectionMatrix,this._view),dN(this._frustum,e.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const y=m.boundingSphere,_=s*y[0]+n*y[1]+o*y[2]+a,v=_-y[3],w=_+y[3];this._geometries.push(m),this._near.push(-w),this._far.push(-v)}));const l=new adt;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const s=e.center;$e($a,s,r);const n=Y2(r),o=$a[0],a=$a[1],l=$a[2],c=e.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=i.near))if(-f>this._looseRange.near)i.near=-f;else{if(c>LG){const m=e.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,r,i);return}}NG.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let s=e.radius;const n=e.center;$e($a,n,r);const o=Y2(r),a=$a[0],l=$a[1],c=$a[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-p<=i.far))if(-p<this._looseRange.far)i.far=-p;else{if(s>LG){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,r,i);return}}NG.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},_pt=class{constructor(){this._modelViewProj=ve(),this._clipPosition=[Zt(),Zt(),Zt(),Zt(),Zt(),Zt(),Zt(),Zt()]}unionDepthRangeWithAABB(e,r,i,s,n){const o=this._modelViewProj;si(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[w9[l][0]],h=this._clipPosition[w9[l][1]],p=this._clipPosition[w9[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const _=f[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void tt(!1)}_intersect(e,r,i){let s=0;return i===0?s=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?s=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?s=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(s=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),J4(Zt(),e,r,s)}_clipTriangle(e,r,i){let s=[e,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const w9=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],$a=ys(),vpt=ve(),Wu=qR(),Rx=new gpt,bpt=new ypt,NG=new _pt;let wpt=class{},xpt=class extends Kr{constructor(){super(...arguments),this.textures=new wpt}};function Tpt(){const t=new br;return t.attributes.add(E.POSITION,"vec2"),t.vertex.uniforms.add(new rr("drawPosition",(e,r)=>Spt(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(b`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Je("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Je("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Je("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Sf("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Sf("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(b`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function Spt(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,s=t.magnifier.offset.y*r;lf(t.magnifier.position,Vae);const n=e.camera.screenToRender(Vae,Ept),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return bi(Cpt,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Vae=Zi(),Ept=Ffe(),Cpt=Zt();async function Apt(t){const e=ae(()=>import("./mask-svg-023bbc42.js"),[]),r=ae(()=>import("./overlay-svg-d62383f3.js"),[]),i=Lg((await e).default,{signal:t}),s=Lg((await r).default,{signal:t}),n={mask:await i,overlay:await s};return Jt(t),n}let hT=class extends xe{constructor(){super(...arguments),this._handles=new Pi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new xpt,this.events=new Is,this.attributeLocations=new Map([[E.POSITION,0]]),this._tmpScreenPoint=Zi(),this._tmpRenderPoint=Ffe()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(ue(()=>oc(this._magnifier,i=>i.version),r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const s=r.camera.pixelRatio,n=Math.ceil(s*i.size);if(this._updateResources(e,n),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*n);o.input.resize(a,a),lf(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,h=r.camera.fullHeight,p=.5*a,f=.5*a;l[0]=ye(l[0],p,c-p-1),l[1]=ye(l[1],f,h-f-1);const m=Math.floor(l[0]-p),y=Math.floor(l[1]-f),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Et.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:$S(async s=>{const n=r==null||i==null?Apt(s):null,o=r!=null?Lg(r,{signal:s}):n.then(l=>l.mask),a=i!=null?Lg(i,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const s=this._createTextureResources(e,r);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:Cl(e,zW,this.attributeLocations,0,1),pipelineState:Ot({blending:vc(be.ONE,be.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Gt})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new _r;i.internalFormat=St.RGBA,i.wrapMode=Lt.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!Ghe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new Ct(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=St.ALPHA,i.preMultiplyAlpha=!1;const n=new Ct(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=St.RGBA,i.flipped=!1,{input:new Ct(e,i),mask:n,overlay:s,size:r}}_createProgram(e){return new Er(e,Tpt(),this.attributeLocations)}};u([d()],hT.prototype,"_imageSources",void 0),u([d()],hT.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],hT.prototype,"updating",null),hT=u([R("esri/views/3d/webgl-engine/lib/MagnifierHelper")],hT);let Opt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new aa(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,s,n,o=null,a=null,l=null){if(!(e&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Nt(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return J.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let s=i.get(e.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new aa(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||J.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):J.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||J.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&o&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return e}};var qO;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(qO||(qO={}));let Iy=class{constructor(e,r,i=qO.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Bt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=e,n.depthSquaredHint=s,n.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===n&&l.configuration.transparencyPassType===st.NONE||(s.bindTechnique(l,e,r),n=l);const c=this._draws.data[a],h=c.geometry;s.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=IL.get(c.indexType);for(let y=0;y<f;y+=2){const _=p[y],v=p[y+1];s.drawElements(h.primitiveType,v,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const y=p[m],_=p[m+1];s.drawArrays(h.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===qO.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=e*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const IL=new Map;IL.set(Ke.UNSIGNED_BYTE,1),IL.set(Ke.UNSIGNED_SHORT,2),IL.set(Ke.UNSIGNED_INT,4);let Rpt=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new Vct,this._shadowPassParameters=new zct,this._highlightPassParameters=new kct,this._systems=new Set,this._passes={materialOpaque:new Iy(e,r),materialTransparent:new Iy(e,r,qO.BackToFront),materialIntegratedMesh:new Iy(e,r),shadowMap:new Iy(e,r),highlight:new Iy(e,r),highlightIntegratedMesh:new Iy(e,r),highlightShadowMap:new Iy(e,r),defaultShadowMap:new Iy(e,r)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(r,i)=>r.prepare(i,e.bindParameters)))}render(e,r){this._invoke(e,(i,s)=>i.dispatch(s,e.bindParameters,r))}_invoke(e,r){switch(e.bindParameters.slot){case ce.OPAQUE_MATERIAL:switch(e.output){case L.Color:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case L.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case L.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case L.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case L.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case ce.TRANSPARENT_MATERIAL:switch(e.output){case L.Color:case L.Alpha:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case ce.INTEGRATED_MESH:switch(e.output){case L.Color:case L.Depth:case L.Normal:case L.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case L.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[ce.OPAQUE_MATERIAL,ce.TRANSPARENT_MATERIAL,ce.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(e);s!=null&&TS(r,s,r)}),r}_configure(e){const r=e.output===L.Shadow||e.output===L.ShadowHighlight||e.output===L.ShadowExcludeHighlight?this._shadowPassParameters:e.output===L.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,s=i.viewInverseTransposeMatrix;se(x9,s[3],s[7],s[11]),T9.set(x9),re(r.transformWorldFromViewTH,T9.high),re(r.transformWorldFromViewTL,T9.low),re(r.slicePlaneLocalOrigin,x9),Th(r.transformViewFromCameraRelativeRS,i.viewMatrix),$s(r.transformProjFromView,i.projectionMatrix),r.identifier===nc.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===ce.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===ce.INTEGRATED_MESH,Sh(zae,r.transformViewFromCameraRelativeRS),bw(r.transformNormalViewFromGlobal,zae))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const x9=C(),zae=Ni(),T9=new ZF;let Ppt=class{constructor(){this._step=Gae,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,oe("disable-feature:high-quality-idle"))this._dilation=1;else{const s=r?performance.now()-this._firstIdleTime:0;if(s>=kae+$pt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=kae?Ipt:1}const i=ye(e/Mpt,Gae,Dpt);this._step===1/0?this._step=i:this._step=this._step*Bae+i*(1-Bae)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const Mpt=.5,kae=12e4,$pt=1e4,Ipt=10,Bae=.9,Lpt=30,Gae=1e3/1,Dpt=1e3/Lpt,Npt=8.6,Fpt=.4;function Upt(){const t=new br,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(E.UV0,"vec2"),e.uniforms.add(new Je("coverageTex",n=>n.coverageTexture)),i.add(b`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Je("tex",n=>n.blurColorTexture),new Je("origin",n=>n.highlightColorTexture),new rr("uColor",n=>n.color),new rr("haloColor",n=>n.haloColor),new rr("opacities",n=>bi(Vpt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",Npt),r.constants.add("blurSize","float",Fpt),s.add(b`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const Vpt=Zt(),zpt=Object.freeze(Object.defineProperty({__proto__:null,build:Upt},Symbol.toStringTag,{value:"Module"}));let LEe=class DEe extends Rr{initializeProgram(e){return new Er(e.rctx,DEe.shader.get().build(),vr)}initializePipeline(){return Ot({blending:_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt})}};LEe.shader=new Sr(zpt,()=>ae(()=>import("./HighlightApply.glsl-1eb9e709.js"),[]));let NEe=class extends Kr{constructor(){super(...arguments),this.blurSize=Ue()}};function kpt(){const t=new br,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),t.attributes.add(E.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Je("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new $Z("blurSize",n=>n.blurSize)),i.add(b`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new uh("tex",n=>n.blurInputTexture)),s.add(b`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const Bpt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:NEe,build:kpt},Symbol.toStringTag,{value:"Module"}));let FEe=class UEe extends Rr{initializeProgram(e){return new Er(e.rctx,UEe.shader.get().build(),vr)}initializePipeline(){return Ot({colorWrite:Gt})}};FEe.shader=new Sr(Bpt,()=>ae(()=>import("./HighlightBlur.glsl-5c273824.js"),[]));let VEe=class extends Kr{constructor(){super(...arguments),this.invFramebufferDim=Ue()}};function Gpt(){const t=new br,{vertex:e,fragment:r}=t,i=e.code,s=r.code;return t.attributes.add(E.POSITION,"vec2"),i.add(b`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new uh("tex",n=>n.inputTexture)),r.uniforms.add(new $Z("invFramebufferDim",n=>n.invFramebufferDim)),s.add(b`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const jpt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:VEe,build:Gpt},Symbol.toStringTag,{value:"Module"}));let zEe=class kEe extends Rr{initializeProgram(e){return new Er(e.rctx,kEe.shader.get().build(),vr)}initializePipeline(){return Ot({colorWrite:Gt})}};zEe.shader=new Sr(jpt,()=>ae(()=>import("./HighlightDownsample.glsl-b8ec5318.js"),[]));let jae=class extends Kr{constructor(){super(...arguments),this.color=Bf(1,0,1,1),this.haloColor=Bf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Nt(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const Hpt=32;let qpt=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Zt(),this._passParameters=new jae,this._downsampleDrawParameters=new VEe,this._blurDrawParameters=new NEe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Cl(this._rctx);const e=new _r;e.wrapMode=Lt.CLAMP_TO_EDGE,this._blur0Fbo=new nn(this._rctx,e),this._blur1Fbo=new nn(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire(FEe),this._downsampleTechnique=this._techniqueRep.acquire(zEe),this._applyTechnique=this._techniqueRep.acquire(LEe)}dispose(){if(this._blurTechnique=ki(this._blurTechnique),this._downsampleTechnique=ki(this._downsampleTechnique),this._applyTechnique=ki(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=Fe(this._blur0Fbo),this._blur1Fbo=Fe(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new jae,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=e.camera;oh(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(r,Hpt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(wi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,sr(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Io(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(wi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,sr(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Io(p,"geometry")),h.bindFramebuffer(i),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,Io(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h=new _r(Math.ceil(c.width/2),Math.ceil(c.height/2));h.pixelFormat=St.RGB,h.dataType=Us.UNSIGNED_SHORT_5_6_5,h.wrapMode=Lt.CLAMP_TO_EDGE,s.coverageMipmap[l+1]=new nn(i,h)}}const o=Math.ceil(e.height/s.cellPixelSize),a=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let _=0;for(let v=0;v<l;v++)for(let w=0;w<c;w++)y[_]=(w-.5)*p*2-1,y[_+1]=(v-.5)*h*2-1,y[_+2]=w*p,y[_+3]=v*h,y[_+4]=(w+.5)*p*2-1,y[_+5]=(v-.5)*h*2-1,y[_+6]=w*p,y[_+7]=v*h,y[_+8]=(w-.5)*p*2-1,y[_+9]=(v+.5)*h*2-1,y[_+10]=w*p,y[_+11]=v*h,y[_+12]=(w-.5)*p*2-1,y[_+13]=(v+.5)*h*2-1,y[_+14]=w*p,y[_+15]=v*h,y[_+16]=(w+.5)*p*2-1,y[_+17]=(v-.5)*h*2-1,y[_+18]=w*p,y[_+19]=v*h,y[_+20]=(w+.5)*p*2-1,y[_+21]=(v+.5)*h*2-1,y[_+22]=w*p,y[_+23]=v*h,_+=f*m;s.vao&&s.vao.dispose(),s.vao=new ap(i,vr,{geometry:wR},{geometry:Ir.createVertex(i,xr.STATIC_DRAW,y)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,sr(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(Et.TRIANGLE_STRIP,0,Io(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const Wpt={dataType:Us.UNSIGNED_BYTE,internalFormat:St.RGBA},Xpt={};let Zpt=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._fbos.forEach((s,n)=>{s.colorTexture!==i&&s.depthStencilAttachment!==i||(s.detachColorTexture(),s.detachDepthStencilTexture(),s.dispose(),this._fbos.delete(n))}),i.dispose(),e.delete(r))}_getDepthTexture(e,r,i){let s=this._depthTextures.get(e.id);if(!s||s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=null),!s){const n=new _r(r,i);n.pixelFormat=St.DEPTH_STENCIL,n.dataType=Us.UNSIGNED_INT_24_8,n.samplingMode=At.NEAREST,n.wrapMode=Lt.CLAMP_TO_EDGE,s=new Ct(this._rctx,n),this._depthTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,r,i){let s=this._colorTextures.get(e.id);if(s&&(s.descriptor.width===r&&s.descriptor.height===i||(s.dispose(),s=CS())),!s){const n=new _r(r,i);n.internalFormat=e.internalFormat,n.dataType=e.dataType,n.samplingMode=e.samplingMode!=null?e.samplingMode:At.LINEAR,n.wrapMode=Lt.CLAMP_TO_EDGE,s=new Ct(this._rctx,n),this._colorTextures.set(e.id,s),this._activeTargets.add(e.id)}return s}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:hc(),...Xpt,...e}}registerColorTarget(e={}){return{id:hc(),...Wpt,...e}}getFramebuffer(e,r,i,s){const n=this._getKey(i,s);let o=this._fbos.get(n);const a=this.getColorTexture(i,e,r),l=s?this._getDepthTexture(s,e,r):void 0;return o?((o.width!==e||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new nn(this._rctx,a,l),this._fbos.set(n,o),o)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),e+=s.gpuMemoryUsage)};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),e}},Ypt=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new Zpt(e);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=i.registerColorTarget({name:"colorFloatTarget",dataType:Us.HALF_FLOAT,internalFormat:Ze.RGBA16F,samplingMode:At.NEAREST}),this.alphaFloatTarget=i.registerColorTarget({name:"alphaFloatTarget",dataType:Us.HALF_FLOAT,internalFormat:Ze.R16F,samplingMode:At.NEAREST}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:At.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:Ze.RGBA4,dataType:Us.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:Ze.RGBA4,dataType:Us.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const r=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,K1(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(wi.COLOR_BUFFER_BIT|wi.DEPTH_BUFFER_BIT|wi.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,ta.None)}renderTmpAndCompositeToMain(e,r,i,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,Jpt),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(e,r,i,s){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,s,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,Qpt)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let s,n;switch(r){case st.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case st.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case st.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0];break;case st.NONE:case st.COUNT:return}i?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ta.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ta.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(wi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=wi.COLOR_BUFFER_BIT}i&&(o|=wi.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=wi.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,s,n,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const Jpt=[0,0,0,0],Qpt=[0,1,0,1];let P3=class extends xe{constructor(e){super({}),this._context=e,this._renderPlugins=new Bt,this._slots=[];for(let r=0;r<ce.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r,i){const s=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),Lr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(pu(n))return n.then(s);s(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}prepareSlots(e){for(const r of e)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(i=>{i.canRender&&(Hae(i)&&i.prepareTechnique(this._context.renderContext),qae(i)&&i.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(Hae(i)){const s=i.prepareTechnique(this._context.renderContext);return s!=null&&(r.push(s),!0)}if(qae(i)){const s=i.prepareTechniques(this._context.renderContext);return s!=null&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(e){const r=Kpt;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(e);s&&TS(r,s,r)}}),r}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[ce.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Ii.None)}};function Hae(t){return"prepareTechnique"in t}function qae(t){return"prepareTechniques"in t}u([d()],P3.prototype,"_renderPlugins",void 0),u([d({readOnly:!0})],P3.prototype,"updating",null),P3=u([R("esri.views.3d.webgl-engine.lib.RenderPluginManager")],P3);const Kpt={near:0,far:0};let BEe=class extends RZ{};const YF=255,eft=1/YF;function tft(t){const e=new br,r=e.fragment;return r.include(wc),r.include(hu),e.include(IF),e.include(Ph),e.include($F,t),r.uniforms.add(new Je("depthMap",i=>i.linearDepthTexture),new Di("inverseViewMatrix",(i,s)=>bn(Wae,Sl(Wae,s.camera.viewMatrix,s.camera.center))),new Tr("nearFar",(i,s)=>s.camera.nearFar)),r.constants.add("sampleValue","float",eft),r.code.add(b`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const Wae=ve(),rft=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:BEe,ShadowCastMaxSamples:YF,build:tft},Symbol.toStringTag,{value:"Module"}));var tw;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(tw||(tw={}));let FG=class extends ca{constructor(){super(...arguments),this.visualization=tw.Gradient,this.bandsEnabled=!1}};u([F({count:tw.COUNT})],FG.prototype,"visualization",void 0),u([F()],FG.prototype,"bandsEnabled",void 0);let GEe=class extends Kr{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=vR(ift),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const ift=Nt(.01,0,.25,1);function sft(t){const e=new br,r=e.fragment;r.include(wc),r.include(hu),e.include(IF),e.include(Ph);const{visualization:i,bandsEnabled:s}=t;r.constants.add("inverseSampleValue","float",YF),r.uniforms.add(new Je("shadowCastMap",a=>a.shadowCastMap),new Oe("sampleScale",a=>a.sampleScale),new Oe("opacityFromElevation",a=>a.opacityFromElevation),new rr("uColor",a=>a.color));const n=i===tw.Gradient,o=i===tw.Threshold;return n&&s?r.uniforms.add(new Oe("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Oe("threshold",a=>a.threshold)),r.code.add(b`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?b`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?b`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?b`* strength`:""});
      }
    `),e}const nft=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:GEe,build:sft},Symbol.toStringTag,{value:"Module"}));let jEe=class HEe extends Rr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Er(e.rctx,HEe.shader.get().build(this.configuration),vr)}initializePipeline(){return Ot({blending:su,colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};jEe.shader=new Sr(nft,()=>ae(()=>import("./ShadowCastVisualize.glsl-acf478aa.js"),[]));const oft=4e4,aft=5e4,qEe=1/512;let LL=class extends xe{constructor(e,r,i,s){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=s,this._passParameters=new GEe(this._data),this._techniqueConfig=new FG,this._enabled=!1,this._vao=Cl(r),this._techniqueConfig.visualization=tw.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Fe(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(jEe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,Io(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>qEe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;i2(e,r)||(oh(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],LL.prototype,"opacityFromElevation",null),LL=u([R("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],LL);let PY=class extends ca{constructor(){super(...arguments),this.receiveShadows=!0}};u([F()],PY.prototype,"receiveShadows",void 0);let WEe=class XEe extends Rr{constructor(e){super(e,new PY,()=>this.destroy())}initializeProgram(e){return new Er(e.rctx,XEe.shader.get().build(this.configuration),vr)}initializePipeline(){return Ot({blending:_o(be.ONE,be.ONE,be.ONE,be.ONE),colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};WEe.shader=new Sr(rft,()=>ae(()=>import("./ShadowCastAccumulate.glsl-a7dbffca.js"),[]));let cl=class extends xe{constructor(e,r,i,s,n,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new BEe,this._cachedLightDirections=[],this._depthRange=RG,this._previewing=!1,this._handles=new Pi,this._cameraForcedForScreenshot=!1,this._bindParameters=new H5(new AZ(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Cl(e),this._accumulationRenderer=new LL(r,e,this,o);const a=this._stage.view.resourceController.scheduler;this._handles.add([a.registerTask(dt.SHADOW_ACCUMULATOR,this),ue(()=>i.renderView,l=>{this._handles.remove(Xae),l!=null&&this._handles.add(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Xae)},Cs),ue(()=>this._previewing,()=>this._requestRenderIfEnabled(),Gr)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=Fe(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Fe(this._fbo),this._vao=Fe(this._vao),this._accumulationTechniqueCached=ki(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new WEe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==RG&&this._opacityFromElevation>qEe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(wg(r,e,l_))return;const i=Math.min(YF,e.length);r.length=i,this._sampleCount=i;for(let s=0;s<i;++s)r[s]=re(r[s]??C(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,s){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(lft,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,St.RGBA,Us.UNSIGNED_BYTE,Zae),Zae[0]/this._progress)}_enable(){this._progress=0;const e=new _r;e.wrapMode=Lt.CLAMP_TO_EDGE,this._fbo=new nn(this._rctx,e)}_disable(){this._fbo=Fe(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(wi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Io(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*cft%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-nO(oft,aft,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],cl.prototype,"_progress",void 0),u([d()],cl.prototype,"_sampleCount",void 0),u([d()],cl.prototype,"_fbo",void 0),u([d()],cl.prototype,"_depthRange",void 0),u([d()],cl.prototype,"_previewing",void 0),u([d()],cl.prototype,"_accumulationRenderer",void 0),u([d()],cl.prototype,"_isRefining",null),u([d()],cl.prototype,"_isActive",null),u([d()],cl.prototype,"canAccumulate",null),u([d()],cl.prototype,"_isDoneAccumulating",null),u([d()],cl.prototype,"_opacityFromElevation",null),u([d()],cl.prototype,"running",null),cl=u([R("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],cl);const lft=6,Xae="renderView",cft=104729,Zae=new Uint8Array(4),Yae={highlightedThreshold:.99999,selfShadowThreshold:.025};function uft(t){const e=new br;e.include(Zb,t);const r=e.fragment;return r.include(wc),r.include(hu),e.include(IF),e.include(Ph),r.uniforms.add(new Je("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(vS.Default)),new Je("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(vS.Highlight)),new Je("depthMap",(i,s)=>s.linearDepthTexture),new Je("highlightMap",(i,s)=>s.highlightColorTexture),new rr("uColor",i=>i.shadowColor),new Tr("nearFar",(i,s)=>s.camera.nearFar),new Oe("opacity",i=>i.shadowOpacity),new Oe("occludedOpacity",i=>i.occludedShadowOpacity),new Oe("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Vt("lightingMainDirectionView",(i,s)=>ge(Qae,$e(Qae,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Tr("texelSize",(i,s)=>s.linearDepthTexture!=null?sr(hft,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):rp),new Di("inverseViewMatrix",(i,s)=>bn(Jae,Sl(Jae,s.camera.viewMatrix,s.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",hbe).add("highlightedThreshold","float",Yae.highlightedThreshold).add("selfShadowThreshold","float",Yae.selfShadowThreshold),r.code.add(b`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(b`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Jae=ve(),Qae=C(),hft=Ue(),dft=Object.freeze(Object.defineProperty({__proto__:null,build:uft},Symbol.toStringTag,{value:"Module"}));let pft=class extends RZ{constructor(){super(...arguments),this.shadowColor=Nt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},ZEe=class YEe extends Rr{constructor(e){super(e,new PY,()=>this.destroy())}initializeProgram(e){return new Er(e.rctx,YEe.shader.get().build(this.configuration),vr)}initializePipeline(){return Ot({blending:_o(be.SRC_ALPHA,be.ONE,be.ONE_MINUS_SRC_ALPHA,be.ONE_MINUS_SRC_ALPHA),colorWrite:Gt,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};ZEe.shader=new Sr(dft,()=>ae(()=>import("./ShadowHighlight.glsl-a0455fa6.js"),[]));const fft=.001953125,mft=4e4,gft=5e4;let yft=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new pft,this._drawParameters=new NQe,this._vao=Cl(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new ZEe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,Io(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.memoryEstimate)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-nO(mft,gft,e.relativeElevation);const i=this._viewingMode===Ie.Global?ge(Kae,e.center):se(Kae,0,0,1),s=me(i,r);this._passParameters.dayNightTerminator=nO(0,1,ye(30*s,0,1))}dispose(){this._vao=Fe(this._vao),this._techniqueCached=ki(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=fft}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const Kae=C(),ele=Vg();let _ft=class{constructor(){this._plane=Vg()}get isEnabled(){return!lye(this.plane,ele)}get plane(){return this._plane}set plane(e){yw(e||ele,this._plane)}},vft=class extends Kr{};function WO(t){t.uniforms.add(new rr("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,s=r.height;return bi(bft,1/i,1/s,i,s)}))}const bft=Zt(),Px={maxSearchSteps:8,maxDistanceAreaTex:16};function wft(){const t=new br,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),WO(i),i.code.add(b`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.int(Px.maxSearchSteps)} );
      }
    `),s.uniforms.add(new Je("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new Je("areaTexture",n=>n.areaTexture)),s.uniforms.add(new Je("searchTexture",n=>n.searchTexture)),WO(s),s.code.add(b`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Px.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.int(Px.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Px.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.int(Px.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.int(Px.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const xft=Object.freeze(Object.defineProperty({__proto__:null,build:wft},Symbol.toStringTag,{value:"Module"}));let JEe=class QEe extends Rr{initializeProgram(e){return new Er(e.rctx,QEe.shader.get().build(),vr)}initializePipeline(){return Ot({colorWrite:Gt})}};JEe.shader=new Sr(xft,()=>ae(()=>import("./BlendWeights.glsl-7eae9aec.js"),[]));function Tft(){const t=new br,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),WO(i),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new Je("blendWeightsTexture",n=>n.blend.colorTexture),new Je("colorTexture",n=>n.colorTexture)),WO(s),s.code.add(b`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const Sft=Object.freeze(Object.defineProperty({__proto__:null,build:Tft},Symbol.toStringTag,{value:"Module"}));let KEe=class eCe extends Rr{initializeProgram(e){return new Er(e.rctx,eCe.shader.get().build(),vr)}initializePipeline(){return Ot({colorWrite:Gt})}};KEe.shader=new Sr(Sft,()=>ae(()=>import("./Blur.glsl-91a88c26.js"),[]));const tle={threshold:.05,localConstrastAdaption:2};function Eft(){const t=new br,{attributes:e,varyings:r,vertex:i,fragment:s}=t;return e.add(E.POSITION,"vec2"),WO(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(b`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new Je("colorTexture",n=>n.colorTexture)),s.code.add(b`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${b.float(tle.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${b.float(tle.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const Cft=Object.freeze(Object.defineProperty({__proto__:null,build:Eft},Symbol.toStringTag,{value:"Module"}));let tCe=class rCe extends Rr{initializeProgram(e){return new Er(e.rctx,rCe.shader.get().build(),vr)}initializePipeline(){return Ot({colorWrite:Gt})}};tCe.shader=new Sr(Cft,()=>ae(()=>import("./EdgeDetect.glsl-199a0251.js"),[]));let M3=class extends xe{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new vft,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=ou(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const r=this._abortController.signal;return ae(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return Jt(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,At.LINEAR,St.RGB),this._loadTextureFromBase64(e.searchTexure,At.NEAREST,St.LUMINANCE)]).then(([i,s])=>{yn(r)?(i.dispose(),s.dispose(),Jt(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=s)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const s=new ca;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(tCe,s,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(JEe,s,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(KEe,s,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=mze(this._rctx);const r=new _r(4,4);r.pixelFormat=St.RG,r.internalFormat=Ze.RG8,r.wrapMode=Lt.CLAMP_TO_EDGE,this._passParameters.edges=new nn(this._rctx,r);const i=new _r(4,4);return i.pixelFormat=St.RGBA,i.wrapMode=Lt.CLAMP_TO_EDGE,this._passParameters.blend=new nn(this._rctx,i),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=Fe(this._vao),this._passParameters.areaTexture=Fe(this._passParameters.areaTexture),this._passParameters.searchTexture=Fe(this._passParameters.searchTexture),this._passParameters.blend=Fe(this._passParameters.blend),this._passParameters.edges=Fe(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(r==null)return;r.colorTexture=e;const i=this._rctx,s=i.getBoundFramebufferObject(),n=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,n,o),r.edges.resize(n,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(wi.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3),r.blend.resize(n,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(wi.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3),i.bindFramebuffer(s),i.setClearColor(0,1,0,1),i.clear(wi.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return Lg(e).then(s=>{const n=new _r;return n.pixelFormat=i,n.wrapMode=Lt.CLAMP_TO_EDGE,n.width=s.width,n.height=s.height,n.samplingMode=r,new Ct(this._rctx,n,s)})}};u([d()],M3.prototype,"_abortController",void 0),u([d({readOnly:!0})],M3.prototype,"updating",null),M3=u([R("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],M3);function Aft(t,e){const r=-t[0],i=-t[1],s=-t[2],n=e[3],o=e[7],a=e[11],l=e[15];e[0]+=n*r,e[1]+=n*i,e[2]+=n*s,e[4]+=o*r,e[5]+=o*i,e[6]+=o*s,e[8]+=a*r,e[9]+=a*i,e[10]+=a*s,e[12]+=l*r,e[13]+=l*i,e[14]+=l*s}function Oft(t,e){const r=t[0],i=t[1],s=t[2];e[12]+=r*e[0]+i*e[4]+s*e[8],e[13]+=r*e[1]+i*e[5]+s*e[9],e[14]+=r*e[2]+i*e[6]+s*e[10],e[14]+=r*e[3]+i*e[7]+s*e[11]}let Rft=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new Pft(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{$s(r.viewMatrix,e),Oft(r.origin.vec3,r.viewMatrix)})}},Pft=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=ve()}},Mft=class extends E_e{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=Ni()}},$ft=class extends C_e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ni(),this.slicePlaneLocalOrigin=C(),this.transformNormalGlobalFromModel=Ni()}};function Ift(t){const e=b`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const Lft=cr(.5,-4e-4);function Dft(t,e){const r=t.vertex;r.include(Ift),r.constants.add("depthBias","vec2",Lft),r.uniforms.add(new Tr("inverseViewport",(i,s)=>s.inverseViewport)),e.legacy?(r.uniforms.add(new Di("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new Mh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new Di("transformProjFromView",i=>i.transformProjFromView)),r.code.add(b`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(b`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Nft(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(b`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(b`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Fft(t,e){const r=t.vertex;e.silhouette?(r.code.add(b`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(b`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Uft(t,e){const r=t.vertex;r.include(wc),r.uniforms.add(new Oe("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(b`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new uh("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(E.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*CY),r.code.add(b`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new xO("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(b`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(E.NORMALA,"vec3"),t.attributes.add(E.NORMALB,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(E.NORMAL,"vec3"),r.code.add(b`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(b`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(fN,e),r.include(fN,e),r.uniforms.add(new Mh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new xO("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new iu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new iu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Vt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Vt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(b`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?b`normalize(transformWorldFromModelTL + rotatedModelPosition);`:b`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Di("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(b`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(b`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Vft(t){return t.mode===tn.SKETCH||t.mode===tn.MIXED}var tn,H1;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(tn||(tn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(H1||(H1={}));function MY(t,e){const r=t.vertex;switch(t.attributes.add(E.SIDENESS,"vec2"),e.mode===tn.MIXED?r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(b`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case tn.MIXED:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case tn.SKETCH:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case tn.SOLID:r.code.add(b`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case tn.COUNT:break;default:e.mode}}function zft(t,e){const r=t.vertex;switch(t.include(MY,e),e.mode){case tn.SOLID:r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case tn.SKETCH:r.uniforms.add(new _b("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case tn.MIXED:r.uniforms.add(new _b("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(b`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function kft(t,e){t.include(MY,e);const{vertex:r,fragment:i}=t;switch(Vft(e)&&(r.uniforms.add(new uh("strokesTexture",s=>s.strokesTexture.texture)),r.uniforms.add(new _b("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new _b("strokeVariants",s=>s.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new uh("strokesTexture",s=>s.strokesTexture.texture),new _b("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),r.code.add(b`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(wc),i.code.add(b`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case tn.SOLID:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(b`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case tn.SKETCH:r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(b`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case tn.MIXED:t.varyings.add("vType","float"),r.code.add(b`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(b`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Bft(t){const e=new br,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new rle("model"),new rle("localView")),e.include(Dft,t),e.include(Uft,t),e.include(zft,t),e.include(MY,t),e.include(kft,t),e.include(fs,t),e.include(Fft,t),e.include(Nft,t),e.include(du,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new Tr("pixelToNDC",(s,n)=>sr(Gft,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new rr("viewport",(s,n)=>n.camera.fullViewport),new Oe("pixelRatio",(s,n)=>n.camera.pixelRatio)),e.attributes.add(E.POSITION0,"vec3"),e.attributes.add(E.POSITION1,"vec3"),e.attributes.add(E.VARIANTOFFSET,"float"),e.attributes.add(E.VARIANTSTROKE,"float"),e.attributes.add(E.VARIANTEXTENSION,"float"),r.code.add(b`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?b`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:b`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===tn.SKETCH?b`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===tn.MIXED?b`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(b`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Gft=Ue();let rle=class extends ls{constructor(e){super(e,"mat4")}};const jft=Object.freeze(Object.defineProperty({__proto__:null,build:Bft},Symbol.toStringTag,{value:"Module"}));let iCe=class sCe extends Rr{initializeProgram(e){return new Er(e.rctx,sCe.shader.get().build(this.configuration),fEe)}initializePipeline(e){return e.blendMinMax?Ot({blending:_o(be.ONE,be.ONE,be.ZERO,be.ONE,Nf.ADD,e.blendMinMax.MAX),depthTest:{func:Qr.LEQUAL},colorWrite:Gt}):Ot({depthTest:{func:Qr.LEQUAL},depthWrite:El,colorWrite:Gt})}};iCe.shader=new Sr(jft,()=>ae(()=>import("./EdgeShader.glsl-f0cb43a8.js"),[]));let Yp=class extends Lo{constructor(){super(...arguments),this.mode=tn.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};u([F({count:tn.COUNT})],Yp.prototype,"mode",void 0),u([F()],Yp.prototype,"hasSlicePlane",void 0),u([F()],Yp.prototype,"silhouette",void 0),u([F()],Yp.prototype,"legacy",void 0),u([F()],Yp.prototype,"antialiasing",void 0),u([F()],Yp.prototype,"doublePrecisionRequiresObfuscation",void 0),u([F()],Yp.prototype,"hasMultipassTerrain",void 0),u([F()],Yp.prototype,"cullAboveGround",void 0),u([F()],Yp.prototype,"spherical",void 0);const Hft=8,S9=128,qft={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},Wft={solid:tn.SOLID,sketch:tn.SKETCH,uber:tn.MIXED};let E9=class nCe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new Yp,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[qt.TRANSPARENT]:{[qt.TRANSPARENT]:new Bt,[qt.OPAQUE]:new Bt},[qt.OPAQUE]:{[qt.TRANSPARENT]:new Bt,[qt.OPAQUE]:new Bt}},this._renderablesDirty=!1,this._drawParameters=new $ft,this._settings={...qft,...i},this.key=nCe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:ni.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Wft[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=ki(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){if(this._renderablesDirty&&this._sortRenderables(),r!==qt.INVISIBLE){const i=this._sortedRenderables[r];i[qt.TRANSPARENT].forAll(e),i[qt.OPAQUE].forAll(e)}}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(iCe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,s,n){this._render(e,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(e,r,i,s,n){this._render(e,r,r.silhouette.vao,i,s,n)}_render(e,r,i,s,n,o){o>0&&(this._bindDraw(e,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(Et.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new ZF(r.transform.position),o=Sh(ile,bw(ile,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[qt.TRANSPARENT][qt.TRANSPARENT].clear(),this._sortedRenderables[qt.TRANSPARENT][qt.OPAQUE].clear(),this._sortedRenderables[qt.OPAQUE][qt.TRANSPARENT].clear(),this._sortedRenderables[qt.OPAQUE][qt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==qt.INVISIBLE&&r.edgeTransparency!==qt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[qt.TRANSPARENT][qt.TRANSPARENT].sort(e),this._sortedRenderables[qt.TRANSPARENT][qt.OPAQUE].sort(e),this._sortedRenderables[qt.OPAQUE][qt.TRANSPARENT].sort(e),this._sortedRenderables[qt.OPAQUE][qt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const ile=xl();function KNt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new qke(t.layout)}}function N$(t){return new B_e(t.layout).createView(t.buffer)}let Xft=class extends Q2e{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return zdt(e);const s=await this.invoke(new C9(e),r);return this._unpackOutput(s)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new C9(e),r);return N$(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new C9(e),r);return N$(i)}_unpackOutput(e){return{regular:{instancesData:N$(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:N$(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},C9=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Jd(e.indices)?e.indices:e.indices.buffer,this.indicesType=Jd(e.indices)?"Array":F4(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function Zft(t){const r=hC.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=hC.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=hC.strokes.length;let p=(c-1)*h*l;for(const{distance:y,pressure:_}of hC.strokes){let v=y,w=_,T=p;for(let x=0;x<c;x++){x!==0&&(v=sle(v,XO.DISTANCE),w=sle(w,XO.PRESSURE));for(let S=0;S<hC.resolution;S++){const O=.5+(v?v[S%v.length]/a:0),A=w?w[S%w.length]:1;MO(O,s,T),MO(A,s,T+n),T+=4}T-=l*(h+1)}p+=l}const f=new _r;f.width=f.height=r;const m=new Ct(t,f,s);return new Jft(r,a,o,h,m)}function sle(t,e){if(!t)return null;const r=t.length/2,i=Yft*r,s=new Array(r);let n=0;const o=e===XO.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*nle):Math.min(i,l*nle)}return s}var XO;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(XO||(XO={}));const Yft=.1,nle=.5;let Jft=class{constructor(e,r,i,s,n){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=Fe(this.texture)}};const hC={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function ole(t){let e=null;for(const r of t){const i=r.type;if(Qft(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function ale(t){let e=qt.INVISIBLE;for(const{material:r}of t)if(oCe(r)){if(r.color[3]*r.opacity<1)return qt.TRANSPARENT;e=qt.OPAQUE}return e}function lle(t){let e=qt.INVISIBLE;for(const{material:r}of t)if(oCe(r)){switch(r.objectTransparency){case qt.TRANSPARENT:case qt.INVISIBLE:return qt.TRANSPARENT;case qt.OPAQUE:if(r.opacity<1)return qt.TRANSPARENT}e=qt.OPAQUE}return e}function oCe(t){return t.size*t.color[3]*t.opacity>0}function Qft(t){return t.size*t.color[3]>0}function cle(t,e,r,i){for(let s=0;s<t.length;s++){const n=t[s].index,o=e[s],a=e[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let ud=class extends xe{constructor(e){super(e),this._updatingHandles=new bf,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=C(),this._localOrigins=new Rft(new EZ(e.renderSR))}initialize(){this._worker=new Xft(this.schedule),this._componentColorManager=new yEe(this.rctx,3);const e=dEe.createBuffer(4);for(let r=0;r<4;r++)e.sideness.set(r,0,r===0||r===3?0:1),e.sideness.set(r,1,r===0||r===1?0:1);this._verticesBufferObject=Ir.createVertex(this.rctx,xr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=Fe(this._strokesTexture),this._componentColorManager=Pe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Fe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",smt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,r,i,s,n,o,a,l){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let c;const h=new hle(new Promise(f=>c=f),i.center,i.radius);this._perObjectData.set(e,h);const p=await this._updatingHandles.addPromise(this._addComponentGeometry(r,h,s,n,o,a,l));return this.setNeedsRender(),c(),p}async addOrUpdateObject3D(e,r,i,s){if(this.destroyed)return void J.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(e);let o;(n==null?void 0:n.renderables.length)>0&&this._perObjectDataEvictionCache.add(n);const a=e.boundingVolumeWorldSpace.bounds,l=new hle(new Promise(h=>o=h),a,cg(a));this._perObjectData.set(e,l);const c=new Array;if(i.mergeGeometries&&e.geometries.length>1&&Kft(e))c.push(this._addObjectMergedGeometries(e,l,r,i,s));else for(let h=0;h<e.geometries.length;h++){const p=e.geometries[h];p.material.supportsEdges&&c.push(this._addGeometry(e,l,p,r[0],i,s))}await this._updatingHandles.addPromise(Promise.all(c)),this._perObjectDataEvictionCache.delete(l),this._discardObjectEntry(n),this.setNeedsRender(),o()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(r=>this._removeRenderable(r)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(i==null)return;const s=r instanceof Array?n=>r[n]:()=>r;i.renderables.forEach(n=>{const o=n.components.meta.length;for(let a=0;a<o;a++){const l=s(a),c=n.components.meta[a],h=c.index;c.material.opacity=l,n.components.buffer.textureBuffer.setDataElement(h,1,3,255*l)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const r=await this._getObjectEntry(e);return r!=null?r.renderables.reduce((i,s)=>i+s.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,r,i,s){const n=e instanceof Yg,o=!!i.hasSlicePlane,a=ole(r),l=E9.getKey(a,o,n),c=await this._updatingHandles.addPromise(this._getObjectEntry(e));c!=null&&(c.renderables.forEach(h=>{if(l!==h.rendererKey){const p=this._renderers.get(h.rendererKey),f=this._acquireRenderer(a,o,n);p.removeRenderable(h),--p.refCount,h.rendererKey=l,f.addRenderable(h)}for(let p=0;p<r.length;p++)h.components.meta[p].material=r[p];s&&this._updateComponentBuffer(h.components),this._updateTransparency(h)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(s=>{const n=s.components.meta;for(let o=0;o<n.length;o++)s.components.meta[o].verticalOffset=(r==null?void 0:r[o])??0;this._updateComponentBuffer(s.components)}),this.setNeedsRender())}async updateObjectVisibility(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(s=>s.visible=r),this.setNeedsRender())}removeObject(e){const r=this._perObjectData.get(e);r&&(this._perObjectData.delete(e),this._discardObjectEntry(r))}async _getObjectEntry(e){const r=this._perObjectData.get(e);if(!r)throw new Error("no object");return await r.loaded,r.loaded==null?null:r}render(e,r){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,s=C(),n=new ZF;let o=0,a=0;if(this._renderers.forEach(c=>{if(c.refCount===0)this._renderers.delete(c.key),c.dispose();else{let h=!0,p=!0;c.forEachRenderable(f=>{f.visible&&(o+=f.statistics.averageEdgeLength,a++,h&&f.regular&&(c.updateTechnique(e,!1),h=!1),p&&f.silhouette&&(c.updateTechnique(e,!0),p=!1))},r)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const l=new Mft(40*o/a,r);se(s,i[3],i[7],i[11]),n.set(s),re(l.transformWorldFromViewTH,n.high),re(l.transformWorldFromViewTL,n.low),Th(l.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Sh(mle,l.transformViewFromCameraRelativeRS),bw(l.transformNormalViewFromGlobal,mle),l.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(c=>{this._renderRegularEdges(c,e,l),this._renderSilhouetteEdges(c,e,l)})}_updateTransparency(e){const r=ale(e.components.meta),i=lle(e.components.meta);r===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=r,e.objectTransparency=i,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,r,i){e.getCombinedShaderTransformation(r,i);const s=r.localOrigin!=null?this._localOrigins.register(r.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,i[12],i[13],i[14]));return r.localOrigin=s.origin,Aft(s.origin.vec3,i),s}_updateComponentBuffer(e){const{meta:r,buffer:i}=e,s=new Uint8Array(4);for(let n=0;n<r.length;n++){const o=r[n].material,a=r[n].index,l=ye(Math.round(o.size*Hft),0,255),c=ye(o.extensionLength,-S9,255-S9)+S9,h=o.type==="solid"?_4.SOLID:_4.SKETCH,p=255*o.opacity,f=o.color,m=255*f[0],y=255*f[1],_=255*f[2],v=255*f[3];i.textureBuffer.setData(a,0,m,y,_,v),i.textureBuffer.setData(a,1,l,c,h,p),lEe(r[n].verticalOffset,s),i.textureBuffer.setData(a,2,s[0],s[1],s[2],s[3])}}_createComponentBuffers(e){if(this._componentColorManager==null)return null;const r=new Array,i=this._componentColorManager.getBuffer(e.length);for(let n=0;n<e.length;n++){const o=e[n],a=i.acquireIndex();r.push({index:a,verticalOffset:0,material:o})}const s=new emt(i,r);return this._updateComponentBuffer(s),s}_extractEdges(e,r,i,s,n,o=n.length){return this._worker.process({data:r,indices:n,indicesLength:o,writerSettings:e,skipDeduplicate:i},this._workerAbort.signal,s)}_createRenderable(e,r,i,s,n){const o=h=>this._verticesBufferObject!=null?new tmt(new ap(this.rctx,fEe,{vertices:Rdt,instances:h===H1.REGULAR?g4.glLayout:y4.glLayout},{vertices:this._verticesBufferObject,instances:Ir.createVertex(this.rctx,xr.STATIC_DRAW,h===H1.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),h===H1.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,a=e.regular.lodInfo.lengths.length>0?o(H1.REGULAR):null,l=e.silhouette.lodInfo.lengths.length>0?o(H1.SILHOUETTE):null,c=((a==null?void 0:a.vao.memoryEstimate)??0)+((l==null?void 0:l.vao.memoryEstimate)??0);return new imt(a,l,{gpuMemoryUsage:c,externalMemoryUsage:n,averageEdgeLength:e.averageEdgeLength},i,ale(r.meta),lle(r.meta),r,s)}async _addGeometry(e,r,i,s,n,o){const a=i.vertexAttributes.get(E.POSITION),l=i.indices.get(E.POSITION),c=ve(),h=this._computeModelTransformWithLocalOrigin(e,i,c),p=new fle(a,l,c,h);return this._addPositionData(r,p,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,r,i,s,n,o=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([s]);if(a==null||i<=0)return;const l=this._acquireRenderer(s.type,!!n.hasSlicePlane,!0),{modelTransform:c,origin:h}=r,p=r.indices,f=r.position,m=f.data.length/f.size,y=f4.createBuffer(m);for(let w=0;w<m;w++)y.position.set(w,0,f.data[w*f.size]),y.position.set(w,1,f.data[w*f.size+1]),y.position.set(w,2,f.data[w*f.size+2]);cle(a.meta,[0,y.componentIndex.count],y.componentIndex);const _=await this._updatingHandles.addPromise(this._extractEdges(l.writerSettings,y,!1,o,p,i));if(e.loaded==null)return;const v=this._createRenderable(_,a,new rmt(c,h),l.key,!1);e.renderables.push(v),l.addRenderable(v),this._gpuMemoryUsage+=v.statistics.gpuMemoryUsage}async _addComponentGeometry(e,r,i,s,n,o,a){if(r.loaded==null)return 0;const l=this._createComponentBuffers(o);if(l==null)return 0;const c=ole(o),h=this._acquireRenderer(c,a.hasSlicePlane||!1,!1),p=f4.createBuffer(i.length/3);HR(p.position.typedBuffer,i,p.position.typedBufferStride,3),cle(l.meta,n,p.componentIndex,s);const f=!0,m=h.writerSettings,y=await this._updatingHandles.addPromise(this._extractEdges(m,p,f,!1,s));if(r.loaded==null)return 0;const _=this._createRenderable(y,l,e,h.key,!0);return r.renderables.push(_),h.addRenderable(_),_.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,r,i,s,n){const o=new Map;let a=0,l=null,c=0;for(let T=0;T<e.geometries.length;T++){const x=e.geometries[T];if(!x.material.supportsEdges)continue;!l&&x.localOrigin&&(l=x);const S=x.vertexAttributes.get(E.POSITION);c+=S.data.length/S.size,a+=x.edgeIndicesLength}const h=c>=65536?Uint32Array:Uint16Array,p=a?new h(a):null,f=[];let m=0;for(let T=0;T<e.geometries.length;T++){const x=e.geometries[T];if(!x.material.supportsEdges)continue;const S=x.vertexAttributes.get(E.POSITION),O=x.indices.get(E.POSITION);let A=o.get(S.data);if(A==null){A=f.length/3;for(let P=0;P<S.data.length;P+=S.size)f.push(S.data[P]),f.push(S.data[P+1]),f.push(S.data[P+2]);o.set(S.data,A)}if(O)for(let P=0;P<x.edgeIndicesLength;P++)p[m++]=A+O[P]}const y=l||e.geometries[0],_=ve(),v=this._computeModelTransformWithLocalOrigin(e,y,_);for(let T=0;T<e.geometries.length;T++)e.geometries[T].localOrigin=v.origin;const w=new fle({data:f,size:3},p,_,v);await this._updatingHandles.addPromise(this._addPositionData(r,w,p.length,i[0],s,n))}_acquireRenderer(e,r,i){const s=E9.getKey(e,r,i);let n=this._renderers.get(s);return this._strokesTexture==null&&(this._strokesTexture=Zft(this.rctx)),n||(n=new E9(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:r,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===Ie.Global}),this._renderers.set(s,n)),++n.refCount,n}_removeRenderable(e){ule(e.regular),ule(e.silhouette);const r=this._renderers.get(e.rendererKey);if(r){r.removeRenderable(e),--r.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const r=e.camera.eye,i=e.camera.viewForward,s=C(),n=o=>{_n(s,o.center,r);const a=me(s,i),l=o.radius,c=a<-l?1/0:a<l?0:a-l;o.renderables.forEach(h=>h.distanceToCamera=c)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(e,r,i){const s=e.bindRegularEdges(i,r),n=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!dle(a)||!a.visible)return;const l=F$(a.regular.lod.lengths,a.distanceToCamera,o);e.renderRegularEdges(s,a,i,r,l)},n)}_renderSilhouetteEdges(e,r,i){const s=e.bindSilhouetteEdges(i,r),n=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!ple(a)||!a.visible)return;const l=F$(a.silhouette.lod.lengths,a.distanceToCamera,o);e.renderSilhouetteEdges(s,a,i,r,l)},n)}get test(){return{hasRenderedPrimitives:e=>{let r=!1;const i=e.perScreenPixelRatio,s=(n,o)=>n.forEachRenderable(a=>{a.visible&&!r&&(dle(a)&&(r=F$(a.regular.lod.lengths,a.distanceToCamera,i)>0),!r&&ple(a)&&(r=F$(a.silhouette.lod.lengths,a.distanceToCamera,i)>0))},o);return this._renderers.forEach(n=>{r||(s(n,qt.OPAQUE),s(n,qt.TRANSPARENT))}),r}}}};function ule(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function Kft(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const s=t.geometries[i];if(s.material.supportsEdges){if(e){if(!wg(e,s.transformation))return!1}else e=s.transformation;if(r||s.localOrigin==null){if(r&&r.localOrigin!=null&&s.localOrigin!=null&&r.localOrigin.id!==s.localOrigin.id)return!1}else r=s}}return!0}u([d({constructOnly:!0})],ud.prototype,"rctx",void 0),u([d({constructOnly:!0})],ud.prototype,"renderSR",void 0),u([d({constructOnly:!0})],ud.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],ud.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],ud.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],ud.prototype,"schedule",void 0),u([d({readOnly:!0})],ud.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],ud.prototype,"updating",null),ud=u([R("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],ud);let hle=class{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}},emt=class{constructor(e,r){this.buffer=e,this.meta=r}},tmt=class{constructor(e,r){this.vao=e,this.lod=r}},rmt=class{constructor(e,r){this.modelMatrix=e,this.origin=r}},imt=class{constructor(e,r,i,s,n,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function dle(t){return t.regular!=null}function ple(t){return t.silhouette!=null}function F$(t,e,r){const i=e*r,s=Sue(t,i,!0);return s===-1?i<t[0]?t.length:0:t.length-s}let fle=class{constructor(e,r,i,s){this.position=e,this.indices=r,this.modelTransform=i,this.origin=s}};const mle=Ni(),smt=()=>Promise.reject();function up(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let gle=class{constructor(e,r,i,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},Dm=!1;function nmt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&up(t)?new gle(()=>t.createQuery(),i=>{t.deleteQuery(i),Dm=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{Dm||(Dm=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),Dm=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new gle(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),Dm=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{Dm||(Dm=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),Dm=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function omt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new amt(r,e)}let amt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){Dm||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var vi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(vi||(vi={}));const yle="Total";let lmt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new ig(yle),this._cpuTimeSamplers=new Map(Object.values(vi).map(r=>[r,new ig(r)])),this._enableGPUTimer=0,this._totalGPUTime=new ig("GPU"),this._gpuTimeSamplers=new Map(Object.values(vi).map(r=>[r,new ig(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(vi),yle];this._gpuTimerPool=omt(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:xH(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Fe(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(vi.FINISH);this._gpuTimeSamplers.get(vi.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},zl=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(e=null,r=!oe("disable-feature:high-quality-idle")){this._renderStateFeatures=ote(r,e),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(e,r=this._state){var i;return((i=this._renderStateFeatures)==null?void 0:i.get(r,e))??!1}setFeatureEnabled(e,r,i){var s;(s=this._renderStateFeatures)==null||s.set(r,e,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Bs.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Bs.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Bs.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,r,i,s,n,o,a,l){super({}),this._stage=e,this._materialRepository=r,this._techniqueRepository=s,this._rctx=n,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._materialRenderers=new Bt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=c=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new _ft,this._state=$r.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=dn.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Ppt,this._handles=new Pi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(e.view.qualityProfile),this._smaaPass=new M3(this._rctx,s),l(),this._offscreen=new Ypt(this._rctx,this._compositingHelper),this.performanceInfo=new lmt(this._rctx),this._shadowMap=new AZ(this._rctx,e.viewingMode),this._ssaoHelper=new Fxe(e.view,s,this._rctx,l),this._highlight=new qpt(s,this._rctx),this._shadowHighlight=new yft(this._rctx,e.viewingMode),this._shadowAccumulator=new cl(this._rctx,s,e,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(L.Shadow,c.shadowMap),c.camera.setGLViewport(this._rctx),this._prepare(c.camera,c.contentCamera)},l),this._renderContext=new gQe(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new P3({renderContext:this._renderContext,techniqueRepository:s,textureRepository:i,materialRepository:this._materialRepository,requestRender:l,controller:e}),this.renderPassManager=new Rpt(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ue(()=>this._stage.view.state.camera,()=>l(),Cs),ue(()=>ni.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(qt.TRANSPARENT):()=>{},l()},Vr),ue(()=>this._ssaoEnabled||this.isFeatureEnabled(Bs.SSAO),c=>this._ssaoHelper.enabled=c,Cs)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Li(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=Fe(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Pe(this._edgeView),this.renderPassManager.destroy(),X_e.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const e=this._stage.view.resourceController;this._edgeView=new ud({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:cmt(e)}),this._handles.add(ue(()=>oc(this._edgeView,r=>r.updating),()=>this._requestRender(),Gr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return nW(this._bindParameters.ssr.reprojectionMatrix,sn)}set _reprojectionMatrix(e){_H(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var s,n;const{_shadowMap:r,_bindParameters:i}=this;if(((s=e.qualitySettings)==null?void 0:s.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),((n=e.qualitySettings)==null?void 0:n.ambientOcclusion)!==void 0&&this._ssaoEnabled!==e.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=e.qualitySettings.ambientOcclusion,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const o=e.environment.lighting.type!=="virtual";i.enableFillLights!==o&&(i.enableFillLights=o,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,r){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:s,updates:n}=e;if(i.length===0&&s.length===0&&n.length===0)return;const o=vxe(e);let a=!1;o.forEach((l,c)=>{if(r.done)return;let h=this._materialRenderers.find(p=>p.material===c);h==null&&l.adds.length>0&&(h=new Pxe(this._rctx,this._materialRepository,c),this._materialRenderers.push(h)),h&&(h.modify(l),h.isEmpty&&(a=!0)),l.removes.forEach(p=>e.removes.removeUnordered(p)),l.adds.forEach(p=>e.adds.removeUnordered(p)),l.updates.forEach(p=>e.updates.removeUnordered(p)),r.madeProgress()}),a&&this._materialRenderers.filterInPlace(l=>!l.isEmpty||(l.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(l=>l.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(l=>l.hasOccludees),this._hasWater=this._materialRenderers.some(l=>l.hasWater),this._hasHUDElements=this._materialRenderers.some(l=>l.requiresSlot(ce.LINE_CALLOUTS_HUD_DEPTH,L.Color)||l.requiresSlot(ce.HUD_MATERIAL,L.Color)||l.requiresSlot(ce.LABEL_MATERIAL,L.Color)),this._requestRender()}updateAnimation(e){const r=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?Li(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,r,i,s,n){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=i;this._state=l,this._renderOverlay(n),this.performanceInfo.advance(vi.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=st.NONE,this._bindParameters.alignPixelEnabled=c;const h=this._offscreen;h.setupRenderTarget(this.hasReflections);const p=Vg(this._sliceHelper.plane);s===zb.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),o.setGLViewport(this._rctx),this._prepare(o,a),this._renderPlugins.prepareRender(),this.performanceInfo.advance(vi.PREPARE);const f=this._computeDepthRange(o);this._renderShadowMap(e,o,this._bindParameters.lighting.mainLight.direction,f),this.performanceInfo.advance(vi.SHADOW_MAP),h.initializeFrame(o),this._ensureBindParameters(o,a);const m=this._terrainRenderingEnabled&&(this._terrainTransparency===dn.Semitransparent||this._terrainTransparency===dn.TransparentWithDraped),y=this._highQualityTransparency&&m,_=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(y,_),this._renderLinearDepth(),this.performanceInfo.advance(vi.LINEAR_DEPTH),this._accumulateShadows(f,o,a),this.performanceInfo.advance(vi.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(vi.NORMALS),this._ensureBindParametersSSR(n),this._renderSSAO(n),this.performanceInfo.advance(vi.SSAO),this._renderContext.output=L.Color,h.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(vi.OPAQUE),this._renderTerrainLinearDepth(y),this._setMultipassTerrain(y),this._renderEdges(qt.OPAQUE),this.performanceInfo.advance(vi.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(ce.VOXEL),this.performanceInfo.advance(vi.VOXEL),this._renderHiddenTransparentEdges(),_&&(this._oitEnabled?this._renderOITPass(QT.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(vi.TRANSPARENT),this._renderGeometryLinearDepth(y);const v=this._renderHUDVisibility(y);y||this._renderInternalSlot(ce.LINE_CALLOUTS),this.performanceInfo.advance(vi.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(r),this.performanceInfo.advance(vi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(qt.TRANSPARENT,y),this.performanceInfo.advance(vi.TRANSPARENT_EDGES),this._renderTransparentTerrain(),m&&v&&(y?this._renderLineCallouts(Xl.Occluded):h.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Xl.Occluded,h.framebuffer),this.performanceInfo.advance(vi.HUD_OCCLUDED)),this.performanceInfo.advance(vi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),m&&(h.compositeTransparentTerrainOntoMain(this._bindParameters),y&&(this._renderEdges(qt.OPAQUE),this.performanceInfo.advance(vi.OPAQUE_EDGES),_&&(this._oitEnabled?this._renderOITPass(QT.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(vi.TRANSPARENT),this._renderEdges(qt.TRANSPARENT),this.performanceInfo.advance(vi.TRANSPARENT_EDGES))),y&&this._renderLineCallouts(Xl.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),h.renderToTargets(()=>{this._renderInternalSlot(ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(ce.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(ce.LASERLINES)},h.currentColorTarget,h.mainDepth),this.performanceInfo.advance(vi.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&h.renderTmpAndCompositeToMain(()=>this._renderSlot(ce.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ta.PremultipliedAlpha),this.performanceInfo.advance(vi.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(vi.OCCLUDED);const w=s===zb.ON&&this._magnifierHelper.enabled,T=w&&e==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(T);const x=this._offscreen.colorTexture;this._renderAntiAliasing(x)||x==null||this._compositingHelper.composite(this._bindParameters,x,ta.None),this.performanceInfo.advance(vi.ANTIALIASING),this._renderHUD(Xl.NotOccluded,T),this.performanceInfo.advance(vi.HUD),this._renderHighlights(T,this._bindParameters),this.performanceInfo.advance(vi.HIGHLIGHTS),w&&this._magnifierHelper.render(this._rctx,this._bindParameters),T!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,ta.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=p,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(e,r){this._renderContext.output=L.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(e),this._prepareSlots(ce.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._prepareInternalSlots(this._materialRenderers,ce.LINE_CALLOUTS),r&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(ce.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,ce.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(e){if(e!=null&&oe("enable-feature:objectAndLayerId-rendering")){const r=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(L.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Xl.NotOccluded,this._renderInternalSlot(ce.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=r}}finish(e){this._hasAnimations||this._animationTimestep.clear();const r=this.performanceInfo.gpuSamplingEnabled,i=e===ps.BACKGROUND;if(i||r){const s=i?this.performanceInfo.elapsedTime:0,n=r?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,i)}}readDepthPixels(e,r,i){const s=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const n=wi.COLOR_BUFFER_BIT|wi.DEPTH_BUFFER_BIT|wi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(n),this._renderGeometryAndTransparentTerrainPass(L.Depth)}s.readPixels(r[0],r[1],r[2],r[3],St.RGBA,Us.UNSIGNED_BYTE,i)}readHUDVisibility(e,r,i,s,n){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,r,i,s,St.RGBA,Us.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_prepareSlots(...e){this._renderPlugins.prepareSlots(e)}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,r=!1){const i=this._edgeView;i!=null&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,ta.Alpha,r)}_renderShadowMap(e,r,i,s){const n=this._shadowMap;n.enabled&&(n.start(r,i,s,this.isFeatureEnabled(Bs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(r,i),this._needsShadowHighlight?(this._renderShadowCascades(L.ShadowHighlight,this._shadowMap,o=>n.takeCascadeSnapshotTo(o,vS.Highlight)),n.clear(),this._renderShadowCascades(L.ShadowExcludeHighlight,this._shadowMap,o=>{n.takeCascadeSnapshotTo(o,vS.Default),this._renderGeometryAndTransparentTerrainPass(L.ShadowHighlight)})):this._renderShadowCascades(L.Shadow),n.finish(e),r.setGLViewport(this._rctx))}_renderShadowCascades(e,r=this._shadowMap,i=s=>{}){for(const s of r.cascades)s.camera.setGLViewport(this._rctx),this._prepare(s.camera,s.camera),this._renderGeometryAndTransparentTerrainPass(e),i(s)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(L.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const r=this._renderContext.output;this._renderContext.output=L.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const r=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(L.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(L.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return RG;const r=dpt(e,this._materialRenderers,this._stage.layers);return TS(r,this.renderPlugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._prepareSlots(ce.TRANSPARENT_TERRAIN),this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._prepareSlots(ce.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(ce.INTEGRATED_MESH,ce.OPAQUE_TERRAIN,ce.OPAQUE_MATERIAL,ce.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,ce.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(ce.INTEGRATED_MESH),this._renderSlot(ce.OPAQUE_TERRAIN),this._renderInternalSlot(ce.OPAQUE_MATERIAL),this._renderSlot(ce.OPAQUE_MATERIAL),this._renderSlot(ce.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(ce.TRANSPARENT_MATERIAL),this._renderSlot(ce.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(ce.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let r=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,r=this._renderInternalSlot(ce.OCCLUSION_PIXELS)},e),r}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Xl.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(ce.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(ce.LINE_CALLOUTS)}_renderHUD(e,r){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(QT.HUD,e),this._rctx.bindFramebuffer(r),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,ta.PremultipliedAlpha)):e===Xl.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(Xl.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._prepareInternalSlots(this._materialRenderers,ce.LINE_CALLOUTS_HUD_DEPTH,ce.HUD_MATERIAL,ce.LABEL_MATERIAL),this._renderInternalSlot(ce.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(ce.HUD_MATERIAL),this._renderInternalSlot(ce.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,r){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,s=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(L.Highlight),this._rctx.clearSafe(wi.DEPTH_BUFFER_BIT),this._renderHUDElements(Xl.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=s.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(r,e),i.render(this._bindParameters,s,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,r,i){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,r,i)}_prepareTransparencySlots(){this._renderContext.output=L.Alpha,this._bindParameters.transparencyPassType=st.Alpha,this._prepareInternalSlots(this._materialRenderers,ce.TRANSPARENT_MATERIAL),this._prepareSlots(ce.TRANSPARENT_MATERIAL),this._renderContext.output=L.Color,this._bindParameters.transparencyPassType=st.Color,this._prepareInternalSlots(this._materialRenderers,ce.TRANSPARENT_MATERIAL),this._prepareSlots(ce.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=st.FrontFace,this._prepareInternalSlots(this._materialRenderers,ce.TRANSPARENT_MATERIAL),this._prepareSlots(ce.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=st.NONE}_renderOITPass(e,r=Xl.Both){const i=e===QT.HUD,s=i?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),n=a=>{this._bindParameters.transparencyPassType=a,this._offscreen.renderOITPass(s,a,i)},o=this._renderContext.output;this._renderContext.output=L.Alpha,n(st.Alpha),this._renderContext.output=L.Color,n(st.Color),n(st.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,i),this._bindParameters.transparencyPassType=st.NONE,this._renderContext.output=o,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let e=0;Pc.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&o.material.renderOccluded===Ii.OccludeAndTransparentStencil&&(e|=o.material.renderOccluded,Pc.push(o))});const r=this._offscreen,i=(o,a,l,c,h)=>{e&a&&(r.renderToTargets(l,r.tmpColor,r.mainDepth,[0,0,0,0],c,h),r.compositeOccludedOntoMain(this._bindParameters,o))};Pc.length!==0&&(this._prepareInternalSlots(Pc,ce.OCCLUDER_MATERIAL,ce.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(ce.OCCLUDER_MATERIAL,Pc),i(.5,Ii.OccludeAndTransparentStencil,()=>this._renderInternalSlot(ce.TRANSPARENT_OCCLUDER_MATERIAL,Pc),!1,!1)),Pc.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&(o.material.renderOccluded===Ii.OccludeAndTransparent||o.material.renderOccluded===Ii.Transparent||o.material.renderOccluded===Ii.Opaque)&&(e|=o.material.renderOccluded,Pc.push(o))});const s=this._renderPlugins.renderOccludedFlags;if(e|=s,!e)return;const n=o=>{this._renderContext.renderOccludedMask=o,this._prepareInternalSlots(Pc,ce.OPAQUE_MATERIAL,ce.TRANSPARENT_MATERIAL,ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),s>Ii.Occlude&&this._renderSlot(ce.OCCLUDED_TERRAIN),this._renderInternalSlot(ce.OPAQUE_MATERIAL,Pc),this._renderInternalSlot(ce.TRANSPARENT_MATERIAL,Pc),this._renderInternalSlot(ce.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Pc),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=L.Color,i(.5,Ii.OccludeAndTransparent,()=>n(Ii.OccludeAndTransparent),!0,wl.OutlineVisualElementMask),i(.5,Ii.Transparent,()=>n(Ii.Transparent),!0,wl.OutlineVisualElementMask),i(1,Ii.Opaque,()=>n(Ii.Opaque),!0,wl.OutlineVisualElementMask),Pc.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&e!=null)return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,r){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(ce.TRANSPARENT_MATERIAL,L.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=r}_ensureBindParameters(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=sn:(bn(vle,this._bindParameters.camera.viewMatrix),bn(_le,this._bindParameters.camera.projectionMatrix),si(Mx,vle,_le),si(Mx,this._renderContext.lastFrameCamera.viewMatrix,Mx),si(Mx,this._renderContext.lastFrameCamera.projectionMatrix,Mx),this._reprojectionMatrix=Mx),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const r=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=r>0?Math.min(r,e-this._ssrEnableTime)/r:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=sn,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(e,...r){for(const i of r)this._bindParameters.slot=i,e.forAll(s=>{s.material.shouldRender(this._renderContext)&&s.prepareTechnique(this._renderContext)})}_renderInternalSlot(e,r=this._materialRenderers){let i=!1;return this._bindParameters.slot=e,r.forAll(s=>{if(s.material.shouldRender(this._renderContext)){const n=s.prepareTechnique(this._renderContext);n!=null&&(s.render(this._renderContext,n),i=!0)}}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=j0e(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,r,i,s,n;return{offscreen:((e=this._offscreen)==null?void 0:e.gpuMemoryUsage)??0,highlights:(((r=this._highlight)==null?void 0:r.gpuMemoryUsage)??0)+(((i=this._shadowHighlight)==null?void 0:i.gpuMemoryUsage)??0),shadows:((s=this._shadowMap)==null?void 0:s.gpuMemoryUsage)??0,ssao:((n=this._ssaoHelper)==null?void 0:n.gpuMemoryUsage)??0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=ote()},getFramebufferTexture:r=>{switch(r){case S0.Color:return e._offscreen.colorTexture;case S0.LinearDepth:return e._offscreen.linearDepthTexture;case S0.Normals:return e._offscreen.normalTexture;case S0.ShadowMap:return e._shadowMap.depthTexture;case S0.HudVisibility:return e._offscreen.hudVisibilityTexture;case S0.Highlight:return e._offscreen.highlightTexture}}}}};var QT,S0;u([d()],zl.prototype,"_renderPlugins",void 0),u([d()],zl.prototype,"_shadowAccumulator",void 0),u([d()],zl.prototype,"_state",void 0),u([d()],zl.prototype,"_renderStateFeatures",void 0),u([d()],zl.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],zl.prototype,"_antialiasing",null),u([d()],zl.prototype,"_ssaoEnabled",void 0),u([d()],zl.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],zl.prototype,"_edgeView",void 0),u([d()],zl.prototype,"updating",null),u([d()],zl.prototype,"isCameraFinal",null),zl=u([R("esri.views.3d.webgl-engine.lib.Renderer")],zl),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(QT||(QT={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(S0||(S0={}));const Pc=new Bt,_le=ve(),vle=ve(),Mx=ve();function cmt(t){return e=>t.immediate.schedule(e)}let aCe=class lCe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=lCe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Ir.createIndex(this._rctx,xr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,wt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Et.POINTS,1,Ke.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},ble=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:be.ONE,dstRGB:be.ZERO,srcAlpha:be.ONE,dstAlpha:be.ZERO},this.blendEquation={mode:Nf.ADD,modeAlpha:Nf.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Ud.BACK,this.frontFace=rS.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Qr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Ud.FRONT_AND_BACK,func:Qr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Ud.FRONT_AND_BACK,fail:ms.KEEP,zFail:ms.KEEP,zPass:ms.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},umt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${i}: ${n.shift()}
`,n.forEach(o=>e+=`   ${o}
`)})}return e}};const hmt={RECORD_ALLOCATIONS:!1};let dmt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new umt(hmt.RECORD_ALLOCATIONS);this._current.length<vn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<vn.COUNT;++r){const i=this._current[r];i>0&&(e+=`${vn[r]}: ${i}
`)}}return e+=this._allocations.information,e}},pmt=class{constructor(e,r,i){const s=r.textureFilterAnisotropic,n=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),up(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const fmt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var wle,cCe={exports:{}};(wle=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(cCe.exports=wle);const mmt=OR(cCe.exports);var xle,UG={exports:{}};UG.exports,xle=UG,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(xle.exports=e)}();const Tle=OR(UG.exports);var uCe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(uCe);const gmt=OR(uCe.exports);var Zh=999,Sle=9999,A9=0,O9=1,Ele=2,Cle=3,Ale=4,U$=5,ymt=6,_mt=7,vmt=8,Ole=9,bmt=10,Rle=11,wmt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function xmt(){var t,e,r,i=0,s=0,n=Zh,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(z){return a=[],z!==null?_(z.replace?z.replace(/\r\n/g,`
`):z):v()};function y(z){z.length&&a.push({type:wmt[n],data:z,position:h,line:l,column:c})}function _(z){var Z;for(i=0,r=(m+=z).length;t=m[i],i<r;){switch(Z=i,n){case A9:i=O();break;case O9:i=S();break;case Ele:i=x();break;case Cle:i=A();break;case Ale:i=V();break;case Rle:i=I();break;case U$:i=k();break;case Sle:i=B();break;case Ole:i=T();break;case Zh:i=w()}Z!==i&&(m[Z]===`
`?(c=0,++l):++c)}return s+=i,m=m.slice(i),a}function v(z){return o.length&&y(o.join("")),n=bmt,y("(eof)"),a}function w(){return o=o.length?[]:o,e==="/"&&t==="*"?(h=s+i-1,n=A9,e=t,i+1):e==="/"&&t==="/"?(h=s+i-1,n=O9,e=t,i+1):t==="#"?(n=Ele,h=s+i,i):/\s/.test(t)?(n=Ole,h=s+i,i):(p=/\d/.test(t),f=/[^\w_]/.test(t),h=s+i,n=p?Ale:f?Cle:Sle,i)}function T(){return/[^\s]/g.test(t)?(y(o.join("")),n=Zh,i):(o.push(t),e=t,i+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(y(o.join("")),n=Zh,i)}function S(){return x()}function O(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),n=Zh,i+1):(o.push(t),e=t,i+1)}function A(){if(e==="."&&/\d/.test(t))return n=U$,i;if(e==="/"&&t==="*")return n=A9,i;if(e==="/"&&t==="/")return n=O9,i;if(t==="."&&o.length){for(;P(o););return n=U$,i}if(t===";"||t===")"||t==="("){if(o.length)for(;P(o););return y(t),n=Zh,i+1}var z=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||z){for(;P(o););return n=Zh,i}return o.push(t),e=t,i+1}function P(z){for(var Z,W,H=0;;){if(Z=Tle.indexOf(z.slice(0,z.length+H).join("")),W=Tle[Z],Z===-1){if(H--+z.length>0)continue;W=z.slice(0,1).join("")}return y(W),h+=W.length,(o=o.slice(W.length)).length}}function I(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),n=Zh,i):(o.push(t),e=t,i+1)}function V(){return t==="."||/[eE]/.test(t)?(o.push(t),n=U$,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(n=Rle,o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=Zh,i):(o.push(t),e=t,i+1)}function k(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),n=Zh,i):(o.push(t),e=t,i+1)}function B(){if(/[^\d\w_]/.test(t)){var z=o.join("");return n=mmt.indexOf(z)>-1?vmt:gmt.indexOf(z)>-1?_mt:ymt,y(o.join("")),n=Zh,i}return o.push(t),e=t,i+1}}function Tmt(t){var e=xmt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function Smt(t){return Tmt(t)}function Emt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const R9=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Cmt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return s.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function Amt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function $3(t,e,r,i){i=i||r;for(const s of t)if(s.type==="ident"&&s.data===r)return i in e?e[i]++:e[i]=0,$3(t,e,i+"_"+e[i],i);return r}function hCe(t,e,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++h:/\#endif\s*.*/.test(m.data)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=i(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function Omt(t,e,r,i="lowp"){hCe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Rmt(t,e,r,i,s="lowp"){hCe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Pmt(t,e){let r,i,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),s}function Ple(t,e){if(t.startsWith("#version 300"))return t;const r=Smt(t);if(Cmt(r,"100","300 es")==="300 es")return t;let i=null,s=null;const n={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===Wc.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Wc.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Wc.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=$3(r,n,"fragColor"),Omt(r,i,"vec4")),l.data=i),e===Wc.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Pmt(r,a+1),h=$3(r,n,"fragData");Rmt(r,h,"vec4",c,"mediump"),l.data=h}else e===Wc.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=$3(r,n,"gl_FragDepth")),l.data=s);break;case"ident":if(fmt.includes(l.data)){if(e===Wc.VERTEX_SHADER&&Amt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=$3(r,n,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&R9.includes(c[1].trim())){const f=r[a+1];r.splice(a,f&&f.type==="whitespace"?2:1)}const h=l.data.match(/\#ifdef\s+(.*)/);h&&h[1]&&R9.includes(h[1].trim())&&(l.data="#if 1");const p=l.data.match(/\#ifndef\s+(.*)/);p&&p[1]&&R9.includes(p[1].trim())&&(l.data="#if 0")}}return Mmt(t,Emt(r))}function Mmt(t,e){return e}const $mt=4294967295;let Imt=class{constructor(e,r,i,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===or.WEBGL2&&(r=Ple(r,Wc.VERTEX_SHADER),i=Ple(i,Wc.FRAGMENT_SHADER)),this._vShader=Mle(this._context,Wc.VERTEX_SHADER,r),this._fShader=Mle(this._context,Wc.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(vn.Shader,this),oB()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),oB()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===or.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<$mt&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(vn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(vn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(vn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){Mp(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Mp(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Mp(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Mp(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){Mp(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),s[0]=r,s[1]=i)}setUniform2fv(e,r){Mp(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),this._nameToUniform3.set(e,[r,i,s])):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(e,r){Mp(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),this._nameToUniform4.set(e,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(e,r){Mp(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){Mp(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){Mp(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function Mle(t,e,r){const i=t.gl,s=i.createShader(e);return i.shaderSource(s,r),i.compileShader(s),oB()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Wc.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(Lmt(r))),s}function Lmt(t){let e=2;return t.replaceAll(`
`,()=>`
`+Dmt(e++)+":")}function Dmt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Mp(t,e,r){const i=t.get(e);return i?_H(i,r):(t.set(e,Array.from(r)),!0)}let Nmt=class{constructor(e){this._rctx=e,this._store=new YS}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,s){const n=this._store.get(e,r);if(n!=null)return n.ref(),n;const o=new Imt(this._rctx,e,r,i,s);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},WR=class{constructor(){this._result=!1}dispose(){this._program=Fe(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Fmt=class extends WR{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===or.WEBGL2&&oe("mac")&&oe("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new _r(1);i.wrapMode=Lt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const s=new nn(r,i),n=Ir.createIndex(this._rctx,xr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(n,wt.ELEMENT_ARRAY_BUFFER),r.drawElements(Et.POINTS,1,Ke.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(Et.TRIANGLES,0,258);const o=new Uint8Array(4);return s.readPixels(0,0,1,1,St.RGBA,Us.UNSIGNED_BYTE,o),s.dispose(),n.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${b.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${b.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=aCe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},Umt=class extends WR{constructor(e){super(),this._rctx=e,this._program=$le(this._rctx,!1),this._obfuscated=$le(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Fe(this._obfuscated)}_test(e){if(oe("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new _r(1);i.wrapMode=Lt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const s=new nn(r,i),n=Ir.createVertex(r,xr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new xh(r,new Map([["position",0]]),{geometry:[new po("position",2,Ke.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Ae(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ae(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);XB(a,c,3);const h=new Float32Array(6);XB(l,h,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",h[0],h[2],h[4]),e.setUniform3f("u_lowB",h[1],h[3],h[5]),r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const p=new Uint8Array(4);s.readPixels(0,0,1,1,St.RGBA,Us.UNSIGNED_BYTE,p),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=YX(p);return Math.abs(f-m)}};function $le(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let Vmt=class extends WR{constructor(e){var s,n,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===or.WEBGL1)return void(this._result=!(!((s=e.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new _r(1);i.wrapMode=Lt.CLAMP_TO_EDGE,i.dataType=Us.FLOAT,i.internalFormat=Ze.RGBA32F,i.samplingMode=At.NEAREST;const s=new nn(r,i),n=Ir.createVertex(r,xr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new xh(r,new Map([["a_pos",0]]),{geometry:[new po("a_pos",2,Ke.UNSIGNED_SHORT,0,4)]},{geometry:n});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const f=Ot({blending:ybe});r.setPipelineState(f),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const m=r.gl.getError();return r.setViewport(l,c,h,p),r.bindFramebuffer(a),o.dispose(),s.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},zmt=class extends WR{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new _r(1);i.wrapMode=Lt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const s=new nn(r,i),n=new Uint8Array(4),o=Ir.createVertex(r,xr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new xh(r,new Map([["a_position",0]]),{geometry:[new po("a_position",2,Ke.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Ct(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(s),r.useProgram(e);const{x:h,y:p,width:f,height:m}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(Et.TRIANGLE_STRIP,0,4),r.setViewport(h,p,f,m),s.readPixels(0,0,1,1,St.RGBA,Us.UNSIGNED_BYTE,n),a.dispose(),s.dispose();const y=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return y&&J.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),r.bindFramebuffer(c),y}};new po("a_pos",2,Ke.BYTE,0,2);new po("a_pos",2,Ke.BYTE,0,4),new po("a_tex",2,Ke.BYTE,2,4);const kmt={geometry:[new po("a_pos",2,Ke.UNSIGNED_SHORT,0,4)]};let Bmt=class extends WR{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new _r(1);i.wrapMode=Lt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const s=new nn(r,i),n=Ir.createVertex(r,xr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new xh(r,new Map([["a_pos",0]]),kmt,{geometry:n}),a=new _r;a.samplingMode=At.LINEAR,a.wrapMode=Lt.CLAMP_TO_EDGE;const l=new Ct(r,a,I3);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=r.getViewport();r.bindFramebuffer(s),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(wi.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return s.readPixels(0,0,1,1,St.RGBA,Us.UNSIGNED_BYTE,y),o.dispose(),s.dispose(),l.dispose(),r.setViewport(h,p,f,m),r.bindFramebuffer(c),y[0]!==255}};const I3=new Image;I3.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",I3.width=5,I3.height=5,I3.decode();let Gmt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Vmt(e),this.svgPremultipliesAlpha=new Bmt(e),this.doublePrecisionRequiresObfuscation=new Umt(e),this.ignoresSamplerPrecision=new zmt(e),this.drawArraysRequiresIndicesTypeReset=new Fmt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function jmt(t,e){if(e.disjointTimerQuery)return null;if(up(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Hmt(t){if(up(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function qmt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Wmt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function Xmt(t,e){if(up(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function Zmt(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Ymt(t,e){if(up(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function Jmt(t,e){if(up(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function Ile(t,e,r,i,s){if(i&&up(t))return!0;if(e[r])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function Qmt(t,e){if(!up(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function Kmt(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function egt(t,e){if(up(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let tgt=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=jmt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Hmt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=egt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=qmt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Wmt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Zmt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=nmt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=Ymt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=Jmt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=Xmt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Ile(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=Kmt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Qmt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Ile(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},rgt=class{constructor(e,r){this.gl=e,this.instanceCounter=new dmt,this.programCache=new Nmt(this),this._state=new ble,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=up(e)?or.WEBGL2:or.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===or.WEBGL1?null:this.gl}configure(e){this._capabilities=new tgt(this.gl,e),this._parameters=new pmt(this.gl,this._capabilities,e),Ct.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new ble,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new ize({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),Fe(this._driverTest),this._driverTest=new Gmt(this)}dispose(){Fe(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),this.type===or.WEBGL2&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,ju()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,s){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,r,i,s),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,r,i,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,s){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(e,r,i,s),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,s){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(e,r,i,s),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(e,r,i,s),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=Ud.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,r,i,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===Ud.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=Ud.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,r,i,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(sU+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&wi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&wi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&wi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(ju()&&(this._numOfDrawCalls++,this._numOfTriangles+=Lle(e,i)),this.gl.drawArrays(e,r,i),ju()){const s=vee(this);s&&console.error("drawArrays:",s)}}drawElements(e,r,i,s){if(ju()&&(this._numOfDrawCalls++,this._numOfTriangles+=Lle(e,r)),this.gl.drawElements(e,r,i,s),ju()){const n=vee(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:r,type:i,offset:s},p=(a==null?void 0:a.size)??0,f=s+r,m=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){ju()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){ju()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===r&&n.width===i&&n.height===s||(n.x=e,n.y=r,n.width=i,n.height=s,this.gl.viewport(e,r,i,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return e==null||e.glName==null?(s!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,s):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(oo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(oo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const s=r===oo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),s?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,s=0,n=e.width,o=e.height,a=0,l=0,c=r.width,h=r.height,p=wi.COLOR_BUFFER_BIT,f=At.NEAREST){this.bindFramebufferSeparate(e,oo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,oo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,h,p,f)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Dl(this.gl,e,r,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Dl(this.gl,e,r,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Dl(this.gl,e,r,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Dl(this.gl,e,r,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Dl(this.gl,e,r,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Dl(this.gl,e,r,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Dl(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return s==null&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(e,r,i){const s=this._getBufferBinding(e,r);s!=null&&(s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0))}bindBufferRange(e,r,i,s,n){const o=this._getBufferBinding(e,r);if(o!=null&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(e,r,i,s){r!=null?(ju()&&(s??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(wt.UNIFORM_BUFFER,e,r.buffer,i,s):this.bindBufferBase(wt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(wt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(wt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Dl(this.gl,null,e,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Dl(this.gl,null,e,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Dl(this.gl,null,e,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Dl(this.gl,null,e,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Dl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Dl(this.gl,null,e,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Dl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(nB.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(vn.Sync,i),r.flush();do await ZA(e),s=r.clientWaitSync(i,0,0);while(s===aN.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(vn.Sync,i),r.deleteSync(i),s===aN.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=oo.FRAMEBUFFER){return e===oo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),this.type===or.WEBGL2&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(be.ONE,be.ZERO),this.setBlendEquation(Nf.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Ud.BACK),this.setFrontFace(rS.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Qr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Qr.ALWAYS,0,0),this.setStencilOp(ms.KEEP,ms.KEEP,ms.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var n,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)r.disableVertexAttribArray(l);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(wt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(wt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(wt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(c!=null){const{buffer:h,offset:p,size:f}=c;h!==null?p===0&&f===0?i.bindBufferBase(wt.UNIFORM_BUFFER,l,h.glName):i.bindBufferRange(wt.UNIFORM_BUFFER,l,h.glName,p,f):i.bindBufferBase(wt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(wt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(wt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(wt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(wt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(oo.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(oo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(zc.COLOR_ATTACHMENT0)),i.bindFramebuffer(oo.DRAW_FRAMEBUFFER,((n=this._state.drawFramebuffer)==null?void 0:n.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(oo.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}r.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){r.activeTexture(sU+l),r.bindTexture(ns.TEXTURE_2D,null),r.bindTexture(ns.TEXTURE_CUBE_MAP,null),this.type===or.WEBGL2&&(r.bindTexture(ns.TEXTURE_3D,null),r.bindTexture(ns.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];c!=null&&r.bindTexture(c.descriptor.target,c.glName)}r.activeTexture(sU+this._state.activeTexture);const s=this._state.viewport;r.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===or.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function Dl(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function Lle(t,e){switch(t){case Et.POINTS:return 2*e;case Et.TRIANGLES:return e/3;case Et.TRIANGLE_STRIP:case Et.TRIANGLE_FAN:return e-2;default:return 0}}let igt=class extends rgt{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}bindTechnique(e,r,i,s){return this.useProgram(e.program),e.bindPipelineState(this,i==null?void 0:i.slot,!!s),e.program.bindPass(r,i),e.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new aCe(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}},dT=class extends xe{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Is,this._frameTask=e.view.resourceController.scheduler.registerTask(dt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(os.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(LZ,new DZ)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",ps.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return tt(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),s=new sgt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&r.unload()})});return this._textures.set(e,s),s.ref(),r.glTexture!=null?(this._updateGLTexture(s,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=r.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,gs(l)||J.getLogger(this).error(l),null);return pu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",ps.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],dT.prototype,"_loadingCount",void 0),u([d()],dT.prototype,"_frameTask",void 0),u([d()],dT.prototype,"updating",null),dT=u([R("esri.views.3d.webgl-engine.lib.TextureRepository")],dT);let sgt=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(J.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function ngt(t,e){return new rxe(r=>rQe(r,t),r=>r,e)}let L3=class extends xe{constructor(){super(...arguments),this._passParameters=new ogt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=Fe(this._passParameters.waveNormal),this._passParameters.wavePertubation=Fe(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return ug.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return ug.LOADED;const r=new _r;return r.samplingMode=At.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.maxAnisotropy=8,++this._loading,Lg(kr("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Ct(e,{...r,width:i.width,height:i.height},i)).catch(i=>J.getLogger(this).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,Lg(kr("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Ct(e,{...r,width:i.width,height:i.height},i)).catch(i=>J.getLogger(this).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),ug.LOADING}};u([d()],L3.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],L3.prototype,"updating",null),L3=u([R("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],L3);let ogt=class extends Kr{};const Dle=2048,agt=1.5,lgt=8;function cgt(t,e){const{format:r,quality:i,rotation:s,disableDecorations:n}=t||{},o=$Y(t,e.padding),a=ggt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=mgt(t,a),h=vgt(r),p=Sgt[h];return{format:h,quality:ye(i??p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function ugt(t,e){const r=cgt(t,e),i=r.area,s=r.width/i.width,n=$Y(r,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=t&&t.layers?t.layers:[],m=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function P9(t,e,r){const{ctx:i,canvas:s}=dCe(t,r),n=i.getImageData(0,0,t.width,t.height),o=dgt(s,e);return pCe(s),{dataUrl:o,data:n}}function M9(t,e){const{ctx:r,canvas:i}=dCe(t,e),s=r.getImageData(0,0,t.width,t.height);return pCe(i),s}function dCe(t,e){const r=hgt();e.premultipliedAlpha&&wgt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&bgt(i),{ctx:i,canvas:r}}function pCe(t){t.width=0,t.height=0}function hgt(){return $9==null&&($9=document.createElement("canvas")),$9}let $9=null;function dgt(t,e){const r=xgt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function pgt(t,e,r,i=0,s=0,n=t.width-i,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:h,data:p}=e,f=n/c,m=o/h,y=Math.ceil(f/2),_=Math.ceil(m/2),v=t.width;for(let w=0;w<h;w++)for(let T=0;T<c;T++){const x=4*(T+(a?h-w-1:w)*c);let S=0,O=0,A=0,P=0,I=0,V=0;const k=(w+.5)*m;for(let B=Math.floor(w*m);B<(w+1)*m;B++){const z=Math.abs(k-(B+.5))/_,Z=(T+.5)*f,W=z*z;for(let H=Math.floor(T*f);H<(T+1)*f;H++){const Y=Math.abs(Z-(H+.5))/y,M=Math.sqrt(W+Y*Y);if(M>=1)continue;let D=2*M*M*M-3*M*M+1;const N=4*(i+H+(s+B)*v);V+=D*l[N+3],O+=D,!r&&l[N+3]<255&&(D=D*l[N+3]/255),A+=D*l[N],P+=D*l[N+1],I+=D*l[N+2],S+=D}}p[x]=A/S,p[x+1]=P/S,p[x+2]=I/S,p[x+3]=V/O}return e}function fgt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=t,a=$Y(t,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,p=s-c,f=Math.min(lgt,Math.min((Dle-l)/h,(Dle-c)/p));return f<agt?t:{...t,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:s}}}function mgt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const s=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function ggt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return ygt(_gt(r,t),e)}function ygt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),s={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function _gt(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const n=Math.floor(t.height*r);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/r);return t.y-=(s-t.height)/2,t.height=s,t}function $Y(t,e){return!e||t&&t.ignorePadding?Egt:e}function vgt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Tgt}}function bgt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function wgt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const s=e[i+3];if(s!==255&&s>0){const n=255/s;e[i]=e[i]*n,e[i+1]=e[i+1]*n,e[i+2]=e[i+2]*n}}}const xgt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Nle=98,Tgt="png",Sgt={png:100,jpg:Nle,jpeg:Nle},Egt={top:0,right:0,bottom:0,left:0};let Cgt=class{constructor(e,r){this.parameters=e,this.frameHasDecorations=r}},Agt=class{constructor(e,r,i,s){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(ps.BACKGROUND);const r=mo();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const s=e.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(e,r),s.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=R8(i,s,a);this._rctx.gl.readPixels(0,0,i,s,St.RGBA,Ke.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=R8(n.width,n.height,a);return pgt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=R8(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,St.RGBA,Ke.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,r,i){let s=null;const n=e.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};K1(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&e.frameHasDecorations,c=o.width!==n.fullWidth||o.height!==n.fullHeight,h=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,p=c||l||h||r.objectAndLayerIdColor,f=r.objectAndLayerIdColor?new nn(this._rctx,new _r(o.width,o.height),new hN(ks.DEPTH_STENCIL,o.width,o.height)):null;if(p){const v=n.clone();if(r.ignorePadding){const O=vR(v.padding);for(let A=0;A<4;A++)O[A]=Math.round(O[A]/v.pixelRatio*r.pixelRatio);v.padding=O}v.fullWidth=o.width,v.fullHeight=o.height,v.pixelRatio=r.pixelRatio;const w=n.fovX-v.fovX,T=n.fovY-v.fovY;w<0&&w<T?v.fovX=n.fovX:T<0&&T<w&&(v.fovY=n.fovY);const x={camera:v,contentCamera:v,mode:$r.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),a=!0,s=new nn(this._rctx,new _r(o.width,o.height),new hN(ks.DEPTH_STENCIL,o.width,o.height));const S=r.disableDecorations?zb.OFF:zb.ON;this._renderFunctions.renderScene(s,f,x,S,i),this._disposeOffscreenBuffers()}const m=()=>{this._rctx.bindFramebuffer(null),Fe(s)},y=this._readbackScreenshot(r,m);m();let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),Fe(f)};this._rctx.bindFramebuffer(f),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null),v()}if(p&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return a&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Mn=class extends xe{constructor(e){super({}),this.events=new Is,this.waterTextureRepository=new L3,this._magnifierHelper=new hT,this.objectAndLayerIdRenderHelper=oe("enable-feature:objectAndLayerId-rendering")?new Opt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([ue(()=>{var s;return(s=this.waterTextureRepository)==null?void 0:s.updating},()=>this.requestRender(),Vr),ue(()=>e.view.qualityProfile,s=>{var n;return(n=this.renderer)==null?void 0:n.updateRenderFeature(s)},Cs),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextureRepository=qJe(this._rctx,r),this.markerTextureRepository=ngt(this._rctx,r),this._shaderTechniqueRepository=new Ywe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new dT(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",s=>this.requestRender(s))),this._materialRepository=new Jwe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new opt(this._rctx,this._shaderTechniqueRepository),this.renderer=new zl(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,s=>this.requestRender(s));const i={renderScene:(s,n,o,a,l)=>this.renderer.render(s,n,o,a,l),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n)=>e.options.screenshot.renderOverlay(s,n)};this._screenshotManager=new Agt(this._rctx,i,s=>this.events.emit("force-camera-for-screenshot",s),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Li(this._frameTask),this._shaderTechniqueRepository=Pe(this._shaderTechniqueRepository)}requestRender(e=ps.UPDATE){this._needsRender=!0,e===ps.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,s,n,o=n){const a=s.constrainWindowSize(r,i,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(s,a,l);let c=Number.MAX_VALUE;for(let h=0;h<a[2]*a[3];h++){const p=hpt(4*h,l,s.nearFar);c>p&&p!==s.nearFar[0]&&p!==s.nearFar[1]&&(c=p)}if(e!=null){const h=e.pickDepth(r*s.pixelRatio,i*s.pixelRatio,s);h!=null&&c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){rSe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,s=ps.BACKGROUND,n=!1;const o={preRender:({time:a})=>{i=this.updating,s=this._needsUpdate?ps.UPDATE:ps.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,h=new B1e(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(ps.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,zb.ON,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(ps.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new Cgt(r,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{n&&(this.renderer.finish(r.mode===$r.IDLE?s:ps.UPDATE),n=!1)}};this._frameTask=$2(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},s=oze("3d",this._canvas,i);s!=null?(this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&J.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&oe("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):J.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,o)=>r.view.resourceController.memoryController.newCache(n,o);return new igt(e,i,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new Wdt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Mn.prototype,"updating",null),u([d({autoDestroy:!0})],Mn.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],Mn.prototype,"_container",void 0),u([d({autoDestroy:!0})],Mn.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],Mn.prototype,"stippleTextureRepository",void 0),u([d({autoDestroy:!0})],Mn.prototype,"markerTextureRepository",void 0),u([d({autoDestroy:!0})],Mn.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],Mn.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],Mn.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],Mn.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],Mn.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],Mn.prototype,"renderer",void 0),u([d({autoDestroy:!0})],Mn.prototype,"_screenshotManager",void 0),u([d()],Mn.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],Mn.prototype,"_componentObjectCollection",void 0),u([d()],Mn.prototype,"_needsUpdate",void 0),u([d()],Mn.prototype,"_needsWaterReflectionUpdate",void 0),Mn=u([R("esri.views.3d.webgl-engine.parts.RenderView")],Mn);let Dc=class extends xe{constructor(e){super(e),this._model=new PL,this._layers=new Bt,this._asyncChangeSet=new G7,this._syncChangeSet=new G7,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Mn(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(dt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),jN(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),jN(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}async load(e,r){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>i.glTexture==null).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const s=this._layerSyncSet.has(i.id)||i.updatePolicy===n_.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,n),this._layerSyncSet.delete(i.id),n.empty||(this.renderer.modify(n,s?Fa:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Fa),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==n_.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===n_.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Fa),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Fa),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Fa))}addRenderPlugin(e,r,i){const s=this.renderer.renderPlugins.add(e,r,i),n=()=>{vne(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(pu(s))return s.then(n);n()}removeRenderPlugin(e){this.destroyed||(vne(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};Dc.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],Dc.prototype,"view",void 0),u([d({constructOnly:!0})],Dc.prototype,"options",void 0),u([d({readOnly:!0})],Dc.prototype,"viewingMode",null),u([d({constructOnly:!0})],Dc.prototype,"container",void 0),u([d({readOnly:!0})],Dc.prototype,"updating",null),u([d({constructOnly:!0})],Dc.prototype,"_model",void 0),u([d({autoDestroy:!0})],Dc.prototype,"renderView",void 0),u([d({readOnly:!0})],Dc.prototype,"renderer",null),u([d({readOnly:!0})],Dc.prototype,"running",null),Dc=u([R("esri.views.3d.webgl-engine.Stage")],Dc);let U4t=class extends rF{constructor(e,r,i,s){super(r,i),this.point=e,this.createGraphic=s}};function fCe(t){return lp(t)&&t.intersector===Bi.PCL&&!!t.target}let z4t=class extends hve{constructor(e,r,i,s,n){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}},B4t=class extends rF{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function JF(t){return lp(t)&&t.intersector===Bi.I3S&&!!t.target}function mCe(t){return lp(t)&&t.intersector===Bi.VOXEL&&!!t.target}function Fle(t,e){var r,i;return iF(t)||sF(t)?ZO((r=t.target)==null?void 0:r.object,e):TQe(t)?(i=e.map)==null?void 0:i.ground:fCe(t)||JF(t)||_xe(t)||mCe(t)?ZO(t.target,e):null}function j4t(t,e){const r=VG(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function VG(t,e){var r;if(t==null)return null;if(iF(t)||sF(t))return Ule((r=t.target)==null?void 0:r.object,e);if(fCe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(mCe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return _xe(t)||eY(t)?Ule(t.target,e):JF(t)?Ogt(t.target,e):null}function Ule(t,e){if(t==null||t.graphicUid==null)return null;const r=ZO(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function Ogt(t,e){const r=ZO(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?Pgt(i.getGraphicFromIntersectorTarget(t)):null}function Rgt(t,e){const r=ZO(t,e);if(r==null)return null;const i=e.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function Pgt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function ZO(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function H4t(t,e){if(iF(t)||sF(t))return cg(t.target.object.boundingVolumeWorldSpace.bounds);if(eY(t)){Vme(V$,t.transformation);const r=Math.max(V$[0],V$[1],V$[2]);return t.target.baseBoundingSphere.radius*r}return JF(t)?oc(Rgt(t.target,e),r=>.5*qfe(r)):null}function q4t(t){return!iF(t)&&!sF(t)&&(eY(t)?t.target.numLodLevels>1:!!JF(t))}const V$=C();async function Mgt(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+$gt),s=r.results.findIndex(n=>(n.distance??0)>i);return s!==-1&&(r.results=r.results.slice(0,s)),r}const $gt=.05;function W4t(t){return t&&typeof t.highlight=="function"}function Igt(t){return t&&typeof t.maskOccludee=="function"}function X4t(t,e,r){return t==null||t>r&&(e===0||t<e)}function Z4t(t,e){return t!=null&&t>0||e!=null&&e>0}function Y4t(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let I9,L9;function Lgt(t){const e=z0e(t);for(;e.length>1;){const r=Vle(e.shift());if(r.available)return r}return Vle(e.shift())}function Vle(t){switch(t){case or.WEBGL1:return Dgt();case or.WEBGL2:return Ngt()}}function Dgt(){return I9||(I9=Vgt()),I9}function Ngt(){return L9||(L9=zgt()),L9}let gCe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},Fgt=class extends gCe{constructor(){super(...arguments),this.type=or.WEBGL1}},Ugt=class extends gCe{constructor(){super(...arguments),this.type=or.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function yCe(t,e){if(t===or.WEBGL1&&typeof WebGLRenderingContext>"u"||t===or.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=aB(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=aB(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===or.WEBGL1){const n=i.getParameter(i.VERSION),o=n==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}function Vgt(){const t=new Fgt,e=yCe(or.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function zgt(){const t=new Ugt,e=yCe(or.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function kgt(t){const e=Lgt(t);if(!e.available)return new U("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new U("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new U("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new U("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===or.WEBGL1){if(!e.supportsElementIndexUint)return new U("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new U("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new U("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Bgt(t){return t&&"nodeType"in t}function Ggt(t){return t&&typeof t.render=="function"}const zle={component:"esri-component"};let f1=class extends xe{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(zle.component),r&&r.classList.remove(zle.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||Bgt(e)?(this._set("widget",null),_5(e)):(Ggt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],f1.prototype,"id",null),u([d()],f1.prototype,"node",null),u([gr("node")],f1.prototype,"castNode",null),u([d({readOnly:!0})],f1.prototype,"widget",void 0),f1=u([R("esri.views.ui.Component")],f1);const DL=f1,_Ce="calcite-mode-";function jgt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function Hgt(){return jgt().startsWith("dark")}function qgt(){return`${_Ce}${Hgt()?"dark":"light"}`}function Wgt(t){Xgt(t),t.classList.add(qgt())}function Xgt(t){Array.from(t.classList).forEach(e=>{e.startsWith(_Ce)&&t.classList.remove(e)})}const Zgt={left:0,top:0,bottom:0,right:0},vCe={bottom:30,top:15,right:15,left:15},vm="esri-ui",Nl={ui:vm,corner:`${vm}-corner`,innerContainer:`${vm}-inner-container`,manualContainer:`${vm}-manual-container`,cornerContainer:`${vm}-corner-container`,topLeft:`${vm}-top-left`,topRight:`${vm}-top-right`,bottomLeft:`${vm}-bottom-left`,bottomRight:`${vm}-bottom-right`};function Ygt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function z$(t){return t===0?"0":`${t}px`}function D9(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function N9(t,{top:e,bottom:r,left:i,right:s}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=s}let Jp=class extends Is.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=jd(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&N9(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&N9(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ue(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Vr),ue(()=>this.padding,this._applyUIPadding,Vr),ue(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},Vr),gde(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(Nl.ui),Wgt(e),this._attachContainers(e)),r&&(r.classList.remove(Nl.ui),N9(r,{top:"",bottom:"",left:"",right:""}),Ame(r)),this._set("container",e))}get height(){var n;const e=((n=this.view)==null?void 0:n.height)??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:s}=r;return Math.max(e-i-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...vCe,...e}}get width(){var n;const e=((n=this.view)==null?void 0:n.width)??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:s}=r;return Math.max(e-i-s,0)}add(e,r){let i,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,r));const o=D9(e);o&&({index:i,position:r,component:e,key:s}=o),r&&typeof r=="object"&&({index:i,key:s,position:r,internal:n}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,s,n)}remove(e,r){var s;if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,r));const i=this._find(e);if(i){if(this._componentMap.has(e)&&((s=this._componentMap.get(e))==null?void 0:s.key)!==r)return;const n=this._components.indexOf(i),o=i.node.parentNode;return o==null||o.removeChild(i.node),this._componentMap.delete(e),this._components.splice(n,1)[0]}}empty(e,r={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,r);return}const i=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(n=>{var o;return n==null?!1:!(((o=this._componentMap.get(n))==null?void 0:o.internal)??!1)||r.removeInternal});for(const n of s)this.remove(n)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const s=D9(e)||D9(r);if(s&&(i=s.index,r=s.position,e=s.component||e),r&&!this._isValidPosition(r))return;const n=this.remove(e);n&&this.add(n,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e,r={includeInternal:!1}){return e?Array.isArray(e)?e.map(i=>this._getComponentsAtPosition(i,r)).flat():this._getComponentsAtPosition(e,r):this._components.filter(i=>{var s;return r.includeInternal||!((s=this._componentMap.get(i))!=null&&s.internal)}).map(({widget:i,node:s})=>i??s)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,s,n){e instanceof DL||(e=new DL({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof DL?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??Zgt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Nl.innerContainer,Nl.cornerContainer);const r=document.createElement("div");r.classList.add(Nl.innerContainer,Nl.manualContainer);const i=document.createElement("div");i.classList.add(Nl.topLeft,Nl.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(Nl.topRight,Nl.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Nl.bottomLeft,Nl.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Nl.bottomRight,Nl.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=l8e();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:i,"top-trailing":a?i:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:s}=e,n=this._positionNameToContainerLookup[r],o=s!=null&&s>-1;if(Ygt(i.widget)&&i.widget.startup(),!o)return void n.appendChild(i.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?XQ(i.node,n.firstChild):n.appendChild(i.node));s>=a.length?n.appendChild(i.node):XQ(i.node,a[s])}_toPixelPosition(e){return{top:z$(e.top),left:z$(e.left),right:z$(e.right),bottom:z$(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e,r){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(nw).filter(s=>{var n;return r.includeInternal||!((n=this._componentMap.get(s))!=null&&n.internal)}).map(({widget:s,node:n})=>s??n)}};u([d()],Jp.prototype,"_locale",void 0),u([d()],Jp.prototype,"container",null),u([d()],Jp.prototype,"height",null),u([d({value:vCe})],Jp.prototype,"padding",null),u([gr("padding")],Jp.prototype,"castPadding",null),u([d()],Jp.prototype,"view",void 0),u([d()],Jp.prototype,"width",null),Jp=u([R("esri.views.ui.UI")],Jp);const Jgt=Jp,Qgt="randomUUID"in crypto;function QF(){if(Qgt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function r5t(){return`{${QF()}}`}const Kgt={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},eyt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},tyt=t=>({...eyt,...t}),ryt=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},iyt=(t,e)=>t.find(e),kle=(t,e,r=!1)=>{let i=t;return e.forEach((s,n)=>{const o=i!=null&&i.children?iyt(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==e.length-1||(i=o)}),i},syt=t=>{let e;const r={...Kgt,...t},i=tyt(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var w;let _;i.eventHandlerInterceptor=(T,x,S,O)=>function(A){let P;s("domEvent",A);const I=ryt(A.currentTarget,_.domNode),V=I.some(B=>{var z;return customElements.get((z=B==null?void 0:B.tagName)==null?void 0:z.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!V)I.reverse(),P=kle(_.getLastRender(),I);else{const B=A.composedPath(),z=B.slice(B.indexOf(A.currentTarget),B.indexOf(_.domNode)).filter(Z=>Z.getRootNode()===Z.ownerDocument).reverse();P=kle(_.getLastRender(),z,!0)}let k;return P&&(k=r.handleInterceptedEvent(e,P,this,A)),s("domEventProcessed",A),k},(w=r.postProcessProjectionOptions)==null||w.call(r,i);const v=y();_=f(m,v,i),l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{h(W0.append,f,m)},insertBefore:(f,m)=>{h(W0.insertBefore,f,m)},merge:(f,m)=>{h(W0.merge,f,m)},replace:(f,m)=>{h(W0.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},pT={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let fT,bCe,KF,wCe=!1,v4=!1,IY=!1,Hc=!1,Ble=null,zG=!1;const nyt=t=>{const e=new URL(t,ko.$resourcesUrl$);return e.origin!==YR.location.origin?e.href:e.pathname},oyt=t=>ko.$resourcesUrl$=t,rw=(t,e="")=>()=>{},Gle="http://www.w3.org/1999/xlink",jle={},ayt="http://www.w3.org/2000/svg",lyt="http://www.w3.org/1999/xhtml",cyt=t=>t!=null,LY=t=>(t=typeof t,t==="object"||t==="function");function uyt(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const xCe=(t,e,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)i=p[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!LY(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?b4(null,i):i),a=o)};if(c(r),e){e.key&&(s=e.key),e.name&&(n=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,pyt);const h=b4(t,null);return h.$attrs$=e,l.length>0&&(h.$children$=l),h.$key$=s,h.$name$=n,h},b4=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},hyt={},dyt=t=>t&&t.$tag$===hyt,pyt={forEach:(t,e)=>t.map(Hle).forEach(e),map:(t,e)=>t.map(Hle).map(e).map(fyt)},Hle=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),fyt=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),xCe(t.vtag,r,...t.vchildren||[])}const e=b4(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},myt=t=>Byt.map(e=>e(t)).find(e=>!!e),gyt=(t,e)=>t!=null&&!LY(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,yyt=t=>t,i5t=(t,e,r)=>{const i=yyt(t);return{emit:s=>_yt(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s})}},_yt=(t,e,r)=>{const i=ko.ce(e,r);return t.dispatchEvent(i),i},qle=new WeakMap,vyt=(t,e,r)=>{let i=x4.get(t);Hyt&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,x4.set(t,i)},byt=(t,e,r,i)=>{var s;let n=TCe(e,r);const o=x4.get(n);if(t=t.nodeType===11?t:Yd,o)if(typeof o=="string"){t=t.head||t;let a=qle.get(t),l;if(a||qle.set(t,a=new Set),!a.has(n)){{l=Yd.createElement("style"),l.innerHTML=o;const c=(s=ko.$nonce$)!==null&&s!==void 0?s:uyt(Yd);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(n)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return n},wyt=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,s=rw("attachStyles",e.$tagName$),n=byt(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},TCe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Wle=(t,e,r,i,s,n)=>{if(r!==i){let o=Jle(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Xle(r),h=Xle(i);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Jle(YR,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&ko.rel(t,e,r,!1),i&&ko.ael(t,e,i,!1);else{const l=LY(i);if((o||l&&i!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=i;else{const h=i??"";e==="list"?o=!1:(r==null||t[e]!=h)&&(t[e]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Gle,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(Gle,e,i):t.setAttribute(e,i))}}},xyt=/\s/,Xle=t=>t?t.split(xyt):[],SCe=(t,e,r,i)=>{const s=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,n=t&&t.$attrs$||jle,o=e.$attrs$||jle;for(i in n)i in o||Wle(s,i,n[i],void 0,r,e.$flags$);for(i in o)Wle(s,i,n[i],o[i],r,e.$flags$)},w4=(t,e,r,i)=>{const s=e.$children$[r];let n=0,o,a,l;if(wCe||(IY=!0,s.$tag$==="slot"&&(fT&&i.classList.add(fT+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Yd.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Yd.createTextNode("");else{if(Hc||(Hc=s.$tag$==="svg"),o=s.$elm$=Yd.createElementNS(Hc?ayt:lyt,s.$flags$&2?"slot-fb":s.$tag$),Hc&&s.$tag$==="foreignObject"&&(Hc=!1),SCe(null,s,Hc),cyt(fT)&&o["s-si"]!==fT&&o.classList.add(o["s-si"]=fT),s.$children$)for(n=0;n<s.$children$.length;++n)a=w4(t,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?Hc=!1:o.tagName==="foreignObject"&&(Hc=!0)}return o["s-hn"]=KF,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=bCe,o["s-sn"]=s.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===s.$tag$&&t.$elm$&&YO(t.$elm$,!1)),o},YO=(t,e)=>{ko.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==KF&&s["s-ol"]&&(ACe(s).insertBefore(s,DY(s)),s["s-ol"].remove(),s["s-ol"]=void 0,IY=!0),e&&YO(s,e)}ko.$flags$&=-2},ECe=(t,e,r,i,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===KF&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=w4(null,r,s,t),a&&(i[s].$elm$=a,o.insertBefore(a,DY(e))))},CCe=(t,e,r,i,s)=>{for(;e<=r;++e)(i=t[e])&&(s=i.$elm$,PCe(i),v4=!0,s["s-ol"]?s["s-ol"].remove():YO(s,!0),s.remove())},Tyt=(t,e,r,i)=>{let s=0,n=0,o=0,a=0,l=e.length-1,c=e[0],h=e[l],p=i.length-1,f=i[0],m=i[p],y,_;for(;s<=l&&n<=p;)if(c==null)c=e[++s];else if(h==null)h=e[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--p];else if(k$(c,f))mT(c,f),c=e[++s],f=i[++n];else if(k$(h,m))mT(h,m),h=e[--l],m=i[--p];else if(k$(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&YO(c.$elm$.parentNode,!1),mT(c,m),t.insertBefore(c.$elm$,h.$elm$.nextSibling),c=e[++s],m=i[--p];else if(k$(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&YO(h.$elm$.parentNode,!1),mT(h,f),t.insertBefore(h.$elm$,c.$elm$),h=e[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==f.$tag$?y=w4(e&&e[n],r,o,t):(mT(_,f),e[o]=void 0,y=_.$elm$),f=i[++n]):(y=w4(e&&e[n],r,n,t),f=i[++n]),y&&ACe(c.$elm$).insertBefore(y,DY(c.$elm$))}s>l?ECe(t,i[p+1]==null?null:i[p+1].$elm$,r,i,n,p):n>p&&CCe(e,s,l)},k$=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,DY=t=>t&&t["s-ol"]||t,ACe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,mT=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,s=e.$children$,n=e.$tag$,o=e.$text$;let a;o===null?(Hc=n==="svg"?!0:n==="foreignObject"?!1:Hc,n==="slot"||SCe(t,e,Hc),i!==null&&s!==null?Tyt(r,i,e,s):s!==null?(t.$text$!==null&&(r.textContent=""),ECe(r,null,e,s,0,s.length-1)):i!==null&&CCe(i,0,i.length-1),Hc&&n==="svg"&&(Hc=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},OCe=t=>{const e=t.childNodes;let r,i,s,n,o,a;for(i=0,s=e.length;i<s;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=e[n].nodeType,e[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[n].textContent.trim()!==""){r.hidden=!0;break}}OCe(r)}},$d=[],RCe=t=>{let e,r,i,s,n,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(Zle(r,s)?(n=$d.find(h=>h.$nodeToRelocate$===r),v4=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=e:$d.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&$d.map(h=>{Zle(h.$nodeToRelocate$,r["s-sn"])&&(n=$d.find(p=>p.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):$d.some(h=>h.$nodeToRelocate$===r)||$d.push({$nodeToRelocate$:r}));e.nodeType===1&&RCe(e)}},Zle=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",PCe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(PCe)},Syt=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,s=t.$vnode$||b4(null,null),n=dyt(e)?e:xCe(null,null,e);KF=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,t.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,fT=r["s-sc"],bCe=r["s-cr"],wCe=(i.$flags$&1)!==0,v4=!1,mT(s,n);{if(ko.$flags$|=1,IY){RCe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<$d.length;f++)o=$d[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Yd.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<$d.length;f++)if(o=$d[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}v4&&OCe(n.$elm$),ko.$flags$&=-2,$d.length=0}},Eyt=(t,e)=>{},NY=(t,e)=>(t.$flags$|=16,Eyt(t,t.$ancestorComponent$),Xyt(()=>Cyt(t,e))),Cyt=(t,e)=>{const r=t.$hostElement$,i=rw("scheduleUpdate",t.$cmpMeta$.$tagName$),s=r;let n;return e?n=E2(s,"componentWillLoad"):n=E2(s,"componentWillUpdate"),n=Yle(n,()=>E2(s,"componentWillRender")),i(),Yle(n,()=>Ayt(t,s,e))},Ayt=async(t,e,r)=>{const i=t.$hostElement$,s=rw("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&wyt(t);const n=rw("render",t.$cmpMeta$.$tagName$);Oyt(t,e,i),n(),s(),Ryt(t)},Oyt=(t,e,r)=>{try{Ble=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(pT.hasRenderFn||pT.reflect)&&(pT.vdomRender||pT.reflect)&&(pT.hydrateServerSide||Syt(t,e))}catch(a){ZR(a,t.$hostElement$)}return Ble=null,null},Ryt=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=rw("postUpdate",e),s=r;t.$ancestorComponent$,E2(s,"componentDidRender"),t.$flags$&64?(E2(s,"componentDidUpdate"),i()):(t.$flags$|=64,E2(s,"componentDidLoad"),i())},s5t=t=>{{const e=XR(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&NY(e,!1),r}},E2=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){ZR(i)}},Yle=(t,e)=>t&&t.then?t.then(e):e(),Pyt=(t,e)=>XR(t).$instanceValues$.get(e),Myt=(t,e,r,i)=>{const s=XR(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;r=gyt(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[e];p&&p.map(f=>{try{l[f](r,o,e)}catch(m){ZR(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;NY(s,!1)}}}},$yt=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),s=t.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return Pyt(this,n)},set(a){Myt(this,n,a,e)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){ko.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},Iyt=async(t,e,r,i,s)=>{if(!(e.$flags$&32)&&(s=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[e.$modeName$=myt(t)]);const a=TCe(r,e.$modeName$);if(!x4.has(a)){const l=rw("registerStyles",r.$tagName$);vyt(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>NY(e,!0))()},Lyt=t=>{},Dyt=t=>{if(!(ko.$flags$&1)){const e=XR(t),r=e.$cmpMeta$,i=rw("connectedCallback",r.$tagName$);e.$flags$&1?(MCe(t,e,r.$listeners$),Lyt(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&Nyt(t),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),Iyt(t,e,r)),i()}},Nyt=t=>{const e=t["s-cr"]=Yd.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},Fyt=t=>{if(!(ko.$flags$&1)){const e=XR(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},n5t=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){kyt(this,r)},connectedCallback(){Dyt(this),i&&i.call(this)},disconnectedCallback(){Fyt(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,$yt(t,r)},o5t=(t,e)=>e,MCe=(t,e,r,i)=>{r&&r.map(([s,n,o])=>{const a=Vyt(t,s),l=Uyt(e,o),c=zyt(s);ko.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>ko.rel(a,n,l,c))})},Uyt=(t,e)=>r=>{try{pT.lazyLoad||t.$hostElement$[e](r)}catch(i){ZR(i)}},Vyt=(t,e)=>e&4?Yd:e&8?YR:e&16?Yd.body:t,zyt=t=>Gyt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,$Ce=new WeakMap,XR=t=>$Ce.get(t),kyt=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return MCe(t,r,e.$listeners$),$Ce.set(t,r)},Jle=(t,e)=>e in t,ZR=(t,e)=>(0,console.error)(t,e),x4=new Map,Byt=[],YR=typeof window<"u"?window:{},Yd=YR.document||{head:{}},a5t=YR.HTMLElement||class{},ko={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},Gyt=(()=>{let t=!1;try{Yd.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),jyt=t=>Promise.resolve(t),Hyt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),Qle=[],ICe=[],qyt=(t,e)=>r=>{t.push(r),zG||(zG=!0,e&&ko.$flags$&4?Wyt(kG):ko.raf(kG))},Kle=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){ZR(r)}t.length=0},kG=()=>{Kle(Qle),Kle(ICe),(zG=Qle.length>0)&&ko.raf(kG)},Wyt=t=>jyt().then(t),Xyt=qyt(ICe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */const LCe="calcite-mode-auto",DCe="calcite-mode-dark",Zyt="calcite-mode-light",l5t={autoMode:LCe,darkMode:DCe,lightMode:Zyt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var NCe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],T4=NCe.join(","),FCe=typeof Element>"u",iw=FCe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,S4=!FCe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},E4=function t(e,r){var i;r===void 0&&(r=!0);var s=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),n=s===""||s==="true",o=n||r&&e&&t(e.parentNode);return o},Yyt=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},UCe=function(e,r,i){if(E4(e))return[];var s=Array.prototype.slice.apply(e.querySelectorAll(T4));return r&&iw.call(e,T4)&&s.unshift(e),s=s.filter(i),s},VCe=function t(e,r,i){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if(!E4(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=iw.call(o,T4);h&&i.filter(o)&&(r||!e.includes(o))&&s.push(o);var p=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!E4(p,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(p&&f){var m=t(p===!0?o.children:p.children,!0,i);i.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},zCe=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Yyt(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},Jyt=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},kCe=function(e){return e.tagName==="INPUT"},Qyt=function(e){return kCe(e)&&e.type==="hidden"},Kyt=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},e0t=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},t0t=function(e){if(!e.name)return!0;var r=e.form||S4(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(e.name));else try{s=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=e0t(s,e.form);return!n||n===e},r0t=function(e){return kCe(e)&&e.type==="radio"},i0t=function(e){return r0t(e)&&!t0t(e)},s0t=function(e){var r,i=e&&S4(e),s=(r=i)===null||r===void 0?void 0:r.host,n=!1;if(i&&i!==e){var o,a,l;for(n=!!((o=s)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(s)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!n&&s;){var c,h,p;i=S4(s),s=(c=i)===null||c===void 0?void 0:c.host,n=!!((h=s)!==null&&h!==void 0&&(p=h.ownerDocument)!==null&&p!==void 0&&p.contains(s))}}return n},ece=function(e){var r=e.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},n0t=function(e,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var n=iw.call(e,"details>summary:first-of-type"),o=n?e.parentElement:e;if(iw.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=e;e;){var l=e.parentElement,c=S4(e);if(l&&!l.shadowRoot&&s(l)===!0)return ece(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(s0t(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return ece(e);return!1},o0t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return iw.call(r,"fieldset[disabled] *")?!0:!s.contains(e)}return!0}r=r.parentElement}return!1},C4=function(e,r){return!(r.disabled||E4(r)||Qyt(r)||n0t(r,e)||Kyt(r)||o0t(r))},BG=function(e,r){return!(i0t(r)||zCe(r)<0||!C4(e,r))},a0t=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},l0t=function t(e){var r=[],i=[];return e.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=zCe(a,o),c=o?t(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(Jyt).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},c0t=function(e,r){r=r||{};var i;return r.getShadowRoot?i=VCe([e],r.includeContainer,{filter:BG.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:a0t}):i=UCe(e,r.includeContainer,BG.bind(null,r)),l0t(i)},c5t=function(e,r){r=r||{};var i;return r.getShadowRoot?i=VCe([e],r.includeContainer,{filter:C4.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=UCe(e,r.includeContainer,C4.bind(null,r)),i},u5t=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return iw.call(e,T4)===!1?!1:BG(r,e)},u0t=NCe.concat("iframe").join(","),h5t=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return iw.call(e,u0t)===!1?!1:C4(r,e)};const h0t={getShadowRoot:!0};function d5t(t){const e="dir",r=`[${e}]`,i=d0t(t,r);return i?i.getAttribute(e):"ltr"}function FY(t){return t.getRootNode()}function p5t(t){const e=FY(t);return"host"in e?e:null}function BCe(t){return t.host||null}function f5t(t,{selector:e,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=FY(s),o=r?"getElementById"in n?n.getElementById(r):null:e?n.querySelector(e):null,a=BCe(n);return o||(a?i(a):null)}return i(t)}function d0t(t,e){function r(i){return i?i.closest(e)||r(BCe(FY(i))):null}return r(t)}function p0t(t,e){return GCe(t,e)}function GCe(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return GCe(i instanceof ShadowRoot?i.host:i,e)}function m5t(t,e){return!!p0t(e,r=>r===t?!0:void 0)}function f0t(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function g5t(t){if(t)return f0t(t)?t.setFocus():t.focus()}function y5t(t){t&&(c0t(t,h0t)[0]||t).focus()}const JO=":not([slot])";function _5t(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(s=>`[slot="${s}"]`).join(","):`[slot="${e}"]`:JO;return r!=null&&r.all?m0t(t,i,r):g0t(t,i,r)}function jCe(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function m0t(t,e,r){let i=e===JO?jCe(t,JO):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===t),i=r!=null&&r.matches?i.filter(n=>n==null?void 0:n.matches(r.matches)):i;const s=r==null?void 0:r.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function g0t(t,e,r){let i=e===JO?jCe(t,JO)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const s=r==null?void 0:r.selector;return s?i==null?void 0:i.querySelector(s):i}function v5t(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function b5t(t){return(!!t).toString()}function w5t(t){return!!y0t(t).length}function y0t(t){return t.target.assignedElements({flatten:!0})}function x5t(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */function tce(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(DCe)||t.contains(LCe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function _0t(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?tce():document.addEventListener("DOMContentLoaded",()=>tce(),{once:!0}))}const v0t=_0t;v0t();let HCe;function b0t(){try{nyt(".")}catch{oyt(Zc(kr(HCe)))}}function T5t(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return Promise.all(e)}HCe="components/assets";const qCe=Symbol("widget"),w0t=Symbol("widget-test-data"),x0t=[],T0t={},A4=new WeakMap;function WCe(t,e){let r=e.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=WCe(t,r[s]);else r=x0t;const i=e.vnodeSelector;if(UY(i)){const s=e.properties||T0t,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:S0t,afterUpdate:E0t,afterRemoved:XCe,parentWidget:t,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return e}function S0t(t,e,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,A4.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i._internalHandles.add(Ba(()=>XCe(t)))}function E0t(t,e,r,{widgetProperties:i}){var n;const s=A4.get(t);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,t))}function XCe(t){var r;const e=A4.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),A4.delete(t))}function UY(t){return typeof t=="function"&&t[qCe]}const rce=new Set;function C0t(t){rce.add(t),t.finally(()=>rce.delete(t))}var ZCe;const A0t="esri.widgets.Widget";let O0t=0;const R0t={widgetIcon:"esri-icon-checkbox-unchecked"};function YCe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?YCe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const P0t=syt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,s,n,o)=>{const a=e==null?void 0:e(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),h=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(Rye(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let F9=!1,$n=class extends j4(Is.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new Pi,this._projector=P0t,this._readyForTrueRender=!1,this.iconClass=R0t.widgetIcon,this.icon=null,this.key=this,this._loadLocale=CH(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await Gf(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{if(this.destroyed)return;let c=await _de(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=YCe(Q(c),this.uiStrings)),this[l]=c}));if(this.destroyed)return;for(const a of o)a.error&&J.getLogger(this).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),b0t();const i="esri-widget-uid-"+QF(),s=this.render.bind(this);this._trackingTarget=new k4(()=>this.scheduleRender());const n=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;const o=s();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;l||(a.key=i),this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return(h=o.children)==null||h.forEach(p=>{if(UY(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),WCe(this,o)};this.render=()=>{if(F9)return n();let o=t8e(this)??null;if(o)return o;this._trackingTarget.clear(),F9=!0;try{o=xg(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{F9=!1}return o&&r8e(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),C0t(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(yJ)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Pe(this._trackingTarget),Pe(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,Z6(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return _5(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+O0t++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(ZCe=qCe,w0t)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Z6(this),this._projector.scheduleRender())}classes(...e){return a8e.apply(this,e)}renderNow(){Z6(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this._internalHandles.add(ue(()=>this.viewModel,(i,s)=>{s&&this._internalHandles.remove("delegated-events"),i&&V4(i)&&this._internalHandles.add(this._delegatedEventNames.map(n=>sR(i,n,o=>{this.emit(n,o)})),"delegated-events")},Vr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(yJ),this.scheduleRender()};this._internalHandles.add([gde(e),ue(()=>this.uiStrings,e),bh(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};$n[ZCe]=!0,u([d()],$n.prototype,"_readyForTrueRender",void 0),u([d({value:null})],$n.prototype,"container",null),u([gr("container")],$n.prototype,"castContainer",null),u([d()],$n.prototype,"iconClass",void 0),u([d()],$n.prototype,"icon",void 0),u([d()],$n.prototype,"id",null),u([d()],$n.prototype,"label",null),u([d()],$n.prototype,"renderable",null),u([d()],$n.prototype,"uiStrings",void 0),u([d()],$n.prototype,"viewModel",void 0),u([d({value:!0})],$n.prototype,"visible",null),u([d()],$n.prototype,"key",void 0),u([d()],$n.prototype,"children",void 0),u([d()],$n.prototype,"afterCreate",void 0),u([d()],$n.prototype,"afterUpdate",void 0),u([d()],$n.prototype,"afterRemoved",void 0),$n=u([R(A0t)],$n);const JR=$n;function ice(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function M0t(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function B$(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function $0t(t){return t.type==="bing-maps"}const Ly=[];let gT=class extends pO{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Mt,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>ue(()=>{var s;return[i.suspended,(s=i.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),e&&e.removed&&e.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([ka(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),bh(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t==null?void 0:t.allLayerViews;Ly.length=0,t&&e?(e.forEach(r=>{var n;if(r.suspended||!((n=r.layer)!=null&&n.attributionVisible))return;const i=r.layer;if(ice(i,"user"))return void B$(Ly,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const o=this._fetchedAttributionData.get(r);return void(o?B$(Ly,r,this._getDynamicAttribution(o,t,i)):ice(i)&&B$(Ly,r,i.copyright))}return void this._fetchAttributionData(r)}const s=i.get("portalItem.accessInformation");B$(Ly,r,s||i.copyright)}),M0t(this.items,Ly)&&(this.items.removeAll(),this.items.addMany(Ly)),Ly.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await lu(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const r=e.ok?this._createContributionIndex(e.value,$0t(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)}this._updateAttributionItems()}_createContributionIndex(t,e){const r=t.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),h=a.zoomMax-(e&&a.zoomMax?1:0),p=new yr({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ge.WGS84}),f={extent:tA(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)i[m]??(i[m]=[]),i[m].push(f)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(t,e,r){var c;const{extent:i,scale:s}=e;let n=((c=r.tileInfo)==null?void 0:c.scaleToZoom(s))??0;if(n=Math.min(t.maxKey??0,Math.round(n)),!i||n==null||n<=-1)return"";const o=t[n],a=ow(i.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(h=>{const p=h.id,f=!l.has(p)&&a&&h.extent&&rq(h.extent,a);return f&&l.add(p),f}).sort((h,p)=>p.score-h.score||h.objectId-p.objectId).map(h=>h.attribution).join(", "):""}};u([d({readOnly:!0,type:Mt})],gT.prototype,"items",void 0),u([d({readOnly:!0})],gT.prototype,"state",null),u([d()],gT.prototype,"view",void 0),gT=u([R("esri.widgets.Attribution.AttributionViewModel")],gT);const JCe=gT;function e6(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:L0t(t[e])}}}function I0t(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function L0t(t){return function(e,...r){I0t(e)?d8e(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function t6(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var D0t=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},QCe=function(t,e){for(var r=0,i=t.length;r<i;r++){var s=t[r];Array.isArray(s)?QCe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=D0t(s)),e.push(s))}},N0t=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var s=[];return QCe(r,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function Ua(t,e,...r){return typeof t!="function"||UY(t)?N0t(t,e,...r):t(e,...r)}const $x="esri-attribution",Dy={base:`${$x} esri-widget`,poweredBy:`${$x}__powered-by`,sources:`${$x}__sources`,open:`${$x}--open`,sourcesOpen:`${$x}__sources--open`,link:`${$x}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Ca=class extends JR{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=Dy.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new JCe}initialize(){this.addHandles(ka(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Dy.open]:this._isOpen};return Ua("div",{bind:this,class:this.classes(Dy.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Ua("div",{class:Dy.poweredBy},"Powered by"," ",Ua("a",{class:Dy.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:s}=this,n={[Dy.sourcesOpen]:e,[Dy.interactive]:r};return Ua("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Dy.sources,n),innerHTML:s,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],Ca.prototype,"_isOpen",void 0),u([d()],Ca.prototype,"_isInteractive",null),u([d()],Ca.prototype,"_attributionTextOverflowed",void 0),u([d()],Ca.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ca.prototype,"attributionText",null),u([d()],Ca.prototype,"iconClass",void 0),u([d()],Ca.prototype,"icon",void 0),u([d()],Ca.prototype,"itemDelimiter",void 0),u([d()],Ca.prototype,"label",null),u([d(),t6("esri/widgets/Attribution/t9n/Attribution")],Ca.prototype,"messages",void 0),u([d()],Ca.prototype,"view",null),u([d({type:JCe})],Ca.prototype,"viewModel",void 0),u([e6()],Ca.prototype,"_toggleState",null),Ca=u([R("esri.widgets.Attribution")],Ca);const F0t=Ca,U0t=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return M4(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([d()],e.prototype,"goToOverride",void 0),u([d()],e.prototype,"view",void 0),e=u([R("esri.widgets.support.GoTo")],e),e},V0t="esri.widgets.CompassViewModel";let m1=class extends U0t(xe){constructor(e){super(e),this._handles=new Pi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ue(()=>this.view,this._updateRotationWatcher,Vr))}destroy(){Li(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var r;if(!this.get("view.ready"))return;const e={};((r=this.view)==null?void 0:r.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ue(()=>e==null?void 0:e.rotation,this._updateForRotation,Vr):ue(()=>e==null?void 0:e.camera,this._updateForCamera,Vr))}};u([d({readOnly:!0})],m1.prototype,"canShowNorth",null),u([d()],m1.prototype,"orientation",void 0),u([d({readOnly:!0})],m1.prototype,"state",null),u([d()],m1.prototype,"view",void 0),m1=u([R(V0t)],m1);const KCe=m1,Ny={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let hd=class extends JR{constructor(e,r){super(e,r),this.iconClass=Ny.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new KCe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",s=(r==="rotation"?"rotation":"compass")=="compass",n=i?-1:0,o={[Ny.disabled]:i,[Ny.interactive]:!i},a={[Ny.northIcon]:s,[Ny.rotationIcon]:!s},{messages:l}=this;return Ua("div",{bind:this,class:this.classes(Ny.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},Ua("span",{"aria-hidden":"true",class:this.classes(Ny.icon,a),styles:this._toRotationTransform(e)}),Ua("span",{class:Ny.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],hd.prototype,"goToOverride",null),u([d()],hd.prototype,"iconClass",void 0),u([d()],hd.prototype,"icon",void 0),u([d()],hd.prototype,"label",null),u([d(),t6("esri/widgets/Compass/t9n/Compass")],hd.prototype,"messages",void 0),u([d()],hd.prototype,"view",null),u([d({type:KCe})],hd.prototype,"viewModel",void 0),u([e6()],hd.prototype,"_reset",null),hd=u([R("esri.widgets.Compass")],hd);const z0t=hd,Ix="esri-navigation-toggle",Eu={base:`${Ix} esri-widget`,button:`${Ix}__button esri-widget--button`,activeButton:`${Ix}__button--active`,panButton:`${Ix}__button--pan`,rotateButton:`${Ix}__button--rotate`,isLayoutHorizontal:`${Ix}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let yT=class extends xe{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(bh(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],yT.prototype,"state",null),u([d()],yT.prototype,"navigationMode",void 0),u([d()],yT.prototype,"view",void 0),yT=u([R("esri.widgets.NavigationToggleViewModel")],yT);const e3e=yT;let dd=class extends JR{constructor(e,r){super(e,r),this.iconClass=Eu.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new e3e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[Eu.disabled]:e,[Eu.isLayoutHorizontal]:this.layout==="horizontal"},s={[Eu.activeButton]:r},n={[Eu.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return Ua("div",{bind:this,class:this.classes(Eu.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},Ua("div",{class:this.classes(Eu.button,Eu.panButton,s)},Ua("span",{class:Eu.panIcon})),Ua("div",{class:this.classes(Eu.button,Eu.rotateButton,n)},Ua("span",{class:Eu.rotationIcon})))}_toggle(){this.toggle()}};u([d()],dd.prototype,"iconClass",void 0),u([d()],dd.prototype,"icon",void 0),u([d()],dd.prototype,"label",null),u([d({value:"vertical"})],dd.prototype,"layout",null),u([d(),t6("esri/widgets/NavigationToggle/t9n/NavigationToggle")],dd.prototype,"messages",void 0),u([d()],dd.prototype,"view",null),u([d({type:e3e})],dd.prototype,"viewModel",void 0),u([e6()],dd.prototype,"_toggle",null),dd=u([R("esri.widgets.NavigationToggle")],dd);const k0t=dd,dC={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Nm=class extends JR{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,r={[dC.disabled]:!this.enabled,[dC.interactive]:this.enabled};return Ua("div",{bind:this,class:this.classes(dC.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Ua("span",{"aria-hidden":"true",role:"presentation",class:this.classes(dC.icon,this.iconClass??"")}),Ua("span",{class:dC.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],Nm.prototype,"action",void 0),u([d()],Nm.prototype,"enabled",void 0),u([d()],Nm.prototype,"iconClass",void 0),u([d()],Nm.prototype,"icon",void 0),u([d()],Nm.prototype,"title",void 0),u([e6()],Nm.prototype,"_triggerAction",null),Nm=u([R("esri.widgets.IconButton")],Nm);const sce=Nm;let _T=class extends xe{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};u([d({readOnly:!0})],_T.prototype,"canZoomIn",null),u([d({readOnly:!0})],_T.prototype,"canZoomOut",null),u([d()],_T.prototype,"view",void 0),_T=u([R("esri.widgets.Zoom.ZoomConditions2D")],_T);const B0t=_T;let vT=class extends xe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],vT.prototype,"canZoomIn",null),u([d({readOnly:!0})],vT.prototype,"canZoomOut",null),u([d()],vT.prototype,"view",void 0),vT=u([R("esri.widgets.Zoom.ZoomConditions3D")],vT);const G0t=vT;let l0=class extends xe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new B0t({view:e}):e.type==="3d"&&(this._zoomConditions=new G0t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():uV(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():uV(e.goTo({zoomFactor:.5}))}};u([d()],l0.prototype,"_zoomConditions",void 0),u([d()],l0.prototype,"canZoomIn",null),u([d()],l0.prototype,"canZoomOut",null),u([d({readOnly:!0})],l0.prototype,"state",null),u([d()],l0.prototype,"view",null),l0=u([R("esri.widgets.Zoom.ZoomViewModel")],l0);const t3e=l0,pC={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Qp=class extends JR{constructor(e,r){super(e,r),this.iconClass=pC.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new t3e}initialize(){this._zoomInButton=new sce({action:this.zoomIn.bind(this),iconClass:pC.zoomInIcon}),this._zoomOutButton=new sce({action:this.zoomOut.bind(this),iconClass:pC.zoomOutIcon})}destroy(){this._zoomInButton=Pe(this._zoomInButton),this._zoomOutButton=Pe(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[pC.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:s}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=s;const{zoomIn:n,zoomOut:o}=this.messages;return this._zoomInButton.title=n,this._zoomOutButton.title=o,Ua("div",{class:this.classes(pC.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],Qp.prototype,"iconClass",void 0),u([d()],Qp.prototype,"icon",void 0),u([d()],Qp.prototype,"label",null),u([d({value:"vertical"})],Qp.prototype,"layout",null),u([d(),t6("esri/widgets/Zoom/t9n/Zoom")],Qp.prototype,"messages",void 0),u([d()],Qp.prototype,"view",null),u([d({type:t3e})],Qp.prototype,"viewModel",void 0),Qp=u([R("esri.widgets.Zoom")],Qp);const j0t=Qp;function H0t(t){return(t==null?void 0:t.view)!==void 0}let NL=class extends Jgt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const s=this._find(i),n=s==null?void 0:s.widget;H0t(n)&&(n.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([ue(()=>this.components,this._componentsWatcher,Vr),ue(()=>this.view,this._updateViewAwareWidgets,Vr)])}_add(e,r,i,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,s,n)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new DL({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new F0t({view:r});case"compass":return new z0t({view:r});case"navigation-toggle":return new k0t({view:r});case"zoom":return new j0t({view:r})}}};u([d()],NL.prototype,"components",void 0),NL=u([R("esri.views.ui.DefaultUI")],NL);const r3e=NL;let FL=class extends r3e{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],FL.prototype,"components",void 0),FL=u([R("esri.views.ui.3d.DefaultUI3D")],FL);const i3e=FL;let Xe=class extends lUe(t9e(A8e(V9e))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Mg({slicePlane:tye},this),this._resourceController=Oat(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new A7({view:this}),this.labeler=new a1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new J2,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new U1,this.environmentManager=new sd,this.floors=new Mt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new B9e({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new jot,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new i3e,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new sG,this.voxelWasm=null,this.voxelWasmPromise=null,W5e(),t&&t.environment||(this._defaults.environment=new Kx,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===ri.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([ka(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ue(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new Zqe({view:this}),this.stateManager=new un({view:this})}initialize(){this.groundView=new B8e({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(ka(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Vr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Vr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>NOe(e>0?1e3/Math.ceil(e):0),Vr),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Cs),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Cs),this.addHandles(ue(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Gr))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Pe(this.sharedSymbolResources),this._set("labeler",Pe(this.labeler)),this._set("deconflictor",Pe(this.deconflictor)),this._resourceController=Pe(this._resourceController),this._set("stateManager",Pe(this.stateManager)),this._set("inputManager",Pe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Pe(this.environmentManager)),this.groundView=Pe(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof yr?this.spatialReference&&(t=G$(t,this.spatialReference),t==null)?(J.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(J.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?J.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Ie.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:G$(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Ge.WGS84,r=G$(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||Ge.WGS84;let e;const r=n=>{const o=G$(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const n=i.groundExtent;r(new yr({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof Kx?t:t instanceof g0e?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):Kx.fromWebsceneEnvironment(t):Hs(Kx,t):new Kx}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){xL.isValidProfile(t)&&(xL.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||xL.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");yw(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?sUe(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?fw.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||BO(a))return;++r,t+=a.updatingProgress}}else++r});for(const a of this._updatingObjects)a!=null&&a.updating&&(r+=.1,t+=.5*.1);for(const a of this._updatingObjectsWithProgress)a!=null&&a.updating&&(++r,t+=a.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.updating||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(t!=null)return K6(t);const e=this.spatialReference;return e?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?K6(this.defaultsFromMap.viewingMode):p7(e,Ie.Global)?"global":"local":"global"}set viewingMode(t){this.ready?J.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new elt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return J.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),s=JK(t)?YK(this,t):t,n=lf(s);r.enableDraped=r.include&&!r.include.has(R0)||r.exclude&&r.exclude.has(R0);const o=this.sceneIntersectionHelper,a=Ch(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?fo.ALL:fo.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=VG(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return J.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?ff(this.elevationProvider,t):null)??0;return yo(t,Lx,this.renderSpatialReference,e),this.state.camera.projectToScreen(Lx,U9),_h(U9[0],U9[1])}pixelSizeAt(t){return this.ready?t?(yo(t,Lx,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Lx)):0:(J.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return J.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=JK(t)?YK(this,t):t,i=Zi(r.x,r.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Ch(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=fo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Fle(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:lp(a)?a.distanceInRenderSpace:0,layer:c}};return ni.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(t){const{results:e,ground:r}=await Mgt(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new U("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return P9(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return M9(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[M9(r[0],this._pixelFormat()),M9(r[1],this._pixelFormat())]}_completeSettings(t){const e=ugt(t,this);return e.pixelRatio/=this.state.pixelRatio,fgt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!oe("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=P9(r[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[i,P9(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return nee.importLayerView(t)}hasLayerViewModule(t){return nee.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=kgt(this.type);const e=oe("safari");if(e&&e<9&&(t=new U("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw J.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?ree(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,Ie.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Ie.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,Ie.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Ie.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!p7(t,r)&&(e==null||!!eQ(e)||(!sA(e)||GF(e,t,r)!=null)&&(!KJ(e)||r!==Ie.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,s=t.isWGS84;return eQ(e)&&(i||s)?!s||r===Ie.Local||cY(e.tileInfo,e.fullExtent,t,Ie.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:Ge.WebMercator,viewingMode:r}]:[{spatialReference:i?Ge.WGS84:Ge.WebMercator,viewingMode:r}]:sA(e)||KJ(e)||!i&&!s?sA(e)&&i&&r!==Ie.Global?[{spatialReference:t,viewingMode:r},{spatialReference:Ge.WGS84,viewingMode:Ie.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?Ge.WGS84:Ge.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?J.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${K6(r)} viewing mode.`):t.isGeographic&&J.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||Ge.WGS84;return Gs(t,this.renderSpatialReference,t,r)||(r=Ge.WGS84,Gs(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new pt(t,r),e}trackGraphicState(t){if(!t.graphic)return J.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const s=n=>{var o;!i&&n!=null&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return P2(t.map(r=>this.highlight(r)));if(Mt.isCollection(t))return P2(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Ba()}maskOccludee(t){if(!t)return J.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const s=n=>{!i&&n!=null&&Igt(n)&&(r=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await j2(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new U("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,jA.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,jA.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(Lx)?(e=this.computeMapPointFromVec3d(Lx,e),t.intersector===Bi.TERRAIN&&this.basemapTerrain&&(e.z=ff(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let s=0;s<t.length;s++){const n=t[s],o=Fle(n,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=VG(n,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&s!==t.length-1&&(i=new Set),i!=null){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var s;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const n=i.objectIdField??oUe,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof vh)q0t(r,this._getGraphicFilterUid(t)),e===jA.INCLUDE&&(this.graphicsView!=null&&t.layer===this?fC(r,this.graphicsView.processor.layer.id):t.layer&&fC(r,t.layer.uid));else if(sV(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?fC(r,this.graphicsView.processor.layer.id):i===this.map.ground?fC(r,R0):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&fC(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new Cht({view:this})),this._set("elevationProvider",new T3({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new hl({view:this})),this._set("featureTiles",new so({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?mw(e5(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>ni.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ae(()=>import("./FeatureTileTree3DDebugger-4ed448fe.js"),["assets/FeatureTileTree3DDebugger-4ed448fe.js","assets/TileTreeDebugger-a9368681.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&ni.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||ni.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Cs),this.updatingHandles.add(()=>this.clippingArea,t,Cs),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Cs)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new uat(this.map,t));const e=this.state.isGlobal,r=iUe(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",fat.create(this.state.viewingMode,r)),e||this.addHandles(ue(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const s=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!_R(i,this.basemapTerrain.spatialReference,nce,s)||(this.renderCoordsHelper.extent=nce)},Gr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(aS/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===ri.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(ue(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Gr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new Hot(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const r=_5(this.surface);this._stage=new Dc({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Vr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Vr),ue(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,Cs),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()}),sR(this._stage.renderView.canvas,"webglcontextlost",s=>this.fatalError=new U("webgl-context-lost",s.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:sG.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(aS/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Pe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new ilt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ae(()=>import("./GraphicsView3D-020ebb69.js"),["assets/GraphicsView3D-020ebb69.js","assets/GraphicsProcessor-3fa24682.js","assets/Graphics3DObjectStates-78412461.js","assets/optimizedFeatureQueryEngineAdapter-16bcdb07.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-812c43b8.js","assets/quickselect-94603516.js"])).default;Jt(t),await j2(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=ree(this.viewingMode);if(t===Ie.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(ka(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(R0);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(R0);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=ae(()=>import("./VoxelWasmPerSceneView-3e92c62b.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function fC(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function q0t(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function G$(t,e){return t!=null&&If(t.spatialReference,e)?mw(t,e):null}var jA;Xe.type="3d",u([d()],Xe.prototype,"_userClippingArea",void 0),u([d()],Xe.prototype,"_resourceController",void 0),u([d()],Xe.prototype,"_stage",void 0),u([d({readOnly:!0})],Xe.prototype,"deconflictor",void 0),u([d({readOnly:!0})],Xe.prototype,"labeler",void 0),u([d(fk(J2,"analyses"))],Xe.prototype,"analyses",void 0),u([d({type:tS,readOnly:!0})],Xe.prototype,"animation",null),u([d({readOnly:!0})],Xe.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],Xe.prototype,"elevationProvider",void 0),u([d()],Xe.prototype,"camera",null),u([d({type:gh})],Xe.prototype,"contentCamera",null),u([d({readOnly:!0})],Xe.prototype,"canvas",void 0),u([d({type:pt})],Xe.prototype,"center",null),u([d({type:yr})],Xe.prototype,"clippingArea",null),u([d({type:U1})],Xe.prototype,"constraints",void 0),u([d({type:yr,readOnly:!0})],Xe.prototype,"renderDataExtent",null),u([d({type:yr,readOnly:!0})],Xe.prototype,"dataExtent",null),u([d({type:yr,readOnly:!0})],Xe.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:Kx})],Xe.prototype,"environment",null),u([gr("environment")],Xe.prototype,"castEnvironment",null),u([d({readOnly:!0})],Xe.prototype,"environmentManager",void 0),u([d({type:yr})],Xe.prototype,"extent",null),u([d()],Xe.prototype,"floors",void 0),u([d()],Xe.prototype,"screenCenter",null),u([d()],Xe.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],Xe.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],Xe.prototype,"graphicsView",void 0),u([d({readOnly:!0})],Xe.prototype,"analysisViewManager",void 0),u([d()],Xe.prototype,"groundView",void 0),u([d({type:Boolean})],Xe.prototype,"initialExtentRequired",null),u([d()],Xe.prototype,"_defaultsFromMapSettings",null),u([d()],Xe.prototype,"interacting",null),u([d()],Xe.prototype,"stationary",null),u([d()],Xe.prototype,"navigating",null),u([d()],Xe.prototype,"map",void 0),u([d({readOnly:!0})],Xe.prototype,"mapCoordsHelper",void 0),u([d()],Xe.prototype,"padding",null),u([d({type:hl,readOnly:!0})],Xe.prototype,"pointsOfInterest",void 0),u([d({type:so,readOnly:!0})],Xe.prototype,"featureTiles",void 0),u([d()],Xe.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],Xe.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],Xe.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],Xe.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],Xe.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],Xe.prototype,"state",void 0),u([d({readOnly:!0})],Xe.prototype,"inputManager",void 0),u([d({readOnly:!0})],Xe.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],Xe.prototype,"qualityProfile",null),u([d({type:Ane,get(){let t=this._get("qualitySettings");return t||(t=new Ane,xL.apply(this.qualityProfile,t)),t}})],Xe.prototype,"qualitySettings",void 0),u([d()],Xe.prototype,"slicePlane",null),u([d({readOnly:!0})],Xe.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],Xe.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],Xe.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Xe.prototype,"resolution",null),u([d({type:Number})],Xe.prototype,"scale",null),u([d()],Xe.prototype,"heightModelInfo",null),u([d()],Xe.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],Xe.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],Xe.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],Xe.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],Xe.prototype,"type",void 0),u([d(),gr(t=>t instanceof r3e?t:Sb(i3e,t))],Xe.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],Xe.prototype,"updating",null),u([d()],Xe.prototype,"_updatingObjects",null),u([d()],Xe.prototype,"_updatingObjectsWithProgress",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],Xe.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],Xe.prototype,"viewingMode",null),u([d({type:tp})],Xe.prototype,"viewpoint",null),u([d({type:Number})],Xe.prototype,"zoom",null),u([d({type:sG})],Xe.prototype,"highlightOptions",void 0),Xe=u([R("esri.views.SceneView")],Xe),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(jA||(jA={}));const Lx=C(),U9=Zi(),nce=zt(),W0t=Xe;var GG;let D3=GG=class extends de{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new GG({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],D3.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],D3.prototype,"maxValue",void 0),D3=GG=u([R("esri.renderer.support.AuthoringInfoClassBreakInfo")],D3);var jG;let E0=jG=class extends de{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new jG({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:Q(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],E0.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],E0.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],E0.prototype,"label",void 0),u([d({type:[D3],json:{write:!0}})],E0.prototype,"classBreakInfos",void 0),E0=jG=u([R("esri.renderers.support.AuthoringInfoFieldInfo")],E0);var HG;const j$=new Or({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),H$=new Or({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),oce={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},ace=["high-to-low","above-and-below","centered-on","extremes"],lce=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],cce=["seconds","minutes","hours","days","months","years"];let kl=HG=class extends de{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new HG({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:oce,json:{write:!0}})],kl.prototype,"endTime",void 0),u([gr("endTime")],kl.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],kl.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],kl.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],kl.prototype,"minSliderValue",void 0),u([d({types:oce,json:{write:!0}})],kl.prototype,"startTime",void 0),u([gr("startTime")],kl.prototype,"castStartTime",null),u([d({type:j$.apiValues,value:null,json:{type:j$.jsonValues,read:j$.read,write:j$.write}})],kl.prototype,"style",null),u([d({type:lce,value:null,json:{type:lce,origins:{"web-scene":{type:ace,write:{writer:(t,e)=>{ace.includes(t)&&(e.theme=t)}}}},write:!0}})],kl.prototype,"theme",null),u([d({type:H$.apiValues,json:{type:H$.jsonValues,read:H$.read,write:H$.write}})],kl.prototype,"type",void 0),u([d({type:cce,json:{type:cce,write:!0}})],kl.prototype,"units",void 0),kl=HG=u([R("esri.renderers.support.AuthoringInfoVisualVariable")],kl);const X0t=kl;let UL=class extends de{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],UL.prototype,"type",void 0),UL=u([R("esri.rest.support.ColorRamp")],UL);const VY=UL;var qG;let g1=qG=class extends VY{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new qG({fromColor:Q(this.fromColor),toColor:Q(this.toColor),algorithm:this.algorithm})}};u([et({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],g1.prototype,"algorithm",void 0),u([d({type:ke,json:{type:[Yi],write:!0}})],g1.prototype,"fromColor",void 0),u([d({type:ke,json:{type:[Yi],write:!0}})],g1.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],g1.prototype,"type",void 0),g1=qG=u([R("esri.rest.support.AlgorithmicColorRamp")],g1);const zY=g1;var WG;let N3=WG=class extends VY{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new WG({colorRamps:Q(this.colorRamps)})}};u([d({type:[zY],json:{write:!0}})],N3.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],N3.prototype,"type",void 0),N3=WG=u([R("esri.rest.support.MultipartColorRamp")],N3);const s3e=N3,Z0t={key:"type",base:VY,typeMap:{algorithmic:zY,multipart:s3e}};function Y0t(t){return t&&t.type?t.type==="algorithmic"?zY.fromJSON(t):t.type==="multipart"?s3e.fromJSON(t):null:null}var XG;const Rv=new Or({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),q$=new Or({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),uce=new Or({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),hce=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],J0t=["high-to-low","above-and-below","above","below","90-10"],Q0t=["flow-line","wave-front"],K0t=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let zs=XG=class extends de{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?Y0t(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new XG({classificationMethod:this.classificationMethod,colorRamp:Q(this.colorRamp),fadeRatio:Q(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:Q(this.field1),field2:Q(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:Rv.apiValues,value:null,json:{type:Rv.jsonValues,read:Rv.read,write:Rv.write,origins:{"web-document":{default:"manual",type:Rv.jsonValues,read:Rv.read,write:Rv.write}}}})],zs.prototype,"classificationMethod",null),u([d({types:Z0t,json:{write:!0}})],zs.prototype,"colorRamp",void 0),u([Se("colorRamp")],zs.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],zs.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],zs.prototype,"fields",null),u([d({type:E0,value:null,json:{write:!0}})],zs.prototype,"field1",null),u([d({type:E0,value:null,json:{write:!0}})],zs.prototype,"field2",null),u([d({type:Q0t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],zs.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],zs.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],zs.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:Yi,write:!0}})],zs.prototype,"numClasses",null),u([d({type:hce,json:{type:hce,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],zs.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],zs.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],zs.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],zs.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],zs.prototype,"standardDeviationInterval",null),u([d({type:q$.apiValues,value:null,json:{type:q$.jsonValues,read:q$.read,write:q$.write,origins:{"web-scene":{type:uce.jsonValues,write:{writer:uce.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],zs.prototype,"type",null),u([d({type:[X0t],json:{write:!0}})],zs.prototype,"visualVariables",void 0),u([d({type:K0t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],zs.prototype,"univariateSymbolStyle",null),u([d({type:J0t,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],zs.prototype,"univariateTheme",null),zs=XG=u([R("esri.renderers.support.AuthoringInfo")],zs);const kY=zs,V9=new Or({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let F3=class extends de{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:kY,json:{write:!0}})],F3.prototype,"authoringInfo",void 0),u([d({type:V9.apiValues,readOnly:!0,json:{type:V9.jsonValues,read:!1,write:{writer:V9.write,ignoreOrigin:!0}}})],F3.prototype,"type",void 0),F3=u([R("esri.renderers.Renderer")],F3);const Jg=F3;function e_t(t){var e,r;return((r=(e=t.match(t_t))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const t_t=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var ZG;let C2=ZG=class extends de{constructor(){super(...arguments),this.title=null}clone(){return new ZG({title:this.title})}};u([d({type:String,json:{write:!0}})],C2.prototype,"title",void 0),C2=ZG=u([R("esri.renderers.support.LegendOptions")],C2);var YG;let VL=YG=class extends C2{constructor(){super(...arguments),this.showLegend=null}clone(){return new YG({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],VL.prototype,"showLegend",void 0),VL=YG=u([R("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],VL);const n3e=VL,z9=new Or({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let pd=class extends de{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):nR(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],pd.prototype,"index",void 0),u([d({type:z9.apiValues,readOnly:!0,json:{read:z9.read,write:z9.write}})],pd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],pd.prototype,"field",void 0),u([gr("field")],pd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],pd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],pd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],pd.prototype,"arcadeRequired",null),u([d({type:n3e,json:{write:!0}})],pd.prototype,"legendOptions",void 0),pd=u([R("esri.renderers.visualVariables.VisualVariable")],pd);const QR=pd;var JG;let y1=JG=class extends de{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new JG({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:ke,json:{type:[Yi],write:!0}})],y1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],y1.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],y1.prototype,"value",void 0),u([De("value")],y1.prototype,"writeValue",null),y1=JG=u([R("esri.renderers.visualVariables.support.ColorStop")],y1);const r_t=y1;var QG;let _1=QG=class extends QR{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new QG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],_1.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],_1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],_1.prototype,"normalizationField",void 0),u([d({type:[r_t],json:{write:!0}})],_1.prototype,"stops",null),_1=QG=u([R("esri.renderers.visualVariables.ColorVariable")],_1);const o3e=_1;var KG;let c0=KG=class extends de{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return N2(e.transparency)}writeOpacity(t,e,r){e[r]=Q4(t)}clone(){return new KG({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],c0.prototype,"label",void 0),u([d({type:Number,json:{type:Yi,write:{target:"transparency"}}})],c0.prototype,"opacity",void 0),u([Se("opacity",["transparency"])],c0.prototype,"readOpacity",null),u([De("opacity")],c0.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],c0.prototype,"value",void 0),c0=KG=u([R("esri.renderers.visualVariables.support.OpacityStop")],c0);const i_t=c0;var ej;let v1=ej=class extends QR{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new ej({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],v1.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],v1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],v1.prototype,"normalizationField",void 0),u([d({type:[i_t],json:{write:!0}})],v1.prototype,"stops",null),v1=ej=u([R("esri.renderers.visualVariables.OpacityVariable")],v1);const a3e=v1;var tj;let Fm=tj=class extends QR{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new U("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new tj({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],Fm.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Fm.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],Fm.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Fm.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],Fm.prototype,"valueExpressionTitle",void 0),u([De("web-scene","valueExpressionTitle")],Fm.prototype,"writeValueExpressionTitleWebScene",null),Fm=tj=u([R("esri.renderers.visualVariables.RotationVariable")],Fm);const l3e=Fm;var rj;let bT=rj=class extends de{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new rj({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],bT.prototype,"label",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],bT.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],bT.prototype,"value",void 0),bT=rj=u([R("esri.renderers.visualVariables.support.SizeStop")],bT);const wT=bT;var ij;let zL=ij=class extends n3e{constructor(){super(...arguments),this.customValues=null}clone(){return new ij({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],zL.prototype,"customValues",void 0),zL=ij=u([R("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],zL);const s_t=zL;var sj;const W$=new Or({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),nj=new Or({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function dce(t){if(t!=null)return typeof t=="string"||typeof t=="number"?Yr(t):t.type==="size"?J0(t)?t:(delete(t={...t}).type,new ui(t)):void 0}function pce(t,e,r){if(typeof t!="object")return t;const i=new ui;return i.read(t,r),i}let ui=sj=class extends QR{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&Bwe.test(this.valueExpression)}}set expression(t){J.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){J0(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),J0(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return kwe(this)}set maxDataValue(t){t&&this.stops&&(J.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(J.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return dce(t)}readMaxSize(t,e,r){return pce(t,e,r)}set minDataValue(t){t&&this.stops&&(J.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(J.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return dce(t)}readMinSize(t,e,r){return pce(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(J.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return hJe(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new U("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?nj.read(t):null}clone(){return new sj({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:J0(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:J0(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===ao.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===ao.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};u([d({readOnly:!0})],ui.prototype,"cache",null),u([d({type:W$.apiValues,json:{type:W$.jsonValues,origins:{"web-map":{read:!1}},read:W$.read,write:W$.write}})],ui.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],ui.prototype,"expression",null),u([d()],ui.prototype,"index",null),u([d({type:String,readOnly:!0})],ui.prototype,"inputValueType",null),u([d({type:s_t,json:{write:!0}})],ui.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],ui.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],ui.prototype,"maxSize",null),u([gr("maxSize")],ui.prototype,"castMaxSize",null),u([Se("maxSize")],ui.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],ui.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],ui.prototype,"minSize",null),u([gr("minSize")],ui.prototype,"castMinSize",null),u([Se("minSize")],ui.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],ui.prototype,"normalizationField",void 0),u([d({readOnly:!0})],ui.prototype,"arcadeRequired",null),u([d({type:String})],ui.prototype,"scaleBy",void 0),u([d({type:[wT],value:null,json:{write:!0}})],ui.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],ui.prototype,"target",void 0),u([d({type:String,readOnly:!0})],ui.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],ui.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],ui.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],ui.prototype,"valueExpression",void 0),u([Se("valueExpression",["valueExpression","expression"])],ui.prototype,"readValueExpression",null),u([De("web-scene","valueExpression")],ui.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],ui.prototype,"valueRepresentation",void 0),u([d({type:nj.apiValues,json:{write:nj.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],ui.prototype,"valueUnit",void 0),u([Se("valueUnit")],ui.prototype,"readValueUnit",null),ui=sj=u([R("esri.renderers.visualVariables.SizeVariable")],ui);const r6=ui,n_t={color:o3e,size:r6,opacity:a3e,rotation:l3e},o_t=new Or({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),a_t=/^\[([^\]]+)\]$/i;let kL=class extends xe{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let s=null;return s=r.target===i.target?0:r.target?1:-1,s});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:s,rotationType:n}=r,o=s&&s.match(a_t),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=o_t.read(l.type),h=n_t[c];h||(J.getLogger(this).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new fh("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const p=new h;return p.read(l,i),p})}writeVariables(e,r){const i=[];for(const s of e){const n=s.toJSON(r);n&&i.push(n)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],kL.prototype,"visualVariables",null),kL=u([R("esri.renderers.visualVariables.VisualVariableFactory")],kL);const l_t=kL,c_t={base:QR,key:"type",typeMap:{opacity:a3e,color:o3e,rotation:l3e,size:r6}},nE=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new l_t}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&eu(r,i,n.field),n.normalizationField&&eu(r,i,n.normalizationField),n.valueExpression&&(u_t(n.valueExpression,r,i)||await Tl(r,i,n.valueExpression)))}};return u([d({types:[c_t],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),u([Se("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),u([De("visualVariables")],e.prototype,"writeVisualVariables",null),e=u([R("esri.renderers.mixins.VisualVariablesMixin")],e),e};function u_t(t,e,r){const i=e_t(t);return i!=null&&(eu(e,r,i),!0)}const oE={types:Eme,json:{write:{writer:KN},origins:{"web-scene":{types:WQ,write:{writer:KN},read:{reader:PS({types:WQ})}}}}},c3e={types:{base:bc,key:"type",typeMap:{"simple-fill":ub.typeMap["simple-fill"],"picture-fill":ub.typeMap["picture-fill"],"polygon-3d":ub.typeMap["polygon-3d"]}},json:{write:{writer:KN},origins:{"web-scene":{type:gR,write:{writer:KN}}}}},BL={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var oj;let u0=oj=class extends de{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new oj({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};u([d({type:String,json:{write:!0}})],u0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],u0.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],u0.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],u0.prototype,"maxValue",void 0),u([d(oE)],u0.prototype,"symbol",void 0),u0=oj=u([R("esri.renderers.support.ClassBreakInfo")],u0);const O4=u0;var aj;const u3e="log",GL="percent-of-total",jL="field",X$=new Or({esriNormalizeByLog:u3e,esriNormalizeByPercentOfTotal:GL,esriNormalizeByField:jL}),h_t=Hs(O4);let In=aj=class extends nE(Jg){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(s=>{const n=new O4;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(t,e,r,i){const s=t.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[r]=s}castField(t){return t==null?t:typeof t=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):nR(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&jL||r&&GL||null,e&&r&&J.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==jL&&t!==GL||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new O4({minValue:t,maxValue:e,symbol:Cme(r)}):h_t(Q(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return!this.valueExpression||e!=null&&e.arcade!=null||J.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await d_()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void J.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(e==null||e.arcade==null)){const s=await d_(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new aj({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:Q(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:Q(this.visualVariables),legendOptions:Q(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Tl(t,e,this.valueExpression)];eu(t,e,this.field),eu(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{},{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let s=parseFloat(r[e]);if(i){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===u3e)s=Math.log(s)*Math.LOG10E;else if(i!==GL||n==null||isNaN(n)){if(i===jL&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};u([d(c3e)],In.prototype,"backgroundFillSymbol",void 0),u([d({type:[O4]})],In.prototype,"classBreakInfos",void 0),u([Se("classBreakInfos")],In.prototype,"readClassBreakInfos",null),u([De("classBreakInfos")],In.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],In.prototype,"defaultLabel",void 0),u([d(oE)],In.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],In.prototype,"field",void 0),u([gr("field")],In.prototype,"castField",null),u([d({type:Boolean})],In.prototype,"isMaxInclusive",void 0),u([d({type:C2,json:{write:!0}})],In.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],In.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],In.prototype,"normalizationField",void 0),u([d({type:Number,cast:t=>Zu(t),json:{write:!0}})],In.prototype,"normalizationTotal",void 0),u([d({type:X$.apiValues,value:null,json:{type:X$.jsonValues,read:X$.read,write:X$.write}})],In.prototype,"normalizationType",null),u([et({classBreaks:"class-breaks"})],In.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],In.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],In.prototype,"valueExpressionTitle",void 0),In=aj=u([R("esri.renderers.ClassBreaksRenderer")],In);const h3e=In;function d_t(t){return t.type==="date"||t.type==="esriFieldTypeDate"||t.type==="date-only"||t.type==="esriFieldTypeDateOnly"||t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset"}function fce(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function mce(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let BY=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const s=i==null?void 0:i.name,n=yce(i==null?void 0:i.name);if(s&&n){const o=gce(s);this._fieldsMap.set(s,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(n,i),r.push(o),d_t(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):$q(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),fce(i)||mce(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)fce(e)||mce(e)||e.nullable||ILe(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(gce(e))??this._normalizedFieldsMap.get(yce(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function gce(t){return t.trim().toLowerCase()}function yce(t){var e;return((e=mLe(t))==null?void 0:e.toLowerCase())??""}const _ce="esri.renderers.support.DictionaryLoader",p_t={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let GY=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new bTe(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(y){if(gs(y))return this._dictionaryPromise=null,null}const s=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),n={};if(this.fieldMap)for(const y of this._symbolFields){const _=this._getFieldName(this.fieldMap[y]);n[y]=_?s?e.attributes[_]:""+e.attributes[_]:""}let o=null;try{o=i==null?void 0:i(n,r)}catch{return null}if(!o||typeof o!="string")return null;const a=TH(o).toString(),l=this._symbolCache.get(a);if(l)return l.catch(()=>{this._symbolCache.pop(a)}),l;const c=o.split(";"),h=[],p=[];for(const y of c)if(y)if(y.includes("po:")){const _=y.substr(3).split("|");if(_.length===3){const v=_[0],w=_[1];let T=_[2];if(w==="DashTemplate")T=T.split(" ").map(x=>Number(x));else if(w==="Color"){const x=new ke(T).toRgba();T=[x[0],x[1],x[2],255*x[3]]}else T=Number(T);p.push({primitiveName:v,propertyName:w,value:T})}}else if(y.includes("|")){for(const _ of y.split("|"))if(this._itemNames.has(_)){h.push(_);break}}else this._itemNames.has(y)&&h.push(y);const f=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point",m=this._cimPartsToCIMSymbol(h,p,f,r);return this._symbolCache.put(a,m,1),m}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void J.getLogger(_ce).error("no valid URL!");const r=Nr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:i}]=await Promise.all([r,d_()]);if(!i)throw this._dictionaryPromise=null,new U("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=i,l=o;let c=!1;n&&(this._dictionaryVersion=Qb.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const h={};if(this.config){const m=this.config;for(const y in m)h[y]=m[y]}if(s.configuration)for(const m of s.configuration)h.hasOwnProperty(m.name)||(h[m.name]=m.value);const p=[];if(e!=null&&e.fields&&this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m],_=e.fields.filter(v=>v.name.toLowerCase()===(y==null?void 0:y.toLowerCase()));_.length>0&&p.push({..._[0],type:c?_[0].type:"esriFieldTypeString"})}p.length>0&&(this._fieldIndex=new BY(p));const f=dLe(l,e!=null?e.spatialReference:null,p,h).then(m=>{const y={scale:0};return(_,v)=>{if(m==null)return null;const w=m.repurposeFeature({geometry:null,attributes:_});return y.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:w,$view:y},m.services)}}).catch(m=>(J.getLogger(_ce).error("Creating dictinoary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,r,i,s){const n=new Array(e.length);for(let l=0;l<e.length;l++)n[l]=this._getSymbolPart(e[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)d3e(l,a);return new zS({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(n=>n.data);const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),s=Nr(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(e),n}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const s={...e[0]};if(e.length>1){s.symbolLayers=[];for(const n of e){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=p_t),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}_getFieldName(e){if(this._fieldIndex!==null){const r=this._fieldIndex.get(e);return r?r.name:e}return e}};function d3e(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&f_t(s,e)}}function f_t(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":d3e(s,e);break;case"CIMTextSymbol":s.fieldMap=e}}}const G5t=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:GY},Symbol.toStringTag,{value:"Module"}));var lj;let fd=lj=class extends nE(Jg){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new GY(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i!=null&&i.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new lj({config:Q(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Q(this.fieldMap),url:Q(this.url),visualVariables:Q(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Tl(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:GY})],fd.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],fd.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],fd.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],fd.prototype,"scaleExpression",void 0),u([De("scaleExpression")],fd.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],fd.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],fd.prototype,"url",void 0),u([De("visualVariables")],fd.prototype,"writeVisualVariables",null),fd=lj=u([R("esri.renderers.DictionaryRenderer")],fd);const m_t=fd;var cj;let Um=cj=class extends de{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):nR(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new cj({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:ke,json:{type:[Number],write:!0}})],Um.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Um.prototype,"field",void 0),u([gr("field")],Um.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Um.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],Um.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Um.prototype,"valueExpressionTitle",void 0),Um=cj=u([R("esri.renderers.support.AttributeColorInfo")],Um);const p3e=Um;var uj;let HL=uj=class extends de{constructor(){super(...arguments),this.unit=null}clone(){return new uj({unit:this.unit})}};u([d({type:String,json:{write:!0}})],HL.prototype,"unit",void 0),HL=uj=u([R("esri.renderers.support.DotDensityLegendOptions")],HL);const g_t=HL;var hj;let Bl=hj=class extends nE(Jg){constructor(t){super(t),this.attributes=null,this.backgroundColor=new ke([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Oh,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new dw({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,r)=>e+r.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new hj({attributes:Q(this.attributes),backgroundColor:Q(this.backgroundColor),dotBlendingEnabled:Q(this.dotBlendingEnabled),dotShape:Q(this.dotShape),dotSize:Q(this.dotSize),dotValue:Q(this.dotValue),legendOptions:Q(this.legendOptions),outline:Q(this.outline),referenceScale:Q(this.referenceScale),visualVariables:Q(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await Tl(t,e,r.valueExpression),r.field&&t.add(r.field)}};u([d({type:[p3e],json:{write:!0}})],Bl.prototype,"attributes",void 0),u([d({type:ke,json:{write:!0}})],Bl.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],Bl.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],Bl.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],Bl.prototype,"dotSize",void 0),u([d({type:g_t,json:{write:!0}})],Bl.prototype,"legendOptions",void 0),u([d({type:Oh,json:{default:null,write:!0}})],Bl.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],Bl.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],Bl.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],Bl.prototype,"seed",void 0),u([et({dotDensity:"dot-density"})],Bl.prototype,"type",void 0),Bl=hj=u([R("esri.renderers.DotDensityRenderer")],Bl);const y_t=Bl;var dj;let U3=dj=class extends de{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new dj({color:this.color,ratio:this.ratio})}};u([d({type:ke,json:{type:[Yi],default:null,write:!0}})],U3.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],U3.prototype,"ratio",void 0),U3=dj=u([R("esri.renderers.support.HeatmapColorStop")],U3);const qL=U3;let xT=class extends Gi(de){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],xT.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],xT.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],xT.prototype,"title",void 0),xT=u([R("esri.renderers.support.HeatmapLegendOptions")],xT);const jY=2.4;function __t(t){return yh(t*jY)}function v_t(t){return uo(t)/jY}function b_t(t,e,r,i){let{color:s,ratio:n}=e,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ye((i-n)/(a-n),0,1);J4(t,s.toArray(),o.toArray(),l)}function H5t(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],s=t[0],n=1;const o=Zt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)i=s,s=t[n++];b_t(o,i,s,l),r.set(o,4*a)}return r}function q5t(t,e,r,i){const{radius:s,fieldOffset:n,field:o}=e,a=Math.round(uo(s)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const p=x_t(o,n),f=new Set;for(const m of t){const y=m.getCursor();for(;y.next();){const _=y.getObjectId();if(f.has(_))continue;f.add(_);const v=y.readLegacyPointGeometry(),w=128;if(v.x<-w||v.x>=r+w||v.y<-w||v.y>i+w)continue;const T=+p(y),x=Math.max(0,Math.round(v.x)-a),S=Math.max(0,Math.round(v.y)-a),O=Math.min(i,Math.round(v.y)+a),A=Math.min(r,Math.round(v.x)+a);for(let P=S;P<O;P++)for(let I=x;I<A;I++){const V=P*r+I,k=w_t(v.x-I,v.y-P,a);c=l[V]+=k*T,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function w_t(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function W5t(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function x_t(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var pj;const f3e="esri.renderers.HeatmapRenderer",T_t=J.getLogger(f3e);function vce(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let io=pj=class extends Jg{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new qL({ratio:0,color:new ke("rgba(255, 140, 0, 0)")}),new qL({ratio:.75,color:new ke("rgba(255, 140, 0, 1)")}),new qL({ratio:.9,color:new ke("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return vce(t)}get blurRadius(){return v_t(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",__t(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(jY**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||oa(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,RS(()=>{Id(T_t,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=vce(t),super.read(t,e)}getSymbol(){return new L_}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await eu(t,e,r),i&&typeof i=="string"&&await Tl(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new pj({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:Q(this.colorStops),field:this.field,legendOptions:Q(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:kY,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],io.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],io.prototype,"blurRadius",null),u([d({type:[qL],json:{write:!0}})],io.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],io.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],io.prototype,"fieldOffset",void 0),u([d({type:xT,json:{write:!0}})],io.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],io.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],io.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],io.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],io.prototype,"minPixelIntensity",null),u([d({type:Number,cast:Yr,json:{write:!0}})],io.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],io.prototype,"referenceScale",void 0),u([et({heatmap:"heatmap"})],io.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],io.prototype,"valueExpression",void 0),u([d({type:String})],io.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],io.prototype,"_pixelIntensityToDensity",null),io=pj=u([R(f3e)],io);const m3e=io;let q1=class extends Gi(de){constructor(){super(...arguments),this.color=new ke([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:ke,json:{write:!0}})],q1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],q1.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],q1.prototype,"threshold",void 0),q1=u([R("esri.renderers.support.OthersCategory")],q1);let WL=class extends Gi(de){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],WL.prototype,"title",void 0),WL=u([R("esri.renderers.support.PieChartLegendOptions")],WL);let Nc=class extends nE(Gi(Jg)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new ke([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new q1,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new L_({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(nw)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await Tl(e,r,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[p3e],json:{write:!0}})],Nc.prototype,"attributes",void 0),u([d({type:dw,json:{default:null,write:!0}})],Nc.prototype,"backgroundFillSymbol",void 0),u([d({type:ke,json:{write:!0}})],Nc.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],Nc.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Nc.prototype,"holePercentage",void 0),u([d({type:q1,json:{write:!0}})],Nc.prototype,"othersCategory",void 0),u([d({type:WL,json:{write:!0}})],Nc.prototype,"legendOptions",void 0),u([d({type:Oh,json:{default:null,write:!0}})],Nc.prototype,"outline",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Nc.prototype,"size",void 0),u([et({pieChart:"pie-chart"})],Nc.prototype,"type",void 0),Nc=u([R("esri.renderers.PieChartRenderer")],Nc);const S_t=Nc;var fj;let b1=fj=class extends nE(Jg){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new fj({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Q(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],b1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],b1.prototype,"label",void 0),u([d(oE)],b1.prototype,"symbol",void 0),u([et({simple:"simple"})],b1.prototype,"type",void 0),b1=fj=u([R("esri.renderers.SimpleRenderer")],b1);const i6=b1,E_t=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function mj(t){return t instanceof xe}function bce(t){return t instanceof Mt?Object.keys(t.items):mj(t)?oa(t).keys():t?Object.keys(t):[]}function Z$(t,e){return t instanceof Mt?t.items[e]:t[e]}function C_t(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function HA(t){return t?t.declaredClass:null}function g3e(t,e){var p;const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=bce(t),s=bce(e);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||C_t(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(f=>!i.includes(f)),o=i.filter(f=>!s.includes(f)),a=i.filter(f=>s.includes(f)&&Z$(t,f)!==Z$(e,f)).concat(n,o).sort(),l=HA(t);if(l&&E_t.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const h=mj(t)&&mj(e);for(const f of a){const m=Z$(t,f),y=Z$(e,f);let _;if((h||typeof m!="function"&&typeof y!="function")&&m!==y&&(m!=null||y!=null)){if(r&&r[f]&&typeof r[f]=="function")_=(p=r[f])==null?void 0:p.call(r,m,y);else if(m instanceof Date&&y instanceof Date){if(m.getTime()===y.getTime())continue;_={type:"complete",oldValue:m,newValue:y}}else _=typeof m=="object"&&typeof y=="object"&&HA(m)===HA(y)?g3e(m,y):{type:"complete",oldValue:m,newValue:y};_!=null&&(c!=null?c.diff[f]=_:c={type:"partial",diff:{[f]:_}})}}return c}function A_t(t,e){if(t==null)return!1;const r=e.split(".");let i=t;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function J5t(t,e){for(const r of e)if(A_t(t,r))return!0;return!1}function O_t(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&HA(t)!==HA(e)?{type:"complete",oldValue:t,newValue:e}:g3e(t,e)}function Y$(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!Y$(r))return!1;for(const r of e.removed)if(!Y$(r))return!1;for(const r of e.changed)if(!Y$(r))return!1;return!0}case"partial":for(const e in t.diff)if(!Y$(t.diff[e]))return!1;return!0}}let TT=class extends Gi(de){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(BL)],TT.prototype,"value",void 0),u([d(BL)],TT.prototype,"value2",void 0),u([d(BL)],TT.prototype,"value3",void 0),TT=u([R("esri.renderers.support.UniqueValue")],TT);const A2=TT;let h0=class extends Gi(de){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new A2({value:i})):r==="object"?e[0]instanceof A2?e:e.map(i=>new A2(i)):null}};u([d({type:String,json:{write:!0}})],h0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],h0.prototype,"label",void 0),u([d(oE)],h0.prototype,"symbol",void 0),u([d({type:[A2],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new A2({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const s=[i.value,i.value2,i.value3].filter(nw).map(n=>n.toString());r.push(s)}e.values=r}}}})],h0.prototype,"values",void 0),u([gr("values")],h0.prototype,"castValues",null),h0=u([R("esri.renderers.support.UniqueValueClass")],h0);const y3e=h0;let V3=class extends Gi(de){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],V3.prototype,"heading",void 0),u([d({type:[y3e],json:{write:!0}})],V3.prototype,"classes",void 0),V3=u([R("esri.renderers.support.UniqueValueGroup")],V3);const gj=V3;var yj;let w1=yj=class extends de{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new yj({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};u([d({type:String,json:{write:!0}})],w1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],w1.prototype,"label",void 0),u([d(oE)],w1.prototype,"symbol",void 0),u([d(BL)],w1.prototype,"value",void 0),w1=yj=u([R("esri.renderers.support.UniqueValueInfo")],w1);const qA=w1;var z3;const _3e="esri.renderers.UniqueValueRenderer",Fy=J.getLogger(_3e),wce="uvInfos-watcher",xce="uvGroups-watcher",R_t=",",P_t=Hs(qA);function M_t(t){const{field1:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!r);return[{classes:(n??[]).map(l=>{var w;const{symbol:c,label:h,value:p,description:f}=l,[m,y,_]=a?((w=p==null?void 0:p.toString())==null?void 0:w.split(s||""))||[]:[p],v=[];return(e||o)&&v.push(m),r&&v.push(y),i&&v.push(_),{symbol:c,label:h,values:[v],description:f}})}]}let ws=z3=class extends nE(Jg){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=e.find(a=>a.value===r[n].value);o?O_t(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<e.length;n++)r.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:nR(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new U("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):Fy.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||jn.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=Ag(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=Og(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?Fy.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?Fy.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var i;if(this.styleOrigin)return void Fy.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?P_t(t):new qA({value:t,symbol:Cme(e)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void Fy.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await d_()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void Fy.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(r==null||r.arcade==null)){const s=await d_(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var i;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new z3({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:Q(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:Q(this.visualVariables),legendOptions:Q(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:Q(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=Q(this.uniqueValueInfos),r=Q(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(Q(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),Tl(t,e,this.valueExpression)];eu(t,e,this.field),eu(t,e,this.field2),eu(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return YZ(this.styleOrigin,{portal:this.portal}).then(t=>{var r;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const s=new pw({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new qA({value:i.name,symbol:s});e.push(n),this._valueInfoMap[i.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)!=null&&r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",R_t)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(wce);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(ue(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,s)=>{i!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,wce)}}_watchUniqueValueGroups(){this.removeHandles(xce);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(ue(()=>({classes:r.classes}),(i,s)=>{i!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(ue(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,xce)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of n)for(const c of l.classes??[]){const{symbol:h,label:p,values:f,description:m}=c;for(const y of f??[]){const{value:_,value2:v,value3:w}=y,T=[_];r&&T.push(v),i&&T.push(w);const x=a?T.join(s||""):T[0];t.push(new qA({symbol:h,label:p,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!i||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=n.map(c=>{var w;const{symbol:h,label:p,value:f,description:m}=c,[y,_,v]=o?((w=f==null?void 0:f.toString())==null?void 0:w.split(s||""))||[]:[f];return new y3e({symbol:h,label:p,description:m,values:[new A2({value:y,value2:_,value3:v})]})}),l=[new gj({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=e??{};let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(r[e]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new z3(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||jn.getDefault());const i=r.populateFromStyle();return i.catch(s=>{Fy.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(t,e){const r=new z3(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(s=>{Fy.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([d({readOnly:!0})],ws.prototype,"_cache",null),u([et({uniqueValue:"unique-value"})],ws.prototype,"type",void 0),u([d(c3e)],ws.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],ws.prototype,"field",null),u([gr("field")],ws.prototype,"castField",null),u([De("field")],ws.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],ws.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],ws.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],ws.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],ws.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],ws.prototype,"valueExpressionTitle",void 0),u([d({type:C2,json:{write:!0}})],ws.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],ws.prototype,"defaultLabel",void 0),u([d(Uue({...oE},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],ws.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],ws.prototype,"fieldDelimiter",null),u([d({type:jn,readOnly:!0})],ws.prototype,"portal",void 0),u([Se("portal",["styleName"])],ws.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],ws.prototype,"styleOrigin",void 0),u([Se("styleOrigin",["styleName","styleUrl"])],ws.prototype,"readStyleOrigin",null),u([De("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],ws.prototype,"writeStyleOrigin",null),u([d({type:[gj],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||M_t(e)).map(i=>gj.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ws.prototype,"uniqueValueGroups",null),u([d({type:[qA],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ws.prototype,"uniqueValueInfos",null),ws=z3=u([R(_3e)],ws);const HY=ws,s6={key:"type",base:Jg,typeMap:{heatmap:m3e,simple:i6,"unique-value":HY,"class-breaks":h3e,"dot-density":y_t,dictionary:m_t,"pie-chart":S_t},errorContext:"renderer"},v3e={key:"type",base:Jg,typeMap:{simple:i6,"unique-value":HY,"class-breaks":h3e,heatmap:m3e},errorContext:"renderer"};function tFt(t,e){return QO(t,null,e)}const $_t=PS({types:s6});function QO(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new fh("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):$_t(t,e,r):null}let I_t=class b3e{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(lV),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new b3e,i=this._originStores[ur.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,Q(s),ur.DEFAULTS)});for(let s=ur.SERVICE;s<lV;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||r.set(a,Q(o),s)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=ur.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const n=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),n!==r}return!1}delete(e,r=ur.USER){const i=this._originStores[r];if(!i)return;const s=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],s=i&&i.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,r),n!==s}originOf(e){return this._propertyOriginMap.get(e)||ur.DEFAULTS}forEach(e){this._values.forEach(e)}};const w3e=t=>{let e=class extends t{constructor(...r){super(...r);const i=oa(this),s=i.store,n=new I_t;i.store=n,Rhe(i,s,n)}read(r,i){Mhe(this,r,i)}getAtOrigin(r,i){const s=k9(this),n=rg(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return aD(this.originIdOf(r))}originIdOf(r){return k9(this).originOf(r)}revert(r,i){const s=k9(this),n=rg(i),o=oa(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=u([R("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function k9(t){return oa(t).store}let Tce=class extends w3e(xe){};Tce=u([R("esri.core.ReadOnlyMultiOriginJSONSupport")],Tce);const L_t=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return B9(this).delete(r,rg(i))}write(r,i){return Ihe(this,r=r||{},i),r}setAtOrigin(r,i,s){oa(this).setAtOrigin(r,i,rg(s))}removeOrigin(r){const i=B9(this),s=rg(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),ur.USER)}updateOrigin(r,i){const s=B9(this),n=rg(i),o=this.get(r);for(let a=n+1;a<lV;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return e=u([R("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function B9(t){return oa(t).store}const qY=t=>{let e=class extends L_t(w3e(t)){constructor(...r){super(...r)}};return e=u([R("esri.core.MultiOriginJSONSupport")],e),e};let Sce=class extends qY(xe){};Sce=u([R("esri.core.MultiOriginJSONSupport")],Sce);function D_t(t){return"portalItem"in t}const x3e=t=>{let e=class extends t{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):D_t(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],e.prototype,"apiKey",null),e=u([R("esri.layers.mixins.APIKeyMixin")],e),e},T3e=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=vw(this.url);if(r!=null&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",$9e(r,J.getLogger(this)))}};return u([d()],e.prototype,"title",null),u([d({type:String})],e.prototype,"url",null),e=u([R("esri.layers.mixins.ArcGISService")],e),e},S3e=new Is.EventEmitter;function sFt(t,e,r=!1){const i=mo();return r=e==null||r,S3e.emit("apply-edits",{serviceUrl:t,layerId:e,mayReceiveServiceEdits:r,result:i.promise}),i}const E3e="esri.layers.mixins.EditBusLayer",C3e=Symbol(E3e);function nFt(t){return t!=null&&typeof t=="object"&&C3e in t}const A3e=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([S3e.on("apply-edits",s=>{const{serviceUrl:n,layerId:o,mayReceiveServiceEdits:a,result:l}=s,c=n===this.url,h=o!=null&&this.layerId!=null&&o===this.layerId;if(!c||!h&&!a)return;const p=l.then(f=>{var y;if(h&&(f.addedFeatures.length||f.updatedFeatures.length||f.deletedFeatures.length||f.addedAttachments.length||f.updatedAttachments.length||f.deletedAttachments.length))return this.emit("edits",Q(f)),f;const m=(y=f.editedFeatures)==null?void 0:y.find(({layerId:_})=>_===this.layerId);if(m){const{adds:_,updates:v,deletes:w}=m.editedFeatures,T={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:_?_.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],deletedFeatures:w?w.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],updatedFeatures:v?v.map(({current:{attributes:x}})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],editedFeatures:Q(f.editedFeatures),exceededTransferLimit:!1};return this.emit("edits",T),T}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:Q(f.editedFeatures),exceededTransferLimit:!1}});this.emit("apply-edits",{result:p})})])},()=>{})}};return e=C3e,r=u([R(E3e)],r),r},Ece={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},Cce={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},Ace={ArcGISFeatureLayer:!0},N_t={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":Ece,"web-map/basemap":Cce,"web-map/tables":Ace,"link-chart/operational-layers":{...Ece,LinkChartLayer:!0},"link-chart/basemap":Cce,"link-chart/tables":Ace,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}};function F_t(t){if(!t)return t;const{start:e,end:r}=t;return new Zf({start:e!=null?pb(e,-e.getTimezoneOffset(),"minutes"):e,end:r!=null?pb(r,-r.getTimezoneOffset(),"minutes"):r})}function U_t(t){if(!t)return t;const{start:e,end:r}=t;return new Zf({start:e!=null?pb(e,e.getTimezoneOffset(),"minutes"):e,end:r!=null?pb(r,r.getTimezoneOffset(),"minutes"):r})}var _j;let k3=_j=class extends de{constructor(t){super(t)}async collectRequiredFields(t,e){return Tl(t,e,this.expression)}clone(){return new _j({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};u([d({type:String,json:{write:!0}})],k3.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],k3.prototype,"title",void 0),k3=_j=u([R("esri.layers.support.FeatureExpressionInfo")],k3);const Oce=k3;var vj;const J$=Ha()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Rce=new Or({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Vm=vj=class extends de{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new vj({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&zAe(this.featureExpressionInfo,t.featureExpressionInfo)}};u([d({type:Oce,json:{write:!0}})],Vm.prototype,"featureExpressionInfo",void 0),u([Se("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Vm.prototype,"readFeatureExpressionInfo",null),u([De("featureExpressionInfo",{featureExpressionInfo:{type:Oce},"featureExpression.value":{type:[0]}})],Vm.prototype,"writeFeatureExpressionInfo",null),u([d({type:J$.apiValues,nonNullable:!0,json:{type:J$.jsonValues,read:J$.read,write:{writer:J$.write,isRequired:!0}}})],Vm.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],Vm.prototype,"offset",void 0),u([d({type:QZe,json:{type:String,read:Rce.read,write:Rce.write}})],Vm.prototype,"unit",null),Vm=vj=u([R("esri.layers.support.ElevationInfo")],Vm);const V_t=Vm,O3e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},n6={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},o6={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},R3e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:f_}}},P3e={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},M3e={value:null,type:V_t,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function oFt(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const $3e={write:!0,read:!0},bj={type:Number,json:{origins:{"web-document":$3e,"portal-item":{write:!0}}}},z_t={...bj,json:{...bj.json,origins:{"web-document":{...$3e,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?N2(e.layerDefinition.drawingInfo.transparency):void 0:N2(e.drawingInfo.transparency)}}},aFt={type:Zf,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;t&&(s=U_t(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;e&&(n=n.offset(-e.value,e.unit)),t&&(n=F_t(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},lFt={type:yr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=yr.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=Ge.fromJSON(e.spatialReference)),r}}}},read:!1}},I3e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},k_t={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},B_t={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},L3e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},D3e=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&HRe(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),BRe(this,r,s=>super.read(r,s),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=N_t[l];let h=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=i.messages)==null||o.push(new U("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof U&&l.name==="web-document-write:property-required").length;return a_(s==null?void 0:s.url)?((a=i==null?void 0:i.messages)==null||a.push(new U("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),u([d(L3e)],e.prototype,"listMode",void 0),u([De("listMode")],e.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),u([De("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),u([d(bj)],e.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),u([De("title"),De(["web-scene"],"title")],e.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=u([R("esri.layers.mixins.OperationalLayer")],e),e};async function G_t(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return bC(t);const r=Ge.WGS84;return await ege(e,r),mw(t,r)}function cFt(t,e){if(!N3e(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function N3e(t,e){var r;return!!((r=t.typeKeywords)!=null&&r.includes(e))}function uFt(t){return N3e(t,j_t.HOSTED_SERVICE)}function hFt(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function dFt(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return G_t(r)}const j_t={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service"};function Pce(t){var l;const{portal:e,isOrgItem:r,itemControl:i}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!r&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const F3e=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Pe(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new ob({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const{load:s}=await ae(()=>import("./layersLoader-5c715f8c.js"),["assets/layersLoader-5c715f8c.js","assets/fetchService-ba68ee1b.js","assets/jsonContext-dbedaf34.js"]);return Jt(i),await s({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw gs(s)||J.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Po(i),!0)))}async _setUserPrivileges(r,i){if(!Zr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Po(s)}}async _fetchUserPrivileges(r,i){let s=this.portalItem;if(!r||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(i);const n=r===s.id;if(n&&s.portal.user)return Pce(s);let o,a;if(n)o=s.portal.url;else try{o=await xde(this.url,i)}catch(p){Po(p)}if(!o||!_Pe(o,s.portal.url))return this._fetchFallbackUserPrivileges(i);try{const p=i!=null?i.signal:null;a=await(wr==null?void 0:wr.getCredential(`${o}/sharing`,{prompt:!1,signal:p}))}catch(p){Po(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new ob({id:r,portal:{url:o}}),await s.load(i)),s.portal.user)return Pce(s)}catch(p){Po(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(s){Po(s)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?wr==null?void 0:wr.findCredential(this.url):null;if(!i)return!0;const s=Q$.credential===i?Q$.user:await this._fetchEditingUser(r);return Q$.credential=i,Q$.user=s,s==null||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var h,p;const i=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(i)return i;const s=wr.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=jn.getDefault();if(o&&o.loaded&&Bd(o.restUrl)===Bd(n))return o.user;const a=`${n}/community/self`,l=r!=null?r.signal:null,c=await lu(Nr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?sq.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||jn.getDefault());return s&&n&&!Vhe(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new U("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([d({type:ob})],e.prototype,"portalItem",null),u([Se("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),u([De("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),u([d({clonable:!1})],e.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=u([R("esri.layers.mixins.PortalLayer")],e),e},Q$={credential:null,user:null},U3e=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&H_t(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=u([R("esri.layers.mixins.ScaleRangeLayer")],e),e};function H_t(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function V3e(t){return t&&"getAtOrigin"in t&&"originOf"in t}function Mce(t){t&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:r,newOrigin:i})=>{V3e(e)&&i&&e.originOf(r)!==i&&e.updateOrigin(r,i)})}async function q_t(t,e,r,i,s,n){let o=null;if(r!=null){const c=`${t}/nodepages/`,h=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await Nr(h,{query:{f:"json",token:i},responseType:"json",signal:n})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(p){s!=null&&s.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,p),o=p}}if(!e)return null;const a=`${t}/nodes/`,l=a+(e&&e.split("/").pop());try{return{type:"node",rootNode:(await Nr(l,{query:{f:"json",token:i},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new U("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}let W_t=null;function X_t(){return W_t}async function Z_t(t,e={},r){await t.load(r);const i=gc(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:r==null?void 0:r.signal},c=await t.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:t.resourceFromPath(f)}))}}async function Y_t(t,e,r,i){if(!t.hasPath())throw new U(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const s=t.portalItem;await s.load(i);const n=gc(s.userItemUrl,e==="add"?"addResources":"updateResources"),[o,a]=z3e(t.path),l=await k3e(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),i!=null&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),i!=null&&i.access&&c.append("access",i.access),await s.portal.request(n,{method:"post",body:c,signal:i==null?void 0:i.signal}),t}async function J_t(t,e,r){if(!e.hasPath())throw new U("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(r);const i=gc(t.userItemUrl,"removeResources");await t.portal.request(i,{method:"post",query:{resource:e.path},signal:r==null?void 0:r.signal}),e.portalItem=null}async function Q_t(t,e){await t.load(e);const r=gc(t.userItemUrl,"removeResources");return t.portal.request(r,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function z3e(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function WY(t){const[e,r]=K_t(t),[i,s]=z3e(e);return[i,s,r]}function K_t(t){const e=qH(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function k3e(t){return t instanceof Blob?t:(await Nr(t.url,{responseType:"blob"})).data}function evt(t,e){if(!t.hasPath())return null;const[r,,i]=WY(t.path);return t.portalItem.resourceFromPath(gc(r,e+i))}function B3e(t,e){if(!t.hasPath())return null;const[r,,i]=WY(t.path);return t.portalItem.resourceFromPath(gc(r,e+i))}const B3=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:Y_t,contentToBlob:k3e,fetchResources:Z_t,getSiblingOfSameType:evt,getSiblingOfSameTypeI:B3e,removeAllResources:Q_t,removeResource:J_t,splitPrefixFileNameAndExtension:WY},Symbol.toStringTag,{value:"Module"}));async function $ce(t,e,r){if(!e||!e.resources)return;const i=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),t.paths.push(c)});for(const c of e.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,y=B3e(h,QF());t.paths.push(y.path),o.push(Ice({resource:y,content:p,compress:c.compress,finish:f,error:m},r))}else t.paths.push(c.resource.path),o.push(tvt(c,r)),n.add(c.resource.path);for(const c of e.resources.toAdd)o.push(Ice(c,r)),t.paths.push(c.resource.path);if(i.forEach(c=>{if(e.portalItem){const h=e.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}}),o.length===0)return;const a=await Gf(o);Jt(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new U("save:resources","Failed to save one or more resources",{errors:l})}async function Ice(t,e){var s,n;const r={...e??{},compress:t.compress},i=await lu(t.resource.portalItem.addResource(t.resource,t.content,r));if(i.ok!==!0)throw(s=t.error)==null||s.call(t,i.error),i.error;(n=t.finish)==null||n.call(t,t.resource)}async function tvt(t,e){var i,s;const r=await lu(t.resource.update(t.content,e));if(r.ok!==!0)throw(i=t.error)==null||i.call(t,r.error),r.error;(s=t.finish)==null||s.call(t,t.resource)}const G3e="esri.layers.mixins.SceneService",Dx=J.getLogger(G3e),rvt=t=>{let e=class extends t{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=CH(async(r,i,s)=>{switch(r){case SS.SAVE:return this._save(i);case SS.SAVE_AS:return this._saveAs(s,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return Ge.fromJSON(r.spatialReference);{const i=r.store,s=i.indexCRS||i.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new Ge(n):null}}readFullExtent(r,i,s){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return yr.fromJSON(a,s)}const n=i.store,o=this._readSpatialReference(i);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<G9)?null:new yr({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},s=r.split(".");return s.length>=2&&(i.major=parseInt(s[0],10),i.minor=parseInt(s[1],10)),i}readVersion(r,i){const s=i.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return t0e(this.url,i.name);let n=i.name;if(!n&&this.url){const o=vw(this.url);o!=null&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),V5(n)}set url(r){const i=r0e({layer:this,url:r,nonStandardUrlAllowed:!1,logger:Dx});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){i0e(this,r,"layers",i,n)}get parsedUrl(){const r=this._get("url"),i=go(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=q_t(this.parsedUrl.path,this.rootNode,r,this.apiKey,Dx,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){var i,s,n;if((r==null?void 0:r.type)==="page"){const o=r.rootIndex%r.pageSize,a=(s=(i=r.rootPage)==null?void 0:i.nodes)==null?void 0:s[o];if(a==null||a.obb==null||a.obb.center==null||a.obb.halfSize==null)throw new U("sceneservice:invalid-node-page","Invalid node page.");if(a.obb.center[0]<G9||this.fullExtent==null||this.fullExtent.hasZ)return;const l=a.obb.halfSize,c=a.obb.center[2],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-h,this.fullExtent.zmax=c+h}else if((r==null?void 0:r.type)==="node"){const o=(n=r.rootNode)==null?void 0:n.mbs;if(!Array.isArray(o)||o.length!==4||o[0]<G9)return;const a=o[2],l=o[3],{fullExtent:c}=this;c&&(c.zmin=a-l,c.zmax=a+l)}}async _fetchService(r){if(this.url==null)throw new U("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await Nr(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){var o;const i=await Nr(((o=this.parsedUrl)==null?void 0:o.path)??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=i.data;this.read(n,this._getServiceContext()),this.validateLayer(n)}async _fetchVoxelServiceLayer(r){var s;const i=(await Nr(((s=this.parsedUrl)==null?void 0:s.path)+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,this._getServiceContext()),this.validateLayer(i)}_getServiceContext(){var r;return{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,s){r.typeKeywords||(r.typeKeywords=[]);const n=i.getTypeKeywords();for(const o of n)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===WA.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){var c;const s={...Lce,...i};let n=ob.from(r);n||(Dx.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new U("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||jn.getDefault();await this._ensureLoadBeforeSave(),n.type=K$,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,WA.newItem),await o.signIn(),await((c=o.user)==null?void 0:c.addItem({item:n,folder:s&&s.folder,data:l})),await $ce(this.resourceReferences,a,null),this.portalItem=n,Mce(a),a.portalItem=n,n}async _save(r){const i={...Lce,...r};if(!this.portalItem)throw Dx.error("_save(): requires the .portalItem property to be set"),new U("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(this.portalItem.type!==K$)throw Dx.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+K$),new U("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${K$}"`);await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&go(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||jn.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(n,s,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,WA.existingItem),await this.portalItem.update({data:n}),await $ce(this.resourceReferences,s,null),Mce(s),this.portalItem}async _validateAgainstJSONSchema(r,i,s){var c,h;let n=((c=i.messages)==null?void 0:c.filter(p=>p.type==="error").map(p=>new U(p.name,p.message,p.details)))??[];(h=s==null?void 0:s.validationOptions)!=null&&h.ignoreUnsupported&&(n=n.filter(p=>p.name!=="layer:unsupported"&&p.name!=="symbol:unsupported"&&p.name!=="symbol-layer:unsupported"&&p.name!=="property:unsupported"&&p.name!=="url:unsupported"&&p.name!=="scenemodification:unsupported"));const o=s==null?void 0:s.validationOptions,a=o==null?void 0:o.enabled,l=X_t();if(a&&l){const p=(await l()).validate(r,s.portalItemLayerType);if(p.length>0){const f=`Layer item did not validate:
${p.join(`
`)}`;if(Dx.error(`_validateAgainstJSONSchema(): ${f}`),o.failPolicy==="throw"){const m=p.map(y=>new U("sceneservice:schema-validation",y)).concat(n);throw new U("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:m})}}}if(n.length>0)throw new U("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([d(I3e)],e.prototype,"id",void 0),u([d({type:Ge})],e.prototype,"spatialReference",void 0),u([Se("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null),u([d({type:yr})],e.prototype,"fullExtent",void 0),u([Se("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null),u([d({readOnly:!0,type:fw})],e.prototype,"heightModelInfo",void 0),u([d({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0),u([d({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0),u([d({readOnly:!0})],e.prototype,"version",void 0),u([Se("version",["store.version"])],e.prototype,"readVersion",null),u([d({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),u([d({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0),u([d({type:String})],e.prototype,"title",void 0),u([Se("portal-item","title")],e.prototype,"readTitlePortalItem",null),u([Se("service","title",["name"])],e.prototype,"readTitleService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0),u([d(R3e)],e.prototype,"url",null),u([De("url")],e.prototype,"writeUrl",null),u([d()],e.prototype,"parsedUrl",null),u([d({readOnly:!0})],e.prototype,"store",void 0),u([d({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],e.prototype,"rootNode",void 0),e=u([R(G3e)],e),e},G9=-1e38;var WA;(function(t){t[t.existingItem=0]="existingItem",t[t.newItem=1]="newItem"})(WA||(WA={}));const K$="Scene Service",Lce={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var SS;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(SS||(SS={}));const ivt={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};let bg=class extends de{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],bg.prototype,"type",void 0),bg=u([R("esri.layers.support.FeatureReduction")],bg);var wj;let XL=wj=class extends bg{constructor(t){super(t),this.type="selection"}clone(){return new wj}};u([d({type:["selection"]})],XL.prototype,"type",void 0),XL=wj=u([R("esri.layers.support.FeatureReductionSelection")],XL);const xj=XL;async function svt(t,e){const{WhereClause:r}=await ae(()=>import("./WhereClause-914ffa63.js").then(i=>i.W),["assets/WhereClause-914ffa63.js","assets/executionError-c92d3b85.js"]);return r.create(t,e)}function nvt(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}var Tj;let x1=Tj=class extends de{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new Tj({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],x1.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],x1.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],x1.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],x1.prototype,"title",void 0),x1=Tj=u([R("esri.form.ExpressionInfo")],x1);const ovt=x1;let T1=class extends de{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],T1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],T1.prototype,"label",void 0),u([d()],T1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],T1.prototype,"visibilityExpression",void 0),T1=u([R("esri.form.elements.Element")],T1);const ES=T1;var Sj;let ZL=Sj=class extends de{constructor(t){super(t),this.type=null}clone(){return new Sj({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],ZL.prototype,"type",void 0),ZL=Sj=u([R("esri.form.elements.inputs.AttachmentInput")],ZL);const avt=ZL;var Ej;let S1=Ej=class extends ES{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new Ej({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],S1.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],S1.prototype,"editable",void 0),u([d({type:avt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],S1.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],S1.prototype,"type",void 0),S1=Ej=u([R("esri.form.elements.AttachmentElement")],S1);const Dce=S1;let YL=class extends de{constructor(e){super(e),this.type=null}};u([d()],YL.prototype,"type",void 0),YL=u([R("esri.form.elements.inputs.Input")],YL);const aE=YL;let G3=class extends aE{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],G3.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],G3.prototype,"minLength",void 0),G3=u([R("esri.form.elements.inputs.TextInput")],G3);const XY=G3;var Cj;let JL=Cj=class extends XY{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new Cj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],JL.prototype,"type",void 0),JL=Cj=u([R("esri.form.elements.inputs.BarcodeScannerInput")],JL);const lvt=JL;var Aj;let ST=Aj=class extends aE{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new Aj({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],ST.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],ST.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],ST.prototype,"type",void 0),ST=Aj=u([R("esri.form.elements.inputs.ComboBoxInput")],ST);const cvt=ST;var Oj;function Nce(t){return t!=null?new Date(t):null}function Fce(t){return t?t.getTime():null}let md=Oj=class extends aE{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return Nce(e.max)}writeMax(t,e){e.max=Fce(t)}readMin(t,e){return Nce(e.min)}writeMin(t,e){e.min=Fce(t)}clone(){return new Oj({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],md.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],md.prototype,"max",void 0),u([Se("max")],md.prototype,"readMax",null),u([De("max")],md.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],md.prototype,"min",void 0),u([Se("min")],md.prototype,"readMin",null),u([De("min")],md.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],md.prototype,"type",void 0),md=Oj=u([R("esri.form.elements.inputs.DateTimePickerInput")],md);const uvt=md;var Rj;let ET=Rj=class extends aE{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new Rj({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],ET.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],ET.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],ET.prototype,"type",void 0),ET=Rj=u([R("esri.form.elements.inputs.RadioButtonsInput")],ET);const hvt=ET;var Pj;let CT=Pj=class extends aE{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Pj({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],CT.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],CT.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],CT.prototype,"type",void 0),CT=Pj=u([R("esri.form.elements.inputs.SwitchInput")],CT);const dvt=CT;var Mj;let QL=Mj=class extends XY{constructor(t){super(t),this.type="text-area"}clone(){return new Mj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],QL.prototype,"type",void 0),QL=Mj=u([R("esri.form.elements.inputs.TextAreaInput")],QL);const pvt=QL;var $j;let KL=$j=class extends XY{constructor(t){super(t),this.type="text-box"}clone(){return new $j({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],KL.prototype,"type",void 0),KL=$j=u([R("esri.form.elements.inputs.TextBoxInput")],KL);const fvt=KL,mvt={base:aE,key:"type",typeMap:{"barcode-scanner":lvt,"combo-box":cvt,"datetime-picker":uvt,"radio-buttons":hvt,switch:dvt,"text-area":pvt,"text-box":fvt}};var Ij;const j3e="esri.form.elements.FieldElement",Uce=J.getLogger(j3e);let Uu=Ij=class extends ES{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return Id(Uce,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){Id(Uce,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new Ij({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:kbe,json:{read:{reader:rZ},write:!0}})],Uu.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Uu.prototype,"editable",null),u([d({type:String,json:{write:!0}})],Uu.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],Uu.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],Uu.prototype,"hint",void 0),u([d({types:mvt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Uu.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],Uu.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],Uu.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Uu.prototype,"valueExpression",void 0),Uu=Ij=u([R(j3e)],Uu);const Vce=Uu;var Lj;let zm=Lj=class extends ES{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Lj({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:Q(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],zm.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],zm.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],zm.prototype,"editableExpression",void 0),u([d({type:[jq],json:{write:!0}})],zm.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],zm.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],zm.prototype,"type",void 0),zm=Lj=u([R("esri.form.elements.RelationshipElement")],zm);const zce=zm;function H3e(t){return{typesWithGroup:{base:ES,key:"type",typeMap:{attachment:Dce,field:Vce,group:t,relationship:zce}},typesWithoutGroup:{base:ES,key:"type",typeMap:{attachment:Dce,field:Vce,relationship:zce}}}}function q3e(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function W3e(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>i[s.type]).map(s=>s.toJSON())}function X3e(t,e,r=!0){return t?t.map(i=>Qd(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var Dj;let tf=Dj=class extends ES{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return X3e(t,j9,!1)}readElements(t,e){return q3e(e.formElements,j9,!1)}writeElements(t,e){e.formElements=W3e(t,j9,!1)}clone(){return new Dj({description:this.description,elements:Q(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],tf.prototype,"elements",void 0),u([gr("elements")],tf.prototype,"castElements",null),u([Se("elements",["formElements"])],tf.prototype,"readElements",null),u([De("elements")],tf.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],tf.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],tf.prototype,"type",void 0),tf=Dj=u([R("esri.form.elements.GroupElement")],tf);const j9=H3e(tf),gvt=tf;var Nj;const H9=H3e(gvt);let gd=Nj=class extends de{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return X3e(t,H9)}readElements(t,e){return q3e(e.formElements,H9)}writeElements(t,e){e.formElements=W3e(t,H9)}clone(){return new Nj({description:this.description,expressionInfos:Q(this.expressionInfos),elements:Q(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],gd.prototype,"description",void 0),u([d({json:{write:!0}})],gd.prototype,"elements",void 0),u([gr("elements")],gd.prototype,"castElements",null),u([Se("elements",["formElements"])],gd.prototype,"readElements",null),u([De("elements")],gd.prototype,"writeElements",null),u([d({type:[ovt],json:{write:!0}})],gd.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],gd.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"title",void 0),gd=Nj=u([R("esri.form.FormTemplate")],gd);const yvt=gd;function kce(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const s of i)s.length>2&&(s[2]*=r)}function _vt(t,e,r){if(!t&&!e||!r)return;const i=sO(r);Bce(t,r,i),Bce(e,r,i)}function Bce(t,e,r){if(t)for(const i of t)vvt(i.geometry,e,r)}function vvt(t,e,r){if(t==null||!t.spatialReference||wn(t.spatialReference,e))return;const i=sO(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)kce(t,t.rings,i);else if("paths"in t)kce(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=i)}}function Gce(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=Zme(r.geometryType,e,t.outSpatialReference);if(i!=null)for(const s of r.features)i(s.geometry)}var Fj;const Uj=new Or({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Eo=Fj=class extends de{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){const r=Ge.fromJSON(e.spatialReference),i=[];for(let s=0;s<t.length;s++){const n=t[s],o=vh.fromJSON(n),a=n.geometry&&n.geometry.spatialReference;o.geometry==null||a||(o.geometry.spatialReference=r);const l=n.aggregateGeometries,c=o.aggregateGeometries;if(l&&c!=null)for(const h in c){const p=c[h],f=l[h],m=f==null?void 0:f.spatialReference;p==null||m||(p.spatialReference=r)}i.push(o)}return i}writeGeometryType(t,e,r,i){if(t)return void Uj.write(t,e,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&n.geometry!=null)return void Uj.write(n.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=c_(t);return i&&!r&&e.spatialReference&&(i.spatialReference=Ge.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&i.geometry!=null&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new Fj(this.cloneProperties())}cloneProperties(){return Q({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const s=t&&t[r];i.geometry=s&&s.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,s]}=t,n=c=>Math.round((c-i)/e),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=t,this}unquantize(){var f,m;const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=y=>y*n+i,l=y=>s-y*o;let c=null,h=null;if(this.hasZ&&((f=r==null?void 0:r.scale)==null?void 0:f[2])!=null){const{translate:[,,y],scale:[,,_]}=r;c=v=>v*_+y}if(this.hasM&&((m=r==null?void 0:r.scale)==null?void 0:m[3])!=null){const{translate:[,,,y],scale:[,,,_]}=r;h=v=>v==null?v:v*_+y}const p=this._getHydrationFunction(t,a,l,c,h);for(const{geometry:y}of e)y!=null&&p&&p(y);return this.transform=null,this}_quantizePoints(t,e,r){let i,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),h=r(l[1]);c===i&&h===s||(n.push([c-i,h-s]),i=c,s=h)}else i=e(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const s=o2(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,r);c&&n.push(c)}return n.length>0?(o2(i)?i.rings=n:i.paths=n,i):null}:t==="multipoint"?i=>{const s=this._quantizePoints(i.points,e,r);return s&&s.length>0?(i.points=s,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r,i,s){return t==="point"?n=>{n.x=e(n.x),n.y=r(n.y),i&&(n.z=i(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=o2(n)?n.rings:n.paths;let a,l;for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];f>0?(a+=y[0],l+=y[1]):(a=y[0],l=y[1]),y[0]=e(a),y[1]=r(l)}}if(i&&s)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=i(y[2]),y[3]=s(y[3])}}else if(i)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=i(y[2])}}else if(s)for(let c=0,h=o.length;c<h;c++){const p=o[c];for(let f=0,m=p.length;f<m;f++){const y=p[f];y[2]=s(y[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=r(n.ymin),n.xmax=e(n.xmax),n.ymax=r(n.ymax),i&&n.zmax!=null&&n.zmin!=null&&(n.zmax=i(n.zmax),n.zmin=i(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,h=o.length;c<h;c++){const p=o[c];c>0?(a+=p[0],l+=p[1]):(a=p[0],l=p[1]),p[0]=e(a),p[1]=r(l)}if(i&&s)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=i(p[2]),p[3]=s(p[3])}else if(i)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=i(p[2])}else if(s)for(let c=0,h=o.length;c<h;c++){const p=o[c];p[2]=s(p[2])}}:null}};u([d({type:String,json:{write:!0}})],Eo.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Eo.prototype,"exceededTransferLimit",void 0),u([d({type:[vh],json:{write:!0}})],Eo.prototype,"features",void 0),u([Se("features")],Eo.prototype,"readFeatures",null),u([d({type:[wF],json:{write:!0}})],Eo.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:Uj.read}}})],Eo.prototype,"geometryType",void 0),u([De("geometryType")],Eo.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Eo.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Eo.prototype,"hasZ",void 0),u([d({types:aw,json:{write:!0}})],Eo.prototype,"queryGeometry",void 0),u([Se("queryGeometry")],Eo.prototype,"readQueryGeometry",null),u([d({type:Ge,json:{write:!0}})],Eo.prototype,"spatialReference",void 0),u([De("spatialReference")],Eo.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Eo.prototype,"transform",void 0),Eo=Fj=u([R("esri.rest.support.FeatureSet")],Eo),Eo.prototype.toJSON.isDefaultToJSON=!0;const Z3e=Eo;let bvt=0;const Y3e="esri.layers.graphics.sources.MemorySource",q9=J.getLogger(Y3e);let Xm=class extends Tg.LoadableMixin(j4(v5(Mt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var r;const e=(r=this.layer)==null?void 0:r.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);Gce(e,this.layer.spatialReference,i);const s=Z3e.fromJSON(i);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new U("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return Gce(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:yr.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new U("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=h=>"objectId"in h&&h.objectId!=null?h.objectId:"attributes"in h&&h.attributes[r]!=null?h.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const p=o(h);p!=null&&s.push(p)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const h of e.updateFeatures)if(n.push(this._serializeFeature(h)),a){const p=o(h);p!=null&&a.set(p,h)}}_vt(i?i.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:n,deletes:s});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const i=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||i.push(s.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const s=e.get(i.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new U("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const n=this;return{features:i,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],h=r.get(l);h&&(h.attributes||(h.attributes={}),c===-1?delete h.attributes[a]:h.attributes[a]=c,n._addIdToClientGraphic(h))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){var e,r;return((e=this.layer)==null?void 0:e.geometryType)??((r=this.sourceJSON)==null?void 0:r.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),s=(bvt++).toString();return i?{uid:s,geometry:i.toJSON(),attributes:r}:{uid:s,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return r==null?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?Hd.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await Ime("MemorySourceWorker",{strategy:oe("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:s,hasM:n,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{q9.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const h={features:c.features,fields:r&&r.map(m=>m.toJSON()),geometryType:pQ.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},p=await this._connection.invoke("load",h,{signal:e});for(const m of p.warnings)q9.warn(m.message,{layer:this.layer,warning:m});p.featureErrors.length&&q9.warn(`Encountered ${p.featureErrors.length} validation errors while loading features`,p.featureErrors);const f=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=pQ.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(p.assignedObjectIds)}};u([IH({Type:vh,ensureType:Hs(vh)})],Xm.prototype,"itemType",void 0),u([d()],Xm.prototype,"type",void 0),u([d({constructOnly:!0})],Xm.prototype,"layer",void 0),u([d({readOnly:!0})],Xm.prototype,"_workerGeometryType",null),u([d()],Xm.prototype,"sourceJSON",void 0),Xm=u([R(Y3e)],Xm);const jce={read:{reader:jZ},write:{allowNull:!0,writer:HZ}},wvt=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":jce,"portal-item":jce}}})],e.prototype,"effect",void 0),e=u([R("esri.layers.mixins.BlendLayer")],e),e},xvt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=u([R("esri.layers.mixins.CustomParametersMixin")],e),e};var Vj;let AT=Vj=class extends de{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new Vj({mapLayerId:t,gdbVersion:e})}};u([et({mapLayer:"map-layer"})],AT.prototype,"type",void 0),u([d({type:Yi,json:{write:!0}})],AT.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],AT.prototype,"gdbVersion",void 0),AT=Vj=u([R("esri.layers.support.source.MapLayerSource")],AT);var zj;let km=zj=class extends de{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:s};return new zj(n)}};u([et({queryTable:"query-table"})],km.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],km.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],km.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],km.prototype,"oidFields",void 0),u([d({type:Ge,json:{write:!0}})],km.prototype,"spatialReference",void 0),u([et(mpe)],km.prototype,"geometryType",void 0),km=zj=u([R("esri.layers.support.source.QueryTableDataSource")],km);var kj;let OT=kj=class extends de{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new kj({workspaceId:t,dataSourceName:e})}};u([et({raster:"raster"})],OT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],OT.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],OT.prototype,"workspaceId",void 0),OT=kj=u([R("esri.layers.support.source.RasterDataSource")],OT);var Bj;let E1=Bj=class extends de{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new Bj({workspaceId:t,gdbVersion:e,dataSourceName:r})}};u([et({table:"table"})],E1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],E1.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],E1.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],E1.prototype,"dataSourceName",void 0),E1=Bj=u([R("esri.layers.support.source.TableDataSource")],E1);var Gj,jj;const Tvt=Ha()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Fc=Gj=class extends de{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return Hce()(t,e,r)}castLeftTableSource(t){return Qd(Hj(),t)}readRightTableSource(t,e,r){return Hce()(t,e,r)}castRightTableSource(t){return Qd(Hj(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:s};return new Gj(n)}};u([et({joinTable:"join-table"})],Fc.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Fc.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],Fc.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],Fc.prototype,"leftTableSource",void 0),u([Se("leftTableSource")],Fc.prototype,"readLeftTableSource",null),u([gr("leftTableSource")],Fc.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],Fc.prototype,"rightTableSource",void 0),u([Se("rightTableSource")],Fc.prototype,"readRightTableSource",null),u([gr("rightTableSource")],Fc.prototype,"castRightTableSource",null),u([et(Tvt)],Fc.prototype,"joinType",void 0),Fc=Gj=u([R("esri.layers.support.source.JoinTableDataSource")],Fc);let W9=null;function Hce(){return W9||(W9=PS({types:Hj()})),W9}let X9=null;function Hj(){return X9||(X9={key:"type",base:null,typeMap:{"data-layer":Ad,"map-layer":AT}}),X9}const Svt={key:"type",base:null,typeMap:{"join-table":Fc,"query-table":km,raster:OT,table:E1}};let Ad=jj=class extends de{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new jj({fields:t,dataSource:e})}};u([et({dataLayer:"data-layer"})],Ad.prototype,"type",void 0),u([d({type:[wF],json:{write:!0}})],Ad.prototype,"fields",void 0),u([d({types:Svt,json:{write:!0}})],Ad.prototype,"dataSource",void 0),Ad=jj=u([R("esri.layers.support.source.DataLayerSource")],Ad),Ad.from=Hs(Ad);let C1=class extends Gi(de){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],C1.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],C1.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],C1.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],C1.prototype,"searchType",void 0),C1=u([R("esri.rest.support.FullTextSearch")],C1);const Evt=C1;var qj;const qce=new Or({upperLeft:"upper-left",lowerLeft:"lower-left"});let A1=qj=class extends de{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new qj(Q({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:yr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],A1.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],A1.prototype,"mode",void 0),u([d({type:String,json:{read:qce.read,write:qce.write}})],A1.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],A1.prototype,"tolerance",void 0),A1=qj=u([R("esri.rest.support.QuantizationParameters")],A1);const Cvt=A1;var Wj;const Wce=new Or({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let yd=Wj=class extends de{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=Q(t))}clone(){return new Wj({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Q(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],yd.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],yd.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],yd.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],yd.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],yd.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Wce.read},write:{target:"statisticType",writer:Wce.write}}})],yd.prototype,"statisticType",void 0),u([d({type:Object})],yd.prototype,"statisticParameters",void 0),u([De("statisticParameters")],yd.prototype,"writeStatisticParameters",null),yd=Wj=u([R("esri.rest.support.StatisticDefinition")],yd);const Avt=yd;var O2;const Ovt=new Or({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Rvt=new Or({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let $t=O2=class extends de{static from(t){return Sb(O2,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const s=t[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new O2(Q({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};$t.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],$t.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],$t.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],$t.prototype,"datumTransformation",void 0),u([gr("datumTransformation")],$t.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],$t.prototype,"distance",void 0),u([d({type:Ad,json:{write:!0}})],$t.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"formatOf3DObjects",void 0),u([d({type:[Evt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],$t.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"gdbVersion",void 0),u([d({types:aw,json:{read:c_,write:!0}})],$t.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],$t.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],$t.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"having",void 0),u([d({type:Date})],$t.prototype,"historicMoment",void 0),u([De("historicMoment")],$t.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],$t.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:t=>t<1?1:t>O2.MAX_MAX_RECORD_COUNT_FACTOR?O2.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],$t.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],$t.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],$t.prototype,"num",void 0),u([d({json:{write:!0}})],$t.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],$t.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],$t.prototype,"outFields",void 0),u([d({type:Ge,json:{name:"outSR",write:!0}})],$t.prototype,"outSpatialReference",void 0),u([d({type:[Avt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],$t.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],$t.prototype,"parameterValues",void 0),u([De("parameterValues")],$t.prototype,"writeParameterValues",null),u([d({type:pt,json:{write:!0}})],$t.prototype,"pixelSize",void 0),u([d({type:Cvt,json:{write:!0}})],$t.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],$t.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],$t.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],$t.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],$t.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$t.prototype,"returnZ",void 0),u([d({type:Ge,json:{write:!0}})],$t.prototype,"sourceSpatialReference",void 0),u([et(Ovt,{ignoreUnknown:!1,name:"spatialRel"})],$t.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],$t.prototype,"start",void 0),u([De("start"),De("num")],$t.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],$t.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],$t.prototype,"text",void 0),u([d({type:Zf,json:{write:!0}})],$t.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],$t.prototype,"timeReferenceUnknownClient",void 0),u([et(Rvt,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],$t.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],$t.prototype,"where",void 0),u([De("where")],$t.prototype,"writeWhere",null),$t=O2=u([R("esri.rest.support.Query")],$t);const k_=$t;var Xj;const Z9=new Or({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Y9=new Or({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Kp=Xj=class extends de{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new k_({geometry:Q(r),objectIds:Q(n),spatialRelationship:i,timeExtent:Q(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new Xj({geometry:Q(e),objectIds:Q(s),spatialRelationship:r,timeExtent:Q(i),where:t,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],Kp.prototype,"where",void 0),u([d({types:aw,json:{write:!0}})],Kp.prototype,"geometry",void 0),u([d({type:Z9.apiValues,json:{name:"spatialRel",read:{reader:Z9.read},write:{allowNull:!1,writer:Z9.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],Kp.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Kp.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],Kp.prototype,"objectIds",void 0),u([d({type:Y9.apiValues,json:{read:Y9.read,write:{writer:Y9.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],Kp.prototype,"units",void 0),u([d({type:Zf,json:{write:!0}})],Kp.prototype,"timeExtent",void 0),Kp=Xj=u([R("esri.layers.support.FeatureFilter")],Kp);const Pvt=Kp;var Zj;const Xce={read:{reader:jZ},write:{writer:HZ,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Zce={read:{reader:jZ},write:{writer:HZ,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Yce={name:"showExcludedLabels",default:!0};let O1=Zj=class extends de{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var i,s;const r=super.write(t,e);if(e!=null&&e.origin){if(r.filter){const n=Object.keys(r.filter);if(n.length>1||n[0]!=="where")return(i=e.messages)==null||i.push(new U("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return(s=e.messages)==null||s.push(new U("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new Zj({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:Pvt,json:{write:{allowNull:!0,writer(t,e,r,i){const s=t==null?void 0:t.write({},i);s&&Object.keys(s).length!==0?Ga(r,s,e):Ga(r,null,e)}}}})],O1.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":Xce,"portal-item":Xce}}})],O1.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":Zce,"portal-item":Zce}}})],O1.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Yce,"portal-item":Yce}}})],O1.prototype,"excludedLabelsVisible",void 0),O1=Zj=u([R("esri.layers.support.FeatureEffect")],O1);const Mvt=O1,Jce={write:{allowNull:!0}},$vt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:Mvt,json:{origins:{"web-map":Jce,"portal-item":Jce}}})],e.prototype,"featureEffect",void 0),e=u([R("esri.layers.mixins.FeatureEffectLayer")],e),e};let Bm=class extends Gi(de){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],Bm.prototype,"creatorField",void 0),u([d()],Bm.prototype,"creationDateField",void 0),u([d()],Bm.prototype,"editorField",void 0),u([d()],Bm.prototype,"editDateField",void 0),u([d()],Bm.prototype,"realm",void 0),u([d({type:K2})],Bm.prototype,"dateFieldsTimeReference",void 0),Bm=u([R("esri.layers.support.EditFieldsInfo")],Bm);const Ivt=Bm;let rf=class extends Gi(de){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],rf.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],rf.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],rf.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],rf.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],rf.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],rf.prototype,"description",void 0),rf=u([R("esri.layers.support.FeatureIndex")],rf);var Yj;let Co=Yj=class extends de{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new Yj(Q({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Co.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Co.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Co.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Co.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Co.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Co.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Co.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Co.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Co.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Co.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Co.prototype,"start",void 0),u([De("start"),De("num")],Co.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Co.prototype,"where",void 0),Co=Yj=u([R("esri.rest.support.AttachmentQuery")],Co),Co.from=Hs(Co);const Lvt=Co;var Jj;let Ds=Jj=class extends de{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new Jj(Q({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],Ds.prototype,"cacheHint",void 0),u([d({type:Ad,json:{write:!0}})],Ds.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Ds.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],Ds.prototype,"geometryPrecision",void 0),u([d({type:Date})],Ds.prototype,"historicMoment",void 0),u([De("historicMoment")],Ds.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Ds.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],Ds.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Ds.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Ds.prototype,"outFields",void 0),u([d({type:Ge,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ds.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],Ds.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ds.prototype,"start",void 0),u([De("start"),De("num")],Ds.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ds.prototype,"num",void 0),u([d({json:{write:!0}})],Ds.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ds.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ds.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ds.prototype,"where",void 0),Ds=Jj=u([R("esri.rest.support.RelationshipQuery")],Ds),Ds.from=Hs(Ds);const ZY=Ds,wFt=Object.freeze(Object.defineProperty({__proto__:null,default:ZY},Symbol.toStringTag,{value:"Module"})),Qj=new Or({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function Dvt(t,e,r,i){const s=await B_(t);if(await YY(t,e,i),!s.addAttachment)throw new U(i,"Layer source does not support addAttachment capability");return s.addAttachment(e,r)}function YY(t,e,r){const{attributes:i}=e,{objectIdField:s}=t;return t.get("capabilities.data.supportsAttachment")?e?i?s&&i[s]?Promise.resolve():Promise.reject(new U(r,`feature is missing the identifying attribute ${s}`)):Promise.reject(new U(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new U(r,"A feature is required to add/delete/update attachments")):Promise.reject(new U(r,"this layer doesn't support attachments"))}async function Nvt(t,e,r,i,s){const n=await B_(t);if(await YY(t,e,s),!n.updateAttachment)throw new U(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,r,i)}async function Fvt(t,e,r){const{applyEdits:i}=await ae(()=>import("./editingSupport-0218b620.js"),["assets/editingSupport-0218b620.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js"]),s=await t.load();return i(s,s.source,e,r)}async function Uvt(t,e,r){const{uploadAssets:i}=await ae(()=>import("./editingSupport-0218b620.js"),["assets/editingSupport-0218b620.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js"]),s=await t.load();return i(s,s.source,e,r)}async function Vvt(t,e,r,i){const s=await B_(t);if(await YY(t,e,i),!s.deleteAttachments)throw new U(i,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,r)}async function zvt(t,e,r){const i=(await t.load({signal:e==null?void 0:e.signal})).source;if(!i.fetchRecomputedExtents)throw new U(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function kvt(t,e,r,i){var m,y;e=Lvt.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new U(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:f}=e;if(!((y=n==null?void 0:n.operations)!=null&&y.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||p||f))throw new U(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new U(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new U(i,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function Bvt(t,e,r,i){const s=await B_(t);if(!s.queryObjectIds)throw new U(i,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(k_.from(e)??t.createQuery(),r)}async function Gvt(t,e,r,i){const s=await B_(t);if(!s.queryFeatureCount)throw new U(i,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(k_.from(e)??t.createQuery(),r)}async function jvt(t,e,r,i){const s=await B_(t);if(!s.queryExtent)throw new U(i,"Layer source does not support queryExtent capability");return s.queryExtent(k_.from(e)??t.createQuery(),r)}async function Hvt(t,e,r,i){const s=await B_(t);if(!s.queryRelatedFeatures)throw new U(i,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(ZY.from(e),r)}async function qvt(t,e,r,i){const s=await B_(t);if(!s.queryRelatedFeaturesCount)throw new U(i,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(ZY.from(e),r)}async function Wvt(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(i!=null&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await svt(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Xvt(t){const e=new k_,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function J3e(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function Q3e(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function Zvt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function B_(t){return(await t.load()).source}async function Yvt(t,e){if(!wr||wr.findCredential(t))return;let r;try{const i=await xde(t,e);i&&(r=await wr.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=e!=null?e.signal:null;await wr.getCredential(t,{signal:i})}catch{}}async function Jvt(t,e){var i;const r=(i=t.parsedUrl)==null?void 0:i.path;r&&Qvt(t)&&await Yvt(r,e)}function Qvt(t){const e=t.editFieldsInfo;return!(!(e!=null&&e.creatorField)&&!(e!=null&&e.editorField))||(t.userHasUpdateItemPrivileges?t.hasUpdateItemRestrictions:!!t.userHasFullEditingPrivileges&&t.hasFullEditingRestrictions)}function Kvt(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const J9=PS({types:Eme});function JY(t,e){if(t.defaultSymbol)return t.types&&t.types.length?new HY({defaultSymbol:J9(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:J9(r.symbol,r,e)}))}):new i6({symbol:J9(t.defaultSymbol,t,e)})}let RT=class extends Gi(de){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],RT.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],RT.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:t=>iMe.read(t)||sMe.read(t)}})],RT.prototype,"units",void 0),RT=u([R("esri.layers.support.GeometryFieldsInfo")],RT);const e1t=RT;var Kj;let PT=Kj=class extends de{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Mt}clone(){return new Kj({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],PT.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],PT.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],PT.prototype,"viewAllLevelIds",void 0),PT=Kj=u([R("esri.layers.support.LayerFloorInfo")],PT);const K3e=PT,Qce=new Or({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Kce=new Or({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Vu=class extends Gi(de){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:Qce.read,write:Qce.write}})],Vu.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],Vu.prototype,"relationshipTableId",void 0),u([d({json:{read:Kce.read,write:Kce.write}})],Vu.prototype,"role",void 0),Vu=u([R("esri.layers.support.Relationship")],Vu);const t1t=Vu,r1t={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function Ut(t,e,r){return!!eAe(t,e,r)}function eI(t,e,r){return eAe(t,e,r)}function eAe(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function i1t(t){var r;const e=(r=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function KR(t,e){var i;const r=(i=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:i.map(s=>s.toLowerCase());return!!(r!=null&&r.includes(e.toLowerCase()))}function tAe(t,e){return{analytics:s1t(t),attachment:n1t(t),data:o1t(t),metadata:a1t(t),operations:l1t(t.capabilities,t,e),query:c1t(t,e),queryRelated:u1t(t),queryTopFeatures:h1t(t),editing:d1t(t)}}function s1t(t){return{supportsCacheHint:KR(t.advancedQueryCapabilities,"queryAnalytics")}}function n1t(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:KR(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:Ut(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const s=r1t[i.name];s&&(r[s]=!!i.isEnabled)}),r}function o1t(t){return{isVersioned:Ut(t,"isDataVersioned",!1),supportsAttachment:Ut(t,"hasAttachments",!1),supportsM:Ut(t,"hasM",!1),supportsZ:Ut(t,"hasZ",!1)}}function a1t(t){return{supportsAdvancedFieldProperties:Ut(t,"supportsFieldDescriptionProperty",!1)}}function l1t(t,e,r){const i=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=r?vw(r):null,n=i.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const h=i.includes("changetracking"),p=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Ut(e,"supportsCalculate",!1),supportsTruncate:Ut(e,"supportsTruncate",!1),supportsValidateSql:Ut(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:Ut(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:Ut(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Ut(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Ut(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Ut(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:Ut(e,"supportsAsyncConvert3D",!1)}}function c1t(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=oe("mapserver-pbf-version-support"),l=LW(e),c=new Set((t.supportedQueryFormats??"").split(",").map(h=>h.toLowerCase().trim()));return{supportsStatistics:Ut(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:Ut(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Ut(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:i1t(r),supportsCentroid:Ut(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Ut(r,"supportsQueryWithDistance",!1),supportsDistinct:Ut(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:Ut(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ut(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ut(r,"supportsHavingClause",!1),supportsOrderBy:Ut(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:Ut(r,"supportsPagination",!1),supportsQuantization:Ut(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ut(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ut(t,"supportsReturningQueryGeometry",!1),supportsResultType:Ut(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ut(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ut(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ut(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Ut(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Ut(i,"allowOthersToQuery",!0),supportsHistoricMoment:Ut(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:Ut(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ut(r,"supportsQueryWithCacheHint",!1)||KR(r,"query"),supportsDefaultSpatialReference:Ut(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:Ut(r,"supportsFullTextSearch",!1),maxRecordCountFactor:eI(t,"maxRecordCountFactor",void 0),maxRecordCount:eI(t,"maxRecordCount",void 0),standardMaxRecordCount:eI(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:eI(t,"tileMaxRecordCount",void 0)}}function u1t(t){const e=t.advancedQueryCapabilities,r=Ut(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ut(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:KR(e,"queryRelated")}}function h1t(t){return{supportsCacheHint:KR(t.advancedQueryCapabilities,"queryTopFilter")}}function d1t(t){const e=t.ownershipBasedAccessControlForFeatures,r=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:Ut(t,"allowGeometryUpdates",!0),supportsGlobalId:Ut(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ut(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ut(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ut(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ut(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ut(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ut(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ut(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ut(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:Ut(r,"supportsAsyncApplyEdits",!1)}}const p1t=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=Ge.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(Mt.ofType(rf)),this.version=void 0}readCapabilitiesFromService(r,i){return tAe(i,this.url)}get effectiveCapabilities(){var o;const r=this.capabilities;if(!r)return null;const i=Q(r),{operations:s,editing:n}=i;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),i)}get hasFullEditingRestrictions(){var n;const r=this.capabilities;if(!r||(n=this.sourceJSON)!=null&&n.isMultiServicesView)return!1;const{operations:i,editing:s}=r;return i.supportsEditing&&!(i.supportsAdd&&i.supportsDelete&&i.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){var n;const r=this.capabilities;if(!r)return!1;const{operations:i,editing:s}=r;return(n=this.sourceJSON)!=null&&n.isMultiServicesView?!i.supportsQuery:!(i.supportsAdd&&i.supportsDelete&&i.supportsEditing&&i.supportsQuery&&i.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readEditingInfo(r,i){const{editingInfo:s}=i;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return J3e(i)}readObjectIdFieldFromService(r,i){return Q3e(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=r0e({layer:this,url:r,nonStandardUrlAllowed:!0,logger:J.getLogger(this)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){i0e(this,r,null,i,n)}readVersion(r,i){return Zvt(i)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),u([Se("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],e.prototype,"effectiveCapabilities",null),u([d({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),u([d({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),u([d({type:K2})],e.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:Ivt})],e.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],e.prototype,"editingInfo",void 0),u([Se("editingInfo")],e.prototype,"readEditingInfo",null),u([d((()=>{const r=Q(M3e),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),u([d({type:K3e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),u([d({type:yr,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),u([d()],e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:e1t,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Qj.read}}}})],e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:fw})],e.prototype,"heightModelInfo",void 0),u([d({type:Date})],e.prototype,"historicMoment",void 0),u([d({readOnly:!0})],e.prototype,"isTable",void 0),u([Se("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),u([d(k_t)],e.prototype,"minScale",void 0),u([Se("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),u([d(B_t)],e.prototype,"maxScale",void 0),u([Se("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),u([d({type:String})],e.prototype,"globalIdField",void 0),u([Se("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],e.prototype,"objectIdField",void 0),u([Se("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),u([d({type:K2})],e.prototype,"preferredTimeReference",void 0),u([d({type:[t1t],readOnly:!0})],e.prototype,"relationships",void 0),u([d()],e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],e.prototype,"returnM",void 0),u([d({type:Boolean})],e.prototype,"returnZ",void 0),u([d({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),u([Se("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),u([d({type:Ge,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),u([d({type:Mt.ofType(rf),readOnly:!0})],e.prototype,"indexes",void 0),u([d(R3e)],e.prototype,"url",null),u([De("url")],e.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),u([Se("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=u([R("esri.layers.mixins.FeatureLayerBase")],e),e};let MT=class extends Gi(de){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],MT.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],MT.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],MT.prototype,"returnType",void 0),MT=u([R("esri.layers.support.ExpressionInfo")],MT);const QY=MT;var eH;let Gm=eH=class extends de{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new eH({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:Q(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],Gm.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],Gm.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],Gm.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],Gm.prototype,"onStatisticField",void 0),u([d({type:QY,json:{write:!0}})],Gm.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],Gm.prototype,"statisticType",void 0),Gm=eH=u([R("esri.layers.support.AggregateField")],Gm);const sw=Gm;var tH;let d0=tH=class extends de{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?I7(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=I7(this.value)),t!=null&&(e[r]=t)}clone(){return new tH({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],d0.prototype,"expression",void 0),u([Se("expression",["expression","value"])],d0.prototype,"readExpression",null),u([De("expression")],d0.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],d0.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],d0.prototype,"value",void 0),d0=tH=u([R("esri.layers.support.LabelExpressionInfo")],d0);const rAe=d0,iAe=[252,146,31,255],EFt=[153,153,153,255],f1t={type:"esriSMS",style:"esriSMSCircle",size:6,color:iAe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},m1t={type:"esriSLS",style:"esriSLSSolid",width:.75,color:iAe},g1t={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},y1t={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},_1t={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},v1t={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},b1t={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},CFt=L_.fromJSON(f1t),AFt=Oh.fromJSON(m1t),OFt=dw.fromJSON(g1t),w1t=BS.fromJSON(y1t);L_.fromJSON(_1t);Oh.fromJSON(v1t);dw.fromJSON(b1t);var rH;const tI=new Or({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function rI(t,e,r){return{enabled:!bde(r==null?void 0:r.layer)}}function sAe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function x1t(t){return(t==null?void 0:t.type)==="map-image"}function nAe(t){var e,r;return!!x1t(t)&&!!((r=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function T1t(t){return sAe(t)||nAe(t==null?void 0:t.layer)}let Xs=rH=class extends de{static evaluateWhere(t,e){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const s=r(e[i[0]],i[1],i[2]),n=i[3],o=r(e[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=w1t,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=TZe(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=nZ(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&sAe(i))t=new rAe({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(i);s.expression&&(e[r]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return xF(this)}getLabelExpressionArcade(){return SZe(this)}getLabelExpressionSingleField(){return EZe(this)}hash(){return JSON.stringify(this)}clone(){return new rH({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Q(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:Q(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Xs.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:rI}}}}})],Xs.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:rI}}}}})],Xs.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&nAe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],Xs.prototype,"labelExpression",void 0),u([Se("labelExpression")],Xs.prototype,"readLabelExpression",null),u([De("labelExpression")],Xs.prototype,"writeLabelExpression",null),u([d({type:rAe,json:{write:{overridePolicy:(t,e,r)=>T1t(r)?{allowNull:!0}:{enabled:!1}}}})],Xs.prototype,"labelExpressionInfo",void 0),u([De("labelExpressionInfo")],Xs.prototype,"writeLabelExpressionInfo",null),u([d({type:tI.apiValues,json:{type:tI.jsonValues,read:tI.read,write:tI.write}})],Xs.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Xs.prototype,"labelPosition",void 0),u([d({type:Number})],Xs.prototype,"maxScale",void 0),u([De("maxScale")],Xs.prototype,"writeMaxScale",null),u([d({type:Number})],Xs.prototype,"minScale",void 0),u([De("minScale")],Xs.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:rI}}}}})],Xs.prototype,"repeatLabel",void 0),u([d({type:Number,cast:Yr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:rI}}}}})],Xs.prototype,"repeatLabelDistance",void 0),u([d({types:g5e,json:{origins:{"web-scene":{types:y5e,write:Ose,default:null}},write:Ose,default:null}})],Xs.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Xs.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Xs.prototype,"where",void 0),Xs=rH=u([R("esri.layers.support.LabelClass")],Xs);const eP=Xs;var iH;const S1t="esri.layers.support.FeatureReductionBinning";let ul=iH=class extends bg{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Ga(r,i,e)}readRenderer(t,e,r){var s;const i=(s=e.drawingInfo)==null?void 0:s.renderer;return i?QO(i,e,r)??void 0:JY(e,r)}clone(){return new iH({fields:Q(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:Q(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:Q(this.popupTemplate),renderer:Q(this.renderer)})}};u([et({binning:"binning"})],ul.prototype,"type",void 0),u([et({geohash:"geohash"})],ul.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],ul.prototype,"fixedBinLevel",void 0),u([d({type:[eP],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],ul.prototype,"labelingInfo",void 0),u([d(o6)],ul.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],ul.prototype,"maxScale",void 0),u([d(n6)],ul.prototype,"popupEnabled",void 0),u([d({type:VS,json:{name:"popupInfo",write:!0}})],ul.prototype,"popupTemplate",void 0),u([d({type:[sw],json:{write:!0}})],ul.prototype,"fields",void 0),u([De("fields")],ul.prototype,"writeFields",null),u([d({types:s6,json:{write:{target:"drawingInfo.renderer"}}})],ul.prototype,"renderer",void 0),u([Se("renderer",["drawingInfo.renderer"])],ul.prototype,"readRenderer",null),ul=iH=u([R(S1t)],ul);const oAe=ul;var sH;const E1t="esri.layers.support.FeatureReductionCluster";function eue(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let Ln=sH=class extends de{constructor(t){super(t),this.type="cluster",this.clusterRadius=Yr("80px"),this.clusterMinSize=Yr("12px"),this.clusterMaxSize=Yr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){var s,n;const i=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated?null:i?eue(i)?null:QO(i,e,r)??void 0:JY(e,r)}readSymbol(t,e,r){var s,n;const i=(s=e.drawingInfo)==null?void 0:s.renderer;if((n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated)return null;if(i&&eue(i)){const o=QO(i,e,r);return o==null?void 0:o.symbol}return null}writeSymbol(t,e,r,i){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new i6({symbol:t});e.drawingInfo={renderer:a.write({},i)}}}writeFields(t,e,r){const i=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Ga(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>sw.fromJSON(i))}clone(){return new sH({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Q(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Q(this.fields),maxScale:this.maxScale,renderer:Q(this.renderer),symbol:Q(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:Q(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Ln.prototype,"type",void 0),u([d({type:Number,cast:t=>t==="auto"?t:Yr(t),json:{write:!0}})],Ln.prototype,"clusterRadius",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Ln.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:Yr,json:{write:!0}})],Ln.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Ln.prototype,"maxScale",void 0),u([d(n6)],Ln.prototype,"popupEnabled",void 0),u([d({type:VS,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ln.prototype,"popupTemplate",void 0),u([d({types:s6,json:{write:{target:"drawingInfo.renderer"}}})],Ln.prototype,"renderer",void 0),u([Se("renderer",["drawingInfo.renderer"])],Ln.prototype,"readRenderer",null),u([d({types:f5e})],Ln.prototype,"symbol",void 0),u([Se("symbol",["drawingInfo.renderer"])],Ln.prototype,"readSymbol",null),u([De("symbol")],Ln.prototype,"writeSymbol",null),u([d({type:[eP],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ln.prototype,"labelingInfo",void 0),u([d(o6)],Ln.prototype,"labelsVisible",void 0),u([d({type:[sw],json:{write:!0}})],Ln.prototype,"fields",void 0),u([De("fields")],Ln.prototype,"writeFields",null),u([Se("fields")],Ln.prototype,"readFields",null),Ln=sH=u([R(E1t)],Ln);const aAe=Ln,tue={key:"type",base:bg,typeMap:{cluster:aAe,binning:oAe}},C1t={types:{key:"type",base:bg,typeMap:{selection:xj,cluster:aAe,binning:oAe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:tue},"portal-item":{types:tue},"web-scene":{types:{key:"type",base:bg,typeMap:{selection:xj}}}}}},Nx={Base64:0,Hex:1,String:2,Raw:3},R2=8,lAe=(1<<R2)-1;function K0(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function A1t(t){const e=[];for(let r=0,i=t.length*R2;r<i;r+=R2)e[r>>5]|=(t.charCodeAt(r/R2)&lAe)<<r%32;return e}function O1t(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=R2)e.push(String.fromCharCode(t[r>>5]>>>r%32&lAe));return e.join("")}function R1t(t){const e="0123456789abcdef",r=[];for(let i=0,s=4*t.length;i<s;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function P1t(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function M1t(t,e){return t<<e|t>>>32-e}function a6(t,e,r,i,s,n){return K0(M1t(K0(K0(e,t),K0(i,n)),s),r)}function ga(t,e,r,i,s,n,o){return a6(e&r|~e&i,t,e,s,n,o)}function ya(t,e,r,i,s,n,o){return a6(e&i|r&~i,t,e,s,n,o)}function _a(t,e,r,i,s,n,o){return a6(e^r^i,t,e,s,n,o)}function va(t,e,r,i,s,n,o){return a6(r^(e|~i),t,e,s,n,o)}function $1t(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=s,h=n;r=ga(r,i,s,n,t[o],7,-680876936),n=ga(n,r,i,s,t[o+1],12,-389564586),s=ga(s,n,r,i,t[o+2],17,606105819),i=ga(i,s,n,r,t[o+3],22,-1044525330),r=ga(r,i,s,n,t[o+4],7,-176418897),n=ga(n,r,i,s,t[o+5],12,1200080426),s=ga(s,n,r,i,t[o+6],17,-1473231341),i=ga(i,s,n,r,t[o+7],22,-45705983),r=ga(r,i,s,n,t[o+8],7,1770035416),n=ga(n,r,i,s,t[o+9],12,-1958414417),s=ga(s,n,r,i,t[o+10],17,-42063),i=ga(i,s,n,r,t[o+11],22,-1990404162),r=ga(r,i,s,n,t[o+12],7,1804603682),n=ga(n,r,i,s,t[o+13],12,-40341101),s=ga(s,n,r,i,t[o+14],17,-1502002290),i=ga(i,s,n,r,t[o+15],22,1236535329),r=ya(r,i,s,n,t[o+1],5,-165796510),n=ya(n,r,i,s,t[o+6],9,-1069501632),s=ya(s,n,r,i,t[o+11],14,643717713),i=ya(i,s,n,r,t[o],20,-373897302),r=ya(r,i,s,n,t[o+5],5,-701558691),n=ya(n,r,i,s,t[o+10],9,38016083),s=ya(s,n,r,i,t[o+15],14,-660478335),i=ya(i,s,n,r,t[o+4],20,-405537848),r=ya(r,i,s,n,t[o+9],5,568446438),n=ya(n,r,i,s,t[o+14],9,-1019803690),s=ya(s,n,r,i,t[o+3],14,-187363961),i=ya(i,s,n,r,t[o+8],20,1163531501),r=ya(r,i,s,n,t[o+13],5,-1444681467),n=ya(n,r,i,s,t[o+2],9,-51403784),s=ya(s,n,r,i,t[o+7],14,1735328473),i=ya(i,s,n,r,t[o+12],20,-1926607734),r=_a(r,i,s,n,t[o+5],4,-378558),n=_a(n,r,i,s,t[o+8],11,-2022574463),s=_a(s,n,r,i,t[o+11],16,1839030562),i=_a(i,s,n,r,t[o+14],23,-35309556),r=_a(r,i,s,n,t[o+1],4,-1530992060),n=_a(n,r,i,s,t[o+4],11,1272893353),s=_a(s,n,r,i,t[o+7],16,-155497632),i=_a(i,s,n,r,t[o+10],23,-1094730640),r=_a(r,i,s,n,t[o+13],4,681279174),n=_a(n,r,i,s,t[o],11,-358537222),s=_a(s,n,r,i,t[o+3],16,-722521979),i=_a(i,s,n,r,t[o+6],23,76029189),r=_a(r,i,s,n,t[o+9],4,-640364487),n=_a(n,r,i,s,t[o+12],11,-421815835),s=_a(s,n,r,i,t[o+15],16,530742520),i=_a(i,s,n,r,t[o+2],23,-995338651),r=va(r,i,s,n,t[o],6,-198630844),n=va(n,r,i,s,t[o+7],10,1126891415),s=va(s,n,r,i,t[o+14],15,-1416354905),i=va(i,s,n,r,t[o+5],21,-57434055),r=va(r,i,s,n,t[o+12],6,1700485571),n=va(n,r,i,s,t[o+3],10,-1894986606),s=va(s,n,r,i,t[o+10],15,-1051523),i=va(i,s,n,r,t[o+1],21,-2054922799),r=va(r,i,s,n,t[o+8],6,1873313359),n=va(n,r,i,s,t[o+15],10,-30611744),s=va(s,n,r,i,t[o+6],15,-1560198380),i=va(i,s,n,r,t[o+13],21,1309151649),r=va(r,i,s,n,t[o+4],6,-145523070),n=va(n,r,i,s,t[o+11],10,-1120210379),s=va(s,n,r,i,t[o+2],15,718787259),i=va(i,s,n,r,t[o+9],21,-343485551),r=K0(r,a),i=K0(i,l),s=K0(s,c),n=K0(n,h)}return[r,i,s,n]}function cAe(t,e=Nx.Hex){const r=e||Nx.Base64,i=$1t(A1t(t),t.length*R2);switch(r){case Nx.Raw:return i;case Nx.Hex:return R1t(i);case Nx.String:return O1t(i);case Nx.Base64:return P1t(i)}}var nH;let j3=nH=class extends r6{writeLevels(t,e,r){for(const i in t){const s=this.levels[i];return void(e.stops=s)}}clone(){return new nH({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:J0(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:J0(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:Q(this.levels)})}};u([d()],j3.prototype,"levels",void 0),u([De("levels")],j3.prototype,"writeLevels",null),j3=nH=u([R("esri.views.2d.engine.LevelDependentSizeVariable")],j3);const I1t=J.getLogger("esri.views.2d.layers.support.clusterUtils");oe.add("esri-cluster-arcade-enabled",!0);const L1t=oe("esri-cluster-arcade-enabled"),D1t=(t,e,r,i,s)=>{const n=e.clone();if(!V1t(n))return n;if(n.authoringInfo||(n.authoringInfo=new kY),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=N1t(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=Pv(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=mC(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=Pv(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=Pv(t,l.field,"avg","number"):l.valueExpression&&(l.field=mC(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),a==null&&!F1t(o)&&s&&(o.push(U1t(r,i)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=Pv(t,o.field,"sum","number"):o.valueExpression&&(o.field=mC(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=Pv(t,n.field,"mode","string"):n.valueExpression&&(n.field=mC(t,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=Pv(t,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=Pv(t,n.field,"avg","number"):n.valueExpression&&(n.field=mC(t,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},N1t=t=>{for(const e of t)if(e.type==="size")return e;return null},F1t=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},U1t=(t,e)=>{const r=[new wT({value:0,size:0}),new wT({value:1})];if(e==null)return new r6({field:"cluster_count",stops:[...r,new wT({value:2,size:0})]});const i=Object.keys(e).reduce((s,n)=>({...s,[n]:[...r,new wT({value:Math.max(2,e[n].minValue),size:t.clusterMinSize}),new wT({value:Math.max(3,e[n].maxValue),size:t.clusterMaxSize})]}),{});return new j3({field:"cluster_count",levels:i})},V1t=t=>{const e=r=>I1t.error(new U("Unsupported-renderer",r,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!L1t){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function z1t(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,s="field",n=e.toLowerCase()+",norm:"+s+","+i.toLowerCase();return"cluster_avg_"+cAe(n)}}}function mC(t,e,r,i){const s=cAe(e),n=r==="mode"?`cluster_type_${s}`:r==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new sw({name:n,isAutoGenerated:!0,onStatisticExpression:new QY({expression:e,returnType:i}),statisticType:r})),n}function Pv(t,e,r,i,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=z1t(r,e,s);return t.some(o=>o.name===n)||(r==="avg_norm"?t.push(new sw({name:n,isAutoGenerated:!0,onStatisticExpression:new QY({expression:`$feature.${e} / $feature.${s}`,returnType:i}),statisticType:"avg"})):t.push(new sw({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),n}const k1t=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){var a;if((r==null?void 0:r.type)!=="cluster")return r;const i=r.clone(),s=[new sw({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(i.fields??[]).filter(l=>!l.isAutoGenerated);if(r.renderer&&!((a=r.renderer.authoringInfo)!=null&&a.isAutoGenerated))return i.fields=[...s,...n],i;if(r.symbol)return i.fields=[...s,...n],i.renderer=null,i;if(!this.renderer)return r;const o=D1t(s,this.renderer,r,null,!1);return i.fields=[...s,...n],i.renderer=o,i}};return u([d(C1t)],e.prototype,"featureReduction",null),e=u([R("esri.layers.mixins.FeatureReductionLayer")],e),e};var oH;const Q9=new Or({asc:"ascending",desc:"descending"});let $T=oH=class extends de{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new oH({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],$T.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],$T.prototype,"valueExpression",void 0),u([d({type:Q9.apiValues,json:{read:Q9.read,write:Q9.write}})],$T.prototype,"order",void 0),$T=oH=u([R("esri.layers.support.OrderByInfo")],$T);const uAe=$T;function B1t(t,e,r){if(!t)return null;const i=t.find(n=>!!n.field);if(!i)return null;const s=new uAe;return s.read(i,r),[s]}function G1t(t,e,r,i){const s=t.find(n=>!!n.field);s&&Ga(r,[s.toJSON()],e)}const j1t=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[uAe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:B1t},write:{target:"layerDefinition.orderBy",writer:G1t}}})],e.prototype,"orderBy",void 0),e=u([R("esri.layers.mixins.OrderedLayer")],e),e};let H3=class extends xe{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],H3.prototype,"updating",void 0),u([d()],H3.prototype,"status",void 0),H3=u([R("esri.layers.support.PublishingInfo")],H3);const H1t=H3,hAe="esri.layers.mixins.PublishableLayer",q1t=Symbol(hAe),W1t=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const s=new H1t;return this._checkPublishingStatus(s),s}_checkPublishingStatus(i){let o=0;const a=async c=>{let h;i.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=h,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=q1t,u([d({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=u([R(hAe)],r),r},dAe=Ha()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let q3=class extends Gi(de){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return s9e(this.value,this.unit,"milliseconds")}};u([et(dAe,{nonNullable:!0})],q3.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],q3.prototype,"value",void 0),q3=u([R("esri.TimeInterval")],q3);const R4=q3;function rue(t,e){return R4.fromJSON({value:t,unit:e})}let Aa=class extends Gi(de){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),s=new Date(r.timeExtent[1]);return new Zf({start:i,end:s})}writeFullTimeExtent(e,r){e&&e.start!=null&&e.end!=null?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?rue(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?rue(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=(e==null?void 0:e.toJSON().value)??null,r.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Aa.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"endField",void 0),u([d({type:Zf,json:{write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"fullTimeExtent",void 0),u([Se("fullTimeExtent",["timeExtent"])],Aa.prototype,"readFullTimeExtent",null),u([De("fullTimeExtent")],Aa.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Aa.prototype,"hasLiveData",void 0),u([d({type:R4,json:{write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"interval",void 0),u([Se("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Aa.prototype,"readInterval",null),u([De("interval")],Aa.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"startField",void 0),u([d({type:K2,json:{write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Aa.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Aa.prototype,"useTime",void 0),Aa=u([R("esri.layers.support.TimeInfo")],Aa);const pAe=Aa,X1t=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=dAe.fromJSON(s.timeOffsetUnits);return n&&o?new R4({value:n,unit:o}):null}set timeInfo(r){bpe(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([d({type:Zf,json:{write:!1}})],e.prototype,"timeExtent",void 0),u([d({type:R4})],e.prototype,"timeOffset",void 0),u([Se("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),u([d({value:null,type:pAe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=u([R("esri.layers.mixins.TemporalLayer")],e),e},iue=new Or({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let p0=class extends Gi(de){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],p0.prototype,"name",void 0),u([d({json:{write:!0}})],p0.prototype,"description",void 0),u([d({json:{read:iue.read,write:iue.write}})],p0.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],p0.prototype,"prototype",void 0),u([d({json:{write:!0}})],p0.prototype,"thumbnail",void 0),p0=u([R("esri.layers.support.FeatureTemplate")],p0);const KY=p0;let jm=class extends Gi(de){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=rZ(e[i]);return r}writeDomains(e,r){var s;const i={};for(const n of Object.keys(e))e[n]&&(i[n]=(s=e[n])==null?void 0:s.toJSON());r.domains=i}};u([d({json:{write:!0}})],jm.prototype,"id",void 0),u([d({json:{write:!0}})],jm.prototype,"name",void 0),u([d({json:{write:!0}})],jm.prototype,"domains",void 0),u([Se("domains")],jm.prototype,"readDomains",null),u([De("domains")],jm.prototype,"writeDomains",null),u([d({type:[KY],json:{write:!0}})],jm.prototype,"templates",void 0),jm=u([R("esri.layers.support.FeatureType")],jm);const fAe=jm;function mAe(){return{fields:{type:[wF],value:null},fieldsIndex:{readOnly:!0,get(){return new BY(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const r of t)((e=this.fieldsIndex)==null?void 0:e.has(r))||J.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:t});return i5(this.fieldsIndex,t)}}}}const K9=J.getLogger("esri.layers.support.labelingInfo"),Z1t=/\[([^\[\]]+)\]/gi;function P4(t,e,r){return t?t.map(i=>{const s=new eP;if(s.read(i,r),s.labelExpression){const n=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replaceAll(Z1t,(o,a)=>`[${Y1t(a,n)}]`)}return s}):null}function Y1t(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const s=e[i].name;if(s.toLowerCase()===r)return s}return t}const J1t={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function LFt(t,e){const r=Q(t);return r.some(i=>Q1t(i,e))?[]:r}function Q1t(t,e){const r=t.labelPlacement,i=J1t[e];if(!t.symbol)return K9.warn("No ILabelClass symbol specified."),!0;if(!i)return K9.error(new U("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const s=i[0];r&&K9.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${s}`),t.labelPlacement=s}return!1}const _d=[];function K1t(t,e){if(LW(t.url??""))return!0;const{wkid:r}=e;for(const i of _d){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}_d.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),_d.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),_d.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),_d.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),_d.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),_d.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),_d.push([10.61,()=>new Set([102497])]),_d.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),_d.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),_d.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function gAe(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await lu(i.populateFromStyle());if(Jt(r),s.ok===!1){const n=s.error;e&&e.messages&&e.messages.push(new fh("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}var aH;let IT=aH=class extends de{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new aH({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],IT.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],IT.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],IT.prototype,"orderByFields",void 0),IT=aH=u([R("esri.rest.support.TopFilter")],IT);const ebt=IT;var lH;const sue=new Or({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),nue=new Or({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let us=lH=class extends de{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new lH(Q({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],us.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],us.prototype,"distance",void 0),u([d({types:aw,json:{read:c_,write:!0}})],us.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],us.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],us.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],us.prototype,"num",void 0),u([d({json:{write:!0}})],us.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],us.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],us.prototype,"outFields",void 0),u([d({type:Ge,json:{read:{source:"outSR"},write:{target:"outSR"}}})],us.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],us.prototype,"resultType",void 0),u([d({json:{write:!0}})],us.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],us.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],us.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],us.prototype,"start",void 0),u([De("start"),De("num")],us.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:sue.read},write:{target:"spatialRel",writer:sue.write}}})],us.prototype,"spatialRelationship",void 0),u([d({type:Zf,json:{write:!0}})],us.prototype,"timeExtent",void 0),u([d({type:ebt,json:{write:!0}})],us.prototype,"topFilter",void 0),u([d({type:String,json:{read:nue.read,write:{writer:nue.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],us.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],us.prototype,"where",void 0),us=lH=u([R("esri.rest.support.TopFeaturesQuery")],us),us.from=Hs(us);const iI=us;function yAe({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=sbt({editFieldsInfo:e,fields:r,objectIdField:i},n);if(!o.length)return null;const a=abt({titleBase:s,fields:r,displayField:t}),l=obt();return new VS({title:a,content:l,fieldInfos:o})}const tbt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):MLe(t,e);function rbt(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(ibt),t}function ibt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:oue(t)?-1:oue(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function sbt(t,e){const r=e==null?void 0:e.visibleFieldNames;return rbt(t.fields??[],(e==null?void 0:e.ignoreFieldTypes)||lbt).map(i=>new Bq({fieldName:i.name,isEditable:PLe(i,t),label:i.alias,format:nbt(i),visible:tbt(i,{...t,visibleFieldNames:r})}))}function nbt(t){switch(t.type){case"small-integer":case"integer":case"single":return new AC({digitSeparator:!0,places:0});case"double":return new AC({digitSeparator:!0,places:2});case"date":return new AC({dateFormat:"long-month-day-year"});default:return t.type==="string"&&ZLe(t.name)?new AC({digitSeparator:!0,places:0}):null}}function obt(){return[new cO,new lO]}function abt(t){const e=vLe(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function oue(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const lbt=["geometry","blob","raster","guid","xml"],il="FeatureLayer",_Ae="esri.layers.FeatureLayer",cbt=J.getLogger(_Ae);function sI(t,e){return new U("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function aue(t){return t&&t instanceof Mt}const eV=mAe();function tV(t,e,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let ht=class extends p1t(k1t($vt(W1t(A3e(wvt(j1t(X1t(U3e(Tlt(T3e(D3e(F3e(qY(xvt(x3e(Gi(Aq))))))))))))))))){constructor(...e){super(...e),this._handles=new Pi,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Ge.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Pe(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){var s;const r=e!=null?e.signal:null;if((s=this.portalItem)!=null&&s.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(n=>this.initLayerProperties(n))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Po).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const n=await this._fetchFirstLayerId(r);n!=null&&(this.layerId=n)}if(!this.url&&!this._hasMemorySource())throw new U("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>Jvt(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,tAe(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,s){this._writeEditingEnabled(e,r,!0,s)}get effectiveEditingEnabled(){return Kvt(this)}readIsTable(e,r){return(r=(r==null?void 0:r.layerDefinition)??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,s){s!=null&&s.writeLayerSchema&&Ga(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return J3e(r.layerDefinition||r)}readObjectIdField(e,r){return Q3e(r.layerDefinition||r)}get parsedUrl(){const e=go(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=gc(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=gc(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){ND(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){var n;r=r.layerDefinition||r;const s=(n=r.drawingInfo)==null?void 0:n.renderer;if(s){const o=QO(s,r,i)??void 0;return o||cbt.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),o}return JY(r,i)}set source(e){const r=this._get("source");r!==e&&(aue(r)&&this._resetMemorySource(r),aue(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof Mt?new Xm({layer:this,items:e}):e:null}readSource(e,r){const i=Z3e.fromJSON(r.featureSet);return new Xm({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(e,r){const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e=e&&e.map(o=>KY.fromJSON(o)),this._fixTemplates(e,s),this._fixTemplates(e,n),e}readTitle(e,r){var n;const i=((n=r.layerDefinition)==null?void 0:n.name)??r.name,s=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?t0e(this.url,i):i;let a=i;if(!a&&this.url){const l=vw(this.url);l!=null&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),V5(a)):void 0}if(this.sublayerTitleMode==="item-title"&&s)return s}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const s=r.fields.find(n=>n.name.toLowerCase()===i);s&&(i=s.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,s=i&&i.creatorField,n=i&&i.editorField;return e&&e.map(o=>(o=fAe.fromJSON(o),this._fixTemplates(o.templates,s),this._fixTemplates(o.templates,n),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return Dvt(this,e,r,il)}async updateAttachment(e,r,i){return Nvt(this,e,r,i,il)}async applyEdits(e,r){return Fvt(this,e,r)}async uploadAssets(e,r){return Uvt(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return yAe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await Jue(ae(()=>import("./FeatureLayerSource-14231684.js"),["assets/FeatureLayerSource-14231684.js","assets/MeshGeoreferencedRelativeVertexSpace-2d15e21d.js","assets/External-d2b9d83b.js","assets/editingSupport-0218b620.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js","assets/clientSideDefaults-833bca59.js","assets/QueryEngineCapabilities-42e44ded.js","assets/QueryTask-735a4f84.js","assets/executeForIds-6445651a.js","assets/query-dffe729f.js","assets/pbfQueryUtils-2c4c2b56.js","assets/pbf-5cbd0354.js","assets/executeQueryJSON-d18da025.js","assets/executeQueryPBF-dca81c4a.js"]),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=Xvt(this);e.dynamicDataSource=this.dynamicDataSource;const r=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=nvt(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return Vvt(this,e,r,il)}async fetchRecomputedExtents(e){return zvt(this,e,il)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const s=e.attributes?e.attributes[r]:void 0;if(s==null)return null;let n=null;return i==null||i.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===s.toString()&&(n=o),!!n)}),n}getFieldDomain(e,r){const i=r==null?void 0:r.feature,s=this.getFeatureType(i);if(s){const n=s.domains&&s.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return kvt(this,e,r,il)}async queryFeatures(e,r){const i=await this.load(),s=await i.source.queryFeatures(k_.from(e)??i.createQuery(),r);if(s!=null&&s.features)for(const n of s.features)n.layer=n.sourceLayer=i;return s}async queryObjectIds(e,r){return Bvt(this,e,r,il)}async queryFeatureCount(e,r){return Gvt(this,e,r,il)}async queryExtent(e,r){return jvt(this,e,r,il)}async queryRelatedFeatures(e,r){return Hvt(this,e,r,il)}async queryRelatedFeaturesCount(e,r){return qvt(this,e,r,il)}async queryTopFeatures(e,r){var o;const{source:i,capabilities:s}=await this.load();if(!i.queryTopFeatures||!((o=s==null?void 0:s.query)!=null&&o.supportsTopFeaturesQuery))throw new U(il,"Layer source does not support queryTopFeatures capability");const n=await i.queryTopFeatures(iI.from(e),r);if(n!=null&&n.features)for(const a of n.features)a.layer=a.sourceLayer=this;return n}async queryTopObjectIds(e,r){const{source:i,capabilities:s}=await this.load();if(!i.queryTopObjectIds||!(s!=null&&s.query.supportsTopFeaturesQuery))throw new U(il,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(iI.from(e),r)}async queryTopFeaturesExtent(e,r){var n;const{source:i,capabilities:s}=await this.load();if(!i.queryTopExtents||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new U(il,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(iI.from(e),r)}async queryTopFeatureCount(e,r){var n;const{source:i,capabilities:s}=await this.load();if(!i.queryTopCount||!((n=s==null?void 0:s.query)!=null&&n.supportsTopFeaturesQuery))throw new U(il,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(iI.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const s=i.layers;s&&s.length===1&&(super.read(s[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:(r==null?void 0:r.origin)??void 0,writeLayerSchema:(r==null?void 0:r.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:s,messages:n}=r;if(this.dynamicDataSource)return n==null||n.push(sI(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&s!=="tables")return n==null||n.push(sI(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n==null||n.push(sI(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&s==="tables")return n==null||n.push(sI(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new U(il,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var r;return!!this.loaded&&(((r=this.source)==null?void 0:r.type)==="memory"||K1t(this,e))}async save(e){const{save:r}=await ae(()=>import("./featureLayerUtils-7b0b07f1.js"),["assets/featureLayerUtils-7b0b07f1.js","assets/fetchService-ba68ee1b.js","assets/jsonContext-dbedaf34.js"]);return r(this,e)}async saveAs(e,r){const{saveAs:i}=await ae(()=>import("./featureLayerUtils-7b0b07f1.js"),["assets/featureLayerUtils-7b0b07f1.js","assets/fetchService-ba68ee1b.js","assets/jsonContext-dbedaf34.js"]);return i(this,e,r)}_readEditingEnabled(e,r,i){var n;let s=(n=e.layerDefinition)==null?void 0:n.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,r&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,s){var n,o;if(!e){const a=(o=(n=this.capabilities)==null?void 0:n.operations)!=null&&o.supportsSync?"Query,Sync":"Query";Ga("layerDefinition.capabilities",a,r),i&&!(s!=null&&s.writeLayerSchema)&&(r.capabilities=a)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return Nr(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){var r;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),ND(this.renderer,this.fieldsIndex),bpe(this.timeInfo,this.fieldsIndex),gAe(this,{origin:"service"})}async hasDataChanged(){return Wvt(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var r,i;const e=((r=this.parsedUrl)==null?void 0:r.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(s=>s.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const s=i.prototype&&i.prototype.attributes;s&&r&&delete s[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new U("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new U("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Se("service","capabilities")],ht.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ht.prototype,"charts",void 0),u([d({readOnly:!0})],ht.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],ht.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],ht.prototype,"displayField",void 0),u([d({types:ub,readOnly:!0})],ht.prototype,"defaultSymbol",void 0),u([d({type:Ad})],ht.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],ht.prototype,"editingEnabled",null),u([Se(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],ht.prototype,"readEditingEnabled",null),u([Se("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],ht.prototype,"readEditingEnabledFromWebMap",null),u([De(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],ht.prototype,"writeEditingEnabled",null),u([De("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],ht.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],ht.prototype,"effectiveEditingEnabled",null),u([d({...eV.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:tV}}}}})],ht.prototype,"fields",void 0),u([d(eV.fieldsIndex)],ht.prototype,"fieldsIndex",void 0),u([d({type:yvt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],ht.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],ht.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:tV,writer(t,e,r){const i=t?Qj.toJSON(t):null;i&&Ga(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:Qj.read}}})],ht.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],ht.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],ht.prototype,"hasZ",void 0),u([d(I3e)],ht.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],ht.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],ht.prototype,"isTable",void 0),u([Se("service","isTable",["type","geometryType"]),Se("isTable",["layerDefinition.type","layerDefinition.geometryType"])],ht.prototype,"readIsTable",null),u([De("web-map","isTable")],ht.prototype,"writeIsTable",null),u([d(o6)],ht.prototype,"labelsVisible",void 0),u([d({type:[eP],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:P4},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:P4},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],ht.prototype,"labelingInfo",void 0),u([d((()=>{const t=Q(z_t);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){Ga(i,Q4(e),r)}}},t})())],ht.prototype,"opacity",void 0),u([d(P3e)],ht.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const t=Q(L3e.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],ht.prototype,"listMode",void 0),u([Se("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],ht.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:tV}}}}})],ht.prototype,"objectIdField",void 0),u([Se("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],ht.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],ht.prototype,"operationalLayerType",void 0),u([d(eV.outFields)],ht.prototype,"outFields",void 0),u([d({readOnly:!0})],ht.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],ht.prototype,"path",void 0),u([d(n6)],ht.prototype,"popupEnabled",void 0),u([d({type:VS,json:{name:"popupInfo",write:!0}})],ht.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],ht.prototype,"defaultPopupTemplate",null),u([d({types:s6,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:v3e,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],ht.prototype,"renderer",null),u([Se("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Se("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],ht.prototype,"readRenderer",null),u([d((()=>{const t=Q(O3e);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],ht.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],ht.prototype,"source",null),u([gr("source")],ht.prototype,"castSource",null),u([Se("portal-item","source",["featureSet"]),Se("web-map","source",["featureSet"])],ht.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],ht.prototype,"spatialReference",void 0),u([d({type:Number})],ht.prototype,"subtypeCode",void 0),u([d({type:[KY]})],ht.prototype,"templates",void 0),u([Se("templates",["editFieldsInfo","creatorField","editorField","templates"])],ht.prototype,"readTemplates",null),u([d({type:pAe})],ht.prototype,"timeInfo",void 0),u([d()],ht.prototype,"title",void 0),u([Se("service","title",["name"]),Se("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],ht.prototype,"readTitle",null),u([Se("web-map","title",["layerDefinition.name","title"])],ht.prototype,"readTitleFromWebMap",null),u([d({type:String})],ht.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],ht.prototype,"type",void 0),u([d({type:String})],ht.prototype,"typeIdField",void 0),u([Se("service","typeIdField"),Se("typeIdField",["layerDefinition.typeIdField"])],ht.prototype,"readTypeIdField",null),u([d({type:[fAe]})],ht.prototype,"types",void 0),u([Se("service","types",["types"]),Se("types",["layerDefinition.types"])],ht.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],ht.prototype,"visible",void 0),u([Se("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],ht.prototype,"readVisible",null),ht=u([R(_Ae)],ht);const cH=ht,NFt=Object.freeze(Object.defineProperty({__proto__:null,default:cH},Symbol.toStringTag,{value:"Module"}));let ubt=class{constructor(e,r,i,s){var o;this._parsedUrl=e,this._portalItem=r,this._apiKey=i,this.signal=s,this._rootDocument=null;const n=(o=this._parsedUrl)==null?void 0:o.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this._urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();if(e==null)return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(e);return r==null?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();return e==null?null:this._findAndLoadRelatedPortalItem(e)}async _fetchRootDocument(){if(this._rootDocument!=null)return this._rootDocument;if(this._urlParts==null)return this._rootDocument={},{};const e={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},r=`${this._urlParts.root}/SceneServer`;try{const i=await Nr(r,e);this._rootDocument=i.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){var s;const e=(s=this._parsedUrl)==null?void 0:s.path,r=e?wr==null?void 0:wr.findServerInfo(e):null;if(r!=null&&r.owningSystemUrl)return r.owningSystemUrl;const i=e?e.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const n=(await Nr(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(n)return n}catch(n){Po(n)}return null}async _findAndLoadRelatedPortalItem(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return Po(r),null}}async _loadFeatureLayerFromPortalItem(e){await e.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(e.url??"");return new cH({url:r,portalItem:e}).load({signal:this.signal})}async _loadFromUrl(){var r;const e=await this._findMatchingAssociatedSublayerUrl(`${(r=this._urlParts)==null?void 0:r.root}/FeatureServer`);return new cH({url:e}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(e){var p;const r=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i=(p=this._urlParts)==null?void 0:p.layerId,s=this._fetchRootDocument(),n=f=>{const m={query:{f:"json"},responseType:"json",authMode:f,signal:this.signal};return Nr(r,m)},o=n("anonymous").catch(()=>n("no-prompt")),[a,l]=await Promise.all([o,s]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let f=0;f<Math.min(c.length,h.length);f++)if(c[f].id===i)return`${r}/${h[f].id}`}else if(i!=null&&i<h.length)return`${r}/${h[i].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const e=(await this._fetchRootDocument()).serviceItemId;if(!e)return null;const r=new ob({id:e,apiKey:this._apiKey}),i=await this._fetchServiceOwningPortalUrl();i!=null&&(r.portal=new jn({url:i}));try{return r.load({signal:this.signal})}catch(s){return Po(s),null}}},W1=class extends de{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([d({type:Number})],W1.prototype,"nodesPerPage",void 0),u([d({type:Number})],W1.prototype,"rootIndex",void 0),u([d({type:String})],W1.prototype,"lodSelectionMetricType",void 0),W1=u([R("esri.layer.support.I3SNodePageDefinition")],W1);let ag=class extends de{constructor(){super(...arguments),this.factor=1}};u([d({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],ag.prototype,"id",void 0),u([d({type:Number})],ag.prototype,"factor",void 0),ag=u([R("esri.layer.support.I3SMaterialTexture")],ag);let f0=class extends de{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([d({type:[Number]})],f0.prototype,"baseColorFactor",void 0),u([d({type:ag})],f0.prototype,"baseColorTexture",void 0),u([d({type:ag})],f0.prototype,"metallicRoughnessTexture",void 0),u([d({type:Number})],f0.prototype,"metallicFactor",void 0),u([d({type:Number})],f0.prototype,"roughnessFactor",void 0),f0=u([R("esri.layer.support.I3SMaterialPBRMetallicRoughness")],f0);let zu=class extends de{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([et({opaque:"opaque",mask:"mask",blend:"blend"})],zu.prototype,"alphaMode",void 0),u([d({type:Number})],zu.prototype,"alphaCutoff",void 0),u([d({type:Boolean})],zu.prototype,"doubleSided",void 0),u([et({none:"none",back:"back",front:"front"})],zu.prototype,"cullFace",void 0),u([d({type:ag})],zu.prototype,"normalTexture",void 0),u([d({type:ag})],zu.prototype,"occlusionTexture",void 0),u([d({type:ag})],zu.prototype,"emissiveTexture",void 0),u([d({type:[Number]})],zu.prototype,"emissiveFactor",void 0),u([d({type:f0})],zu.prototype,"pbrMetallicRoughness",void 0),zu=u([R("esri.layer.support.I3SMaterialDefinition")],zu);let W3=class extends de{};u([d({type:String,json:{read:{source:["name","index"],reader:(t,e)=>t??`${e.index}`}}})],W3.prototype,"name",void 0),u([et({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],W3.prototype,"format",void 0),W3=u([R("esri.layer.support.I3STextureFormat")],W3);let X3=class extends de{constructor(){super(...arguments),this.atlas=!1}};u([d({type:[W3]})],X3.prototype,"formats",void 0),u([d({type:Boolean})],X3.prototype,"atlas",void 0),X3=u([R("esri.layer.support.I3STextureSetDefinition")],X3);let Od=class extends de{};u([et({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Od.prototype,"type",void 0),u([d({type:Number})],Od.prototype,"component",void 0),Od=u([R("esri.layer.support.I3SGeometryAttribute")],Od);let Z3=class extends de{};u([et({draco:"draco"})],Z3.prototype,"encoding",void 0),u([d({type:[String]})],Z3.prototype,"attributes",void 0),Z3=u([R("esri.layer.support.I3SGeometryCompressedAttributes")],Z3);let Yh=class extends de{constructor(){super(...arguments),this.offset=0}};u([d({type:Number})],Yh.prototype,"offset",void 0),u([d({type:Od})],Yh.prototype,"position",void 0),u([d({type:Od})],Yh.prototype,"normal",void 0),u([d({type:Od})],Yh.prototype,"uv0",void 0),u([d({type:Od})],Yh.prototype,"color",void 0),u([d({type:Od})],Yh.prototype,"uvRegion",void 0),u([d({type:Od})],Yh.prototype,"featureId",void 0),u([d({type:Od})],Yh.prototype,"faceRange",void 0),u([d({type:Z3})],Yh.prototype,"compressedAttributes",void 0),Yh=u([R("esri.layer.support.I3SGeometryBuffer")],Yh);let Y3=class extends de{};u([et({triangle:"triangle"})],Y3.prototype,"topology",void 0),u([d()],Y3.prototype,"geometryBuffers",void 0),Y3=u([R("esri.layer.support.I3SGeometryDefinition")],Y3);let m0=class extends de{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([d({type:String,json:{read:!0,write:!0}})],m0.prototype,"name",void 0),u([d({type:String,json:{read:!0,write:!0}})],m0.prototype,"field",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],m0.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],m0.prototype,"fullRangeExtent",void 0),u([d({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],m0.prototype,"type",void 0),m0=u([R("esri.layers.support.RangeInfo")],m0);function uH(t){return eJ[hbt(t)]||pbt}function hbt(t){return t instanceof Blob?t.type:dbt(t.url)}function dbt(t){const e=qH(t);return hH[e]||vAe}const eJ={},vAe="text/plain",pbt=eJ[vAe],hH={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in hH)eJ[hH[t]]=t;function fbt(t){const e=(t==null?void 0:t.origins)??[void 0];return(r,i)=>{const s=mbt(t,r,i);for(const n of e){const o=RH(r,n,i);for(const a in s)o[a]=s[a]}}}function mbt(t,e,r){if((t==null?void 0:t.type)==="resource")return gbt(t,e,r);switch((t==null?void 0:t.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:s}=t5e;return{read:i,write:s}}}}function gbt(t,e,r){const i=tR(e,r);return{type:String,read:(s,n,o)=>{const a=d5(s,n,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=Og(s,a)):void(n[o]=s.write({},a));const l=bbt(s),c=Og(l,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},G2.NO),h=i.type!==String&&(!V3e(this)||a&&a.origin&&this.originIdOf(r)>rg(a.origin)),p={object:this,propertyName:r,value:s,targetUrl:c,dest:n,targetPropertyName:o,context:a,params:t};a&&a.portalItem&&c&&!dc(c)?h?ybt(p):_bt(p):a&&a.portalItem&&(c==null||rme(c)!=null||a_(c)||h)?bAe(p):n[o]=c}}}}function bAe(t){const{targetUrl:e,params:r,value:i,context:s,dest:n,targetPropertyName:o}=t;if(!s.portalItem)return;const a=ime(e),l=(a==null?void 0:a.filename)??QF(),c=(r==null?void 0:r.prefix)??(a==null?void 0:a.prefix),h=xAe(i,e,s),p=gc(c,l),f=`${p}.${uH(h)}`,m=s.portalItem.resourceFromPath(f);a_(e)&&s.resources&&s.resources.pendingOperations.push(vbt(e).then(_=>{m.path=`${p}.${uH(_)}`,n[o]=m.itemRelativeUrl}).catch(()=>{}));const y=(r==null?void 0:r.compress)??!1;s.resources&&wAe({...t,resource:m,content:h,compress:y,updates:s.resources.toAdd}),n[o]=m.itemRelativeUrl}function ybt(t){const{context:e,targetUrl:r,params:i,value:s,dest:n,targetPropertyName:o}=t;if(!e.portalItem)return;const a=e.portalItem.resourceFromPath(r),l=xAe(s,r,e),c=uH(l),h=qH(a.path),p=(i==null?void 0:i.compress)??!1;c===h?(e.resources&&wAe({...t,resource:a,content:l,compress:p,updates:e.resources.toUpdate}),n[o]=r):bAe(t)}function _bt({context:t,targetUrl:e,dest:r,targetPropertyName:i}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),r[i]=e)}function wAe({object:t,propertyName:e,updates:r,resource:i,content:s,compress:n}){r.push({resource:i,content:s,compress:n,finish:o=>{wbt(t,e,o)}})}function xAe(t,e,r){return typeof t=="string"?{url:e}:new Blob([JSON.stringify(t.toJSON(r))],{type:"application/json"})}async function vbt(t){const e=(await ae(()=>Promise.resolve().then(()=>hde),void 0)).default,{data:r}=await e(t,{responseType:"blob"});return r}function bbt(t){return t==null?null:typeof t=="string"?t:t.url}function wbt(t,e,r){typeof t[e]=="string"?t[e]=r.url:t[e].url=r.url}var eD;let dH=eD=class extends MS(Mt.ofType(Hd)){constructor(t){super(t)}clone(){return new eD(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){var r;const e=(r=t==null?void 0:t.layer)==null?void 0:r.spatialReference;return e?this.toArray().map(i=>{if(!e.equals(i.spatialReference)){if(!If(i.spatialReference,e))return t&&t.messages&&t.messages.push(new fh("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const n=new Hd;nge(i,n,e),i=n}const s=i.toJSON(t);return delete s.spatialReference,s}).filter(i=>i!=null):(t!=null&&t.messages&&t.messages.push(new fh("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(i=>i.toJSON(t)))}static fromJSON(t,e){const r=new eD;return t.forEach(i=>r.add(Hd.fromJSON(i,e))),r}};dH=eD=u([R("esri.layers.support.PolygonCollection")],dH);const tD=dH;var pH;let LT=pH=class extends de{constructor(t){super(t),this.spatialRelationship="disjoint",this.geometries=new tD,this._geometriesSource=null,this._handles=new Pi}initialize(){this._handles.add(ka(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,Gr))}destroy(){this._handles.destroy()}readGeometries(t,e,r){Array.isArray(t)?this.geometries=tD.fromJSON(t,r):this._geometriesSource={url:Ag(t,r),context:r}}async loadGeometries(t,e){if(this._geometriesSource==null)return;const{url:r,context:i}=this._geometriesSource,s=await Nr(r,{responseType:"json",signal:e==null?void 0:e.signal}),n=t.toJSON(),o=s.data.map(a=>({...a,spatialReference:n}));this.geometries=tD.fromJSON(o,i),this._geometriesSource=null}clone(){const t=new pH({geometries:Q(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};u([d({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],LT.prototype,"spatialRelationship",void 0),u([d({type:tD,nonNullable:!0,json:{write:!0}}),fbt({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],LT.prototype,"geometries",void 0),u([Se(["web-scene","portal-item"],"geometries")],LT.prototype,"readGeometries",null),LT=pH=u([R("esri.layers.support.SceneFilter")],LT);const xbt=LT,Ts=!0,rb={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function tJ(t,e,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,r+rb.identifierOffset,rb.identifierLength)),version:e.getUint16(r+rb.versionOffset,Ts),checksum:e.getUint32(r+rb.checksumOffset,Ts)}}const Gl={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function Tbt(t,e){return{sizeLo:t.getUint32(e+Gl.sizeLo,Ts),sizeHi:t.getUint32(e+Gl.sizeHi,Ts),minX:t.getFloat64(e+Gl.minX,Ts),minY:t.getFloat64(e+Gl.minY,Ts),minZ:t.getFloat64(e+Gl.minZ,Ts),maxX:t.getFloat64(e+Gl.maxX,Ts),maxY:t.getFloat64(e+Gl.maxY,Ts),maxZ:t.getFloat64(e+Gl.maxZ,Ts),errorX:t.getFloat64(e+Gl.errorX,Ts),errorY:t.getFloat64(e+Gl.errorY,Ts),errorZ:t.getFloat64(e+Gl.errorZ,Ts),count:t.getUint32(e+Gl.count,Ts),reserved:t.getUint32(e+Gl.reserved,Ts)}}function ZFt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=tJ(t,e,r);if(r+=rb.byteCount,i!=="LEPCC     ")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=Tbt(e,r);if(r+=Gl.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(r=nI(t,r,a),r=nI(t,r,l),r=nI(t,r,c),r=nI(t,r,h),r!==t.byteLength)throw new U("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let y=0;for(let _=0;_<l[m];_++){y+=c[p];const v=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*y),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*v),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function nI(t,e,r){const i=[];e=fH(t,e,i);const s=[];for(let n=0;n<i.length;n++){s.length=0,e=fH(t,e,s);for(let o=0;o<s.length;o++)r.push(s[o]+i[n])}return e}function fH(t,e,r){const i=new DataView(t,e),s=i.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=i.getUint32(1,Ts),e+=5;else if(a===1)l=i.getUint16(1,Ts),e+=3;else{if(a!==2)throw new U("lepcc-decode-error","Bad count type");l=i.getUint8(1),e+=2}if(o)throw new U("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(t,e,c);let p=0,f=0,m=0;const y=-1>>>32-n;for(let _=0;_<l;_++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;r[_]=p&y,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return e+m}const R1={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function Sbt(t,e){return{sizeLo:t.getUint32(e+R1.sizeLo,Ts),sizeHi:t.getUint32(e+R1.sizeHi,Ts),count:t.getUint32(e+R1.count,Ts),colorMapCount:t.getUint16(e+R1.colorMapCount,Ts),lookupMethod:t.getUint8(e+R1.lookupMethod),compressionMethod:t.getUint8(e+R1.compressionMethod)}}function Ebt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=tJ(t,e,r);if(r+=rb.byteCount,i!=="ClusterRGB")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=Sbt(e,r);if(r+=R1.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+r!==t.byteLength||n.colorMapCount>256)throw new U("lepcc-decode-error","Bad count");const o=new Uint8Array(t,r,3*n.colorMapCount),a=new Uint8Array(t,r+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+r!==t.byteLength||n.colorMapCount!==0)throw new U("lepcc-decode-error","Bad count");return new Uint8Array(t,r).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(r+3!==t.byteLength||n.colorMapCount!==1)throw new U("lepcc-decode-error","Bad count");const o=e.getUint8(r),a=e.getUint8(r+1),l=e.getUint8(r+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new U("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const P1={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function Cbt(t,e){return{sizeLo:t.getUint32(e+P1.sizeLo,Ts),sizeHi:t.getUint32(e+P1.sizeHi,Ts),count:t.getUint32(e+P1.count,Ts),scaleFactor:t.getUint16(e+P1.scaleFactor,Ts),bitsPerPoint:t.getUint8(e+P1.bitsPerPoint),reserved:t.getUint8(e+P1.reserved)}}function Abt(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:s}=tJ(t,e,r);if(r+=rb.byteCount,i!=="Intensity ")throw new U("lepcc-decode-error","Bad identifier");if(s>1)throw new U("lepcc-decode-error","Unknown version");const n=Cbt(e,r);if(r+=P1.byteCount,n.sizeHi*2**32+n.sizeLo!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+r!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const a=new Uint8Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+r!==t.byteLength)throw new U("lepcc-decode-error","Bad size");const a=new Uint16Array(t,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(fH(t,r,a)!==t.byteLength)throw new U("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const mH=J.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Obt(t,e,r){let i="",s=0;for(;s<r;){const n=t[e+s];if(n<128)i+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&t[e+s+1];i+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&t[e+s+1])<<6|63&t[e+s+2];i+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new U("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=r)throw new U("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&t[e+s+1])<<12|(63&t[e+s+2])<<6|63&t[e+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);s+=4}}}return i}function TAe(t,e){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let s=0;s<e.length;s++){const n=e[s],o=n.valueType||n.type,a=Fbt[o];r.fields[n.property]=a(t,i),i+=l6[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function Rbt(t,e,r){return SAe(t,e,r).map(i=>{const s=i?Date.parse(i):null;return s&&!Number.isNaN(s)?s:null})}function SAe(t,e,r){const i=[];let s,n,o=0;for(n=0;n<t;n+=1){if(s=e[n],s>0){if(i.push(Obt(r,o,s-1)),r[o+s-1]!==0)throw new U("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=s}return i}function lue(t,e){return new l6[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function Pbt(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}function Mbt(t,e,r){const i=e.header!=null?TAe(t,e.header):{byteOffset:0,byteCount:0,fields:{count:r}},s={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let n=i.byteCount;for(let o=0;o<e.ordering.length;o++){const a=e.ordering[o],l=Q(e[a]);if(l.count=i.fields.count??0,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new U("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&l.timeEncoding!=="ECMA_ISO8601")throw new U("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!CAe(l.valueType))throw new U("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=rD(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount??0,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function EAe(t,e,r){if(e!==t&&mH.error(`Invalid ${r} buffer size
 expected: ${t}, actual: ${e})`),e<t)throw new U("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function $bt(t){return{isDraco:!1,isLegacy:!1,color:t.color!=null,normal:t.normal!=null,uv0:t.uv0!=null,uvRegion:t.uvRegion!=null,featureIndex:t.faceRange!=null&&t.featureId!=null}}function YFt(t,e){const r=TAe(t,e&&e.header);let i=r.byteCount;const s={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},n=r.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of e.ordering){if(!e.vertexAttributes[c])continue;const h={...e.vertexAttributes[c],byteOffset:i,count:o},p=Dbt[c]||"_"+c;s.vertexAttributes[p]=h,i+=rD(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(e.faces&&a){s.faces={};for(const c of e.ordering){if(!e.faces[c])continue;const h={...e.faces[c],byteOffset:i,count:a};s.faces[c]=h,i+=rD(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&l){s.featureAttributes={};for(const c of e.featureAttributeOrder){if(!e.featureAttributes[c])continue;const h={...e.featureAttributes[c],byteOffset:i,count:l};s.featureAttributes[c]=h,i+=(h.valueType==="UInt64"?8:rD(h.valueType))*h.valuesPerElement*l}}return EAe(i,t.byteLength,"geometry"),s.byteCount=i-s.byteOffset,s}function JFt(t,e){return!t||!t.compressedAttributes||t.compressedAttributes.encoding!=="draco"?t?$bt(t):Ibt(e):Lbt(t.compressedAttributes.attributes)}function Ibt(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t.ordering)if(t.vertexAttributes[r])switch(r){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}function Lbt(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t)switch(r){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}const Dbt={position:E.POSITION,normal:E.NORMAL,color:E.COLOR,uv0:E.UV0,region:E.UVREGION};function Nbt(t,e,r){if(t.encoding==="lepcc-rgb")return Ebt(e);if(t.encoding==="lepcc-intensity")return Abt(e);if(t.encoding!=null&&t.encoding!=="")throw new U("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(mH.warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),t.ordering[0]==="ObjectIds"&&t.hasOwnProperty("objectIds")&&(mH.warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const i=Mbt(e,t,r);EAe(i.byteOffset+i.byteCount,e.byteLength,"attribute");const s=i.entries.attributeValues||i.entries.objectIds;if(s){if(s.valueType==="String"){const n=i.entries.attributeByteCounts,o=lue(e,n),a=Pbt(e,s);return s.timeEncoding?Rbt(n.count,o,a):SAe(n.count,o,a)}return lue(e,s)}throw new U("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const l6={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},Fbt={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function CAe(t){return l6.hasOwnProperty(t)}function rD(t){return CAe(t)?l6[t].BYTES_PER_ELEMENT:0}function Ubt(t,e,r,i){const s=Vbt(t,e,r),n=ve();return bl(r,s,n,i),n}const AAe=1,cue=5-AAe;function Vbt(t,e,r){const i=C(),s=t[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/cue)*cue+AAe);if(r.isGeographic){const l=n/Dr(r).radius*180/Math.PI,c=Math.round(t[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(t[0]/p)*p;i[0]=f,i[1]=h}else{const l=Math.round(t[0]/n),c=Math.round(t[1]/n);i[0]=l*n,i[1]=c*n}const o=t[2]+e,a=Math.round(o/n);return i[2]=a*n,i}function OAe(t){return t?parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10):void 0}function QFt(t){var e;if(oe("disable-feature:i3s-draco")||!t)return!1;for(const r of t)for(const i of r.geometryBuffers)if(((e=i.compressedAttributes)==null?void 0:e.encoding)==="draco")return!0;return!1}function KFt(t,e,r,i){r.traverse(e,s=>{const n=s.mbs;return(n!=null&&zbt(t,n))!==ib.OUTSIDE&&(i(s),!0)})}function e6t(t,e,r){let i=0,s=0;for(let n=0;n<e.length&&i<t.length;n++)t[i]===e[n]&&(r(n)&&(t[s]=t[i],s++),i++);t.length=s}function t6t(t,e,r){let i=0,s=0;for(;i<r.length;)Sue(t,r[i])>=0===e&&(r[s]=r[i],s++),i++;r.length=s}const gC=zt();function r6t(t,e){if(e.rotationScale[1]===0&&e.rotationScale[2]===0&&e.rotationScale[3]===0&&e.rotationScale[5]===0&&e.rotationScale[6]===0&&e.rotationScale[7]===0)return gC[0]=(t[0]-e.position[0])/e.rotationScale[0],gC[1]=(t[1]-e.position[1])/e.rotationScale[4],gC[2]=(t[2]-e.position[0])/e.rotationScale[0],gC[3]=(t[3]-e.position[1])/e.rotationScale[4],gC}var ib;function zbt(t,e){const r=e[0],i=e[1],s=e[3],n=t[0]-r,o=r-t[2],a=t[1]-i,l=i-t[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?ib.OUTSIDE:p>0?ib.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?ib.INSIDE:ib.INTERSECTS_CENTER_INSIDE}function kbt(t,e,r){const i=[],s=r&&r.missingFields,n=r&&r.originalFields;for(const o of t){const a=o.toLowerCase();let l=!1;for(const c of e)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return i}async function i6t(t,e,r,i,s){if(e.length===0)return[];const n=t.attributeStorageInfo;if(t.associatedLayer!=null)try{return await Gbt(t.associatedLayer,e,r,i)}catch(o){if(t.associatedLayer.loaded)throw o}if(n){const o=Bbt(e,r,s);if(o==null)throw new U("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=t.parsedUrl.path;return(await Promise.all(o.map(l=>jbt(a,n,l.node,l.indices,i).then(c=>{for(let h=0;h<l.graphics.length;h++){const p=l.graphics[h],f=c[h];if(p.attributes)for(const m in p.attributes)m in f||(f[m]=p.attributes[m]);p.attributes=f}return l.graphics})))).flat()}throw new U("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function Bbt(t,e,r){const i=new Map,s=[],n=r();for(const o of t){const a=o.attributes[e];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=i.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),i.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function Gbt(t,e,r,i){e.sort((l,c)=>l.attributes[r]-c.attributes[r]);const s=e.map(l=>l.attributes[r]),n=[],o=kbt(i,t.fields,{originalFields:n}),a=await RAe(t,s,o);for(let l=0;l<e.length;l++){const c=e[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return e}function RAe(t,e,r){const i=t.capabilities.query.maxRecordCount;if(i!=null&&e.length>i){const n=HAe(e,i);return Promise.all(n.map(o=>RAe(t,o,r))).then(o=>o.flat())}const s=new k_({objectIds:e,outFields:r,orderByFields:[t.objectIdField]});return t.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===e.length)return n.features.map(o=>o.attributes);throw new U("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function jbt(t,e,r,i,s){return PAe(t,e,r.resources.attributes,i,s)}function PAe(t,e,r,i,s){const n=[];for(const o of e)if(o&&s.includes(o.name)){const a=`${t}/nodes/${r}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return Gf(n.map(o=>Nr(o.url,{responseType:"array-buffer"}).then(a=>Nbt(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of i){const c={};for(let h=0;h<o.length;h++){const p=o[h].value;p!=null&&(c[n[h].storageInfo.name]=Wbt(p,l))}a.push(c)}return a})}(function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",t[t.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",t[t.INSIDE=3]="INSIDE"})(ib||(ib={}));const Hbt=-32768,qbt=-(2**31);function Wbt(t,e){if(!t)return null;const r=t[e];return L4(t)?r===Hbt?null:r:N4(t)?r===qbt?null:r:r!=r?null:r}function Xbt(t){const e=t.store,r=e.indexCRS||e.geographicCRS,i=r===void 0?e.indexWKT:void 0;if(i){if(!t.spatialReference)throw new U("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new U("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new Ge(OAe(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function Zbt(t){const e=t.store,r=e.vertexCRS||e.projectedCRS,i=r===void 0?e.vertexWKT:void 0;if(i){if(!t.spatialReference)throw new U("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new U("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const s=r?new Ge(OAe(r)):t.spatialReference;return s.equals(t.spatialReference)?t.spatialReference:s}function s6t(t,e){return e==null?"@null":e===Df(e)?"@ECEF":t.equals(e)?"":e.wkid!=null?"@"+e.wkid:null}function gH(t,e,r){if(!If(t,e))throw new U("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!Ybt(t,e))throw new U("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function n6t(t,e,r){var i,s;if(((i=t.serviceUpdateTimeStamp)==null?void 0:i.lastUpdate)!==((s=e.serviceUpdateTimeStamp)==null?void 0:s.lastUpdate)||!r.isEmpty||oc(t.associatedLayer,n=>n.url)!==oc(e.associatedLayer,n=>n.url))throw new U("layerview:recycle-failed")}function Ybt(t,e){return t.equals(e)||t.isWGS84&&e.isWebMercator||t.isWebMercator&&e.isWGS84}function Jbt(t,e,r){const i=Xbt(t),s=Zbt(t);gH(i,e,r),gH(s,e,r)}function Qbt(t){return(t.geometryType==null||t.geometryType==="triangles")&&(t.topology==null||t.topology==="PerAttributeArray")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function o6t(t){if(t.store==null||t.store.defaultGeometrySchema==null||!Qbt(t.store.defaultGeometrySchema))throw new U("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:t.parsedUrl.path})}function a6t(t,e){Jbt(t,e.spatialReference,e.viewingMode)}function Kbt(t){return t.geometryType!=null&&t.geometryType==="points"&&(t.topology==null||t.topology==="PerAttributeArray")&&(t.encoding==null||t.encoding===""||t.encoding==="lepcc-xyz")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function l6t(t){if(t.store==null||t.store.defaultGeometrySchema==null||!Kbt(t.store.defaultGeometrySchema))throw new U("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function c6t(t,e){gH(t.spatialReference,e.spatialReference,e.viewingMode)}function ewt(t){return t.type==="simple"||t.type==="class-breaks"||t.type==="unique-value"}function twt(t){return t.type==="mesh-3d"}function u6t(t){if(t==null||!ewt(t)||(t.type==="unique-value"||t.type==="class-breaks")&&t.defaultSymbol==null)return!0;const e=t.getSymbols();if(e.length===0)return!0;for(const r of e){if(!twt(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||i.material==null||i.material.color==null||i.material.colorMixMode!=="replace")return!0}return!1}const h6t=dwe({color:[0,0,0,0],opacity:0});class rwt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function d6t(t){const e=new rwt;let r=!1,i=!1;for(const s of t.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(n!=null&&!r){const a=n.color,l=Wxe(n.colorMixMode);e.material=a!=null?{color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:{color:[1,1,1],alpha:1,colorMixMode:Fs.Multiply},e.castShadows=s.castShadows,r=!0}o==null||i||(e.edgeMaterial=hwe(o,{}),i=!0)}return e.material||(e.material={color:[1,1,1],alpha:1,colorMixMode:Fs.Multiply}),e}function p6t(t,e){return(0|t)+(0|e)|0}function iwt(t,e,r,i,s=0){i===Df(i)?e.isGeographic?cwt(t,r,e,s):lwt(t,r,e,s):e.isWGS84&&(i.isWebMercator||rO(i))?swt(e,t,i,r,s):e.isWebMercator&&rO(i)?awt(e,t,i,r,s):t===r?(r.center[2]+=s,oi(r.center,e,0,r.center,i,0,1)):(se(r.center,t.center[0],t.center[1],t.center[2]+s),oi(r.center,e,0,r.center,i,0,1),AR(r.quaternion,t.quaternion),re(r.halfSize,t.halfSize))}function swt(t,e,r,i,s){re(L0,e.center),L0[2]+=s;const n=Df(r);oi(L0,t,0,L0,n,0,1),MAe(n,e,L0,r,i)}const iD=new Array(24),nwt=new Ve(iD,3,!0),uue=C(),L0=C(),owt=Ni();function awt(t,e,r,i,s){re(L0,e.center),L0[2]+=s,MAe(t,e,L0,r,i)}function MAe(t,e,r,i,s){const n=G5(owt,e.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)uue[a]=e.halfSize[a]*(o&1<<a?-1:1);for(let a=0;a<3;++a){let l=r[a];for(let c=0;c<3;++c)l+=uue[c]*n[3*c+a];iD[3*o+a]=l}}oi(iD,t,0,iD,i,0,8),iEe(nwt,s)}function lwt(t,e,r,i){sEe(t,yH),se(e.center,t.center[0],t.center[1],t.center[2]+i),bl(r,e.center,Mc,Df(r)),se(e.center,Mc[12],Mc[13],Mc[14]);const s=2*Math.sqrt(1+Mc[0]+Mc[5]+Mc[10]);Zm[0]=(Mc[6]-Mc[9])/s,Zm[1]=(Mc[8]-Mc[2])/s,Zm[2]=(Mc[1]-Mc[4])/s,Zm[3]=.25*s,tF(e.quaternion,Zm,t.quaternion),Uf(Zm,e.quaternion);let n=0,o=0,a=0;for(const l of yH)l[2]+=i,oi(l,r,0,l,Df(r),0,1),_n(Cr,l,e.center),pc(Cr,Cr,Zm),n=Math.max(n,Math.abs(Cr[0])),o=Math.max(o,Math.abs(Cr[1])),a=Math.max(a,Math.abs(Cr[2]));se(e.halfSize,n,o,a)}function cwt(t,e,r,i){const s=Dr(r),n=1+Math.max(0,i)/(s.radius+t.center[2]);se(e.center,t.center[0],t.center[1],t.center[2]+i),oi(e.center,r,0,e.center,Df(r),0,1),AR(e.quaternion,t.quaternion),Uf(Zm,t.quaternion),se(Cr,0,0,1),pc(Cr,Cr,Zm),se(Cr,t.halfSize[0]*Math.abs(Cr[0]),t.halfSize[1]*Math.abs(Cr[1]),t.halfSize[2]*Math.abs(Cr[2])),ie(Cr,Cr,s.inverseFlattening),le(e.halfSize,t.halfSize,Cr),ie(e.halfSize,e.halfSize,n)}function f6t(t,e,r,i,s,n){if(!n||n.length===0||e==null||!t.mbs)return null;const o=Ubt(t.mbs,s,r,e);bn(aI,o);let a=null;const l=()=>{if(!a)if(a=yH,yc(oI),t.serviceObb!=null){iwt(t.serviceObb,r,hue,e,s),sEe(hue,a);for(const m of a)$e(m,m,aI),n2(oI,m)}else{const m=t.mbs;if(!m)return;const y=m[3];Gs(m,r,Cr,e),$e(Cr,Cr,aI),Cr[2]+=s;for(let _=0;_<8;++_){const v=1&_?y:-y,w=2&_?y:-y,T=4&_?y:-y,x=a[_];re(x,[Cr[0]+v,Cr[1]+w,Cr[2]+T]),n2(oI,x)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const y=m.geometry;if(!(y!=null&&y.hasZ))return;yc(rV);const _=y.spatialReference||i,v=y.rings.reduce((w,T)=>T.reduce((x,S)=>(Gs(S,_,Cr,e),$e(Cr,Cr,aI),n2(rV,Cr),Math.min(Cr[2],x)),w),1/0);l(),cR(oI,rV)&&(c=Math.min(c,v),h=Math.max(h,v))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,y,_)=>{$e(Cr,_,o),m[y]=Cr[0],m[y+1]=Cr[1],m[y+2]=Cr[2],y+=24,_[2]=c,$e(Cr,_,o),m[y]=Cr[0],m[y+1]=Cr[1],m[y+2]=Cr[2],y+=24,_[2]=h,$e(Cr,_,o),m[y]=Cr[0],m[y+1]=Cr[1],m[y+2]=Cr[2]};for(let m=0;m<8;++m)f(due.data,3*m,a[m]);return iEe(due)}function m6t(t){return t!=null&&t.halfSize[0]>=0}function g6t(t){return t[3]>=0}function y6t(t){t!=null&&(t.halfSize[0]=-1)}function _6t(t){t!=null&&(t[3]=-1)}const Mc=ve(),Zm=YSe(),yH=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],rV=zt(),oI=zt(),hue=EY(),Cr=C(),due={data:new Array(72),size:3,exclusive:!0,stride:3},aI=ve();async function uwt(t,e=t.popupTemplate){var h,p;if(e==null)return[];const r=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:i}=e,{objectIdField:s,typeIdField:n,globalIdField:o,relationships:a}=t;if(r.includes("*"))return["*"];const l=i?await SLe(t):[],c=i5(t.fieldsIndex,[...r,...l]);return n&&c.push(n),c&&s&&((h=t.fieldsIndex)!=null&&h.has(s))&&!c.includes(s)&&c.push(s),c&&o&&((p=t.fieldsIndex)!=null&&p.has(o))&&!c.includes(o)&&c.push(o),a&&a.forEach(f=>{var y;const{keyField:m}=f;c&&m&&((y=t.fieldsIndex)!=null&&y.has(m))&&!c.includes(m)&&c.push(m)}),c}function $Ae(t,e){return t.popupTemplate?t.popupTemplate:e!=null&&e.defaultPopupTemplateEnabled&&t.defaultPopupTemplate!=null?t.defaultPopupTemplate:null}function v6t(t,e){return $Ae(t,{defaultPopupTemplateEnabled:e})!=null}const hwt=["3DObject","Point"],pue=mAe();let It=class extends A3e(rvt(T3e(D3e(F3e(U3e(qY(x3e(Gi(Aq))))))))){constructor(...t){super(...t),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new Mt,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}destroy(){this._set("renderer",null)}getField(t){return this.fieldsIndex.get(t)}getFieldDomain(t,e){var i,s,n;const r=(s=(i=this.getFeatureType(e==null?void 0:e.feature))==null?void 0:i.domains)==null?void 0:s[t];return r&&r.type!=="inherited"?r:((n=this.getField(t))==null?void 0:n.domain)??null}getFeatureType(t){return t&&this.associatedLayer?this.associatedLayer.getFeatureType(t):null}get types(){var t;return((t=this.associatedLayer)==null?void 0:t.types)??[]}get typeIdField(){var t;return((t=this.associatedLayer)==null?void 0:t.typeIdField)??null}get templates(){var t;return((t=this.associatedLayer)==null?void 0:t.templates)??null}get formTemplate(){var t;return((t=this.associatedLayer)==null?void 0:t.formTemplate)??null}get fieldsIndex(){return new BY(this.fields)}readNodePages(t,e,r){return e.layerType==="Point"&&(t=e.pointNodePages),t==null||typeof t!="object"?null:W1.fromJSON(t,r)}set elevationInfo(t){this._set("elevationInfo",t),this.loaded&&this._validateElevationInfo()}get geometryType(){return dwt[this.profile]||"mesh"}set renderer(t){ND(t,this.fieldsIndex),this._set("renderer",t)}readCachedDrawingInfo(t){return t!=null&&typeof t=="object"||(t={}),t.color==null&&(t.color=!1),t}get capabilities(){var S,O;const t=((S=this.associatedLayer)==null?void 0:S.capabilities)??ivt,{query:e,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:s,supportsGeometryUpdate:n,supportsReturnServiceEditsInSourceSpatialReference:o},data:{supportsZ:a,supportsM:l,isVersioned:c,supportsAttachment:h},operations:{supportsEditing:p,supportsAdd:f,supportsUpdate:m,supportsDelete:y,supportsQuery:_,supportsQueryAttachments:v,supportsAsyncConvert3D:w}}=t,T=t.operations.supportsChangeTracking,x=!!((O=this.associatedLayer)!=null&&O.infoFor3D)&&Ese();return{query:e,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:o,supportsRollbackOnFailure:i,supportsGeometryUpdate:x&&n,supportsUploadWithItemId:s},data:{supportsAttachment:h,supportsZ:a,supportsM:l,isVersioned:c},operations:{supportsQuery:_,supportsQueryAttachments:v,supportsEditing:p&&T,supportsAdd:x&&f&&T,supportsDelete:x&&y&&T,supportsUpdate:m&&T,supportsAsyncConvert3D:w}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}get infoFor3D(){var t;return((t=this.associatedLayer)==null?void 0:t.infoFor3D)??null}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeOID"&&(t=r.name),!!t)),t||void 0}readGlobalIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(t=r.name),!!t)),t||void 0}get displayField(){var t;return((t=this.associatedLayer)==null?void 0:t.displayField)??null}readProfile(t,e){const r=e.store.profile;return r!=null&&fue[r]?fue[r]:(J.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(t){const e=t!=null?t.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},t).catch(Po).then(()=>this._fetchService(e)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,e),this._setAssociatedFeatureLayer(e),this._loadFilterGeometries()])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>gAe(this,{origin:"service"},e)).then(()=>ND(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(t));return this.addResolvingPromise(r),Promise.resolve(this)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(t){J.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:t}),this.filter=null}}createQuery(){const t=new k_;return this.geometryType!=="mesh"&&(t.returnGeometry=!0,t.returnZ=!0),t.where=this.definitionExpression||"1=1",t.sqlFormat="standard",t.outFields=["*"],t}queryExtent(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(t||this.createQuery(),e))}queryFeatureCount(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(t||this.createQuery(),e))}queryFeatures(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(t||this.createQuery(),e)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=this,i.sourceLayer=this;return r})}async queryCachedAttributes(t,e){const r=_Le(this.fieldsIndex,await uwt(this,$Ae(this)));return PAe(this.parsedUrl.path,this.attributeStorageInfo??[],t,e,r)}async queryCachedFeature(t,e){const r=await this.queryCachedAttributes(t,[e]);if(!r||r.length===0)throw new U("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const i=new vh;return i.attributes=r[0],i.layer=this,i.sourceLayer=this,i}queryObjectIds(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(t||this.createQuery(),e))}queryAttachments(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(t,e))}getFieldUsageInfo(t){const e={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[t]||e:(J.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),e)}createPopupTemplate(t){return yAe(this,t)}_getAssociatedLayerForQuery(){const t=this.associatedLayer;return t!=null&&t.loaded?Promise.resolve(t):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new U("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(t){throw new U("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:t})}return this.associatedLayer}hasCachedStatistics(t){return this.statisticsInfo!=null&&this.statisticsInfo.some(e=>e.name===t)}async queryCachedStatistics(t,e){if(await this.load(e),!this.statisticsInfo)throw new U("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const r=this.fieldsIndex.get(t);if(!r)throw new U("scenelayer:field-unexisting",`Field '${t}' does not exist on the layer`);for(const i of this.statisticsInfo)if(i.name===r.name){const s=gc(this.parsedUrl.path,i.href);return Nr(s,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e?e.signal:null}).then(n=>n.data)}throw new U("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(t,e){return this._debouncedSaveOperations(SS.SAVE_AS,{...e,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},t)}async save(){const t={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(SS.SAVE,t)}async applyEdits(t,e){const{applyEdits:r}=await ae(()=>import("./editingSupport-0218b620.js"),["assets/editingSupport-0218b620.js","assets/normalizeUtils-fd2a5db8.js","assets/normalizeUtilsCommon-1cd3f30a.js"]);if(await this.load(),!this.associatedLayer)throw new U(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),r(this,this.associatedLayer.source,t,e)}async uploadAssets(t,e){if(await this.load(),this.associatedLayer==null)throw new U(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(t,e)}on(t,e){return super.on(t,e)}validateLayer(t){if(t.layerType&&!hwt.includes(t.layerType))throw new U("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:t.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new U("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new U("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function e(r,i){let s=!1,n=!1;if(r==null)s=!0,n=!0;else{const o=i&&i.isGeographic;switch(r){case"east-north-up":case"earth-centered":s=!0,n=o;break;case"vertex-reference-frame":s=!0,n=!o;break;default:s=!1}}if(!s)throw new U("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new U("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}e(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const t=[];if(this.profile==="points")t.push("Point");else{if(this.profile!=="mesh-pyramids")throw new U("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);t.push("3DObject")}return t}_populateFieldUsageInfo(){var t,e;if(this._fieldUsageInfo={},this.fields)for(const r of this.fields){const i=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(o=>o.name===r.name)),s=!!((e=(t=this.associatedLayer)==null?void 0:t.fields)!=null&&e.some(o=>o&&r.name===o.name)),n={supportsLabelingInfo:i,supportsRenderer:i,supportsPopupTemplate:i||s,supportsLayerQuery:s};this._fieldUsageInfo[r.name]=n}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride()}_applyAssociatedLayerFieldsOverrides(){var e;if(!((e=this.associatedLayer)!=null&&e.fields))return;let t=null;for(const r of this.associatedLayer.fields){const i=this.getField(r.name);i?(!i.domain&&r.domain&&(i.domain=r.domain.clone()),i.editable=r.editable,i.nullable=r.nullable,i.length=r.length):(t||(t=this.fields?this.fields.slice():[]),t.push(r.clone()))}t&&this._set("fields",t)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const t=["popupTemplate","popupEnabled"],e=oa(this);for(let r=0;r<t.length;r++){const i=t[r],s=this.originIdOf(i),n=this.associatedLayer.originIdOf(i);s<n&&(n===ur.SERVICE||n===ur.PORTAL_ITEM)&&e.setAtOrigin(i,this.associatedLayer[i],n)}}_applyAssociatedLayerExtentOverride(){var i,s,n,o,a,l,c;const t=(s=(i=this.associatedLayer)==null?void 0:i.editingInfo)==null?void 0:s.lastEditDate,e=(n=this.associatedLayer)==null?void 0:n.serverGens,r=(o=this.associatedLayer)==null?void 0:o.getAtOrigin("fullExtent","service");!Ese()||((a=this.associatedLayer)==null?void 0:a.infoFor3D)==null||!r||!LW((l=this.associatedLayer)==null?void 0:l.url)||!t||((c=this.serviceUpdateTimeStamp)==null?void 0:c.lastUpdate)===t.getTime()||!this.serviceUpdateTimeStamp&&(e==null?void 0:e.minServerGen)===(e==null?void 0:e.serverGen)||oa(this).setAtOrigin("fullExtent",r.clone(),ur.SERVICE)}async _setAssociatedFeatureLayer(t){if(!["mesh-pyramids","points"].includes(this.profile))return;const e=new ubt(this.parsedUrl,this.portalItem,this.apiKey,t);try{this.associatedLayer=await e.fetch()}catch(r){gs(r)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await j2(()=>this.popupEnabled&&this.popupTemplate!=null);const t=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?J.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):J.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){const t=this.elevationInfo;t&&(this.profile==="mesh-pyramids"&&t.mode==="relative-to-scene"&&J.getLogger(this).warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),t.featureExpressionInfo&&t.featureExpressionInfo.expression!=="0"&&J.getLogger(this).warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([d({types:{key:"type",base:bg,typeMap:{selection:xj}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],It.prototype,"featureReduction",void 0),u([d({type:[m0],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],It.prototype,"rangeInfos",void 0),u([d({json:{read:!1}})],It.prototype,"associatedLayer",void 0),u([d({type:["show","hide"]})],It.prototype,"listMode",void 0),u([d({type:["ArcGISSceneServiceLayer"]})],It.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],It.prototype,"type",void 0),u([d({...pue.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],It.prototype,"fields",void 0),u([d()],It.prototype,"types",null),u([d()],It.prototype,"typeIdField",null),u([d()],It.prototype,"templates",null),u([d()],It.prototype,"formTemplate",null),u([d({readOnly:!0})],It.prototype,"fieldsIndex",null),u([d({type:K3e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],It.prototype,"floorInfo",void 0),u([d(pue.outFields)],It.prototype,"outFields",void 0),u([d({type:W1,readOnly:!0,json:{read:!1}})],It.prototype,"nodePages",void 0),u([Se("service","nodePages",["nodePages","pointNodePages"])],It.prototype,"readNodePages",null),u([d({type:[zu],readOnly:!0})],It.prototype,"materialDefinitions",void 0),u([d({type:[X3],readOnly:!0})],It.prototype,"textureSetDefinitions",void 0),u([d({type:[Y3],readOnly:!0})],It.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],It.prototype,"serviceUpdateTimeStamp",void 0),u([d({readOnly:!0})],It.prototype,"attributeStorageInfo",void 0),u([d({readOnly:!0})],It.prototype,"statisticsInfo",void 0),u([d({type:Mt.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],It.prototype,"excludeObjectIds",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],It.prototype,"definitionExpression",void 0),u([d({type:xbt,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],It.prototype,"filter",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],It.prototype,"path",void 0),u([d(M3e)],It.prototype,"elevationInfo",null),u([d({type:String})],It.prototype,"geometryType",null),u([d(o6)],It.prototype,"labelsVisible",void 0),u([d({type:[eP],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:P4},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:P4},write:!0}})],It.prototype,"labelingInfo",void 0),u([d(P3e)],It.prototype,"legendEnabled",void 0),u([d({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(t,e){var i,s;if(typeof t=="number"&&t>=0&&t<=1)return t;const r=(s=(i=e.layerDefinition)==null?void 0:i.drawingInfo)==null?void 0:s.transparency;return r!==void 0?N2(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],It.prototype,"opacity",void 0),u([d({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],It.prototype,"priority",void 0),u([d({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],It.prototype,"semantic",void 0),u([d({types:v3e,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],It.prototype,"renderer",null),u([d({json:{read:!1}})],It.prototype,"cachedDrawingInfo",void 0),u([Se("service","cachedDrawingInfo")],It.prototype,"readCachedDrawingInfo",null),u([d({readOnly:!0,json:{read:!1}})],It.prototype,"capabilities",null),u([d({type:Boolean,json:{read:!1}})],It.prototype,"editingEnabled",null),u([d({readOnly:!0,json:{write:!1,read:!1}})],It.prototype,"infoFor3D",null),u([d(n6)],It.prototype,"popupEnabled",void 0),u([d({type:VS,json:{name:"popupInfo",write:!0}})],It.prototype,"popupTemplate",void 0),u([d({readOnly:!0,json:{read:!1}})],It.prototype,"defaultPopupTemplate",null),u([d({type:String,json:{read:!1}})],It.prototype,"objectIdField",void 0),u([Se("service","objectIdField",["objectIdField","fields"])],It.prototype,"readObjectIdField",null),u([d({type:String,json:{read:!1}})],It.prototype,"globalIdField",void 0),u([Se("service","globalIdField",["globalIdField","fields"])],It.prototype,"readGlobalIdField",null),u([d({readOnly:!0,type:String,json:{read:!1}})],It.prototype,"displayField",null),u([d({type:String,json:{read:!1}})],It.prototype,"profile",void 0),u([Se("service","profile",["store.profile"])],It.prototype,"readProfile",null),u([d({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],It.prototype,"normalReferenceFrame",void 0),u([d(O3e)],It.prototype,"screenSizePerspectiveEnabled",void 0),It=u([R("esri.layers.SceneLayer")],It);const fue={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},dwt={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},rJ=It,b6t=Object.freeze(Object.defineProperty({__proto__:null,default:rJ},Symbol.toStringTag,{value:"Module"})),IAe={type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[240,240,240,.7]},edges:{type:"solid",color:[0,0,0,.6],size:.5}}]}},pwt=new rJ({url:"https://tiles.arcgis.com/tiles/uX5kr9HIx4qXytm9/arcgis/rest/services/Designated_3D_Buildings/SceneServer",renderer:IAe,popupEnabled:!1}),fwt=new rJ({url:"https://tiles.arcgis.com/tiles/uX5kr9HIx4qXytm9/arcgis/rest/services/NonDesignated_3D_Buildings/SceneServer",renderer:IAe,popupEnabled:!1}),mwt=new _pe({basemap:{portalItem:{id:"75a08e8cd8b64dcfa6945bb7f624ccc5"}},ground:"world-elevation",layers:[pwt,fwt]});new W0t({map:mwt,zoom:13,viewingMode:"local",qualityProfile:"high",container:"viewDiv",camera:{position:{latitude:40.682252429650674,longitude:-73.92907468482736,z:8555.69067688151},tilt:46.88991231380563,heading:299.4493985836785}});export{bXe as $,PEe as A,spt as B,a_e as C,zN as D,Kze as E,kKe as F,oKe as G,uKe as H,AY as I,IZ as J,yct as K,gct as L,HF as M,_ct as N,HN as O,iQe as P,Upt as Q,NEe as R,LVe as S,kpt as T,VEe as U,Sdt as V,Gpt as W,BEe as X,NKe as Y,YF as Z,mSe as _,s_e as a,$f as a$,tft as a0,uft as a1,wft as a2,Tft as a3,Eft as a4,BQe as a5,GEe as a6,sft as a7,Bft as a8,Xtt as a9,Ult as aA,Cs as aB,$S as aC,ou as aD,yn as aE,ae as aF,PA as aG,CH as aH,Ba as aI,ka as aJ,e5 as aK,qi as aL,P2 as aM,xwt as aN,pu as aO,js as aP,E as aQ,Ve as aR,bS as aS,fn as aT,NZ as aU,Tw as aV,Lt as aW,wn as aX,xi as aY,Gs as aZ,Ge as a_,Ert as aa,ant as ab,Ant as ac,wnt as ad,bf as ae,Pi as af,Vr as ag,Pe as ah,u as ai,d as aj,Hd as ak,R as al,Cq as am,fQ as an,xe as ao,If as ap,U as aq,bh as ar,n_ as as,Ahe as at,Mt as au,ue as av,Gr as aw,Eb as ax,z7 as ay,vh as az,A_e as b,QD as b$,ot as b0,ge as b1,se as b2,J as b3,C as b4,oO as b5,pO as b6,O_t as b7,gs as b8,tRt as b9,qb as bA,O_ as bB,Bt as bC,wwt as bD,oV as bE,Eue as bF,OR as bG,nFt as bH,sFt as bI,mo as bJ,Q as bK,m$e as bL,Cb as bM,_Ie as bN,vIe as bO,r5 as bP,o2 as bQ,ob as bR,N3e as bS,Vxt as bT,gAe as bU,jn as bV,CSt as bW,go as bX,pt as bY,lR as bZ,yr as b_,rRt as ba,Aq as bb,fZe as bc,$g as bd,k_ as be,hOt as bf,rMt as bg,n6t as bh,v6t as bi,Ese as bj,dt as bk,Xbt as bl,t6t as bm,Pvt as bn,FMt as bo,p$e as bp,$Ae as bq,_Le as br,uwt as bs,XLe as bt,dw as bu,ke as bv,k0 as bw,hw as bx,BS as by,xt as bz,kke as c,mw as c$,k2 as c0,U4 as c1,HPe as c2,Oo as c3,qPe as c4,WPe as c5,XPe as c6,ye as c7,Z3e as c8,sat as c9,Nr as cA,ri as cB,hI as cC,YZe as cD,an as cE,ZTt as cF,WOt as cG,zt as cH,yc as cI,nvt as cJ,aFt as cK,Kde as cL,xFe as cM,sb as cN,Ab as cO,Tq as cP,xq as cQ,gpe as cR,Sq as cS,lTt as cT,eTt as cU,YFt as cV,lue as cW,ZFt as cX,Nbt as cY,S5 as cZ,fO as c_,oe as ca,No as cb,D9e as cc,j2 as cd,Jt as ce,OSt as cf,lLt as cg,cY as ch,v5 as ci,j4 as cj,Is as ck,qa as cl,ur as cm,ow as cn,lat as co,fh as cp,ePe as cq,fbt as cr,De as cs,de as ct,nge as cu,qge as cv,Gi as cw,Ae as cx,et as cy,wg as cz,PBe as d,mLe as d$,nw as d0,yk as d1,xs as d2,gk as d3,vk as d4,YD as d5,Qme as d6,kxt as d7,MO as d8,h$e as d9,Mce as dA,nq as dB,cFt as dC,GAe as dD,cH as dE,Gf as dF,dFt as dG,hFt as dH,j_t as dI,zxt as dJ,zdt as dK,kdt as dL,Idt as dM,KNt as dN,f4 as dO,oNt as dP,Gdt as dQ,DPe as dR,BY as dS,oZe as dT,ILe as dU,JYe as dV,QYe as dW,Eq as dX,Uwe as dY,kOt as dZ,zOt as d_,os as da,exe as db,Yg as dc,vw as dd,M9e as de,gxt as df,T3e as dg,D3e as dh,F3e as di,qY as dj,Clt as dk,ki as dl,Po as dm,Elt as dn,KA as dp,Se as dq,fw as dr,R3e as ds,WI as dt,_J as du,jd as dv,Awt as dw,f1t as dx,m1t as dy,g1t as dz,zBe as e,ve as e$,$q as e0,ATt as e1,OTt as e2,STt as e3,CTt as e4,ra as e5,fIe as e6,BOt as e7,DYe as e8,YSe as e9,xvt as eA,rg as eB,L2t as eC,Zf as eD,Dhe as eE,K1t as eF,K2 as eG,Yi as eH,Rd as eI,LW as eJ,Zc as eK,gr as eL,RS as eM,n5t as eN,a5t as eO,s5t as eP,xCe as eQ,b5t as eR,hyt as eS,d5t as eT,nyt as eU,gwt as eV,i5t as eW,w5t as eX,sFe as eY,re as eZ,$e as e_,yC as ea,oi as eb,Wr as ec,Uf as ed,pc as ee,ss as ef,JD as eg,jf as eh,UCt as ei,bTe as ej,bP as ek,W4e as el,MS as em,wvt as en,Tlt as eo,U3e as ep,tO as eq,Zr as er,I3e as es,P3e as et,bc as eu,Oh as ev,g5 as ew,L_ as ex,X1t as ey,x3e as ez,TYe as f,FR as f$,Jue as f0,hV as f1,ege as f2,eMt as f3,mpe as f4,XA as f5,M_ as f6,c_ as f7,nMe as f8,Ime as f9,sa as fA,Eg as fB,$i as fC,Z4t as fD,qV as fE,oFt as fF,Sce as fG,Tg as fH,q_t as fI,yAe as fJ,ivt as fK,PAe as fL,W1 as fM,zu as fN,X3 as fO,Y3 as fP,V_t as fQ,v3e as fR,n6 as fS,VS as fT,Or as fU,mAe as fV,Sw as fW,gOt as fX,mOt as fY,C_ as fZ,cp as f_,wr as fa,wF as fb,dxt as fc,Rxt as fd,iI as fe,Gce as ff,gc as fg,oc as fh,q5t as fi,Vlt as fj,B2t as fk,M4 as fl,I8e as fm,lu as fn,hQ as fo,Lr as fp,kbt as fq,Yc as fr,Kd as fs,wCt as ft,cR as fu,Uo as fv,Ji as fw,ab as fx,H4 as fy,ni as fz,iX as g,eP as g$,d_ as g0,Rct as g1,Lgt as g2,Rq as g3,Zu as g4,mQ as g5,Cg as g6,mr as g7,uR as g8,Va as g9,fi as gA,le as gB,ys as gC,l6e as gD,Vd as gE,op as gF,db as gG,x2t as gH,m6e as gI,Ms as gJ,_wt as gK,xPe as gL,I2 as gM,jH as gN,VAe as gO,kr as gP,yG as gQ,_G as gR,d5 as gS,f_ as gT,j1t as gU,k1t as gV,$vt as gW,ND as gX,bpe as gY,M3e as gZ,o6 as g_,o9e as ga,yR as gb,_S as gc,_vt as gd,ZA as ge,Ga as gf,FJ as gg,yxt as gh,r5t as gi,Zxt as gj,Ad as gk,Zme as gl,Kre as gm,Ql as gn,LPe as go,YAt as gp,uo as gq,W5t as gr,w_t as gs,DT as gt,Sk as gu,tOt as gv,qxt as gw,QAt as gx,hc as gy,X1 as gz,Dke as h,Wbt as h$,P4 as h0,bj as h1,s6 as h2,O3e as h3,KY as h4,fAe as h5,oLe as h6,nLe as h7,RIe as h8,rQ as h9,Ud as hA,ms as hB,Ye as hC,di as hD,fat as hE,Ie as hF,iUe as hG,M0 as hH,Bs as hI,Li as hJ,fo as hK,_X as hL,B4t as hM,Q2e as hN,$o as hO,Jbt as hP,QFt as hQ,i6t as hR,Yxt as hS,iEe as hT,q_e as hU,MMe as hV,L2 as hW,sOt as hX,F0 as hY,oUe as hZ,Sue as h_,oa as ha,rvt as hb,Ag as hc,SS as hd,Lb as he,qTt as hf,mA as hg,fk as hh,t_ as hi,XV as hj,pQ as hk,t2 as hl,Pf as hm,Bd as hn,QO as ho,JY as hp,B_t as hq,k_t as hr,z_t as hs,Xxt as ht,ZY as hu,L as hv,ce as hw,Bi as hx,or as hy,Qr as hz,Zwe as i,ia as i$,lIt as i0,oat as i1,tA as i2,bC as i3,sO as i4,DOt as i5,br as i6,fc as i7,vl as i8,b as i9,z_ as iA,vF as iB,Lo as iC,OZ as iD,yF as iE,rE as iF,OQe as iG,HW as iH,WX as iI,mCt as iJ,Wb as iK,AF as iL,Ia as iM,v7e as iN,bU as iO,LCt as iP,DCt as iQ,bN as iR,ete as iS,rFe as iT,bn as iU,jme as iV,Rh as iW,za as iX,sn as iY,nW as iZ,fCt as i_,fs as ia,du as ib,Je as ic,Oe as id,VN as ie,Jf as ig,st as ih,Sr as ii,vc as ij,be as ik,F as il,mi as im,Rr as io,Er as ip,vr as iq,Ot as ir,Zg as is,B5 as it,V_ as iu,El as iv,gF as iw,Gt as ix,zf as iy,P_ as iz,ew as j,A3e as j$,Df as j0,bl as j1,si as j2,b_ as j3,yMt as j4,mMt as j5,_Mt as j6,b5 as j7,gMt as j8,prt as j9,B2 as jA,YTt as jB,Hs as jC,Owt as jD,Qb as jE,uFt as jF,tAe as jG,OH as jH,Db as jI,AT as jJ,Lvt as jK,LFt as jL,K3e as jM,Sb as jN,aD as jO,rZ as jP,PS as jQ,i6 as jR,Xvt as jS,yvt as jT,Jg as jU,HY as jV,h3e as jW,OFt as jX,AFt as jY,CFt as jZ,p1t as j_,grt as ja,Ni as jb,frt as jc,mrt as jd,GN as je,Ii as jf,Nt as jg,oh as jh,he as ji,Jse as jj,XT as jk,TCt as jl,Ne as jm,$s as jn,zAe as jo,au as jp,Twt as jq,qwt as jr,lhe as js,TH as jt,Yr as ju,yh as jv,Jme as jw,y6 as jx,jQ as jy,uTt as jz,Xct as k,Q5 as k$,Jvt as k0,Kvt as k1,t0e as k2,Dvt as k3,Nvt as k4,Fvt as k5,Vvt as k6,zvt as k7,kvt as k8,Bvt as k9,qTe as kA,XTe as kB,_u as kC,LA as kD,bb as kE,DTe as kF,bit as kG,drt as kH,oJe as kI,zwe as kJ,Hxt as kK,lJe as kL,Yrt as kM,jrt as kN,Hrt as kO,Qrt as kP,Wrt as kQ,Xrt as kR,ip as kS,qrt as kT,aa as kU,Jrt as kV,SR as kW,Y5 as kX,on as kY,aJe as kZ,Zrt as k_,Gvt as ka,jvt as kb,Hvt as kc,qvt as kd,Wvt as ke,pAe as kf,ASt as kg,HRe as kh,v5t as ki,_5t as kj,Xft as kk,LFe as kl,W4 as km,yq as kn,T6 as ko,Dr as kp,e6t as kq,ir as kr,ac as ks,Zq as kt,m5t as ku,d0t as kv,f5t as kw,x5t as kx,p5t as ky,$ee as kz,IJe as l,DPt as l$,Eh as l0,F_ as l1,_2 as l2,ja as l3,lx as l4,i5 as l5,k4 as l6,xg as l7,TTt as l8,wTt as l9,R0 as lA,Zi as lB,$ as lC,bxt as lD,rR as lE,hwe as lF,Fs as lG,vR as lH,gH as lI,Cwt as lJ,aw as lK,nat as lL,iat as lM,sUe as lN,axt as lO,jOt as lP,GOt as lQ,Ebe as lR,XAt as lS,epe as lT,Kme as lU,ff as lV,lMt as lW,J7 as lX,Bwt as lY,jnt as lZ,nPe as l_,yJ as la,iOt as lb,Mvt as lc,vTt as ld,bTt as le,xTt as lf,aO as lg,eu as lh,RTt as li,Gbe as lj,cG as lk,f2t as ll,Xhe as lm,g2t as ln,m2t as lo,ie as lp,uf as lq,wO as lr,Fo as ls,kn as lt,lf as lu,zTt as lv,v2t as lw,Tve as lx,gw as ly,Ch as lz,yut as m,sR as m$,XPt as m0,LPt as m1,$Pt as m2,NT as m3,Qet as m4,IPt as m5,g5t as m6,h0t as m7,h5t as m8,c0t as m9,pMt as mA,gde as mB,Bxt as mC,_de as mD,Ys as mE,Ft as mF,Ffe as mG,d4e as mH,Cxt as mI,RV as mJ,_h as mK,Sd as mL,sr as mM,sc as mN,FW as mO,NW as mP,Br as mQ,O2t as mR,v6e as mS,t6 as mT,JR as mU,Ua as mV,a2t as mW,F2t as mX,Rue as mY,UH as mZ,pxt as m_,c5t as ma,u5t as mb,y5t as mc,o5t as md,y0t as me,l5t as mf,Vg as mg,iye as mh,D6e as mi,Zt as mj,X4t as mk,Yo as ml,uV as mm,f9e as mn,_O as mo,yo as mp,lge as mq,H6e as mr,I2t as ms,rr as mt,su as mu,Et as mv,ji as mw,U_ as mx,N_ as my,jxt as mz,_Ee as n,na as n$,sPe as n0,q4 as n1,Oxt as n2,Aue as n3,dc as n4,Bhe as n5,HH as n6,hxt as n7,MJ as n8,sme as n9,VMe as nA,me as nB,PDt as nC,$Dt as nD,WTt as nE,z4e as nF,d1 as nG,ODt as nH,iwt as nI,_N as nJ,Kr as nK,JTt as nL,OAt as nM,P1e as nN,Di as nO,$Z as nP,Tr as nQ,iu as nR,kV as nS,Bb as nT,q5 as nU,wc as nV,Xg as nW,po as nX,Ke as nY,Mr as nZ,Ee as n_,kH as na,Th as nb,Wg as nc,Kee as nd,cu as ne,ICt as nf,sRt as ng,Sh as nh,sS as ni,Eze as nj,ZW as nk,GFe as nl,bw as nm,dVe as nn,Ju as no,Ue as np,cr as nq,X4 as nr,dTt as ns,Og as nt,a_ as nu,rme as nv,G2 as nw,fxt as nx,QF as ny,uH as nz,Zdt as o,bR as o$,bi as o0,Wfe as o1,IDt as o2,LDt as o3,NDt as o4,Xq as o5,ea as o6,r6e as o7,u5 as o8,Fe as o9,sie as oA,uJe as oB,ZAt as oC,ppe as oD,DIe as oE,rTt as oF,NMe as oG,GMe as oH,Fwe as oI,rq as oJ,$xt as oK,Rxe as oL,JQe as oM,Fa as oN,Ha as oO,C2 as oP,r_t as oQ,ub as oR,hu as oS,IF as oT,Vt as oU,Sl as oV,xc as oW,ca as oX,Ph as oY,Qc as oZ,T2t as o_,ap as oa,Ir as ob,xr as oc,U4t as od,p9e as oe,J$t as of,l6t as og,c6t as oh,pf as oi,_R as oj,tpe as ok,Ube as ol,p3 as om,Qge as on,Y4t as oo,uN as op,eA as oq,e_ as or,qOt as os,Qre as ot,XOt as ou,hTt as ov,UOt as ow,Lwe as ox,Nwe as oy,$we as oz,wEe as p,co as p$,j5 as p0,z1e as p1,w2t as p2,mWe as p3,Cl as p4,uke as p5,uu as p6,kEt as p7,VEt as p8,zEt as p9,$V as pA,Ef as pB,Nee as pC,n2 as pD,_o as pE,ln as pF,mk as pG,Sxt as pH,Txt as pI,lt as pJ,ZK as pK,xH as pL,yZe as pM,lOt as pN,_W as pO,UTt as pP,S2t as pQ,nN as pR,tge as pS,oTt as pT,XK as pU,Xf as pV,A5 as pW,cW as pX,wh as pY,sp as pZ,uS as p_,e6e as pa,i2 as pb,XWe as pc,mS as pd,uIe as pe,Kc as pf,NZe as pg,JB as ph,QX as pi,u7e as pj,qFe as pk,jFe as pl,sg as pm,vH as pn,e7e as po,mxt as pp,ho as pq,R2t as pr,cge as ps,yS as pt,y_ as pu,cc as pv,IFe as pw,C2t as px,A2t as py,Ub as pz,Qdt as q,EY as q$,_F as q0,D1e as q1,W1e as q2,tt as q3,XX as q4,Dd as q5,XTt as q6,yW as q7,yse as q8,bCt as q9,H2 as qA,Gge as qB,V6e as qC,Pg as qD,I5 as qE,d7e as qF,b2t as qG,Uee as qH,xCt as qI,iR as qJ,yw as qK,pi as qL,M2t as qM,$2 as qN,J5e as qO,wf as qP,cAe as qQ,Nx as qR,Avt as qS,Yfe as qT,Iue as qU,ZAe as qV,Gxt as qW,EGe as qX,m6t as qY,g6t as qZ,z4t as q_,vO as qa,Ufe as qb,ubt as qc,lFt as qd,l_ as qe,E2t as qf,JF as qg,eN as qh,TQe as qi,j4t as qj,aOt as qk,eS as ql,q4t as qm,H4t as qn,aR as qo,_n as qp,nTt as qq,WK as qr,Gp as qs,mO as qt,bW as qu,q2 as qv,VTt as qw,Bje as qx,wW as qy,Fme as qz,ept as r,G4 as r$,u6t as r0,o6t as r1,a6t as r2,s6t as r3,l$ as r4,Z1e as r5,gdt as r6,Ubt as r7,HFe as r8,MDt as r9,UMt as rA,_6t as rB,y6t as rC,Z2 as rD,g6e as rE,hg as rF,VZ as rG,LF as rH,Xr as rI,WDt as rJ,lxt as rK,JFt as rL,EH as rM,kwt as rN,TO as rO,rO as rP,fOt as rQ,d_e as rR,qht as rS,DDt as rT,X0 as rU,o6e as rV,Zbt as rW,ree as rX,KFt as rY,uQ as rZ,gat as r_,f6t as ra,Vbt as rb,CFe as rc,wae as rd,S2 as re,gCt as rf,X2 as rg,DFe as rh,Rs as ri,F2e as rj,zbt as rk,ib as rl,p6t as rm,kS as rn,d6t as ro,qt as rp,Gwe as rq,jwe as rr,dOt as rs,h6t as rt,r6t as ru,jxe as rv,VTe as rw,ade as rx,Hge as ry,gL as rz,AEe as s,eye as s$,Xt as s0,HAe as s1,Tbe as s2,Sbe as s3,Pxt as s4,Xit as s5,ZE as s6,f5 as s7,gR as s8,m5 as s9,oZ as sA,Ps as sB,Pot as sC,Une as sD,vG as sE,Xh as sF,h4 as sG,sLt as sH,d4 as sI,tc as sJ,rc as sK,xG as sL,bG as sM,TG as sN,wG as sO,Vne as sP,Cge as sQ,x0e as sR,J4 as sS,mW as sT,$D as sU,aVe as sV,_0e as sW,Ng as sX,O5 as sY,fA as sZ,M5 as s_,fR as sa,iAe as sb,O4e as sc,EFt as sd,uot as se,IYe as sf,MYe as sg,SOt as sh,TOt as si,Mg as sj,JOt as sk,zn as sl,Do as sm,iIt as sn,EZ as so,zo as sp,Ywt as sq,qc as sr,Y$ as ss,oOt as st,Ek as su,eOt as sv,iYe as sw,p5 as sx,pw as sy,hot as sz,SEe as t,Bf as t$,P2t as t0,mVe as t1,$9e as t2,hZe as t3,aTt as t4,Ewt as t5,SLt as t6,sTt as t7,Cvt as t8,nOt as t9,wJe as tA,KPt as tB,Hwe as tC,O4 as tD,Qwt as tE,Id as tF,s3e as tG,qA as tH,M$e as tI,tF as tJ,RD as tK,Z4 as tL,sMe as tM,iMe as tN,Axt as tO,uRe as tP,YIt as tQ,nLt as tR,eTe as tS,G1 as tT,zne as tU,ZIt as tV,QIt as tW,B1 as tX,WIt as tY,i9 as tZ,_L as t_,ic as ta,zwt as tb,e_t as tc,OKe as td,Uc as te,_r as tf,nn as tg,Us as th,Ct as ti,wi as tj,Io as tk,GX as tl,Nf as tm,CAt as tn,At as to,St as tp,Ze as tq,H5t as tr,VOt as ts,nE as tt,kY as tu,Z0t as tv,Y0t as tw,r6 as tx,l3e as ty,QPt as tz,x_e as u,Qxt as u$,xl as u0,xh as u1,gwe as u2,Ku as u3,Xat as u4,Zat as u5,J3 as u6,A_t as u7,hLe as u8,k4e as u9,YZ as uA,Wit as uB,JZ as uC,t2e as uD,QZ as uE,r2e as uF,krt as uG,eG as uH,_1t as uI,v1t as uJ,b1t as uK,mtt as uL,Jxt as uM,Eoe as uN,boe as uO,$Ie as uP,woe as uQ,Foe as uR,xoe as uS,cTt as uT,Ooe as uU,Hoe as uV,qoe as uW,Woe as uX,tTt as uY,vq as uZ,Qde as u_,ZOt as ua,HOt as ub,O5e as uc,J5t as ud,dk as ue,o8 as uf,a8 as ug,vwt as uh,bwt as ui,NOt as uj,svt as uk,m_ as ul,tFt as um,Zde as un,Vhe as uo,kSe as up,Sut as uq,USe as ur,Uut as us,Qv as ut,bY as uu,vY as uv,ioe as uw,wut as ux,noe as uy,jet as uz,bze as v,cO as v$,qIe as v0,FIe as v1,Kxt as v2,Xoe as v3,iTt as v4,QTt as v5,NPt as v6,WPt as v7,Noe as v8,zoe as v9,yTe as vA,FPt as vB,qnt as vC,Xet as vD,Pq as vE,p_ as vF,CC as vG,s4e as vH,i4e as vI,r4e as vJ,ZLe as vK,AC as vL,Uxt as vM,a4e as vN,T5t as vO,N2t as vP,l8e as vQ,a8e as vR,Bq as vS,qL as vT,YPt as vU,I4 as vV,l4e as vW,Hgt as vX,POe as vY,GD as vZ,HD as v_,GPt as va,BPt as vb,Bnt as vc,jPt as vd,HPt as ve,tse as vf,ise as vg,rse as vh,zPt as vi,kPt as vj,goe as vk,aoe as vl,loe as vm,coe as vn,Roe as vo,rae as vp,nae as vq,yoe as vr,iae as vs,h5 as vt,_Te as vu,qPt as vv,qet as vw,Wet as vx,UPt as vy,VPt as vz,i_e as w,JLe as w0,Rwt as w1,ETt as w2,m4e as w3,g4e as w4,RK as w5,tMt as w6,JPt as w7,Hq as w8,U0t as w9,wFt as wA,NFt as wB,b6t as wC,W4t as wa,U2t as wb,e6 as wc,Ext as wd,xxt as we,wxt as wf,Y4 as wg,eQe as wh,Zot as wi,r_ as wj,Ybe as wk,T0e as wl,XC as wm,s2 as wn,UV as wo,Wa as wp,M2 as wq,wH as wr,_St as ws,Ytt as wt,Xb as wu,y2t as wv,cOt as ww,eRt as wx,NMt as wy,G5t as wz,Yze as x,yA as y,rpt as z};
