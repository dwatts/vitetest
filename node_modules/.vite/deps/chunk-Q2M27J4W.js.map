{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/graphics/data/StreamFeatureManager.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport t from\"../../../core/CircularArray.js\";import{clamp as e}from\"../../../core/mathUtils.js\";const s=\"__esri_stream_id__\",i=\"__esri_timestamp__\",r=1e3;class o{constructor(t,e,i,r,o=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=i,this._purgeOptions=r,this.store=t,this.objectIdField=e,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===s}removeById(t){this._removed.push(t)}removeByTrackId(t){const e=this._trackIdToObservations.get(t);if(e)for(const s of e.entries)this._removed.push(s)}add(s){if(this._useGeneratedIds){const t=this._nextId();s.attributes[this.objectIdField]=t,s.objectId=t}else s.objectId=s.attributes[this.objectIdField];const i=s.objectId;if(this._addOrUpdated.set(i,s),this._maxAge=Math.max(this._maxAge,s.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return null==this._trackIdLessObservations&&(this._trackIdLessObservations=new t(1e5)),void this._trackIdLessObservations.enqueue(i);const o=s.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(o)){const s=null!=this._purgeOptions&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:r,i=e(s,0,r);this._trackIdToObservations.set(o,new t(i))}const d=this._trackIdToObservations.get(o),a=d?.enqueue(i);null!=a&&(this._addOrUpdated.has(a)?this._addOrUpdated.delete(a):this._removed.push(a))}checkForUpdates(){const t=this._getToAdd(),e=this._getToRemove(),s=performance.now();s-this._lastPurge>=this.purgeInterval&&(this._purge(s),this._lastPurge=s);const r=[];if(null!=e)for(const i of e){const t=this.store.removeById(i);null!=t&&r.push(t)}const o=[];if(null!=t){const r=new Set(e??[]);for(const e of t)r.has(e.objectId)||(e.attributes[i]=s,this.store.add(e),o.push(e))}(o.length||r?.length)&&this.store.update(o,r)}_getToAdd(){if(!this._addOrUpdated.size)return null;const t=new Array(this._addOrUpdated.size);let e=0;return this._addOrUpdated.forEach((s=>t[e++]=s)),this._addOrUpdated.clear(),t}_getToRemove(){const t=this._removed;return this._removed.length?(this._removed=[],t):null}_nextId(){const t=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,t}_purge(t){const e=this._purgeOptions;null!=e&&(this._purgeSomeByDisplayCount(e),this._purgeByAge(e),this._purgeByAgeReceived(t,e),this._purgeTracks())}_purgeSomeByDisplayCount(t){if(!t.displayCount)return;let e=this.store.size;if(e>t.displayCount){if(this._timeInfo.trackIdField)for(const s of this._trackIdToObservations.values())if(e>t.displayCount&&s.size){const t=s.dequeue();this._removed.push(t),e--}if(null!=this._trackIdLessObservations){let s=e-t.displayCount;for(;s-- >0;){const t=this._trackIdLessObservations.dequeue();null!=t&&this._removed.push(t)}}}}_purgeByAge(t){const e=this._timeInfo?.startTimeField;if(!t.age||!e)return;const s=60*t.age*1e3,i=this._maxAge-s;this.store.forEach((t=>{t.attributes[e]<i&&this._removed.push(t.objectId)}))}_purgeByAgeReceived(t,e){if(!e.ageReceived)return;const s=t-60*e.ageReceived*1e3;this.store.forEach((t=>{t.attributes[i]<s&&this._removed.push(t.objectId)}))}_purgeTracks(){this._trackIdToObservations.forEach(((t,e)=>{0===t.size&&this._trackIdToObservations.delete(e)}))}}export{s as DEFAULT_STREAM_ID_FIELD,i as ESRI_TIMESTAMP,o as StreamFeatureManager};\n"],
  "mappings": "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",
  "names": ["i", "t", "r", "o", "s", "e"]
}
