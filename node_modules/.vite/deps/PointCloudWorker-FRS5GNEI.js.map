{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/PointCloudWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/arrayUtils.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{c as e}from\"../../../chunks/quat.js\";import{c as a}from\"../../../chunks/quatf32.js\";import{q as o}from\"../../../chunks/vec3.js\";import{f as n,c as f}from\"../../../chunks/vec3f32.js\";import{projectBuffer as i}from\"../../../geometry/projection.js\";import s from\"../../../geometry/SpatialReference.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as b,filterInPlace as m}from\"./i3s/PointCloudWorkerUtil.js\";class c{transform(t){const e=this._transform(t),a=[e.points.buffer,e.rgb.buffer];null!=e.pointIdFilterMap&&a.push(e.pointIdFilterMap.buffer);for(const o of e.attributes)\"buffer\"in o.values&&r(o.values.buffer)&&o.values.buffer!==e.rgb.buffer&&a.push(o.values.buffer);return Promise.resolve({result:e,transferList:a})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const n=new Array,f=l(r.primaryAttributeData,e,a);null!=r.primaryAttributeData&&f&&n.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:f});const i=l(r.modulationAttributeData,e,a);null!=r.modulationAttributeData&&i&&n.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:i});let c=b(r.rendererInfo,f,i,a);if(r.filterInfo&&r.filterInfo.length>0&&null!=r.filterAttributesData){const f=r.filterAttributesData.filter(t).map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return n.push(o),o}));o=new Uint32Array(a),a=m(e,c,o,r.filterInfo,f)}for(const t of r.userAttributesData){const r=l(t,e,a);n.push({attributeInfo:t.attributeInfo,values:r})}3*a<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const p=this._transformCoordinates(e,a,r.obb,s.fromJSON(r.inSR),s.fromJSON(r.outSR));return{obb:r.obb,points:p,rgb:c,attributes:n,pointIdFilterMap:o}}_transformCoordinates(t,r,a,s,u){if(!i(t,s,0,t,u,0,r))throw new Error(\"Can't reproject\");const l=n(a.center[0],a.center[1],a.center[2]),b=f(),m=f();e(p,a.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],o(m,b,p),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),c[3*e]=b[0],c[3*e+1]=b[1],c[3*e+2]=b[2];return c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const p=a();function h(){return new c}export{h as default};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIqiB,IAAMA,KAAN,MAAO;AAAA,EAAC,UAAU,GAAE;AAAC,UAAMC,KAAE,KAAK,WAAW,CAAC,GAAE,IAAE,CAACA,GAAE,OAAO,QAAOA,GAAE,IAAI,MAAM;AAAE,YAAMA,GAAE,oBAAkB,EAAE,KAAKA,GAAE,iBAAiB,MAAM;AAAE,eAAU,KAAKA,GAAE;AAAW,kBAAW,EAAE,UAAQ,EAAE,EAAE,OAAO,MAAM,KAAG,EAAE,OAAO,WAASA,GAAE,IAAI,UAAQ,EAAE,KAAK,EAAE,OAAO,MAAM;AAAE,WAAO,QAAQ,QAAQ,EAAC,QAAOA,IAAE,cAAa,EAAC,CAAC;AAAA,EAAC;AAAA,EAAC,WAAWC,IAAE;AAAC,UAAMD,KAAE,EAAEC,GAAE,QAAOA,GAAE,cAAc;AAAE,QAAI,IAAED,GAAE,SAAO,GAAE,IAAE;AAAK,UAAME,KAAE,IAAI,SAAMC,KAAE,EAAEF,GAAE,sBAAqBD,IAAE,CAAC;AAAE,YAAMC,GAAE,wBAAsBE,MAAGD,GAAE,KAAK,EAAC,eAAcD,GAAE,qBAAqB,eAAc,QAAOE,GAAC,CAAC;AAAE,UAAMC,KAAE,EAAEH,GAAE,yBAAwBD,IAAE,CAAC;AAAE,YAAMC,GAAE,2BAAyBG,MAAGF,GAAE,KAAK,EAAC,eAAcD,GAAE,wBAAwB,eAAc,QAAOG,GAAC,CAAC;AAAE,QAAIL,KAAE,EAAEE,GAAE,cAAaE,IAAEC,IAAE,CAAC;AAAE,QAAGH,GAAE,cAAYA,GAAE,WAAW,SAAO,KAAG,QAAMA,GAAE,sBAAqB;AAAC,YAAME,KAAEF,GAAE,qBAAqB,OAAO,CAAC,EAAE,IAAK,OAAG;AAAC,cAAMA,KAAE,EAAE,GAAED,IAAE,CAAC,GAAEK,KAAE,EAAC,eAAc,EAAE,eAAc,QAAOJ,GAAC;AAAE,eAAOC,GAAE,KAAKG,EAAC,GAAEA;AAAA,MAAC,CAAE;AAAE,UAAE,IAAI,YAAY,CAAC,GAAE,IAAEF,GAAEH,IAAED,IAAE,GAAEE,GAAE,YAAWE,EAAC;AAAA,IAAC;AAAC,eAAU,KAAKF,GAAE,oBAAmB;AAAC,YAAMA,KAAE,EAAE,GAAED,IAAE,CAAC;AAAE,MAAAE,GAAE,KAAK,EAAC,eAAc,EAAE,eAAc,QAAOD,GAAC,CAAC;AAAA,IAAC;AAAC,QAAE,IAAEF,GAAE,WAASA,KAAE,IAAI,WAAWA,GAAE,OAAO,MAAM,GAAE,IAAE,CAAC,CAAC,IAAG,KAAK,6BAA6BC,IAAE,GAAEC,GAAE,eAAe;AAAE,UAAMK,KAAE,KAAK,sBAAsBN,IAAE,GAAEC,GAAE,KAAI,EAAE,SAASA,GAAE,IAAI,GAAE,EAAE,SAASA,GAAE,KAAK,CAAC;AAAE,WAAM,EAAC,KAAIA,GAAE,KAAI,QAAOK,IAAE,KAAIP,IAAE,YAAWG,IAAE,kBAAiB,EAAC;AAAA,EAAC;AAAA,EAAC,sBAAsB,GAAED,IAAE,GAAE,GAAEM,IAAE;AAAC,QAAG,CAAC,GAAE,GAAE,GAAE,GAAE,GAAEA,IAAE,GAAEN,EAAC;AAAE,YAAM,IAAI,MAAM,iBAAiB;AAAE,UAAM,IAAE,EAAE,EAAE,OAAO,CAAC,GAAE,EAAE,OAAO,CAAC,GAAE,EAAE,OAAO,CAAC,CAAC,GAAE,IAAEC,GAAE,GAAE,IAAEA,GAAE;AAAE,MAAE,GAAE,EAAE,UAAU;AAAE,UAAMH,KAAE,IAAI,aAAa,IAAEE,EAAC;AAAE,aAAQD,KAAE,GAAEA,KAAEC,IAAED;AAAI,QAAE,CAAC,IAAE,EAAE,IAAEA,EAAC,IAAE,EAAE,CAAC,GAAE,EAAE,CAAC,IAAE,EAAE,IAAEA,KAAE,CAAC,IAAE,EAAE,CAAC,GAAE,EAAE,CAAC,IAAE,EAAE,IAAEA,KAAE,CAAC,IAAE,EAAE,CAAC,GAAE,EAAE,GAAE,GAAE,CAAC,GAAE,EAAE,SAAS,CAAC,IAAE,KAAK,IAAI,EAAE,SAAS,CAAC,GAAE,KAAK,IAAI,EAAE,CAAC,CAAC,CAAC,GAAE,EAAE,SAAS,CAAC,IAAE,KAAK,IAAI,EAAE,SAAS,CAAC,GAAE,KAAK,IAAI,EAAE,CAAC,CAAC,CAAC,GAAE,EAAE,SAAS,CAAC,IAAE,KAAK,IAAI,EAAE,SAAS,CAAC,GAAE,KAAK,IAAI,EAAE,CAAC,CAAC,CAAC,GAAED,GAAE,IAAEC,EAAC,IAAE,EAAE,CAAC,GAAED,GAAE,IAAEC,KAAE,CAAC,IAAE,EAAE,CAAC,GAAED,GAAE,IAAEC,KAAE,CAAC,IAAE,EAAE,CAAC;AAAE,WAAOD;AAAA,EAAC;AAAA,EAAC,6BAA6B,GAAEE,IAAED,IAAE;AAAC,QAAG,MAAIA;AAAE,eAAQ,IAAE,GAAE,IAAEC,IAAE;AAAI,UAAE,IAAE,IAAE,CAAC,KAAGD;AAAA,EAAC;AAAC;AAAC,IAAM,IAAE,EAAE;AAAE,SAAS,IAAG;AAAC,SAAO,IAAID;AAAC;",
  "names": ["c", "e", "r", "n", "f", "i", "o", "p", "u"]
}
