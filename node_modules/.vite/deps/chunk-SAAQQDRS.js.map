{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationAlignment.js", "../../@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationFilter.js", "../../@arcgis/core/views/interactive/snapping/featureSources/symbologySnappingCandidates.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{getOrCreateMapValue as t}from\"../../../../core/MapUtils.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{getMetersPerVerticalUnitForSR as n}from\"../../../../core/unitUtils.js\";import{getMetersPerUnit as o}from\"../../../../symbols/support/unitConversionUtils.js\";function i(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:s,spatialReference:n}=t;return new c(e,s,n)}return new a}class a{async alignCandidates(e,t){return e}notifyElevationSourceChange(){}}const r=1024;class c{constructor(t,s,o){this._elevationInfo=t,this._alignPointsInFeatures=s,this.spatialReference=o,this._alignmentsCache=new e(r),this._cacheVersion=0,this._metersPerVerticalUnit=n(o)}async alignCandidates(e,t){const s=this._elevationInfo;return null==s||\"absolute-height\"!==s.mode||s.featureExpressionInfo?this._alignComputedElevationCandidates(e,t):(this._alignAbsoluteElevationCandidates(e,s),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}_alignAbsoluteElevationCandidates(e,t){const{offset:s,unit:n}=t;if(null==s)return;const i=s*(o(n??\"meters\")/this._metersPerVerticalUnit);for(const o of e)switch(o.type){case\"edge\":o.start.z+=i,o.end.z+=i;continue;case\"vertex\":o.target.z+=i;continue}}async _alignComputedElevationCandidates(e,n){const o=new Map;for(const s of e)t(o,s.objectId,d).push(s);const[i,a,r]=this._prepareQuery(o),c=await this._alignPointsInFeatures(i,n);s(n);if(r!==this._cacheVersion)return this._alignComputedElevationCandidates(e,n);this._applyCacheAndResponse(i,c,a);const{drapedObjectIds:l,failedObjectIds:h}=c,u=[];for(const t of e){const{objectId:e}=t;l.has(e)&&\"edge\"===t.type&&(t.draped=!0),h.has(e)||u.push(t)}return u}_prepareQuery(e){const t=[],s=[];for(const[n,o]of e){const e=[];for(const t of o)this._addToQueriesOrCachedResult(n,t.target,e,s),\"edge\"===t.type&&(this._addToQueriesOrCachedResult(n,t.start,e,s),this._addToQueriesOrCachedResult(n,t.end,e,s));0!==e.length&&t.push({objectId:n,points:e})}return[t,s,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,s,n){const o=h(e,t),i=this._alignmentsCache.get(o);null==i?s.push(t):n.push(new l(t,i))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:s,failedObjectIds:n},o){for(const r of o)r.apply();let i=0;const a=this._alignmentsCache;for(const{objectId:r,points:c}of e){if(n.has(r)){i+=c.length;continue}const e=!s.has(r);for(const s of c){const n=h(r,s),o=t[i++];s.z=o,e&&a.put(n,o,1)}}}}class l{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function h(e,{x:t,y:s,z:n}){return`${e}-${t}-${s}-${n??0}}`}function d(){return[]}export{i as getSnappingCandidateElevationAligner};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";class t{filter(t,n){return n}notifyElevationSourceChange(){}}class n{filter(t,n){const{point:r,distance:c}=t,{z:i}=r;if(!(null!=i))return n;if(0===n.length)return n;const o=s(c),u=this._updateCandidatesTo3D(n,r,o).filter(e);return u.sort(a),u}_updateCandidatesTo3D(t,n,e){for(const r of t)switch(r.type){case\"edge\":c(r,n,e);continue;case\"vertex\":o(r,n,e);continue}return t}}function e(t){return t.distance<=1}function r(e=!1){return e?new n:new t}function c(t,n,{x:e,y:r,z:c}){const{start:o,end:s,target:a}=t;t.draped||i(a,n,o,s);const u=(n.x-a.x)/e,d=(n.y-a.y)/r,f=(n.z-a.z)/c;t.distance=Math.sqrt(u*u+d*d+f*f)}function i(t,n,e,r){const c=r.x-e.x,i=r.y-e.y,o=r.z-e.z,s=c*c+i*i+o*o,a=(n.x-e.x)*c+(n.y-e.y)*i+o*(n.z-e.z),u=Math.min(1,Math.max(0,a/s)),d=e.x+c*u,f=e.y+i*u,x=e.z+o*u;t.x=d,t.y=f,t.z=x}function o(t,n,{x:e,y:r,z:c}){const{target:i}=t,o=(n.x-i.x)/e,s=(n.y-i.y)/r,a=(n.z-i.z)/c,u=Math.sqrt(o*o+s*s+a*a);t.distance=u}function s(t){return\"number\"==typeof t?{x:t,y:t,z:t}:t}function a(t,n){return t.distance-n.distance}export{r as getSnappingCandidateElevationFilter};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{clone as t}from\"../../../../core/lang.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{numericHash as o}from\"../../../../core/string.js\";function n(t=!1,e){return t?new i(e):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}const r=1024;class i{constructor(t){this._getSymbologyCandidates=t,this._candidatesCache=new e(r),this._cacheVersion=0}async fetch(e,o){if(0===e.length)return[];const n=[],c=[],r=this._candidatesCache;for(const s of e){const e=a(s),o=r.get(e);if(o)for(const s of o)c.push(t(s));else n.push(s),r.put(e,[],1)}if(0===n.length)return c;const i=this._cacheVersion,{candidates:h,sourceCandidateIndices:d}=await this._getSymbologyCandidates(n,o);s(o);if(i!==this._cacheVersion)return this.fetch(e,o);const f=[],{length:g}=h;for(let s=0;s<g;++s){const e=h[s],o=a(n[d[s]]),c=r.get(o);c.push(e),r.put(o,c,c.length),f.push(t(e))}return c.concat(f)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function a(t){switch(t.type){case\"vertex\":{const{objectId:e,target:s}=t,n=`${e}-vertex-${s.x}-${s.y}-${s.z??0}`;return o(n).toString()}case\"edge\":{const{objectId:e,start:s,end:n}=t,c=`${e}-edge-${s.x}-${s.y}-${s.z??0}-to-${n.x}-${n.y}-${n.z??0}`;return o(c).toString()}default:return\"\"}}export{n as getSymbologySnappingCandidatesFetcher};\n"],
  "mappings": "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",
  "names": ["e", "t", "s", "n", "c", "a", "r", "o", "i", "l", "h", "t", "n", "r", "c", "i", "o", "s", "e", "a", "d", "n", "t", "e", "i", "c", "r", "o", "s", "a", "h", "d"]
}
