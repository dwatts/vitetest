{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/FeatureCollectionSnappingSource.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import{throwIfAborted as i,whenOrAbort as n}from\"../../../../core/promiseUtils.js\";import{watch as r,initial as o,on as a}from\"../../../../core/reactiveUtils.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import{subclass as p}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{elevationContextAffectsAlignment as l}from\"../../../../support/elevationInfoUtils.js\";import{makeFilter as y,makeSnappingQuery as c}from\"../snappingUtils.js\";import{convertSnappingCandidate as u,makeGetGroundElevation as g}from\"./queryEngineUtils.js\";import{getSnappingCandidateElevationAligner as h}from\"./snappingCandidateElevationAlignment.js\";import{getSnappingCandidateElevationFilter as m}from\"./snappingCandidateElevationFilter.js\";import{getSymbologySnappingCandidatesFetcher as d}from\"./symbologySnappingCandidates.js\";let v=class extends t{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,i=null!=e&&\"3d\"===e.type;if(!i||\"subtype-group\"===t.type)return h();const r=async(i,r)=>(await n(e.whenLayerView(t),r)).elevationAlignPointsInFeatures(i,r);return h(i,{elevationInfo:t.elevationInfo,alignPointsInFeatures:r,spatialReference:e.spatialReference})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&\"3d\"===e.type&&\"subtype-group\"!==this.layerSource.layer.type;return m(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type?d(this._symbologySnappingSupported,(async(n,r)=>{const o=await e.whenLayerView(t);return i(r),o.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},r)})):d()}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&\"3d\"===e.type&&\"subtype-group\"!==t.type&&(e.whenLayerView(t).then((e=>this._layerView3D=e)),this.addHandles([e.elevationProvider.on(\"elevation-change\",(({context:e})=>{const{elevationInfo:i}=t;l(e,i)&&this._snappingElevationAligner.notifyElevationSourceChange()})),r((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),o),r((()=>null!=this._layerView3D?this._layerView3D.processor?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),o),a((()=>this._layerView3D?.layer),[\"edits\",\"apply-edits\",\"graphic-update\"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))]))}constructor(e){super(e),this.view=null,this._layerView3D=null}refresh(){}async fetchCandidates(e,t){const{layer:n}=this.layerSource,r=n.source;if(!r?.querySnapping)return[];const o=y(n),a=c(e,this.view?.type??\"2d\",o),s=await r.querySnapping(a,{signal:t});i(t);const p=await this._snappingElevationAligner.alignCandidates(s.candidates,t);i(t);const l=await this._symbologySnappingFetcher.fetch(p,t);i(t);const g=0===l.length?p:[...p,...l],h=this._snappingElevationFilter.filter(a,g),m=this._getGroundElevation;return h.map((e=>u(e,m)))}get _getGroundElevation(){return g(this.view)}};e([s({constructOnly:!0})],v.prototype,\"layerSource\",void 0),e([s({constructOnly:!0})],v.prototype,\"view\",void 0),e([s()],v.prototype,\"_snappingElevationAligner\",null),e([s()],v.prototype,\"_snappingElevationFilter\",null),e([s()],v.prototype,\"_symbologySnappingFetcher\",null),e([s()],v.prototype,\"_layerView3D\",void 0),e([s()],v.prototype,\"_symbologySnappingSupported\",null),e([s()],v.prototype,\"_getGroundElevation\",null),v=e([p(\"esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource\")],v);export{v as FeatureCollectionSnappingSource};\n"],
  "mappings": "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",
  "names": ["e", "i", "r", "n", "o", "m", "a", "l", "s", "p", "h"]
}
