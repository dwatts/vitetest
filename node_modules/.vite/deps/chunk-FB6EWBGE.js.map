{
  "version": 3,
  "sources": ["../../@arcgis/core/views/webgl/BufferObject.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{isArrayLike as e}from\"../../core/arrayUtils.js\";import t from\"../../core/Logger.js\";import{nullifyNonNullableForDispose as r}from\"../../core/maybe.js\";import{isUint16Array as i,isUint32Array as s}from\"../../core/typedArrayUtil.js\";import{checkWebGLError as n}from\"./checkWebGLError.js\";import{ContextType as o}from\"./contextUtils.js\";import{BufferType as a,Usage as f,ResourceType as u,DataType as _}from\"./enums.js\";const h=t.getLogger(\"esri.views.webgl.BufferObject\");class c{static createIndex(e,t,r){return new c(e,a.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new c(e,a.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){if(e.type!==o.WEBGL2)throw new Error(\"Uniform buffers are supported in WebGL2 only!\");return new c(e,a.UNIFORM_BUFFER,t,r)}static createPixelPack(e,t=f.STREAM_READ,r){if(e.type!==o.WEBGL2)throw new Error(\"Pixel pack buffers are supported in WebGL2 only!\");const i=new c(e,a.PIXEL_PACK_BUFFER,t);return r&&i.setSize(r),i}static createPixelUnpack(e,t=f.STREAM_DRAW,r){if(e.type!==o.WEBGL2)throw new Error(\"Pixel unpack buffers are supported in WebGL2 only!\");return new c(e,a.PIXEL_UNPACK_BUFFER,t,r)}constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(u.BufferObject,this),this._glName=this._context.gl.createBuffer(),n(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===a.ELEMENT_ARRAY_BUFFER?this._indexType===_.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===a.ELEMENT_ARRAY_BUFFER||this.bufferType===a.ARRAY_BUFFER}dispose(){if(this._context?.gl){if(this._glName){this._context.gl.deleteBuffer(this._glName),this._glName=null}this._context.instanceCounter.decrement(u.BufferObject,this),this._context=r(this._context)}else this._glName&&h.warn(\"Leaked WebGL buffer object\")}setSize(e,t=null){if(e<=0&&h.error(\"Buffer size needs to be positive!\"),this.bufferType===a.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case _.UNSIGNED_SHORT:e*=2;break;case _.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.ELEMENT_ARRAY_BUFFER&&(i(e)&&(t/=2,this._indexType=_.UNSIGNED_SHORT),s(e)&&(t/=4,this._indexType=_.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),n(i),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,i){if(!e)return;(t<0||t*e.BYTES_PER_ELEMENT>=this.byteLength)&&h.error(\"offset is out of range!\"),r>=i&&h.error(\"end must be bigger than start!\"),(t+(i-r))*e.BYTES_PER_ELEMENT>this.byteLength&&h.error(\"An attempt to write beyond the end of the buffer!\");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const a=this._context.gl;if(this._context.type===o.WEBGL2)a.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r);else{const s=0===r&&i===e.length?e:e.subarray(r,i);a.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,s)}n(a),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,t=0,r,i){if(this._context.type!==o.WEBGL2)return void h.error(\"Get buffer subdata is supported in WebGL2 only!\");if(r<0||i<0)return void h.error(\"Problem getting subdata: offset and length were less than zero!\");const s=E(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(i??0))>e.byteLength)return void h.error(\"Problem getting subdata: offset and length exceeded destination size!\");t+s*(i??0)>this.byteLength&&h.warn(\"Potential problem getting subdata: requested data exceeds buffer size!\");const n=this._context.gl;this._context.bindBuffer(this,a.COPY_READ_BUFFER),n.getBufferSubData(a.COPY_READ_BUFFER,t,e,r,i),this._context.unbindBuffer(a.COPY_READ_BUFFER)}async getSubDataAsync(e,t=0,r,i){this._context.type===o.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)):h.error(\"Get buffer subdata is supported in WebGL2 only!\")}}function E(t){return e(t)}export{c as BufferObject};\n"],
  "mappings": "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",
  "names": ["c", "i", "s", "a", "n"]
}
