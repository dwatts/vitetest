{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/renderPasses/AllRenderPasses.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{c as t}from\"../../../../../chunks/vec3f64.js\";import{ShaderOutput as s}from\"../shaderLibrary/ShaderOutput.js\";import{VertexNormalPassParameters as i,VertexNormalDrawParameters as r}from\"../shaderLibrary/attributes/VertexNormal.glsl.js\";class e extends i{constructor(){super(...arguments),this.slicePlaneLocalOrigin=t(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}}class a extends r{}var o;!function(t){t[t.Material=0]=\"Material\",t[t.ShadowMap=1]=\"ShadowMap\",t[t.Highlight=2]=\"Highlight\"}(o||(o={}));class n extends e{constructor(){super(...arguments),this.identifier=o.Material,this.output=s.Color,this.transparent=!1,this.integratedMesh=!1}}class h extends e{constructor(){super(...arguments),this.identifier=o.ShadowMap}}class l extends e{constructor(){super(...arguments),this.identifier=o.Highlight}}export{a as DrawParameters,l as HighlightPassParameters,n as MaterialPassParameters,e as PassParameters,o as RenderPassIdentifier,h as ShadowMapPassParameters};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{c as e}from\"../../../../../../chunks/vec4f64.js\";import{area as o,width as r,height as t}from\"../../../../../../geometry/support/aaBoundingRect.js\";import{OverlayIndex as a,RenderTargetType as i}from\"../../../../terrain/interfaces.js\";import{OverlaySource as l}from\"../../../../terrain/Overlay.js\";import{RenderPassIdentifier as d}from\"../../renderPasses/AllRenderPasses.js\";import{ShaderOutput as s}from\"../ShaderOutput.js\";import{addMainLightDirection as n,addMainLightIntensity as c}from\"../shading/MainLighting.glsl.js\";import{PBRMode as v}from\"../shading/PhysicallyBasedRenderingParameters.glsl.js\";import{Water as x}from\"../shading/Water.glsl.js\";import{Float4DrawUniform as u}from\"../../shaderModules/Float4DrawUniform.js\";import{glsl as p}from\"../../shaderModules/interfaces.js\";import{Texture2DPassUniform as f}from\"../../shaderModules/Texture2DPassUniform.js\";var y;function m(e,o){const{vertex:r,fragment:t}=e;r.uniforms.add(new u(\"overlayTexOffset\",((e,o)=>h(e,o))),new u(\"overlayTexScale\",((e,o)=>b(e,o)))),t.constants.add(\"overlayOpacity\",\"float\",1),t.uniforms.add(new f(\"ovColorTex\",((e,o)=>g(e,o)))),C(e,o)}function C(e,o){o.pbrMode!==v.Water&&o.pbrMode!==v.WaterOnIntegratedMesh&&o.pbrMode!==v.TerrainWithWater||e.include(x,o);const{vertex:r,fragment:t}=e;e.varyings.add(\"vtcOverlay\",\"vec4\"),r.code.add(p`void setOverlayVTC(in vec2 uv) {\nvtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n}`),t.code.add(p`bool isValid(vec2 uv, vec2 dxdy) {\nreturn (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);\n}\nvec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {\nvec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));\nvec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}`),t.code.add(p`vec4 getCombinedOverlayColor() {\nreturn overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);\n}`),t.code.add(p`vec4 getOverlayColorTexel(vec4 texCoords) {\nvec2 texDim =  vec2(textureSize(ovColorTex, 0));\nvec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);\nvec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}`),o.pbrMode!==v.Water&&o.pbrMode!==v.WaterOnIntegratedMesh&&o.pbrMode!==v.TerrainWithWater||(n(t),c(t),t.code.add(p`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\nfloat shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {\nvec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\nvec3 v = vposEyeDir;\nvec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);\nreturn vec4(final, colorInput.w);\n}`))}function g(e,o){return 0===o.overlays.length?null:e.identifier===d.Material&&e.output===s.Color?o.overlays[a.INNER].getColorTextureNoRasterImage():e.identifier===d.Material&&e.output===s.ObjectAndLayerIdColor?o.overlays[a.INNER].getColorTexture(l.ObjectAndLayerIdColor):e.identifier===d.Highlight?o.overlays[a.INNER].getValidTexture(i.Highlight):null}function h(e,a){for(const i of a.overlays){const{index:a,extent:l}=i;o(l)>0&&(T[2*a]=e.toMapSpace[0]/r(l)-l[0]/r(l),T[2*a+1]=e.toMapSpace[1]/t(l)-l[1]/t(l))}return T}function b(e,a){for(const i of a.overlays){const{index:a,extent:l}=i;o(l)>0&&(T[2*a]=e.toMapSpace[2]/r(l),T[2*a+1]=e.toMapSpace[3]/t(l))}return T}!function(e){e[e.Disabled=0]=\"Disabled\",e[e.Enabled=1]=\"Enabled\",e[e.EnabledWithWater=2]=\"EnabledWithWater\",e[e.COUNT=3]=\"COUNT\"}(y||(y={}));const T=e();export{m as OverlayIM,y as OverlayMode,g as getColorTexture,C as overlay};\n"],
  "mappings": "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",
  "names": ["o", "t", "n", "h", "l", "e", "o", "t", "h", "s", "c", "n", "a", "l"]
}
