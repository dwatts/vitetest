{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js", "../../@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{A as s,i as o,a as r}from\"../../../../../chunks/vec3.js\";import{c,g as n}from\"../../../../../chunks/sphere.js\";const t=1e3;function a(t,a,e){const i=c(),m=n(i);return s(m,m,t,.5),s(m,m,a,.5),i[3]=o(m,t),r(m,m,e),i}export{t as MAX_CANDIDATE_COUNT,a as boundsFromEdge};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{throwIfAborted as t}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/has.js\";import\"../../../../../core/Error.js\";import{subclass as s}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{a as o,i as n}from\"../../../../../chunks/vec3.js\";import{c as i,a as r}from\"../../../../../chunks/vec3f64.js\";import{create as d,fromPoints as c,projectPoint as a}from\"../../../../../geometry/support/lineSegment.js\";import{g as p,l as u}from\"../../../../../chunks/sphere.js\";import h from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as m}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{MAX_CANDIDATE_COUNT as g,boundsFromEdge as l}from\"./sceneLayerSnappingUtils.js\";let _=class{constructor(){this._idToComponent=new Map,this._components=new h((e=>e.bounds)),this._edges=new h((e=>e.bounds)),this._tmpLineSegment=d(),this._tmpP1=i(),this._tmpP2=i(),this._tmpP3=i(),this.remoteClient=null}async fetchCandidates(e,s){await Promise.resolve(),t(s),await this._ensureEdgeLocations(e,s);const o=[];return this._edges.forEachNeighbor((t=>(this._addCandidates(e,t,o),o.length<g)),e.bounds),{result:{candidates:o}}}async _ensureEdgeLocations(e,t){const s=[];if(this._components.forEachNeighbor((e=>{if(null==e.info){const{id:t,uid:o}=e;s.push({id:t,uid:o})}return!0}),e.bounds),!s.length)return;const o={components:s},n=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",o,t??{});for(const i of n.components)this._setFetchEdgeLocations(i)}async add(e){const t=new b(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((s=>(s.component===t&&e.push(s),!0)),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const t=this._idToComponent.get(e.id);if(null==t||e.uid!==t.uid)return;const s=m.createView(e.locations),o=new Array(s.count),n=i(),r=i();for(let i=0;i<s.count;i++){s.position0.getVec(i,n),s.position1.getVec(i,r);const d=l(n,r,e.origin),c=new j(t,i,d);o[i]=c}this._edges.add(o);const{objectIds:d,origin:c}=e;t.info={locations:s,objectIds:d,origin:c}}_addCandidates(e,t,s){const{info:n}=t.component,{origin:i,objectIds:r}=n,d=n.locations,c=d.position0.getVec(t.index,this._tmpP1),a=d.position1.getVec(t.index,this._tmpP2);o(c,c,i),o(a,a,i);const p=r[d.componentIndex.get(t.index)];this._addEdgeCandidate(e,p,c,a,s),this._addVertexCandidate(e,p,c,s),this._addVertexCandidate(e,p,a,s)}_addEdgeCandidate(e,t,s,o,i){if(!e.returnEdge)return;const d=p(e.bounds),h=c(s,o,this._tmpLineSegment),m=a(h,d,this._tmpP3);u(e.bounds,m)&&i.push({type:\"edge\",objectId:t,target:r(m),distance:n(d,m),start:r(s),end:r(o)})}_addVertexCandidate(e,t,s,o){if(!e.returnVertex)return;const i=p(e.bounds);u(e.bounds,s)&&o.push({type:\"vertex\",objectId:t,target:r(s),distance:n(i,s)})}};_=e([s(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],_);const f=_;class b{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++b.uid}}b.uid=0;class j{constructor(e,t,s){this.component=e,this.index=t,this.bounds=s}}export{f as default};\n"],
  "mappings": "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",
  "names": ["t", "a", "e", "m", "_", "e", "s", "t", "o", "n", "b", "d", "a", "c", "j", "m"]
}
