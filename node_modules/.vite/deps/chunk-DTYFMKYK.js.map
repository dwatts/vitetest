{
  "version": 3,
  "sources": ["../../@arcgis/core/support/basemapUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport e from\"../Basemap.js\";import r from\"../config.js\";import n from\"../core/Collection.js\";import a from\"../core/Logger.js\";import{Url as t,makeAbsolute as l,normalize as i}from\"../core/urlUtils.js\";import{ensureType as s}from\"../core/accessorSupport/ensureType.js\";import{esriBasemapDefinitions as u}from\"./basemapDefinitions.js\";const c=a.getLogger(\"esri.support.basemapUtils\");function o(){return{}}function f(e){for(const r in e){const n=e[r];!1===n?.destroyed&&n.destroy(),delete e[r]}}function p(n,a){let t;if(\"string\"==typeof n){if(!(n in u)){const e=Object.entries(u).filter((([e,n])=>r.apiKey&&!n.classic||!r.apiKey&&n.classic&&!n.deprecated)).map((([e])=>`\"${e}\"`)).join(\", \");return c.warn(`Unable to find basemap definition for: ${n}. Try one of these: ${e}`),null}a&&(t=a[n]),t||(t=e.fromId(n),a&&(a[n]=t))}else t=s(e,n);return t?.destroyed&&(c.warn(\"The provided basemap is already destroyed\",{basemap:t}),t=null),t}function y(e){return\"Web Scene\"===e.portalItem?.type}function m(e,r){return e.basemap?.referenceLayers?.some((e=>e.uid===r))||e.basemap?.baseLayers?.some((e=>e.uid===r))}function d(e,r=null){const n=p(e);if(!n)return null;const a=n.clone();return r&&(a.baseLayers=g(a.baseLayers,r.baseLayers),a.referenceLayers=g(a.referenceLayers,r.referenceLayers)),a}let b;function L(e){if(b)return b(e);let r=null;const n=w(e),a=!n?.baseLayers.length;for(const t in u){const e=$(n,U(u[t]),{mustMatchReferences:a});if(\"equal\"===e){r=t;break}\"base-layers-equal\"===e&&(r=t)}return r}function S(e){b=e}function v(e,r){if(e===r)return!0;return\"equal\"===$(w(e),w(r),{mustMatchReferences:!0})}function g(e,r){const a=new n;return e.forEach((e=>{const n=r.find((r=>A(j(e),j(r))))||e;a.includes(n)?a.push(e):a.push(n)})),a}function h(e){return!!e?.baseLayers.concat(e.referenceLayers).some(R)}function R(e){if(q(e.url))return!0;if(\"vector-tile\"===e.type)for(const r in e.sourceNameToSource){const n=e.sourceNameToSource[r];if(q(n?.sourceUrl))return!0}return!1}function I(e,r){if(null==r||null==e)return{spatialReference:null,updating:!1};if(\"not-loaded\"===r.loadStatus)return r.load(),{spatialReference:null,updating:!0};if(r.spatialReference)return{spatialReference:r.spatialReference,updating:!1};if(0===r.baseLayers.length)return{spatialReference:null,updating:!1};const n=r.baseLayers.at(0);switch(n.loadStatus){case\"not-loaded\":n.load();case\"loading\":return{spatialReference:null,updating:!0};case\"failed\":return{spatialReference:null,updating:!1}}const a=((\"supportedSpatialReferences\"in n?n.supportedSpatialReferences:null)||[\"tileInfo\"in n?n.tileInfo?.spatialReference:n.spatialReference]).filter(Boolean),t=e.spatialReference;return t?{spatialReference:a.find((e=>t.equals(e)))??a[0]??null,updating:!1}:{spatialReference:a[0],updating:!1}}const T=/^(basemaps|ibasemaps).*-api\\.arcgis\\.com$/i;function q(e){if(!e)return!1;const r=new t(l(e));return!!r.authority&&T.test(r.authority)}function w(e){return e?!e.loaded&&e.resourceInfo?U(e.resourceInfo.data):{baseLayers:x(e.baseLayers),referenceLayers:x(e.referenceLayers)}:null}function x(e){return(n.isCollection(e)?e.toArray():e).map(j)}function j(e){return{type:e.type,url:B(\"urlTemplate\"in e&&e.urlTemplate||e.url||\"styleUrl\"in e&&e.styleUrl||\"\"),minScale:\"minScale\"in e&&null!=e.minScale?e.minScale:0,maxScale:\"maxScale\"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:\"map-image\"!==e.type&&\"wms\"!==e.type||null==e.sublayers?void 0:e.sublayers?.map((e=>({id:e.id,visible:e.visible}))),activeLayerId:\"wmts\"===e.type?e.activeLayer?.id:void 0}}function U(e){return e?{baseLayers:M((e.baseMapLayers??[]).filter((e=>!e.isReference))),referenceLayers:M((e.baseMapLayers??[]).filter((e=>e.isReference)))}:null}function M(e){return e.map((e=>k(e)))}function k(e){let r;switch(e.layerType){case\"VectorTileLayer\":r=\"vector-tile\";break;case\"ArcGISTiledMapServiceLayer\":r=\"tile\";break;default:r=\"unknown\"}return{type:r,url:B(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:null!=e.minScale?e.minScale:0,maxScale:null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function $(e,r,n){if(null!=e!=(null!=r))return\"not-equal\";if(!e||!r)return\"equal\";if(!C(e.baseLayers,r.baseLayers))return\"not-equal\";return C(e.referenceLayers,r.referenceLayers)?\"equal\":n.mustMatchReferences?\"not-equal\":\"base-layers-equal\"}function C(e,r){if(e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(!A(e[n],r[n]))return!1;return!0}function A(e,r){if(e.type!==r.type||\"scene\"===e.type||e.url!==r.url||e.minScale!==r.minScale||e.maxScale!==r.maxScale||e.visible!==r.visible||e.opacity!==r.opacity)return!1;if(null!=e.activeLayerId||null!=r.activeLayerId)return e.activeLayerId===r.activeLayerId;if(null!=e.sublayers||null!=r.sublayers){if(null==e.sublayers||null==r.sublayers||e.sublayers.length!==r.sublayers.length)return!1;for(let n=0;n<e.sublayers.length;n++){const a=e.sublayers.at(n),t=r.sublayers.at(n);if(a?.id!==t?.id||a?.visible!==t?.visible)return!1}}return!0}function B(e){return e?i(e).replace(/^\\s*https?:/i,\"\").toLowerCase():\"\"}export{d as clonePreservingTiledLayers,v as contentEquals,o as createCache,f as destroyCache,p as ensureType,I as findSpatialReference,L as getWellKnownBasemapId,h as hasDeveloperBasemapLayer,y as isBasemap3D,m as isBasemapLayer,R as isDeveloperBasemapLayer,S as overrideGetWellKnownBasemapId};\n"],
  "mappings": ";;;;;;;;;;;;;AAI8U,IAAM,IAAEA,GAAE,UAAU,2BAA2B;AAAE,SAAS,IAAG;AAAC,SAAM,CAAC;AAAC;AAAC,SAAS,EAAE,GAAE;AAAC,aAAU,KAAK,GAAE;AAAC,UAAM,IAAE,EAAE,CAAC;AAAE,eAAK,uBAAG,cAAW,EAAE,QAAQ,GAAE,OAAO,EAAE,CAAC;AAAA,EAAC;AAAC;AAAC,SAAS,EAAE,GAAE,GAAE;AAAC,MAAI;AAAE,MAAG,YAAU,OAAO,GAAE;AAAC,QAAG,EAAE,KAAKA,KAAG;AAAC,YAAM,IAAE,OAAO,QAAQA,EAAC,EAAE,OAAQ,CAAC,CAACC,IAAEC,EAAC,MAAI,EAAE,UAAQ,CAACA,GAAE,WAAS,CAAC,EAAE,UAAQA,GAAE,WAAS,CAACA,GAAE,UAAW,EAAE,IAAK,CAAC,CAACD,EAAC,MAAI,IAAIA,EAAC,GAAI,EAAE,KAAK,IAAI;AAAE,aAAO,EAAE,KAAK,0CAA0C,CAAC,uBAAuB,CAAC,EAAE,GAAE;AAAA,IAAI;AAAC,UAAI,IAAE,EAAE,CAAC,IAAG,MAAI,IAAE,EAAE,OAAO,CAAC,GAAE,MAAI,EAAE,CAAC,IAAE;AAAA,EAAG;AAAM,QAAE,EAAE,GAAE,CAAC;AAAE,UAAO,uBAAG,eAAY,EAAE,KAAK,6CAA4C,EAAC,SAAQ,EAAC,CAAC,GAAE,IAAE,OAAM;AAAC;AAAsD,SAAS,EAAE,GAAE,GAAE;AAJz+B;AAI0+B,WAAO,aAAE,YAAF,mBAAW,oBAAX,mBAA4B,KAAM,CAAAE,OAAGA,GAAE,QAAM,SAAK,aAAE,YAAF,mBAAW,eAAX,mBAAuB,KAAM,CAAAA,OAAGA,GAAE,QAAM;AAAG;",
  "names": ["s", "e", "n", "e"]
}
